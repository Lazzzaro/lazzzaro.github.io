<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>RSA | Lazzaro</title><meta name="description" content="å¸¸ç”¨å·¥å…· åˆ†è§£å¤§ç´ æ•° factordb ï¼ˆhttp:&#x2F;&#x2F;www.factordb.com &#x2F; API: http:&#x2F;&#x2F;factordb.com&#x2F;api?query&#x3D;ï¼‰ yafuï¼ˆ$p,q$ç›¸å·®è¿‡å¤§æˆ–è¿‡å°yafuå¯åˆ†è§£æˆåŠŸï¼‰ sage ï¼ˆdivisors(n)ï¼‰ï¼ˆå°ç´ æ•°ï¼‰ Pollardâ€™s pâˆ’1 ï¼ˆpython -m primefac -vs -m&#x3D;p-1 xxxxxxxï¼‰ï¼ˆå…‰æ»‘æ•°ï¼‰ Willi"><meta property="og:type" content="article"><meta property="og:title" content="RSA"><meta property="og:url" content="https://lazzzaro.github.io/2020/05/06/crypto-RSA/index.html"><meta property="og:site_name" content="Lazzaro"><meta property="og:description" content="å¸¸ç”¨å·¥å…· åˆ†è§£å¤§ç´ æ•° factordb ï¼ˆhttp:&#x2F;&#x2F;www.factordb.com &#x2F; API: http:&#x2F;&#x2F;factordb.com&#x2F;api?query&#x3D;ï¼‰ yafuï¼ˆ$p,q$ç›¸å·®è¿‡å¤§æˆ–è¿‡å°yafuå¯åˆ†è§£æˆåŠŸï¼‰ sage ï¼ˆdivisors(n)ï¼‰ï¼ˆå°ç´ æ•°ï¼‰ Pollardâ€™s pâˆ’1 ï¼ˆpython -m primefac -vs -m&#x3D;p-1 xxxxxxxï¼‰ï¼ˆå…‰æ»‘æ•°ï¼‰ Willi"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://lazzzaro.github.io/2020/05/06/crypto-RSA/Hensel_lifting_for_Takagi&#39;s_scheme.jpg"><meta property="og:image" content="https://lazzzaro.github.io/2020/05/06/crypto-RSA/562d20d869954a56996e61739a25893e.png"><meta property="og:image" content="https://lazzzaro.github.io/2020/05/06/crypto-RSA/pkcs1padding.jpg"><meta property="article:published_time" content="2020-05-06T14:15:00.000Z"><meta property="article:modified_time" content="2023-11-02T11:54:59.358Z"><meta property="article:author" content="Lazzaro"><meta property="article:tag" content="RSA"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://lazzzaro.github.io/2020/05/06/crypto-RSA/Hensel_lifting_for_Takagi&#39;s_scheme.jpg"><link rel="canonical" href="https://lazzzaro.github.io/2020/05/06/crypto-RSA/index.html"><link rel="alternate" href="/atom.xml" title="Lazzaro" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link href="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css" rel="stylesheet"><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"3Ft5J9t2Jl0eb5Zr",ck:"3Ft5J9t2Jl0eb5Zr",hashMode:!0})</script><meta name="generator" content="Hexo 7.0.0"></head><body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/Lazzzaro" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">Lazzaro</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">CTFå¼±é¸¡è‡ªè¿›é˜¶</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> flag{}___Orz</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="æœç´¢"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">æ€»è§ˆ</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">æ±‡æ€»</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">ç±»åˆ«</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">å…³é”®è¯</span></a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook"><i class="icon"></i> <span class="menu-title">æ¥ç•™ä¸ªè¨€ ğŸ‘‰ğŸ‘‰ğŸ‘‰</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/Lazzzaro" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">ç±»åˆ«</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/crypto/">crypto</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/match/">match</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/misc/">misc</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/pwn/">pwn</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reverse/">reverse</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">17</span></li></ul></div></div><div class="widget"><h3 class="widget-title">å…³é”®è¯äº‘</h3><div class="widget-body tagcloud"><a href="/tags/2020%E8%B5%9B/" style="font-size:14px">2020èµ›</a> <a href="/tags/2021%E8%B5%9B/" style="font-size:13.86px">2021èµ›</a> <a href="/tags/2022%E8%B5%9B/" style="font-size:13.57px">2022èµ›</a> <a href="/tags/2023%E8%B5%9B/" style="font-size:13.71px">2023èµ›</a> <a href="/tags/AES/" style="font-size:13px">AES</a> <a href="/tags/Android/" style="font-size:13px">Android</a> <a href="/tags/Bash/" style="font-size:13px">Bash</a> <a href="/tags/CMS/" style="font-size:13px">CMS</a> <a href="/tags/CSRF/" style="font-size:13px">CSRF</a> <a href="/tags/DES/" style="font-size:13px">DES</a> <a href="/tags/ECC/" style="font-size:13px">ECC</a> <a href="/tags/IDA/" style="font-size:13px">IDA</a> <a href="/tags/JWT/" style="font-size:13px">JWT</a> <a href="/tags/Java/" style="font-size:13.14px">Java</a> <a href="/tags/Linux/" style="font-size:13px">Linux</a> <a href="/tags/OT/" style="font-size:13px">OT</a> <a href="/tags/PHP/" style="font-size:13.29px">PHP</a> <a href="/tags/RCE/" style="font-size:13px">RCE</a> <a href="/tags/RSA/" style="font-size:13.14px">RSA</a> <a href="/tags/SQL/" style="font-size:13px">SQL</a> <a href="/tags/SSRF/" style="font-size:13px">SSRF</a> <a href="/tags/SSTI/" style="font-size:13px">SSTI</a> <a href="/tags/Sage/" style="font-size:13px">Sage</a> <a href="/tags/USB/" style="font-size:13px">USB</a> <a href="/tags/Unity/" style="font-size:13px">Unity</a> <a href="/tags/WebAssembly/" style="font-size:13px">WebAssembly</a> <a href="/tags/XSS/" style="font-size:13px">XSS</a> <a href="/tags/XXE/" style="font-size:13px">XXE</a> <a href="/tags/angr/" style="font-size:13px">angr</a> <a href="/tags/fuzz/" style="font-size:13px">fuzz</a> <a href="/tags/gmpy2/" style="font-size:13px">gmpy2</a> <a href="/tags/hash/" style="font-size:13px">hash</a> <a href="/tags/js/" style="font-size:13px">js</a> <a href="/tags/node-js/" style="font-size:13.14px">node.js</a> <a href="/tags/pwntools/" style="font-size:13px">pwntools</a> <a href="/tags/python/" style="font-size:13.43px">python</a> <a href="/tags/wasm/" style="font-size:13px">wasm</a> <a href="/tags/z3/" style="font-size:13px">z3</a> <a href="/tags/%E5%86%85%E7%BD%91/" style="font-size:13px">å†…ç½‘</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size:13px">ååºåˆ—åŒ–</a> <a href="/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/" style="font-size:13px">åç¼–è¯‘</a> <a href="/tags/%E5%8F%8D%E8%B0%83%E8%AF%95/" style="font-size:13px">åè°ƒè¯•</a> <a href="/tags/%E5%8F%96%E8%AF%81/" style="font-size:13px">å–è¯</a> <a href="/tags/%E5%90%8E%E9%87%8F%E5%AD%90%E5%AF%86%E7%A0%81/" style="font-size:13px">åé‡å­å¯†ç </a> <a href="/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/" style="font-size:13px">å‘½ä»¤è¡Œ</a> <a href="/tags/%E5%9B%BE%E5%83%8F/" style="font-size:13px">å›¾åƒ</a> <a href="/tags/%E5%9D%97%E5%AF%86%E7%A0%81/" style="font-size:13px">å—å¯†ç </a> <a href="/tags/%E5%A0%86/" style="font-size:13px">å †</a> <a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size:13.14px">å¯†ç </a> <a href="/tags/%E6%8F%90%E6%9D%83/" style="font-size:13px">ææƒ</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size:13px">æ–‡ä»¶ä¸Šä¼ </a> <a href="/tags/%E6%9B%B2%E7%BA%BF/" style="font-size:13px">æ›²çº¿</a> <a href="/tags/%E6%A0%88/" style="font-size:13px">æ ˆ</a> <a href="/tags/%E6%A0%BC%E5%AF%86%E7%A0%81/" style="font-size:13px">æ ¼å¯†ç </a> <a href="/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size:13px">æ ¼å¼åŒ–å­—ç¬¦ä¸²</a> <a href="/tags/%E6%B3%A8%E5%85%A5/" style="font-size:13px">æ³¨å…¥</a> <a href="/tags/%E6%B5%81%E5%AF%86%E7%A0%81/" style="font-size:13px">æµå¯†ç </a> <a href="/tags/%E6%B5%81%E9%87%8F/" style="font-size:13px">æµé‡</a> <a href="/tags/%E6%B7%B7%E6%B7%86/" style="font-size:13px">æ··æ·†</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size:13px">æ¸—é€</a> <a href="/tags/%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0/" style="font-size:13px">ç¦»æ•£å¯¹æ•°</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:13.14px">ç®—æ³•</a> <a href="/tags/%E7%BB%95%E8%BF%87/" style="font-size:13.43px">ç»•è¿‡</a> <a href="/tags/%E7%BC%96%E7%A0%81/" style="font-size:13px">ç¼–ç </a> <a href="/tags/%E8%84%9A%E6%9C%AC/" style="font-size:13.14px">è„šæœ¬</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/" style="font-size:13px">è‡ªåŠ¨åŒ–</a> <a href="/tags/%E9%80%83%E9%80%B8/" style="font-size:13px">é€ƒé€¸</a> <a href="/tags/%E9%9A%90%E5%86%99/" style="font-size:13.29px">éšå†™</a></div></div><div class="widget"><h3 class="widget-title">æ±‡æ€»</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">åä¸€æœˆ 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">ä¹æœˆ 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">äº”æœˆ 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">äºŒæœˆ 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">ä¸€æœˆ 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">åäºŒæœˆ 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">åä¸€æœˆ 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">ä¹æœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">ä¸ƒæœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">å…­æœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">äº”æœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">äºŒæœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">ä¸€æœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">åäºŒæœˆ 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">åä¸€æœˆ 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">åæœˆ 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">ä¹æœˆ 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">å…«æœˆ 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">å…­æœˆ 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">äº”æœˆ 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">å››æœˆ 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">ä¸‰æœˆ 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">äºŒæœˆ 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">ä¸€æœˆ 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">åäºŒæœˆ 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">åä¸€æœˆ 2020</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">åæœˆ 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">ä¹æœˆ 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">å…«æœˆ 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">ä¸ƒæœˆ 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">å…­æœˆ 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">äº”æœˆ 2020</a><span class="archive-list-count">24</span></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><nav id="toc" class="article-toc"><h3 class="toc-title">æ–‡ç« ç›®å½•</h3><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">1.</span> <span class="toc-text">å¸¸ç”¨å·¥å…·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">å¸¸è§ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%99p-q-e-c"><span class="toc-number">2.1.</span> <span class="toc-text">ç»™p,q,e,c</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%99n-e-dp-c"><span class="toc-number">2.2.</span> <span class="toc-text">ç»™n,e,dp,c</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%99p-q-dp-dq-c"><span class="toc-number">2.3.</span> <span class="toc-text">ç»™p,q,dp,dq,c</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%99e-d-n"><span class="toc-number">2.4.</span> <span class="toc-text">ç»™e,d,n</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8E%E8%A7%A3%E5%AF%86%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB-%E4%BD%8E%E7%A7%81%E9%92%A5%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB%EF%BC%88e%E9%95%BF%E5%BA%A6%E8%BE%83%E5%A4%A7%EF%BC%8Cd%E5%B0%8F%EF%BC%8CWiener-Attack%EF%BC%89"><span class="toc-number">2.5.</span> <span class="toc-text">ä½è§£å¯†æŒ‡æ•°æ”»å‡»&#x2F;ä½ç§é’¥æŒ‡æ•°æ”»å‡»ï¼ˆeé•¿åº¦è¾ƒå¤§ï¼Œdå°ï¼ŒWiener Attackï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8E%E5%8A%A0%E5%AF%86%E6%8C%87%E6%95%B0%E5%B9%BF%E6%92%AD%E6%94%BB%E5%87%BB%EF%BC%88Hastad%E6%94%BB%E5%87%BB%EF%BC%89"><span class="toc-number">2.6.</span> <span class="toc-text">ä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»ï¼ˆHastadæ”»å‡»ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB%EF%BC%88n-m%E7%9B%B8%E5%90%8C%EF%BC%8Cc-e%E4%B8%8D%E5%90%8C%EF%BC%89"><span class="toc-number">2.7.</span> <span class="toc-text">å…±æ¨¡æ”»å‡»ï¼ˆn,mç›¸åŒï¼Œc,eä¸åŒï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#e-m%E7%9B%B8%E5%90%8C%EF%BC%8C%E5%A4%9A%E4%B8%AAn%E4%B8%AD%E5%AD%98%E5%9C%A8%E4%B8%A4%E4%B8%AAn%E6%9C%89GCD%EF%BC%88%E6%A8%A1%E4%B8%8D%E4%BA%92%E7%B4%A0%EF%BC%89"><span class="toc-number">2.8.</span> <span class="toc-text">e,mç›¸åŒï¼Œå¤šä¸ªnä¸­å­˜åœ¨ä¸¤ä¸ªnæœ‰GCDï¼ˆæ¨¡ä¸äº’ç´ ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Rabin%E5%8A%A0%E5%AF%86"><span class="toc-number">2.9.</span> <span class="toc-text">RabinåŠ å¯†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Boneh-and-Durfee-attack"><span class="toc-number">2.10.</span> <span class="toc-text">Boneh and Durfee attack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%89%E6%BB%91%E6%95%B0"><span class="toc-number">2.11.</span> <span class="toc-text">å…‰æ»‘æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#p-1-%E5%85%89%E6%BB%91"><span class="toc-number">2.11.1.</span> <span class="toc-text">p-1 å…‰æ»‘</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#p-1-%E5%85%89%E6%BB%91-1"><span class="toc-number">2.11.2.</span> <span class="toc-text">p+1 å…‰æ»‘</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Coppersmith%E6%94%BB%E5%87%BB%EF%BC%88%E5%B7%B2%E7%9F%A5p%E7%9A%84%E9%AB%98%E4%BD%8D%E6%94%BB%E5%87%BB%EF%BC%89"><span class="toc-number">2.12.</span> <span class="toc-text">Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥pçš„é«˜ä½æ”»å‡»ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Coppersmith%E6%94%BB%E5%87%BB%EF%BC%88%E5%B7%B2%E7%9F%A5m%E7%9A%84%E9%AB%98%E4%BD%8D%E6%94%BB%E5%87%BB%EF%BC%89"><span class="toc-number">2.13.</span> <span class="toc-text">Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥mçš„é«˜ä½æ”»å‡»ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Coppersmith%E6%94%BB%E5%87%BB%EF%BC%88%E5%B7%B2%E7%9F%A5d%E7%9A%84%E4%BD%8E%E4%BD%8D%E6%94%BB%E5%87%BB%EF%BC%89"><span class="toc-number">2.14.</span> <span class="toc-text">Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥dçš„ä½ä½æ”»å‡»ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Coppersmith%E6%94%BB%E5%87%BB%EF%BC%88%E5%B7%B2%E7%9F%A5N%E4%B8%80%E4%B8%AA%E5%9B%A0%E5%AD%90%E7%9A%84%E9%AB%98%E4%BD%8D%EF%BC%8C%E9%83%A8%E5%88%86p%EF%BC%89"><span class="toc-number">2.15.</span> <span class="toc-text">Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥Nä¸€ä¸ªå› å­çš„é«˜ä½ï¼Œéƒ¨åˆ†pï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Coppersmith%E2%80%99s-Short-pad-Attack-amp-Related-Message-Attack%EF%BC%88Franklin-Reiter%E6%94%BB%E5%87%BB%EF%BC%89"><span class="toc-number">2.16.</span> <span class="toc-text">Coppersmithâ€™s Short-pad Attack &amp; Related Message Attackï¼ˆFranklin-Reiteræ”»å‡»ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RSA-Hastad-Attack-with-non-linear-padding-and-different-public-keys%EF%BC%88%E5%B8%A6%E9%9D%9E%E7%BA%BF%E6%80%A7padding%E5%92%8C%E4%B8%8D%E5%90%8C%E5%85%AC%E9%92%A5%E7%9A%84%E5%B9%BF%E6%92%AD%E6%94%BB%E5%87%BB%EF%BC%89"><span class="toc-number">2.17.</span> <span class="toc-text">RSA Hastad Attack with non-linear padding and different public keysï¼ˆå¸¦éçº¿æ€§paddingå’Œä¸åŒå…¬é’¥çš„å¹¿æ’­æ”»å‡»ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%98%8E-%E5%AF%86%E6%96%87%E6%94%BB%E5%87%BB"><span class="toc-number">2.18.</span> <span class="toc-text">é€‰æ‹©æ˜&#x2F;å¯†æ–‡æ”»å‡»</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB"><span class="toc-number">2.18.1.</span> <span class="toc-text">é€‰æ‹©æ˜æ–‡æ”»å‡»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%AF%86%E6%96%87%E6%94%BB%E5%87%BB"><span class="toc-number">2.18.2.</span> <span class="toc-text">é€‰æ‹©å¯†æ–‡æ”»å‡»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Parity-Oracle-Attack"><span class="toc-number">2.18.3.</span> <span class="toc-text">Parity Oracle Attack</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#LSB-Oracle-Attack%EF%BC%88Least-Significant-Bit-Oracle-Attack-%EF%BC%89"><span class="toc-number">2.18.3.1.</span> <span class="toc-text">LSB Oracle Attackï¼ˆLeast Significant Bit Oracle Attack ï¼‰</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#MSB-Oracle-Attack%EF%BC%88Most-Significant-Bit-Oracle-Attack-%EF%BC%89"><span class="toc-number">2.18.3.2.</span> <span class="toc-text">MSB Oracle Attackï¼ˆMost Significant Bit Oracle Attack ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Byte-Oracle-Attack"><span class="toc-number">2.18.4.</span> <span class="toc-text">Byte Oracle Attack</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Common-Private-Exponent%EF%BC%88%E5%85%B1%E7%A7%81%E9%92%A5%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB%EF%BC%8Cd%E7%9B%B8%E5%90%8C%EF%BC%89"><span class="toc-number">2.19.</span> <span class="toc-text">Common Private Exponentï¼ˆå…±ç§é’¥æŒ‡æ•°æ”»å‡»ï¼Œdç›¸åŒï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%BB%84%E4%BD%8E%E8%A7%A3%E5%AF%86%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB"><span class="toc-number">2.20.</span> <span class="toc-text">å¤šç»„ä½è§£å¯†æŒ‡æ•°æ”»å‡»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8FRSA"><span class="toc-number">2.21.</span> <span class="toc-text">å¤šé¡¹å¼RSA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Weak-prime-factors-%EF%BC%88p%E5%85%B7%E7%BA%BF%E6%80%A7%E7%89%B9%E5%BE%81%EF%BC%89"><span class="toc-number">2.22.</span> <span class="toc-text">Weak prime factors ï¼ˆpå…·çº¿æ€§ç‰¹å¾ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#p%E5%A4%9A%E6%AC%A1%E5%B9%82%E5%9B%A0%E5%AD%90"><span class="toc-number">2.23.</span> <span class="toc-text">på¤šæ¬¡å¹‚å› å­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RSA-CRT"><span class="toc-number">2.24.</span> <span class="toc-text">RSA-CRT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%89%B9%E5%88%AB%E6%83%85%E5%BD%A2"><span class="toc-number">2.25.</span> <span class="toc-text">å…¶ä»–ç‰¹åˆ«æƒ…å½¢</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E7%B4%A0%E6%95%B0%E5%9B%A0%E5%AD%90%EF%BC%88Multi-prime-RSA%EF%BC%89"><span class="toc-number">2.25.1.</span> <span class="toc-text">å¤šç´ æ•°å› å­ï¼ˆMulti-prime RSAï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#next-prime"><span class="toc-number">2.25.2.</span> <span class="toc-text">next_prime()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%99-e-d-modinv-q-p-c"><span class="toc-number">2.25.3.</span> <span class="toc-text">ç»™ e,d,modinv(q,p),c</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gcd-e-%CF%86-n-%E2%89%A0-1"><span class="toc-number">2.25.4.</span> <span class="toc-text">gcd(e,Ï†(n)) â‰  1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#e-p-1-e-q-1"><span class="toc-number">2.25.5.</span> <span class="toc-text">e|(p-1), e|(q-1)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SMUPE-%E9%97%AE%E9%A2%98%EF%BC%88%E4%B8%8D%E5%90%8CN-e%E5%8A%A0%E5%AF%86%E7%BA%BF%E6%80%A7%E5%85%B3%E7%B3%BB%E6%98%8E%E6%96%87%EF%BC%89"><span class="toc-number">2.25.6.</span> <span class="toc-text">SMUPE é—®é¢˜ï¼ˆä¸åŒN,eåŠ å¯†çº¿æ€§å…³ç³»æ˜æ–‡ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E7%B4%A0%E6%95%B0%EF%BC%88emirp%E6%95%B0%EF%BC%89"><span class="toc-number">2.25.7.</span> <span class="toc-text">åç´ æ•°ï¼ˆemirpæ•°ï¼‰</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4p-1-method"><span class="toc-number">2.25.8.</span> <span class="toc-text">4p-1 method</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Common-Prime-RSA"><span class="toc-number">2.25.9.</span> <span class="toc-text">Common Prime RSA</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RSA-Padding-Oracle-Attack"><span class="toc-number">2.25.10.</span> <span class="toc-text">RSA Padding Oracle Attack</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Return-of-Coppersmith%E2%80%99s-attack-ROCA"><span class="toc-number">2.25.11.</span> <span class="toc-text">Return of Coppersmithâ€™s attack (ROCA)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PEM%E5%AF%86%E9%92%A5"><span class="toc-number">3.</span> <span class="toc-text">PEMå¯†é’¥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RSA%E7%A7%81%E9%92%A5"><span class="toc-number">3.1.</span> <span class="toc-text">RSAç§é’¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RSA%E5%85%AC%E9%92%A5"><span class="toc-number">3.2.</span> <span class="toc-text">RSAå…¬é’¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">3.3.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E5%8E%9F%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">è¯¦ç»†åŸç†</span></a></li></ol></nav></div></aside><main class="main" role="main"><div class="content"><article id="post-crypto-RSA" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">RSA</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2020/05/06/crypto-RSA/" class="article-date"><time datetime="2020-05-06T14:15:00.000Z" itemprop="datePublished">2020-05-06</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/crypto/">crypto</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/RSA/" rel="tag">RSA</a> </span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="/2020/05/06/crypto-RSA/" class="leancloud_visitors" data-flag-title="RSA"><span class="leancloud-visitors-count">âˆ</span> </span></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2020/05/06/crypto-RSA/#comments" class="article-comment-link">è¯„è®º</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h3 id="å¸¸ç”¨å·¥å…·"><a href="#å¸¸ç”¨å·¥å…·" class="headerlink" title="å¸¸ç”¨å·¥å…·"></a>å¸¸ç”¨å·¥å…·</h3><ul><li><p>åˆ†è§£å¤§ç´ æ•°</p><p><strong>factordb</strong> ï¼ˆ<a target="_blank" rel="noopener" href="http://www.factordb.com/">http://www.factordb.com</a> / API: <code>http://factordb.com/api?query=</code>ï¼‰</p><p><strong>yafu</strong>ï¼ˆ$p,q$ç›¸å·®è¿‡å¤§æˆ–è¿‡å°yafuå¯åˆ†è§£æˆåŠŸï¼‰</p><p><strong>sage</strong> ï¼ˆ<code>divisors(n)</code>ï¼‰ï¼ˆå°ç´ æ•°ï¼‰</p><p><strong>Pollardâ€™s pâˆ’1</strong> ï¼ˆ<code>python -m primefac -vs -m=p-1 xxxxxxx</code>ï¼‰ï¼ˆå…‰æ»‘æ•°ï¼‰</p><p><strong>Williamsâ€™s p+1</strong>ï¼ˆ<code>python -m primefac -vs -m=p+1 xxxxxxx</code>ï¼‰ï¼ˆå…‰æ»‘æ•°ï¼‰</p><p><strong>cado-nfs</strong></p></li><li><p>åœ¨çº¿<strong>sage</strong>ç¯å¢ƒï¼š<a target="_blank" rel="noopener" href="https://sagecell.sagemath.org/">https://sagecell.sagemath.org/</a></p></li><li><p><strong>Openssl</strong></p><p>è§£æåŠ å¯†å¯†é’¥ï¼š</p><blockquote><p>openssl rsa -pubin -text -modulus -in pub.key</p></blockquote><p>ç”Ÿæˆè§£å¯†å¯†é’¥ï¼š</p><blockquote><p>python rsatool.py -f PEM -o key.key -p 1 -q 1 -e 1</p><p>openssl rsautl -decrypt -inkey key.pem -in flag.enc -out flag</p><p>openssl rsautl -decrypt -oaep -inkey key.pem -in flag.enc -out flag ï¼ˆOAEPæ–¹å¼ï¼‰</p></blockquote><p>è„šæœ¬ç”Ÿæˆè§£å¯†å¯†é’¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line"> </span><br><span class="line">rsa_components = (n1, e, <span class="built_in">int</span>(d1), p, q1)</span><br><span class="line">myrsa = RSA.construct(rsa_components)</span><br><span class="line"></span><br><span class="line">private = <span class="built_in">open</span>(<span class="string">&#x27;private.pem&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">private.write(myrsa.exportKey())</span><br><span class="line">private.close()</span><br><span class="line"></span><br><span class="line">rsakey = RSA.importKey(myrsa.exportKey()) </span><br><span class="line">rsakey = PKCS1_OAEP.new(rsakey)</span><br><span class="line">decrypted = rsakey.decrypt(c_bytes)</span><br></pre></td></tr></table></figure></li><li><p><strong>è„šæœ¬é›†</strong></p><ul><li><p><a target="_blank" rel="noopener" href="https://github.com/Ganapati/RsaCtfTool">https://github.com/Ganapati/RsaCtfTool</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç”¨æ³•ä¸€ï¼šå·²çŸ¥å…¬é’¥(è‡ªåŠ¨æ±‚ç§é’¥)</span></span><br><span class="line">  $ python3 RsaCtfTool.py --publickey å…¬é’¥æ–‡ä»¶ --uncipherfile åŠ å¯†æ–‡ä»¶</span><br><span class="line">  </span><br><span class="line">  <span class="comment">#ç”¨æ³•äºŒï¼šå·²çŸ¥å…¬é’¥æ±‚ç§é’¥</span></span><br><span class="line">  $ python3 RsaCtfTool.py --publickey å…¬é’¥æ–‡ä»¶ --private</span><br><span class="line">  </span><br><span class="line">  <span class="comment">#ç”¨æ³•ä¸‰ï¼šå¯†é’¥æ ¼å¼è½¬æ¢</span></span><br><span class="line">  <span class="comment">#æŠŠPEMæ ¼å¼çš„å…¬é’¥è½¬æ¢ä¸ºnï¼Œe</span></span><br><span class="line">  $ python3 RsaCtfTool.py --dumpkey --key å…¬é’¥æ–‡ä»¶</span><br><span class="line">  <span class="comment">#æŠŠn,eè½¬æ¢ä¸ºPEMæ ¼å¼</span></span><br><span class="line">  $ python3 RsaCtfTool.py --createpub -n 782837482376192871287312987398172312837182 -e 65537</span><br></pre></td></tr></table></figure></li><li><p><a target="_blank" rel="noopener" href="https://github.com/yifeng-lee/RSA-In-CTF">https://github.com/yifeng-lee/RSA-In-CTF</a></p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/ValarDragon/CTF-Crypto">https://github.com/ValarDragon/CTF-Crypto</a></p><p>â€‹</p></li></ul></li></ul><h3 id="å¸¸è§ç±»å‹"><a href="#å¸¸è§ç±»å‹" class="headerlink" title="å¸¸è§ç±»å‹"></a>å¸¸è§ç±»å‹</h3><h4 id="ç»™p-q-e-c"><a href="#ç»™p-q-e-c" class="headerlink" title="ç»™p,q,e,c"></a>ç»™p,q,e,c</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">p =  </span><br><span class="line">q =  </span><br><span class="line">e =  </span><br><span class="line">c =  </span><br><span class="line">n = p*q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = gp.invert(e,phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="ç»™n-e-dp-c"><a href="#ç»™n-e-dp-c" class="headerlink" title="ç»™n,e,dp,c"></a>ç»™n,e,dp,c</h4><p>$dp\equiv d \pmod {(p-1)}$</p><p>$\because dp\cdot e\equiv d\cdot e\equiv 1 \pmod {(p-1)}$</p><p>$\therefore dp\cdot e-1=k\cdot (p-1)$</p><p>$\therefore (dp\cdot e-1)\cdot d\cdot e=kâ€™\cdot (p-1),\quad kâ€™=k\cdot d\cdot e \\\Leftrightarrow d\cdot e=-kâ€™\cdot (p-1)+dp\cdot e\cdot d\cdot e\equiv 1 \pmod{\varphi(n)}\\\Leftrightarrow -kâ€™\cdot (p-1)+dp\cdot e\equiv 1\pmod{\varphi(n)}$</p><p>$\therefore k_{1}\cdot (p-1)+dp\cdot e-1=k_{2}\cdot (p-1)\cdot (q-1)\\\Leftrightarrow (p-1)\cdot (k_{2}\cdot (q-1)-k_{1})+1=dp\cdot e$</p><p>$\because dp&lt;p-1\quad \therefore (k_{2}\cdot (q-1)-k_{1})\in (0, e)$</p><p>$\therefore$ éå† $(1, e)$ï¼Œå½“åŒæ—¶æ»¡è¶³ $(dp\cdot e-1)\bmod i==0$ å’Œ $n\bmod((dp\cdot e-1)//i+1)==0$ æ—¶ï¼Œ$N$ æˆåŠŸåˆ†è§£ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"></span><br><span class="line">e = </span><br><span class="line">n = </span><br><span class="line">dp = </span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):</span><br><span class="line">	<span class="keyword">if</span>(e*dp%x==<span class="number">1</span>):</span><br><span class="line">		p=(e*dp-<span class="number">1</span>)//x+<span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span>(n%p!=<span class="number">0</span>):</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		q=n//p</span><br><span class="line">		phin=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">		d=gp.invert(e, phin)</span><br><span class="line">		m=gp.powmod(c, d, n)</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">len</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])%<span class="number">2</span>==<span class="number">1</span>):</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;--------------&#x27;</span>)</span><br><span class="line">		<span class="built_in">print</span>(m)</span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure><ul><li><p><strong>å˜ç§1ï¼š</strong>ç»™ $p,e,d_p,c,b$ï¼Œå…¶ä¸­ $n=p^bq$ã€‚</p><p><a target="_blank" rel="noopener" href="https://books.google.com.hk/books?
id=LAxAdqv1z7kC&amp;printsec=frontcover#v=onepage&amp;q&amp;f=false">Hensel lifting for Takagiâ€™s scheme</a>ï¼ˆp.189ï¼‰ï¼š</p><p><img src="/2020/05/06/crypto-RSA/Hensel_lifting_for_Takagi&#39;s_scheme.jpg" alt="Hensel_lifting_for_Takagi&#39;s_scheme"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p = </span><br><span class="line">dp = </span><br><span class="line">c = </span><br><span class="line">b = </span><br><span class="line">e = </span><br><span class="line">mp1 = <span class="built_in">pow</span>(c, dp, p)</span><br><span class="line">mp = <span class="built_in">pow</span>(c, dp - <span class="number">1</span>, p)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, b - <span class="number">2</span>):</span><br><span class="line">	x = <span class="built_in">pow</span>(c - <span class="built_in">pow</span>(mp1, e), <span class="number">1</span>, p**(i + <span class="number">1</span>))</span><br><span class="line">	y = <span class="built_in">pow</span>(x * mp * (gmpy2.invert(e, p)), <span class="number">1</span>, p**(i + <span class="number">1</span>))</span><br><span class="line">	mp1 = mp1 + y</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(mp1))</span><br></pre></td></tr></table></figure></li><li><p><strong>å˜ç§2</strong>ï¼šç»™ $n,e,dp_0,c,k$ï¼Œå…¶ä¸­ $dp_0$ ä¸º $dp$ é«˜ $(n\text{bits}-k)$ ä½ï¼Œå³ $dp_0=dp&gt;&gt;k$ã€‚</p><p>ï¼ˆCoppersmithæ”»å‡»ï¼Œå·²çŸ¥dpé«˜ä½æ”»å‡»ï¼‰</p><p>$e\cdot dp \equiv e\cdot d\equiv 1 \pmod {(p-1)} \\\Leftrightarrow e \cdot dp=k(p-1)+1=kp-k+1 \\\Leftrightarrow e\cdot dp+k-1 \equiv 0 \pmod p$</p><p>$\because dp&lt;p-1$ï¼Œ$\therefore k&lt;e$</p><p>$\therefore e\cdot (dp_0&lt;&lt;k+x)+k-1 \equiv 0 \pmod p$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line">dp0 = </span><br><span class="line">e = </span><br><span class="line">n = </span><br><span class="line"></span><br><span class="line">F.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">d = inverse_mod(e, n)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):</span><br><span class="line">	f = (secret &lt;&lt; <span class="number">200</span>) + x + (k - <span class="number">1</span>) * d</span><br><span class="line">	x0 = f.small_roots(X=<span class="number">2</span> ** (<span class="number">200</span> + <span class="number">1</span>), beta=<span class="number">0.44</span>, epsilon=<span class="number">1</span>/<span class="number">32</span>)</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(x0) != <span class="number">0</span>:</span><br><span class="line">		dp = x0[<span class="number">0</span>] + (secret &lt;&lt; <span class="number">200</span>)</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, e):</span><br><span class="line">			p = (e * Integer(dp) - <span class="number">1</span> + i) // i</span><br><span class="line">			<span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">if</span> p &lt; <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;k = &#x27;</span>,k)</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;p = &#x27;</span>,p)</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;dp = &#x27;</span>,dp)</span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å˜ç§3</strong>ï¼šç»™ $n,e,dp,c$â€‹â€‹ï¼Œå…¶ä¸­ $dp$â€‹â€‹â€‹ å¾ˆå°ï¼Œ$e$ å¾ˆå¤§ã€‚</p><p>æšä¸¾ $dp$ï¼Œå›  $e\cdot dp \equiv 1 \pmod {(p-1)}$ï¼Œåˆç”±è´¹é©¬å°å®šç†ï¼Œå¯¹ä»»æ„ $r$ï¼Œæœ‰ $m^{e \cdot dp}\equiv m \pmod p$ï¼Œå³ $p \mid (m^{e \cdot dp}-m)$ï¼›</p><p>åˆ $p \mid n$ï¼Œå¾ˆå¤§æ¦‚ç‡ $p=\gcd(m^{e \cdot dp}-m,n)$ã€‚</p></li><li><p><strong>å˜ç§4</strong>ï¼šç»™ $N,e,c$ï¼Œå…¶ä¸­ $dp$ è¿‡å°ã€‚</p><p><strong>æƒ…å½¢1ï¼š</strong>$q&lt;N^{0.382}$</p><p>å‚æ•° $\beta=\cfrac{q_{\text{bit}}}{N_{\text{bit}}}, \delta=\cfrac{dp_{\text{bit}}}{N_{\text{bit}}}$ï¼Œæ»¡è¶³ $3\beta &lt; 1+\beta^2+2\delta$ï¼Œå¯ç¡®å®š $\beta$ å’Œ $\delta$ çš„å€¼ã€‚</p><p>æ„é€ æ ¼å­ç»´åº¦ä¸º $n$ï¼Œæ ¼å­ä¸­æ¨¡æ•° $N$ çš„æœ€å¤§æ¬¡å¹‚ä¸º $m$ï¼Œåº”æ»¡è¶³å…³ç³»</p><p>$\cfrac{m(m+1)}{2} + \cfrac{n(n-1)(2\delta+\beta)}{2}-(1-\beta)nm &lt; 0$</p><p>ç¡®å®š $\beta$ å’Œ $\delta$ ä¹‹åï¼Œå¯æšä¸¾ç¡®å®š $n$ å’Œ $m$ çš„å–å€¼ï¼ˆæœ€å°å€¼ï¼‰ï¼Œ$m=(1-\beta)n$ æ˜¯ä¸€ä¸ªè¾ƒä¼˜çš„å–å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">beta = </span><br><span class="line">delta = </span><br><span class="line">n = <span class="built_in">round</span>((<span class="number">1</span>-<span class="number">2</span>*beta-<span class="number">2</span>*delta)/((<span class="number">1</span>-beta)^<span class="number">2</span>-<span class="number">2</span>*delta-beta),<span class="number">6</span>)</span><br><span class="line">m = (<span class="number">1</span>-beta)*n</span><br><span class="line"><span class="built_in">print</span>(m,n)</span><br></pre></td></tr></table></figure><p>æ„é€ å¤šé¡¹å¼ï¼Œåˆ†è§£å¤šé¡¹å¼ä¸º $(ax+by)$ é¡¹ï¼Œå…¶ä¸­ $a=k,b=dp$ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è„šæœ¬1</span></span><br><span class="line"><span class="comment"># Sage</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getC</span>(<span class="params">Scale</span>):</span><br><span class="line">    C = [[<span class="number">0</span> <span class="keyword">for</span> __ <span class="keyword">in</span> <span class="built_in">range</span>(Scale)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(Scale)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Scale):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(Scale):</span><br><span class="line">            <span class="keyword">if</span> i == j <span class="keyword">or</span> j == <span class="number">0</span>:</span><br><span class="line">                C[i][j] = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                C[i][j] = C[i-<span class="number">1</span>][j-<span class="number">1</span>] + C[i-<span class="number">1</span>][j]</span><br><span class="line">    <span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getMatrix</span>(<span class="params">Scale, Mvalue, N, E, Del, Bet</span>):</span><br><span class="line">    M = [[<span class="number">0</span> <span class="keyword">for</span> __ <span class="keyword">in</span> <span class="built_in">range</span>(Scale)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(Scale)]</span><br><span class="line">    C = getC(Scale)</span><br><span class="line">    X, Y = <span class="built_in">int</span>(<span class="built_in">pow</span>(N,Del)*(Scale+<span class="number">1</span>)//<span class="number">2</span>), <span class="built_in">int</span>(<span class="built_in">pow</span>(N,(Del+Bet))*(Scale+<span class="number">1</span>)//<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Scale):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(Scale):</span><br><span class="line">            M[i][j] = N**<span class="built_in">max</span>(Mvalue-i,<span class="number">0</span>)*E**(<span class="built_in">max</span>(i-j,<span class="number">0</span>))*X**(Scale-<span class="number">1</span>-j)*Y**j*C[i][j]*(-<span class="number">1</span>)**j</span><br><span class="line">    <span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line">N =</span><br><span class="line">E =</span><br><span class="line">delta = <span class="number">0.01</span></span><br><span class="line">beta = <span class="number">0.37</span></span><br><span class="line">Scale = <span class="number">35</span></span><br><span class="line">Mvalue = <span class="number">22</span></span><br><span class="line">M = getMatrix(Scale,Mvalue,N,E,delta,beta)</span><br><span class="line">M = matrix(ZZ,M)</span><br><span class="line">A = M.LLL()[<span class="number">0</span>]</span><br><span class="line">p = []</span><br><span class="line">X = <span class="built_in">int</span>(<span class="built_in">pow</span>(N,delta)*(Scale+<span class="number">1</span>)//<span class="number">2</span>)</span><br><span class="line">Y = <span class="built_in">int</span>(<span class="built_in">pow</span>(N,(delta+beta))*(Scale+<span class="number">1</span>)//<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Scale):</span><br><span class="line">    p.append(A[i]//(X**(Scale-<span class="number">1</span>-i)*Y**i))</span><br><span class="line">PR.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">f = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Scale):</span><br><span class="line">    f += p[i]*x^(Scale-<span class="number">1</span>-i)*y^i</span><br><span class="line"><span class="built_in">print</span>(f.factor())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è„šæœ¬2</span></span><br><span class="line"><span class="comment"># Sage</span></span><br><span class="line">N =</span><br><span class="line">e =</span><br><span class="line"></span><br><span class="line">n = <span class="number">12</span></span><br><span class="line">beta = <span class="number">0.36</span></span><br><span class="line">delta = <span class="number">0.02</span></span><br><span class="line"></span><br><span class="line">X = <span class="built_in">int</span>(N ** delta*(n+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">Y = <span class="built_in">int</span>(N ** (delta + beta)*(n+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">C</span>(<span class="params">a,b</span>):</span><br><span class="line">    ret=<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(b):</span><br><span class="line">        ret *= (a-i)</span><br><span class="line">        ret /= (b-i)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_Matrix</span>(<span class="params">n,m</span>):</span><br><span class="line">    MM=[[<span class="number">0</span> <span class="keyword">for</span> __ <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n): </span><br><span class="line">        pN = <span class="built_in">max</span>(<span class="number">0</span>,m-j)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(j+<span class="number">1</span>):</span><br><span class="line">            MM[j][i] = <span class="built_in">pow</span>(N,pN)*<span class="built_in">pow</span>(X,n-i-<span class="number">1</span>)*<span class="built_in">pow</span>(Y,i)*<span class="built_in">pow</span>(e,j-i)*C(j,i)*<span class="built_in">pow</span>(-<span class="number">1</span>,i)</span><br><span class="line">    MM = Matrix(ZZ,MM)</span><br><span class="line">    <span class="keyword">return</span> MM</span><br><span class="line"></span><br><span class="line">M = get_Matrix(n,n//<span class="number">2</span>+<span class="number">1</span>)</span><br><span class="line">L = M.LLL()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">x,y = var(<span class="string">&#x27;x&#x27;</span>),var(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">f = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    f += x**(n-i-<span class="number">1</span>) * y**i * (L[i] // <span class="built_in">pow</span>(X,n-i-<span class="number">1</span>) // <span class="built_in">pow</span>(Y,i))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f.factor())</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://link.springer.com/content/pdf/10.1007%2F3-540-45708-9_16.pdf">Cryptanalysis of Unbalanced RSA with Small CRT-Exponent</a></p><p><a target="_blank" rel="noopener" href="https://hash-hash.github.io/2022/05/14/Unbalanced-RSA-with-Small-CRT-Exponent/#An-Approach-Modulo-e">https://hash-hash.github.io/2022/05/14/Unbalanced-RSA-with-Small-CRT-Exponent/#An-Approach-Modulo-e</a></p><p>NSSCTF Round#3 - Secure_in_N</p><p><strong>æƒ…å½¢2ï¼š</strong>$q&lt;N^{0.468}$</p><p>å‚æ•° $\beta=\cfrac{q_{\text{bit}}}{N_{\text{bit}}}, \delta=\cfrac{dp_{\text{bit}}}{N_{\text{bit}}},\alpha=\cfrac{e_{\text{bit}}}{N_{\text{bit}}}$ï¼Œ</p><p>å˜é‡ä¸Šç•Œ $X=2N^{\alpha+\beta+\delta-1},Y=N^{\beta},Z=2N^{1-\beta}$ ï¼Œå¯¹äºå˜é‡ $m$ éœ€å……åˆ†å¤§ã€‚</p><p>$\tau=\cfrac{(1-\beta)^2-\delta}{2\beta(1-\beta)},\sigma=\cfrac{1-\beta-\delta}{2(1-\beta)},t=\tau m,s=\sigma m$</p><p>æ•´æ•°åŸŸä¸Šæœ‰æ ¹ $(x,y,z)=(x_0,p,q)$ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line"><span class="comment"># https://www.iacr.org/archive/pkc2006/39580001/39580001.pdf</span></span><br><span class="line"><span class="comment"># Author: ZM__________J, To1in</span></span><br><span class="line">N = </span><br><span class="line">e = </span><br><span class="line">alpha = log(e, N)</span><br><span class="line">beta = </span><br><span class="line">delta = </span><br><span class="line">P.&lt;x,y,z&gt;=PolynomialRing(ZZ)</span><br><span class="line"> </span><br><span class="line">X = ceil(<span class="number">2</span> * N^(alpha + beta + delta - <span class="number">1</span>))</span><br><span class="line">Y = ceil(<span class="number">2</span> * N^beta)</span><br><span class="line">Z = ceil(<span class="number">2</span> * N^(<span class="number">1</span> - beta))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="keyword">return</span> x*(N-y)+N</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">trans</span>(<span class="params">f</span>):</span><br><span class="line">    my_tuples = f.exponents(as_ETuples=<span class="literal">False</span>)</span><br><span class="line">    g = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> my_tuple <span class="keyword">in</span> my_tuples:</span><br><span class="line">        exponent = <span class="built_in">list</span>(my_tuple)</span><br><span class="line">        mon = x ^ exponent[<span class="number">0</span>] * y ^ exponent[<span class="number">1</span>] * z ^ exponent[<span class="number">2</span>]</span><br><span class="line">        tmp = f.monomial_coefficient(mon)</span><br><span class="line">        </span><br><span class="line">        my_minus = <span class="built_in">min</span>(exponent[<span class="number">1</span>], exponent[<span class="number">2</span>])</span><br><span class="line">        exponent[<span class="number">1</span>] -= my_minus</span><br><span class="line">        exponent[<span class="number">2</span>] -= my_minus</span><br><span class="line">        tmp *= N^my_minus</span><br><span class="line">        tmp *= x ^ exponent[<span class="number">0</span>] * y ^ exponent[<span class="number">1</span>] * z ^ exponent[<span class="number">2</span>]</span><br><span class="line">        </span><br><span class="line">        g += tmp</span><br><span class="line">    <span class="keyword">return</span> g</span><br><span class="line">  </span><br><span class="line">m = <span class="number">5</span> <span class="comment"># need to be adjusted according to different situations</span></span><br><span class="line">tau = ((<span class="number">1</span> - beta)^<span class="number">2</span> - delta) / (<span class="number">2</span> * beta * (<span class="number">1</span> - beta))</span><br><span class="line">sigma = (<span class="number">1</span> - beta - delta) / (<span class="number">2</span> * (<span class="number">1</span> - beta))</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(sigma * m)</span><br><span class="line"><span class="built_in">print</span>(tau * m)</span><br><span class="line"> </span><br><span class="line">s = ceil(sigma * m)</span><br><span class="line">t = ceil(tau * m)</span><br><span class="line">my_polynomials = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(m-i+<span class="number">1</span>):</span><br><span class="line">        g_ij = trans(e^(m-i) * x^j * z^s * f(x, y)^i)</span><br><span class="line">        my_polynomials.append(g_ij)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t+<span class="number">1</span>):</span><br><span class="line">        h_ij = trans(e^(m-i) * y^j * z^s * f(x, y)^i)</span><br><span class="line">        my_polynomials.append(h_ij)</span><br><span class="line">        </span><br><span class="line">known_set = <span class="built_in">set</span>()</span><br><span class="line">new_polynomials = []</span><br><span class="line">my_monomials = []</span><br><span class="line"> </span><br><span class="line"><span class="comment"># construct partial order</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">len</span>(my_polynomials) &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(my_polynomials)):</span><br><span class="line">        f = my_polynomials[i]</span><br><span class="line">        current_monomial_set = <span class="built_in">set</span>(x^tx * y^ty * z^tz <span class="keyword">for</span> tx, ty, tz <span class="keyword">in</span> f.exponents(as_ETuples=<span class="literal">False</span>))</span><br><span class="line">        delta_set = current_monomial_set - known_set</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(delta_set) == <span class="number">1</span>:</span><br><span class="line">            new_monomial = <span class="built_in">list</span>(delta_set)[<span class="number">0</span>]</span><br><span class="line">            my_monomials.append(new_monomial)</span><br><span class="line">            known_set |= current_monomial_set</span><br><span class="line">            new_polynomials.append(f)            </span><br><span class="line">            my_polynomials.pop(i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;GG&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">my_polynomials = deepcopy(new_polynomials)</span><br><span class="line"> </span><br><span class="line">nrows = <span class="built_in">len</span>(my_polynomials)</span><br><span class="line">ncols = <span class="built_in">len</span>(my_monomials)</span><br><span class="line">L = [[<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ncols)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nrows)]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nrows):</span><br><span class="line">    g_scale = my_polynomials[i](X * x, Y * y, Z * z)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ncols):</span><br><span class="line">        L[i][j] = g_scale.monomial_coefficient(my_monomials[j])</span><br><span class="line">        </span><br><span class="line"><span class="comment"># remove N^j</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nrows):</span><br><span class="line">    Lii = L[i][i]</span><br><span class="line">    N_Power = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (Lii % N == <span class="number">0</span>):</span><br><span class="line">        N_Power *= N</span><br><span class="line">        Lii //= N</span><br><span class="line">    L[i][i] = Lii</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ncols):</span><br><span class="line">        <span class="keyword">if</span> (j != i):</span><br><span class="line">            L[i][j] = (L[i][j] * inverse_mod(N_Power, e^m))</span><br><span class="line"> </span><br><span class="line">L = Matrix(ZZ, L)</span><br><span class="line">nrows = L.nrows()</span><br><span class="line"> </span><br><span class="line">L = L.LLL()</span><br><span class="line"><span class="comment"># Recover poly</span></span><br><span class="line">reduced_polynomials = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nrows):</span><br><span class="line">    g_l = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ncols):</span><br><span class="line">        g_l += L[i][j] // my_monomials[j](X, Y, Z) * my_monomials[j]</span><br><span class="line">    reduced_polynomials.append(g_l)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># eliminate z</span></span><br><span class="line">my_ideal_list = [y * z - N] + reduced_polynomials</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Variety</span></span><br><span class="line">my_ideal_list = [Hi.change_ring(QQ) <span class="keyword">for</span> Hi <span class="keyword">in</span> my_ideal_list]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(my_ideal_list),<span class="number">3</span>,-<span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    V = Ideal(my_ideal_list[:i]).variety(ring=ZZ)</span><br><span class="line">    <span class="built_in">print</span>(V)</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://www.iacr.org/archive/pkc2006/39580001/39580001.pdf">New Attacks on RSA with Small Secret CRT-Exponents</a></p><p><a target="_blank" rel="noopener" href="http://blog.tolinchan.xyz/2022/12/05/nctf-2022-official-writeup-crypto/#dp_promax">NCTF 2022 - dp_promax</a></p></li></ul><p>â€‹</p><h4 id="ç»™p-q-dp-dq-c"><a href="#ç»™p-q-dp-dq-c" class="headerlink" title="ç»™p,q,dp,dq,c"></a>ç»™p,q,dp,dq,c</h4><p>$dp=d \bmod (p-1)$ï¼Œ$dq=d \bmod (q-1)$</p><p>$\because d=k_{1}(p-1)+dp=k_{2}(q-1)+dq\\\Leftrightarrow k_{1}(p-1)=(dq-dp)+k_{2}(q-1)\\\Leftrightarrow k_{1}\frac{p-1}{\gcd(p-1,q-1)}=\frac{dq-dp}{\gcd(p-1,q-1)}+k_{2}\frac{q-1}{\gcd(p-1,q-1)}\\\Rightarrow k_{1}\frac{p-1}{\gcd(p-1,q-1)}\equiv\frac{dq-dp}{\gcd(p-1,q-1)} \pmod {\frac{q-1}{\gcd(p-1,q-1)}}\\\Leftrightarrow k_{1}\equiv \text{inv}(\frac{p-1}{\gcd(p-1,q-1)},\frac{q-1}{\gcd(p-1,q-1)})\cdot \frac{dq-dp}{\gcd(p-1,q-1)} \pmod {\frac{q-1}{\gcd(p-1,q-1)}}$</p><p>å°† $k_{1}=k_{3}\frac{q-1}{\gcd(p-1,q-1)}+\text{inv}(\frac{p-1}{\gcd(p-1,q-1)},\frac{q-1}{\gcd(p-1,q-1)})\cdot \frac{dq-dp}{\gcd(p-1,q-1)}$</p><p>ä»£å…¥ $d=k_{1}(p-1)+dp$</p><p>$d=k_{3}\frac{(p-1)(q-1)}{\gcd(p-1,q-1)}+\text{inv}(\frac{p-1}{\gcd(p-1,q-1)},\frac{q-1}{\gcd(p-1,q-1)})\cdot \frac{(dq-dp)(p-1)}{\gcd(p-1,q-1)}+dp\\\Rightarrow d\equiv \text{inv}(\frac{p-1}{\gcd(p-1,q-1)},\frac{q-1}{\gcd(p-1,q-1)})\cdot \frac{(dq-dp)(p-1)}{\gcd(p-1,q-1)}+dp \pmod{\frac{(p-1)(q-1)}{\gcd(p-1,q-1)}}$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"></span><br><span class="line">p = </span><br><span class="line">q = </span><br><span class="line">dp = </span><br><span class="line">dq = </span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line">phin = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">dd = gp.gcd(p-<span class="number">1</span>, q-<span class="number">1</span>)</span><br><span class="line">d=(dp-dq)//dd * gp.invert((q-<span class="number">1</span>)//dd, (p-<span class="number">1</span>)//dd) * (q-<span class="number">1</span>) +dq</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line">m = gp.powmod(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-------------------&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="ç»™e-d-n"><a href="#ç»™e-d-n" class="headerlink" title="ç»™e,d,n"></a>ç»™e,d,n</h4><p>è®¡ç®— $k=ed-1$ï¼Œé€‰æ‹©ä¸€ä¸ªéšæœºæ•° $g,g \in (1,N)$ã€‚</p><p>$k$ ä¸ºå¶æ•°ï¼Œæ•… $k=2^tr$ï¼Œå…¶ä¸­ $r$ ä¸ºå¥‡æ•°ä¸” $t \ge 1$ï¼Œç„¶åè®¡ç®— $x = g^{\frac{k}{2}},g^{\frac{k}{4}},\cdots,g^{\frac{k}{2^t}} \pmod N$ ç›´åˆ° $x \gt 1$ ä¸” $y=\gcd(x-1,N) \gt 1$ã€‚</p><p>å¦‚æœè¿™æ ·çš„ $y$ å­˜åœ¨ï¼Œåˆ™å…¶ä¸­çš„å› å­ $p=y,q=\cfrac{N}{y}$ï¼›å¦‚è¿™æ ·çš„ $y$ ä¸å­˜åœ¨ï¼Œåˆ™é‡æ–°ç”Ÿæˆéšæœºæ•° $g$ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">divide_pq</span>(<span class="params">e, d, n</span>):</span><br><span class="line">    k = e*d - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        g = random.randint(<span class="number">2</span>, n-<span class="number">1</span>)</span><br><span class="line">        t = k</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> t % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            t //= <span class="number">2</span></span><br><span class="line">            x = <span class="built_in">pow</span>(g, t, n)</span><br><span class="line">            <span class="keyword">if</span> x &gt; <span class="number">1</span> <span class="keyword">and</span> gmpy2.gcd(x-<span class="number">1</span>, n) &gt; <span class="number">1</span>:</span><br><span class="line">                p = gmpy2.gcd(x-<span class="number">1</span>, n)</span><br><span class="line">                <span class="keyword">return</span> (p, n//p)</span><br><span class="line">            </span><br><span class="line">p, q = divide_pq(e, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;q = <span class="subst">&#123;q&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factor_with_kphi</span>(<span class="params">n, kphi</span>):</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> kphi % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        kphi &gt;&gt;= <span class="number">1</span></span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>):</span><br><span class="line">        g = random.randint(<span class="number">0</span>, n) </span><br><span class="line">        y = <span class="built_in">pow</span>(g, kphi, n)</span><br><span class="line">        <span class="keyword">if</span> y == <span class="number">1</span> <span class="keyword">or</span> y == n - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t): </span><br><span class="line">                x = <span class="built_in">pow</span>(y, <span class="number">2</span>, n)</span><br><span class="line">                <span class="keyword">if</span> x == <span class="number">1</span>:</span><br><span class="line">                    p = gcd(n, y-<span class="number">1</span>)</span><br><span class="line">                    q = n//p</span><br><span class="line">                    <span class="keyword">return</span> p, q</span><br><span class="line">                <span class="keyword">elif</span> x == n - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                y = x</span><br><span class="line">                x = <span class="built_in">pow</span>(y, <span class="number">2</span>, n)</span><br><span class="line">                <span class="keyword">if</span> x == <span class="number">1</span>:</span><br><span class="line">                    p = gcd(n, y-<span class="number">1</span>)</span><br><span class="line">                    q = n//p</span><br><span class="line">                    <span class="keyword">return</span> p, q</span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="ä½è§£å¯†æŒ‡æ•°æ”»å‡»-ä½ç§é’¥æŒ‡æ•°æ”»å‡»ï¼ˆeé•¿åº¦è¾ƒå¤§ï¼Œdå°ï¼ŒWiener-Attackï¼‰"><a href="#ä½è§£å¯†æŒ‡æ•°æ”»å‡»-ä½ç§é’¥æŒ‡æ•°æ”»å‡»ï¼ˆeé•¿åº¦è¾ƒå¤§ï¼Œdå°ï¼ŒWiener-Attackï¼‰" class="headerlink" title="ä½è§£å¯†æŒ‡æ•°æ”»å‡»/ä½ç§é’¥æŒ‡æ•°æ”»å‡»ï¼ˆeé•¿åº¦è¾ƒå¤§ï¼Œdå°ï¼ŒWiener Attackï¼‰"></a>ä½è§£å¯†æŒ‡æ•°æ”»å‡»/ä½ç§é’¥æŒ‡æ•°æ”»å‡»ï¼ˆeé•¿åº¦è¾ƒå¤§ï¼Œdå°ï¼ŒWiener Attackï¼‰</h4><p><strong>é€‚ç”¨æƒ…å†µï¼šå·²çŸ¥ $N,e$ï¼Œä¸” $e$ è¿‡å¤§æˆ–è¿‡å°ã€‚</strong></p><p>$\varphi(n) = (p-1)(q-1)=pq - (p + q) + 1=N - (p + q) + 1$</p><p>$\because p, q$ éå¸¸å¤§ï¼Œ$\therefore\,pq\gg p+q$ï¼Œ $\therefore\varphi(n)\approx N$</p><p>$\because ed\equiv1\,mod\,\varphi(n)$ï¼Œ$\therefore ed-1=k\varphi(n)$ï¼Œè¿™ä¸ªå¼å­ä¸¤è¾¹åŒé™¤ $d\varphi(n)$ å¯å¾—ï¼š</p><p>$\cfrac{e}{\varphi(n)}-\cfrac{k}{d}=\cfrac{1}{d\varphi(n)}$</p><p>$\because \varphi(n)\approx N$ï¼Œ$\therefore \cfrac{e}{N}-\cfrac{k}{d}=\cfrac{1}{d\varphi(n)}$ï¼ŒåŒæ · $d\varphi(n)$ æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œæ‰€ä»¥ $\cfrac{e}{N}$ ç•¥å¤§äº $\cfrac{k}{d}$</p><p>å› ä¸º $e$ å’Œ $N$ æ˜¯çŸ¥é“çš„ï¼Œæ‰€ä»¥è®¡ç®—å‡º $\cfrac{e}{N}$ åï¼Œæ¯”å®ƒç•¥å°çš„ $\cfrac{k}{d}$ ï¼Œå¯ä»¥é€šè¿‡è®¡ç®— $\cfrac{e}{N}$ çš„è¿åˆ†æ•°å±•å¼€ï¼Œä¾æ¬¡ç®—å‡ºè¿™ä¸ªåˆ†æ•°æ¯ä¸€ä¸ªæ¸è¿›åˆ†æ•°ï¼Œç”±äº $\cfrac{e}{N}$ ç•¥å¤§äº $\cfrac{k}{d}$ï¼ŒWiener è¯æ˜äº†ï¼Œè¯¥æ”»å‡»èƒ½ç²¾ç¡®çš„è¦†ç›– $\cfrac{k}{d}$ã€‚</p><p>åœ¨ $e$ è¿‡å¤§æˆ–è¿‡å°çš„æƒ…å†µä¸‹ï¼Œå¯ä½¿ç”¨ç®—æ³•ä» $e$ ä¸­å¿«é€Ÿæ¨æ–­å‡º $d$ çš„å€¼ã€‚å¯ä»¥è§£å†³ $q&lt;p&lt;2q,d&lt;\cfrac{1}{3}N^{\frac{1}{4}}$ çš„é—®é¢˜ã€‚</p><p>RSAWienerHackerå·¥å…·ï¼š<a target="_blank" rel="noopener" href="https://github.com/pablocelayes/rsa-wiener-attack">https://github.com/pablocelayes/rsa-wiener-attack</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è„šæœ¬1</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factor_rsa_wiener</span>(<span class="params">N, e</span>):</span><br><span class="line">    N = Integer(N)</span><br><span class="line">    e = Integer(e)</span><br><span class="line">    cf = (e / N).continued_fraction().convergents()</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> cf:</span><br><span class="line">        k = f.numer()</span><br><span class="line">        d = f.denom()</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        phi_N = ((e * d) - <span class="number">1</span>) / k</span><br><span class="line">        b = -(N - phi_N + <span class="number">1</span>)</span><br><span class="line">        dis = b ^ <span class="number">2</span> - <span class="number">4</span> * N</span><br><span class="line">        <span class="keyword">if</span> dis.sign() == <span class="number">1</span>:</span><br><span class="line">            dis_sqrt = sqrt(dis)</span><br><span class="line">            p = (-b + dis_sqrt) / <span class="number">2</span></span><br><span class="line">            q = (-b - dis_sqrt) / <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> p.is_integer() <span class="keyword">and</span> q.is_integer() <span class="keyword">and</span> (p * q) % N == <span class="number">0</span>:</span><br><span class="line">                p = p % N</span><br><span class="line">                q = q % N</span><br><span class="line">                <span class="keyword">if</span> p &gt; q:</span><br><span class="line">                    <span class="keyword">return</span> (p, q)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> (q, p)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è„šæœ¬2</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rational_to_contfrac</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="comment"># Converts a rational x/y fraction into a list of partial quotients [a0, ..., an]</span></span><br><span class="line">    a = x // y</span><br><span class="line">    pquotients = [a]</span><br><span class="line">    <span class="keyword">while</span> a * y != x:</span><br><span class="line">        x, y = y, x - a * y</span><br><span class="line">        a = x // y</span><br><span class="line">        pquotients.append(a)</span><br><span class="line">    <span class="keyword">return</span> pquotients</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convergents_from_contfrac</span>(<span class="params">frac</span>):</span><br><span class="line">    <span class="comment"># computes the list of convergents using the list of partial quotients</span></span><br><span class="line">    convs = [];</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(frac)): convs.append(contfrac_to_rational(frac[<span class="number">0</span> : i]))</span><br><span class="line">    <span class="keyword">return</span> convs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">contfrac_to_rational</span> (frac):</span><br><span class="line">    <span class="comment"># Converts a finite continued fraction [a0, ..., an] to an x/y rational.</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(frac) == <span class="number">0</span>: <span class="keyword">return</span> (<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">    num = frac[-<span class="number">1</span>]</span><br><span class="line">    denom = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">2</span>, -<span class="built_in">len</span>(frac) - <span class="number">1</span>, -<span class="number">1</span>): num, denom = frac[_] * num + denom, num</span><br><span class="line">    <span class="keyword">return</span> (num, denom)</span><br><span class="line"></span><br><span class="line">n = </span><br><span class="line">e = </span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>: <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    g, x, y = egcd(b % a, a)</span><br><span class="line">    <span class="keyword">return</span> (g, y - (b // a) * x, x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mod_inv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, _ = egcd(a, m)</span><br><span class="line">    <span class="keyword">return</span> (x + m) % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isqrt</span>(<span class="params">n</span>):</span><br><span class="line">    x = n</span><br><span class="line">    y = (x + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> y &lt; x:</span><br><span class="line">        x = y</span><br><span class="line">        y = (x + n // x) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_rsa</span>(<span class="params">e, n</span>):</span><br><span class="line">    frac = rational_to_contfrac(e, n)</span><br><span class="line">    convergents = convergents_from_contfrac(frac)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (k, d) <span class="keyword">in</span> convergents:</span><br><span class="line">        <span class="keyword">if</span> k != <span class="number">0</span> <span class="keyword">and</span> (e * d - <span class="number">1</span>) % k == <span class="number">0</span>:</span><br><span class="line">            phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">            s = n - phi + <span class="number">1</span></span><br><span class="line">            <span class="comment"># check if x*x - s*x + n = 0 has integer roots</span></span><br><span class="line">            D = s * s - <span class="number">4</span> * n</span><br><span class="line">            <span class="keyword">if</span> D &gt;= <span class="number">0</span>:</span><br><span class="line">                sq = isqrt(D)</span><br><span class="line">                <span class="keyword">if</span> sq * sq == D <span class="keyword">and</span> (s + sq) % <span class="number">2</span> == <span class="number">0</span>: <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line">d = crack_rsa(e, n)</span><br><span class="line">m = <span class="built_in">hex</span>(<span class="built_in">pow</span>(c, d, n))[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(m))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è„šæœ¬3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">e = </span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†åˆ†æ•°x/yå±•å¼€ä¸ºè¿åˆ†æ•°çš„å½¢å¼</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">x,y</span>):</span><br><span class="line">	arr=[]</span><br><span class="line">	<span class="keyword">while</span> y:</span><br><span class="line">		arr+=[x//y]</span><br><span class="line">		x,y=y,x%y</span><br><span class="line">	<span class="keyword">return</span> arr</span><br><span class="line">	</span><br><span class="line"><span class="comment">#æ±‚è§£æ¸è¿›åˆ†æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_fraction</span>(<span class="params">k</span>):</span><br><span class="line">	x=<span class="number">0</span></span><br><span class="line">	y=<span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> k[::-<span class="number">1</span>]:</span><br><span class="line">		x,y=y,x+i*y</span><br><span class="line">	<span class="keyword">return</span> (y,x)</span><br><span class="line">data=transform(e,n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(data)+<span class="number">1</span>):</span><br><span class="line">	data1=data[:x]</span><br><span class="line">	d = sub_fraction(data1)[<span class="number">1</span>]</span><br><span class="line">	m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">	flag = long_to_bytes(m)</span><br><span class="line">	<span class="keyword">if</span> <span class="string">b&#x27;flag&#123;&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">		<span class="built_in">print</span>(flag)</span><br><span class="line">		<span class="keyword">break</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>å˜ç§1</strong>ï¼š$\cfrac{N_1}{N_2}&lt;\cfrac{q_1}{q_2}&lt;1$</p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44110537/article/details/108560055">2020å¹´ç¾ŠåŸæ¯ - RRRRRRRSA</a></p><p>Paper: <a target="_blank" rel="noopener" href="https://eprint.iacr.org/2015/399.pdf">https://eprint.iacr.org/2015/399.pdf</a></p><p>å°è¯•å¯¹ $\cfrac{N_1}{N_2}$ è¿›è¡Œè¿åˆ†æ•°å±•å¼€å¹¶æ±‚å…¶å„é¡¹æ¸è¿›åˆ†æ•°ï¼Œè®°ä¸º $\cfrac{t_i}{s_i}$ å¹¶éªŒè¯ $N_1\% {t_k}==0$ æ˜¯å¦æˆç«‹ï¼Œå¦‚æœæˆç«‹ï¼Œé‚£ä¹ˆ $q_1=t_kï¼Œq_2=s_k$ã€‚</p><p><strong>è¿åˆ†æ•°é€¼è¿‘</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">x,y</span>):	   <span class="comment">#ä½¿ç”¨è¾—è½¬ç›¸é™¤å°†åˆ†æ•°x/yè½¬ä¸ºè¿åˆ†æ•°çš„å½¢å¼</span></span><br><span class="line">	res=[]</span><br><span class="line">	<span class="keyword">while</span> y:</span><br><span class="line">		res.append(x//y)</span><br><span class="line">		x,y=y,x%y</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continued_fraction</span>(<span class="params">sub_res</span>):</span><br><span class="line">	numerator,denominator=<span class="number">1</span>,<span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> sub_res[::-<span class="number">1</span>]:	  <span class="comment">#ä»sublistçš„åé¢å¾€å‰å¾ªç¯</span></span><br><span class="line">		denominator,numerator=numerator,i*numerator+denominator</span><br><span class="line">	<span class="keyword">return</span> denominator,numerator   <span class="comment">#å¾—åˆ°æ¸è¿›åˆ†æ•°çš„åˆ†æ¯å’Œåˆ†å­ï¼Œå¹¶è¿”å›</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#æ±‚è§£æ¯ä¸ªæ¸è¿›åˆ†æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_fraction</span>(<span class="params">x,y</span>):</span><br><span class="line">	res=transform(x,y)</span><br><span class="line">	res=<span class="built_in">list</span>(<span class="built_in">map</span>(continued_fraction,(res[<span class="number">0</span>:i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(res)))))  <span class="comment">#å°†è¿åˆ†æ•°çš„ç»“æœé€ä¸€æˆªå–ä»¥æ±‚æ¸è¿›åˆ†æ•°</span></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wienerAttack</span>(<span class="params">n1,n2</span>):</span><br><span class="line">	<span class="keyword">for</span> (q2,q1) <span class="keyword">in</span> sub_fraction(n1,n2):  <span class="comment">#ç”¨ä¸€ä¸ªforå¾ªç¯æ¥æ³¨æ„è¯•æ¢n1/n2çš„è¿ç»­å‡½æ•°çš„æ¸è¿›åˆ†æ•°ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æ¸è¿›åˆ†æ•°</span></span><br><span class="line">		<span class="keyword">if</span> q1==<span class="number">0</span>:					 <span class="comment">#å¯èƒ½ä¼šå‡ºç°è¿åˆ†æ•°çš„ç¬¬ä¸€ä¸ªä¸º0çš„æƒ…å†µï¼Œæ’é™¤</span></span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">if</span> n1%q1==<span class="number">0</span> <span class="keyword">and</span> q1!=<span class="number">1</span>:			 <span class="comment">#æˆç«‹æ¡ä»¶</span></span><br><span class="line">			<span class="keyword">return</span> (q1,q2)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;è¯¥æ–¹æ³•ä¸é€‚ç”¨&quot;</span>)</span><br><span class="line"> </span><br><span class="line">N1=</span><br><span class="line">N2=</span><br><span class="line"><span class="built_in">print</span>(wienerAttack(N1,N2))</span><br></pre></td></tr></table></figure></li><li><p><strong>å˜ç§2ï¼š</strong>$Ax \equiv y \pmod P$ï¼Œå³ $Ax-kP=y$ æˆ– $Ax+kP=y$</p><p><strong>Wienerâ€™s</strong>ï¼š</p><p>$\Big\vert \cfrac{A}{P}-\cfrac{k}{x}\Big\vert \le \cfrac{1}{2x^2}$ï¼Œè¿åˆ†æ•°æ–¹æ³•ï¼Œç”¨ $\cfrac{A}{P}$ é€¼è¿‘æ±‚å‡º $\cfrac{k}{x}$ï¼Œè¿›è€Œè§£å‡º $y$ã€‚</p><p><strong>Lattice</strong>ï¼š</p><p>$(x,k)\begin{bmatrix}1&amp;A\\0&amp;P\ \end{bmatrix} = (x,y)$ï¼Œè®°ä¸º $vM=w$ï¼Œ$w$ æœ‰å¾ˆå¤§æ¦‚ç‡ä¸º $M$ é‡Œçš„æœ€çŸ­å‘é‡ï¼Œä½¿ç”¨LLLç®—æ³•æ±‚å‡ºæœ€çŸ­å‘é‡ï¼Œå³è§£å‡º $wâ€™=(x,y)$ã€‚</p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://tover.xyz/p/wieners-lattices-equations/">Wienerâ€™s v.s Lattices â€”â€” Axâ‰¡y(mod P)çš„æ–¹ç¨‹è§£æ³•ç¬”è®°</a></p></li><li><p><strong>å˜ç§3ï¼š</strong>$N=p^2q$ï¼Œ$q \lt p \lt2q$ï¼Œ$d=N^\beta$</p><p>å¯ç”¨ $\cfrac{e}{N-(2N^\frac{2}{3}-N^\frac{1}{3})}$ é€¼è¿‘ $\cfrac{k}{d}$ã€‚</p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://iopscience.iop.org/article/10.1088/1742-6596/622/1/012019/pdf">New Attacks on RSA with Modulus N = p^2q Using Continued Fractions</a></p></li></ul><p>â€‹</p><h4 id="ä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»ï¼ˆHastadæ”»å‡»ï¼‰"><a href="#ä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»ï¼ˆHastadæ”»å‡»ï¼‰" class="headerlink" title="ä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»ï¼ˆHastadæ”»å‡»ï¼‰"></a>ä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»ï¼ˆHastadæ”»å‡»ï¼‰</h4><p><strong>é€‚ç”¨æƒ…å†µï¼š $n,c$ ä¸åŒï¼Œ$m,e$ ç›¸åŒã€‚ä¸€èˆ¬ä¼šæ˜¯ $e=k$ï¼Œç„¶åç»™ $k$ ç»„æ•°æ®ã€‚</strong></p><p>å¦‚æœä¸€ä¸ªç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ªåŠ å¯†æŒ‡æ•° e åŠ å¯†äº†åŒä¸€ä¸ªå¯†æ–‡ï¼Œå¹¶å‘é€ç»™äº†å…¶ä»– e ä¸ªç”¨æˆ·ã€‚é‚£ä¹ˆå°±ä¼šäº§ç”Ÿå¹¿æ’­æ”»å‡»ã€‚è¿™ä¸€æ”»å‡»ç”± HÃ¥stad æå‡ºã€‚</p><p>ä½¿ç”¨ä¸åŒçš„æ¨¡æ•° $n$ï¼Œç›¸åŒçš„å…¬é’¥æŒ‡æ•° $e$ åŠ å¯†ç›¸åŒçš„ä¿¡æ¯ï¼Œå°±ä¼šå¾—åˆ°å¤šä¸ª $m^e \equiv c_i \pmod {n_i}$ï¼Œå°† $m^e$ è§†ä¸ºä¸€ä¸ªæ•´ä½“ $M$ï¼Œè¿™å°±æ˜¯å…¸å‹çš„<strong>ä¸­å›½å‰©ä½™å®šç†</strong>é€‚ç”¨æƒ…å†µã€‚å®¹æ˜“æ±‚å¾— $m^e$ çš„å€¼ï¼Œå½“ $e$ è¾ƒå°æ—¶ç›´æ¥å¼€ $e$ æ–¹å³å¯ï¼Œå¯ä½¿ç”¨<code>gmpy2.iroot(M,e)</code> æ–¹æ³•ã€‚</p><p>æ›´ä¸€èˆ¬æƒ…å†µï¼ˆ$k$ ç»„æ•°æ®çš„ $N$ ä¸åŒï¼‰è§15ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chinese_remainder</span>(<span class="params">modulus, remainders</span>):</span><br><span class="line"> Sum = <span class="number">0</span></span><br><span class="line">    prod = reduce(<span class="keyword">lambda</span> a, b: a*b, modulus)</span><br><span class="line"> <span class="keyword">for</span> m_i, r_i <span class="keyword">in</span> <span class="built_in">zip</span>(modulus, remainders):</span><br><span class="line">        p = prod // m_i</span><br><span class="line">     Sum += r_i * (inverse_mod(p,m_i)*p)</span><br><span class="line">    <span class="keyword">return</span> Sum % prod</span><br><span class="line">chinese_remainder([<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>],[<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>]) <span class="comment">#23</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage</span></span><br><span class="line">crt([<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>])</span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="å…±æ¨¡æ”»å‡»ï¼ˆn-mç›¸åŒï¼Œc-eä¸åŒï¼‰"><a href="#å…±æ¨¡æ”»å‡»ï¼ˆn-mç›¸åŒï¼Œc-eä¸åŒï¼‰" class="headerlink" title="å…±æ¨¡æ”»å‡»ï¼ˆn,mç›¸åŒï¼Œc,eä¸åŒï¼‰"></a>å…±æ¨¡æ”»å‡»ï¼ˆn,mç›¸åŒï¼Œc,eä¸åŒï¼‰</h4><p>å½“$n$ä¸å˜çš„æƒ…å†µä¸‹ï¼ŒçŸ¥é“$n,e_1,e_2,c_1,c_2$å¯ä»¥åœ¨ä¸çŸ¥é“$d_1,d_2$çš„æƒ…å†µä¸‹ï¼Œè§£å‡º$m$ã€‚</p><p>é¦–å…ˆå‡è®¾$e_1,e_2$äº’è´¨,</p><p>å³ $\gcd(e_1,e_2)=1$</p><p>æ­¤æ—¶åˆ™æœ‰ $e_1s_1+e_2s_2 = 1$</p><p>å¼ä¸­ï¼Œ$s_1,s_2$çš†ä¸ºæ•´æ•°ï¼Œä½†æ˜¯ä¸€æ­£ä¸€è´Ÿã€‚</p><p>é€šè¿‡æ‰©å±•æ¬§å‡ é‡Œå¾·ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¯¥å¼å­çš„ä¸€ç»„è§£$ï¼ˆs_1,s_2ï¼‰$ï¼Œå‡è®¾$s_1$ä¸ºæ­£æ•°,$s_2$ä¸ºè´Ÿæ•°ã€‚</p><p>å› ä¸º $c_1 = m^{e_1}\bmod n, c_2 = m^{e_2}\bmod n$</p><p>æ‰€ä»¥ $(c_1^{s_1}c_2^{s_2})\bmod n = ((m^{e_1}\bmod n)^{s_1}(m^{e_2}\bmod n)^{s_2})\bmod n$</p><p>æ ¹æ®æ¨¡è¿ç®—æ€§è´¨ï¼Œå¯ä»¥åŒ–ç®€ä¸º $(c_1^{s_1}c_2^{s_2})\bmod n = ((m^{e_1})^{s_1}(m^{e_2})^{s_2})\bmod n$</p><p>å³ $(c_1^{s_1}c_2^{s_2})\bmod n = (m^{e_1s_1+e_2s_2})\bmod n$</p><p>åˆå‰é¢æåˆ° $e_1s_1+e_2s_2 = 1$</p><p>æ‰€ä»¥ $(c_1^{s_1}c_2^{s_2})\bmod n = m\bmod n$</p><p>å³ $c_1^{s_1}c_2^{s_2}= m$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">	<span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		g, y, x = egcd(b % a, a)</span><br><span class="line">		<span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line">n = </span><br><span class="line">c1 = </span><br><span class="line">c2 = </span><br><span class="line">e1 = </span><br><span class="line">e2 = </span><br><span class="line">s = egcd(e1, e2)</span><br><span class="line">s1 = s[<span class="number">1</span>]</span><br><span class="line">s2 = s[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">	s1 = - s1</span><br><span class="line">	c1 = gp.invert(c1, n)</span><br><span class="line"><span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">	s2 = - s2</span><br><span class="line">	c2 = gp.invert(c2, n)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c1,s1,n)*<span class="built_in">pow</span>(c2,s2,n) % n</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="e-mç›¸åŒï¼Œå¤šä¸ªnä¸­å­˜åœ¨ä¸¤ä¸ªnæœ‰GCDï¼ˆæ¨¡ä¸äº’ç´ ï¼‰"><a href="#e-mç›¸åŒï¼Œå¤šä¸ªnä¸­å­˜åœ¨ä¸¤ä¸ªnæœ‰GCDï¼ˆæ¨¡ä¸äº’ç´ ï¼‰" class="headerlink" title="e,mç›¸åŒï¼Œå¤šä¸ªnä¸­å­˜åœ¨ä¸¤ä¸ªnæœ‰GCDï¼ˆæ¨¡ä¸äº’ç´ ï¼‰"></a>e,mç›¸åŒï¼Œå¤šä¸ªnä¸­å­˜åœ¨ä¸¤ä¸ªnæœ‰GCDï¼ˆæ¨¡ä¸äº’ç´ ï¼‰</h4><p><strong>é€‚ç”¨æƒ…å†µï¼šå­˜åœ¨ä¸¤ä¸ªæˆ–æ›´å¤šæ¨¡æ•° ï¼Œä¸” $\gcd(n_1,n_2)\ne 1$ ã€‚</strong></p><p>å¤šä¸ªæ¨¡æ•° $n$ å…±ç”¨è´¨æ•°ï¼Œåˆ™å¯ä»¥å¾ˆå®¹æ˜“åˆ©ç”¨æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚å¾—ä»–ä»¬çš„è´¨å› æ•°ä¹‹ä¸€ $\gcd(n_1,n_2)$ï¼Œç„¶åè¿™ä¸ªæœ€å¤§å…¬çº¦æ•°å¯ç”¨äºåˆ†è§£æ¨¡æ•°åˆ†åˆ«å¾—åˆ°å¯¹åº”çš„ $p$ å’Œ $q$ï¼Œå³å¯è¿›è¡Œè§£å¯†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"></span><br><span class="line">n=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> n:</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> n:</span><br><span class="line">		<span class="keyword">if</span> (i&lt;&gt;j):</span><br><span class="line">			pub_p=gp.gcdext(i,j)</span><br><span class="line">			<span class="keyword">if</span> (pub_p[<span class="number">0</span>]&lt;&gt;<span class="number">1</span>)&amp;(i&gt;j):</span><br><span class="line">				<span class="built_in">print</span>(i)</span><br><span class="line">				<span class="built_in">print</span>(j)</span><br><span class="line">				<span class="built_in">print</span>(pub_p[<span class="number">0</span>])</span><br><span class="line">				a=i,p=pub_p[<span class="number">0</span>]</span><br><span class="line">q=a//p</span><br><span class="line">p =</span><br><span class="line">q =</span><br><span class="line">e =</span><br><span class="line">c =</span><br><span class="line">n = p*q</span><br><span class="line">phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line">d = gp.invert(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="RabinåŠ å¯†"><a href="#RabinåŠ å¯†" class="headerlink" title="RabinåŠ å¯†"></a>RabinåŠ å¯†</h4><p><strong>é€‚ç”¨æƒ…å†µï¼š$e=2$ ã€‚</strong></p><p>ä¸€èˆ¬å…ˆé€šè¿‡å…¶ä»–æ–¹æ³•åˆ†è§£å¾—åˆ° $p,q$ï¼Œç„¶åè§£å¯†ã€‚</p><p>å‡½æ•°è¿”å›å››ä¸ªæ•°ï¼Œè¿™å…¶ä¸­åªæœ‰ä¸€ä¸ªæ˜¯æˆ‘ä»¬æƒ³è¦çš„æ˜æ–‡ï¼Œéœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼éªŒè¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rabin_decrypt</span>(<span class="params">c, p, q, e=<span class="number">2</span></span>):</span><br><span class="line">	n = p * q</span><br><span class="line">	mp = <span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">	mq = <span class="built_in">pow</span>(c, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line">	yp = gmpy2.invert(p, q)</span><br><span class="line">	yq = gmpy2.invert(q, p)</span><br><span class="line">	r = (yp * p * mq + yq * q * mp) % n</span><br><span class="line">	rr = n - r</span><br><span class="line">	s = (yp * p * mq - yq * q * mp) % n</span><br><span class="line">	ss = n - s</span><br><span class="line">	<span class="keyword">return</span> (r, rr, s, ss)</span><br><span class="line"> </span><br><span class="line">c = </span><br><span class="line">p = </span><br><span class="line">q = </span><br><span class="line">m = rabin_decrypt(c,p,q)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m[i])[<span class="number">2</span>:]))</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		<span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="Boneh-and-Durfee-attack"><a href="#Boneh-and-Durfee-attack" class="headerlink" title="Boneh and Durfee attack"></a>Boneh and Durfee attack</h4><p>$e$ éå¸¸å¤§æ¥è¿‘äº$N$ï¼Œå³ $d$ è¾ƒå°æ—¶ã€‚ä¸ä½è§£å¯†æŒ‡æ•°æ”»å‡»ç±»ä¼¼ï¼Œæ¯”ä½è§£å¯†æŒ‡æ•°æ”»å‡»ï¼ˆWiener Attackï¼‰æ›´å¼ºï¼Œå¯ä»¥è§£å†³$\cfrac{1}{3}N^{\frac{1}{4}} \leq d \leq N^{0.292}$çš„é—®é¢˜ã€‚</p><p>$\because ed=k \varphi +1$</p><p>$\therefore k \varphi+1 \equiv 0 \pmod e \Rightarrow k(N+1-p-q)+1 \equiv 0 \pmod e \Rightarrow 2k(\frac{N+1}{2}+\frac{-p-q}{2}) \equiv 0 \pmod e$</p><p>è®¾ $A=\frac{N+1}{2},y=\frac{-p-q}{2},x=2k$ï¼Œæœ‰ $f(k,y)=1+x\cdot(A+y)$</p><p>å¦‚æœåœ¨æ¨¡ $e$ ä¸‹è§£å¾—è¯¥æ–¹ç¨‹çš„æ ¹ $x,y$ï¼Œç”± $ed=1+x\cdot(A+y)$ å¯ä»¥å¾—åˆ° $d$ã€‚</p><p>å‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage">RSA-and-LLL-attacks</a>ã€‚</p><ul><li><p><strong>å˜ç§1</strong>ï¼š$e$ å¾ˆå¤§ï¼Œ$dp$ å¾ˆå°ï¼Œä¸” $d&gt;2N^{\beta}$ã€‚</p><p><strong>Mayâ€™s Attack</strong></p><p>å‡è®¾ $e&lt;\varphi(N),q \le N^{\beta},\beta \le \frac{1}{2}$ï¼Œå›  $ed_p \equiv 1 \pmod {p-1}$ï¼Œæœ‰ $ed_p=1+k(p-1)$ï¼Œ</p><p>å¯¹äº $k \in \mathbb{N}$ï¼Œæœ‰ $ed_p=(k-1)(p-1)+p$ï¼Œå³ $ed_pq=(k-1)(N-q)+N$ã€‚</p><p>è®¾ $x,y$ ä¸ºå‚æ•°ï¼Œåˆ™å¤šé¡¹å¼ $f(x,y)=x(N-y)+N$ åœ¨æ¨¡ $e$ ä¸‹å­˜åœ¨æ ¹ $(x_0,y_0)=(k-1,q)$ï¼Œç”¨coppersmith attackå¯è§£ã€‚</p></li></ul><p>â€‹</p><h4 id="å…‰æ»‘æ•°"><a href="#å…‰æ»‘æ•°" class="headerlink" title="å…‰æ»‘æ•°"></a>å…‰æ»‘æ•°</h4><h5 id="p-1-å…‰æ»‘"><a href="#p-1-å…‰æ»‘" class="headerlink" title="p-1 å…‰æ»‘"></a>p-1 å…‰æ»‘</h5><p><strong>Pollardâ€™s p-1</strong>åˆ†è§£ç®—æ³•ã€‚</p><p>å¦‚æœä¸€ä¸ªæ•´æ•°çš„æ‰€æœ‰ç´ å› å­éƒ½ä¸å¤§äº $B$ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ•°ä¸º $B$-Smooth æ•°ã€‚</p><p>è®¾ $p-1$ æ˜¯ $B$-Smooth çš„ï¼Œå¯è®¾ $p-1=p_1p_2 \cdots p_n(\forall 1 \leq i \leq n,p_i \leq B)$ï¼Œ</p><p>è‹¥ $p_1,p_2, \cdots ,p_n$ ä¸¤ä¸¤ä¸åŒï¼Œåˆ™ $p_1p_2 \cdots p_n \mid B! \Rightarrow (p-1) \mid B! \Rightarrow B!=k(p-1)$ã€‚</p><p>å› æ­¤ $a^{B!} \equiv a^{k(p-1)} \equiv 1 \pmod p$ï¼Œå‡è®¾ $N=pq$ï¼Œè®¡ç®— $\gcd(a^{B!}-1ï¼ŒN)$ï¼Œåªè¦ç»“æœå¤§äº $0$ å°äº $N$ï¼Œé‚£ä¹ˆç»“æœå°±ä¸º $p$ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">a = <span class="number">2</span></span><br><span class="line">k = <span class="number">2</span></span><br><span class="line">N = </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    a = powmod(a, k, N)</span><br><span class="line">    res = gcd(a-<span class="number">1</span>, N)</span><br><span class="line">    <span class="keyword">if</span> res != <span class="number">1</span> <span class="keyword">and</span> res != N:</span><br><span class="line">        q = N // res</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>,res)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;q =&quot;</span>,q)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    k += <span class="number">1</span></span><br></pre></td></tr></table></figure><h5 id="p-1-å…‰æ»‘-1"><a href="#p-1-å…‰æ»‘-1" class="headerlink" title="p+1 å…‰æ»‘"></a>p+1 å…‰æ»‘</h5><p><strong>Williamâ€™s p+1</strong>åˆ†è§£ç®—æ³•ã€‚</p><p><img src="/2020/05/06/crypto-RSA/562d20d869954a56996e61739a25893e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mlucas</span>(<span class="params">v, a, n</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Helper function for williams_pp1().  Multiplies along a Lucas sequence modulo n. &quot;&quot;&quot;</span></span><br><span class="line">    v1, v2 = v, (v**<span class="number">2</span> - <span class="number">2</span>) % n</span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">bin</span>(a)[<span class="number">3</span>:]: </span><br><span class="line">        v1, v2 = ((v1**<span class="number">2</span> - <span class="number">2</span>) % n, (v1*v2 - v) % n) <span class="keyword">if</span> bit == <span class="string">&quot;0&quot;</span> <span class="keyword">else</span> ((v1*v2 - v) % n, (v2**<span class="number">2</span> - <span class="number">2</span>) % n)</span><br><span class="line">    <span class="keyword">return</span> v1</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> count(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> primegen():</span><br><span class="line">        e = ilog(isqrt(n), p)</span><br><span class="line">        <span class="keyword">if</span> e == <span class="number">0</span>: </span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(e): </span><br><span class="line">            v = mlucas(v, p, n)</span><br><span class="line">        g = gcd(v-<span class="number">2</span>, n)</span><br><span class="line">        <span class="keyword">if</span> <span class="number">1</span> &lt; g &lt; n: </span><br><span class="line">            <span class="keyword">return</span> g <span class="comment"># g|n</span></span><br><span class="line">        <span class="keyword">if</span> g == n: </span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>â€‹</p><blockquote><p>Coppersmithå®šç†æŒ‡å‡ºåœ¨ä¸€ä¸ª $e$ é˜¶çš„ $\bmod n$ å¤šé¡¹å¼ $f(x)$ ä¸­ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ ¹å°äº $n^{\frac{1}{e}}$ï¼Œå°±å¯ä»¥è¿ç”¨ä¸€ä¸ª $O(\log n)$ çš„ç®—æ³•æ±‚å‡ºè¿™äº›æ ¹ã€‚</p></blockquote><h4 id="Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥pçš„é«˜ä½æ”»å‡»ï¼‰"><a href="#Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥pçš„é«˜ä½æ”»å‡»ï¼‰" class="headerlink" title="Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥pçš„é«˜ä½æ”»å‡»ï¼‰"></a>Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥pçš„é«˜ä½æ”»å‡»ï¼‰</h4><p>çŸ¥é“ $p$ çš„é«˜ä½ä¸º $p$ çš„ä½æ•°çš„çº¦$\frac12$æ—¶å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line">n = </span><br><span class="line">p4 =  <span class="comment">#på»0çš„å‰©ä½™ä½</span></span><br><span class="line">pbits = <span class="number">1024</span></span><br><span class="line">kbits = pbits - p4.nbits()</span><br><span class="line"><span class="built_in">print</span>(p4.nbits())</span><br><span class="line">p4 = p4 &lt;&lt; kbits</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = x + p4</span><br><span class="line">roots = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)</span><br><span class="line"><span class="keyword">if</span> roots:        </span><br><span class="line">    p = p4 + <span class="built_in">int</span>(roots[<span class="number">0</span>])</span><br><span class="line">    q = n//p</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;n: <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;p: <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;q: <span class="subst">&#123;q&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥mçš„é«˜ä½æ”»å‡»ï¼‰"><a href="#Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥mçš„é«˜ä½æ”»å‡»ï¼‰" class="headerlink" title="Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥mçš„é«˜ä½æ”»å‡»ï¼‰"></a>Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥mçš„é«˜ä½æ”»å‡»ï¼‰</h4><p>è¿™é‡Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬é¦–å…ˆåŠ å¯†äº†æ¶ˆæ¯ $m$ï¼Œå¦‚ä¸‹</p><p>$C\equiv m^e \bmod N$</p><p>å¹¶ä¸”æˆ‘ä»¬å‡è®¾æˆ‘ä»¬çŸ¥é“æ¶ˆæ¯ $m$ çš„å¾ˆå¤§çš„ä¸€éƒ¨åˆ† $m_0$ï¼Œå³ $m=m_0+x$ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“ $x$ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±æœ‰å¯èƒ½é€šè¿‡è¯¥æ–¹æ³•è¿›è¡Œæ¢å¤æ¶ˆæ¯ã€‚è¿™é‡Œæˆ‘ä»¬ä¸çŸ¥é“çš„ $x$ å…¶å®å°±æ˜¯å¤šé¡¹å¼çš„æ ¹ï¼Œéœ€è¦æ»¡è¶³ Coppersmith çš„çº¦æŸã€‚</p><p>å¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/mimoo/RSA-and-LLL-attacks">https://github.com/mimoo/RSA-and-LLL-attacks</a> ã€‚</p><p>$e$ è¶³å¤Ÿå°ï¼Œä¸”éƒ¨åˆ†æ˜æ–‡æ³„éœ²æ—¶ï¼Œå¯ä»¥é‡‡ç”¨Coppersmithå•å˜é‡æ¨¡ç­‰å¼çš„æ”»å‡»ï¼Œå¦‚ä¸‹ï¼š</p><p>$c=m^{e}\bmod n=(mbar+x_{0})^{e}\bmod n$ï¼Œå…¶ä¸­ $mbar = (m &gt;&gt; k\text{bits}) &lt;&lt; k\text{bits}$</p><p>å½“ $\vert x_{0}\vert\leq N^{\frac{1}{e}}$ æ—¶ï¼Œå¯ä»¥åœ¨ $\log N$ å’Œ $e$ çš„å¤šé¡¹å¼æ—¶é—´å†…æ±‚å‡º $x_0$ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line">n = </span><br><span class="line">e = </span><br><span class="line">c = </span><br><span class="line">mbar = </span><br><span class="line">kbits = </span><br><span class="line">beta = <span class="number">1</span></span><br><span class="line">nbits = n.nbits()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;upper &#123;&#125; bits of &#123;&#125; bits is given&quot;</span>.<span class="built_in">format</span>(nbits - kbits, nbits))</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (mbar + x)^e - c</span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">1</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor = n</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;m:&quot;</span>, mbar + x0)</span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥dçš„ä½ä½æ”»å‡»ï¼‰"><a href="#Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥dçš„ä½ä½æ”»å‡»ï¼‰" class="headerlink" title="Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥dçš„ä½ä½æ”»å‡»ï¼‰"></a>Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥dçš„ä½ä½æ”»å‡»ï¼‰</h4><p>å¦‚æœçŸ¥é“ $d$ çš„ä½ä½ï¼Œä½ä½çº¦ä¸º $n$ çš„ä½æ•°çš„ $\frac14$ ï¼ˆ$\frac{n.n\text{bits}()}{4}$ï¼‰å°±å¯ä»¥æ¢å¤ $d$ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">partial_p</span>(<span class="params">p0, kbits, n</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    nbits = n.nbits()</span><br><span class="line">    f = <span class="number">2</span>^kbits*x + p0</span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^(nbits//<span class="number">2</span>-kbits), beta=<span class="number">0.4</span>)  <span class="comment"># find root &lt; 2^(nbits//2-kbits) with factor &gt;= n^0.4</span></span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        x0 = roots[<span class="number">0</span>]</span><br><span class="line">        p = gcd(<span class="number">2</span>^kbits*x0 + p0, n)</span><br><span class="line">        <span class="keyword">return</span> ZZ(p)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_p</span>(<span class="params">d0, kbits, e, n</span>):</span><br><span class="line">    X = var(<span class="string">&#x27;X&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e+<span class="number">1</span>):</span><br><span class="line">        results = solve_mod([e*d0*X - k*X*(n-X+<span class="number">1</span>) + k*n == X], <span class="number">2</span>^kbits)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> results:</span><br><span class="line">            p0 = ZZ(x[<span class="number">0</span>])</span><br><span class="line">            p = partial_p(p0, kbits, n)</span><br><span class="line">            <span class="keyword">if</span> p <span class="keyword">and</span> p != <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> p</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n = </span><br><span class="line">    e = </span><br><span class="line">    c = </span><br><span class="line">    d0 = </span><br><span class="line">    beta = <span class="number">0.5</span></span><br><span class="line">    nbits = n.nbits()</span><br><span class="line">    kbits = d0.nbits()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;lower %d bits (of %d bits) is given&quot;</span> % (kbits, nbits))</span><br><span class="line">    p = <span class="built_in">int</span>(find_p(d0, kbits, e, n))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;found p: %d&quot;</span> % p)</span><br><span class="line">    q = n//<span class="built_in">int</span>(p)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;d:&quot;</span>, inverse_mod(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)))</span><br></pre></td></tr></table></figure><ul><li><p><strong>å˜ç§1</strong>ï¼š$n=p\cdot q\cdot r$ï¼Œå·²çŸ¥ $n,p,d=\text{inv}(e,\varphi(n)),e,c$</p><p>$k(p-1)\rightarrow kâ€™,qr\rightarrow nâ€™,q+r\rightarrow s$</p><p>$ed_{0}\equiv 1+kâ€™(nâ€™-s+1) \pmod {2^{d_{0}.n\text{bits}()}}\quad (1)$</p><p>$q^{2}-sq+nâ€™\equiv 0 \pmod {2^{d_{0}.n\text{bits}()}}\quad (2)$</p><p>è”ç«‹å¯å¾—ï¼Œ$(ed_{0}-1-kâ€™nâ€™-kâ€™)q+kâ€™q^{2}+kâ€™nâ€™\equiv 0 \pmod {2^{d_{0}.n\text{bits}()}}$</p><p>å³æ±‚è§£åŒä½™æ–¹ç¨‹å¯å¾— $q$ çš„ä½ $size(d0)$ ä½ï¼Œæœ¬æ¥æ˜¯ä¸ªpartial dçš„coppersmithé—®é¢˜ï¼Œä½†å› ä¸ºstep1æ±‚è§£åŒä½™æ–¹ç¨‹åå¾—åˆ°çš„ $q$ å·²æ˜¯å®Œæ•´çš„ $q$ï¼Œæ‰€ä»¥æ— éœ€åç»­çš„coppersmithã€‚</p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/188838">Dragon CTF 2019 - RSA Chained</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_p</span>(<span class="params">d0, kbits, e, n, p</span>):</span><br><span class="line">    X = var(<span class="string">&#x27;X&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e + <span class="number">1</span>):</span><br><span class="line">        k_dot = k * (p - <span class="number">1</span>)</span><br><span class="line">        results = solve_mod([e * d0 * X - k_dot * X * (n - X + <span class="number">1</span>) + k_dot * n == X], <span class="number">2</span>^kbits)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> results:</span><br><span class="line">            q = ZZ(x[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">if</span> n % q == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> q</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">n = ... <span class="comment"># q * r</span></span><br><span class="line">p = </span><br><span class="line">c = </span><br><span class="line">d0 = </span><br><span class="line">e = </span><br><span class="line">kbits = d0.nbits()</span><br><span class="line">q = find_p(d0, kbits, e, n, p)</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>) * (n // q - <span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e, phi)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="built_in">pow</span>(c, d, p * n))[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure></li></ul><p>â€‹</p><h4 id="Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥Nä¸€ä¸ªå› å­çš„é«˜ä½ï¼Œéƒ¨åˆ†pï¼‰"><a href="#Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥Nä¸€ä¸ªå› å­çš„é«˜ä½ï¼Œéƒ¨åˆ†pï¼‰" class="headerlink" title="Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥Nä¸€ä¸ªå› å­çš„é«˜ä½ï¼Œéƒ¨åˆ†pï¼‰"></a>Coppersmithæ”»å‡»ï¼ˆå·²çŸ¥Nä¸€ä¸ªå› å­çš„é«˜ä½ï¼Œéƒ¨åˆ†pï¼‰</h4><p>å½“æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªå…¬é’¥ä¸­æ¨¡æ•° $N$ çš„ä¸€ä¸ªå› å­çš„è¾ƒé«˜ä½æ—¶ï¼Œæˆ‘ä»¬å°±æœ‰ä¸€å®šå‡ ç‡æ¥åˆ†è§£ $N$ã€‚</p><p>å‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/mimoo/RSA-and-LLL-attacks">https://github.com/mimoo/RSA-and-LLL-attacks</a> ã€‚</p><p>å…³æ³¨ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">beta = <span class="number">0.5</span></span><br><span class="line">dd = f.degree()</span><br><span class="line">epsilon = beta / <span class="number">7</span></span><br><span class="line">mm = ceil(beta**<span class="number">2</span> / (dd * epsilon))</span><br><span class="line">tt = floor(dd * mm * ((<span class="number">1</span>/beta) - <span class="number">1</span>))</span><br><span class="line">XX = ceil(N**((beta**<span class="number">2</span>/dd) - epsilon)) + <span class="number">1000000000000000000000000000000000</span></span><br><span class="line">roots = coppersmith_howgrave_univariate(f, N, beta, mm, tt, XX)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ</p><ul><li>å¿…é¡»æ»¡è¶³ $q\ge N^{beta}$ï¼Œæ‰€ä»¥è¿™é‡Œç»™å‡ºäº† $beta=0.5$ï¼Œæ˜¾ç„¶ä¸¤ä¸ªå› æ•°ä¸­å¿…ç„¶æœ‰ä¸€ä¸ªæ˜¯å¤§äºçš„ã€‚</li><li>XX æ˜¯ $f(x)=qâ€²+x$ åœ¨æ¨¡ $q$ æ„ä¹‰ä¸‹çš„æ ¹çš„ä¸Šç•Œï¼Œè‡ªç„¶æˆ‘ä»¬å¯ä»¥é€‰æ‹©è°ƒæ•´å®ƒï¼Œè¿™é‡Œå…¶å®ä¹Ÿè¡¨æ˜äº†æˆ‘ä»¬å·²çŸ¥çš„ $qâ€²$ ä¸å› æ•° $q$ ä¹‹é—´å¯èƒ½çš„å·®è·ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line">n = </span><br><span class="line">e = </span><br><span class="line">c = </span><br><span class="line">pbar = </span><br><span class="line">kbits = </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;upper %d bits (of %d bits) is given&quot;</span> % (pbar.nbits()-kbits, pbar.nbits()))</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = x + pbar</span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.4</span></span><br><span class="line">p = x0 + pbar</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p:&quot;</span>, p)</span><br><span class="line">q = n // <span class="built_in">int</span>(p)</span><br><span class="line">d = inverse_mod(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;m:&quot;</span>, <span class="built_in">pow</span>(c, d, n))</span><br></pre></td></tr></table></figure><p>æ³¨ï¼š</p><p>sageçš„small_rootä¼ å‚<code>X</code>ä¸èƒ½è¿‡å¤§ï¼Œéœ€è‡ªè¡Œåˆ¤æ–­é˜ˆå€¼å¹¶è°ƒæ•´ï¼ˆå¦‚æœXè¿‡å¤§ï¼Œå³ä½¿å­˜åœ¨Xå†…çš„è§£ï¼Œä¹Ÿæ— æ³•æ±‚å‡ºï¼‰ï¼›</p><p>æ¯”å¦‚ $p$ çš„ä½ä½æ³„éœ²æ—¶å› ä¸ºä¸ç¡®å®šç¼ºå¤±é«˜ä½çš„å…·ä½“æ¯”ç‰¹æ•°ï¼Œæ‰€ä»¥è¦åœ¨ $2^{\frac{n.n\text{bits}()}{2}âˆ’k\text{bits}}$ é™„è¿‘ä½œXçš„é˜ˆå€¼ä¼°è®¡ï¼›</p><p>æ— æ³•ç¡®å®šæ‹¿åˆ°çš„ $p$ æ˜¯å¦å¤§äº $q$ï¼Œæ‰€ä»¥å¯¹ $\beta=0.5$ è¿›è¡Œè°ƒæ•´è‡³ $0.4$ã€‚</p><p>â€‹</p><h4 id="Coppersmithâ€™s-Short-pad-Attack-amp-Related-Message-Attackï¼ˆFranklin-Reiteræ”»å‡»ï¼‰"><a href="#Coppersmithâ€™s-Short-pad-Attack-amp-Related-Message-Attackï¼ˆFranklin-Reiteræ”»å‡»ï¼‰" class="headerlink" title="Coppersmithâ€™s Short-pad Attack &amp; Related Message Attackï¼ˆFranklin-Reiteræ”»å‡»ï¼‰"></a>Coppersmithâ€™s Short-pad Attack &amp; Related Message Attackï¼ˆFranklin-Reiteræ”»å‡»ï¼‰</h4><p>ç›®å‰åœ¨å¤§éƒ¨åˆ†æ¶ˆæ¯åŠ å¯†ä¹‹å‰éƒ½ä¼šè¿›è¡Œ paddingï¼Œä½†æ˜¯å¦‚æœ padding çš„é•¿åº¦è¿‡çŸ­ï¼ˆ$m \in (0,\lfloor\frac{n.n\text{bits}()}{e^2}\rfloor]$ï¼‰ï¼Œä¹Ÿæœ‰<strong>å¯èƒ½</strong>è¢«å¾ˆå®¹æ˜“åœ°æ”»å‡»ã€‚</p><p>è¿™é‡Œæ‰€è°“ padding è¿‡çŸ­ï¼Œå…¶å®å°±æ˜¯å¯¹åº”çš„å¤šé¡¹å¼çš„æ ¹ä¼šè¿‡å°ã€‚</p><p>å½“ Alice ä½¿ç”¨åŒä¸€å…¬é’¥å¯¹ä¸¤ä¸ªå…·æœ‰æŸç§çº¿æ€§å…³ç³»çš„æ¶ˆæ¯ $M_1$ ä¸ $M_2$ è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å°†åŠ å¯†åçš„æ¶ˆæ¯ $C_1$ï¼Œ$C_2$ å‘é€ç»™äº† Bob æ—¶ï¼Œæˆ‘ä»¬å°±å¯èƒ½å¯ä»¥è·å¾—å¯¹åº”çš„æ¶ˆæ¯ $M_1$ ä¸ $M_2$ ã€‚è¿™é‡Œæˆ‘ä»¬å‡è®¾æ¨¡æ•°ä¸º $N$ï¼Œä¸¤è€…ä¹‹é—´çš„çº¿æ€§å…³ç³»å¦‚ä¸‹ï¼š</p><p>$M_1 \equiv f(M_2) \bmod N$</p><p>å…¶ä¸­ $f$ ä¸ºä¸€ä¸ªçº¿æ€§å‡½æ•°ï¼Œæ¯”å¦‚è¯´ $f=ax+b$ã€‚</p><p>åœ¨å…·æœ‰è¾ƒå°é”™è¯¯æ¦‚ç‡ä¸‹çš„æƒ…å†µä¸‹ï¼Œå…¶å¤æ‚åº¦ä¸º $O(e\log^2N)$ã€‚</p><p>è¿™ä¸€æ”»å‡»ç”± Franklinä¸Reiter æå‡ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è„šæœ¬1</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">c1, c2, n, e</span>):</span><br><span class="line">    PR.&lt;x&gt;=PolynomialRing(Zmod(n))</span><br><span class="line">    <span class="comment"># replace a,b,c,d</span></span><br><span class="line">    g1 = (a*x+b)^e - c1</span><br><span class="line">    g2 = (c*x+d)^e - c2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line">c1 =</span><br><span class="line">c2 =</span><br><span class="line">n =</span><br><span class="line">e =</span><br><span class="line">m1 = attack(c1, c2, n, e)</span><br><span class="line"><span class="built_in">print</span>(binascii.unhexlify(<span class="string">&quot;%x&quot;</span> % <span class="built_in">int</span>(m1)))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è„šæœ¬2</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">short_pad_attack</span>(<span class="params">c1, c2, e, n</span>):</span><br><span class="line">    PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+y)^e - c2</span><br><span class="line">    q1 = g1.change_ring(PRZZ)</span><br><span class="line">    q2 = g2.change_ring(PRZZ)</span><br><span class="line">    h = q2.resultant(q1)</span><br><span class="line">    h = h.univariate_polynomial()</span><br><span class="line">    h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">    h = h.monic()</span><br><span class="line">    kbits = n.nbits()//(<span class="number">2</span>*e*e)</span><br><span class="line">    diff = h.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.4</span></span><br><span class="line">    <span class="keyword">return</span> diff</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">related_message_attack</span>(<span class="params">c1, c2, diff, e, n</span>):</span><br><span class="line">    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+diff)^e - c2</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n = </span><br><span class="line">    e = </span><br><span class="line">    c1 =</span><br><span class="line">    c2 = </span><br><span class="line">    diff = short_pad_attack(c1, c2, e, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;difference of two messages is %d&quot;</span> % diff)</span><br><span class="line">    m1 = related_message_attack(c1, c2, diff, e, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;m1:&quot;</span>, m1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;m2:&quot;</span>, m1 + diff)</span><br></pre></td></tr></table></figure><ul><li><p><strong>å˜ç§1ï¼š</strong> $c_i=(a_im+b_i)^e \pmod {n_i}$</p><p>ç”¨CRTè®¡ç®—ç³»æ•° $T_i$ ä½¿å¾— $T_i \equiv 1 \pmod{n_i},T_i \equiv 0 \pmod{n_{j \neq i}}$ï¼Œ</p><p>åˆ™å¯å»ºç«‹å¤šé¡¹å¼ä¸º $f(x) = \sum_{i} T_i [ (a_i x + b_i)^e - c_i]$ï¼Œç¬¦åˆ $f(m) \equiv 0 \pmod{n_i}$ï¼Œ</p><p>æ•… $m$ æ˜¯ $f(m) \equiv 0 \pmod N$ çš„ä¸€ä¸ªæ ¹ï¼Œå…¶ä¸­ $N= \prod_i n_i$ã€‚</p><p>å¦‚æœ $m &lt; \left (\prod_i n_i \right)^{1/e} = M^{1/\deg{f(x)}}$ï¼Œå¯ä»¥ä½¿ç”¨coppersmithæ‰¾å‡º $m$ã€‚</p><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://blog.maple3142.net/2022/06/03/securityfest-ctf-2022-writeups/#really_sick_%C3%A6sthetic">Security Fest 2022 - really_sick_Ã¦sthetic</a></p><p><a target="_blank" rel="noopener" href="https://fortenf.org/e/ctfs/crypto/2017/04/23/plaidctf-2017-multicast.html">PlaidCTF 2017 - Multicast</a></p><p><a target="_blank" rel="noopener" href="https://blog.maple3142.net/2021/08/29/cakectf-2021-writeups/#party-ticket">CakeCTF 2021 - Party Ticket</a></p></li></ul><p>â€‹</p><h4 id="RSA-Hastad-Attack-with-non-linear-padding-and-different-public-keysï¼ˆå¸¦éçº¿æ€§paddingå’Œä¸åŒå…¬é’¥çš„å¹¿æ’­æ”»å‡»ï¼‰"><a href="#RSA-Hastad-Attack-with-non-linear-padding-and-different-public-keysï¼ˆå¸¦éçº¿æ€§paddingå’Œä¸åŒå…¬é’¥çš„å¹¿æ’­æ”»å‡»ï¼‰" class="headerlink" title="RSA Hastad Attack with non-linear padding and different public keysï¼ˆå¸¦éçº¿æ€§paddingå’Œä¸åŒå…¬é’¥çš„å¹¿æ’­æ”»å‡»ï¼‰"></a>RSA Hastad Attack with non-linear padding and different public keysï¼ˆå¸¦éçº¿æ€§paddingå’Œä¸åŒå…¬é’¥çš„å¹¿æ’­æ”»å‡»ï¼‰</h4><p><strong>é€‚ç”¨æƒ…å†µï¼š$m$ ç» $k$ æ¬¡éçº¿æ€§paddingå¤„ç†åï¼Œåˆ†åˆ«ç”¨ $k$ ç»„ $(N_i,e_i)$ åŠ å¯†åå¾— $k$ ç»„ $c_i$ã€‚</strong></p><p>å‚è€ƒï¼š2020å¹´ç¾ŠåŸæ¯ - Invitation</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="comment">#e=3, padding: mÂ²+(3^431)k</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">linearPaddingHastads</span>(<span class="params">cArray,nArray,aArray,bArray,eArray,eps</span>):</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">len</span>(cArray) == <span class="built_in">len</span>(nArray) == <span class="built_in">len</span>(aArray) == <span class="built_in">len</span>(bArray) == <span class="built_in">len</span>(eArray)):</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">			cArray[i] = Integer(cArray[i])</span><br><span class="line">			nArray[i] = Integer(nArray[i])</span><br><span class="line">			aArray[i] = Integer(aArray[i])</span><br><span class="line">			bArray[i] = Integer(bArray[i])</span><br><span class="line">			eArray[i] = Integer(eArray[i])</span><br><span class="line">		TArray = [-<span class="number">1</span>]*<span class="number">4</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">			arrayToCRT = [<span class="number">0</span>]*<span class="number">4</span></span><br><span class="line">			arrayToCRT[i] = <span class="number">1</span></span><br><span class="line">			TArray[i] = crt(arrayToCRT,nArray)</span><br><span class="line">		P.&lt;x&gt; = PolynomialRing(Zmod(prod(nArray)))</span><br><span class="line">		gArray = [-<span class="number">1</span>]*<span class="number">4</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">			gArray[i] = TArray[i]*(<span class="built_in">pow</span>(aArray[i]*x**<span class="number">2</span> + bArray[i],eArray[i]) - cArray[i])</span><br><span class="line">		g = <span class="built_in">sum</span>(gArray)</span><br><span class="line">		g = g.monic()</span><br><span class="line">		roots = g.small_roots(epsilon=eps)</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">len</span>(roots)== <span class="number">0</span>):</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;No Solutions found!&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">		<span class="keyword">return</span> roots</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Input error!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nonLinearPadding</span>():</span><br><span class="line">	eArr = [<span class="number">3</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">	nArr = []</span><br><span class="line">	cArr = []</span><br><span class="line">	aArr = [<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">	bArr = [i * <span class="number">3</span> ** <span class="number">431</span> <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">3</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">11</span>]]</span><br><span class="line">	msg = linearPaddingHastads(cArr,nArr,aArr,bArr,eArr,eps=<span class="number">1</span>/<span class="number">20</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> msg:</span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(i)[<span class="number">2</span>:]))</span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	nonLinearPadding()</span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="é€‰æ‹©æ˜-å¯†æ–‡æ”»å‡»"><a href="#é€‰æ‹©æ˜-å¯†æ–‡æ”»å‡»" class="headerlink" title="é€‰æ‹©æ˜/å¯†æ–‡æ”»å‡»"></a>é€‰æ‹©æ˜/å¯†æ–‡æ”»å‡»</h4><h5 id="é€‰æ‹©æ˜æ–‡æ”»å‡»"><a href="#é€‰æ‹©æ˜æ–‡æ”»å‡»" class="headerlink" title="é€‰æ‹©æ˜æ–‡æ”»å‡»"></a>é€‰æ‹©æ˜æ–‡æ”»å‡»</h5><p><strong>é€‚ç”¨æƒ…å†µï¼š</strong>å¯¹è¾“å…¥çš„ä»»æ„æ˜æ–‡æœåŠ¡å™¨è¿”å› RSA åŠ å¯†ç»“æœï¼Œå¯ä»¥é€šè¿‡é€‰æ‹©æ˜æ–‡æ”»å‡»æ¥è·å– $n$ã€‚</p><p>é¦–å…ˆå‘é€ $2$ï¼Œè®©æœåŠ¡å™¨è¿›è¡ŒåŠ å¯†ï¼Œè¿”å› $c_2=2^e \bmod n$ï¼›</p><p>ç»§ç»­å‘é€ $2^2$ï¼Œè®©æœåŠ¡å™¨è¿›è¡ŒåŠ å¯†ï¼Œè¿”å› $c_4=4^e \bmod n$ï¼›</p><p>ä¸å¦¨è®¾ $2^e=a+bn$ï¼Œæœ‰ $c_2=(a+bn) \bmod n=a$ï¼Œ$c_4=(a^2+2abn+b^2n^2) \bmod n = a^2 \bmod n$ï¼Œ</p><p>æ‰€ä»¥ $c_2^2$ å’Œ $c_4$ æ¨¡ $n$ åŒä½™ï¼Œå³ $c_2^2-c_4=kn$ï¼ŒåŒç† $c_2^3-c_8=kâ€™n$ï¼Œ</p><p>ä¸€èˆ¬æ¥è¯´ $a^2$ æ¯” $n$ å¤§ï¼Œæ‰€ä»¥ $k \neq 0$ã€‚</p><p>åŒç†è¿˜å¯ä»¥æ„é€ æ›´å¤šçš„ä¾‹å­å–ä»–ä»¬çš„å…¬å› æ•°ï¼Œæ¥æ›´åŠ ç¡®å®šåœ°æ‰¾ $n$ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_n</span>():</span><br><span class="line">    nset = []</span><br><span class="line">    c2 = server_encode(<span class="number">2</span>)</span><br><span class="line">    c4 = server_encode(<span class="number">4</span>)</span><br><span class="line">    c8 = server_encode(<span class="number">8</span>)</span><br><span class="line">    nset.append(c2 * c2 - c4)</span><br><span class="line">    nset.append(c2 * c2 * c2 - c8)</span><br><span class="line">    c3 = server_encode(<span class="number">3</span>)</span><br><span class="line">    c9 = server_encode(<span class="number">9</span>)</span><br><span class="line">    c27 = server_encode(<span class="number">27</span>)</span><br><span class="line">    nset.append(c3 * c3 - c9)</span><br><span class="line">    nset.append(c3 * c3 * c3 - c27)</span><br><span class="line">    c5 = server_encode(<span class="number">5</span>)</span><br><span class="line">    c25 = server_encode(<span class="number">25</span>)</span><br><span class="line">    c125 = server_encode(<span class="number">125</span>)</span><br><span class="line">    nset.append(c5 * c5 - c25)</span><br><span class="line">    nset.append(c5 * c5 * c5 - c125)</span><br><span class="line">    n = nset[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> nset:</span><br><span class="line">        n = gmpy2.gcd(x, n)</span><br><span class="line">    <span class="keyword">while</span> n % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        n //= <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> n % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">        n //= <span class="number">3</span></span><br><span class="line">    <span class="keyword">while</span> n % <span class="number">5</span> == <span class="number">0</span>:</span><br><span class="line">        n //= <span class="number">5</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line">    <span class="keyword">return</span> n</span><br></pre></td></tr></table></figure><h5 id="é€‰æ‹©å¯†æ–‡æ”»å‡»"><a href="#é€‰æ‹©å¯†æ–‡æ”»å‡»" class="headerlink" title="é€‰æ‹©å¯†æ–‡æ”»å‡»"></a>é€‰æ‹©å¯†æ–‡æ”»å‡»</h5><p><strong>é€‚ç”¨æƒ…å†µï¼š</strong>å¯ä»¥æ„é€ ä»»æ„å¯†æ–‡å¹¶è·å¾—å¯¹åº”æ˜æ–‡ï¼Œé€šè¿‡é€‰æ‹©å¯†æ–‡æ”»å‡»è·å¾—ç‰¹å®šçš„æ˜æ–‡ã€‚</p><p>å‡è®¾æœåŠ¡å™¨åˆ›å»ºäº†å¯†æ–‡ $c=m^e \bmod n$ï¼Œå¹¶ä¸”æŠŠ $c$ å‘é€ç»™ç”¨æˆ·ï¼Œç”¨æˆ·å¯ä»¥å‘é€ä»»æ„å¯†æ–‡æœåŠ¡å™¨è¿”å›è§£å¯†åçš„æ˜æ–‡ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ±‚å‡º $m$ï¼š</p><ol><li>é€‰æ‹©ä»»æ„çš„ $x$ ä¸ $n$ äº’ç´ ï¼›</li><li>è®¡ç®— $y=cx^e \bmod n$ï¼›</li><li>ç”±äºå¯ä»¥è¿›è¡Œé€‰æ‹©å¯†æ–‡æ”»å‡»ï¼Œå¯ä»¥æ±‚å¾— $y$ å¯¹åº”çš„è§£å¯†ç»“æœ $z=y^d$ï¼›</li><li>åˆ™ $z=y^d=(cx^e)^d=c^dx=mx \bmod n$ï¼Œç”±äº $x$ ä¸ $n$ äº’ç´ ï¼Œå®¹æ˜“æ±‚å¾—ç›¸åº”é€†å…ƒï¼Œè¿›è€Œå¯ä»¥å¾—åˆ° $m$ã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_M</span>():</span><br><span class="line">    X = getPrime(<span class="number">5</span>)</span><br><span class="line">    Y = (c * (X ** e)) % n</span><br><span class="line">    Z = server_decode(Y)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        M = (n * i + Z) // X</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> long_to_bytes(M):</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(M))</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h5 id="Parity-Oracle-Attack"><a href="#Parity-Oracle-Attack" class="headerlink" title="Parity Oracle Attack"></a>Parity Oracle Attack</h5><h6 id="LSB-Oracle-Attackï¼ˆLeast-Significant-Bit-Oracle-Attack-ï¼‰"><a href="#LSB-Oracle-Attackï¼ˆLeast-Significant-Bit-Oracle-Attack-ï¼‰" class="headerlink" title="LSB Oracle Attackï¼ˆLeast Significant Bit Oracle Attack ï¼‰"></a>LSB Oracle Attackï¼ˆLeast Significant Bit Oracle Attack ï¼‰</h6><p><strong>é€‚ç”¨æƒ…å†µï¼š</strong>å¯ä»¥é€‰æ‹©å¯†æ–‡å¹¶æ³„éœ²æ˜æ–‡çš„æœ€ä½ä½ï¼ˆå¥‡å¶æ€§ï¼‰ã€‚</p><p>æœåŠ¡å™¨ä¼šå¯¹ä¸€ä¸ªç»™å®šçš„å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œå¹¶ä¸”ä¼šæ£€æŸ¥è§£å¯†çš„æ˜æ–‡çš„å¥‡å¶æ€§ï¼Œå¹¶æ ¹æ®å¥‡å¶æ€§è¿”å›ç›¸åº”çš„å€¼ï¼Œæ¯”å¦‚1è¡¨ç¤ºå¥‡æ•°ï¼Œ0è¡¨ç¤ºå¶æ•°ã€‚é‚£ä¹ˆç»™å®šä¸€ä¸ªåŠ å¯†åçš„å¯†æ–‡ï¼Œåªéœ€è¦ $\log_2n$ æ¬¡å°±å¯ä»¥çŸ¥é“è¿™ä¸ªå¯†æ–‡å¯¹åº”çš„æ˜æ–‡æ¶ˆæ¯ã€‚</p><p>å‡è®¾ $c=m^e \bmod n$ï¼Œç¬¬ä¸€æ¬¡æ—¶ï¼Œæ„é€ å¯†æ–‡ $c \cdot 2^e \bmod n=(2m)^e \bmod n$ï¼ŒæœåŠ¡å™¨è§£å¯†åå¾—åˆ° $2m \bmod n$ã€‚</p><p>è¿™é‡Œï¼š</p><ul><li>$2m$ æ˜¯å¶æ•°ï¼Œå®ƒçš„å¹‚æ¬¡ä¹Ÿæ˜¯å¶æ•°ï¼›</li><li>$n$ æ˜¯å¥‡æ•°ï¼Œå› ä¸ºå®ƒæ˜¯ç”±ä¸¤ä¸ªå¤§ç´ æ•°ç›¸ä¹˜å¾—åˆ°ã€‚</li></ul><p>é‚£ä¹ˆï¼š</p><ul><li>æœåŠ¡å™¨è¿”å›å¥‡æ•°ï¼Œå³ $2m \bmod n$ ä¸ºå¥‡æ•°ï¼Œåˆ™è¯´æ˜ $2m&gt;n$ï¼Œä¸”å‡å»äº†å¥‡æ•°ä¸ª $n$ï¼Œåˆå› ä¸º $2m&lt;2n$ï¼Œå› æ­¤å‡å»äº†ä¸€ä¸ª $n$ï¼Œå³ $\frac{n}{2}\leq m \lt n$ï¼›</li><li>æœåŠ¡å™¨è¿”å›å¶æ•°ï¼Œåˆ™ $2m&lt;n$ï¼Œå³ $0 \leq m \lt \frac{n}{2}$ã€‚</li></ul><p>ç¬¬äºŒæ¬¡æ—¶ï¼Œæ„é€ å¯†æ–‡ $c \cdot 4^e \bmod n$ï¼ŒæœåŠ¡å™¨è§£å¯†åå¾—åˆ° $4m \bmod n$ï¼Œåˆ¤æ–­å…¶å¥‡å¶æ€§å¯ä»¥çŸ¥é“ $m$ å’Œ $\frac{n}{4}$ çš„å¤§å°å…³ç³»ã€‚</p><p>ä»¥æ­¤ç±»æ¨ï¼Œç¬¬ $i$ æ¬¡æ—¶ï¼Œæ„é€ å¯†æ–‡ $c \cdot 2^{ie} \bmod n$ï¼ŒæœåŠ¡å™¨è§£å¯†åå¾—åˆ° $2^im \bmod n$ï¼Œåˆ¤æ–­å…¶å¥‡å¶æ€§å¯ä»¥çŸ¥é“ $m$ å’Œ $\frac{n}{2^i}$ çš„å¤§å°å…³ç³»ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªäºŒåˆ†ç®—æ³•ï¼Œå¯ä»¥åœ¨ $\log_2n$ æ¬¡å†…å°† $m$ çš„èŒƒå›´é€¼è¿‘åˆ°ä¸€ä¸ªè¶³å¤Ÿç‹­çª„çš„ç©ºé—´ã€‚</p><p>å‡è®¾æœåŠ¡å™¨è¿”å› bï¼Œé‚£ä¹ˆå¯ä»¥å½’çº³ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">L = <span class="number">0</span></span><br><span class="line">R = n</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1024</span>):</span><br><span class="line">    <span class="keyword">if</span> b:</span><br><span class="line">        L = (L+R) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        R = (L+R) // <span class="number">2</span></span><br></pre></td></tr></table></figure><p>ç”±äºæ­¤å¤„æœ‰å¤§é‡æ•´é™¤è¿ç®—ï¼Œæ‰€ä»¥æœ€å¥½ç”¨ <code>decimal</code> åº“è¿›è¡Œç²¾ç¡®è®¡ç®—ï¼Œå¦åˆ™æœ€åç»“æœå¾ˆå¯èƒ½ä¼šå‡ºé”™ã€‚<code>decimal.getcontext().prec</code> ç”¨æ¥è®¾å®šç²¾åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> decimal</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    k = n.bit_length()</span><br><span class="line">    decimal.getcontext().prec = k</span><br><span class="line">    L = decimal.Decimal(<span class="number">0</span>)</span><br><span class="line">    R = decimal.Decimal(<span class="built_in">int</span>(n))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        c = (c * <span class="built_in">pow</span>(<span class="number">2</span>, e, n)) % n</span><br><span class="line">        recv = server_decode(c)</span><br><span class="line">        <span class="keyword">if</span> recv == <span class="number">1</span>:</span><br><span class="line">            L = (L + R) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            R = (L + R) // <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>((R))))</span><br></pre></td></tr></table></figure><p>æ›´å¤šä¿¡æ¯å¯å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://introspelliam.github.io/2018/03/27/crypto/RSA-Least-Significant-Bit-Oracle-Attack/">RSA Least-Significant-Bit Oracle Attack</a> å’Œ <a target="_blank" rel="noopener" href="https://crypto.stackexchange.com/questions/11053/rsa-least-significant-bit-oracle-attack">RSA least significant bit oracle attack</a> ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> decimal</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">oracle</span>():</span><br><span class="line">	<span class="keyword">return</span> lsb == <span class="string">&#x27;odd&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">partial</span>(<span class="params">c, e, n</span>):</span><br><span class="line">	k = n.bit_length()</span><br><span class="line">	decimal.getcontext().prec = k  <span class="comment"># for &#x27;precise enough&#x27; floats</span></span><br><span class="line">	lo = decimal.Decimal(<span class="number">0</span>)</span><br><span class="line">	hi = decimal.Decimal(n)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> oracle(c):</span><br><span class="line">			hi = (lo + hi) // <span class="number">2</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			lo = (lo + hi) // <span class="number">2</span></span><br><span class="line">		c = (c * <span class="built_in">pow</span>(<span class="number">2</span>, e, n)) % n</span><br><span class="line">		<span class="comment"># print i, int(hi - lo)</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">int</span>(hi)</span><br></pre></td></tr></table></figure><h6 id="MSB-Oracle-Attackï¼ˆMost-Significant-Bit-Oracle-Attack-ï¼‰"><a href="#MSB-Oracle-Attackï¼ˆMost-Significant-Bit-Oracle-Attack-ï¼‰" class="headerlink" title="MSB Oracle Attackï¼ˆMost Significant Bit Oracle Attack ï¼‰"></a>MSB Oracle Attackï¼ˆMost Significant Bit Oracle Attack ï¼‰</h6><p><strong>é€‚ç”¨æƒ…å†µï¼š</strong>å¯ä»¥é€‰æ‹©å¯†æ–‡å¹¶æ³„éœ²æ˜æ–‡çš„æœ€é«˜ä½ï¼ˆå¥‡å¶æ€§ï¼‰ã€‚</p><p>å‡è®¾è¿œç¨‹æä¾›ä¸€ä¸ªè§£å¯†æœåŠ¡ï¼Œä½†æ˜¯åªè¿”å›æ˜æ–‡çš„æœ€é«˜å­—èŠ‚ï¼Œå¹¶ä¸”æ˜æ–‡çš„å½¢å¼æ˜¯64å­—èŠ‚ï¼Œé«˜ä½ç”¨ <code>\x00</code> å¡«å……ã€‚</p><p>å°†åŠ å¯†çš„å†…å®¹æ‹¿å»è§£å¯†ä¼šå¾—åˆ° $m$ï¼Œä½†æ˜¯å›æ˜¾æœ€é«˜ä½æ˜¯ <code>\x00</code>ï¼Œæ„é€ å¯†æ–‡ $c \cdot 2^e$ï¼Œè§£å¯†ä¼šå¾—åˆ° $2m \bmod n$ï¼Œ</p><p>ä¸æ–­æ„é€ å¯†æ–‡ $c \cdot 2^{ie}$ï¼Œå½“æœ€é«˜ä½ä¸æ˜¯ <code>\x00</code> æ—¶ï¼Œè®°å½•ä¸‹å€¼ä¸º $x$ï¼Œåˆ™è¯´æ˜ $mx&gt;2^{\text{kbit}}$ï¼Œ</p><p>ç„¶åå†ç›¸åº”ç¼©å° $x$ ï¼Œå¯ä»¥åˆ©ç”¨äºŒåˆ†æ³•ï¼Œæ¯”å¦‚å½“ç¬¬ä¸€æ¬¡æ‹¿åˆ° $mx&gt;2^{\text{kbit}}$ï¼Œé‚£ä¹ˆæœ‰ $m(\frac{x}{2})&lt;2^{\text{kbit}}$ï¼Œå› æ­¤æ–°çš„ $xâ€™$ å¿…å®šæ»¡è¶³ $\frac{x}{2} \lt xâ€™ \lt x$ï¼Œæ¥ç€å°è¯• $\frac{x+\frac{x}{2}}{2}$ å°±å¥½ã€‚</p><p>æœ€ç»ˆå¯ä»¥æ‰¾åˆ°ä¸€ä¸ª $X$ï¼Œæ»¡è¶³ $mX \lt 2^{\text{kbit}}$ ä¸” $m(X+1) \gt 2^{\text{kbit}}$ï¼Œç”±äºæ˜¯æ•´é™¤ï¼Œæ‰€ä»¥ä¼šæœ‰è¯¯å·®ï¼Œæœ€åçš„ $m$ åœ¨ $\frac{2^{\text{kbit}}}{x}$ é™„è¿‘ã€‚</p><p>å‚è€ƒï¼šPwnhub - pkcs4</p><h5 id="Byte-Oracle-Attack"><a href="#Byte-Oracle-Attack" class="headerlink" title="Byte Oracle Attack"></a>Byte Oracle Attack</h5><p><strong>é€‚ç”¨æƒ…å†µï¼š</strong>å¯ä»¥é€‰æ‹©å¯†æ–‡å¹¶æ³„éœ²æœ€åä¸€ä¸ªå­—èŠ‚ã€‚</p><p>æœåŠ¡å™¨ä¼šå¯¹ä¸€ä¸ªç»™å®šçš„å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œå¹¶ä¸”ä¼šç»™å‡ºæ˜æ–‡çš„æœ€åä¸€ä¸ªå­—èŠ‚ã€‚é‚£ä¹ˆç»™å®šä¸€ä¸ªåŠ å¯†åçš„å¯†æ–‡ï¼Œåªéœ€è¦ $\log_{256}n$ æ¬¡å°±å¯ä»¥çŸ¥é“è¿™ä¸ªå¯†æ–‡å¯¹åº”çš„æ˜æ–‡æ¶ˆæ¯ã€‚</p><p>è¿™æ˜¯ RSA Parity Oracle çš„æ‰©å±•ï¼Œæ—¢ç„¶å¯ä»¥æ³„éœ²å‡ºæœ€åä¸€ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæŒ‰é“ç†è·å–å¯†æ–‡å¯¹åº”æ˜æ–‡çš„æ¬¡æ•°åº”è¯¥å¯ä»¥å‡å°‘ã€‚</p><p>å‡è®¾ $c=m^e \bmod n$ï¼Œç¬¬ä¸€æ¬¡æ—¶ï¼Œæ„é€ å¯†æ–‡ $c \cdot 256^e \bmod n=(256m)^e \bmod n$ï¼ŒæœåŠ¡å™¨è§£å¯†åå¾—åˆ° $256m \bmod n$ã€‚</p><p>è¿™é‡Œï¼š</p><ul><li>$256m$ æ˜¯å¶æ•°ï¼Œå®ƒçš„å¹‚æ¬¡ä¹Ÿæ˜¯å¶æ•°ï¼›</li><li>$n$ æ˜¯å¥‡æ•°ï¼Œå› ä¸ºå®ƒæ˜¯ç”±ä¸¤ä¸ªå¤§ç´ æ•°ç›¸ä¹˜å¾—åˆ°ã€‚</li></ul><p>ç”±äº $m=c^d \bmod n$ï¼Œæ‰€ä»¥ $m \lt n$ï¼Œé‚£ä¹ˆï¼š$256m \bmod n=256m-kn$ï¼Œ$(k&lt;256)$ï¼Œ</p><p>è€Œä¸”å¯¹äºä¸¤ä¸ªä¸åŒçš„ $k_1,k_2$ï¼Œæœ‰ï¼š$(256m-k_1n) \bmod 256 \neq (256m-k_2n) \bmod 256$ï¼Œ</p><p>åŒæ—¶ $256m-kn$ çš„æœ€åä¸€ä¸ªå­—èŠ‚å…¶å®å°±æ˜¯ $-kn$ åœ¨æ¨¡ $256$ çš„æƒ…å†µä¸‹è·å–çš„ã€‚</p><p>é‚£ä¹ˆï¼Œå¯ä»¥é¦–å…ˆæšä¸¾å‡º $0 \sim 255$ æƒ…å†µä¸‹çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œæ„é€ ä¸€ä¸ª $k$ å’Œæœ€åä¸€ä¸ªå­—èŠ‚çš„æ˜ å°„è¡¨ $\text{M}$ã€‚</p><p>å½“æœåŠ¡å™¨è¿”å›æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œå¯ä»¥æ ¹æ®ä¸Šè¿°æ„é€ çš„æ˜ å°„è¡¨ $\text{M}$ å¾—çŸ¥ $k$ï¼Œå³å‡å»äº† $k$ ä¸ª $n$ï¼Œå³ $kn \leq 256m \leq (k+1)n$ã€‚</p><p>ä»¥æ­¤ç±»æ¨ï¼Œç¬¬ $i$ æ¬¡æ—¶ï¼Œæ„é€ å¯†æ–‡ $c \cdot 256^{ie} \bmod n$ï¼ŒæœåŠ¡å™¨è§£å¯†åå¾—åˆ° $256^im \bmod n = 256^im-kn$ï¼Œå³ï¼š</p><p>$kn \leq 256^im \leq (k+1)n$ï¼Œ $\frac{kn}{256^i} \leq m \leq \frac{(k+1)n}{256^i}$ã€‚</p><p>é‚£ä¹ˆï¼Œå¯ä»¥è®¾åˆå§‹èŒƒå›´ä¸ºï¼š$\frac{M}{n} \in [L_0,R_0],(L_0=0,R_0=1)$ï¼Œ</p><p>ç¬¬ $i$ æ¬¡è¿­ä»£åï¼š$L_i=L_{i-1}+\frac{k_i}{256^i},R_i=R_{i-1}+\frac{k_i+1}{256^i}$ã€‚</p><p>æœ€åä¸€ä¸ªé—®é¢˜æ˜¯è¿­ä»£çš„æ¬¡æ•°ï¼Œç”±äºæ˜æ–‡çš„æœ€åä¸€ä¸ªå­—èŠ‚å¯ä»¥ç›´æ¥ç”±æœåŠ¡å™¨è§£å¯†å¾—åˆ°ï¼Œé‚£ä¹ˆåªéœ€è¦é™å®š $m$ çš„èŒƒå›´è‡³ $m_{\text{max}}-m_{\text{min}} \lt 256$ï¼Œå³ $n(R_i-L_i)= \frac{n}{256^i} \lt 256$ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ $n \lt 2^{1024}$ï¼Œç”±ä¸Šå¼å¯å¾— $i \gt 128$ã€‚</p><p>ä¸€èˆ¬å¯¹äºè¿™æ ·çš„ Oracleï¼Œæœ€å¤šéœ€è¦ $\log_{2^{\text{bits}}}n$ æ¬¡è¿­ä»£å³å¯ç¡®å®šæ˜æ–‡ï¼Œå…¶ä¸­ bits ä¸ºæ³„éœ²çš„æ˜æ–‡ bit æ•°ã€‚RSA Parity Oracle ä¸º 1ï¼ŒRSA Byte Oracle ä¸º 8ã€‚</p><p>å‡è®¾æœåŠ¡å™¨è¿”å›äº† bï¼Œé‚£ä¹ˆå¯ä»¥å½’çº³ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">L = <span class="number">0</span></span><br><span class="line">R = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    k = mab[b]</span><br><span class="line">    L = L + k // <span class="number">256</span>**(i+<span class="number">1</span>)</span><br><span class="line">    R = L + (k+<span class="number">1</span>ï¼‰// <span class="number">256</span>**(i+<span class="number">1</span>)</span><br><span class="line">M = L * n</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸çŸ¥é“ $e$ ä½†æœåŠ¡å™¨æä¾›ä»»æ„æ˜æ–‡åŠ å¯†æœåŠ¡ï¼Œå¯ä»¥è®©æœåŠ¡å™¨åŠ å¯† $256$ï¼Œå¾—åˆ° $256^e \bmod n$ã€‚</p><p>ç”±äºæœ‰å¤§é‡é™¤æ³•è¿ç®—ï¼Œä¸ºä¿è¯ç²¾åº¦ï¼Œå°†ä¸­é—´è¿‡ç¨‹ç”¨ <code>Fraction</code> åº“ä¿å­˜ä¸ºåˆ†æ•°ã€‚</p><p>æœ€åä¸€å­—èŠ‚çš„æ•°æ®ä¸å‡†ç¡®è¦å‡æ‰ï¼Œä»æœåŠ¡å™¨è¿”å›ç²¾ç¡®çš„æœ€åä¸€å­—èŠ‚æ•°æ®ã€‚</p><p>å…¶å®åªè¦æ±‚å‡º L ä¸‹é™å³å¯ï¼Œæ— éœ€æ±‚å‡º R ä¸Šé™ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    <span class="built_in">map</span> = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">        <span class="built_in">map</span>[-n * i % <span class="number">256</span>] = i</span><br><span class="line"></span><br><span class="line">    cipher256 = server_encode(<span class="number">256</span>)</span><br><span class="line">    backup = c</span><br><span class="line"></span><br><span class="line">    L = Fraction(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    R = Fraction(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">        c = c * cipher256 % n</span><br><span class="line">        b = server_decode(c)</span><br><span class="line">        k = <span class="built_in">map</span>[b]</span><br><span class="line">        L, R = L + Fraction(k, <span class="number">256</span>**(i+<span class="number">1</span>)), L + Fraction(k+<span class="number">1</span>, <span class="number">256</span>**(i+<span class="number">1</span>))</span><br><span class="line">    m = <span class="built_in">int</span>(L * n)</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(m - m % <span class="number">256</span> + server_decode(backup)))</span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="Common-Private-Exponentï¼ˆå…±ç§é’¥æŒ‡æ•°æ”»å‡»ï¼Œdç›¸åŒï¼‰"><a href="#Common-Private-Exponentï¼ˆå…±ç§é’¥æŒ‡æ•°æ”»å‡»ï¼Œdç›¸åŒï¼‰" class="headerlink" title="Common Private Exponentï¼ˆå…±ç§é’¥æŒ‡æ•°æ”»å‡»ï¼Œdç›¸åŒï¼‰"></a>Common Private Exponentï¼ˆå…±ç§é’¥æŒ‡æ•°æ”»å‡»ï¼Œdç›¸åŒï¼‰</h4><p>åŠ å¯†ç”¨åŒæ ·çš„ç§é’¥å¹¶ä¸”ç§é’¥æ¯”è¾ƒçŸ­ï¼Œä»è€Œå¯¼è‡´äº†åŠ å¯†ç³»ç»Ÿè¢«ç ´è§£ã€‚</p><p>å‡å®šï¼š</p><p>$\begin{cases} e_1d=1+k_1\varphi(N_1) \newline e_2d=1+k_2\varphi(N_2) \newline {\vdots} \newline e_rd=1+k_r\varphi(N_r) \end{cases}$</p><p>å…¶ä¸­ï¼Œ$N_1 \lt N_2 \lt \cdots \lt N_r \lt 2N_1$ã€‚</p><p>æ„é€ æ ¼ï¼š</p><p>$B_r=\begin{bmatrix}{M}&amp;{e_1}&amp;{e_2}&amp;{\cdots}&amp;{e_{r}}\newline<br>{0}&amp;{-N_1}&amp;{0}&amp;{\cdots}&amp;{0}\newline{0}&amp;{0}&amp;{-N_2}&amp;{\cdots}&amp;{0}\newline{\vdots}&amp;{\vdots}&amp;{\vdots}&amp;{\ddots}&amp;{\vdots}\newline{0}&amp;{0}&amp;{0}&amp;{\cdots}&amp;{-N_r}\newline\end{bmatrix}$</p><p>å…¶ä¸­ $M=\lfloor N_r^{\frac{1}{2}} \rfloor$ã€‚</p><p>å†åˆ©ç”¨<strong>LLLç®—æ³•</strong>è¿›è¡Œè§„çº¦å¾—åˆ° $\vert b_1\vert=Md$ï¼Œåˆ™ $d=\cfrac{\vert b_1 \vert}{M}$ï¼Œä»è€Œè§£å¯†å¯†æ–‡å¾—åˆ°æ˜æ–‡ã€‚</p><ul><li><p>ä½¿ç”¨æ¡ä»¶ï¼š</p><p>$d \lt N_r^{\delta_r}ï¼Œ\delta_r \lt \cfrac{1}{2}-\cfrac{1}{2(r+1)}-\log_{N_r}{(6)}$</p></li><li><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf">Lattice Based Attack on Common Private Exponent RSA</a></p><p>SCTF 2020 - RSA</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###Sage###</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">e0=</span><br><span class="line">n0=</span><br><span class="line">c0=</span><br><span class="line">e1=</span><br><span class="line">n1=</span><br><span class="line">c1=</span><br><span class="line">e2=</span><br><span class="line">n2=</span><br><span class="line">c2=</span><br><span class="line"></span><br><span class="line">M=iroot(<span class="built_in">int</span>(n2),<span class="built_in">int</span>(<span class="number">2</span>))[<span class="number">0</span>]</span><br><span class="line">a=[<span class="number">0</span>]*<span class="number">4</span></span><br><span class="line">a[<span class="number">0</span>]=[M,e0,e1,e2]</span><br><span class="line">a[<span class="number">1</span>]=[<span class="number">0</span>,-n0,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">a[<span class="number">2</span>]=[<span class="number">0</span>,<span class="number">0</span>,-n1,<span class="number">0</span>]</span><br><span class="line">a[<span class="number">3</span>]=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-n2]</span><br><span class="line"></span><br><span class="line">Mat = matrix(ZZ,a)</span><br><span class="line">Mat_LLL=Mat.LLL()</span><br><span class="line">d = <span class="built_in">abs</span>(Mat_LLL[<span class="number">0</span>][<span class="number">0</span>])/M</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="built_in">pow</span>(c1,<span class="built_in">int</span>(d),<span class="built_in">int</span>(n1)))[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="å¤šç»„ä½è§£å¯†æŒ‡æ•°æ”»å‡»"><a href="#å¤šç»„ä½è§£å¯†æŒ‡æ•°æ”»å‡»" class="headerlink" title="å¤šç»„ä½è§£å¯†æŒ‡æ•°æ”»å‡»"></a>å¤šç»„ä½è§£å¯†æŒ‡æ•°æ”»å‡»</h4><p><strong>é€‚ç”¨æƒ…å†µï¼š2-4ç»„ $e$ï¼Œä¸” $d$ è¾ƒå°</strong></p><ul><li><p><strong>ç»™å®š2ç»„</strong></p><p>$g=\gcd(p-1,q-1),\lambda(n)=\frac{\varphi(n)}{g},s=1-p-q$</p><p>ä¸”æœ‰ $ed-k\lambda(n)=1$ï¼Œå¾—åˆ° $edg-kn=g+ks\quad (1)$</p><p>è®¾ $e_1$ å¯¹åº” $k_1$ï¼Œ$e_2$ å¯¹åº” $k_2$ï¼Œåˆ™æœ‰ $k_{2}d_{1}e{1}-k_{1}d_{2}e_{2}=k_{2}-k_{1}\quad (2)$</p><p>ç”±(1)(2)æœ‰ï¼š</p><p>$\left\{ \begin{matrix} e_{1}d_{1}g-k_{1}n=g+k_{1}s \newline k_{2}d_{1}e{1}-k_{1}d_{2}e_{2}=k_{2}-k_{1} \newline e_{1}e_{2}d_{1}d_{2}g_{2}-e_{1}d_{1}gk_{2}n-e_{2}d_{2}gk_{1}n+k_{1}k_{2}n^{2}=(g+k_{1}s)(g+k_{2}s) \end{matrix} \right.$</p><p>ä¸Šè¿°ç­‰å¼ç»„ä¹Ÿå¯è¡¨ç¤ºä¸º</p><p>$bL_2 =[k_{1}k_{2},k_{2}d_{1}g,k_{1}d_{2}g,d_{1}d_{2}g^{2}]\cdot\left[ \begin{matrix} n &amp; -M_{1}n &amp; 0 &amp; n^{2} \newline 0 &amp; M_{1}e_{1} &amp; M_{2}e_{1} &amp; -e_{1}n \newline 0 &amp; 0 &amp; -M_{2}e_{2} &amp; -e_{2}n \newline 0 &amp; 0 &amp; 0 &amp; e_{1}e_{2} \end{matrix} \right] =[k_{1}k_{2}n,M_{1}k_{2}(g+k_{1}s),M_{2}g(k_{2}-k_{1})ï¼Œ(g+k_{1}s)(g+k_{2}s)]$</p><p>ï¼ˆå…¶ä¸­ $M_{1}=n^{1/2},M_{2}=n^{1+\alpha_{2}},d\approx n^{\alpha_{2}}$ï¼‰</p><p>å¯¹éƒ¨åˆ†å‚æ•°è¿›è¡Œä¸Šç•Œä¼°è®¡ï¼Œkä¸Šç•Œè¿‘ä¼¼äº $d\approx N^{\alpha_{2}}$, $|s|$ ä¸Šç•Œ $\approx N^{1/2}$ï¼Œ$g$ ä¸€èˆ¬ç›¸å¯¹æå°</p><p>å› æ­¤ä¸Šé¢çš„çŸ©é˜µè¡¨ç¤º $BA=C$ ä¸­ï¼Œ$C$ çš„æ¯ä¸ªå…ƒçš„sizeéƒ½è¿‘ä¼¼ $n^{1+2\alpha_{2}}$ï¼Œæ‰€ä»¥ $|C|\approx 2\cdot n^{1+2\alpha_{2}}$</p><p>$B$ ä½œä¸ºæ ¼åŸºçš„æ ¼ä¸­ï¼Œæœ€çŸ­å‘é‡ç”±Minkowski BoundsçŸ¥ $\approx \sqrt{4}\det(B)^{1/4}\approx 2\cdot n^{(13/2+\alpha_{2})/4}$</p><p>å› æ­¤åªè¦æ»¡è¶³ $n^{1+2\alpha_{2}}&lt;n^{(13/2+\alpha_{2})/4}$ å³å¯å°†é—®é¢˜è½¬åŒ–ä¸ºSVPï¼ˆ$\alpha_{2}&lt;\frac{5}{14}$ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">N = </span><br><span class="line">e1 = </span><br><span class="line">e2 = </span><br><span class="line">c = </span><br><span class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    alpha2 = i/<span class="number">1000</span></span><br><span class="line">     M1 = <span class="built_in">int</span>(gmpy2.mpz(N)**<span class="number">0.5</span>)</span><br><span class="line">    M2 = <span class="built_in">int</span>( gmpy2.mpz(N)**(<span class="number">1</span>+alpha2) )</span><br><span class="line">    D = diagonal_matrix(ZZ, [N, M1, M2, <span class="number">1</span>])</span><br><span class="line">    B = Matrix(ZZ, [ [<span class="number">1</span>, -N,   <span class="number">0</span>,  N**<span class="number">2</span>],</span><br><span class="line">                 [<span class="number">0</span>, e1, -e1, -e1*N],</span><br><span class="line">                 [<span class="number">0</span>,  <span class="number">0</span>,  e2, -e2*N],</span><br><span class="line">                 [<span class="number">0</span>,  <span class="number">0</span>,   <span class="number">0</span>, e1*e2] ]) * D</span><br><span class="line">    L = B.LLL()</span><br><span class="line">    v = Matrix(ZZ, L[<span class="number">0</span>])</span><br><span class="line">    x = v * B**(-<span class="number">1</span>)</span><br><span class="line">    phi = (x[<span class="number">0</span>,<span class="number">1</span>]/x[<span class="number">0</span>,<span class="number">0</span>]*e1).floor()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        d = inverse_mod( <span class="number">65537</span>, phi)</span><br><span class="line">        m = <span class="built_in">hex</span>(power_mod(c, d, N))[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span> m.startswith(<span class="string">&#x27;44415343&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(m))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://0xdktb.top/2020/05/04/WriteUp-De1CTF2020-Crypto/">De1CTF 2020 - easyRSA</a></p></li><li><p><strong>ç»™å®š3ç»„</strong></p><p>ç±»ä¼¼2ç»„æƒ…å†µï¼Œå…¶ä¸­</p><p>$b=[k_1k_2k_3,d_1gk_2k_3,k_1d_2gk_3,d_1d_2g^2k_3,k_1k_2d_3g,k_1d_3g,k_2d_3g,d_1d_2d_3g^3]$</p><p>$L_3=\left[\begin{matrix} 1-N &amp; 0 &amp; N^2 &amp; 0 &amp; 0 &amp; 0 &amp; -N^3 \newline e_1 &amp; -e_1 &amp; -e_1N &amp; -e &amp; 0 &amp; e_1N &amp; e_1N^2 \newline 0 &amp; e_2 &amp; -e_2N &amp; 0 &amp; e_2N &amp; 0 &amp; e_2N^2 \newline 0 &amp; 0 &amp; e_1e_2 &amp; 0 &amp; -e_1e_2 &amp; -e_1e_2 &amp; -e_1e_2N \newline 0 &amp; 0 &amp; 0 &amp; e_3 &amp; -e_3N &amp; -e_3N &amp; e_3N^3 \newline 0 &amp; 0 &amp; 0 &amp; 0 &amp; e_1e_3 &amp; 0 &amp; -e_1e_3N \newline 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; e_2e_3 &amp; -e_2e_3N \newline 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; e_1e_2e_3 \end{matrix}\right] \times D$</p><p>å…¶ä¸­ $D={\rm diag}(N^{3/2},N,N^{(3/2)+\alpha_3},N^{1/2},N^{(3/2)+\alpha_3},N^{1+\alpha_3},N^{1+\alpha_3}ï¼Œ1)$</p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://furutsuki.hatenablog.com/entry/2020/07/26/185243">3kCTF - RSA Textbook</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">N = </span><br><span class="line">e1 = </span><br><span class="line">e2 = </span><br><span class="line">e3 = </span><br><span class="line">c = </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    alpha2 = i/<span class="number">1000</span></span><br><span class="line">    M1 = <span class="built_in">int</span>(gmpy2.mpz(N)**(<span class="number">3.</span>/<span class="number">2</span>))</span><br><span class="line">    M2 = <span class="built_in">int</span>( gmpy2.mpz(N) )</span><br><span class="line">    M3 = <span class="built_in">int</span>(gmpy2.mpz(N)**(<span class="number">3.</span>/<span class="number">2</span> + alpha2))</span><br><span class="line">    M4 = <span class="built_in">int</span>( gmpy2.mpz(N)**(<span class="number">0.5</span>) )</span><br><span class="line">    M5 = <span class="built_in">int</span>( gmpy2.mpz(N)**(<span class="number">3.</span>/<span class="number">2</span> + alpha2) )</span><br><span class="line">    M6 = <span class="built_in">int</span>( gmpy2.mpz(N)**(<span class="number">1.</span>+alpha2) )</span><br><span class="line">    M7 = <span class="built_in">int</span>( gmpy2.mpz(N)**(<span class="number">1.</span>+alpha2) )</span><br><span class="line">    D = diagonal_matrix(ZZ, [M1, M2, M3, M4, M5, M6, M7, <span class="number">1</span>])</span><br><span class="line">    B = Matrix(ZZ, [ [<span class="number">1</span>, -N,   <span class="number">0</span>,  N**<span class="number">2</span>,   <span class="number">0</span>,      <span class="number">0</span>,      <span class="number">0</span>,    -N**<span class="number">3</span>],</span><br><span class="line">                 [<span class="number">0</span>, e1, -e1, -e1*N, -e1,      <span class="number">0</span>,   e1*N,  e1*N**<span class="number">2</span>],</span><br><span class="line">                 [<span class="number">0</span>,  <span class="number">0</span>,  e2, -e2*N,   <span class="number">0</span>,   e2*N,      <span class="number">0</span>,  e2*N**<span class="number">2</span>],</span><br><span class="line">                 [<span class="number">0</span>,  <span class="number">0</span>,   <span class="number">0</span>, e1*e2,   <span class="number">0</span>, -e1*e2, -e1*e2, -e1*e2*N],</span><br><span class="line">                 [<span class="number">0</span>,  <span class="number">0</span>,   <span class="number">0</span>,     <span class="number">0</span>,  e3,  -e3*N,  -e3*N,  e3*N**<span class="number">2</span>],</span><br><span class="line">                 [<span class="number">0</span>,  <span class="number">0</span>,   <span class="number">0</span>,     <span class="number">0</span>,   <span class="number">0</span>,  e1*e3,      <span class="number">0</span>, -e1*e3*N],</span><br><span class="line">                 [<span class="number">0</span>,  <span class="number">0</span>,   <span class="number">0</span>,     <span class="number">0</span>,   <span class="number">0</span>,      <span class="number">0</span>,  e2*e3, -e2*e3*N],</span><br><span class="line">                 [<span class="number">0</span>,  <span class="number">0</span>,   <span class="number">0</span>,     <span class="number">0</span>,   <span class="number">0</span>,      <span class="number">0</span>,      <span class="number">0</span>, e1*e2*e3] ]) * D</span><br><span class="line"></span><br><span class="line">    L = B.LLL()</span><br><span class="line"></span><br><span class="line">    v = Matrix(ZZ, L[<span class="number">0</span>])</span><br><span class="line">    x = v * B**(-<span class="number">1</span>)</span><br><span class="line">    phi_ = (e1*x[<span class="number">0</span>,<span class="number">1</span>]/x[<span class="number">0</span>,<span class="number">0</span>]).floor()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        d = inverse_mod( <span class="number">65537</span>, phi_)</span><br><span class="line">        m = <span class="built_in">hex</span>(power_mod(c, d, N))[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span> m.startswith(<span class="string">&#x27;44415343&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(m))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ç»™å®šæ›´å¤šç»„</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">isdigit = <span class="keyword">lambda</span> x: <span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>) &lt;= <span class="built_in">ord</span>(x) &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_permutations</span>(<span class="params">g, n</span>):</span><br><span class="line">    sub = []</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">s, prev</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(s) == n:</span><br><span class="line">            res.append(s[::])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> g:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> s <span class="keyword">or</span> i &lt; prev:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            s.append(i)</span><br><span class="line">            dfs(s, <span class="built_in">max</span>(prev, i))</span><br><span class="line">            s.remove(i)</span><br><span class="line">    dfs(sub, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">X3NNY</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, exp1, exp2</span>):</span><br><span class="line">        self.exp1 = exp1</span><br><span class="line">        self.exp2 = exp2</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, b</span>):</span><br><span class="line">        <span class="keyword">return</span> X3NNY(self.exp1 * b.exp1, self.exp2 * b.exp2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;%s = %s&#x27;</span> % (self.exp1.expand().collect_common_factors(), self.exp2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">X_Complex</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, exp</span>):</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        s = <span class="string">&#x27;%s&#x27;</span> % exp</span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            <span class="keyword">if</span> isdigit(s[i]):</span><br><span class="line">                num = <span class="number">0</span></span><br><span class="line">                <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s) <span class="keyword">and</span> isdigit(s[i]):</span><br><span class="line">                    num = num*<span class="number">10</span> + <span class="built_in">int</span>(s[i])</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> i &gt;= <span class="built_in">len</span>(s):</span><br><span class="line">                    self.b = num</span><br><span class="line">                <span class="keyword">elif</span> s[i] == <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                    self.a = num</span><br><span class="line">                    i += <span class="number">2</span></span><br><span class="line">                <span class="keyword">elif</span> s[i] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">                    r = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s) <span class="keyword">and</span> isdigit(s[i]):</span><br><span class="line">                        r = r*<span class="number">10</span> + <span class="built_in">int</span>(s[i])</span><br><span class="line">                        i += <span class="number">1</span></span><br><span class="line">                    self.b = num/r</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">            self.a = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;b&#x27;</span>):</span><br><span class="line">            self.b = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">WW</span>(<span class="params">e, d, k, g, N, s</span>):</span><br><span class="line">    <span class="keyword">return</span> X3NNY(e*d*g-k*N, g+k*s)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GG</span>(<span class="params">e1, e2, d1, d2, k1, k2</span>):</span><br><span class="line">    <span class="keyword">return</span> X3NNY(e1*d1*k2- e2*d2*k1, k2 - k1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">W</span>(<span class="params">i</span>):</span><br><span class="line">    e = <span class="built_in">eval</span>(<span class="string">&quot;e%d&quot;</span> % i)</span><br><span class="line">    d = <span class="built_in">eval</span>(<span class="string">&quot;d%d&quot;</span> % i)</span><br><span class="line">    k = <span class="built_in">eval</span>(<span class="string">&quot;k%d&quot;</span> % i)</span><br><span class="line">    <span class="keyword">return</span> WW(e, d, k, g, N, s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">G</span>(<span class="params">i, j</span>):</span><br><span class="line">    e1 = <span class="built_in">eval</span>(<span class="string">&quot;e%d&quot;</span> % i)</span><br><span class="line">    d1 = <span class="built_in">eval</span>(<span class="string">&quot;d%d&quot;</span> % i)</span><br><span class="line">    k1 = <span class="built_in">eval</span>(<span class="string">&quot;k%d&quot;</span> % i)</span><br><span class="line">    </span><br><span class="line">    e2 = <span class="built_in">eval</span>(<span class="string">&quot;e%d&quot;</span> % j)</span><br><span class="line">    d2 = <span class="built_in">eval</span>(<span class="string">&quot;d%d&quot;</span> % j)</span><br><span class="line">    k2 = <span class="built_in">eval</span>(<span class="string">&quot;k%d&quot;</span> % j)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> GG(e1, e2, d1, d2, k1, k2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">R</span>(<span class="params">e, sn</span>): <span class="comment"># min u max v</span></span><br><span class="line">    ret = X3NNY(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    n = <span class="built_in">max</span>(e)</span><br><span class="line">    nn = <span class="built_in">len</span>(e)</span><br><span class="line">    l = <span class="built_in">set</span>(i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n+<span class="number">1</span>))</span><br><span class="line">    debug = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    u, v = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> e:</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">            ret *= W(<span class="number">1</span>)</span><br><span class="line">            debug += <span class="string">&#x27;W(%d)&#x27;</span> % i</span><br><span class="line">            nn -= <span class="number">1</span></span><br><span class="line">            l.remove(<span class="number">1</span>)</span><br><span class="line">            u += <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> i &gt; <span class="built_in">min</span>(l) <span class="keyword">and</span> <span class="built_in">len</span>(l) &gt;= <span class="number">2</span>*nn:</span><br><span class="line">            ret *= G(<span class="built_in">min</span>(l), i)</span><br><span class="line">            nn -= <span class="number">1</span></span><br><span class="line">            debug += <span class="string">&#x27;G(%d, %d)&#x27;</span> % (<span class="built_in">min</span>(l), i)</span><br><span class="line">            l.remove(<span class="built_in">min</span>(l))</span><br><span class="line">            l.remove(i)</span><br><span class="line">            v += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret *= W(i)</span><br><span class="line">            l.remove(i)</span><br><span class="line">            debug += <span class="string">&#x27;W(%d)&#x27;</span> % i</span><br><span class="line">            nn -= <span class="number">1</span></span><br><span class="line">            u += <span class="number">1</span></span><br><span class="line">    <span class="comment"># print(debug, end = &#x27; &#x27;)</span></span><br><span class="line">    <span class="keyword">return</span> ret, u/<span class="number">2</span> + (sn - v) * a</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">H</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> [(), (<span class="number">1</span>,), (<span class="number">2</span>,), (<span class="number">1</span>, <span class="number">2</span>)]</span><br><span class="line">    ret = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, n+<span class="number">1</span>):</span><br><span class="line">        ret.append((i,))</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, i):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> my_permutations(<span class="built_in">range</span>(<span class="number">1</span>, i), j):</span><br><span class="line">                ret.append(<span class="built_in">tuple</span>(k + [i]))</span><br><span class="line">    <span class="keyword">return</span> H(<span class="number">2</span>) + ret</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CC</span>(<span class="params">exp, n</span>):</span><br><span class="line">    cols = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>&lt;&lt;n)]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># split exp</span></span><br><span class="line">    texps = (<span class="string">&#x27;%s&#x27;</span> % exp.exp1.expand()).strip().split(<span class="string">&#x27; - &#x27;</span>)</span><br><span class="line">    ops = []</span><br><span class="line">    exps = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(texps)):</span><br><span class="line">        <span class="keyword">if</span> texps[i].find(<span class="string">&#x27; + &#x27;</span>) != -<span class="number">1</span>:</span><br><span class="line">            tmp = texps[i].split(<span class="string">&#x27; + &#x27;</span>)</span><br><span class="line">            ops.append(<span class="number">0</span>)</span><br><span class="line">            exps.append(tmp[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(tmp)):</span><br><span class="line">                ops.append(<span class="number">1</span>)</span><br><span class="line">                exps.append(tmp[i])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ops.append(<span class="number">0</span>)</span><br><span class="line">            exps.append(texps[i])</span><br><span class="line">    <span class="keyword">if</span> exps[<span class="number">0</span>][<span class="number">0</span>] == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(exps)):</span><br><span class="line">            ops[i] = <span class="number">1</span>-ops[i]</span><br><span class="line">        exps[<span class="number">0</span>] = exps[<span class="number">0</span>][<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ops[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    <span class="comment"># find e and N</span></span><br><span class="line">    l = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(exps)):</span><br><span class="line">        tmp = <span class="number">1</span> <span class="keyword">if</span> ops[i] <span class="keyword">else</span> -<span class="number">1</span></span><br><span class="line">        en = []</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> j &lt; <span class="built_in">len</span>(exps[i]):</span><br><span class="line">            <span class="keyword">if</span> exps[i][j] == <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">                num = <span class="number">0</span></span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">                <span class="keyword">while</span> isdigit(exps[i][j]):</span><br><span class="line">                    num = num*<span class="number">10</span> + <span class="built_in">int</span>(exps[i][j])</span><br><span class="line">                    j += <span class="number">1</span></span><br><span class="line">                tmp *= <span class="built_in">eval</span>(<span class="string">&#x27;e%d&#x27;</span> % num)</span><br><span class="line">                en.append(num)</span><br><span class="line">            <span class="keyword">elif</span> exps[i][j] == <span class="string">&#x27;N&#x27;</span>:</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">                num = <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> exps[i][j] == <span class="string">&#x27;^&#x27;</span>:</span><br><span class="line">                    j += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">while</span> isdigit(exps[i][j]):</span><br><span class="line">                        num = num*<span class="number">10</span> + <span class="built_in">int</span>(exps[i][j])</span><br><span class="line">                        j += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">                    num = <span class="number">1</span></span><br><span class="line">                tmp *= <span class="built_in">eval</span>(<span class="string">&#x27;N**%d&#x27;</span> % num)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> tmp == <span class="number">1</span> <span class="keyword">or</span> tmp == -<span class="number">1</span>:</span><br><span class="line">            l.append((<span class="number">0</span>, ()))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l.append((tmp, <span class="built_in">tuple</span>(<span class="built_in">sorted</span>(en))))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># construct h</span></span><br><span class="line">    mp = H(n)</span><br><span class="line">    <span class="keyword">for</span> val, en <span class="keyword">in</span> l:</span><br><span class="line">        cols[mp.index(en)] = val</span><br><span class="line">    <span class="comment">#print(cols)</span></span><br><span class="line">    <span class="keyword">return</span> cols</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">EWA</span>(<span class="params">n, elist, NN, alpha</span>):</span><br><span class="line">    mp = H(n)</span><br><span class="line">    var(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    S = [X_Complex(n*a)]</span><br><span class="line">    cols = [[<span class="number">1</span> <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^n)]]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> mp[<span class="number">1</span>:]:</span><br><span class="line">        eL, s = R(i, n)</span><br><span class="line">        cols.append(CC(eL, n))</span><br><span class="line">        S.append(X_Complex(s))</span><br><span class="line">    </span><br><span class="line">    alphaA,alphaB = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> S:</span><br><span class="line">        alphaA = <span class="built_in">max</span>(i.a, alphaA)</span><br><span class="line">        alphaB = <span class="built_in">max</span>(i.b, alphaB)</span><br><span class="line">    <span class="comment">#print(alphaA, alphaB)</span></span><br><span class="line">    D = [<span class="built_in">int</span>(NN^((alphaA-S[i].a)*alpha + (alphaB - S[i].b))) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(S))]</span><br><span class="line">    <span class="comment">#print(D)</span></span><br><span class="line">    kw = &#123;<span class="string">&#x27;N&#x27;</span>: NN&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(elist)):</span><br><span class="line">        kw[<span class="string">&#x27;e%d&#x27;</span> % (i+<span class="number">1</span>)] = elist[i]</span><br><span class="line">    <span class="built_in">print</span>(cols)</span><br><span class="line">    B = Matrix(ZZ, Matrix(cols).T(**kw)) * diagonal_matrix(ZZ, D)</span><br><span class="line">    L = B.LLL(<span class="number">0.5</span>)</span><br><span class="line">    v = Matrix(ZZ, L[<span class="number">0</span>])</span><br><span class="line">    x = v * B**(-<span class="number">1</span>)</span><br><span class="line">    phi = <span class="built_in">int</span>(x[<span class="number">0</span>,<span class="number">1</span>]/x[<span class="number">0</span>,<span class="number">0</span>]*elist[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> phi</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">NN, elist, alpha</span>):</span><br><span class="line">    phi = EWA(<span class="built_in">len</span>(elist), elist, NN, alpha)</span><br><span class="line">    <span class="built_in">print</span>(phi)</span><br><span class="line"></span><br><span class="line">elist = [ ]</span><br><span class="line">NN=</span><br><span class="line">alpha = <span class="number">400.</span>/<span class="number">2048</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(elist)+<span class="number">1</span>):</span><br><span class="line">    var(<span class="string">&quot;e%d&quot;</span> % i)</span><br><span class="line">    var(<span class="string">&quot;d%d&quot;</span> % i)</span><br><span class="line">    var(<span class="string">&quot;k%d&quot;</span> % i)</span><br><span class="line">g, N, s = var(<span class="string">&#x27;g&#x27;</span>), var(<span class="string">&#x27;N&#x27;</span>), var(<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(elist)):</span><br><span class="line">    elist[i] = Integer(elist[i])</span><br><span class="line">attack(NN, elist, alpha)</span><br><span class="line">phi = </span><br><span class="line">c= </span><br><span class="line">d=inverse(<span class="number">65537</span>,<span class="built_in">int</span>(phi))</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,NN)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.ctfer.vip/#/note/set/wp/51">è¥¿æ¹–è®ºå‰‘ 2021 - WienerStudyTwice</a></p></li><li><p>å‚è€ƒPaper</p><p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2009/037.pdf">Common Modulus Attacks on Small Private Exponent RSA and Some Fast Variants (in Practice)</a></p><p><a target="_blank" rel="noopener" href="https://0xdktb.top/2020/05/04/WriteUp-De1CTF2020-Crypto/howgrave-graham1999.pdf">Extending Wienerâ€™s Attack in the Presence of Many Decrypting Exponents</a></p></li></ul><p>â€‹</p><h4 id="å¤šé¡¹å¼RSA"><a href="#å¤šé¡¹å¼RSA" class="headerlink" title="å¤šé¡¹å¼RSA"></a>å¤šé¡¹å¼RSA</h4><p>åœ¨æ•´æ•°RSAåŸç†åŸºç¡€ä¸Šå°†å¤šé¡¹å¼ä»£å…¥åˆ†æï¼š</p><p>åœ¨æœ‰é™åŸŸä¸Šé€‰å–ä¸¤ä¸ªä¸å¯çº¦å¤šé¡¹å¼ $g(p),g(q)$ï¼Œ$g(n)=g(p) \cdot g(q)$ï¼Œè®¡ç®—å‡º $g(n)$ çš„æ¬§æ‹‰å‡½æ•° $\varphi(g(n))=\varphi$ï¼Œ</p><p>é€‰å–ä¸€ä¸ªæ•´æ•° $e$ ä½œä¸ºå…¬é’¥ï¼Œ$e$ ä¸ $\varphi$ æ˜¯äº’ç´ çš„ï¼Œé‚£ä¹ˆå¯¹äºæ˜æ–‡ $g(m)$ï¼ŒåŠ å¯†è¿‡ç¨‹ä¸º $g(m)^e \equiv g(c) \pmod {g(n)}$ï¼Œ</p><p>è®¡ç®—ç§é’¥ $d$ æ»¡è¶³ $ed \equiv 1 \pmod \varphi$ï¼Œåˆ™ $g(c)^d \equiv (g(m)^e)^d \equiv g(m)^{ed} \equiv g(m)^{\varphi+1} \pmod {g(n)}$ï¼Œ</p><p>åŒæ ·è€ƒè™‘ $g(n)$ ä¸ $g(m)$ äº’ç´ ï¼Œæ¬§æ‹‰å®šç†å¯¹äºå¤šé¡¹å¼äº¦æˆç«‹ï¼Œ</p><p>å¾—åˆ° $g(m)^{\varphi+1} \equiv g(m) \pmod {g(n)}$ï¼Œæ‰€ä»¥ $g(c)^d \equiv g(m) \pmod {g(n)}$ã€‚</p><p>æ˜¾ç„¶RSAå¯¹äºæ•´æ•°çš„ä½“åˆ¶å¯ä»¥é€‚ç”¨äºæœ‰é™åŸŸä¸Šçš„å¤šé¡¹å¼ã€‚</p><p><strong>â˜…æ³¨æ„ï¼š</strong></p><p>å¯¹äºç´ æ•° $x$ï¼Œ$\varphi(x)=x-1$ï¼Œä½†æ˜¯å¯¹äºä¸å¯çº¦å¤šé¡¹å¼ $g(x)$ï¼Œ$\varphi(g(x))=p^n-1$ã€‚ï¼ˆæ­¤ $p$ ä¸º $GF(p)$ çš„æ¨¡ï¼Œæ­¤ $n$ ä¸ºå¤šé¡¹å¼æœ€é«˜é¡¹æ¬¡æ•°ï¼‰</p><p>åŸå› ï¼š</p><p>ç”±æ¬§æ‹‰å‡½æ•°å®šä¹‰æœ¬èº«ï¼Œæ¬§æ‹‰å‡½æ•°æ˜¯å°äº $n$ çš„æ‰€æœ‰ä¸ $n$ äº’è´¨çš„æ•°çš„ä¸ªæ•°ã€‚</p><p>å¤šé¡¹å¼çš„æ¬§æ‹‰å‡½æ•°åˆ™ç±»ä¼¼ï¼Œè¡¨ç¤ºä¸é«˜äº $g(x)$ å¹‚çº§çš„ç¯å†…æ‰€æœ‰å¤šé¡¹å¼ä¸­ï¼Œä¸ $g(x)$ æ— å…¬å› å¼ï¼ˆé1ï¼‰çš„å…¶ä»–å¤šé¡¹å¼çš„ä¸ªæ•°ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªä¸é«˜äº $g(x)$ å¹‚çº§çš„ç¯å†…å¤šé¡¹å¼ï¼ˆé™¤äº†å®ƒè‡ªå·±ï¼‰å‡æ»¡è¶³æ­¤æ¡ä»¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è„šæœ¬1</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="comment">#å·²çŸ¥p,n,m^e</span></span><br><span class="line">p= </span><br><span class="line">P = PolynomialRing(Zmod(p), name = <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">x = P.gen()</span><br><span class="line">e = </span><br><span class="line">n = </span><br><span class="line">c =</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ†è§£N</span></span><br><span class="line">q1, q2 = n.factor()</span><br><span class="line">q1, q2 = q1[<span class="number">0</span>], q2[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ±‚Ï†ï¼Œæ³¨æ„æ±‚æ³•ï¼Œ</span></span><br><span class="line">phi = (p**q1.degree() - <span class="number">1</span>) * (p**q2.degree() - <span class="number">1</span>)</span><br><span class="line"><span class="keyword">assert</span> gcd(e, phi) == <span class="number">1</span></span><br><span class="line">d = inverse_mod(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å–å¤šé¡¹å¼ç³»æ•°</span></span><br><span class="line">flag = <span class="built_in">bytes</span>(m.coefficients())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag: &quot;</span>, flag.decode())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è„šæœ¬2</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="comment">#å·²çŸ¥p=2,n,e,c</span></span><br><span class="line">p = </span><br><span class="line">P = PolynomialRing(GF(p), name = <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">x = P.gen()</span><br><span class="line">e = </span><br><span class="line">n = </span><br><span class="line">R.&lt;a&gt; = GF(<span class="number">2</span>^<span class="number">2049</span>)</span><br><span class="line">c = []</span><br><span class="line"></span><br><span class="line">q1, q2 = n.factor()</span><br><span class="line">q1, q2 = q1[<span class="number">0</span>], q2[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">phi = (p**q1.degree() - <span class="number">1</span>) * (p**q2.degree() - <span class="number">1</span>)</span><br><span class="line"><span class="keyword">assert</span> gcd(e, phi) == <span class="number">1</span></span><br><span class="line">d = inverse_mod(e, phi)</span><br><span class="line"></span><br><span class="line">ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> cc <span class="keyword">in</span> c:</span><br><span class="line">    cc = P(R.fetch_int(cc))</span><br><span class="line">    m = <span class="built_in">pow</span>(cc,d,n)</span><br><span class="line">    m = R(P(m)).integer_representation()</span><br><span class="line">    <span class="built_in">print</span>(m)</span><br><span class="line">    ans += <span class="built_in">chr</span>(m)</span><br><span class="line"><span class="built_in">print</span>(ans)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="comment">#x.nbits()==2^32</span></span><br><span class="line">poly = <span class="built_in">sum</span>(e * x^i <span class="keyword">for</span> i,e <span class="keyword">in</span> <span class="built_in">enumerate</span>(Integer(n).digits(<span class="number">2</span>^<span class="number">32</span>)))</span><br><span class="line">(p, _), (q, _) = poly.factor_list()</span><br><span class="line">p, q = p(x=<span class="number">2</span>^<span class="number">32</span>), q(x=<span class="number">2</span>^<span class="number">32</span>)</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4545">0ctf - babyrsa</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/cccchhhh6819/article/details/103563019">watevrCTF 2019 - Swedish RSA</a></p><p><a target="_blank" rel="noopener" href="https://github.com/S3v3ru5/CTF-writeups/tree/master/Inctfi-2020">InCTF 2020 - PolyRSA</a></p><p><a target="_blank" rel="noopener" href="http://www.diva-portal.se/smash/get/diva2:823505/FULLTEXT01.pdf">Polynomial based RSA</a></p><p>Crypto CTF2020 - Decent RSA</p><p>SecurityFest CTF 2022 - small rsa</p><p>â€‹</p><h4 id="Weak-prime-factors-ï¼ˆpå…·çº¿æ€§ç‰¹å¾ï¼‰"><a href="#Weak-prime-factors-ï¼ˆpå…·çº¿æ€§ç‰¹å¾ï¼‰" class="headerlink" title="Weak prime factors ï¼ˆpå…·çº¿æ€§ç‰¹å¾ï¼‰"></a>Weak prime factors ï¼ˆpå…·çº¿æ€§ç‰¹å¾ï¼‰</h4><p><strong>é€‚ç”¨æƒ…å†µï¼š$p$ æ»¡è¶³ $ap=u_0+M_1u_1+\cdots+M_ku_k$</strong></p><p>å…ˆæ ¹æ® $n$ ç¡®å®š $M$ çš„å¤§å°ï¼Œå†æ ¹æ® $M$ é€‰å–ç¬¦åˆè¦æ±‚çš„ $k$ å’Œ $c$ï¼Œç„¶åæ„é€ ä¸€ä¸ªæ ¼å¦‚ä¸‹ï¼š</p><p>$M(\mathcal{L})=\begin{bmatrix}{1}&amp;{0}&amp;{0}&amp;{\cdots}&amp;{0}&amp;{CM^{2k}} \newline<br>{0}&amp;{1}&amp;{0}&amp;{\cdots}&amp;{0}&amp;{CM^{2k-1}} \newline {\vdots}&amp;{\vdots}&amp;{\vdots}&amp;{\ddots}&amp;{\vdots}&amp;{\vdots} \newline {0}&amp;{0}&amp;{0}&amp;{\cdots}&amp;{1}&amp;{CM} \newline {0}&amp;{0}&amp;{0}&amp;{\cdots}&amp;{0}&amp;{-CN} \newline \end{bmatrix}$</p><p>ç”¨LLLç®—æ³•è¿›è¡Œæ ¼åŸºè§„çº¦ï¼Œå°†è§„çº¦åçš„æŸä¸ªå‘é‡ä½œä¸ºå¤šé¡¹å¼ç³»æ•°ï¼Œå†å¯¹å¤šé¡¹å¼è¿›è¡Œåˆ†è§£ï¼Œå³å¯å®Œæˆå¯¹ $n$ çš„åˆ†è§£ã€‚</p><ul><li><p>å‚è€ƒ</p><p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2015/398.pdf">Factoring RSA moduli with weak prime factors</a></p><p>N1CTF2020 - easyRSA</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">success</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack_weak_prime</span>(<span class="params">basenum, exp, n</span>):</span><br><span class="line">    m = basenum^exp</span><br><span class="line">    k = <span class="built_in">len</span>(n.<span class="built_in">str</span>(base=basenum))//(<span class="number">2</span>*exp) + <span class="number">1</span></span><br><span class="line">    c = gmpy2.iroot(<span class="number">2</span>*k^<span class="number">3</span>, <span class="built_in">int</span>(<span class="number">2</span>))</span><br><span class="line">    <span class="comment"># assert c[1] == True</span></span><br><span class="line">    tmp = <span class="built_in">int</span>(c[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">1</span>, tmp)):</span><br><span class="line">            amount = <span class="number">2</span>*k+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">            M = Matrix(RationalField(), amount, amount)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(amount):</span><br><span class="line">                M[i, i] = <span class="number">1</span></span><br><span class="line">                M[i, amount-<span class="number">1</span>] = c*m^(<span class="number">2</span>*k-i)</span><br><span class="line">            M[amount-<span class="number">1</span>, amount-<span class="number">1</span>] = -c*n</span><br><span class="line"></span><br><span class="line">            new_basis = M.LLL(delta=<span class="number">0.75</span>)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(amount):</span><br><span class="line">                last_row = <span class="built_in">list</span>(new_basis[j])</span><br><span class="line">                last_row[-<span class="number">1</span>] = last_row[-<span class="number">1</span>]//(-c)</span><br><span class="line"></span><br><span class="line">                poly = <span class="built_in">sum</span>(e * x^(k*<span class="number">2</span>-i) <span class="keyword">for</span> i,e <span class="keyword">in</span> <span class="built_in">enumerate</span>(last_row))</span><br><span class="line">                fac = poly.factor_list()</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(fac) == <span class="number">2</span>:</span><br><span class="line">                    p_poly, q_poly = fac</span><br><span class="line">                    p_coefficient = p_poly[<span class="number">0</span>].<span class="built_in">list</span>()</span><br><span class="line">                    q_coefficient = q_poly[<span class="number">0</span>].<span class="built_in">list</span>()</span><br><span class="line">                    ap = <span class="built_in">sum</span>(m^i * j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">enumerate</span>(p_coefficient))</span><br><span class="line">                    bq = <span class="built_in">sum</span>(m^i * j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">enumerate</span>(q_coefficient))</span><br><span class="line">                    p = gcd(ap, n)</span><br><span class="line">                    q = gcd(bq, n)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (p*q == n) <span class="keyword">and</span> (p != <span class="number">1</span>) <span class="keyword">and</span> (q != <span class="number">1</span>):</span><br><span class="line">                        <span class="keyword">raise</span> success</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;p =&#x27;</span>, p)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;q =&#x27;</span>, q)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;p*q == n ?&#x27;</span>, <span class="built_in">bool</span>(p*q == n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;[+] Weak Prime Factorization Start!&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;-------------------------------------------------------------------------------------------------------------------------------&#x27;</span>)</span><br><span class="line">    basenum, exp = (<span class="number">3</span>, <span class="number">66</span>)</span><br><span class="line">    n = <span class="number">32846178930381020200488205307866106934814063650420574397058108582359767867168248452804404660617617281772163916944703994111784849810233870504925762086155249810089376194662501332106637997915467797720063431587510189901</span></span><br></pre></td></tr></table></figure><p>â€‹</p><h4 id="på¤šæ¬¡å¹‚å› å­"><a href="#på¤šæ¬¡å¹‚å› å­" class="headerlink" title="på¤šæ¬¡å¹‚å› å­"></a>på¤šæ¬¡å¹‚å› å­</h4><p><strong>é€‚ç”¨æƒ…å†µï¼š</strong>$N=p^rq$</p><ul><li><p><strong>æƒ…å½¢1</strong></p><p>æ¡ä»¶ï¼š$(N,e)$ æ»¡è¶³ $ex-\varphi(N)y=z$ï¼Œå…¶ä¸­ $x$ ä¸ $\lvert z \rvert$ ä¸ºå°å‚æ•°ã€‚</p><p>$f(x) = ex-z \equiv 0 \pmod {p^{r-1}}$</p><p>è®¡ç®— $\gcd(ex - z,N)=g$ï¼Œåˆ™</p><p>$p = \begin{cases} g^{\frac{1}{r-1}},\text{if } g=p^{r-1} \newline g^{\frac{1}{r}},\text{if } g=p^{r} \newline \frac{N}{g},\text{if } g=p^{r-1}q \end{cases}$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">P.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = e * x - b</span><br><span class="line">root = f.monic().small_roots(X=<span class="number">2</span>**<span class="number">672</span>,beta=<span class="number">0.75</span>)[<span class="number">0</span>]</span><br><span class="line">g = gcd(<span class="built_in">int</span>(e * root - b),n3)</span><br></pre></td></tr></table></figure></li><li><p><strong>æƒ…å½¢2</strong></p><p>æ¡ä»¶ï¼šå° $\lvert d_1-d_2 \rvert$ï¼Œ$\lvert d_1-d_2 \rvert \lt N^{\frac{r(r-1)}{(r+1)^2}}$ã€‚</p><p>$f(x) = e_1e_2(d_1-d_2) - (e_2-e_1) \equiv 0 \pmod {p^{r-1}}$</p><p>ç­‰ä»·äº $g(x) = x-a \equiv 0 \pmod {p^{r-1}}$ï¼Œå…¶ä¸­ $a \equiv (e_2-e_1)(e_1e_2)^{-1} \pmod {N}$ã€‚</p><p>è®¡ç®— $\gcd(e_1e_2x - (e_2-e_1),N)=g$ï¼Œåˆ™</p><p>$p = \begin{cases} g^{\frac{1}{r-1}},\text{if } g=p^{r-1} \newline g^{\frac{1}{r}},\text{if } g=p^{r} \newline \frac{N}{g},\text{if } g=p^{r-1}q \end{cases}$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">P.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = e1*e2*x - e1 + e2</span><br><span class="line">root = f.monic().small_roots(X=<span class="number">2</span>**<span class="number">672</span>,beta=<span class="number">0.75</span>)[<span class="number">0</span>]</span><br><span class="line">g = gcd(<span class="built_in">int</span>(e1*e2*root - e1 + e2),n)</span><br></pre></td></tr></table></figure><p><strong>æƒ…å½¢3</strong></p><p>æ¡ä»¶ï¼š$N_1=p_1^rq_1,N_2=p_2^rq_2$ï¼Œå° $\lvert p_1-p_2 \rvert$ï¼Œ$\lvert p_1-p_2 \rvert \lt \cfrac{p_1}{2rq_1q_2}$ã€‚</p><p>$\left| \cfrac{N_2}{N_1} - \cfrac{q_2}{q_1} \right| = \cfrac{q_1q_2 \lvert p_1^r - p_2^r \rvert}{q_1^2p_1^r} &lt; \cfrac{1}{2q_1^2}$</p><p>åˆ©ç”¨ $\cfrac{N_2}{N_1}$ çš„è¿åˆ†æ•°å±•å¼€å¯¹åº”çš„æ¸è¿›åˆ†æ•°é€¼è¿‘ $\cfrac{q_2}{q_1}$ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cf = continued_fraction(n1/n2)</span><br><span class="line">fracs = cf.convergents()</span><br><span class="line"><span class="keyword">for</span> xx <span class="keyword">in</span> tqdm(fracs):</span><br><span class="line">    q1 = xx.numerator()</span><br><span class="line">    q2 = xx.denominator()</span><br><span class="line">    <span class="keyword">if</span> q1.nbits() <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">511</span>, <span class="number">513</span>) <span class="keyword">and</span> q2.nbits() <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">511</span>, <span class="number">513</span>):</span><br><span class="line">        <span class="keyword">if</span> n1 % q1 == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(q1)</span><br><span class="line">            <span class="keyword">assert</span> n1 % q1 == <span class="number">0</span></span><br><span class="line">            p1 = <span class="built_in">int</span>((n1 // q1)^(<span class="number">1</span>/<span class="number">2</span>))</span><br><span class="line">            p2 = <span class="built_in">int</span>((n2 // q2)^(<span class="number">1</span>/<span class="number">2</span>))</span><br><span class="line">            <span class="keyword">assert</span> p1^<span class="number">2</span> * q1 == n1</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></li></ul><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2015/399.pdf">New attacks on RSA with Moduli $N = p^rq$</a></p><p>D^3CTF 2022 - d3factor</p><p>â€‹</p><h4 id="RSA-CRT"><a href="#RSA-CRT" class="headerlink" title="RSA-CRT"></a>RSA-CRT</h4><ul><li><p><strong>æ•…éšœæ³¨å…¥æ”»å‡»</strong></p><p><strong>RSA-CRT fault attack</strong></p><p>å‡è®¾åœ¨è®¡ç®— $S_q$ æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œ$S_q=m_q^{d_q} \bmod q$ï¼Œ$m_q=m \bmod q$ï¼Œ$d_q=d \bmod (q-1)$ï¼Œ</p><p>æ­£ç¡®ç­¾åï¼š$S=S_p \cdot(q^{-1} \bmod p) \cdot q+S_q \cdot(p^{-1} \bmod q) \cdot p$ï¼Œ</p><p>é”™è¯¯ç­¾åï¼š$\hat{S} = S_p \cdot (q^{-1} \bmod p) \cdot q + \hat{S_q} \cdot (p^{-1} \bmod q) \cdot p$ï¼Œ</p><p>åˆ™ $S - \hat{S} = (S_q - \hat{S_q}) \cdot (p^{-1} \bmod q) \cdot p$ï¼Œå³æœ‰ $p=\gcd(S-\hat{S},N)$ã€‚</p><p>æˆ–ç”±é”™è¯¯ç­¾å $\hat{S}$ï¼Œæœ‰ $p=\gcd(Sâ€™^e-m,N)$ã€‚</p></li><li><p><strong>é”™è¯¯æ¨¡æ”»å‡»</strong></p><p>æœ‰æ˜æ–‡ $m$ ç»å¯¹åº”ç¼–ç åçš„ $\sigma_p = \mu(m)^d \bmod p, \sigma_q = \mu(m)^d \bmod q$ï¼Œç”ŸæˆRSA-CRTç­¾å $\sigma = (\sigma_p\cdot\alpha + \sigma_q\cdot\beta) \bmod N$ï¼Œå…¶ä¸­å‚æ•° $\alpha = q \cdot (q^{-1} \bmod p),\beta = p \cdot (p^{-1} \bmod q)$ã€‚</p><p>åˆ©ç”¨é”™è¯¯æ¨¡æ³¨å…¥æŠ€æœ¯å¾—åˆ°é”™è¯¯ç­¾å $\sigmaâ€™$ï¼Œå³ $\sigmaâ€™ = (\sigma_p\cdot\alpha + \sigma_q\cdot\beta) \bmod Nâ€™$ï¼Œ</p><p>å¯¹ç”Ÿæˆçš„ä¸¤ç§ç­¾å $\sigma$ å’Œ $\sigmaâ€™$ ä½¿ç”¨CRTå¯è®¡ç®—å‡º $v=(\sigma_p\cdot\alpha + \sigma_q\cdot\beta) \bmod (N \cdot Nâ€™)$ã€‚</p><p>é’ˆå¯¹ $l \ge 5$ çš„ç¼–ç åæ¶ˆæ¯è¿›è¡Œåˆ†æï¼Œé€šè¿‡è®¡ç®—ç­¾åå¯¹ $(\sigma,\sigmaâ€™)$ åˆ†è§£ $N$ çš„æ”»å‡»æ–¹æ³•ï¼š</p><ol><li><p>å¯¹æ‰€æœ‰çš„ $i$ï¼Œè®¡ç®—å‡ºå¯¹åº”çš„æ•´æ•° $v_i= \text{CRT}_{N,Nâ€™}(\sigma_i,\sigma_iâ€™)$ï¼Œè¿™äº›å¯¹åº”çš„ $v_i$ æ„æˆ $\mathbb{Z}^l$ ä¸Šçš„å‘é‡ $\mathbf{v}=(v_1,\cdots,v_i)$ï¼›</p></li><li><p>åˆ©ç”¨LLLå®šç†è®¡ç®—å‡ºå‚ç›´äºå‘é‡ $\mathbf{v}$ çš„æ­£äº¤æ ¼ $\mathbf{v}^{\perp}$ çš„è§„çº¦åŸº $\mathbf{b}_1,\cdots,\mathbf{b}_{l-1}$ï¼Œå…¶ä¸­æ‰€æœ‰çš„å‘é‡å’Œæ ¼çš„åˆ†å¸ƒéƒ½æ˜¯åœ¨ $\mathbb{Z}^l$ å†…ã€‚é€šè¿‡å¯¹å­˜åœ¨äº $\mathbb{Z}^{1+l}$ ä¸­çš„æ ¼åº”ç”¨LLLå®šç†ï¼Œå³å¯¹å¦‚ä¸‹çŸ©é˜µä½¿ç”¨LLLå®šç†ï¼š</p><p>$\begin{pmatrix} kv_1 &amp; 1 &amp; &amp; 0 \newline \vdots&amp; &amp; \ddots &amp; \newline kv_l &amp; 0 &amp; &amp; 1 \end{pmatrix}$</p><p>å…¶ä¸­ $k$ ä¸ºåˆé€‚çš„å¤§å¸¸é‡ï¼Œå¹¶å»é™¤è®¡ç®—å‡ºæ¥çš„å‘é‡çš„ç¬¬1ä¸ªå…ƒç´ ï¼›</p></li><li><p>å‰ $l-2$ ä¸ªå‘é‡ $\mathbf{b}_1,\cdots,\mathbf{b}_{l-2}$ å°†ç”Ÿæˆç§©ä¸º $l-2$ çš„æ ¼ $Lâ€™$ï¼Œå†æ¬¡åˆ©ç”¨LLLå®šç†æ¥è®¡ç®—å‡ºæ­£äº¤æ ¼ $(Lâ€™)^{\perp}$ çš„è§„çº¦åŸº $\mathbf{x}â€™,\mathbf{y}â€™$ã€‚åŒæ ·å¯ä»¥é€šè¿‡å¯¹å¦‚ä¸‹çŸ©é˜µä½¿ç”¨LLLå®šç†å¾—åˆ°å¯¹åº”çš„è§„çº¦åŸºï¼š</p><p>$\begin{pmatrix} kâ€™b_{1,1} &amp; \cdots &amp; kâ€™b_{l-2,1} &amp; 1 &amp; &amp; 0 \newline \vdots&amp; &amp; \vdots &amp; &amp; \ddots &amp; \newline kâ€™b_{1,l} &amp; \cdots &amp; kâ€™b_{l-2,l}&amp; 0 &amp; &amp; 1 \end{pmatrix}$</p><p>åŒæ­¥éª¤2ï¼Œä¿ç•™è®¡ç®—å‡ºæ¥çš„å‘é‡çš„æœ€å $l$ ä¸ªå…ƒç´ ï¼›</p></li><li><p>å°†æ‰€æœ‰é•¿åº¦ä¸è¶…è¿‡ $\sqrt{lN}$ çš„å¹¶åœ¨ $(Lâ€™)^{\perp}$ å†…çš„å‘é‡ $\mathbf{z}=a \mathbf{x}â€™+b \mathbf{y}â€™$ åˆ—ä¸¾å‡ºæ¥ï¼Œå¯¹ç¬¦åˆæ¡ä»¶çš„å‘é‡ $\mathbf{z}$ï¼Œè®¡ç®—å‡º $\gcd(\mathbf{v}-\mathbf{z},N)$ï¼Œå¯ä»¥å¾—å‡º $N$ ä¸­ä»»ä½•å¯èƒ½çš„ç´ å› å­ã€‚</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> gmpy2,sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orthogonal_lattice</span>(<span class="params">B</span>):</span><br><span class="line">    LB = B.transpose().left_kernel(basis=<span class="string">&quot;LLL&quot;</span>).basis_matrix()</span><br><span class="line">    <span class="keyword">return</span> LB</span><br><span class="line">    </span><br><span class="line">cs = []</span><br><span class="line">s = []</span><br><span class="line">l = <span class="number">6</span></span><br><span class="line"></span><br><span class="line">v = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cs_)):</span><br><span class="line">    v.append(<span class="built_in">int</span>(crt([s_[i], cs_[i]], [n, N])))</span><br><span class="line">    </span><br><span class="line">v = vector(ZZ, v)</span><br><span class="line">Lv = orthogonal_lattice(Matrix(v))</span><br><span class="line">L1 = orthogonal_lattice(Lv.submatrix(<span class="number">0</span>, <span class="number">0</span>, l-<span class="number">2</span>, l))</span><br><span class="line">x, y = L1</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">333</span>)):</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">333</span>)):</span><br><span class="line">        z = a*x+b*y</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> (v-z):</span><br><span class="line">            tmp =  gcd(each,n)</span><br><span class="line">            <span class="keyword">if</span> tmp&gt;<span class="number">1</span>:</span><br><span class="line">                p = tmp</span><br><span class="line">                <span class="built_in">print</span>(p)</span><br><span class="line">                sys.exit()</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2011/388.pdf">Modulus Fault Attacks Against RSA-CRT Signatures</a></p><p>2022å·…å³°æå®¢ - Learning with Fault</p></li></ul><p>â€‹</p><h4 id="å…¶ä»–ç‰¹åˆ«æƒ…å½¢"><a href="#å…¶ä»–ç‰¹åˆ«æƒ…å½¢" class="headerlink" title="å…¶ä»–ç‰¹åˆ«æƒ…å½¢"></a>å…¶ä»–ç‰¹åˆ«æƒ…å½¢</h4><ul><li><h5 id="å¤šç´ æ•°å› å­ï¼ˆMulti-prime-RSAï¼‰"><a href="#å¤šç´ æ•°å› å­ï¼ˆMulti-prime-RSAï¼‰" class="headerlink" title="å¤šç´ æ•°å› å­ï¼ˆMulti-prime RSAï¼‰"></a>å¤šç´ æ•°å› å­ï¼ˆMulti-prime RSAï¼‰</h5><p>$n=p_1^{k_1}p_2^{k_2}\cdots p_m^{k_m} \\ \Rightarrow \begin{eqnarray}\varphi(n) &amp;=&amp;\varphi(p_1^{k_1})\varphi(p_2^{k_2}) \cdots \varphi(p_m^{k_m}) \\ &amp;=&amp;(p_1^{k_1-1}\cdot(p_1-1))(p_2^{k_2-1}\cdot(p_2-1)) \cdots (p_m^{k_m-1}\cdot(p_m-1)) \end{eqnarray}$</p><p>â€‹</p></li><li><h5 id="next-prime"><a href="#next-prime" class="headerlink" title="next_prime()"></a>next_prime()</h5><blockquote><p>æ ¹æ®ç´ æ•°å®šç†ï¼Œç´ æ•°çš„å¹³å‡é—´éš”ä¸ºï¼š$\cfrac{x}{\pi(x)} \approx \ln(x)$ï¼Œå› æ­¤å¸¸è§çš„ä¸‹ä¸€ä¸ªç´ æ•°æ¯”å½“å‰ç´ æ•°å¤§ä¸€ç‚¹ï¼Œä¸€èˆ¬ä¸ä¼šè¶…è¿‡1500ã€‚</p></blockquote><ul><li><p><strong>å˜ç§1</strong>ï¼š$n=p \cdot q \cdot \text{nextprime}(p) \cdot \text{nextprime}(q)$</p><p><a href="https://lazzzaro.github.io/2020/05/10/crypto-crypto%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95/#%E8%B4%B9%E9%A9%AC%E5%9B%A0%E5%BC%8F%E5%88%86%E8%A7%A3">è´¹é©¬å› å¼åˆ†è§£</a>ã€‚</p></li></ul><p>â€‹</p></li><li><p><strong>ç»™ e,p,c</strong></p><p>$c \equiv m^e \pmod n \\\Leftrightarrow c_1 \equiv c \pmod p \equiv m^e \pmod p$</p><p>ä»¤ $ed_1 \equiv 1 \pmod {(p-1)}$ï¼Œæœ‰ $m \equiv c^d \pmod n \equiv c_1^{d_1} \pmod p$ã€‚</p><p>â€‹</p></li><li><h5 id="ç»™-e-d-modinv-q-p-c"><a href="#ç»™-e-d-modinv-q-p-c" class="headerlink" title="ç»™ e,d,modinv(q,p),c"></a><strong>ç»™ e,d,modinv(q,p),c</strong></h5><p>å·²çŸ¥ï¼š$p,q$ åŒæ¯”ç‰¹ä½æ•°ã€‚</p><p>ä»¤ $cf=q^{-1} \bmod p$ï¼Œæœ‰ $q\cdot cf=1 \pmod p$ã€‚</p><ul><li><p>$ed=1+k(p-1)(q-1)$ï¼Œ</p><p>æ¯”è¾ƒæ¯”ç‰¹ä½æ•°ï¼Œ$k$ ä¸ $e$ åŒé•¿ï¼Œå¯çˆ†ç ´ $k$ï¼Œå¾— $\varphi(n)=(p-1)(q-1)=\cfrac{ed-1}{k}$ï¼›</p></li><li><p>ä¸Šå¼ $\varphi(n) =(p-1)(q-1) \pmod p=-(q-1) \pmod p$ï¼Œ</p><p>ç»“åˆ $q\cdot cf=1 \pmod p$ï¼Œå³ $q\cdot cf-1=0 \pmod p$ï¼Œ</p><p>è”ç«‹ï¼š</p><p>$\begin{eqnarray} \varphi(n)&amp;=&amp;(p-1)(q-1)\\&amp;=&amp;pq-p-q+1\\&amp;=&amp;n-p-q+1 \end{eqnarray}$</p><p>$\begin{eqnarray} cf\cdot \varphi(n)&amp;=&amp;cf\cdot(n-p-q+1)\\&amp;=&amp;cf\cdot n-cf\cdot p-cf\cdot q+cf \end{eqnarray}$</p><p>$\begin{eqnarray} cf\cdot \varphi(n) \bmod p&amp;=&amp;(cf\cdot n-cf\cdot p-cf\cdot q+cf) \bmod p\\&amp;=&amp;0-0-(cf\cdot q)+cf \bmod p\\&amp;=&amp;-1+cf \bmod p \end{eqnarray}$</p><p>æœ‰ $1+cf\cdot \varphi(n)-cf=0\pmod p$ï¼Œ</p><p>å³$x=1+cf\cdot \varphi(n)-cf$ èƒ½è¢« $p$ æ•´é™¤ï¼›</p></li><li><p>ç”±è´¹é©¬å°å®šç†ï¼Œå­˜åœ¨ $r$ æ»¡è¶³ $r^{p-1}=1 \pmod p$ï¼Œ</p><p>$\begin{eqnarray}r^{\varphi(n)}&amp;=&amp;(r^{(p-1)})^{(q-1)}\\&amp;=&amp;1^{(q-1)} \pmod p\\&amp;=&amp;1 \pmod p \end{eqnarray}$ï¼Œ</p><p>å› å¯¹äºä»»æ„ $r,k_1,k_2$ï¼Œå½“ $k_2$ ä¸º $k_1$ å› å­æ—¶ï¼Œ$r \bmod k_2=(r \bmod k_1) \bmod k_2$ï¼Œ</p><p>æ•… $r^{\varphi(n)} \bmod p=(r^{\varphi(n)} \bmod x) \bmod p=1 \bmod p=kp$ï¼Œ</p><p>å·²çŸ¥ $\varphi(n)$ï¼Œç”± $(r^{\varphi(n)} \bmod x) \bmod p=kp$ å¯å¾—åˆ°å¤šç»„ $p$ çš„ä¹˜ç§¯ï¼Œè®¡ç®— $\gcd$ å¯å¾—åˆ° $p$ï¼›</p></li><li><p>ç”± $q\cdot cf=1 \pmod p$ æ±‚æ¨¡é€†å¯å¾— $q$ï¼Œå†ç”¨ $c$ è®¡ç®—å‡º $m$ã€‚</p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://gist.github.com/n-ari/a2db9af7fd3c172e4fa65b923a66beff">TSG CTF 2020 - Modulus Amittendus</a></p></li></ul><p>â€‹</p></li><li><h5 id="gcd-e-Ï†-n-â‰ -1"><a href="#gcd-e-Ï†-n-â‰ -1" class="headerlink" title="gcd(e,Ï†(n)) â‰  1"></a><strong>gcd(e,Ï†(n)) â‰  1</strong></h5><p>$\gcd(e,\varphi(n))\neq 1$ æ—¶ï¼Œ$e$ ä¸ $\varphi(n)$ ä¸äº’ç´ ï¼Œ</p><p>$m^e \equiv (m^{\gcd(e,\varphi(n))})^{\frac{e}{\gcd(e,\varphi(n))}} \equiv c \pmod n$ï¼Œè®¡ç®— $\frac{e}{\gcd(e,\varphi(n))}$ çš„æ¨¡é€† $dâ€™$ï¼Œ</p><p>åˆ™ $c^{dâ€™}\equiv m^{\gcd(e,\varphi(n))}\pmod n$ã€‚</p><p>å½“ $\gcd(e,\varphi(n))$ è¾ƒå°æ—¶ï¼Œå¯ä»¥ç›´æ¥å¯¹ $c$ å¼€æ ¹ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š</p><ul><li>$m^e = c&lt;n$ï¼Œè¿™ç§æƒ…å†µç›´æ¥å¯¹ $c$ å¼€ $e$ æ¬¡æ–¹å³å¯ï¼›</li><li>$m^e = c&gt;n$ï¼Œè¿™ç§æƒ…å†µéœ€è¦åœ¨æœ‰é™åŸŸä¸‹å¯¹ $c$ å¼€æ–¹ï¼Œä¸€èˆ¬å…ˆè®¡ç®— $c_p=c \bmod p$ï¼Œ$c_q=c \bmod q$ï¼Œåˆ†åˆ«æ±‚å‡º $c_p,c_q$ åœ¨ $c$ ä¸‹çš„ $e$ æ¬¡æ ¹ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼‰ï¼Œç„¶åä½¿ç”¨CRTéå†æ‰€æœ‰ç»„åˆï¼Œåˆ†åˆ«checkå¾—å‡ºæ˜æ–‡ã€‚</li></ul><p>å½“ $\gcd(e,\varphi(n))$ è¾ƒå¤§æ—¶ï¼Œæ±‚ $p,q$ çš„ $e$ æ¬¡æ ¹æ­¥éª¤éœ€è¦æ›¿æ¢ä¸ºä¸€äº›æœ‰é™åŸŸå¼€æ ¹çš„é«˜æ•ˆç®—æ³•ï¼ˆå¦‚AMMç®—æ³•ç­‰ï¼‰è¿›è¡Œè®¡ç®—ã€‚</p><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://github.com/De1ta-team/De1CTF2019/blob/master/writeup/crypto/Baby%20Rsa/README_zh.md">De1CTF2019 - Baby RSA</a></p><p><a target="_blank" rel="noopener" href="https://github.com/p4-team/ctf/tree/master/2016-03-12-0ctf/rsa">0ctf 2016 - RSA?</a></p><p>â€‹</p></li><li><h5 id="e-p-1-e-q-1"><a href="#e-p-1-e-q-1" class="headerlink" title="e|(p-1), e|(q-1)"></a><strong>e|(p-1), e|(q-1)</strong></h5><p>ä¸Šé¢çš„ $\gcd(e,\varphi(n))\neq 1$ æƒ…å†µä¸é’ˆå¯¹ $\gcd(e,\varphi(n))= e$ï¼Œè¿™é‡Œå¯¹ $e\mid (p-1),e\mid (q-1)$ çš„ç‰¹æ®Šæƒ…å†µè¿›è¡Œè®¨è®ºã€‚</p><p>è§£é¢˜æ€è·¯å³æ±‚è§£ $m \bmod p$ å’Œ $m \bmod q$ ï¼Œå†é€šè¿‡CRTè¿˜åŸ $m \bmod n$ã€‚ä¸»è¦éš¾ç‚¹åˆ™æ˜¯åœ¨ $\text{GF}(p)$ ä¸Šæ±‚ $e$ æ¬¡æ ¹ã€‚</p><p>åœ¨æœ‰é™åŸŸä¸Šæ±‚r-th rootæœ‰ä¸¤ä¸ªå¸¸è§ç®—æ³•ï¼ˆAdleman-Manders-Miller algorithmå’ŒCipolla-Lehmer algorithmï¼‰ï¼ŒNamhun Kooæå‡ºä¸€ç§æ›´å…·ä¸€èˆ¬æ€§çš„å¼€æ ¹ç®—æ³•ï¼Œä¸”åœ¨ $s$ è¶³å¤Ÿå°çš„æ—¶å€™æ›´é«˜æ•ˆï¼ˆ$r^{s}\mid (p-1),r^{s}\nmid (p-1)$ï¼‰ã€‚</p><p>â˜…<strong>å‚è€ƒ</strong>ï¼š<a target="_blank" rel="noopener" href="http://yulige.top/?p=752#easyRSA909pt_2solvers">NCTF 2019 - easyRSA</a> ï¼ˆ<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1111.4877.pdf">Adleman-Manders-Miller rth Root Extraction Method</a>ï¼‰</p><p>æœ¬é¢˜åˆ™ä¸º $e$ å’Œ $p-1$ ï¼ˆæˆ– $q-1$ï¼‰çš„æœ€å¤§å…¬çº¦æ•°å°±æ˜¯ $e$ æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯è¯´ $e\mid (p-1)$ï¼Œåªæœ‰å¯¹ $c$ å¼€ $e$ æ¬¡æ–¹æ ¹æ‰è¡Œã€‚</p><p>å¯ä»¥å°†åŒä½™æ–¹ç¨‹ $m^e \equiv c \pmod n$ åŒ–æˆ</p><p>$\begin{cases} m^e \equiv c \pmod p \\ m^e \equiv c \pmod q \end{cases}$</p><p>ç„¶ååˆ†åˆ«åœ¨ $\text{GF}(p)$ å’Œ $\text{GF}(q)$ ä¸Šå¯¹ $c$ å¼€ $e$ æ¬¡æ–¹æ ¹ï¼Œå†ç”¨CRTç»„åˆä¸€ä¸‹å³å¯å¾—åˆ°åœ¨ $\bmod n$ ä¸‹çš„è§£ã€‚</p><p>é—®é¢˜æ˜¯ï¼Œ<strong>å¦‚ä½•åœ¨æœ‰é™åŸŸå†…å¼€æ ¹</strong>ï¼Ÿ</p><p>è¿™é‡Œ $e$ ä¸ $p-1$ å’Œ $q-1$ éƒ½ä¸äº’ç´ ï¼Œä¸èƒ½ç®€å•åœ°æ±‚ä¸ªé€†å…ƒå°±å®Œäº‹ã€‚</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>å¼€å¹³æ–¹æ ¹</strong>å¯ä»¥ç”¨<code>Tonelliâ€“Shanks algorithm</code>ï¼Œ<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Tonelliâ€“Shanks_algorithm">Wiki</a>è¯´è¿™ä¸ªç®—æ³•å¯ä»¥<strong>æ‰©å±•åˆ°å¼€næ¬¡æ–¹æ ¹</strong>ã€‚</p><p>åœ¨è¿™ç¯‡<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1111.4877.pdf">paper</a>é‡Œç»™å‡ºäº†å…·ä½“çš„ç®—æ³•ï¼š<code>Adleman-Manders-Miller rth Root Extraction Method</code>ã€‚</p><p>è¿™ä¸ªç®—æ³•åªèƒ½å¼€å‡ºä¸€ä¸ªæ ¹ï¼Œå®é™…ä¸Šå¼€ $e$ æ¬¡æ–¹ï¼Œæœ€å¤šä¼šæœ‰ $e$ ä¸ªæ ¹ï¼ˆè¿™é¢˜çš„æƒ…å†µä¸‹æœ‰0x1337ä¸ªæ ¹ï¼‰ã€‚</p><p>å¦‚ä½•æ‰¾åˆ°å…¶ä»–æ ¹ï¼Ÿ</p><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6752374/cube-root-modulo-p-how-do-i-do-this">StackOverflow â€“ Cube root modulo P</a> ç»™å‡ºäº†æ–¹æ³•ã€‚</p><p>å¦‚ä½•æ‰¾åˆ°æ‰€æœ‰çš„<code>primitive 0x1337th root of 1</code>?</p><p><a target="_blank" rel="noopener" href="https://crypto.stackexchange.com/questions/63614/finding-the-n-th-root-of-unity-in-a-finite-field">StackExchange â€“ Finding the n-th root of unity in a finite field</a> ç»™å‡ºäº†æ–¹æ³•ã€‚</p><p><strong>Exploit</strong>ï¼ˆä»¥ <code>e=0x1337</code>â€‹ ä¸ºä¾‹ï¼‰</p><ul><li>å…ˆç”¨<code>Adleman-Manders-Miller rth Root Extraction Method</code>åœ¨ $\text{GF}(p)$ å’Œ $\text{GF}(q)$ ä¸Šå¯¹ $c$ å¼€ $e$ æ¬¡æ–¹æ ¹ï¼Œåˆ†åˆ«å¾—åˆ°ä¸€ä¸ªè§£ã€‚å¤§æ¦‚ä¸åˆ°10ç§’ã€‚</li><li>ç„¶åå»æ‰¾åˆ°æ‰€æœ‰çš„<code>0x1336</code>ä¸ª<code>primitive nth root of 1</code>ï¼Œä¹˜ä»¥ä¸Šé¢é‚£ä¸ªè§£ï¼Œå¾—åˆ°æ‰€æœ‰çš„<code>0x1337</code>ä¸ªè§£ã€‚å¤§æ¦‚1åˆ†é’Ÿã€‚</li><li>å†ç”¨CRTå¯¹ $\text{GF}(p)$ å’Œ $\text{GF}(q)$ ä¸Šçš„ä¸¤ç»„<code>0x1337</code>ä¸ªè§£ç»„åˆæˆ $\bmod n$ ä¸‹çš„è§£ï¼Œå¯ä»¥å¾—åˆ°<code>0x1337**2=24196561</code>ä¸ª $\bmod n$ çš„è§£ã€‚æœ€åèƒ½é€šè¿‡<code>check()</code>çš„å³ä¸ºflagã€‚å¤§æ¦‚åå‡ åˆ†é’Ÿã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è„šæœ¬1</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line">c = </span><br><span class="line">p = </span><br><span class="line">q = </span><br><span class="line">e = </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> mp <span class="keyword">in</span> GF(p)(c).nth_root(e, <span class="built_in">all</span>=<span class="literal">True</span>):</span><br><span class="line">    <span class="keyword">for</span> mq <span class="keyword">in</span> GF(q)(c).nth_root(e, <span class="built_in">all</span>=<span class="literal">True</span>):</span><br><span class="line">        m = crt([ZZ(mp), ZZ(mq)], [p, q])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line">            <span class="keyword">if</span> res.isascii():</span><br><span class="line">                <span class="built_in">print</span>(res)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è„šæœ¬2</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># About 3 seconds to run</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM</span>(<span class="params">o, r, q</span>):</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n----------------------------------------------------------------------------------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Start to run Adleman-Manders-Miller Root Extraction Method&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Try to find one &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(r, o, q))</span><br><span class="line">    g = GF(q)</span><br><span class="line">    o = g(o)</span><br><span class="line">    p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="keyword">while</span> p ^ ((q-<span class="number">1</span>) // r) == <span class="number">1</span>:</span><br><span class="line">        p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find p:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s = s // r</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find s:&#123;&#125;, t:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(s, t))</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (k * s + <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alp = (k * s + <span class="number">1</span>) // r</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Find alp:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(alp))</span><br><span class="line">    a = p ^ (r**(t-<span class="number">1</span>) * s)</span><br><span class="line">    b = o ^ (r*alp - <span class="number">1</span>)</span><br><span class="line">    c = p ^ s</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t):</span><br><span class="line">        d = b ^ (r^(t-<span class="number">1</span>-i))</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Calculating DLP...&#x27;</span>)</span><br><span class="line">            j = - discrete_log(a, d)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+] Finish DLP...&#x27;</span>)</span><br><span class="line">        b = b * (c^r)^j</span><br><span class="line">        h = h * c^j</span><br><span class="line">        c = c ^ r</span><br><span class="line">    result = o^alp * h</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Find one solution: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(result))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findAllPRoot</span>(<span class="params">p, e</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Start to find all the Primitive &#123;:#x&#125;th root of 1 modulo &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(e, p))</span><br><span class="line">    start = time.time()</span><br><span class="line">    proot = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(proot) &lt; e:</span><br><span class="line">        proot.add(<span class="built_in">pow</span>(random.randint(<span class="number">2</span>, p-<span class="number">1</span>), (p-<span class="number">1</span>)//e, p))</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> proot</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findAllSolutions</span>(<span class="params">mp, proot, cp, p</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Start to find all the &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(e, cp, p))</span><br><span class="line">    start = time.time()</span><br><span class="line">    all_mp = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> root <span class="keyword">in</span> proot:</span><br><span class="line">        mp2 = mp * root % p</span><br><span class="line">        <span class="keyword">assert</span>(<span class="built_in">pow</span>(mp2, e, p) == cp)</span><br><span class="line">        all_mp.add(mp2)</span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> all_mp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = </span><br><span class="line">p = </span><br><span class="line">q = </span><br><span class="line">e = <span class="number">0x1337</span></span><br><span class="line">cp = c % p</span><br><span class="line">cq = c % q</span><br><span class="line">mp = AMM(cp, e, p)</span><br><span class="line">mq = AMM(cq, e, q)</span><br><span class="line">p_proot = findAllPRoot(p, e)</span><br><span class="line">q_proot = findAllPRoot(q, e)</span><br><span class="line">mps = findAllSolutions(mp, p_proot, cp, p)</span><br><span class="line">mqs = findAllSolutions(mq, q_proot, cq, q)</span><br><span class="line"><span class="built_in">print</span>(mps, mqs)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">m</span>):</span><br><span class="line">    h = m.<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(h) &amp; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">bytes</span>.fromhex(h).startswith(<span class="string">b&#x27;NCTF&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(h))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># About 16 mins to run 0x1337^2 == 24196561 times CRT</span></span><br><span class="line">start = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Start CRT...&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> mpp <span class="keyword">in</span> mps:</span><br><span class="line">    <span class="keyword">for</span> mqq <span class="keyword">in</span> mqs:</span><br><span class="line">        solution = CRT_list([<span class="built_in">int</span>(mpp), <span class="built_in">int</span>(mqq)], [p, q])</span><br><span class="line">        <span class="keyword">if</span> check(solution):</span><br><span class="line">            <span class="built_in">print</span>(solution)</span><br><span class="line">    <span class="built_in">print</span>(time.time() - start)</span><br><span class="line"></span><br><span class="line">end = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br></pre></td></tr></table></figure><p>â€‹</p></li><li><h5 id="SMUPE-é—®é¢˜ï¼ˆä¸åŒN-eåŠ å¯†çº¿æ€§å…³ç³»æ˜æ–‡ï¼‰"><a href="#SMUPE-é—®é¢˜ï¼ˆä¸åŒN-eåŠ å¯†çº¿æ€§å…³ç³»æ˜æ–‡ï¼‰" class="headerlink" title="SMUPE é—®é¢˜ï¼ˆä¸åŒN,eåŠ å¯†çº¿æ€§å…³ç³»æ˜æ–‡ï¼‰"></a><strong>SMUPE é—®é¢˜</strong>ï¼ˆä¸åŒN,eåŠ å¯†çº¿æ€§å…³ç³»æ˜æ–‡ï¼‰</h5><p>a system of univariate polynomial equations problem = ä¸€å…ƒå¤šé¡¹å¼æ–¹ç¨‹ç»„æ±‚è§£é—®é¢˜</p><ul><li><p><strong>å®šä¹‰</strong></p><p>$k$ æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œ$N$ ä¸ºæ»¡è¶³RSAç®—æ³•çš„æ¨¡æ•°ï¼Œ$\delta$ æ˜¯å¤šé¡¹å¼çš„é˜¶ã€‚æœ‰</p><p>$N_i&lt;N_{i+1},\delta_i \in N\quad(i=1,2,\cdots,k)$</p><p>å¤šé¡¹å¼æ–¹ç¨‹ç»„è¡¨ç¤ºå¦‚ä¸‹, ç›®çš„æ˜¯æ±‚è§£ $x$ï¼š</p><p>$\begin{cases} f_1(x)\equiv 0 \pmod {N_1}\newline f_2(x)\equiv 0 \pmod {N_2} \newline {\vdots} \newline f_k(x)\equiv 0 \pmod {N_k} \end{cases}$</p></li><li><p><strong>æ±‚è§£æ¡ä»¶</strong></p><p>Alexander May, Maike Ritzenhofentæå‡ºä¸€ç§æ±‚è§£æ–¹æ³•ï¼Œç®€å•åœ°è¯´å½“å¤šé¡¹å¼çš„é˜¶ $\delta$ æ»¡è¶³ä»¥ä¸‹æƒ…å†µæ—¶å¯è§£ï¼ˆ$\delta$ æ˜¯å¤šé¡¹å¼çš„é˜¶ï¼‰ï¼š</p><p>$\sum\limits_{i=1}^k \cfrac{1}{\delta_i} \geq 1$</p><p><strong>å…·ä½“æè¿°ï¼š</strong></p><p>ä»¤ $(f_i,\delta_i,N_i) \quad(i=1,2,\cdots,k)$ ä½œä¸ºSMUPEé—®é¢˜çš„é¦–ä¸€å¤šé¡¹å¼ç»„ï¼Œ</p><p>å®šä¹‰ $M=\prod\limits_{i=1}^k N_i^{\frac{\delta}{\delta_i}},\delta=\text{lcm}(\delta_i) \quad (i=1,2,\cdots,k)$</p><p>åˆ™SMUPEé—®é¢˜å¯ä»¥åœ¨ $O(\delta^6\cdot \log_2M)$ å¤æ‚åº¦è§£å†³ã€‚</p></li></ul><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6813#toc-9">2019çº¢å¸½æ¯ - ç²¾æ˜çš„Alice</a></p><p>â€‹</p></li><li><h5 id="åç´ æ•°ï¼ˆemirpæ•°ï¼‰"><a href="#åç´ æ•°ï¼ˆemirpæ•°ï¼‰" class="headerlink" title="åç´ æ•°ï¼ˆemirpæ•°ï¼‰"></a>åç´ æ•°ï¼ˆemirpæ•°ï¼‰</h5><p>å·²çŸ¥ï¼š$q=\text{reverse_x}(p)$ï¼Œ$\text{x}$ ä¸ºè¿›åˆ¶æ•°ã€‚</p><p>çˆ†ç ´æ€è·¯ç±»ä¼¼RSA parity oracleã€‚$p,q$ æ˜¯bitç¿»è½¬å…³ç³»ï¼Œå·²çŸ¥ $p$ æœ€ä½çš„ $k$ ä½ï¼Œåˆ™å·²çŸ¥ $q$ æœ€é«˜çš„ $k$ ä½ã€‚</p><p>å‡è®¾å·²çŸ¥ $k$ ä½çš„ $p,q$ï¼Œè®°ä¸º $ph,qh$ï¼Œåˆ©ç”¨ä¸ç­‰å¼</p><p>$ph\cdot qh\cdot 2^{1024-2k}&lt;=n&lt;(ph+1)\cdot(qh+1)\cdot 2^{1024-2k}$ ï¼Œ</p><p>é€ä½å‘ä½åœ°å€çˆ†ç ´ï¼Œä¸æ–­æ”¶ç¼©ä¸ç­‰å¼çš„èŒƒå›´ï¼Œæœ€ç»ˆå¯æ±‚å¾— $n$ å€¼ã€‚</p><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://kt.gy/blog/2015/10/asis-2015-finals-rsasr/">ASIS 2015 Finals: RSASR</a></p><p><a target="_blank" rel="noopener" href="https://mcfx.us/archives/281/#h2-rsa_yay">Midnight Sun CTF 2020 Quals</a></p><p>RoarCTF 2020 - Reverse</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python2</span></span><br><span class="line"><span class="comment">#x=10</span></span><br><span class="line">n = <span class="number">6528060431134312098979986223024580864611046696815854430382374273411300418237131352745191078493977589108885811759425485490763751348287769344905469074809576433677010568815441304709680418296164156409562517530459274464091661561004894449297362571476259873657346997681362092440259333170797190642839587892066761627543</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">t</span>(<span class="params">a, b, k</span>):</span><br><span class="line">	<span class="comment"># sqrt(n) has 155 digits, so we need to figure out 77 digits on each side</span></span><br><span class="line">    <span class="keyword">if</span> k == <span class="number">77</span>:</span><br><span class="line">        <span class="keyword">if</span> a*b == n:</span><br><span class="line">            <span class="built_in">print</span> a, b</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> xrange(<span class="number">10</span>):</span><br><span class="line">			<span class="comment"># we try to guess the last not-already-guessed digits of both primes</span></span><br><span class="line">            a1 = a + i*(<span class="number">10</span>**k) + j*(<span class="number">10</span>**(<span class="number">154</span>-k))</span><br><span class="line">            b1 = b + j*(<span class="number">10</span>**k) + i*(<span class="number">10</span>**(<span class="number">154</span>-k))</span><br><span class="line">            <span class="keyword">if</span> a1*b1 &gt; n:</span><br><span class="line">				<span class="comment"># a1 and b1 are too large</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> (a1+(<span class="number">10</span>**(<span class="number">154</span>-k)))*(b1+(<span class="number">10</span>**(<span class="number">154</span>-k))) &lt; n:</span><br><span class="line">				<span class="comment"># a1 and b1 are too small</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">      <span class="keyword">if</span> ((a1*b1)%(<span class="number">10</span>**(k+<span class="number">1</span>))) != (n%(<span class="number">10</span>**(k+<span class="number">1</span>))):</span><br><span class="line">				<span class="comment"># The last digits of a1*b1 (which won&#x27;t change later) doesn&#x27;t match n</span></span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">			<span class="comment"># this a1 and b1 seem to be a possible match, try to guess remaining digits</span></span><br><span class="line">        t(a1, b1, k+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># the primes have odd number of digits (155), so we try all possible middle digits (it simplifies the code)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">10</span>):</span><br><span class="line">    t(i*(<span class="number">10</span>**<span class="number">77</span>), i*(<span class="number">10</span>**<span class="number">77</span>), <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>â€‹</p></li><li><h5 id="4p-1-method"><a href="#4p-1-method" class="headerlink" title="4p-1 method"></a>4p-1 method</h5><p>å¯¹ä½¿ç”¨ä¸€ç±»ç‰¹å®šç´ æ•°ä¹˜ç§¯çš„æ¨¡æ•°çš„åˆ†è§£ã€‚</p><p>å½“ä¸€ç±»ç‰¹æ®Šçš„ç´ æ•°ç”¨åœ¨ RSA æ¨¡æ•°ä¸­æ—¶ï¼Œå¯ä»¥è½»æ˜“çš„å°†è¯¥ç´ æ•°ä» $n$ ä¸­åˆ†è§£å‡ºæ¥ã€‚ç”±äºè¿™ä¸€ç±»ç´ æ•°éƒ½å½¢å¦‚ $4pâˆ’1=Ds^2$ï¼Œå› æ­¤åˆè¢«ç§°ä¸º <code>4p-1 method</code>ã€‚æ­¤å¤–ï¼Œæœ‰äº›äººä¹Ÿä¼šå°†å…¶è§†ä¸º RSA çš„åé—¨ä¹‹ä¸€ï¼Œç§°ä¹‹ä¸º <code>RSA backdoor</code>ã€‚</p><ul><li><p><strong>QiCheng Prime</strong></p><p>$Ds=\{3,11,19,43,67,163\}$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">sys.setrecursionlimit(<span class="number">10</span>^<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">QiCheng</span>(<span class="params">n</span>):</span><br><span class="line">	R = Integers(n)</span><br><span class="line">	attempts = <span class="number">20</span></span><br><span class="line">	js = [<span class="number">0</span>, (-<span class="number">2</span>^<span class="number">5</span>)^<span class="number">3</span>, (-<span class="number">2</span>^<span class="number">5</span>*<span class="number">3</span>)^<span class="number">3</span>, (-<span class="number">2</span>^<span class="number">5</span>*<span class="number">3</span>*<span class="number">5</span>)^<span class="number">3</span>, (-<span class="number">2</span>^<span class="number">5</span>*<span class="number">3</span>*<span class="number">5</span>*<span class="number">11</span>)^<span class="number">3</span>, (-<span class="number">2</span>^<span class="number">6</span>*<span class="number">3</span>*<span class="number">5</span>*<span class="number">23</span>*<span class="number">29</span>)^<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(attempts):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> js:</span><br><span class="line">			<span class="keyword">if</span> j == <span class="number">0</span>:</span><br><span class="line">				a = R.random_element()</span><br><span class="line">				E = EllipticCurve([<span class="number">0</span>, a])</span><br><span class="line"></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				a = R(j)/(R(<span class="number">1728</span>)-R(j))</span><br><span class="line">				c = R.random_element()</span><br><span class="line">				E = EllipticCurve([<span class="number">3</span>*a*c^<span class="number">2</span>, <span class="number">2</span>*a*c^<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">			x = R.random_element()</span><br><span class="line">			z = E.division_polynomial(n, x)</span><br><span class="line">			g = gcd(z, n)</span><br><span class="line">			<span class="keyword">if</span> g &gt; <span class="number">1</span>:</span><br><span class="line">				<span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line">n = </span><br><span class="line">p = <span class="built_in">int</span>(QiCheng(Integer(n)))</span><br></pre></td></tr></table></figure></li><li><p><strong>Masaaki Shirase &amp; Vladimir Sedlacek Improvement</strong></p><p>æ›´å¤š $Ds$ å€¼ã€‚</p><p><a target="_blank" rel="noopener" href="https://github.com/crocs-muni/cm_factorization">CM-based factorization</a></p></li></ul><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://blog.arpe1s.xyz/posts/2021/03/qicheng_prime/">æµ…è°ˆ QiCheng Prime</a></p><p>NCTF 2020 - RSA_revenge</p><p>CryptoHack Challenge - RSA Backdoor Viability</p><p>â€‹</p></li><li><h5 id="Common-Prime-RSA"><a href="#Common-Prime-RSA" class="headerlink" title="Common Prime RSA"></a>Common Prime RSA</h5><p><strong>æƒ…å½¢ï¼š$\gcd(p-1,q-1)=g$</strong></p><p>åˆ†è§£çš„næ–¹æ³•æœ‰å››ç§ï¼š</p><p>ï¼ˆ1ï¼‰ä¿®æ”¹Pollardâ€™s rhoæ–¹æ³•åˆ†è§£nï¼›</p><p>ï¼ˆ2ï¼‰çŸ¥é“aã€bçš„å€¼åˆ†è§£nï¼›</p><p>ï¼ˆ3ï¼‰çŸ¥é“gçš„å€¼åˆ†è§£nï¼›</p><p>ï¼ˆ4ï¼‰åˆ†è§£N-1ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pollardâ€™s rho</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x, n</span>):</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(x, n - <span class="number">1</span>, n) + <span class="number">3</span>) % n</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rho</span>(<span class="params">n</span>):</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;Factorizing&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x1 = getRandomRange(<span class="number">2</span>, n)</span><br><span class="line">        x2 = f(x1, n)</span><br><span class="line">        j = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            p = gmpy2.gcd(<span class="built_in">abs</span>(x1 - x2), n)</span><br><span class="line">            <span class="keyword">if</span> p == n:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> p &gt; <span class="number">1</span> <span class="keyword">and</span> isPrime(p):</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&#x27;Found!&#x27;</span></span><br><span class="line">                <span class="keyword">return</span> (p, n // p)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                x1 = f(x1, n)</span><br><span class="line">                x2 = f(f(x2, n), n)</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">        i += <span class="number">1</span></span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://hasegawaazusa.github.io/common-prime-rsa.html">Common Prime RSA ç¬”è®°</a></p><p>â€‹</p></li><li><h5 id="RSA-Padding-Oracle-Attack"><a href="#RSA-Padding-Oracle-Attack" class="headerlink" title="RSA Padding Oracle Attack"></a>RSA Padding Oracle Attack</h5><p>RSA PKCS #1 v1.5 å¡«å……ç”¨äºéœ€è¦RSAåŠ å¯†çš„ä¿¡æ¯ï¼Œä¸ºäº†åŠ å¯†Kï¼Œæ¶ˆæ¯é¦–å…ˆè¢«0x00ã€ä¸€äº›éšæœºå­—èŠ‚å’Œ0x00 0x02å¡«å……ï¼Œéšæœºå­—èŠ‚çš„é€‰æ‹©æ–¹å¼æ˜¯ä¸ºäº†è®©å¡«å……çš„ä¿¡æ¯è¾¾åˆ°ç‰¹å®šçš„å—é•¿åº¦ï¼ˆ1024ã€2048æˆ–4096ä½ï¼‰ã€‚</p><p><img src="/2020/05/06/crypto-RSA/pkcs1padding.jpg" alt="pkcs1padding"></p><p>PKCS #1 v1.5 æ ‡å‡†ä¸­å¯ä»¥ä¼ªé€ RSAç­¾åã€‚</p><p><strong>Bleichenbacheræ”»å‡»</strong></p><p>å¯ä»¥è¯†åˆ«åœ¨ <code>0x00 02</code> åä»¥æ˜æ–‡å¼€å§‹çš„å¯†æ–‡ä¿¡æ¯ï¼Œç„¶åè¿›è¡ŒPadding Oracleæ”»å‡»æ¥è§£å¯†é¢„ä¸»å¯†é’¥ï¼Œè¿›ä¸€æ­¥å¯ä»¥å–å¾—SSLçš„ä¼šè¯å¯†é’¥ã€‚</p><p>å……åˆ†åˆ©ç”¨ <code>0x00 02</code> å¼€å¤´çš„ç‰¹æ€§ï¼Œå‡è®¾æ”»å‡»è€…è·å¾—å¯†æ–‡ $C_0$ï¼Œæƒ³æ¢å¤å‡ºæ˜æ–‡ $M_0$ã€‚æ”»å‡»æ–¹æ³•æ˜¯é€šè¿‡å‘æœåŠ¡å™¨å¤šæ¬¡å‘é€ä¿®æ”¹åçš„å¯†æ–‡ï¼Œåˆ†æå“åº”æ˜¯æ­£ç¡®è¿˜æ˜¯é”™è¯¯æ¥ç¡®å®šä¿®æ”¹ç»“æœï¼Œè¿›è€Œè§£å¯†ä¿¡æ¯ã€‚</p><p>å¦‚æœæ”¶åˆ°æ­£ç¡®ï¼Œåˆ™è¡¨ç¤ºæ˜¯ <code>0x00 02</code> å¼€å¤´ï¼Œé‚£ä¹ˆ $2B \lt m \lt 3B-1$ï¼Œä¸” $B=2^{8(L-2)}$ï¼Œè€Œä¸”åŸºäºRSAåŠ å¯†çš„å»¶å±•æ€§ï¼Œå¯å¾— $C=(C_0S)\bmod N=(M_0S)^e \bmod N$ ï¼Œæ”»å‡»è€…å¯ç”¨ $C$ è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœæ”¶åˆ°é”™è¯¯åˆ™å¢åŠ  $S$ï¼Œå¹¶é‡å¤ä¸Šä¸€æ­¥éª¤ã€‚</p><p>æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ <code>0x00 02</code> å¤§å¹…åº¦å‡å°‘å¯èƒ½çš„å–å€¼ï¼Œ$2B \lt M_0S-rN \lt 3B$ï¼Œå› æ­¤æ”»å‡»è€…èƒ½å¤Ÿé™ä½èŒƒå›´$\cfrac{2B+rN}{S} \lt M_0 \lt \cfrac{3B+rN}{S}$ï¼Œç„¶åè¿­ä»£é€‰æ‹© $S$ï¼Œè¿›è¡ŒOracleæŸ¥è¯¢ï¼Œè®¡ç®—æ–°çš„ $r$ å€¼ï¼Œæ”»å‡»è€…ä¾¿å¯ä»¥ä¸æ–­ç¼©å°åŒ…å« $M_0$ çš„èŒƒå›´ï¼Œä¸æ–­é‡å¤ç›´åˆ°æœ€ååªå‰©å”¯ä¸€è§£ã€‚</p><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="http://archiv.infsec.ethz.ch/education/fs08/secsem/bleichenbacher98.pdf">Chosen Ciphertext Attacks Against Protocols Based on the RSA Encryption Standard PKCS #1</a></p><p><a target="_blank" rel="noopener" href="https://github.com/duesee/bleichenbacher">Bleichenbachers â€œMillion Message Attackâ€ on RSA</a></p><p>Pwnhub - pkcs_fix</p><p>â€‹</p></li><li><h5 id="Return-of-Coppersmithâ€™s-attack-ROCA"><a href="#Return-of-Coppersmithâ€™s-attack-ROCA" class="headerlink" title="Return of Coppersmithâ€™s attack (ROCA)"></a>Return of Coppersmithâ€™s attack (ROCA)</h5><p>CVE-2017-15361</p><p>å½¢å¦‚ $p=kM+(65537^a \bmod M)$ ç”Ÿæˆç´ æ•°çš„RSAç³»ç»Ÿï¼Œ$M$ æ˜¯å‰ $n$ ä¸ªè¿ç»­ç´ æ•°çš„ä¹˜ç§¯ï¼Œ$n$ æ˜¯ä»…å–å†³äºæ‰€éœ€å¯†é’¥å¤§å°çš„å¸¸æ•°ã€‚</p><p><a target="_blank" rel="noopener" href="https://github.com/jvdsn/crypto-attacks/blob/master/attacks/factorization/roca.py">https://github.com/jvdsn/crypto-attacks/blob/master/attacks/factorization/roca.py</a></p><p><a target="_blank" rel="noopener" href="https://github.com/FlorianPicca/ROCA">https://github.com/FlorianPicca/ROCA</a></p></li></ul><p>â€‹</p><h3 id="PEMå¯†é’¥"><a href="#PEMå¯†é’¥" class="headerlink" title="PEMå¯†é’¥"></a>PEMå¯†é’¥</h3><p>ç”±<code>-----BEGIN &lt;TAG&gt;-----</code>å¼€å¤´ï¼Œ<code>-----END &lt;TAG&gt;-----</code>ç»“å°¾ï¼Œä¸­é—´æ˜¯Base64ç¼–ç çš„ä¸€ä¸²äºŒè¿›åˆ¶ï¼Œæ¯64ä¸ªå­—æ¯ï¼ˆå³è§£ç åçš„48bytesï¼‰æœ‰ä¸€ä¸ªæ¢è¡Œã€‚ä¸­é—´çš„Base64è§£ç åæ˜¯ä¸€ä¸²éµå¾ªASN.1åè®®çš„DERç¼–ç ï¼Œç®€å•æ¥è¯´å¯ä»¥çœ‹æˆä¸€ç§åºåˆ—åŒ–ï¼ŒæŠŠä¸€ä¸ªç»“æ„ä½“ä¸­çš„æ•´æ•°ã€å­—ä¸²ç­‰ç¼–ç æˆä¸€ä¸ªæ–¹ä¾¿ä¼ è¾“çš„äºŒè¿›åˆ¶ã€‚</p><p>ç”Ÿæˆä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line">rsa = RSA.generate(<span class="number">1024</span>)</span><br><span class="line">pk = rsa.publickey().exportKey()</span><br><span class="line">sk = rsa.exportKey()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span> (<span class="string">&#x27;./pub.pem&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(pk)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span> (<span class="string">&#x27;./priv.pem&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(sk)</span><br></pre></td></tr></table></figure><h4 id="RSAç§é’¥"><a href="#RSAç§é’¥" class="headerlink" title="RSAç§é’¥"></a>RSAç§é’¥</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">...Base64 encoded key...</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc3447#appendix-A.1.2">RFC3447</a>å®šä¹‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">RSAPrivateKey ::= SEQUENCE &#123;</span><br><span class="line">    version           Version,</span><br><span class="line">    modulus           INTEGER,  -- n</span><br><span class="line">    publicExponent    INTEGER,  -- e</span><br><span class="line">    privateExponent   INTEGER,  -- d</span><br><span class="line">    prime1            INTEGER,  -- p</span><br><span class="line">    prime2            INTEGER,  -- q</span><br><span class="line">    exponent1         INTEGER,  -- d mod (p-1)</span><br><span class="line">    exponent2         INTEGER,  -- d mod (q-1)</span><br><span class="line">    coefficient       INTEGER,  -- (inverse of q) mod p</span><br><span class="line">    otherPrimeInfos   OtherPrimeInfos OPTIONAL</span><br><span class="line">&#125;</span><br><span class="line">Version ::= INTEGER &#123; two-prime(0), multi(1) &#125;</span><br><span class="line">   (CONSTRAINED BY</span><br><span class="line">   &#123;-- version must be multi if otherPrimeInfos present --&#125;)</span><br></pre></td></tr></table></figure><p>ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3082025d02010002818100a0d154d5bf97c40f7797b44819d09c608fa4b5c38e70d83bc13267138c6eff4c1aacefe3ddb571e1b41d911c7ab6136cf90493189563450e1f4270cabbc4207c54c4da7b84a20311cfbbabe82b9fe60bdf48a08d57839d0cdf9464d84262bcc06bc308095a6987f60ad07d669a312b5a7e4133213788eecf25863248b91349ef02030100010281800f8270c496903bf3e3ec4912450f15edc81cb1fcf4b154615aee11fbd428e64d402b5a8d66d5f770358f3e6df935b324e8d5349c83d7c992a5982249a31734acb1db19c4c8d829267514bc1ef7bbfbe242d4350f67a002a56d33e56d1a94adc71c68f020dc39ab7d0064c111b164e26ba0698dc94a03cdfd516ffd966e877949024100ca97e49c058237f96e99118ce383f91912cba1163de9236181ff754ef3ef1a260fac8d2d9aee866d51a8b6836983b05cf850e786289b6859925bc8695fc67c47024100cb3630aafffcb29607f0833dc7f05c143ee92fadfe975da4cf6719e71226bee72562e8631328a25d7351507a8d43c1295ab6ea242b60a28b109233a983f4211902401b4a32a541a8b4d988a85dd0d8a4e25d1a470bbfef3f0461121dd3337b706dd94aab37a9390180622169d48c071e921733ebd204245c2ac6460ccf0642bc7de90241008d9f44a7c823eaaa58fa2bdd20bcc8cf6b50c463f4acb51ca956e75c7ceff7d7cbdc74aca7ab880cacd39cccec2aae320e00b0896899be6e40ac43c8fe2763f1024100c67ca6d988f53abea82159431a146512a8d942978d4a8f83f2d426f1095e3bf1b5b9b8b1ccbbad2a31c6401880447a45f5e0790269061ac13b5f68f1777d7f07</span><br></pre></td></tr></table></figure><p><code>30</code>æ˜¯Sequenceçš„tagï¼Œ<code>82</code>æ˜¯æŒ‡æ¥ä¸‹æ¥åä¸¤ä¸ªbytesæ˜¯è¿™ä¸ªSequenceçš„é•¿åº¦ï¼Œå³<code>0x025d</code>ä¸ªbytesï¼Œä¹Ÿå°±æ˜¯å‰©ä¸‹å…¨éƒ¨éƒ½æ˜¯ï¼›æ¥ç€çš„<code>020100</code>å°±æ˜¯æ•´æ•°0ï¼Œå…¶ä¸­<code>02</code>æ˜¯æ•´æ•°çš„tagï¼Œ<code>01</code>æ˜¯è¿™ä¸ªæ•´æ•°å 1byteï¼Œ<code>00</code>æ˜¯valueåŒæ ·çš„æ–¹æ³•ä¹Ÿå¯ä»¥è§£<code>02818100a0...</code>å’Œåé¢å…¶ä»–æ•´æ•°ï¼Œæ‹†åˆ†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">3082025d  	# Begin Sequence: len=0x025d</span><br><span class="line"></span><br><span class="line">0201  		# Version: (len=0x01)</span><br><span class="line">00</span><br><span class="line"></span><br><span class="line">028181		# n: (len=0x81)</span><br><span class="line">00a0d154d5bf97c40f7797b44819d09c608fa4b5c38e70d83bc13267138c6eff4c1aacefe3ddb571e1b41d911c7ab6136cf90493189563450e1f4270cabbc4207c54c4da7b84a20311cfbbabe82b9fe60bdf48a08d57839d0cdf9464d84262bcc06bc308095a6987f60ad07d669a312b5a7e4133213788eecf25863248b91349ef</span><br><span class="line"></span><br><span class="line">0203		# e: (len=0x03)</span><br><span class="line">010001</span><br><span class="line"></span><br><span class="line">028180		# d: (len=0x80)</span><br><span class="line">0f8270c496903bf3e3ec4912450f15edc81cb1fcf4b154615aee11fbd428e64d402b5a8d66d5f770358f3e6df935b324e8d5349c83d7c992a5982249a31734acb1db19c4c8d829267514bc1ef7bbfbe242d4350f67a002a56d33e56d1a94adc71c68f020dc39ab7d0064c111b164e26ba0698dc94a03cdfd516ffd966e877949</span><br><span class="line"></span><br><span class="line">0241		# p: (len=0x41)</span><br><span class="line">00ca97e49c058237f96e99118ce383f91912cba1163de9236181ff754ef3ef1a260fac8d2d9aee866d51a8b6836983b05cf850e786289b6859925bc8695fc67c47</span><br><span class="line"></span><br><span class="line">0241		# q: (len=0x41)</span><br><span class="line">00cb3630aafffcb29607f0833dc7f05c143ee92fadfe975da4cf6719e71226bee72562e8631328a25d7351507a8d43c1295ab6ea242b60a28b109233a983f42119</span><br><span class="line"></span><br><span class="line">0240		# d mod (p-1): (len=0x40)</span><br><span class="line">1b4a32a541a8b4d988a85dd0d8a4e25d1a470bbfef3f0461121dd3337b706dd94aab37a9390180622169d48c071e921733ebd204245c2ac6460ccf0642bc7de9</span><br><span class="line"></span><br><span class="line">0241		# d mod (q-1): (len=0x41)</span><br><span class="line">008d9f44a7c823eaaa58fa2bdd20bcc8cf6b50c463f4acb51ca956e75c7ceff7d7cbdc74aca7ab880cacd39cccec2aae320e00b0896899be6e40ac43c8fe2763f1</span><br><span class="line"></span><br><span class="line">0241		# (inverse of q) mod p: (len=0x41)</span><br><span class="line">00c67ca6d988f53abea82159431a146512a8d942978d4a8f83f2d426f1095e3bf1b5b9b8b1ccbbad2a31c6401880447a45f5e0790269061ac13b5f68f1777d7f07</span><br><span class="line">			</span><br><span class="line">			# End Sequence</span><br></pre></td></tr></table></figure><h4 id="RSAå…¬é’¥"><a href="#RSAå…¬é’¥" class="headerlink" title="RSAå…¬é’¥"></a>RSAå…¬é’¥</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">...Base64 encoded key...</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure><p>ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30819f300d06092a864886f70d010101050003818d0030818902818100a0d154d5bf97c40f7797b44819d09c608fa4b5c38e70d83bc13267138c6eff4c1aacefe3ddb571e1b41d911c7ab6136cf90493189563450e1f4270cabbc4207c54c4da7b84a20311cfbbabe82b9fe60bdf48a08d57839d0cdf9464d84262bcc06bc308095a6987f60ad07d669a312b5a7e4133213788eecf25863248b91349ef0203010001</span><br></pre></td></tr></table></figure><p>æ‹†åˆ†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">30819f 		# Begin Main Sequence: len=0x9f</span><br><span class="line"></span><br><span class="line">300d		# Begin Sub1 Sequence: len=0x0d</span><br><span class="line"></span><br><span class="line">0609		# algo_oid: (1.2.840.113549.1.1.1  - PKCSv1.2)</span><br><span class="line">2a864886f70d010101</span><br><span class="line"></span><br><span class="line">0500		# params: (null)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			# End Sub1 Sequence</span><br><span class="line"></span><br><span class="line">03818d		# BitString: len=0x8d ([n, e])</span><br><span class="line"></span><br><span class="line">00308189	# Begin Sub2 Sequence: len=0x89</span><br><span class="line"></span><br><span class="line">028181		# n:</span><br><span class="line">00a0d154d5bf97c40f7797b44819d09c608fa4b5c38e70d83bc13267138c6eff4c1aacefe3ddb571e1b41d911c7ab6136cf90493189563450e1f4270cabbc4207c54c4da7b84a20311cfbbabe82b9fe60bdf48a08d57839d0cdf9464d84262bcc06bc308095a6987f60ad07d669a312b5a7e4133213788eecf25863248b91349ef</span><br><span class="line"></span><br><span class="line">0203		# e:</span><br><span class="line">010001</span><br><span class="line"></span><br><span class="line">			# End Sub2 Sequence</span><br><span class="line"></span><br><span class="line">			# End Main Sequence</span><br></pre></td></tr></table></figure><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a target="_blank" rel="noopener" href="https://tover.xyz/p/pem-by-hand/">æ‰‹æ’•PEMå¯†é’¥</a></p><p>â€‹</p><h3 id="è¯¦ç»†åŸç†"><a href="#è¯¦ç»†åŸç†" class="headerlink" title="è¯¦ç»†åŸç†"></a>è¯¦ç»†åŸç†</h3><p><a target="_blank" rel="noopener" href="https://paper.seebug.org/727/">äºŒåå¹´ä»¥æ¥å¯¹ RSA å¯†ç ç³»ç»Ÿæ”»å‡»ç»¼è¿°</a></p><p><a target="_blank" rel="noopener" href="https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_theory-zh/">CTF Wiki - RSA</a></p><p><a target="_blank" rel="noopener" href="https://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/">0xDktbâ€™s Blog</a></p><p><a target="_blank" rel="noopener" href="https://ohmygodlin.github.io/ctf/crypto/2018/09/26/RSA%E5%B8%B8%E8%A7%81%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/">RSAå¸¸è§æ”»å‡»æ–¹æ³•</a></p><p><a target="_blank" rel="noopener" href="http://index-of.es/Varios-2/Cryptanalysis of RSA and It&#39;s Variants.pdf">Cryptanalysis of RSA and Itâ€™s Variants</a></p></div><div class="article-footer"></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2020/05/07/crypto-%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0/" title="ç¦»æ•£å¯¹æ•°"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;ä¸Šä¸€ç¯‡</span></a></li><li class="next"><a href="/2020/05/06/web-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" title="æ–‡ä»¶ä¸Šä¼ "><span>ä¸‹ä¸€ç¯‡&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li><li class="toggle-toc"><a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="æ–‡ç« ç›®å½•" role="button"><span>[&nbsp;</span><span>æ–‡ç« ç›®å½•</span> <i class="text-collapsed icon icon-anchor"></i> <i class="text-in icon icon-close"></i> <span>]</span></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>èµ</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat" data-mobile-sites="weibo,qq,wechat"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ï¼Œèµä¸€æ¯å’–å•¡â˜•~~</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="æ‰«ç æ”¯æŒ" title="æ‰«ä¸€æ‰«"></div><p class="text-muted mv">âLazzaroâ </p><p class="text-grey">æ‰“å¼€å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯æ‰«ç æ‰“èµä»–ä¸€æ³¢å“¦~</p></div><div role="tabpanel" class="tab-pane fade" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="æ‰«ç æ”¯æŒ" title="æ‰«ä¸€æ‰«"></div><p class="text-muted mv">âLazzaroâ </p><p class="text-grey">æ‰“å¼€æ”¯ä»˜å®æ‰«ä¸€æ‰«å³å¯æ‰«ç æ‰“èµä»–ä¸€æ³¢å“¦~</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="true"><i class="icon icon-wepay"></i> å¾®ä¿¡æ”¯ä»˜</a></li><li role="presentation"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="false"><i class="icon icon-alipay"></i> æ”¯ä»˜å®</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/Lazzzaro" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul><div class="copyright">&copy; 2023 Lazzaro<br><span>æ€»è®¿é—® - <span id="busuanzi_value_site_pv"></span>æ¬¡</span><br><span>è®¿å®¢æ•° - <span id="busuanzi_value_site_uv"></span>äºº</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"æ–‡ç« ",PAGES:"é¡µé¢",CATEGORIES:"ç±»åˆ«",TAGS:"å…³é”®è¯",UNTITLED:"(æœªå‘½å)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"sK4BUsDgfSB843HYgJyTcV7P-gzGzoHsz",appKey:"NKNx8m2CtFeDofr8LNLX7aNG",placeholder:"æ¥æ¥æ¥è¯´ç‚¹å•¥~~\r\nå¯¹ä½ æœ‰ç”¨ï¼Ÿèµä¸€æ³¢ï¼â†˜â†˜",avatar:"mp",meta:meta,pageSize:"10",visitor:!0})</script><script defer type="text/javascript">!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-165804489-1","auto"),ga("send","pageview")</script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px;z-index:2}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>addLoadEvent(()=>{$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("å¤åˆ¶").on("click",function(t){var e=$(this).parent().find(".code")[0].innerText;e+="\n/**\n* å¤åˆ¶å¹¶ä½¿ç”¨ä»£ç è¯·æ³¨æ˜å¼•ç”¨å‡ºå¤„å“¦~\n* Lazzaro @ https://lazzzaro.github.io\n*/";var n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();e=document.execCommand("copy");document.body.removeChild(n),e?$(this).text("å¤åˆ¶æˆåŠŸ"):$(this).text("å¤åˆ¶å¤±è´¥"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("å¤åˆ¶")},300)}).append(e)})})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>